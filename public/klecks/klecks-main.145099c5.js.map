{"mappings":"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","sources":["node_modules/@parcel/runtime-browser-hmr/lib/runtime-39d78940ffba2369.js","src/app/script/main-standalone.ts","src/app/script/polyfills/polyfills.ts","src/app/script/polyfills/polyfills-nomodule.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","node_modules/mdn-polyfills/Array.prototype.findIndex.js","src/app/script/app/kl-app.ts","src/app/script/klecks/kl.ts","src/app/script/klecks/ui/modals/base/showModal.ts","src/app/script/klecks/ui/modals/modal-count.ts","node_modules/@parcel/transformer-js/src/esmodule-helpers.js","src/app/script/bb/bb.ts","src/app/script/bb/base/base.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/input/wheel-cleaner.ts","src/app/script/bb/input/pressure-normalizer.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/multi-polygon/get-selection-path-2d.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/math/math.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","src/app/script/bb/base/local-storage.ts","src/app/script/bb/input/event-chain/coalesced-exploder.ts","src/app/script/bb/input/event-chain/n-finger-tapper.ts","src/app/script/bb/input/event-chain/pinch-zoomer.ts","src/app/script/bb/input/event-chain/double-tapper.ts","src/app/script/bb/input/event-chain/one-pointer-limiter.ts","src/app/script/bb/input/event-chain/event-chain.ts","src/app/script/language/language.ts","src/app/languages/languages.ts","src/app/languages/en.json","node_modules/@parcel/runtime-js/lib/runtime-0f656708b4de74dd.js","node_modules/@parcel/runtime-js/lib/runtime-56cf5f7bed80488d.js","node_modules/@parcel/runtime-js/lib/runtime-188b365b6002279f.js","node_modules/@parcel/runtime-js/lib/runtime-29430391f815e0c9.js","node_modules/@parcel/runtime-js/lib/runtime-af71ee7b64e3d194.js","node_modules/@parcel/runtime-js/lib/runtime-12628410fbd28c58.js","node_modules/@parcel/runtime-js/lib/runtime-076baf27fc64ff22.js","node_modules/@parcel/runtime-js/lib/runtime-eceb5c60f36d5e45.js","node_modules/@parcel/runtime-js/lib/runtime-03a4a67bb06460da.js","node_modules/@parcel/runtime-js/lib/runtime-44bb24c1abef7688.js","node_modules/@parcel/runtime-js/lib/runtime-463b9afff02858f0.js","node_modules/@parcel/runtime-js/lib/runtime-7573e2002f33d6b0.js","node_modules/@parcel/runtime-js/lib/runtime-e5457485494b682a.js","node_modules/@parcel/runtime-js/lib/runtime-5cc526e0eb0ec96f.js","node_modules/@parcel/runtime-js/lib/runtime-6ca673b3aec378c7.js","node_modules/@parcel/runtime-js/lib/runtime-b4b16a4354a80b58.js","node_modules/@parcel/runtime-js/lib/runtime-0d0720a6d18e35af.js","src/app/script/klecks/ui/modals/base/scroll-fix.ts","node_modules/@parcel/runtime-js/lib/runtime-5f9c751f77a64fbc.js","node_modules/@parcel/runtime-js/lib/runtime-1ad136d2f6f953d7.js","node_modules/@parcel/runtime-js/lib/runtime-03eac8113b287b55.js","src/app/script/klecks/ui/modals/base/dynamic-modal.ts","src/app/script/klecks/ui/components/checkbox.ts","src/app/script/klecks/ui/components/input.ts","src/app/script/klecks/ui/components/select.ts","src/app/script/klecks/ui/components/image-toggle.ts","src/app/script/klecks/ui/components/image-radio-list.ts","src/app/script/klecks/ui/components/create-pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-5f3a3b9259994d3e.js","src/app/script/klecks/ui/components/box-toggle.ts","src/app/script/klecks/ui/components/kl-slider.ts","src/app/script/klecks/ui/components/slider-falloff.ts","src/app/script/klecks/ui/components/kl-slider-manual-input.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-a0019840c0ca0a55.js","src/app/script/bb/base/c.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.module.scss","src/app/script/klecks/ui/components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-0a3174136e022167.js","src/app/script/klecks/brushes/erase-color.ts","src/app/script/theme/theme.ts","src/app/script/klecks/ui/components/kl-color-slider-small.ts","src/app/script/klecks/ui/components/point-slider.ts","src/app/script/klecks/ui/components/color-options.ts","src/app/script/klecks/ui/components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-6a8eefb75076cd0d.js","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/project-viewport/preview.ts","src/app/script/klecks/ui/project-viewport/project-viewport.ts","node_modules/transformation-matrix/src/index.js","node_modules/transformation-matrix/src/applyToPoint.js","node_modules/transformation-matrix/src/fromObject.js","node_modules/transformation-matrix/src/fromString.js","node_modules/transformation-matrix/src/identity.js","node_modules/transformation-matrix/src/inverse.js","node_modules/transformation-matrix/src/isAffineMatrix.js","node_modules/transformation-matrix/src/utils.js","node_modules/transformation-matrix/src/rotate.js","node_modules/transformation-matrix/src/translate.js","node_modules/transformation-matrix/src/transform.js","node_modules/transformation-matrix/src/scale.js","node_modules/transformation-matrix/src/shear.js","node_modules/transformation-matrix/src/skew.js","node_modules/transformation-matrix/src/toString.js","node_modules/transformation-matrix/src/fromTriangles.js","node_modules/transformation-matrix/src/smoothMatrix.js","node_modules/transformation-matrix/src/fromDefinition.js","node_modules/transformation-matrix/src/fromTransformAttribute.js","node_modules/transformation-matrix/src/fromTransformAttribute.autogenerated.js","node_modules/transformation-matrix/src/decompose.js","node_modules/transformation-matrix/src/flip.js","node_modules/transformation-matrix/src/fromMovingPoints.js","src/app/script/bb/transform/create-matrix-from-transform.ts","src/app/script/bb/math/matrix-to-tuple.ts","src/app/script/klecks/ui/project-viewport/debug-render.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/history/compose-history-state-data.ts","src/app/script/klecks/history/estimate-bytes.ts","src/app/script/klecks/kl-types.ts","src/app/script/klecks/history/entry-causes-change.ts","node_modules/@parcel/runtime-js/lib/runtime-19061bf26e04ef6d.js","node_modules/@parcel/runtime-js/lib/runtime-f19a04dc48bd3390.js","node_modules/@parcel/runtime-js/lib/runtime-5c750592953240f9.js","node_modules/@parcel/runtime-js/lib/runtime-61148a5c100776b7.js","node_modules/@parcel/runtime-js/lib/runtime-dc6c404d2e227111.js","src/app/script/klecks/ui/project-viewport/preview.module.scss","src/app/script/klecks/ui/project-viewport/utils/zoom-by-step.ts","src/app/script/bb/transform/create-transform.ts","src/app/script/bb/transform/to-meta-transform.ts","src/app/script/klecks/ui/easel/selection-renderer.ts","src/app/script/klecks/ui/easel/selection-renderer.module.scss","src/app/script/bb/multi-polygon/transform-multi-polygon.ts","src/app/script/bb/multi-polygon/apply-polygon-clipping.ts","node_modules/polygon-clipping/dist/polygon-clipping.umd.js","node_modules/@parcel/runtime-js/lib/runtime-4b913be5b6046405.js","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/bb/multi-polygon/get-multi-polygon-bounds.ts","src/app/script/klecks/ui/tool-tabs/layers-ui/layers-ui.ts","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/bb/transform/transform-bounds.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/image-operations/gradient-tool.ts","src/app/script/klecks/history/get-next-layer-id.ts","src/app/script/klecks/history/create-fill-color-tiles.ts","src/app/script/klecks/canvas/update-layers-via-composed.ts","src/app/script/klecks/history/sort-layer-map.ts","src/app/script/klecks/history/push-helpers/is-history-entry-opacity-change.ts","src/app/script/klecks/history/push-helpers/is-history-entry-visibility-change.ts","src/app/script/klecks/canvas/get-selection-sample-bounds.ts","src/app/script/klecks/history/push-helpers/create-layer-map.ts","src/app/script/klecks/history/push-helpers/canvas-to-layer-tiles.ts","src/app/script/klecks/history/push-helpers/get-tile-from-canvas.ts","src/app/script/klecks/history/push-helpers/changed-tiles.ts","src/app/script/klecks/history/image-data-tile.ts","src/app/script/klecks/utils/copy-image-data.ts","src/app/script/klecks/canvas/eyedropper.ts","src/app/script/klecks/select-tool/get-selection-bounds.ts","src/app/script/bb/multi-polygon/translate-multi-polygon.ts","src/app/script/klecks/select-tool/get-binary-mask.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/ui/tool-tabs/layers-ui/rename-layer-dialog.ts","src/app/script/klecks/ui/tool-tabs/layers-ui/merge-layer-dialog.ts","src/app/script/klecks/ui/components/dropdown-menu.ts","node_modules/@parcel/runtime-js/lib/runtime-da6d85e3fdcf5576.js","node_modules/@parcel/runtime-js/lib/runtime-89245c6dc1fc2457.js","node_modules/@parcel/runtime-js/lib/runtime-cb90252ffdd23a59.js","node_modules/@parcel/runtime-js/lib/runtime-79127f8587f7a588.js","node_modules/@parcel/runtime-js/lib/runtime-ccff6f443be881aa.js","src/app/script/klecks/ui/project-viewport/kl-canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-f6c77134951700ad.js","src/app/script/klecks/ui/components/free-transform-utils.ts","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/utils/test-is-small.ts","src/app/script/klecks/ui/utils/preview-size.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-fca0a4cf7a280c66.js","node_modules/@parcel/runtime-js/lib/runtime-73ff2e0a5f5d7fcc.js","node_modules/@parcel/runtime-js/lib/runtime-4e22334dbb695f74.js","node_modules/@parcel/runtime-js/lib/runtime-6d96b3dd26e0267f.js","node_modules/@parcel/runtime-js/lib/runtime-8ab0fe7bb107cc1d.js","node_modules/@parcel/runtime-js/lib/runtime-6ec7188daab301b7.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-0f0b4945966be28d.js","node_modules/@parcel/runtime-js/lib/runtime-93bb37f23d288905.js","node_modules/@parcel/runtime-js/lib/runtime-d141b7dd0907c7aa.js","node_modules/@parcel/runtime-js/lib/runtime-f784f1cbb9421e36.js","node_modules/@parcel/runtime-js/lib/runtime-1d12fc4a1adda179.js","node_modules/@parcel/runtime-js/lib/runtime-490d6974e9d34860.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-8645f3da7bf05225.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-631a062ab7e859d6.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/table.ts","src/app/script/klecks/ui/mobile/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-0b50e2393f2226ad.js","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-dialog.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-fill-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-font-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-77730ad4bbbe7906.js","node_modules/@parcel/runtime-js/lib/runtime-5f6a60809f9fc91a.js","node_modules/@parcel/runtime-js/lib/runtime-fbaae32f700fab31.js","node_modules/@parcel/runtime-js/lib/runtime-2ab51414d340bf6a.js","node_modules/@parcel/runtime-js/lib/runtime-1722ff38befae06f.js","src/app/fonts/fonts.ts","node_modules/@parcel/runtime-js/lib/runtime-b9a08259358e9b1b.js","node_modules/@parcel/runtime-js/lib/runtime-8f354982f018ef64.js","node_modules/@parcel/runtime-js/lib/runtime-7c67c990e442df00.js","node_modules/@parcel/runtime-js/lib/runtime-84cf543fad505099.js","node_modules/@parcel/runtime-js/lib/runtime-f52e2da779b413e4.js","node_modules/@parcel/runtime-js/lib/runtime-45d80b46f110ce1f.js","node_modules/@parcel/runtime-js/lib/runtime-abf20b2366826212.js","node_modules/@parcel/runtime-js/lib/runtime-94c233411fee72f0.js","node_modules/@parcel/runtime-js/lib/runtime-4c83fc75bd773e59.js","node_modules/@parcel/runtime-js/lib/runtime-41570f568acad235.js","node_modules/@parcel/runtime-js/lib/runtime-eac54d8aa8dc558e.js","node_modules/@parcel/runtime-js/lib/runtime-23bc2f9424300174.js","node_modules/@parcel/runtime-js/lib/runtime-c7931b2ada123ddd.js","node_modules/@parcel/runtime-js/lib/runtime-fbf412eea0f49464.js","node_modules/@parcel/runtime-js/lib/runtime-cd05110996c15bc0.js","node_modules/@parcel/runtime-js/lib/runtime-d11efd5088425fa6.js","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-stroke-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-text-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-viewport-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-dialog.module.scss","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-191bb3ffa108ee19.js","node_modules/@parcel/runtime-js/lib/runtime-2de91a7f422dacde.js","node_modules/@parcel/runtime-js/lib/runtime-e19587b7a9b3440f.js","node_modules/@parcel/runtime-js/lib/runtime-6b18fa043da44aae.js","node_modules/@parcel/runtime-js/lib/runtime-c3c804b34536f6b9.js","node_modules/@parcel/runtime-js/lib/runtime-e585a9fd67bf9e95.js","node_modules/@parcel/runtime-js/lib/runtime-c3faa3b3ad34485f.js","node_modules/@parcel/runtime-js/lib/runtime-46df5d17b33f72b9.js","node_modules/@parcel/runtime-js/lib/runtime-f5e3a2dabc345263.js","node_modules/@parcel/runtime-js/lib/runtime-cebd9fe0cf7871d6.js","node_modules/@parcel/runtime-js/lib/runtime-2196c832f787aa3f.js","node_modules/@parcel/runtime-js/lib/runtime-753ec88bfd9099b6.js","node_modules/@parcel/runtime-js/lib/runtime-04d6b2d795ac0430.js","node_modules/@parcel/runtime-js/lib/runtime-9bc4dec3b69cfd5e.js","node_modules/@parcel/runtime-js/lib/runtime-c7fe295b4fea33d7.js","node_modules/@parcel/runtime-js/lib/runtime-5b32a3209066af9e.js","node_modules/@parcel/runtime-js/lib/runtime-a08a8e3ada832abe.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/history/push-helpers/get-pushable-layer-change.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-c0956b0b176a9555.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-1e1c90b7e12d273e.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-5a6d9e62daade774.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-768d66d96af71b31.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-196b0afaa1382f66.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-d6c826fce04a8d42.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-81df2537a60932fd.js","src/app/script/klecks/ui/modals/show-iframe-modal.ts","src/app/script/klecks/ui/components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/ui/utils/timestamp-to-age.ts","src/app/script/klecks/ui/components/browser-storage-header-ui.ts","src/app/script/klecks/ui/components/browser-storage-ui.module.scss","src/app/script/klecks/storage/request-persistent-storage.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/kl-indexed-db.ts","src/app/script/bb/base/indexed-db.ts","src/app/script/klecks/ui/tool-tabs/file-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-1a9be833ec80d6d8.js","src/app/script/klecks/ui/modals/recovery-manager-panel/show-recovery-manager-panel.ts","src/app/script/klecks/ui/modals/recovery-manager-panel/recovery-manager-panel.ts","src/app/script/klecks/storage/kl-recovery-manager.ts","src/app/script/klecks/storage/kl-recovery-storage.ts","src/app/script/bb/base/cross-tab-channel.ts","src/app/script/klecks/ui/modals/recovery-manager-panel/recovery-manager-panel.module.scss","src/app/script/klecks/ui/tool-tabs/file-ui.module.scss","src/app/script/klecks/ui/tool-tabs/edit-ui.ts","src/app/script/fx-canvas/shared-fx.ts","src/app/script/fx-canvas/fx-canvas.ts","src/app/script/fx-canvas/filters/brightness-contrast.ts","src/app/script/fx-canvas/core/simple-shader.ts","src/app/script/fx-canvas/core/fx-shader.ts","src/app/script/fx-canvas/core/gl.ts","src/app/script/fx-canvas/core/fx-texture.ts","src/app/script/fx-canvas/filters/curves.ts","src/app/script/fx-canvas/math/spline-interpolate.ts","src/app/script/fx-canvas/filters/hue-saturation.ts","src/app/script/fx-canvas/filters/noise.ts","src/app/script/fx-canvas/shaders/shader-noise.glsl","src/app/script/fx-canvas/filters/triangle-blur.ts","src/app/script/fx-canvas/shaders/random-shader-func.ts","src/app/script/fx-canvas/filters/tilt-shift.ts","src/app/script/fx-canvas/filters/matrix-warp.ts","src/app/script/fx-canvas/shaders/warp-shader.ts","src/app/script/fx-canvas/math/matrix.ts","src/app/script/fx-canvas/filters/unsharp-mask.ts","src/app/script/fx-canvas/filters/to-alpha.ts","src/app/script/fx-canvas/filters/invert.ts","src/app/script/fx-canvas/filters/perspective.ts","src/app/script/fx-canvas/filters/unmultiply-alpha.ts","src/app/script/fx-canvas/filters/distort.ts","src/app/script/fx-canvas/filters/multiply-alpha.ts","src/app/script/fx-canvas/filters/mask.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-01446a2654b72497.js","src/app/script/klecks/storage/load-ag-psd.ts","node_modules/@parcel/runtime-js/lib/runtime-7329e6e9fbdd3d53.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/ui/components/save-reminder.module.scss","src/app/script/klecks/storage/save-to-computer.ts","src/app/script/bb/base/save-as.ts","src/app/script/klecks/kl-config.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-00f42740f4e82a03.js","node_modules/@parcel/runtime-js/lib/runtime-6cb685a56a74cbf3.js","src/app/script/klecks/ui/modals/licenses-dialog/show-licenses-dialog.ts","src/app/script/klecks/ui/modals/licenses-dialog/show-licenses-dialog.module.scss","node_modules/@parcel/runtime-js/lib/runtime-f6c2511fadff6cea.js","node_modules/@parcel/runtime-js/lib/runtime-ab1174978d510ceb.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/klecks/ui/tool-tabs/gradient-ui.ts","src/app/script/embed/embed-toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/filter-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/ui/project-viewport/fx-preview-renderer.ts","src/app/script/klecks/filters/apply-fx-filter.ts","src/app/script/klecks/filters/filter-crop-extend.ts","src/app/script/klecks/filters/filter-curves.ts","src/app/script/klecks/filters/filter-curves/curves-input.ts","src/app/script/klecks/filters/filter-flip.ts","src/app/script/klecks/filters/filter-hue-saturation.ts","src/app/script/klecks/filters/filter-invert.ts","src/app/script/klecks/filters/filter-perspective.ts","src/app/script/klecks/ui/components/two-tabs.ts","src/app/script/klecks/ui/components/draggable-input.ts","src/app/script/klecks/filters/filter-resize.ts","node_modules/@parcel/runtime-js/lib/runtime-a4cf777401917019.js","src/app/script/klecks/filters/filter-rotate.ts","src/app/script/klecks/filters/filter-tilt-shift.ts","src/app/script/klecks/filters/filter-transform.ts","src/app/script/klecks/filters/filter-blur.ts","src/app/script/klecks/filters/filter-unsharp-mask.ts","src/app/script/klecks/filters/filter-to-alpha.ts","src/app/script/klecks/filters/filter-grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/filters/filter-noise.ts","src/app/script/klecks/filters/filter-pattern.ts","src/app/script/klecks/filters/filter-distort.ts","src/app/script/klecks/filters/filter-vanish-point.ts","src/app/script/klecks/image-operations/draw-vanish-point.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","src/app/script/klecks/events/line-smoothing.ts","src/app/script/klecks/events/line-sanitizer.ts","src/app/script/klecks/utils/translate-smoothing.ts","src/app/script/app/kl-app-import-handler.ts","src/app/script/klecks/storage/file-header-detection.ts","node_modules/@parcel/runtime-js/lib/runtime-040142ba75f723f6.js","node_modules/@parcel/runtime-js/lib/runtime-47f892242a22c14b.js","node_modules/@parcel/runtime-js/lib/runtime-015e6de01ff09fd0.js","src/app/script/app/console-api.ts","src/app/script/klecks/ui/easel/easel.ts","src/app/script/klecks/ui/easel/easel-pointer-preprocessor.ts","src/app/script/klecks/ui/easel/easel.config.ts","src/app/script/klecks/ui/project-viewport/utils/is-transform-equal.ts","src/app/script/klecks/ui/project-viewport/utils/blend-transform.ts","src/app/script/klecks/ui/easel/tools/easel-hand.ts","src/app/script/klecks/ui/easel/inertia-scrolling.ts","src/app/script/klecks/ui/easel/tools/easel-brush.ts","src/app/script/klecks/ui/easel/tools/brush-cursor-pixel-square.ts","src/app/script/klecks/ui/easel/tools/brush-cursor-round.ts","src/app/script/klecks/ui/easel/easel-project-updater.ts","src/app/script/klecks/ui/easel/tools/easel-eyedropper.ts","node_modules/@parcel/runtime-js/lib/runtime-51b17b5f01307848.js","src/app/script/klecks/ui/easel/tools/easel-paint-bucket.ts","node_modules/@parcel/runtime-js/lib/runtime-dcf2abb0e92752cc.js","src/app/script/klecks/ui/easel/tools/easel-gradient.ts","src/app/script/klecks/ui/easel/tools/easel-text.ts","node_modules/@parcel/runtime-js/lib/runtime-7b0bc2d8cd666682.js","src/app/script/klecks/ui/easel/tools/easel-shape.ts","src/app/script/klecks/ui/easel/corner-panning.ts","src/app/script/klecks/ui/easel/tools/easel-rotate.ts","src/app/script/klecks/ui/easel/tools/easel-zoom.ts","node_modules/@parcel/runtime-js/lib/runtime-5289d6bb7aa3b595.js","src/app/script/app/kl-app-select.ts","src/app/script/klecks/ui/tool-tabs/select-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9f288be0fe5b9694.js","node_modules/@parcel/runtime-js/lib/runtime-bc89d1b3ab5355b8.js","node_modules/@parcel/runtime-js/lib/runtime-8089223df65e19e2.js","node_modules/@parcel/runtime-js/lib/runtime-ce842c1d0de20dc6.js","node_modules/@parcel/runtime-js/lib/runtime-7e871a1eb584fe7a.js","node_modules/@parcel/runtime-js/lib/runtime-55926eacb3159e6f.js","node_modules/@parcel/runtime-js/lib/runtime-10dc40466759216a.js","node_modules/@parcel/runtime-js/lib/runtime-735b8bdb7d7b8dff.js","node_modules/@parcel/runtime-js/lib/runtime-ca892d944f4f8569.js","src/app/script/klecks/ui/easel/tools/easel-select.ts","src/app/script/klecks/select-tool/select-tool.ts","src/app/script/bb/multi-polygon/get-ellipse-path.ts","src/app/script/klecks/select-tool/select-transform-tool.ts","src/app/script/klecks/history/kl-temp-history.ts","src/app/script/klecks/ui/components/pinch-zoom-watcher.ts","src/app/script/klecks/history/kl-history-executor.ts","src/app/script/klecks/history/push-helpers/is-history-entry-active-layer-change.ts","src/app/script/klecks/ui/mobile/mobile-ui.ts","src/app/script/klecks/ui/mobile/mobile-brush-ui.ts","src/app/script/klecks/ui/components/icon.ts","src/app/script/klecks/history/push-helpers/project-to-composed.ts","src/app/script/klecks/ui/components/unload-warning-trigger.ts","src/app/script/klecks/ui/components/browser-storage-banner.ts","src/app/script/klecks/ui/components/browser-storage-banner.module.scss","src/app/script/klecks/ui/mobile/mobile-color-ui.ts","src/app/script/klecks/ui/mobile/mobile-floating-window.ts"],"sourcesContent":["var HMR_HOST = null;var HMR_PORT = null;var HMR_SERVER_PORT = 1234;var HMR_SECURE = false;var HMR_ENV_HASH = \"439701173a9199ea\";var HMR_USE_SSE = false;module.bundle.HMR_BUNDLE_ID = \"6aa113ac145099c5\";\"use strict\";\n\n/* global HMR_HOST, HMR_PORT, HMR_SERVER_PORT, HMR_ENV_HASH, HMR_SECURE, HMR_USE_SSE, chrome, browser, __parcel__import__, __parcel__importScripts__, ServiceWorkerGlobalScope */\n/*::\nimport type {\n  HMRAsset,\n  HMRMessage,\n} from '@parcel/reporter-dev-server/src/HMRServer.js';\ninterface ParcelRequire {\n  (string): mixed;\n  cache: {|[string]: ParcelModule|};\n  hotData: {|[string]: mixed|};\n  Module: any;\n  parent: ?ParcelRequire;\n  isParcelRequire: true;\n  modules: {|[string]: [Function, {|[string]: string|}]|};\n  HMR_BUNDLE_ID: string;\n  root: ParcelRequire;\n}\ninterface ParcelModule {\n  hot: {|\n    data: mixed,\n    accept(cb: (Function) => void): void,\n    dispose(cb: (mixed) => void): void,\n    // accept(deps: Array<string> | string, cb: (Function) => void): void,\n    // decline(): void,\n    _acceptCallbacks: Array<(Function) => void>,\n    _disposeCallbacks: Array<(mixed) => void>,\n  |};\n}\ninterface ExtensionContext {\n  runtime: {|\n    reload(): void,\n    getURL(url: string): string;\n    getManifest(): {manifest_version: number, ...};\n  |};\n}\ndeclare var module: {bundle: ParcelRequire, ...};\ndeclare var HMR_HOST: string;\ndeclare var HMR_PORT: string;\ndeclare var HMR_SERVER_PORT: string;\ndeclare var HMR_ENV_HASH: string;\ndeclare var HMR_SECURE: boolean;\ndeclare var HMR_USE_SSE: boolean;\ndeclare var chrome: ExtensionContext;\ndeclare var browser: ExtensionContext;\ndeclare var __parcel__import__: (string) => Promise<void>;\ndeclare var __parcel__importScripts__: (string) => Promise<void>;\ndeclare var globalThis: typeof self;\ndeclare var ServiceWorkerGlobalScope: Object;\n*/\nvar OVERLAY_ID = '__parcel__error__overlay__';\nvar OldModule = module.bundle.Module;\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData[moduleName],\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n  module.bundle.hotData[moduleName] = undefined;\n}\nmodule.bundle.Module = Module;\nmodule.bundle.hotData = {};\nvar checkedAssets /*: {|[string]: boolean|} */,\n  disposedAssets /*: {|[string]: boolean|} */,\n  assetsToDispose /*: Array<[ParcelRequire, string]> */,\n  assetsToAccept /*: Array<[ParcelRequire, string]> */,\n  bundleNotFound = false;\nfunction getHostname() {\n  return HMR_HOST || (typeof location !== 'undefined' && location.protocol.indexOf('http') === 0 ? location.hostname : 'localhost');\n}\nfunction getPort() {\n  return HMR_PORT || (typeof location !== 'undefined' ? location.port : HMR_SERVER_PORT);\n}\n\n// eslint-disable-next-line no-redeclare\nlet WebSocket = globalThis.WebSocket;\nif (!WebSocket && typeof module.bundle.root === 'function') {\n  try {\n    // eslint-disable-next-line no-global-assign\n    WebSocket = module.bundle.root('ws');\n  } catch {\n    // ignore.\n  }\n}\nvar hostname = getHostname();\nvar port = getPort();\nvar protocol = HMR_SECURE || typeof location !== 'undefined' && location.protocol === 'https:' && !['localhost', '127.0.0.1', '0.0.0.0'].includes(hostname) ? 'wss' : 'ws';\n\n// eslint-disable-next-line no-redeclare\nvar parent = module.bundle.parent;\nif (!parent || !parent.isParcelRequire) {\n  // Web extension context\n  var extCtx = typeof browser === 'undefined' ? typeof chrome === 'undefined' ? null : chrome : browser;\n\n  // Safari doesn't support sourceURL in error stacks.\n  // eval may also be disabled via CSP, so do a quick check.\n  var supportsSourceURL = false;\n  try {\n    (0, eval)('throw new Error(\"test\"); //# sourceURL=test.js');\n  } catch (err) {\n    supportsSourceURL = err.stack.includes('test.js');\n  }\n  var ws;\n  if (HMR_USE_SSE) {\n    ws = new EventSource('/__parcel_hmr');\n  } else {\n    try {\n      // If we're running in the dev server's node runner, listen for messages on the parent port.\n      let {\n        workerData,\n        parentPort\n      } = module.bundle.root('node:worker_threads') /*: any*/;\n      if (workerData !== null && workerData !== void 0 && workerData.__parcel) {\n        parentPort.on('message', async message => {\n          try {\n            await handleMessage(message);\n            parentPort.postMessage('updated');\n          } catch {\n            parentPort.postMessage('restart');\n          }\n        });\n\n        // After the bundle has finished running, notify the dev server that the HMR update is complete.\n        queueMicrotask(() => parentPort.postMessage('ready'));\n      }\n    } catch {\n      if (typeof WebSocket !== 'undefined') {\n        try {\n          ws = new WebSocket(protocol + '://' + hostname + (port ? ':' + port : '') + '/');\n        } catch (err) {\n          // Ignore cloudflare workers error.\n          if (err.message && !err.message.includes('Disallowed operation called within global scope')) {\n            console.error(err.message);\n          }\n        }\n      }\n    }\n  }\n  if (ws) {\n    // $FlowFixMe\n    ws.onmessage = async function (event /*: {data: string, ...} */) {\n      var data /*: HMRMessage */ = JSON.parse(event.data);\n      await handleMessage(data);\n    };\n    if (ws instanceof WebSocket) {\n      ws.onerror = function (e) {\n        if (e.message) {\n          console.error(e.message);\n        }\n      };\n      ws.onclose = function () {\n        console.warn('[parcel]  Connection to the HMR server was lost');\n      };\n    }\n  }\n}\nasync function handleMessage(data /*: HMRMessage */) {\n  checkedAssets = {} /*: {|[string]: boolean|} */;\n  disposedAssets = {} /*: {|[string]: boolean|} */;\n  assetsToAccept = [];\n  assetsToDispose = [];\n  bundleNotFound = false;\n  if (data.type === 'reload') {\n    fullReload();\n  } else if (data.type === 'update') {\n    // Remove error overlay if there is one\n    if (typeof document !== 'undefined') {\n      removeErrorOverlay();\n    }\n    let assets = data.assets;\n\n    // Handle HMR Update\n    let handled = assets.every(asset => {\n      return asset.type === 'css' || asset.type === 'js' && hmrAcceptCheck(module.bundle.root, asset.id, asset.depsByBundle);\n    });\n\n    // Dispatch a custom event in case a bundle was not found. This might mean\n    // an asset on the server changed and we should reload the page. This event\n    // gives the client an opportunity to refresh without losing state\n    // (e.g. via React Server Components). If e.preventDefault() is not called,\n    // we will trigger a full page reload.\n    if (handled && bundleNotFound && assets.some(a => a.envHash !== HMR_ENV_HASH) && typeof window !== 'undefined' && typeof CustomEvent !== 'undefined') {\n      handled = !window.dispatchEvent(new CustomEvent('parcelhmrreload', {\n        cancelable: true\n      }));\n    }\n    if (handled) {\n      console.clear();\n\n      // Dispatch custom event so other runtimes (e.g React Refresh) are aware.\n      if (typeof window !== 'undefined' && typeof CustomEvent !== 'undefined') {\n        window.dispatchEvent(new CustomEvent('parcelhmraccept'));\n      }\n      await hmrApplyUpdates(assets);\n      hmrDisposeQueue();\n\n      // Run accept callbacks. This will also re-execute other disposed assets in topological order.\n      let processedAssets = {};\n      for (let i = 0; i < assetsToAccept.length; i++) {\n        let id = assetsToAccept[i][1];\n        if (!processedAssets[id]) {\n          hmrAccept(assetsToAccept[i][0], id);\n          processedAssets[id] = true;\n        }\n      }\n    } else fullReload();\n  }\n  if (data.type === 'error') {\n    // Log parcel errors to console\n    for (let ansiDiagnostic of data.diagnostics.ansi) {\n      let stack = ansiDiagnostic.codeframe ? ansiDiagnostic.codeframe : ansiDiagnostic.stack;\n      console.error(' [parcel]: ' + ansiDiagnostic.message + '\\n' + stack + '\\n\\n' + ansiDiagnostic.hints.join('\\n'));\n    }\n    if (typeof document !== 'undefined') {\n      // Render the fancy html overlay\n      removeErrorOverlay();\n      var overlay = createErrorOverlay(data.diagnostics.html);\n      // $FlowFixMe\n      document.body.appendChild(overlay);\n    }\n  }\n}\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n    console.log('[parcel]  Error resolved');\n  }\n}\nfunction createErrorOverlay(diagnostics) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n  let errorHTML = '<div style=\"background: black; opacity: 0.85; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; font-family: Menlo, Consolas, monospace; z-index: 9999;\">';\n  for (let diagnostic of diagnostics) {\n    let stack = diagnostic.frames.length ? diagnostic.frames.reduce((p, frame) => {\n      return `${p}\n<a href=\"${protocol === 'wss' ? 'https' : 'http'}://${hostname}:${port}/__parcel_launch_editor?file=${encodeURIComponent(frame.location)}\" style=\"text-decoration: underline; color: #888\" onclick=\"fetch(this.href); return false\">${frame.location}</a>\n${frame.code}`;\n    }, '') : diagnostic.stack;\n    errorHTML += `\n      <div>\n        <div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">\n           ${diagnostic.message}\n        </div>\n        <pre>${stack}</pre>\n        <div>\n          ${diagnostic.hints.map(hint => '<div> ' + hint + '</div>').join('')}\n        </div>\n        ${diagnostic.documentation ? `<div> <a style=\"color: violet\" href=\"${diagnostic.documentation}\" target=\"_blank\">Learn more</a></div>` : ''}\n      </div>\n    `;\n  }\n  errorHTML += '</div>';\n  overlay.innerHTML = errorHTML;\n  return overlay;\n}\nfunction fullReload() {\n  if (typeof location !== 'undefined' && 'reload' in location) {\n    location.reload();\n  } else if (typeof extCtx !== 'undefined' && extCtx && extCtx.runtime && extCtx.runtime.reload) {\n    extCtx.runtime.reload();\n  } else {\n    try {\n      let {\n        workerData,\n        parentPort\n      } = module.bundle.root('node:worker_threads') /*: any*/;\n      if (workerData !== null && workerData !== void 0 && workerData.__parcel) {\n        parentPort.postMessage('restart');\n      }\n    } catch (err) {\n      console.error('[parcel]  An HMR update was not accepted. Please restart the process.');\n    }\n  }\n}\nfunction getParents(bundle, id) /*: Array<[ParcelRequire, string]> */{\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n  var parents = [];\n  var k, d, dep;\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || Array.isArray(dep) && dep[dep.length - 1] === id) {\n        parents.push([bundle, k]);\n      }\n    }\n  }\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n  return parents;\n}\nfunction updateLink(link) {\n  var href = link.getAttribute('href');\n  if (!href) {\n    return;\n  }\n  var newLink = link.cloneNode();\n  newLink.onload = function () {\n    if (link.parentNode !== null) {\n      // $FlowFixMe\n      link.parentNode.removeChild(link);\n    }\n  };\n  newLink.setAttribute('href',\n  // $FlowFixMe\n  href.split('?')[0] + '?' + Date.now());\n  // $FlowFixMe\n  link.parentNode.insertBefore(newLink, link.nextSibling);\n}\nvar cssTimeout = null;\nfunction reloadCSS() {\n  if (cssTimeout || typeof document === 'undefined') {\n    return;\n  }\n  cssTimeout = setTimeout(function () {\n    var links = document.querySelectorAll('link[rel=\"stylesheet\"]');\n    for (var i = 0; i < links.length; i++) {\n      // $FlowFixMe[incompatible-type]\n      var href /*: string */ = links[i].getAttribute('href');\n      var hostname = getHostname();\n      var servedFromHMRServer = hostname === 'localhost' ? new RegExp('^(https?:\\\\/\\\\/(0.0.0.0|127.0.0.1)|localhost):' + getPort()).test(href) : href.indexOf(hostname + ':' + getPort());\n      var absolute = /^https?:\\/\\//i.test(href) && href.indexOf(location.origin) !== 0 && !servedFromHMRServer;\n      if (!absolute) {\n        updateLink(links[i]);\n      }\n    }\n    cssTimeout = null;\n  }, 50);\n}\nfunction hmrDownload(asset) {\n  if (asset.type === 'js') {\n    if (typeof document !== 'undefined') {\n      let script = document.createElement('script');\n      script.src = asset.url + '?t=' + Date.now();\n      if (asset.outputFormat === 'esmodule') {\n        script.type = 'module';\n      }\n      return new Promise((resolve, reject) => {\n        var _document$head;\n        script.onload = () => resolve(script);\n        script.onerror = reject;\n        (_document$head = document.head) === null || _document$head === void 0 || _document$head.appendChild(script);\n      });\n    } else if (typeof importScripts === 'function') {\n      // Worker scripts\n      if (asset.outputFormat === 'esmodule') {\n        return __parcel__import__(asset.url + '?t=' + Date.now());\n      } else {\n        return new Promise((resolve, reject) => {\n          try {\n            __parcel__importScripts__(asset.url + '?t=' + Date.now());\n            resolve();\n          } catch (err) {\n            reject(err);\n          }\n        });\n      }\n    }\n  }\n}\nasync function hmrApplyUpdates(assets) {\n  global.parcelHotUpdate = Object.create(null);\n  let scriptsToRemove;\n  try {\n    // If sourceURL comments aren't supported in eval, we need to load\n    // the update from the dev server over HTTP so that stack traces\n    // are correct in errors/logs. This is much slower than eval, so\n    // we only do it if needed (currently just Safari).\n    // https://bugs.webkit.org/show_bug.cgi?id=137297\n    // This path is also taken if a CSP disallows eval.\n    if (!supportsSourceURL) {\n      let promises = assets.map(asset => {\n        var _hmrDownload;\n        return (_hmrDownload = hmrDownload(asset)) === null || _hmrDownload === void 0 ? void 0 : _hmrDownload.catch(err => {\n          // Web extension fix\n          if (extCtx && extCtx.runtime && extCtx.runtime.getManifest().manifest_version == 3 && typeof ServiceWorkerGlobalScope != 'undefined' && global instanceof ServiceWorkerGlobalScope) {\n            extCtx.runtime.reload();\n            return;\n          }\n          throw err;\n        });\n      });\n      scriptsToRemove = await Promise.all(promises);\n    }\n    assets.forEach(function (asset) {\n      hmrApply(module.bundle.root, asset);\n    });\n  } finally {\n    delete global.parcelHotUpdate;\n    if (scriptsToRemove) {\n      scriptsToRemove.forEach(script => {\n        if (script) {\n          var _document$head2;\n          (_document$head2 = document.head) === null || _document$head2 === void 0 || _document$head2.removeChild(script);\n        }\n      });\n    }\n  }\n}\nfunction hmrApply(bundle /*: ParcelRequire */, asset /*:  HMRAsset */) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (asset.type === 'css') {\n    reloadCSS();\n  } else if (asset.type === 'js') {\n    let deps = asset.depsByBundle[bundle.HMR_BUNDLE_ID];\n    if (deps) {\n      if (modules[asset.id]) {\n        // Remove dependencies that are removed and will become orphaned.\n        // This is necessary so that if the asset is added back again, the cache is gone, and we prevent a full page reload.\n        let oldDeps = modules[asset.id][1];\n        for (let dep in oldDeps) {\n          if (!deps[dep] || deps[dep] !== oldDeps[dep]) {\n            let id = oldDeps[dep];\n            let parents = getParents(module.bundle.root, id);\n            if (parents.length === 1) {\n              hmrDelete(module.bundle.root, id);\n            }\n          }\n        }\n      }\n      if (supportsSourceURL) {\n        // Global eval. We would use `new Function` here but browser\n        // support for source maps is better with eval.\n        (0, eval)(asset.output);\n      }\n\n      // $FlowFixMe\n      let fn = global.parcelHotUpdate[asset.id];\n      modules[asset.id] = [fn, deps];\n    }\n\n    // Always traverse to the parent bundle, even if we already replaced the asset in this bundle.\n    // This is required in case modules are duplicated. We need to ensure all instances have the updated code.\n    if (bundle.parent) {\n      hmrApply(bundle.parent, asset);\n    }\n  }\n}\nfunction hmrDelete(bundle, id) {\n  let modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (modules[id]) {\n    // Collect dependencies that will become orphaned when this module is deleted.\n    let deps = modules[id][1];\n    let orphans = [];\n    for (let dep in deps) {\n      let parents = getParents(module.bundle.root, deps[dep]);\n      if (parents.length === 1) {\n        orphans.push(deps[dep]);\n      }\n    }\n\n    // Delete the module. This must be done before deleting dependencies in case of circular dependencies.\n    delete modules[id];\n    delete bundle.cache[id];\n\n    // Now delete the orphans.\n    orphans.forEach(id => {\n      hmrDelete(module.bundle.root, id);\n    });\n  } else if (bundle.parent) {\n    hmrDelete(bundle.parent, id);\n  }\n}\nfunction hmrAcceptCheck(bundle /*: ParcelRequire */, id /*: string */, depsByBundle /*: ?{ [string]: { [string]: string } }*/) {\n  checkedAssets = {};\n  if (hmrAcceptCheckOne(bundle, id, depsByBundle)) {\n    return true;\n  }\n\n  // Traverse parents breadth first. All possible ancestries must accept the HMR update, or we'll reload.\n  let parents = getParents(module.bundle.root, id);\n  let accepted = false;\n  while (parents.length > 0) {\n    let v = parents.shift();\n    let a = hmrAcceptCheckOne(v[0], v[1], null);\n    if (a) {\n      // If this parent accepts, stop traversing upward, but still consider siblings.\n      accepted = true;\n    } else if (a !== null) {\n      // Otherwise, queue the parents in the next level upward.\n      let p = getParents(module.bundle.root, v[1]);\n      if (p.length === 0) {\n        // If there are no parents, then we've reached an entry without accepting. Reload.\n        accepted = false;\n        break;\n      }\n      parents.push(...p);\n    }\n  }\n  return accepted;\n}\nfunction hmrAcceptCheckOne(bundle /*: ParcelRequire */, id /*: string */, depsByBundle /*: ?{ [string]: { [string]: string } }*/) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n  if (depsByBundle && !depsByBundle[bundle.HMR_BUNDLE_ID]) {\n    // If we reached the root bundle without finding where the asset should go,\n    // there's nothing to do. Mark as \"accepted\" so we don't reload the page.\n    if (!bundle.parent) {\n      bundleNotFound = true;\n      return true;\n    }\n    return hmrAcceptCheckOne(bundle.parent, id, depsByBundle);\n  }\n  if (checkedAssets[id]) {\n    return null;\n  }\n  checkedAssets[id] = true;\n  var cached = bundle.cache[id];\n  if (!cached) {\n    return true;\n  }\n  assetsToDispose.push([bundle, id]);\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    assetsToAccept.push([bundle, id]);\n    return true;\n  }\n  return false;\n}\nfunction hmrDisposeQueue() {\n  // Dispose all old assets.\n  for (let i = 0; i < assetsToDispose.length; i++) {\n    let id = assetsToDispose[i][1];\n    if (!disposedAssets[id]) {\n      hmrDispose(assetsToDispose[i][0], id);\n      disposedAssets[id] = true;\n    }\n  }\n  assetsToDispose = [];\n}\nfunction hmrDispose(bundle /*: ParcelRequire */, id /*: string */) {\n  var cached = bundle.cache[id];\n  bundle.hotData[id] = {};\n  if (cached && cached.hot) {\n    cached.hot.data = bundle.hotData[id];\n  }\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData[id]);\n    });\n  }\n  delete bundle.cache[id];\n}\nfunction hmrAccept(bundle /*: ParcelRequire */, id /*: string */) {\n  // Execute the module.\n  bundle(id);\n\n  // Run the accept callbacks in the new version of the module.\n  var cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    let assetsToAlsoAccept = [];\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      let additionalAssets = cb(function () {\n        return getParents(module.bundle.root, id);\n      });\n      if (Array.isArray(additionalAssets) && additionalAssets.length) {\n        assetsToAlsoAccept.push(...additionalAssets);\n      }\n    });\n    if (assetsToAlsoAccept.length) {\n      let handled = assetsToAlsoAccept.every(function (a) {\n        return hmrAcceptCheck(a[0], a[1]);\n      });\n      if (!handled) {\n        return fullReload();\n      }\n      hmrDisposeQueue();\n    }\n  }\n}","/**\n * by bitbof (bitbof.com)\n */\n\nimport './polyfills/polyfills';\nimport { KlApp } from './app/kl-app';\nimport { TDeserializedKlStorageProject, TKlProject } from './klecks/kl-types';\nimport { initLANG, LANG } from './language/language';\nimport '../script/theme/theme';\nimport {\n    getKlIndexedDbName,\n    KL_INDEXED_DB,\n    KL_INDEXED_DB_STORES,\n    KL_INDEXED_DB_UPGRADER,\n    KL_INDEXED_DB_VERSION,\n} from './klecks/storage/kl-indexed-db';\nimport { KlRecoveryManager } from './klecks/storage/kl-recovery-manager';\n\nfunction showInitError(e: Error): void {\n    const el = document.createElement('div');\n    el.style.textAlign = 'center';\n    el.style.background = '#fff';\n    el.style.padding = '20px';\n    el.innerHTML = '<h1>App failed to initialize</h1>';\n    const errorMsg = document.createElement('div');\n    errorMsg.textContent = 'Error: ' + (e.message ? e.message : '' + e);\n    el.append(errorMsg);\n    document.body.append(el);\n    console.error(e);\n}\n\n(async () => {\n    try {\n        const outQueue: string[] = [];\n        await initLANG();\n\n        KL_INDEXED_DB.init(\n            getKlIndexedDbName(),\n            KL_INDEXED_DB_STORES,\n            KL_INDEXED_DB_VERSION,\n            KL_INDEXED_DB_UPGRADER,\n        );\n        if (!(await KL_INDEXED_DB.testConnection())) {\n            outQueue.push(LANG('file-storage-cant-access'));\n        }\n\n        const klRecoveryManager: KlRecoveryManager | undefined = KL_INDEXED_DB.getIsAvailable()\n            ? new KlRecoveryManager({})\n            : undefined;\n        let project: TKlProject | undefined = undefined;\n        try {\n            const readResult: TDeserializedKlStorageProject | undefined = klRecoveryManager\n                ? await klRecoveryManager.getRecovery()\n                : undefined;\n            if (readResult) {\n                project = readResult.project;\n                outQueue.push(LANG('tab-recovery-recovered'));\n            }\n        } catch (e) {\n            setTimeout(() => {\n                throw e;\n            });\n            outQueue.push(LANG('tab-recovery-failed-to-recover'));\n        }\n\n        // in case an extension manipulated the page\n        const loadingScreenEl = document.getElementById('loading-screen');\n        loadingScreenEl?.remove();\n\n        const klApp = new KlApp({ project, klRecoveryManager });\n        document.body.append(klApp.getElement());\n\n        setTimeout(() => {\n            outQueue.forEach((msg) => {\n                klApp.out(msg);\n            });\n        }, 100);\n    } catch (e) {\n        showInitError(e as Error);\n    }\n})();\n","import './polyfills-nomodule';\n\n/*\n * ---- Below ----------------------\n * features that didn't have support until *after* browsers supported the modules script tag:\n * Chrome 61\n * Edge 16\n * Safari 11\n * Firefox 60\n * https://caniuse.com/es6-module\n */\n\n// chrome 61, edge 79, safari 16, firefox 107\nif (!('scrollTo' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollTo', {\n        value: function (x: number, y: number) {\n            this.scrollLeft = x;\n            this.scrollTop = y;\n        },\n    });\n}\n\n// chrome 61, edge 79, safari 16, firefox 107\nif (!('scrollBy' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollBy', {\n        value: function (x: number, y: number) {\n            this.scrollLeft += x;\n            this.scrollTop += y;\n        },\n    });\n}\n\n// chrome 69, edge 79, safari 12, firefox 62\nif (!Array.prototype.flat) {\n    Object.defineProperty(Array.prototype, 'flat', {\n        configurable: true,\n        value: function flat(...args: any[]) {\n            const depth = isNaN(args[0]) ? 1 : Number(args[0]);\n\n            return depth\n                ? Array.prototype.reduce.call(\n                      this,\n                      function (acc: any, cur) {\n                          if (Array.isArray(cur)) {\n                              // eslint-disable-next-line prefer-spread\n                              acc.push.apply(acc, flat.call(cur, depth - 1));\n                          } else {\n                              acc.push(cur);\n                          }\n\n                          return acc;\n                      },\n                      [],\n                  )\n                : Array.prototype.slice.call(this);\n        },\n        writable: true,\n    });\n}\n\n// chrome 69, edge 79, safari 12, firefox 62\nif (!Array.prototype.flatMap) {\n    Object.defineProperty(Array.prototype, 'flatMap', {\n        configurable: true,\n        writable: true,\n        value: function (\n            callback: (value: any, index: number, array: any[]) => any,\n            thisArg?: any,\n        ) {\n            if (typeof callback !== 'function') {\n                throw new TypeError(callback + ' is not a function');\n            }\n            const result: any[] = [];\n            for (let i = 0; i < this.length; i++) {\n                if (i in this) {\n                    const mapped = callback.call(thisArg, this[i], i, this);\n                    if (Array.isArray(mapped)) {\n                        result.push(...mapped);\n                    } else {\n                        result.push(mapped);\n                    }\n                }\n            }\n            return result;\n        },\n    });\n}\n\n// Chrome 85, Firefox 77, Safari 13.1\n// if there are problems, maybe use core-js\nif (!String.prototype.replaceAll) {\n    Object.defineProperty(String.prototype, 'replaceAll', {\n        value: function (searchValue: string | RegExp, replaceValue: string): string {\n            if (typeof replaceValue === 'function') {\n                throw new Error('replaceAll polyfill does not support replaceValue: function');\n            }\n            return this.replace(new RegExp(searchValue, 'g'), replaceValue);\n        },\n    });\n}\n\n// Chrome 92, Firefox 90, Safari 15.4\nif (!('at' in Array.prototype)) {\n    Object.defineProperty(Array.prototype, 'at', {\n        value: function (index: number) {\n            if (index > 0) {\n                return this[index];\n            }\n            if (index < 0) {\n                return this[index + this.length];\n            }\n        },\n    });\n}\n\n/*\n    Copyright 2018  Alfredo Mungo <alfredo.mungo@protonmail.ch>\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to\n    deal in the Software without restriction, including without limitation the\n    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n    sell copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in\n    all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n    IN THE SOFTWARE.\n*/\nif (!Object.fromEntries) {\n    Object.defineProperty(Object, 'fromEntries', {\n        value(entries: any) {\n            if (!entries || !entries[Symbol.iterator]) {\n                throw new Error('Object.fromEntries() requires a single iterable argument');\n            }\n            const o: any = {};\n            Object.keys(entries).forEach((key) => {\n                const [k, v] = entries[key];\n                o[k] = v;\n            });\n            return o;\n        },\n    });\n}\n\n// sometimes Android WebView has no localStorage\nif (!('localStorage' in window)) {\n    try {\n        (window as any).localStorage = {\n            getItem: () => null,\n            setItem: () => {},\n            removeItem: () => {},\n        };\n    } catch (e) {\n        // maybe it fails?\n    }\n}\n","/**\n * features that were available before module script tags:\n * chrome 61\n * edge 16\n * safari 11\n * firefox 60\n * https://caniuse.com/es6-module\n */\n\nimport 'mdn-polyfills/Node.prototype.append';\nimport 'mdn-polyfills/Node.prototype.prepend'; // edge 17 (one version after module)\nimport 'mdn-polyfills/String.prototype.padStart';\nimport 'mdn-polyfills/Array.prototype.findIndex';\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","Array.prototype.findIndex||Object.defineProperty(Array.prototype,\"findIndex\",{value:function(r){if(null==this)throw new TypeError('\"this\" is null or not defined');var e=Object(this),t=e.length>>>0;if(\"function\"!=typeof r)throw new TypeError(\"predicate must be a function\");for(var n=arguments[1],o=0;o<t;){var i=e[o];if(r.call(n,i,o,e))return o;o++}return-1}});\n","import { KL } from '../klecks/kl';\nimport { BB } from '../bb/bb';\nimport { showIframeModal } from '../klecks/ui/modals/show-iframe-modal';\nimport { EmbedToolspaceTopRow } from '../embed/embed-toolspace-top-row';\nimport {\n    TBrushUiInstance,\n    TDeserializedKlStorageProject,\n    TDrawEvent,\n    TExportType,\n    TGradient,\n    TKlProject,\n    TRgb,\n    TUiLayout,\n} from '../klecks/kl-types';\nimport { importFilters } from '../klecks/filters/filters-lazy';\nimport { klCanvasToPsdBlob } from '../klecks/storage/kl-canvas-to-psd-blob';\nimport { ProjectStore } from '../klecks/storage/project-store';\nimport { SaveReminder } from '../klecks/ui/components/save-reminder';\nimport { KlCanvas, TKlCanvasLayer } from '../klecks/canvas/kl-canvas';\nimport { LANG } from '../language/language';\nimport { LocalStorage } from '../bb/base/local-storage';\nimport { LineSmoothing } from '../klecks/events/line-smoothing';\nimport { LineSanitizer } from '../klecks/events/line-sanitizer';\nimport { TabRow } from '../klecks/ui/components/tab-row';\nimport { LayerPreview } from '../klecks/ui/components/layer-preview';\nimport { KlColorSlider } from '../klecks/ui/components/kl-color-slider';\nimport { ToolspaceToolRow } from '../klecks/ui/components/toolspace-tool-row';\nimport { StatusOverlay } from '../klecks/ui/components/status-overlay';\nimport { SaveToComputer } from '../klecks/storage/save-to-computer';\nimport { ToolspaceScroller } from '../klecks/ui/components/toolspace-scroller';\nimport { translateSmoothing } from '../klecks/utils/translate-smoothing';\nimport { KlAppImportHandler } from './kl-app-import-handler';\nimport toolPaintImg from 'url:/src/app/img/ui/tool-paint.svg';\nimport toolHandImg from 'url:/src/app/img/ui/tool-hand.svg';\nimport toolFillImg from 'url:/src/app/img/ui/tool-fill.svg';\nimport toolGradientImg from 'url:/src/app/img/ui/tool-gradient.svg';\nimport toolTextImg from 'url:/src/app/img/ui/tool-text.svg';\nimport toolShapeImg from 'url:/src/app/img/ui/tool-shape.svg';\nimport toolSelectImg from 'url:/src/app/img/ui/tool-select.svg';\nimport tabSettingsImg from 'url:/src/app/img/ui/tab-settings.svg';\nimport tabLayersImg from 'url:/src/app/img/ui/tab-layers.svg';\nimport tabEditImg from 'url:/src/app/img/ui/tab-edit.svg';\nimport { LayersUi } from '../klecks/ui/tool-tabs/layers-ui/layers-ui';\nimport { TVector2D } from '../bb/bb-types';\nimport { createConsoleApi } from './console-api';\nimport { KL_CONFIG } from '../klecks/kl-config';\nimport { TRenderTextParam } from '../klecks/image-operations/render-text';\nimport { Easel } from '../klecks/ui/easel/easel';\nimport { EaselHand } from '../klecks/ui/easel/tools/easel-hand';\nimport { EaselBrush } from '../klecks/ui/easel/tools/easel-brush';\nimport { EaselProjectUpdater } from '../klecks/ui/easel/easel-project-updater';\nimport { zoomByStep } from '../klecks/ui/project-viewport/utils/zoom-by-step';\nimport { EaselEyedropper } from '../klecks/ui/easel/tools/easel-eyedropper';\nimport { EaselPaintBucket } from '../klecks/ui/easel/tools/easel-paint-bucket';\nimport { EaselGradient } from '../klecks/ui/easel/tools/easel-gradient';\nimport { EaselText } from '../klecks/ui/easel/tools/easel-text';\nimport { EaselShape } from '../klecks/ui/easel/tools/easel-shape';\nimport { EaselRotate } from '../klecks/ui/easel/tools/easel-rotate';\nimport { EaselZoom } from '../klecks/ui/easel/tools/easel-zoom';\nimport { KlAppSelect } from './kl-app-select';\nimport { KlTempHistory } from '../klecks/history/kl-temp-history';\nimport { PinchZoomWatcher } from '../klecks/ui/components/pinch-zoom-watcher';\nimport { EASEL_MAX_SCALE, EASEL_MIN_SCALE } from '../klecks/ui/easel/easel.config';\nimport { THistoryEntryDataComposed } from '../klecks/history/history.types';\nimport { KlHistoryExecutor, THistoryExecutionType } from '../klecks/history/kl-history-executor';\nimport { KlHistory } from '../klecks/history/kl-history';\nimport { isHistoryEntryActiveLayerChange } from '../klecks/history/push-helpers/is-history-entry-active-layer-change';\nimport { MobileUi } from '../klecks/ui/mobile/mobile-ui';\nimport { MobileBrushUi } from '../klecks/ui/mobile/mobile-brush-ui';\nimport { canvasToBlob } from '../bb/base/canvas';\nimport { projectToComposed } from '../klecks/history/push-helpers/project-to-composed';\nimport { ERASE_COLOR } from '../klecks/brushes/erase-color';\nimport { KlRecoveryManager } from '../klecks/storage/kl-recovery-manager';\nimport { drawProject } from '../klecks/canvas/draw-project';\nimport { css, randomUuid, sleep } from '../bb/base/base';\nimport { UnloadWarningTrigger } from '../klecks/ui/components/unload-warning-trigger';\nimport { KL_INDEXED_DB } from '../klecks/storage/kl-indexed-db';\nimport { showModal } from '../klecks/ui/modals/base/showModal';\nimport { runBrowserStorageBanner } from '../klecks/ui/components/browser-storage-banner';\nimport { requestPersistentStorage } from '../klecks/storage/request-persistent-storage';\nimport { CrossTabChannel } from '../bb/base/cross-tab-channel';\nimport { MobileColorUi } from '../klecks/ui/mobile/mobile-color-ui';\nimport { getSelectionPath2d } from '../bb/multi-polygon/get-selection-path-2d';\n\nimportFilters();\n\ntype TKlAppOptionsEmbed = {\n    url: string;\n    enableImageDropperImport?: boolean; // default false\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\n};\n\nexport type TKlAppParams = {\n    project?: TKlProject;\n    logoImg?: string; // app logo\n    bottomBar?: HTMLElement; // row at bottom of toolspace\n    embed?: TKlAppOptionsEmbed;\n    app?: {\n        imgurKey?: string; // for imgur uploads\n    };\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\n    klRecoveryManager?: KlRecoveryManager; // undefined if IndexedDB fails connecting\n};\n\ntype TKlAppToolId =\n    | 'hand'\n    | 'brush'\n    | 'select'\n    | 'eyedropper'\n    | 'paintBucket'\n    | 'gradient'\n    | 'text'\n    | 'shape'\n    | 'rotate'\n    | 'zoom';\n\nexport class KlApp {\n    private readonly rootEl: HTMLElement;\n    private uiWidth: number;\n    private uiHeight: number;\n    private readonly layerPreview: LayerPreview;\n    private readonly klColorSlider: KlColorSlider;\n    private readonly toolspaceToolRow: ToolspaceToolRow;\n    private readonly statusOverlay: StatusOverlay;\n    private readonly klCanvas: KlCanvas;\n    private uiLayout: TUiLayout;\n    private readonly embed: undefined | TKlAppOptionsEmbed;\n    private readonly saveToComputer: SaveToComputer;\n    private readonly lineSanitizer: LineSanitizer;\n    private readonly easel: Easel<TKlAppToolId>;\n    private readonly easelProjectUpdater: EaselProjectUpdater<TKlAppToolId>;\n    private readonly easelBrush: EaselBrush;\n    private readonly collapseThreshold: number = 820;\n    private readonly mobileUi: MobileUi;\n    private readonly mobileBrushUi: MobileBrushUi;\n    private readonly mobileColorUi: MobileColorUi;\n    private readonly toolspace: HTMLElement;\n    private readonly toolspaceInner: HTMLElement;\n    private readonly toolWidth: number = 271;\n    private readonly bottomBar: HTMLElement | undefined;\n    private readonly layersUi: LayersUi;\n    private readonly toolspaceScroller: ToolspaceScroller;\n    private readonly bottomBarWrapper: HTMLElement;\n    private readonly saveReminder: SaveReminder | undefined;\n    private readonly unloadWarningTrigger: UnloadWarningTrigger | undefined;\n    private lastSavedHistoryIndex: number = 0;\n    private readonly klHistory: KlHistory;\n\n    private updateLastSaved(): void {\n        this.lastSavedHistoryIndex = this.klHistory.getTotalIndex();\n        this.saveReminder?.reset();\n        this.unloadWarningTrigger?.update();\n    }\n\n    private updateCollapse(isInitial?: boolean): void {\n        if (isInitial) {\n            const isMobile = Boolean(LocalStorage.getItem('uiShowMobile') ?? false);\n            if (isMobile) {\n                this.mobileUi.setToolspaceIsOpen(false);\n            }\n        }\n        this.mobileUi.setOrientation(this.uiLayout);\n        if (this.uiWidth < this.collapseThreshold) {\n            this.mobileUi.setIsVisible(true);\n            if (this.mobileUi.getToolspaceIsOpen()) {\n                if (this.uiLayout === 'left') {\n                    css(this.easel.getElement(), {\n                        left: '271px',\n                    });\n                } else {\n                    css(this.easel.getElement(), {\n                        left: '0',\n                    });\n                }\n                this.toolspace.style.display = 'block';\n                this.easel.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\n                this.statusOverlay.setWide(false);\n            } else {\n                if (this.uiLayout === 'left') {\n                    css(this.easel.getElement(), {\n                        left: '0',\n                    });\n                } else {\n                    css(this.easel.getElement(), {\n                        left: '0',\n                    });\n                }\n                this.toolspace.style.display = 'none';\n                this.easel.setSize(Math.max(0, this.uiWidth), this.uiHeight);\n                this.statusOverlay.setWide(true);\n            }\n        } else {\n            this.mobileColorUi.closeColorPicker();\n            this.mobileUi.setIsVisible(false);\n            if (this.uiLayout === 'left') {\n                css(this.easel.getElement(), {\n                    left: '271px',\n                });\n            }\n            this.toolspace.style.display = 'block';\n            this.easel.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\n            this.statusOverlay.setWide(false);\n        }\n        this.mobileUi.update();\n    }\n\n    private updateBottomBar(): void {\n        if (!this.bottomBar) {\n            return;\n        }\n        const isVisible = this.toolspaceInner.scrollHeight + 40 < window.innerHeight;\n        const newDisplay = isVisible ? '' : 'none';\n        // check to prevent infinite MutationObserver loop in Pale Moon\n        if (newDisplay !== this.bottomBarWrapper.style.display) {\n            this.bottomBarWrapper.style.display = newDisplay;\n        }\n    }\n\n    private updateUi(): void {\n        this.toolspace.classList.toggle('kl-toolspace--left', this.uiLayout === 'left');\n        this.toolspace.classList.toggle('kl-toolspace--right', this.uiLayout === 'right');\n        if (this.uiLayout === 'left') {\n            css(this.toolspace, {\n                left: '0',\n                right: '',\n            });\n            css(this.easel.getElement(), {\n                left: '271px',\n            });\n        } else {\n            css(this.toolspace, {\n                left: '',\n                right: '0',\n            });\n            css(this.easel.getElement(), {\n                left: '0',\n            });\n        }\n        this.statusOverlay.setUiState(this.uiLayout);\n        this.layerPreview.setUiState(this.uiLayout);\n        this.layersUi.setUiState(this.uiLayout);\n        this.updateCollapse();\n        this.toolspaceScroller.updateUiState(this.uiLayout);\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: TKlAppParams) {\n        this.embed = p.embed;\n        // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\n        // but not larger than 4096 - a fairly arbitrary decision\n        const maxCanvasSize = Math.min(\n            4096,\n            Math.max(2048, Math.max(window.screen.width, window.screen.height)),\n        );\n        this.uiLayout = (\n            this.embed\n                ? 'left'\n                : LocalStorage.getItem('uiState')\n                  ? LocalStorage.getItem('uiState')\n                  : 'right'\n        ) as TUiLayout;\n        const projectStore = KL_INDEXED_DB.getIsAvailable() ? new ProjectStore() : undefined;\n        this.rootEl = BB.el({\n            className: 'g-root',\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                right: '0',\n                bottom: '0',\n            },\n        });\n\n        this.uiWidth = Math.max(0, window.innerWidth);\n        this.uiHeight = Math.max(0, window.innerHeight);\n        let exportType: TExportType = 'png';\n\n        const initialWidth = Math.max(\n            10,\n            Math.min(\n                maxCanvasSize,\n                window.innerWidth < this.collapseThreshold\n                    ? this.uiWidth\n                    : this.uiWidth - this.toolWidth,\n            ),\n        );\n        const initialHeight = Math.max(10, Math.min(maxCanvasSize, this.uiHeight));\n\n        this.klHistory = new KlHistory({\n            oldest: projectToComposed(\n                p.project ?? {\n                    projectId: randomUuid(),\n                    width: initialWidth,\n                    height: initialHeight,\n                    layers: [\n                        {\n                            name: LANG('layers-layer') + ' 1', // not ideal\n                            opacity: 1,\n                            isVisible: true,\n                            mixModeStr: 'source-over',\n                            image: {\n                                fill: BB.ColorConverter.toRgbStr({\n                                    r: ERASE_COLOR,\n                                    g: ERASE_COLOR,\n                                    b: ERASE_COLOR,\n                                }),\n                            },\n                        },\n                    ],\n                },\n            ),\n        });\n        const klRecoveryManager = p.klRecoveryManager;\n        if (klRecoveryManager) {\n            klRecoveryManager.setKlHistory(this.klHistory);\n            klRecoveryManager.setGetThumbnail((factor) => {\n                return drawProject(this.klCanvas.getProject(), factor);\n            });\n        }\n        if (p.project) {\n            // attempt at freeing memory\n            p.project.layers.forEach((layer) => {\n                if (layer.image instanceof HTMLCanvasElement) {\n                    BB.freeCanvas(layer.image);\n                }\n                layer.image = null as any;\n            });\n        }\n\n        this.klCanvas = new KL.KlCanvas(this.klHistory, this.embed ? -1 : 1);\n        const tempHistory = new KlTempHistory();\n        let mainTabRow: TabRow | undefined = undefined;\n\n        const clearLayer = (showStatus?: boolean, ignoreSelection?: boolean) => {\n            applyUncommitted();\n            const layerIndex = currentLayer.index;\n            this.klCanvas.eraseLayer({\n                layerIndex,\n                useAlphaLock: layerIndex === 0 && !brushUiMap.eraserBrush.getIsTransparentBg(),\n                useSelection: !ignoreSelection,\n            });\n            showStatus &&\n                this.statusOverlay.out(\n                    this.klCanvas.getSelection()\n                        ? LANG('cleared-selected-area')\n                        : LANG('cleared-layer'),\n                    true,\n                );\n        };\n\n        let currentColor = new BB.RGB(0, 0, 0);\n        let currentBrushUi: TBrushUiInstance<any>;\n        let currentBrushId: string;\n        let lastNonEraserBrushId: string;\n        let currentLayer: TKlCanvasLayer = this.klCanvas.getLayer(\n            this.klCanvas.getLayerCount() - 1,\n        );\n\n        // when cycling through brushes you need to know the next non-eraser brush\n        const getNextBrushId = (): string => {\n            if (currentBrushId === 'eraserBrush') {\n                return lastNonEraserBrushId;\n            }\n            const keyArr = Object.keys(brushUiMap).filter((item) => item !== 'eraserBrush');\n            const i = keyArr.findIndex((item) => item === currentBrushId);\n            return keyArr[(i + 1) % keyArr.length];\n        };\n\n        const sizeWatcher = (val: number) => {\n            brushSettingService.emitSize(val);\n            if (this.easelBrush) {\n                this.easelBrush.setBrush({ radius: val });\n            }\n        };\n\n        const brushSettingService = new KL.BrushSettingService({\n            onSetColor: (color) => {\n                this.klColorSlider.setColor(color);\n                currentBrushUi.setColor(color);\n                this.mobileColorUi.setColor(color);\n                currentColor = BB.copyObj(color);\n            },\n            onSetSize: (size) => {\n                currentBrushUi.setSize(size);\n                this.easelBrush.setBrush({ radius: size });\n            },\n            onSetOpacity: (opacity) => {\n                currentBrushUi.setOpacity(opacity);\n            },\n            onSetScatter: (scatter) => {\n                currentBrushUi.setScatter(scatter);\n            },\n            onGetColor: () => this.klColorSlider.getColor(),\n            onGetSize: () => brushUiMap[currentBrushId].getSize(),\n            onGetOpacity: () => brushUiMap[currentBrushId].getOpacity(),\n            onGetScatter: () => brushUiMap[currentBrushId].getScatter(),\n            onGetSliderConfig: () => {\n                return {\n                    sizeSlider: KL.BRUSHES_UI[currentBrushId].sizeSlider,\n                    opacitySlider: KL.BRUSHES_UI[currentBrushId].opacitySlider,\n                    scatterSlider: KL.BRUSHES_UI[currentBrushId].scatterSlider,\n                };\n            },\n        });\n\n        const lineSmoothing = new LineSmoothing({\n            smoothing: translateSmoothing(1),\n        });\n        this.lineSanitizer = new LineSanitizer();\n\n        const drawEventChain = new BB.EventChain({\n            chainArr: [this.lineSanitizer as any, lineSmoothing as any],\n        });\n\n        drawEventChain.setChainOut(((event: TDrawEvent) => {\n            if (event.type === 'down') {\n                this.toolspace.style.pointerEvents = 'none';\n                currentBrushUi.startLine(event.x, event.y, event.pressure);\n                this.easelBrush.setLastDrawEvent({ x: event.x, y: event.y });\n                this.easel.requestRender();\n            }\n            if (event.type === 'move') {\n                currentBrushUi.goLine(event.x, event.y, event.pressure, event.isCoalesced);\n                this.easelBrush.setLastDrawEvent({ x: event.x, y: event.y });\n                this.easel.requestRender();\n            }\n            if (event.type === 'up') {\n                this.toolspace.style.pointerEvents = '';\n                currentBrushUi.endLine();\n                this.easel.requestRender();\n            }\n            if (event.type === 'line') {\n                currentBrushUi.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\n                this.easelBrush.setLastDrawEvent({ x: event.x1, y: event.y1 });\n                this.easel.requestRender();\n            }\n        }) as any);\n\n        let textToolSettings = {\n            size: 20,\n            align: 'left' as 'left' | 'center' | 'right',\n            isBold: false,\n            isItalic: false,\n            font: 'sans-serif',\n            letterSpacing: 0,\n            lineHeight: 1,\n            fill: {\n                color: { r: 0, g: 0, b: 0, a: 1 },\n            },\n        } as TRenderTextParam;\n\n        /**\n         * Uncommited action is something like select tool > transform which puts the canvas and UI into\n         * a temporary state. Changes need to be committed or discarded *before* doing something else.\n         *\n         * returns true if something was applied\n         */\n        const applyUncommitted = (): boolean => {\n            let didApply = false;\n            if (this.easel.getTool() === 'select') {\n                didApply = klAppSelect.commitTransform();\n            }\n            return didApply;\n        };\n\n        /** see applyUncommitted **/\n        const discardUncommitted = (): boolean => {\n            if (this.easel.getTool() === 'select') {\n                return klAppSelect.discardTransform();\n            }\n            return false;\n        };\n\n        const propagateUndoRedoChanges = (\n            type: THistoryExecutionType,\n            composedBefore: THistoryEntryDataComposed,\n        ) => {\n            if (['undo', 'redo'].includes(type)) {\n                const composedAfter = this.klHistory.getComposed();\n\n                this.klCanvas.updateViaComposed(composedBefore!, composedAfter);\n\n                setCurrentLayer(\n                    this.klCanvas.getLayer(\n                        composedAfter.layerMap[composedAfter.activeLayerId].index,\n                    ),\n                );\n                this.easelProjectUpdater.update(); // triggers render\n\n                const dimensionChanged =\n                    composedBefore.size.width !== composedAfter.size.width ||\n                    composedBefore.size.height !== composedAfter.size.height;\n                if (dimensionChanged) {\n                    this.easel.resetOrFitTransform(true);\n                }\n                this.easelBrush.setLastDrawEvent();\n                this.layersUi.update(currentLayer.index);\n            }\n\n            klAppSelect.onHistory(type);\n        };\n\n        const undo = (showMessage?: boolean) => {\n            if (!tempHistory.canDecreaseIndex()) {\n                discardUncommitted();\n            }\n            const composedBefore = this.klHistory.getComposed();\n            const result = klHistoryExecutor.undo();\n            if (!result) {\n                // didn't do anything\n                return;\n            }\n            propagateUndoRedoChanges(result.type, composedBefore);\n            if (showMessage) {\n                this.statusOverlay.out(LANG('undo'), true);\n            }\n        };\n\n        const redo = (showMessage?: boolean) => {\n            const composedBefore = this.klHistory.getComposed();\n            const result = klHistoryExecutor.redo();\n            if (!result) {\n                // didn't do anything\n                return;\n            }\n            propagateUndoRedoChanges(result.type, composedBefore);\n            if (showMessage) {\n                this.statusOverlay.out(LANG('redo'), true);\n            }\n        };\n\n        this.statusOverlay = new KL.StatusOverlay();\n\n        const klAppSelect = new KlAppSelect({\n            klCanvas: this.klCanvas,\n            getCurrentLayerCtx: () => currentLayer.context,\n            onUpdateProject: () => this.easelProjectUpdater.update(),\n            klHistory: this.klHistory,\n            tempHistory,\n            statusOverlay: this.statusOverlay,\n            onFill: () => {\n                this.klCanvas.layerFill(\n                    currentLayer.index,\n                    this.klColorSlider.getColor(),\n                    undefined,\n                    true,\n                );\n                this.statusOverlay.out(\n                    this.klCanvas.getSelection() ? LANG('filled-selected-area') : LANG('filled'),\n                    true,\n                );\n            },\n            onErase: () => {\n                const layerIndex = currentLayer.index;\n                this.klCanvas.eraseLayer({\n                    layerIndex,\n                    useAlphaLock: layerIndex === 0 && !brushUiMap.eraserBrush.getIsTransparentBg(),\n                    useSelection: true,\n                });\n                this.statusOverlay.out(\n                    this.klCanvas.getSelection()\n                        ? LANG('cleared-selected-area')\n                        : LANG('cleared-layer'),\n                    true,\n                );\n            },\n        });\n\n        this.easelBrush = new EaselBrush({\n            radius: 5,\n            onLineStart: (e) => {\n                // expects TDrawEvent\n                drawEventChain.chainIn({\n                    type: 'down',\n                    scale: this.easel.getTransform().scale,\n                    shiftIsPressed: keyListener.isPressed('shift'),\n                    pressure: e.pressure,\n                    isCoalesced: e.isCoalesced,\n                    x: e.x,\n                    y: e.y,\n                } as any);\n            },\n            onLineGo: (e) => {\n                // expects TDrawEvent\n                drawEventChain.chainIn({\n                    type: 'move',\n                    scale: this.easel.getTransform().scale,\n                    shiftIsPressed: keyListener.isPressed('shift'),\n                    pressure: e.pressure,\n                    isCoalesced: e.isCoalesced,\n                    x: e.x,\n                    y: e.y,\n                } as any);\n            },\n            onLineEnd: () => {\n                // expects TDrawEvent\n                drawEventChain.chainIn({\n                    type: 'up',\n                    scale: this.easel.getTransform().scale,\n                    shiftIsPressed: keyListener.isPressed('shift'),\n                    isCoalesced: false,\n                } as any);\n            },\n            onLine: (p1, p2) => {\n                // expects TDrawEvent\n                drawEventChain.chainIn({\n                    type: 'line',\n                    x0: p1.x,\n                    y0: p1.y,\n                    x1: p2.x,\n                    y1: p2.y,\n                    pressure0: 1,\n                    pressure1: 1,\n                } as any);\n            },\n        });\n\n        const easelHand = new EaselHand({});\n        const easelShape = new EaselShape({\n            onDown: (p, angleRad) => {\n                shapeTool.onDown(p.x, p.y, angleRad);\n            },\n            onMove: (p) => {\n                shapeTool.onMove(p.x, p.y);\n            },\n            onUp: (p) => {\n                shapeTool.onUp(p.x, p.y);\n            },\n        });\n\n        let isFirstTransform = true;\n        this.easel = new Easel({\n            width: Math.max(0, this.uiWidth - this.toolWidth),\n            height: this.uiHeight,\n            project: {\n                width: this.klCanvas.getWidth(),\n                height: this.klCanvas.getHeight(),\n                layers: [],\n            }, // temp\n            tools: {\n                brush: this.easelBrush,\n                hand: easelHand,\n                select: klAppSelect.getEaselSelect(),\n                eyedropper: new EaselEyedropper({\n                    onPick: (p) => {\n                        const color = this.klCanvas.getColorAt(p.x, p.y);\n                        brushSettingService.setColor(color);\n                        return color;\n                    },\n                    onPickEnd: () => {\n                        if (\n                            this.klColorSlider.getIsEyedropping() ||\n                            this.mobileColorUi.getIsEyedropping()\n                        ) {\n                            this.klColorSlider.setIsEyedropping(false);\n                            this.mobileColorUi.setIsEyedropping(false);\n                            this.easel.setTool(this.toolspaceToolRow.getActive());\n                        }\n                    },\n                }),\n                paintBucket: new EaselPaintBucket({\n                    onFill: (p) => {\n                        this.klCanvas.floodFill(\n                            currentLayer.index,\n                            p.x,\n                            p.y,\n                            fillUi.getIsEraser() ? null : this.klColorSlider.getColor(),\n                            fillUi.getOpacity(),\n                            fillUi.getTolerance(),\n                            fillUi.getSample(),\n                            fillUi.getGrow(),\n                            fillUi.getContiguous(),\n                        );\n                        this.easel.requestRender();\n                    },\n                }),\n                gradient: new EaselGradient({\n                    onDown: (p, angleRad) => {\n                        gradientTool.onDown(p.x, p.y, angleRad);\n                    },\n                    onMove: (p) => {\n                        gradientTool.onMove(p.x, p.y);\n                    },\n                    onUp: (p) => {\n                        gradientTool.onUp(p.x, p.y);\n                    },\n                }),\n                text: new EaselText({\n                    onDown: (p, angleRad) => {\n                        if (KL.DIALOG_COUNTER.get() > 0) {\n                            return;\n                        }\n\n                        KL.textToolDialog({\n                            klCanvas: this.klCanvas,\n                            layerIndex: currentLayer.index,\n                            primaryColor: this.klColorSlider.getColor(),\n                            secondaryColor: this.klColorSlider.getSecondaryRGB(),\n\n                            text: {\n                                ...textToolSettings,\n                                text: '',\n                                x: p.x,\n                                y: p.y,\n                                angleRad: angleRad,\n                                fill: textToolSettings.fill\n                                    ? {\n                                          color: {\n                                              ...this.klColorSlider.getColor(),\n                                              a: textToolSettings.fill.color.a,\n                                          },\n                                      }\n                                    : undefined,\n                                stroke: textToolSettings.stroke\n                                    ? {\n                                          ...textToolSettings.stroke,\n                                          color: {\n                                              ...this.klColorSlider.getSecondaryRGB(),\n                                              a: textToolSettings.stroke.color.a,\n                                          },\n                                      }\n                                    : undefined,\n                            },\n\n                            onConfirm: (val) => {\n                                textToolSettings = {\n                                    ...val,\n                                    text: '',\n                                };\n                                this.klCanvas.text(currentLayer.index, val);\n                            },\n                        });\n                    },\n                }),\n                shape: easelShape,\n                rotate: new EaselRotate({}),\n                zoom: new EaselZoom({}),\n            },\n            tool: 'brush',\n            onChangeTool: (toolId) => {\n                this.mobileBrushUi.setIsVisible(toolId === 'brush');\n                this.mobileColorUi.setIsVisible(toolId !== 'select');\n            },\n            onTransformChange: (transform, isScaleOrAngleChanged) => {\n                handUi.update(transform.scale, transform.angleDeg);\n                this.toolspaceToolRow.setEnableZoomIn(transform.scale !== EASEL_MAX_SCALE);\n                this.toolspaceToolRow.setEnableZoomOut(transform.scale !== EASEL_MIN_SCALE);\n\n                if (isScaleOrAngleChanged && !isFirstTransform) {\n                    this.statusOverlay.out({\n                        type: 'transform',\n                        scale: transform.scale,\n                        angleDeg: transform.angleDeg,\n                    });\n                }\n                if (isFirstTransform) {\n                    isFirstTransform = false;\n                }\n            },\n            onUndo: () => {\n                undo(true);\n            },\n            onRedo: () => {\n                redo(true);\n            },\n        });\n        css(this.easel.getElement(), {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n        });\n        this.easelProjectUpdater = new EaselProjectUpdater({\n            klCanvas: this.klCanvas,\n            easel: this.easel,\n        });\n        this.klHistory.addListener(() => {\n            this.easelProjectUpdater.update();\n        });\n        KL.DIALOG_COUNTER.subscribe((count) => {\n            this.easel.setIsFrozen(count > 0);\n        });\n\n        const updateMainTabVisibility = () => {\n            if (!mainTabRow) {\n                return;\n            }\n\n            const toolObj = {\n                brush: {},\n                hand: {},\n                paintBucket: {},\n                gradient: {},\n                text: {},\n                shape: {},\n                select: {},\n            };\n\n            const activeStr = this.toolspaceToolRow.getActive();\n            const oldTabId = mainTabRow.getOpenedTabId();\n\n            const keysArr = Object.keys(toolObj);\n            for (let i = 0; i < keysArr.length; i++) {\n                if (activeStr === keysArr[i]) {\n                    mainTabRow.setIsVisible(keysArr[i], true);\n                } else {\n                    mainTabRow.setIsVisible(keysArr[i], false);\n                    if (oldTabId === keysArr[i]) {\n                        mainTabRow.open(activeStr);\n                    }\n                }\n            }\n        };\n\n        const keyListener = new BB.KeyListener({\n            onDown: (keyStr, event, comboStr) => {\n                if (KL.DIALOG_COUNTER.get() > 0 || BB.isInputFocused(true)) {\n                    return;\n                }\n\n                const isDrawing = this.lineSanitizer.getIsDrawing() || this.easel.getIsLocked();\n                if (isDrawing) {\n                    return;\n                }\n\n                if (comboStr === 'home') {\n                    this.easel.fitTransform();\n                }\n                if (comboStr === 'end') {\n                    this.easel.resetTransform();\n                }\n                if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\n                    event.preventDefault();\n                    undo();\n                }\n                if (\n                    ['ctrl+y', 'cmd+y'].includes(comboStr) ||\n                    ((BB.sameKeys('ctrl+shift+z', comboStr) ||\n                        BB.sameKeys('cmd+shift+z', comboStr)) &&\n                        keyStr === 'z')\n                ) {\n                    event.preventDefault();\n                    redo();\n                }\n                if (!this.embed) {\n                    if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\n                        event.preventDefault();\n                        applyUncommitted();\n                        this.saveToComputer.save();\n                    }\n                    if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\n                        event.preventDefault();\n                        applyUncommitted();\n                        if (projectStore) {\n                            (async () => {\n                                await requestPersistentStorage();\n\n                                const meta = projectStore!.getCurrentMeta();\n                                const project = this.getProject();\n\n                                if (meta && meta.projectId !== project.projectId) {\n                                    const doOverwrite = await new Promise<boolean>(\n                                        (resolve, reject) => {\n                                            showModal({\n                                                target: document.body,\n                                                type: 'warning',\n                                                message: LANG('file-storage-overwrite-confirm'),\n                                                buttons: [LANG('file-storage-overwrite'), 'Cancel'],\n                                                callback: async (result) => {\n                                                    if (result === 'Cancel') {\n                                                        resolve(false);\n                                                        return;\n                                                    }\n                                                    resolve(true);\n                                                },\n                                            });\n                                        },\n                                    );\n                                    if (!doOverwrite) {\n                                        return;\n                                    }\n                                }\n\n                                let success = true;\n                                try {\n                                    await projectStore!.store(this.klCanvas.getProject());\n                                } catch (e) {\n                                    success = false;\n                                    setTimeout(() => {\n                                        throw new Error(\n                                            'keyboard-shortcut: failed to store browser storage, ' +\n                                                e,\n                                        );\n                                    }, 0);\n                                    this.statusOverlay.out(\n                                        ' ' + LANG('file-storage-failed'),\n                                        true,\n                                    );\n                                }\n                                if (success) {\n                                    this.updateLastSaved();\n                                    this.statusOverlay.out(LANG('file-storage-stored'), true);\n                                }\n                            })();\n                        } else {\n                            this.statusOverlay.out(' ' + LANG('file-storage-failed'), true);\n                        }\n                    }\n                    if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\n                        event.preventDefault();\n                        applyUncommitted();\n                        copyToClipboard(true);\n                    }\n                }\n                if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\n                    event.preventDefault();\n                }\n\n                if (comboStr === 'sqbr_open') {\n                    currentBrushUi.decreaseSize(\n                        Math.max(0.005, 0.03 / this.easel.getTransform().scale),\n                    );\n                }\n                if (comboStr === 'sqbr_close') {\n                    currentBrushUi.increaseSize(\n                        Math.max(0.005, 0.03 / this.easel.getTransform().scale),\n                    );\n                }\n                if (comboStr === 'enter') {\n                    if (!applyUncommitted()) {\n                        this.klCanvas.layerFill(\n                            currentLayer.index,\n                            this.klColorSlider.getColor(),\n                            undefined,\n                            true,\n                        );\n                        this.statusOverlay.out(\n                            this.klCanvas.getSelection()\n                                ? LANG('filled-selected-area')\n                                : LANG('filled'),\n                            true,\n                        );\n                    }\n                }\n                if (comboStr === 'esc') {\n                    if (discardUncommitted()) {\n                        event.preventDefault();\n                    }\n                }\n                if (['delete', 'backspace'].includes(comboStr)) {\n                    clearLayer(true);\n                }\n                if (comboStr === 'shift+e') {\n                    event.preventDefault();\n                    currentBrushUi.toggleEraser?.();\n                } else if (comboStr === 'e') {\n                    event.preventDefault();\n                    applyUncommitted();\n                    this.easel.setTool('brush');\n                    this.toolspaceToolRow.setActive('brush');\n                    mainTabRow?.open('brush');\n                    updateMainTabVisibility();\n                    brushTabRow.open('eraserBrush');\n                }\n                if (comboStr === 'b') {\n                    event.preventDefault();\n                    applyUncommitted();\n                    const prevMode = this.easel.getTool();\n                    this.easel.setTool('brush');\n                    this.toolspaceToolRow.setActive('brush');\n                    mainTabRow?.open('brush');\n                    updateMainTabVisibility();\n                    brushTabRow.open(prevMode === 'brush' ? getNextBrushId() : currentBrushId);\n                }\n                if (comboStr === 'g') {\n                    event.preventDefault();\n                    applyUncommitted();\n                    const newMode =\n                        this.easel.getTool() === 'paintBucket' ? 'gradient' : 'paintBucket';\n                    this.easel.setTool(newMode);\n                    this.toolspaceToolRow.setActive(newMode);\n                    mainTabRow?.open(newMode);\n                    updateMainTabVisibility();\n                }\n                if (comboStr === 't') {\n                    event.preventDefault();\n                    applyUncommitted();\n                    this.easel.setTool('text');\n                    this.toolspaceToolRow.setActive('text');\n                    mainTabRow?.open('text');\n                    updateMainTabVisibility();\n                }\n                if (comboStr === 'u') {\n                    event.preventDefault();\n                    applyUncommitted();\n                    this.easel.setTool('shape');\n                    this.toolspaceToolRow.setActive('shape');\n                    mainTabRow?.open('shape');\n                    updateMainTabVisibility();\n                }\n                if (comboStr === 'l') {\n                    event.preventDefault();\n                    applyUncommitted();\n                    this.easel.setTool('select');\n                    this.toolspaceToolRow.setActive('select');\n                    mainTabRow?.open('select');\n                    updateMainTabVisibility();\n                }\n                if (comboStr === 'x') {\n                    event.preventDefault();\n                    this.klColorSlider.swapColors();\n                }\n            },\n            onUp: (keyStr, event) => {},\n        });\n\n        const brushUiMap: {\n            [key: string]: any;\n        } = {};\n        // create brush UIs\n        Object.entries(KL.BRUSHES_UI).forEach(([b, brushUi]) => {\n            const ui = new (brushUi.Ui as any)({\n                klHistory: this.klHistory,\n                onSizeChange: sizeWatcher,\n                onScatterChange: (scatter: number) => {\n                    brushSettingService.emitScatter(scatter);\n                },\n                onOpacityChange: (opacity: number) => {\n                    brushSettingService.emitOpacity(opacity);\n                },\n                onConfigChange: () => {\n                    brushSettingService.emitSliderConfig({\n                        sizeSlider: KL.BRUSHES_UI[currentBrushId].sizeSlider,\n                        opacitySlider: KL.BRUSHES_UI[currentBrushId].opacitySlider,\n                        scatterSlider: KL.BRUSHES_UI[currentBrushId].scatterSlider,\n                    });\n                },\n            });\n            brushUiMap[b] = ui;\n            ui.getElement().style.padding = 10 + 'px';\n        });\n\n        this.toolspace = BB.el({\n            className: 'kl-toolspace',\n            css: {\n                position: 'absolute',\n                right: '0',\n                top: '0',\n                bottom: '0',\n                width: this.toolWidth + 'px',\n                overflow: 'hidden',\n                userSelect: 'none',\n                touchAction: 'none',\n            },\n        });\n        this.toolspaceInner = BB.el({\n            parent: this.toolspace,\n        });\n        this.toolspace.oncontextmenu = () => {\n            return false;\n        };\n        this.toolspace.onclick = BB.handleClick;\n\n        this.mobileBrushUi = new MobileBrushUi({\n            onBrush: () => {\n                brushTabRow.open(lastNonEraserBrushId);\n            },\n            onEraser: () => {\n                brushTabRow.open('eraserBrush');\n            },\n        });\n        this.mobileColorUi = new MobileColorUi({\n            onEyedropper: (isActive) => {\n                if (isActive) {\n                    this.klColorSlider.setIsEyedropping(true);\n                    this.easel.setTool('eyedropper');\n                } else {\n                    this.klColorSlider.setIsEyedropping(false);\n                    this.easel.setTool(this.toolspaceToolRow.getActive());\n                }\n            },\n            color: currentColor,\n            onColorChange: (c) => {\n                brushSettingService.setColor(c);\n            },\n        });\n\n        this.mobileUi = new MobileUi({\n            onShowToolspace: (b) => {\n                this.mobileColorUi.closeColorPicker();\n                this.updateCollapse();\n            },\n            toolUis: [this.mobileBrushUi.getElement(), this.mobileColorUi.getElement()],\n        });\n\n        this.updateCollapse(true);\n\n        let overlayToolspace;\n        setTimeout(() => {\n            overlayToolspace = new KL.OverlayToolspace({\n                enabledTest: () => {\n                    return KL.DIALOG_COUNTER.get() === 0 && !this.easel.getIsLocked();\n                },\n                brushSettingService,\n            });\n            this.rootEl.append(overlayToolspace.getElement());\n        }, 0);\n\n        BB.append(this.rootEl, [\n            this.easel.getElement(),\n            // this.klCanvasWorkspace.getElement(),\n            this.toolspace,\n            this.mobileUi.getElement(),\n        ]);\n\n        let toolspaceTopRow;\n        if (this.embed) {\n            toolspaceTopRow = new EmbedToolspaceTopRow({\n                onHelp: () => {\n                    showIframeModal(this.embed!.url + '/help.html', !!this.embed);\n                },\n                onSubmit: () => {\n                    applyUncommitted();\n                    const onFailure = () => {\n                        let closeFunc: () => void;\n                        const saveBtn = BB.el({\n                            tagName: 'button',\n                            textContent: LANG('save-reminder-save-psd'),\n                            css: {\n                                display: 'block',\n                            },\n                        });\n                        saveBtn.onclick = () => {\n                            this.saveAsPsd();\n                            closeFunc();\n                        };\n                        KL.popup({\n                            target: this.rootEl,\n                            message: '<b>' + LANG('upload-failed') + '</b>',\n                            div: BB.el({\n                                content: [\n                                    BB.el({\n                                        content: LANG('backup-drawing'),\n                                        css: {\n                                            marginBottom: '10px',\n                                        },\n                                    }),\n                                    saveBtn,\n                                ],\n                            }),\n                            ignoreBackground: true,\n                            closeFunc: (f) => {\n                                closeFunc = f;\n                            },\n                        });\n                    };\n\n                    KL.popup({\n                        target: this.rootEl,\n                        message: LANG('submit-prompt'),\n                        buttons: [LANG('submit'), 'Cancel'],\n                        callback: async (result) => {\n                            if (result !== LANG('submit')) {\n                                return;\n                            }\n\n                            const overlay = BB.el({\n                                parent: this.rootEl,\n                                className: 'upload-overlay',\n                                content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\n                            });\n\n                            this.embed!.onSubmit(\n                                () => {\n                                    this.updateLastSaved();\n                                    overlay.remove();\n                                },\n                                () => {\n                                    overlay.remove();\n                                    onFailure();\n                                },\n                            );\n                        },\n                    });\n                },\n                onLeftRight: () => {\n                    this.uiLayout = this.uiLayout === 'left' ? 'right' : 'left';\n                    this.updateUi();\n                },\n            });\n        } else {\n            toolspaceTopRow = new KL.ToolspaceTopRow({\n                logoImg: p.logoImg!,\n                onLogo: () => {\n                    showIframeModal('./home/', !!this.embed);\n                },\n                onNew: () => {\n                    showNewImageDialog();\n                },\n                onImport: () => {\n                    fileUi!.triggerImport();\n                },\n                onSave: () => {\n                    this.saveToComputer.save();\n                },\n                onShare: () => {\n                    shareImage();\n                },\n                onHelp: () => {\n                    showIframeModal('./help/', !!this.embed);\n                },\n            });\n        }\n        toolspaceTopRow.getElement().style.marginBottom = '10px';\n        this.toolspaceInner.append(toolspaceTopRow.getElement());\n\n        this.toolspaceToolRow = new KL.ToolspaceToolRow({\n            onActivate: (activeStr) => {\n                if (activeStr !== 'hand') {\n                    // hand only one that doesn't cause changes\n                    applyUncommitted();\n                }\n\n                if (activeStr === 'brush') {\n                    this.easel.setTool('brush');\n                } else if (activeStr === 'hand') {\n                    this.easel.setTool('hand');\n                } else if (activeStr === 'paintBucket') {\n                    this.easel.setTool('paintBucket');\n                } else if (activeStr === 'gradient') {\n                    this.easel.setTool('gradient');\n                } else if (activeStr === 'text') {\n                    this.easel.setTool('text');\n                } else if (activeStr === 'shape') {\n                    this.easel.setTool('shape');\n                } else if (activeStr === 'select') {\n                    // this.klCanvasWorkspace.setMode('shape');\n                    this.easel.setTool('select');\n                } else {\n                    throw new Error('unknown activeStr');\n                }\n                mainTabRow?.open(activeStr);\n                updateMainTabVisibility();\n                this.klColorSlider.setIsEyedropping(false);\n                this.mobileColorUi.setIsEyedropping(false);\n            },\n            onZoomIn: () => {\n                const oldScale = this.easel.getTransform().scale;\n                const newScale = zoomByStep(\n                    oldScale,\n                    keyListener.isPressed('shift') ? 1 / 8 : 1 / 2,\n                );\n                this.easel.scale(newScale / oldScale);\n            },\n            onZoomOut: () => {\n                const oldScale = this.easel.getTransform().scale;\n                const newScale = zoomByStep(\n                    oldScale,\n                    keyListener.isPressed('shift') ? -1 / 8 : -1 / 2,\n                );\n                this.easel.scale(newScale / oldScale);\n            },\n            onUndo: () => {\n                undo();\n            },\n            onRedo: () => {\n                redo();\n            },\n        });\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\n        this.toolspaceInner.append(this.toolspaceToolRow.getElement());\n\n        const setBrushColor = (p_color: TRgb) => {\n            currentColor = p_color;\n            currentBrushUi.setColor(p_color);\n            brushSettingService.emitColor(p_color);\n            this.mobileColorUi.setColor(p_color);\n            this.klColorSlider.setIsEyedropping(false);\n            this.mobileColorUi.setIsEyedropping(false);\n        };\n\n        this.klColorSlider = new KL.KlColorSlider({\n            width: 250,\n            height: 30,\n            svHeight: 100,\n            startValue: new BB.RGB(0, 0, 0),\n            onPick: setBrushColor,\n            onEyedropper: (isActive) => {\n                if (isActive) {\n                    this.mobileColorUi.setIsEyedropping(true);\n                    this.easel.setTool('eyedropper');\n                } else {\n                    this.mobileColorUi.setIsEyedropping(false);\n                    this.easel.setTool(this.toolspaceToolRow.getActive());\n                }\n            },\n        });\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\n\n        const setCurrentBrush = (brushId: string) => {\n            if (brushId !== 'eraserBrush') {\n                lastNonEraserBrushId = brushId;\n            }\n\n            if (this.klColorSlider) {\n                if (brushId === 'eraserBrush') {\n                    this.klColorSlider.enable(false);\n                } else {\n                    this.klColorSlider.enable(true);\n                }\n            }\n\n            currentBrushId = brushId;\n            currentBrushUi = brushUiMap[brushId];\n            currentBrushUi.setColor(currentColor);\n            currentBrushUi.setLayer(currentLayer);\n            this.easelBrush.setBrush({\n                type: currentBrushId === 'pixelBrush' ? 'pixel-square' : 'round',\n            });\n            this.toolspaceToolRow.setActive('brush');\n            updateMainTabVisibility();\n        };\n\n        const setCurrentLayer = (layer: TKlCanvasLayer) => {\n            currentLayer = layer;\n            currentBrushUi.setLayer(currentLayer);\n            this.layerPreview.setLayer(currentLayer);\n        };\n\n        const brushDiv = BB.el();\n        const colorDiv = BB.el({\n            css: {\n                margin: '10px',\n                display: 'flex',\n                flexWrap: 'wrap',\n                justifyContent: 'space-between',\n                alignItems: 'flex-end',\n            },\n        });\n        const toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\n            smoothing: 1,\n            onSelect: (v) => {\n                lineSmoothing.setSmoothing(translateSmoothing(v));\n            },\n        });\n\n        brushDiv.append(colorDiv);\n        BB.append(colorDiv, [\n            this.klColorSlider.getElement(),\n            this.klColorSlider.getOutputElement(),\n            toolspaceStabilizerRow.getElement(),\n        ]);\n\n        const brushTabRow = new KL.TabRow({\n            initialId: 'penBrush',\n            useAccent: true,\n            tabArr: (() => {\n                const result = [];\n\n                const createTab = (keyStr: string) => {\n                    return {\n                        id: keyStr,\n                        image: KL.BRUSHES_UI[keyStr].image,\n                        title: KL.BRUSHES_UI[keyStr].tooltip,\n                        onOpen: () => {\n                            brushUiMap[keyStr].getElement().style.display = 'block';\n                            setCurrentBrush(keyStr);\n                            this.klColorSlider.setIsEyedropping(false);\n                            this.mobileColorUi.setIsEyedropping(false);\n                            brushSettingService.emitSliderConfig({\n                                sizeSlider: KL.BRUSHES_UI[keyStr].sizeSlider,\n                                opacitySlider: KL.BRUSHES_UI[keyStr].opacitySlider,\n                                scatterSlider: KL.BRUSHES_UI[keyStr].scatterSlider,\n                            });\n                            sizeWatcher(brushUiMap[keyStr].getSize());\n                            brushSettingService.emitOpacity(brushUiMap[keyStr].getOpacity());\n                            this.mobileBrushUi.setType(\n                                keyStr === 'eraserBrush' ? 'eraser' : 'brush',\n                            );\n                        },\n                        onClose: () => {\n                            brushUiMap[keyStr].getElement().style.display = 'none';\n                        },\n                    };\n                };\n\n                const keyArr = Object.keys(brushUiMap);\n                for (let i = 0; i < keyArr.length; i++) {\n                    result.push(createTab(keyArr[i]));\n                }\n                return result;\n            })(),\n        });\n        BB.append(brushDiv, [\n            brushTabRow.getElement(),\n            ...Object.entries(KL.BRUSHES_UI).map(([b]) => brushUiMap[b].getElement()),\n        ]);\n\n        const handUi = new KL.HandUi({\n            scale: this.easel.getTransform().scale,\n            angleDeg: 0,\n            onReset: () => {\n                this.easel.resetTransform();\n            },\n            onFit: () => {\n                this.easel.fitTransform();\n            },\n            onAngleChange: (angleDeg, isRelative) => {\n                this.easel.setAngleDeg(angleDeg, isRelative);\n            },\n            onChangeUseInertiaScrolling: (b) => {\n                easelHand.setUseInertiaScrolling(b);\n            },\n        });\n\n        const fillUi = new KL.FillUi({\n            colorSlider: this.klColorSlider,\n        });\n\n        const gradientUi = new KL.GradientUi({\n            colorSlider: this.klColorSlider,\n        });\n\n        const textUi = new KL.TextUi({\n            colorSlider: this.klColorSlider,\n        });\n\n        const shapeUi = new KL.ShapeUi({\n            colorSlider: this.klColorSlider,\n            onChangePanning: (doPan) => easelShape.setPanning(doPan),\n        });\n\n        const gradientTool = new KL.GradientTool({\n            onGradient: (isDone, x1, y1, x2, y2, angleRad) => {\n                const layerIndex = currentLayer.index;\n                const settings = gradientUi.getSettings();\n                const gradientObj: TGradient = {\n                    type: settings.type,\n                    color1: this.klColorSlider.getColor(),\n                    isReversed: settings.isReversed,\n                    opacity: settings.opacity,\n                    doLockAlpha: settings.doLockAlpha,\n                    isEraser: settings.isEraser,\n                    doSnap: keyListener.isPressed('shift') || settings.doSnap,\n                    x1,\n                    y1,\n                    x2,\n                    y2,\n                    angleRad,\n                };\n\n                if (isDone) {\n                    this.klCanvas.setComposite(layerIndex, undefined);\n                    this.klCanvas.drawGradient(layerIndex, gradientObj);\n                } else {\n                    const selection = this.klCanvas.getSelection();\n                    const selectionPath = selection\n                        ? new Path2D(getSelectionPath2d(selection))\n                        : undefined;\n                    this.klCanvas.setComposite(layerIndex, {\n                        draw: (ctx) => {\n                            KL.drawGradient(ctx, gradientObj, selectionPath);\n                        },\n                    });\n                }\n\n                this.easelProjectUpdater.update();\n            },\n        });\n\n        const shapeTool = new KL.ShapeTool({\n            onShape: (isDone, x1, y1, x2, y2, angleRad) => {\n                const layerIndex = currentLayer.index;\n\n                const shapeObj: any = {\n                    type: shapeUi.getShape(),\n                    x1: x1,\n                    y1: y1,\n                    x2: x2,\n                    y2: y2,\n                    angleRad: angleRad,\n                    isOutwards: shapeUi.getIsOutwards(),\n                    opacity: shapeUi.getOpacity(),\n                    isEraser: shapeUi.getIsEraser(),\n                    doLockAlpha: shapeUi.getDoLockAlpha(),\n                };\n                if (shapeUi.getShape() === 'line') {\n                    shapeObj.strokeRgb = this.klColorSlider.getColor();\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\n                    shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\n                } else {\n                    shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\n                    if (shapeUi.getMode() === 'stroke') {\n                        shapeObj.strokeRgb = this.klColorSlider.getColor();\n                        shapeObj.lineWidth = shapeUi.getLineWidth();\n                    } else {\n                        shapeObj.fillRgb = this.klColorSlider.getColor();\n                    }\n                }\n\n                if (isDone) {\n                    this.klCanvas.setComposite(layerIndex, undefined);\n                    this.klCanvas.drawShape(layerIndex, shapeObj);\n                } else {\n                    const selection = this.klCanvas.getSelection();\n                    const selectionPath = selection\n                        ? new Path2D(getSelectionPath2d(selection))\n                        : undefined;\n                    this.klCanvas.setComposite(layerIndex, {\n                        draw: (ctx) => {\n                            KL.drawShape(ctx, shapeObj, selectionPath);\n                        },\n                    });\n                }\n\n                this.easelProjectUpdater.update();\n            },\n        });\n\n        this.layersUi = new KL.LayersUi({\n            klCanvas: this.klCanvas,\n            onSelect: (layerIndex) => {\n                const activeLayer = this.klCanvas.getLayer(layerIndex);\n                setCurrentLayer(activeLayer);\n\n                const topEntry = this.klHistory.getEntries().at(-1)!.data;\n                const replaceTop = isHistoryEntryActiveLayerChange(topEntry);\n\n                this.klHistory.push(\n                    {\n                        activeLayerId: activeLayer.id,\n                    },\n                    replaceTop,\n                );\n            },\n            parentEl: this.rootEl,\n            uiState: this.uiLayout,\n            applyUncommitted: () => applyUncommitted(),\n            klHistory: this.klHistory,\n            onUpdateProject: () => this.easelProjectUpdater.update(),\n            onClearLayer: () => clearLayer(false, true),\n        });\n        this.layerPreview = new KL.LayerPreview({\n            klRootEl: this.rootEl,\n            onClick: () => {\n                mainTabRow?.open('layers');\n            },\n            uiState: this.uiLayout,\n            klHistory: this.klHistory,\n        });\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\n        this.layerPreview.setLayer(currentLayer);\n\n        const editUi = new KL.EditUi({\n            klRootEl: this.rootEl,\n            klColorSlider: this.klColorSlider,\n            layersUi: this.layersUi,\n            getCurrentColor: () => currentColor,\n            maxCanvasSize,\n            klCanvas: this.klCanvas,\n            getCurrentLayer: () => currentLayer,\n            isEmbed: !!this.embed,\n            statusOverlay: this.statusOverlay,\n            onCanvasChanged: () => {\n                this.easelProjectUpdater.update();\n                this.easel.resetOrFitTransform(true);\n            },\n            applyUncommitted: () => applyUncommitted(),\n            klHistory: this.klHistory,\n            onCopyToClipboard: () => {\n                applyUncommitted();\n                copyToClipboard(false, false);\n            },\n            onPaste: () => importHandler.readClipboard(),\n        });\n\n        const klHistoryExecutor = new KlHistoryExecutor({\n            klHistory: this.klHistory,\n            tempHistory,\n            onCanUndoRedoChange: (canUndo, canRedo) => {\n                this.toolspaceToolRow.setEnableUndo(canUndo);\n                this.toolspaceToolRow.setEnableRedo(canRedo);\n            },\n        });\n\n        const showNewImageDialog = () => {\n            applyUncommitted();\n            KL.newImageDialog({\n                currentColor: currentColor,\n                secondaryColor: this.klColorSlider.getSecondaryRGB(),\n                maxCanvasSize,\n                canvasWidth: this.klCanvas.getWidth(),\n                canvasHeight: this.klCanvas.getHeight(),\n                workspaceWidth:\n                    window.innerWidth < this.collapseThreshold\n                        ? this.uiWidth\n                        : this.uiWidth - this.toolWidth,\n                workspaceHeight: this.uiHeight,\n                onConfirm: (width, height, color) => {\n                    this.klCanvas.reset({\n                        width: width,\n                        height: height,\n                        color: color.a === 1 ? color : undefined,\n                    });\n\n                    this.layersUi.update(0);\n                    setCurrentLayer(this.klCanvas.getLayer(0));\n                    this.easelProjectUpdater.update();\n                    this.easel.resetOrFitTransform(true);\n                },\n                onCancel: () => {},\n            });\n        };\n\n        const shareImage = (callback?: () => void) => {\n            applyUncommitted();\n            BB.shareCanvas({\n                canvas: this.klCanvas.getCompleteCanvas(1),\n                fileName: BB.getDate() + KL_CONFIG.filenameBase + '.png',\n                title: BB.getDate() + KL_CONFIG.filenameBase + '.png',\n                callback: callback ? callback : () => {},\n            });\n        };\n\n        this.saveToComputer = new KL.SaveToComputer(\n            () => exportType,\n            this.klCanvas,\n            () => {\n                this.updateLastSaved();\n            },\n        );\n\n        const copyToClipboard = (showCrop: boolean = false, closeOnBlur: boolean = true) => {\n            KL.clipboardDialog(\n                this.rootEl,\n                (maskSelection) => {\n                    return this.klCanvas.getCompleteCanvas(1, maskSelection);\n                },\n                (inputObj) => {\n                    if (\n                        inputObj.left === 0 &&\n                        inputObj.right === 0 &&\n                        inputObj.top === 0 &&\n                        inputObj.bottom === 0\n                    ) {\n                        return;\n                    }\n                    //do a crop\n                    KL.FILTER_LIB.cropExtend.apply!({\n                        layer: currentLayer,\n                        klCanvas: this.klCanvas,\n                        input: inputObj,\n                        klHistory: this.klHistory,\n                    });\n                    this.layersUi.update();\n                    this.easelProjectUpdater.update();\n                    this.easel.resetOrFitTransform(true);\n                },\n                this.statusOverlay,\n                showCrop || false,\n                closeOnBlur,\n                this.klCanvas.getSelection(),\n            );\n        };\n\n        const onOpenBrowserStorage = async () => {\n            const showFailureMessage = () => {\n                KL.popup({\n                    target: this.rootEl,\n                    message: LANG('file-storage-open-failed'),\n                    type: 'error',\n                });\n            };\n\n            if (!projectStore) {\n                showFailureMessage();\n                return;\n            }\n            const meta = projectStore.getCurrentMeta();\n\n            // Check is project already opened in other tab.\n            // (if it's already open in the current tab, user showed intentionality. Don't ask again.)\n            if (meta && this.klHistory.getComposed().projectId.value !== meta.projectId) {\n                let doOpen = true;\n                const crossTabChannel = new CrossTabChannel('kl-tab-communication');\n\n                const openedProjectIds: string[] = [];\n                const otherIdListener = (message: any) => {\n                    if (message.type === 'response-project-id') {\n                        openedProjectIds.push(message.id);\n                    }\n                };\n                crossTabChannel.subscribe(otherIdListener);\n                crossTabChannel.postMessage({ type: 'request-project-ids' });\n                await sleep(100);\n                crossTabChannel.unsubscribe(otherIdListener);\n\n                if (meta && openedProjectIds.includes(meta.projectId)) {\n                    doOpen = await new Promise<boolean>((resolve, reject) => {\n                        showModal({\n                            target: document.body,\n                            message: LANG('file-storage-open-confirmation'),\n                            buttons: [LANG('file-storage-open'), 'Cancel'],\n                            callback: async (result) => {\n                                if (result === 'Cancel') {\n                                    resolve(false);\n                                    return;\n                                }\n                                resolve(true);\n                            },\n                        });\n                    });\n                }\n\n                crossTabChannel.close();\n                if (!doOpen) {\n                    return;\n                }\n            }\n\n            let closeLoader: (() => void) | undefined;\n            KL.popup({\n                target: this.rootEl,\n                message: LANG('loading'),\n                callback: (result) => {\n                    closeLoader = undefined;\n                },\n                closeFunc: (f) => {\n                    closeLoader = f;\n                },\n            });\n            let project: TDeserializedKlStorageProject | undefined;\n            try {\n                project = await projectStore?.read();\n            } catch (e) {\n                setTimeout(() => {\n                    throw e;\n                });\n            }\n            if (!project) {\n                closeLoader?.();\n                showFailureMessage();\n                return;\n            }\n            applyUncommitted();\n            const layerIndex = this.klCanvas.reset({\n                projectId: project.project.projectId,\n                width: project.project.width,\n                height: project.project.height,\n                layers: project.project.layers.map((item) => {\n                    let image = item.image;\n                    if (!(image instanceof HTMLCanvasElement)) {\n                        image = BB.canvas(project.project.width, project.project.height);\n                        if (item.image instanceof HTMLImageElement) {\n                            const ctx = BB.ctx(image);\n                            ctx.drawImage(item.image, 0, 0);\n                        }\n                    }\n                    return {\n                        ...item,\n                        id: randomUuid(),\n                        image,\n                        mixModeStr: item.mixModeStr ?? 'source-over',\n                    };\n                }),\n            });\n            this.layersUi.update(layerIndex);\n            setCurrentLayer(this.klCanvas.getLayer(layerIndex));\n            this.easelProjectUpdater.update();\n            this.easel.resetOrFitTransform(true);\n\n            setTimeout(() => {\n                // timeout to overwrite zoom overlay msg\n                this.statusOverlay.out(LANG('file-storage-restored'));\n            });\n            closeLoader?.();\n        };\n\n        const fileUi = this.embed\n            ? null\n            : new KL.FileUi({\n                  klRootEl: this.rootEl,\n                  projectStore: projectStore,\n                  getProject: () => this.klCanvas.getProject(),\n                  exportType: exportType,\n                  onExportTypeChange: (type) => {\n                      exportType = type;\n                  },\n                  onFileSelect: (files, optionsStr) =>\n                      importHandler.handleFileSelect(files, optionsStr),\n                  onSaveImageToComputer: () => {\n                      applyUncommitted();\n                      this.saveToComputer.save();\n                  },\n                  onNewImage: showNewImageDialog,\n                  onShareImage: (callback) => {\n                      applyUncommitted();\n                      shareImage(callback);\n                  },\n                  onUpload: () => {\n                      // on upload\n                      applyUncommitted();\n                      KL.imgurUpload(\n                          this.klCanvas,\n                          this.rootEl,\n                          p.app && p.app.imgurKey ? p.app.imgurKey : '',\n                          () => this.updateLastSaved(),\n                      );\n                  },\n                  applyUncommitted: () => applyUncommitted(),\n                  onChangeShowSaveDialog: (b) => {\n                      this.saveToComputer.setShowSaveDialog(b);\n                  },\n                  klRecoveryManager,\n                  onOpenBrowserStorage,\n                  onStoredToBrowserStorage: () => {\n                      this.updateLastSaved();\n                  },\n              });\n\n        if (!this.embed && projectStore) {\n            this.saveReminder = new SaveReminder({\n                onSaveAsPsd: () => {\n                    if (!this.embed) {\n                        this.saveAsPsd();\n                    }\n                },\n                isDrawing: () => {\n                    return this.isDrawing();\n                },\n                projectStore,\n                getProject: () => this.getProject(),\n                onStored: () => {\n                    this.updateLastSaved();\n                },\n                applyUncommitted,\n                klHistory: this.klHistory,\n            });\n        }\n\n        const settingsUi = new KL.SettingsUi({\n            onLeftRight: () => {\n                this.uiLayout = this.uiLayout === 'left' ? 'right' : 'left';\n                this.updateUi();\n                if (!this.embed) {\n                    LocalStorage.setItem('uiState', this.uiLayout);\n                }\n            },\n            saveReminder: this.saveReminder,\n            customAbout: p.aboutEl,\n        });\n\n        mainTabRow = new KL.TabRow({\n            initialId: 'brush',\n            tabArr: [\n                {\n                    id: 'brush',\n                    title: LANG('tool-brush'),\n                    image: toolPaintImg,\n                    onOpen: () => {\n                        if (currentBrushId === 'eraserBrush') {\n                            this.klColorSlider.enable(false);\n                        }\n                        BB.append(colorDiv, [\n                            this.klColorSlider.getElement(),\n                            this.klColorSlider.getOutputElement(),\n                            toolspaceStabilizerRow.getElement(),\n                        ]);\n                        brushDiv.style.display = 'block';\n                    },\n                    onClose: () => {\n                        brushDiv.style.display = 'none';\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'hand',\n                    title: LANG('tool-hand'),\n                    image: toolHandImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        handUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        handUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'paintBucket',\n                    title: LANG('tool-paint-bucket'),\n                    image: toolFillImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        fillUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        fillUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'gradient',\n                    title: LANG('tool-gradient'),\n                    image: toolGradientImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        gradientUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        gradientUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'text',\n                    title: LANG('tool-text'),\n                    image: toolTextImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        textUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        textUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'shape',\n                    title: LANG('tool-shape'),\n                    image: toolShapeImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        shapeUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        shapeUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'select',\n                    title: LANG('tool-select'),\n                    image: toolSelectImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        klAppSelect.getSelectUi().setIsVisible(true);\n                    },\n                    onClose: () => {\n                        klAppSelect.getSelectUi().setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'layers',\n                    title: LANG('layers'),\n                    image: tabLayersImg,\n                    onOpen: () => {\n                        this.layersUi.update();\n                        this.layersUi.getElement().style.display = 'block';\n                    },\n                    onClose: () => {\n                        this.layersUi.getElement().style.display = 'none';\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'edit',\n                    title: LANG('tab-edit'),\n                    image: tabEditImg,\n                    onOpen: () => {\n                        editUi.show();\n                    },\n                    onClose: () => {\n                        editUi.hide();\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'file',\n                    label: LANG('tab-file'),\n                    isVisible: !!fileUi,\n                    onOpen: () => {\n                        if (!fileUi) {\n                            return;\n                        }\n                        fileUi.getElement().style.display = 'block';\n                        fileUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        if (!fileUi) {\n                            return;\n                        }\n                        fileUi.getElement().style.display = 'none';\n                        fileUi.setIsVisible(false);\n                    },\n                    css: {\n                        padding: '0 7px',\n                    },\n                },\n                {\n                    id: 'settings',\n                    title: LANG('tab-settings'),\n                    image: tabSettingsImg,\n                    onOpen: () => {\n                        settingsUi.getElement().style.display = 'block';\n                        // settingsTab.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        settingsUi.getElement().style.display = 'none';\n                        // settingsTab.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n            ],\n        });\n\n        this.bottomBarWrapper = BB.el({\n            css: {\n                width: '270px',\n                position: 'absolute',\n                bottom: '0',\n                left: '0',\n            },\n        });\n        if (p.bottomBar) {\n            this.bottomBar = p.bottomBar;\n            this.bottomBarWrapper.append(this.bottomBar);\n            const observer = new MutationObserver(() => this.updateBottomBar());\n            observer.observe(this.toolspaceInner, {\n                attributes: true,\n                childList: true,\n                subtree: true,\n            });\n        }\n\n        BB.append(this.toolspaceInner, [\n            this.layerPreview.getElement(),\n            mainTabRow.getElement(),\n            brushDiv,\n            handUi.getElement(),\n            fillUi.getElement(),\n            gradientUi.getElement(),\n            textUi.getElement(),\n            shapeUi.getElement(),\n            klAppSelect.getSelectUi().getElement(),\n            this.layersUi.getElement(),\n            editUi.getElement(),\n            fileUi ? fileUi.getElement() : undefined,\n            settingsUi.getElement(),\n            BB.el({\n                css: {\n                    height: '10px', // a bit of spacing at the bottom\n                },\n            }),\n            this.bottomBarWrapper ? this.bottomBarWrapper : undefined,\n        ]);\n\n        this.toolspaceScroller = new KL.ToolspaceScroller({\n            toolspace: this.toolspace,\n            uiState: this.uiLayout,\n        });\n\n        if (!this.embed) {\n            Object.defineProperty(window, 'KL', {\n                value: createConsoleApi({\n                    onDraw: (path: TVector2D[]): void => {\n                        if (!path || path.length === 0) {\n                            return;\n                        }\n                        path.forEach((p, index) => {\n                            if (index === 0) {\n                                currentBrushUi.startLine(p.x, p.y, 1);\n                            } else {\n                                currentBrushUi.goLine(p.x, p.y, 1);\n                            }\n                        });\n                        currentBrushUi.endLine();\n                    },\n                }),\n                writable: false,\n            });\n        }\n\n        this.resize(this.uiWidth, this.uiHeight);\n        this.updateUi();\n\n        const importHandler = new KlAppImportHandler(\n            {\n                klRootEl: this.rootEl,\n                maxCanvasSize,\n                layersUi: this.layersUi,\n                setCurrentLayer,\n                klCanvas: this.klCanvas,\n                onImportConfirm: () => {\n                    this.easelProjectUpdater.update();\n                    this.easel.resetOrFitTransform(true);\n                },\n                applyUncommitted: () => applyUncommitted(),\n            },\n            {\n                onColor: (rgb) => brushSettingService.setColor(rgb),\n            },\n        );\n\n        if (!this.embed || this.embed.enableImageDropperImport) {\n            new KL.KlImageDropper({\n                target: document.body,\n                onDrop: (files, optionStr) => {\n                    if (KL.DIALOG_COUNTER.get() > 0) {\n                        return;\n                    }\n                    applyUncommitted();\n                    importHandler.handleFileSelect(files, optionStr);\n                },\n                enabledTest: () => {\n                    return KL.DIALOG_COUNTER.get() === 0;\n                },\n            });\n\n            window.document.addEventListener(\n                'paste',\n                (e: ClipboardEvent) => importHandler.onPaste(e),\n                false,\n            );\n        }\n\n        this.unloadWarningTrigger = new UnloadWarningTrigger({\n            klHistory: this.klHistory,\n            getLastSavedHistoryIndex: () => this.lastSavedHistoryIndex,\n        });\n\n        {\n            window.addEventListener('resize', () => {\n                this.resize(window.innerWidth, window.innerHeight);\n            });\n            window.addEventListener('orientationchange', () => {\n                this.resize(window.innerWidth, window.innerHeight);\n            });\n            // 2024-08: window.resize doesn't fire on iPad Safari when:\n            // pinch zoomed page, then reload, and un-pinch-zoom page\n            // therefor also listen to visualViewport.\n            if ('visualViewport' in window && visualViewport !== null) {\n                visualViewport.addEventListener('resize', () => {\n                    this.resize(window.innerWidth, window.innerHeight);\n                });\n            }\n\n            // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\n            // Workaround: place a div in the body that fills the window, and use a ResizeObserver\n            const windowResizeWatcher = BB.el({\n                parent: document.body,\n                css: {\n                    position: 'fixed',\n                    left: '0',\n                    top: '0',\n                    right: '0',\n                    bottom: '0',\n                    pointerEvents: 'none',\n                    zIndex: '-1',\n                    userSelect: 'none',\n                },\n            });\n            try {\n                // Not all browsers support ResizeObserver. Not critical though.\n                const observer = new ResizeObserver(() =>\n                    this.resize(window.innerWidth, window.innerHeight),\n                );\n                observer.observe(windowResizeWatcher);\n            } catch (e) {\n                windowResizeWatcher.remove();\n            }\n\n            // prevent ctrl scroll -> zooming page\n            this.rootEl.addEventListener(\n                'wheel',\n                (event) => {\n                    if (keyListener.isPressed('ctrl')) {\n                        event.preventDefault();\n                    }\n                },\n                { passive: false },\n            );\n            //maybe prevent zooming on safari mac os - todo still needed?\n            const prevent = (e: Event) => {\n                e.preventDefault();\n            };\n            window.addEventListener('gesturestart', prevent, { passive: false });\n            window.addEventListener('gesturechange', prevent, { passive: false });\n            window.addEventListener('gestureend', prevent, { passive: false });\n\n            const pinchZoomWatcher = new PinchZoomWatcher();\n        }\n\n        if (!this.embed) {\n            setTimeout(() => {\n                runBrowserStorageBanner({\n                    projectStore,\n                    klRecoveryManager,\n                    onOpenBrowserStorage,\n                    klHistory: this.klHistory,\n                });\n            });\n        }\n        this.saveReminder?.init();\n    }\n\n    // -------- interface --------\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    resize(w: number, h: number): void {\n        // iPad scrolls down when increasing text zoom\n        if (window.scrollY > 0) {\n            window.scrollTo(0, 0);\n        }\n\n        if (this.uiWidth === Math.max(0, w) && this.uiHeight === Math.max(0, h)) {\n            return;\n        }\n\n        this.uiWidth = Math.max(0, w);\n        this.uiHeight = Math.max(0, h);\n\n        this.updateCollapse();\n        this.updateBottomBar();\n\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\n    }\n\n    out(msg: string): void {\n        this.statusOverlay.out(msg);\n    }\n\n    async getPNG(): Promise<Blob> {\n        return await canvasToBlob(this.klCanvas.getCompleteCanvas(1), 'image/png');\n    }\n\n    getPSD = async (): Promise<Blob> => {\n        return await klCanvasToPsdBlob(this.klCanvas);\n    };\n\n    getProject(): TKlProject {\n        return this.klCanvas.getProject();\n    }\n\n    swapUiLeftRight(): void {\n        this.uiLayout = this.uiLayout === 'left' ? 'right' : 'left';\n        if (!this.embed) {\n            LocalStorage.setItem('uiState', this.uiLayout);\n        }\n        this.updateUi();\n    }\n\n    saveAsPsd(): void {\n        this.saveToComputer.save('psd');\n    }\n\n    isDrawing(): boolean {\n        return this.lineSanitizer.getIsDrawing() || this.easel.getIsLocked();\n    }\n}\n","import { showModal } from './ui/modals/base/showModal';\nimport { DynamicModal } from './ui/modals/base/dynamic-modal';\nimport { DIALOG_COUNTER } from './ui/modals/modal-count';\nimport { Checkbox } from './ui/components/checkbox';\nimport { input } from './ui/components/input';\nimport { Select } from './ui/components/select';\nimport { ImageToggle } from './ui/components/image-toggle';\nimport { ImageRadioList } from './ui/components/image-radio-list';\nimport { createPenPressureToggle } from './ui/components/create-pen-pressure-toggle';\nimport { KlSlider } from './ui/components/kl-slider';\nimport { HexColorDialog } from './ui/modals/color-slider-hex-dialog';\nimport { KlColorSlider } from './ui/components/kl-color-slider';\nimport { KlColorSliderSmall } from './ui/components/kl-color-slider-small';\nimport { PointSlider } from './ui/components/point-slider';\nimport { ColorOptions } from './ui/components/color-options';\nimport { Options } from './ui/components/options';\nimport { StatusOverlay } from './ui/components/status-overlay';\nimport { CropCopy } from './ui/components/crop-copy';\nimport { clipboardDialog } from './ui/modals/clipboard-dialog';\nimport { LayersUi } from './ui/tool-tabs/layers-ui/layers-ui';\nimport { KlCanvasPreview } from './ui/project-viewport/kl-canvas-preview';\nimport { FreeTransform } from './ui/components/free-transform';\nimport { FreeTransformCanvas } from './ui/components/free-transform-canvas';\nimport { Cropper } from './ui/components/cropper';\nimport { LayerPreview } from './ui/components/layer-preview';\nimport { showImportAsLayerDialog } from './ui/modals/show-import-as-layer-dialog';\nimport { KlImageDropper } from './ui/components/kl-image-dropper';\nimport { OverlayToolspace } from './ui/components/overlay-toolspace';\nimport { ToolspaceTopRow } from './ui/components/toolspace-top-row';\nimport { ToolDropdown } from './ui/components/tool-dropdown';\nimport { ToolspaceToolRow } from './ui/components/toolspace-tool-row';\nimport { ToolspaceStabilizerRow } from './ui/components/toolspace-stabilizer-row';\nimport { TabRow } from './ui/components/tab-row';\nimport { HandUi } from './ui/tool-tabs/hand-ui';\nimport { FillUi } from './ui/tool-tabs/fill-ui';\nimport { TextUi } from './ui/tool-tabs/text-ui';\nimport { ShapeUi } from './ui/tool-tabs/shape-ui';\nimport { newImageDialog } from './ui/modals/new-image-dialog';\nimport { ToolspaceCollapser } from './ui/mobile/toolspace-collapser';\nimport { textToolDialog } from './ui/modals/text-tool-dialog/text-tool-dialog';\nimport { showImportImageDialog } from './ui/modals/show-import-image-dialog';\nimport * as PSD from './storage/psd';\nimport { drawShape, ShapeTool } from './image-operations/shape-tool';\nimport { KlCanvas } from './canvas/kl-canvas';\nimport { FILTER_LIB, FILTER_LIB_STATUS } from './filters/filters';\nimport { BRUSHES } from './brushes/brushes';\nimport { BRUSHES_UI } from './brushes-ui/brushes-ui';\nimport { showIframeModal } from './ui/modals/show-iframe-modal';\nimport { RadioList } from './ui/components/radio-list';\nimport { BrowserStorageUi } from './ui/components/browser-storage-ui';\nimport { ProjectStore } from './storage/project-store';\nimport { FileUi } from './ui/tool-tabs/file-ui';\nimport { EditUi } from './ui/tool-tabs/edit-ui';\nimport { imgurUpload } from './ui/modals/imgur-upload';\nimport { loadAgPsd } from './storage/load-ag-psd';\nimport { SaveReminder } from './ui/components/save-reminder';\nimport { SaveToComputer } from './storage/save-to-computer';\nimport { BrushSettingService } from './brushes-ui/brush-setting-service';\nimport { BoxToggle } from './ui/components/box-toggle';\nimport { SettingsUi } from './ui/tool-tabs/settings-ui';\nimport { ToolspaceScroller } from './ui/components/toolspace-scroller';\nimport { GradientUi } from './ui/tool-tabs/gradient-ui';\nimport { drawGradient, GradientTool } from './image-operations/gradient-tool';\n\n/**\n * paint tool functionality\n */\nexport const KL = {\n    // --- brushes ---\n    BRUSHES,\n    BRUSHES_UI,\n    BrushSettingService,\n\n    // --- canvas ---\n    KlCanvas,\n\n    // --- canvas ui ---\n    KlCanvasPreview,\n\n    // --- filters ---\n    FILTER_LIB_STATUS,\n    FILTER_LIB,\n\n    // --- image operations ---\n    ShapeTool,\n    drawShape,\n    GradientTool,\n    drawGradient,\n\n    // --- storage ---\n    PSD,\n    ProjectStore,\n    loadAgPsd,\n    SaveToComputer,\n\n    // --- ui - components ---\n    Checkbox,\n    input,\n    Select,\n    ImageToggle,\n    ImageRadioList,\n    RadioList,\n    createPenPressureToggle,\n    KlSlider,\n    HexColorDialog,\n    KlColorSlider,\n    KlColorSliderSmall,\n    PointSlider,\n    ColorOptions,\n    Options,\n    BoxToggle,\n    StatusOverlay,\n    CropCopy,\n    FreeTransform,\n    FreeTransformCanvas,\n    Cropper,\n    LayerPreview,\n    KlImageDropper,\n    OverlayToolspace,\n    ToolspaceTopRow,\n    ToolDropdown,\n    ToolspaceToolRow,\n    ToolspaceStabilizerRow,\n    TabRow,\n    ToolspaceCollapser,\n    BrowserStorageUi,\n    SaveReminder,\n    ToolspaceScroller,\n\n    // --- ui - modals ---\n    DIALOG_COUNTER,\n    popup: showModal,\n    Popup: DynamicModal,\n    clipboardDialog,\n    showImportAsLayerDialog,\n    newImageDialog,\n    textToolDialog,\n    showImportImageDialog,\n    showIframePopup: showIframeModal,\n    imgurUpload,\n\n    // --- ui - tool tabs ---\n    HandUi,\n    FillUi,\n    GradientUi,\n    TextUi,\n    ShapeUi,\n    FileUi,\n    EditUi,\n    SettingsUi,\n    LayersUi,\n};\n\nObject.keys(KL); // without this, parcel build may break this object\n","import { TKeyString } from '../../../../bb/bb-types';\nimport { DIALOG_COUNTER } from '../modal-count';\nimport { BB } from '../../../../bb/bb';\nimport { LANG } from '../../../../language/language';\nimport './scroll-fix';\nimport cancelImg from 'url:/src/app/img/ui/cancel.svg';\nimport checkImg from 'url:/src/app/img/ui/check.svg';\nimport removeLayerImg from 'url:/src/app/img/ui/remove-layer.svg';\n\nexport function showModal(p: {\n    target: HTMLElement;\n    div?: HTMLElement; // node with content\n    message: string | Element; // can be html\n    callback?: (result: string) => void;\n    buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\n    primaries?: string[];\n    deleteButtonName?: string;\n    type?: 'error' | 'warning' | 'upload' | 'ok'; // todo (...what is to be done?)\n    closeFunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\n    style?: TKeyString;\n    clickOnEnter?: string; // name of button - will be clicked if enter key pressed\n    autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\n    ignoreBackground?: boolean; // default false; if true clicking on background doesn't close\n}): {\n    setIgnoreBackground: (b: boolean) => void;\n} {\n    DIALOG_COUNTER.increase();\n    let isClosed = false;\n    let ignoreBackground = !!p.ignoreBackground;\n\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\n    const rootRootEl = BB.el({\n        parent: document.body,\n        css: {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            right: '0',\n            bottom: '0',\n            overflow: 'hidden',\n        },\n    });\n    const rootEl = BB.el({\n        parent: rootRootEl,\n        className: 'kl-popup',\n    });\n\n    const scrollContent = BB.el({\n        parent: rootEl,\n        css: {\n            width: '100%',\n            minHeight: '100%',\n            // padding: '10px 0',\n            position: 'relative',\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'center',\n            alignItems: 'center',\n        },\n    });\n\n    const bgEl = BB.el({\n        parent: scrollContent,\n        onClick: () => {\n            if (ignoreBackground) {\n                return;\n            }\n            close('Cancel');\n        },\n        css: {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            zIndex: '0',\n            width: '100%',\n            height: '100%',\n        },\n    });\n\n    const titleHeight = 40;\n    const xButton = BB.el({\n        tagName: 'button',\n        className: 'popup-x',\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\n        title: LANG('modal-close'),\n        onClick: () => {\n            close('Cancel');\n        },\n        css: {\n            width: titleHeight + 'px',\n            height: titleHeight + 'px',\n            lineHeight: titleHeight + 'px',\n            position: 'absolute',\n            right: '0',\n            top: '0',\n            background: 'none',\n            boxShadow: 'none',\n        },\n    });\n\n    let icon: HTMLElement | undefined = undefined;\n    if (p.type) {\n        icon = BB.el({\n            className: {\n                error: 'kl-popup__icon-error',\n                ok: 'kl-popup__icon-ok',\n                warning: 'kl-popup__icon-warning',\n                upload: 'kl-popup__icon-upload',\n            }[p.type],\n        });\n    }\n\n    const boxClasses = ['kl-popup-box'];\n    boxClasses.push('kl-popup-box--sm');\n    const boxEl = BB.el({\n        content: [\n            xButton,\n            icon,\n            BB.el({\n                content: p.message,\n                css: {\n                    marginRight: '15px',\n                    marginBottom: p.div ? '10px' : undefined,\n                },\n            }),\n            p.div,\n        ],\n        className: boxClasses.join(' '),\n        css: p.style ? p.style : undefined,\n    });\n\n    scrollContent.append(\n        BB.el({\n            css: {\n                flex: '0.5',\n            },\n        }),\n        boxEl,\n        BB.el({\n            css: {\n                flex: '1',\n            },\n        }),\n    );\n\n    const keyListener = new BB.KeyListener({\n        onDown: function (keyStr, e, comboStr): void {\n            if (isClosed) {\n                return;\n            }\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\n                e.stopPropagation();\n                setTimeout(() => {\n                    clickOnEnterBtn && clickOnEnterBtn.click();\n                }, 10);\n            }\n            if (comboStr === 'esc') {\n                e.stopPropagation();\n                e.preventDefault(); // stay in fullscreen on Mac\n                close('Cancel');\n            }\n        },\n    });\n    // prevent ctrl scroll -> zooming page\n    const wheelPrevent = (event: WheelEvent): void => {\n        if (keyListener.isPressed('ctrl')) {\n            event.preventDefault();\n        }\n    };\n    rootEl.addEventListener('wheel', wheelPrevent, { passive: false });\n    rootEl.onclick = BB.handleClick;\n\n    let autoFocus: string | undefined;\n    if (p.autoFocus) {\n        autoFocus = p.autoFocus;\n    } else if (p.autoFocus === false) {\n        autoFocus = undefined;\n    } else {\n        autoFocus = 'Ok';\n    }\n\n    const buttonRowEl =\n        p.buttons && p.buttons.length > 0\n            ? BB.el({\n                  parent: boxEl,\n                  css: {\n                      display: 'flex',\n                      flexWrap: 'wrap',\n                      justifyContent: 'flex-end',\n                      marginTop: '12px', // 8px already via buttons\n                      marginLeft: '-8px',\n                  },\n              })\n            : undefined;\n    let clickOnEnterBtn: HTMLButtonElement | undefined;\n    const btnElArr: HTMLButtonElement[] = [];\n    if (p.buttons) {\n        p.buttons.forEach((buttonName) => {\n            const btnClasses = ['kl-popup__btn'];\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\n                btnClasses.push('kl-button-primary');\n            }\n            if (buttonName === p.deleteButtonName) {\n                btnClasses.push('kl-button-delete');\n            }\n            let iconUrl;\n            let label = buttonName;\n            if (buttonName === 'Ok') {\n                label = LANG('modal-ok');\n                iconUrl = checkImg;\n            }\n            if (buttonName === 'Cancel') {\n                label = LANG('modal-cancel');\n                iconUrl = cancelImg;\n                btnClasses.push('kl-button-cancel');\n            }\n            if (buttonName === p.deleteButtonName) {\n                iconUrl = removeLayerImg;\n            }\n            let iconImg: HTMLElement | undefined = undefined;\n            if (iconUrl) {\n                iconImg = BB.el({\n                    tagName: 'img',\n                    custom: {\n                        src: iconUrl,\n                        height: '17',\n                    },\n                });\n            }\n            const btn = BB.el({\n                parent: buttonRowEl,\n                tagName: 'button',\n                className: btnClasses.join(' '),\n                content: [\n                    iconImg,\n                    BB.el({\n                        className: 'kl-popup__btn__text',\n                        content: label,\n                    }),\n                ],\n                onClick: () => {\n                    close(buttonName);\n                },\n            });\n            btnElArr.push(btn);\n            if (autoFocus === buttonName) {\n                setTimeout(() => {\n                    btn.focus();\n                    rootEl.scrollTo(0, 0);\n                }, 10);\n                setTimeout(() => {\n                    // safari needs a separate timeout\n                    rootEl.scrollTo(0, 0);\n                }, 20);\n            }\n            if (buttonName === p.clickOnEnter) {\n                clickOnEnterBtn = btn;\n            }\n        });\n    }\n\n    function close(value: string): void {\n        if (isClosed) {\n            return;\n        }\n\n        isClosed = true;\n        BB.clearSelection();\n        BB.unfocusAnyInput();\n        rootRootEl.remove();\n        DIALOG_COUNTER.decrease();\n        BB.destroyEl(xButton);\n        BB.destroyEl(bgEl);\n        keyListener.destroy();\n        rootEl.removeEventListener('wheel', wheelPrevent);\n        // (disabled) eslint-disable-next-line no-null/no-null\n        rootEl.onclick = null;\n        btnElArr.forEach((item) => BB.destroyEl(item));\n        btnElArr.splice(0, btnElArr.length);\n\n        if (p.callback) {\n            p.callback(value);\n        }\n    }\n\n    if (p.closeFunc) {\n        p.closeFunc(function () {\n            close('Cancel');\n        });\n    }\n\n    return {\n        setIgnoreBackground: (b: boolean) => {\n            ignoreBackground = b;\n        },\n    } as const;\n}\n","/**\n * track how many modals are opened\n */\nexport class DialogCounter {\n    private listeners: ((v: number) => void)[] = [];\n    private count = 0;\n\n    private emit(): void {\n        this.listeners.forEach((item) => {\n            item(this.count);\n        });\n    }\n    // ----------------------------------- public -----------------------------------\n\n    increase(v?: number): void {\n        if (v !== undefined) {\n            this.count += v;\n        } else {\n            this.count++;\n        }\n        this.emit();\n    }\n    decrease(v?: number): void {\n        if (v !== undefined) {\n            this.count -= v;\n        } else {\n            this.count--;\n        }\n        this.emit();\n    }\n    get(): number {\n        return this.count;\n    }\n    subscribe(listener: (v: number) => void): void {\n        this.listeners.push(listener);\n    }\n}\n\nexport const DIALOG_COUNTER = new DialogCounter();\n","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n","import {\n    append,\n    centerWithin,\n    copyObj,\n    createSvg,\n    css,\n    dateDayDifference,\n    decToFraction,\n    fitInto,\n    gcd,\n    getDate,\n    handleClick,\n    imageBlobToUrl,\n    insertAfter,\n    isDark,\n    loadImage,\n    nullToUndefined,\n    reduce,\n    setAttributes,\n    shareCanvas,\n    throwIfNull,\n} from './base/base';\nimport {\n    canShareFiles,\n    EVENT_USES_HIGH_RES_TIMESTAMP,\n    HAS_POINTER_EVENTS,\n    IS_CSS_MIN_MAX_SUPPORTED,\n    unsetEventHandler,\n} from './base/browser';\nimport { KeyListener, sameKeys } from './input/key-listener';\nimport { PointerListener } from './input/pointer-listener';\nimport {\n    canvasBounds,\n    convertToAlphaChannelCanvas,\n    copyCanvas,\n    createCheckerCanvas,\n    createCheckerDataUrl,\n    ctx,\n    drawTransformedImageOnCanvas,\n    drawTransformedImageWithBounds,\n    freeCanvas,\n    resizeCanvas,\n    testShouldPixelate,\n} from './base/canvas';\nimport { Matrix } from './math/matrix';\nimport { Vec2 } from './math/vec2';\nimport {\n    BezierLine,\n    PointLine,\n    powerSplineInput,\n    projectPointOnLine,\n    SplineInterpolator,\n} from './math/line';\nimport { CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast } from './color/color';\nimport {\n    appendTextDiv,\n    clearSelection,\n    destroyEl,\n    el,\n    isInputFocused,\n    unfocusAnyInput,\n} from './base/ui';\nimport {\n    boundsInArea,\n    clamp,\n    dist,\n    distSquared,\n    intDxy,\n    isInsideRect,\n    lenSquared,\n    mix,\n    pointsToAngleDeg,\n    pointsToAngleRad,\n    rotate,\n    rotateAround,\n    round,\n    roundEven,\n    roundUneven,\n    updateBounds,\n} from './math/math';\nimport { createCanvas } from './base/create-canvas';\nimport { BbLog } from './base/bb-log';\nimport { LocalStorage } from './base/local-storage';\nimport { CoalescedExploder } from './input/event-chain/coalesced-exploder';\nimport { NFingerTapper } from './input/event-chain/n-finger-tapper';\nimport { PinchZoomer } from './input/event-chain/pinch-zoomer';\nimport { DoubleTapper } from './input/event-chain/double-tapper';\nimport { OnePointerLimiter } from './input/event-chain/one-pointer-limiter';\nimport { EventChain } from './input/event-chain/event-chain';\n\nexport const BB = {\n    // ---- browser ----\n    eventUsesHighResTimeStamp: EVENT_USES_HIGH_RES_TIMESTAMP,\n    hasPointerEvents: HAS_POINTER_EVENTS,\n    isCssMinMaxSupported: IS_CSS_MIN_MAX_SUPPORTED,\n    canShareFiles: canShareFiles,\n    unsetEventHandler,\n\n    // ---- base ----\n    insertAfter,\n    loadImage,\n    css,\n    setAttributes,\n    append,\n    fitInto,\n    centerWithin,\n    getDate,\n    gcd,\n    reduce,\n    decToFraction,\n    imageBlobToUrl,\n    dateDayDifference,\n    copyObj,\n    shareCanvas,\n    handleClick,\n    createSvg,\n    BbLog,\n    LocalStorage,\n    throwIfNull,\n    nullToUndefined,\n    isDark,\n\n    // ---- math ----\n    mix,\n    dist,\n    distSquared,\n    lenSquared,\n    pointsToAngleRad,\n    pointsToAngleDeg,\n    isInsideRect,\n    clamp,\n    rotate,\n    rotateAround,\n    Matrix,\n    Vec2,\n    intDxy,\n    roundEven,\n    roundUneven,\n    round,\n    updateBounds,\n    boundsInArea,\n\n    // ---- line ----\n    projectPointOnLine,\n    PointLine,\n    BezierLine,\n    SplineInterpolator,\n    powerSplineInput,\n\n    // ---- canvas ----\n    canvas: createCanvas,\n    ctx,\n    copyCanvas,\n    testShouldPixelate,\n    drawTransformedImageWithBounds,\n    drawTransformedImageOnCanvas,\n    createCheckerCanvas,\n    createCheckerDataUrl,\n    resizeCanvas,\n    convertToAlphaChannelCanvas,\n    freeCanvas,\n    canvasBounds,\n\n    // ---- color ----\n    HSV,\n    RGB,\n    CMYK,\n    ColorConverter,\n    testIsWhiteBestContrast,\n\n    // ---- UI ----\n    appendTextDiv,\n    clearSelection,\n    el,\n    destroyEl,\n    isInputFocused,\n    unfocusAnyInput,\n\n    // ---- events / input ----\n\n    KeyListener,\n    PointerListener,\n    sameKeys,\n\n    EventChain,\n    DoubleTapper,\n    NFingerTapper,\n    PinchZoomer,\n    CoalescedExploder,\n    OnePointerLimiter,\n};\n\nObject.keys(BB); // without this, parcel build may break this object\n","import { TKeyString, TSize2D, TSvg, TVector2D } from '../bb-types';\n\nexport function insertAfter(referenceNode: Element, newNode: Element): void {\n    if (referenceNode.parentNode) {\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n    }\n}\n\nexport function loadImage(im: HTMLImageElement, callback: () => void): void {\n    let counter = 0;\n\n    function check(): void {\n        if (counter === 1000) {\n            alert(\"couldn't load\");\n            return;\n        }\n        if (im.complete) {\n            counter++;\n            callback();\n        } else {\n            setTimeout(check, 1);\n        }\n    }\n\n    check();\n}\n\nexport function asyncLoadImage(src: string): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.onload = () => resolve(img);\n        img.onerror = reject;\n        img.src = src;\n    });\n}\n\nexport function css(el: HTMLElement | SVGElement, styleObj: Partial<CSSStyleDeclaration>): void {\n    const elStyle: any = el.style;\n    Object.keys(styleObj).forEach((key) => {\n        const property = key as keyof CSSStyleDeclaration;\n        elStyle[property] = styleObj[property];\n        if (property === 'userSelect') {\n            elStyle.webkitUserSelect = styleObj[property]; // Safari support\n        }\n    });\n}\n\nexport function setAttributes(el: Element, attrObj: TKeyString): void {\n    const keyArr = Object.keys(attrObj);\n    let keyStr;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        el.setAttribute(keyStr, attrObj[keyStr]);\n    }\n}\n\n/**\n * append a list to DOM element\n */\nexport function append(target: HTMLElement, els: (HTMLElement | string | undefined)[]): void {\n    const fragment = document.createDocumentFragment();\n    els.forEach((item) => item && fragment.append(item));\n    target.append(fragment);\n}\n\n/**\n * a needs to fit into b\n */\nexport function fitInto(aw: number, ah: number, bw: number, bh: number, min?: number): TSize2D {\n    let width = aw * bw,\n        height = ah * bw;\n    if (width > bw) {\n        height = (bw / width) * height;\n        width = bw;\n    }\n    if (height > bh) {\n        width = (bh / height) * width;\n        height = bh;\n    }\n    if (min) {\n        width = Math.max(min, width);\n        height = Math.max(min, height);\n    }\n    return { width, height };\n}\n\n/**\n * center b in a\n * @param aw\n * @param ah\n * @param bw\n * @param bh\n */\nexport function centerWithin(aw: number, ah: number, bw: number, bh: number): TVector2D {\n    return {\n        x: aw / 2 - bw / 2,\n        y: ah / 2 - bh / 2,\n    };\n}\n\nexport function getDate(): string {\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\n    const day = date.getDate().toString().padStart(2, '0');\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, '0');\n\n    return year + '_' + month + '_' + day + '_' + minutes + '_';\n}\n\nexport function gcd(a: number, b: number): number {\n    return b ? gcd(b, a % b) : a;\n}\n\nexport function reduce(numerator: number, denominator: number): [number, number] {\n    const g = gcd(numerator, denominator);\n    return [numerator / g, denominator / g];\n}\n\nexport function decToFraction(decimalNumber: number): [number, number] {\n    const len = decimalNumber.toString().length - 2;\n    const denominator = Math.pow(10, len);\n    const numerator = decimalNumber * denominator;\n    return reduce(numerator, denominator);\n}\n\nexport function isBlob(maybeBlob: unknown): maybeBlob is Blob {\n    return (\n        maybeBlob instanceof Blob || Object.prototype.toString.call(maybeBlob) === '[object Blob]'\n    );\n}\n\n/**\n * blobObj isn't always a Blob, but rather an object, because Blob doesn't exist.\n * @param blobObj\n * @returns {string}\n */\nexport function imageBlobToUrl(blobObj: Blob): string {\n    if (!blobObj) {\n        throw new Error('blobObj is undefined or null');\n    }\n    if (window.Blob && blobObj instanceof Blob) {\n        return URL.createObjectURL(blobObj); // object url\n    } else if (blobObj.constructor.name === 'Object') {\n        const fauxBlob = blobObj as unknown as {\n            type: string;\n            encoding: string;\n            data: string;\n        };\n        return 'data:' + fauxBlob.type + ';' + fauxBlob.encoding + ',' + fauxBlob.data; // data url\n    } else {\n        throw new Error('unknown blob format');\n    }\n}\n\nexport function dateDayDifference(dateA: string | Date, dateB: string | Date): number {\n    dateA = new Date(dateA);\n    dateB = new Date(dateB);\n    dateA.setHours(0, 0, 0, 0);\n    dateB.setHours(0, 0, 0, 0);\n    return (dateB.getTime() - dateA.getTime()) / (1000 * 60 * 60 * 24);\n}\n\nexport function copyObj<T>(obj: T): T {\n    return JSON.parse(JSON.stringify(obj));\n}\n\n/**\n * triggers Web Share API - share feature on mobile devices\n * Only works if they support file sharing - e.g. Safari can't do this yet\n * only call if BB.canShareFiles() -> true\n *\n * p = {\n *     canvas: Canvas,\n *     fileName: string,\n *     title: string\n * }\n *\n * @param p\n */\nexport function shareCanvas(p: {\n    canvas: HTMLCanvasElement;\n    fileName: string;\n    title: string;\n    callback: () => void;\n}): void {\n    const mimetype = 'image/png';\n    const err = (): void => alert('sharing not supported');\n    p.canvas.toBlob(function (blob) {\n        if (!blob) {\n            err();\n            p.callback();\n            return;\n        }\n        try {\n            const filesArray = [new File([blob], p.fileName, { type: mimetype })];\n            navigator\n                .share({\n                    title: p.title,\n                    files: filesArray,\n                } as any)\n                .then(() => {})\n                .catch(() => {\n                    err();\n                });\n        } catch (e) {\n            err();\n        }\n        p.callback();\n    }, mimetype);\n}\n\n/**\n * Prevent ipad from zooming in when double tapping. iPadOS 13 bug.\n * Give it your click event\n *\n * Can have GLOBAL EFFECT!\n *\n * @param clickEvent\n * @returns {boolean}\n */\nexport function handleClick(clickEvent: Event): boolean {\n    const target: HTMLElement | null = clickEvent.target as HTMLElement;\n    if (!target) {\n        return false;\n    }\n    let el: HTMLElement | null = target;\n    while (el) {\n        if (['A', 'LABEL', 'INPUT', 'SUMMARY'].includes(el.tagName)) {\n            return true;\n        }\n        el = el.parentElement;\n    }\n    clickEvent.preventDefault();\n    return false;\n}\n\nexport function createSvg(p: TSvg): SVGElement {\n    const result = document.createElementNS('http://www.w3.org/2000/svg', p.elementType);\n    Object.entries(p).forEach(([keyStr, item]) => {\n        if (keyStr === 'childrenArr') {\n            (item as TSvg[]).forEach((child) => {\n                result.append(createSvg(child));\n            });\n        } else if (keyStr === 'css') {\n            css(result, item as Partial<CSSStyleDeclaration>);\n        } else if (keyStr !== 'elementType') {\n            result.setAttribute(keyStr, item as string);\n        }\n    });\n    return result;\n}\n\nexport function throwIfNull<T>(v: T | null): T {\n    // (disabled) eslint-disable-next-line no-null/no-null\n    if (v === null) {\n        throw new Error('value is null');\n    }\n    return v;\n}\n\nexport function throwIfUndefined<T>(v: T | undefined, message = 'value is undefined'): T {\n    if (v === undefined) {\n        throw new Error(message);\n    }\n    return v;\n}\n\nexport function nullToUndefined<T>(v: T | null): T | undefined {\n    return v === null ? undefined : v;\n}\n\nconst matchMediaDark =\n    'matchMedia' in window ? window.matchMedia('(prefers-color-scheme: dark)') : false;\n\nexport function isDark(): boolean {\n    return matchMediaDark && matchMediaDark.matches;\n}\n\nexport function addIsDarkListener(func: () => void): void {\n    matchMediaDark &&\n        'addEventListener' in matchMediaDark &&\n        matchMediaDark.addEventListener('change', func);\n}\n\nexport function removeIsDarkListener(func: () => void): void {\n    matchMediaDark &&\n        'removeEventListener' in matchMediaDark &&\n        matchMediaDark.removeEventListener('change', func);\n}\n\nexport function base64ToBlob(base64Str: string): Blob {\n    const parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/) as [\n        string,\n        string,\n        string,\n        string,\n    ];\n    const binStr = atob(parts[3]);\n    const buf = new ArrayBuffer(binStr.length);\n    const view = new Uint8Array(buf);\n    for (let i = 0; i < view.length; i++) {\n        view[i] = binStr.charCodeAt(i);\n    }\n    return new Blob([view], { type: parts[1] });\n}\n\nexport function createArray<T>(length: number, fillValue: T): T[] {\n    return new Array(length).fill(fillValue);\n}\n\nexport function randomUuid(): string {\n    if ('randumUUID' in crypto) {\n        return crypto.randomUUID();\n    }\n    // fallback just for dev\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n        const r = (Math.random() * 16) | 0,\n            v = c === 'x' ? r : (r & 0x3) | 0x8;\n        return v.toString(16);\n    });\n}\n\nexport function sleep(ms: number) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\n// if a promise takes too long\nexport async function timeoutWrapper<G>(\n    promise: Promise<G>,\n    name: string,\n    timeoutMs: number = 5000,\n): Promise<G> {\n    return Promise.race<G>([\n        promise,\n        new Promise((_, reject) => {\n            setTimeout(() => reject(new Error(`Promise \"${name}\" timed out.`)), timeoutMs);\n        }),\n    ]);\n}\n\nexport async function loadSvg(url: string): Promise<SVGSVGElement> {\n    const response = await fetch(url);\n    const svgText = await response.text();\n\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(svgText, 'image/svg+xml');\n    const svg = doc.querySelector('svg');\n\n    if (!svg) {\n        throw new Error('No <svg> found in the file');\n    }\n\n    // Optional: Clone to prevent reusing the same node\n    return svg.cloneNode(true) as SVGSVGElement;\n}\n","export const IS_FIREFOX = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n\nexport const EVENT_USES_HIGH_RES_TIMESTAMP = (function (): () => boolean {\n    const eventUsesHighResTimeStamp: boolean = new Event('').timeStamp < 1000 * 60 * 60;\n    return function (): boolean {\n        return eventUsesHighResTimeStamp;\n    };\n})();\n\nexport const HAS_POINTER_EVENTS = !!window.PointerEvent;\n\nexport const IS_CSS_MIN_MAX_SUPPORTED = (function (): () => boolean {\n    let result: boolean | undefined;\n\n    function test(): void {\n        const div = document.createElement('div');\n        div.style.position = 'absolute';\n        div.style.top = '0';\n        div.style.left = 'max(0px, 25px)';\n        document.body.append(div);\n        setTimeout(function () {\n            result = div.offsetLeft === 25;\n            div.remove();\n        }, 25);\n    }\n\n    if (document.body) {\n        test();\n    } else {\n        window.addEventListener('DOMContentLoaded', function () {\n            test();\n        });\n    }\n\n    return function (): boolean {\n        if (result === undefined) {\n            throw new Error('isCssMinMaxSupported not initialized');\n        }\n        return result;\n    };\n})();\n\nexport const canShareFiles = function (): boolean {\n    return 'share' in navigator && 'canShare' in navigator;\n};\n\ntype THandler = 'onchange' | 'onclick' | 'onkeyup';\nexport function unsetEventHandler(obj: HTMLElement, ...handlers: [...THandler[]]): void {\n    handlers.forEach((handler) => {\n        // (disabled) eslint-disable-next-line no-null/no-null\n        obj[handler] = null;\n    });\n}\n\nexport function printStorageQuota(): void {\n    navigator.storage.estimate().then((estimate) => {\n        if (estimate.quota === undefined || estimate.usage === undefined) {\n            console.log('no quota info');\n            return;\n        }\n        console.log(\n            `using ${((estimate.usage / estimate.quota) * 100).toFixed(2)}% of total quota`,\n        );\n\n        console.log('usage (GB)', (estimate.usage / 1024 / 1024 / 1024).toFixed(2));\n        console.log('quota (GB)', (estimate.quota / 1024 / 1024 / 1024).toFixed(2));\n    });\n}\n","import { TKeyString } from '../bb-types';\n\ntype TGlobalKey = {\n    add: (keyListenerRef: TKeyListenerRef) => void;\n    remove: (keyListenerRef: TKeyListenerRef) => void;\n    getIsDown: () => TIsDown;\n    getCombo: () => string[];\n    blur: () => void;\n};\n\ntype TIsDown = {\n    [key: string]: boolean;\n};\n\nexport type TOnKeyDown = (\n    keyStr: string,\n    e: KeyboardEvent,\n    comboStr: string,\n    isRepeat?: boolean,\n) => void;\nexport type TOnKeyUp = (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\nexport type TOnBlur = () => void;\ntype TKeyListenerRef = [TOnKeyDown | undefined, TOnKeyUp | undefined, TOnBlur | undefined];\n\nconst globalKey = ((): TGlobalKey => {\n    // keyStr - our key naming system\n    // key - KeyboardEvent.key\n    // code - KeyboardEvent.code\n\n    const keyStrToKeyObj = {\n        // keyStr not to contain a '+', because that's used for the comboStr\n        space: [' ', 'Spacebar'], // Spacebar in IE\n        alt: ['Alt', 'AltGraph'],\n        shift: 'Shift',\n        ctrl: 'Control',\n        cmd: ['Meta', 'MetaLeft', 'MetaRight'],\n        enter: 'Enter',\n        esc: 'Escape',\n        backspace: 'Backspace',\n        delete: 'Delete',\n        sqbr_open: '[',\n        sqbr_close: ']',\n        a: ['a', 'A'],\n        b: ['b', 'B'],\n        c: ['c', 'C'],\n        e: ['e', 'E'],\n        f: ['f', 'F'],\n        g: ['g', 'G'],\n        l: ['l', 'L'],\n        r: ['r', 'R'], // when holding shift\n        s: ['s', 'S'],\n        t: ['t', 'T'],\n        u: ['u', 'U'],\n        x: ['x', 'X'],\n        y: ['y', 'Y'],\n        z: ['z', 'Z'],\n        plus: '+',\n        minus: '-',\n        left: 'ArrowLeft',\n        right: 'ArrowRight',\n        up: 'ArrowUp',\n        down: 'ArrowDown',\n        home: 'Home',\n        end: 'End',\n    };\n\n    // ['space', 'alt', ... ]\n    const keyStrArr = Object.keys(keyStrToKeyObj);\n\n    // { space: false, ... }\n    const isDownObj: TIsDown = Object.entries(keyStrToKeyObj).reduce((acc, [key]) => {\n        acc[key] = false;\n        return acc;\n    }, {} as TIsDown);\n\n    // event.key to keyStr\n    // { ArrowLeft: 'left', ... }\n    const keyToKeyStrObj = Object.entries(keyStrToKeyObj).reduce((acc, [key, code]) => {\n        if (typeof code === 'string') {\n            acc[code] = key;\n        } else {\n            code.forEach((item) => {\n                acc[item] = key;\n            });\n        }\n        return acc;\n    }, {} as TKeyString);\n\n    let comboArr: string[] = [];\n\n    // a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\n    // { KeyE: 'e', KeyF: undefined } - undefined - not down, string - the associated keyStr\n    let codeIsDownObj: {\n        [key: string]: string | undefined;\n    } = {};\n    const listenerArr: TKeyListenerRef[] = [];\n\n    /**\n     * Windows bug in all browsers: Pressing the Windows key leads to keyboard events not firing.\n     * It breaks key state tracking.\n     * Workaround: If after a timeout, only the meta key is pressed, fire a keyup for the meta key.\n     */\n    let metaClearTimeout: ReturnType<typeof setTimeout> | undefined;\n    const setupMetaClear = (keyStr: string, code: string) => {\n        metaClearTimeout = setTimeout(() => {\n            if (comboArr.length !== 1 || comboArr[0] === 'cmd') {\n                return;\n            }\n            const oldComboStr = comboArr.join('+');\n            isDownObj[keyStr] = false;\n            codeIsDownObj[code] = undefined;\n            // remove from combo\n            for (let i = 0; i < comboArr.length; i++) {\n                if (comboArr[i] == keyStr) {\n                    comboArr.splice(i, 1);\n                    i--;\n                }\n            }\n            emitUp(\n                keyStr,\n                {\n                    preventDefault: function () {},\n                    stopPropagation: function () {},\n                } as KeyboardEvent,\n                oldComboStr,\n            );\n            metaClearTimeout = undefined;\n        }, 1000);\n    };\n\n    const emitDown: TOnKeyDown = function (a, b, c, d?): void {\n        listenerArr.forEach((item) => {\n            if (!item[0]) {\n                return;\n            }\n            item[0](a, b, c, d);\n        });\n    };\n\n    const emitUp: TOnKeyUp = function (a, b, c): void {\n        listenerArr.forEach((item) => {\n            if (!item[1]) {\n                return;\n            }\n            item[1](a, b, c);\n        });\n    };\n\n    const emitBlur: TOnBlur = function (): void {\n        listenerArr.forEach((item) => {\n            if (!item[2]) {\n                return;\n            }\n            item[2]();\n        });\n    };\n\n    function keyDown(e: KeyboardEvent): void {\n        const key = e.key;\n        const code = e.code;\n\n        if (key in keyToKeyStrObj) {\n            const keyStr = keyToKeyStrObj[key];\n            if (isDownObj[keyStr]) {\n                emitDown(keyStr, e, comboArr.join('+'), true);\n                return;\n            } else {\n                if (keyStr === 'cmd') {\n                    setupMetaClear(keyStr, code);\n                } else {\n                    clearTimeout(metaClearTimeout);\n                }\n                if (keyStr === 'esc') {\n                    // Workaround for a macOS behavior\n                    // When in fullscreen, pressing escape exits the fullscreen mode.\n                    // When that happens, no keyup for escape is fired.\n                    setTimeout(() => blur());\n                }\n            }\n            isDownObj[keyStr] = true;\n            codeIsDownObj[code] = keyStr;\n\n            //add to combo\n            comboArr.push(keyStr);\n\n            emitDown(keyStr, e, comboArr.join('+'));\n        }\n    }\n\n    function keyUp(e: KeyboardEvent): void {\n        const code = e.code;\n        const oldComboStr = comboArr.join('+');\n\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\n        if (\n            [\n                'Meta',\n                'MetaLeft',\n                'MetaRight',\n                'OSLeft',\n                'OSRight', // Firefox\n            ].includes(code)\n        ) {\n            blur();\n            return;\n        } else if (isDownObj['cmd']) {\n            // Workaround for Windows bug. Windows doesn't fire keyup for Meta key when pressing Windows Key + Space,\n            // neither does it fire blur\n            blur();\n            return;\n        }\n\n        const keyStr = codeIsDownObj[code];\n        if (keyStr !== undefined) {\n            isDownObj[keyStr] = false;\n            codeIsDownObj[code] = undefined;\n\n            // remove from combo\n            for (let i = 0; i < comboArr.length; i++) {\n                if (comboArr[i] == keyStr) {\n                    comboArr.splice(i, 1);\n                    i--;\n                }\n            }\n\n            emitUp(keyStr, e, oldComboStr);\n        }\n    }\n\n    function blur(): void {\n        const oldComboStr = comboArr.join('+');\n        comboArr = [];\n        codeIsDownObj = {};\n\n        const eventArr: string[] = [];\n        keyStrArr.forEach((keyStr) => {\n            if (isDownObj[keyStr]) {\n                isDownObj[keyStr] = false;\n                eventArr.push(keyStr);\n            }\n        });\n        for (let i = 0; i < eventArr.length; i++) {\n            emitUp(\n                eventArr[i],\n                {\n                    preventDefault: function () {},\n                    stopPropagation: function () {},\n                } as KeyboardEvent,\n                oldComboStr,\n            );\n        }\n        emitBlur();\n    }\n\n    return {\n        add: (keyListenerRef: TKeyListenerRef): void => {\n            if (listenerArr.includes(keyListenerRef)) {\n                return;\n            }\n            const first = listenerArr.length === 0;\n            listenerArr.push(keyListenerRef);\n\n            if (first) {\n                document.addEventListener('keydown', keyDown);\n                document.addEventListener('keyup', keyUp);\n                window.addEventListener('blur', blur);\n            }\n        },\n        remove: (keyListenerRef: TKeyListenerRef): void => {\n            if (!listenerArr.includes(keyListenerRef)) {\n                return;\n            }\n            const last = listenerArr.length === 1;\n            for (let i = 0; i < listenerArr.length; i++) {\n                if (listenerArr[i] === keyListenerRef) {\n                    listenerArr.splice(i, 1);\n                    break;\n                }\n            }\n            if (last) {\n                document.removeEventListener('keydown', keyDown);\n                document.removeEventListener('keyup', keyUp);\n                window.removeEventListener('blur', blur);\n            }\n        },\n        getIsDown: (): TIsDown => isDownObj,\n        getCombo: (): string[] => comboArr,\n        blur,\n    };\n})();\n\nexport type TKeyListenerParams = {\n    onDown?: TOnKeyDown;\n    onUp?: TOnKeyUp;\n    onBlur?: TOnBlur; // on window blur\n};\n\n/**\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\n *\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\n * comboStr - string joins currently pressed keyStr with a +\n *              e.g. 'ctrl+z'\n *\n */\nexport class KeyListener {\n    private readonly onDown: TOnKeyDown | undefined;\n    private readonly onUp: TOnKeyUp | undefined;\n    private readonly onBlur: TOnBlur | undefined;\n    private readonly ref: TKeyListenerRef;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TKeyListenerParams) {\n        this.onDown = p.onDown;\n        this.onUp = p.onUp;\n        this.onBlur = p.onBlur;\n        this.ref = [this.onDown, this.onUp, this.onBlur];\n        globalKey.add(this.ref);\n    }\n\n    isPressed(keyStr: string): boolean {\n        if (!(keyStr in globalKey.getIsDown())) {\n            throw 'key \"' + keyStr + '\" not found';\n        }\n        return globalKey.getIsDown()[keyStr];\n    }\n\n    getComboStr(): string {\n        return globalKey.getCombo().join('+');\n    }\n\n    comboOnlyContains(keyStrArr: string[]): boolean {\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    destroy(): void {\n        globalKey.remove(this.ref);\n        globalKey.blur();\n    }\n}\n\n/**\n * Test, are the same keys pressed. Order does not matter.\n */\nexport function sameKeys(comboAStr: string, comboBStr: string): boolean {\n    return comboAStr.split('+').sort().join('+') === comboBStr.split('+').sort().join('+');\n}\n","import { EVENT_USES_HIGH_RES_TIMESTAMP, HAS_POINTER_EVENTS, IS_FIREFOX } from '../base/browser';\nimport { TWheelCleanerEvent, WheelCleaner } from './wheel-cleaner';\nimport {\n    TPointerButton,\n    TPointerEvent,\n    TPointerEventType,\n    TPointerType,\n    TWheelEvent,\n} from './event.types';\nimport { PressureNormalizer } from './pressure-normalizer';\n\nexport type TPointerListenerParams = {\n    target: HTMLElement | SVGElement;\n    onPointer?: (pointerEvent: TPointerEvent) => void;\n    onWheel?: (wheelEvent: TWheelEvent) => void;\n    useDirtyWheel?: boolean; // default false - use dirty wheel events - not just increments of 1\n    isWheelPassive?: boolean; // default false\n    onEnterLeave?: (isOver: boolean) => void; // optional\n    maxPointers?: number; // int [1,n] default is 1 - how many concurrent pointers to pay attention to\n    fixScribble?: boolean; // fix ipad scribble issue - TODO remove, fixed start of 2022 -> https://bugs.webkit.org/show_bug.cgi?id=217430#c2\n};\n\ntype TPointer = {\n    pointerId: number;\n    lastPageX: number | null;\n    lastPageY: number | null;\n};\n\ntype TDragObj = {\n    pointerId: number; // long\n    pointerType?: TPointerType;\n    downPageX: number; //where was pointer when down-event occurred\n    downPageY: number;\n    buttons: number; // long\n    lastPageX: number; //pageX in previous event - only for touch events, because they don't have movementX/Y\n    lastPageY: number;\n    lastTimeStamp?: number;\n};\n\ntype TCoalescedPointerEvent = {\n    pageX: number;\n    pageY: number;\n    clientX: number;\n    clientY: number;\n    movementX: number;\n    movementY: number;\n    timeStamp: number;\n    pressure: number;\n};\n\ntype TCorrectedPointerEvent = {\n    pointerId: number;\n    pointerType: string;\n    pageX: number;\n    pageY: number;\n    clientX: number;\n    clientY: number;\n    movementX: number;\n    movementY: number;\n    timeStamp: number;\n    pressure: number; // normalized\n    buttons: number;\n    button: number;\n    coalescedArr: TCoalescedPointerEvent[];\n    eventPreventDefault: () => void;\n    eventStopPropagation: () => void;\n};\n\ntype TExtendedDOMPointerEvent = PointerEvent & {\n    corrected: TCorrectedPointerEvent;\n};\n\n// keeping track of pointers for movement fallback\nconst pointerArr: TPointer[] = [];\n\nfunction addPointer(event: TCorrectedPointerEvent): TPointer {\n    const pointerObj: TPointer = {\n        pointerId: event.pointerId,\n        lastPageX: null,\n        lastPageY: null,\n    };\n    pointerArr.push(pointerObj);\n\n    if (pointerArr.length > 15) {\n        pointerArr.shift();\n    }\n\n    return pointerObj;\n}\n\nfunction getPointer(event: TCorrectedPointerEvent): TPointer | null {\n    for (let i = pointerArr.length - 1; i >= 0; i--) {\n        if (event.pointerId === pointerArr[i].pointerId) {\n            return pointerArr[i];\n        }\n    }\n    return null;\n}\n\nfunction getButtonStr(buttons: number): TPointerButton | undefined {\n    switch (buttons) {\n        case 1:\n            return 'left';\n        case 2:\n            return 'right';\n        case 4:\n            return 'middle';\n        default:\n            return undefined;\n    }\n}\n\nconst pressureNormalizer = new PressureNormalizer();\nconst timeStampOffset = EVENT_USES_HIGH_RES_TIMESTAMP() ? 0 : -performance.timing.navigationStart;\n\nconst pointerDownEvt = (HAS_POINTER_EVENTS ? 'pointerdown' : 'mousedown') as 'pointerdown';\nconst pointerMoveEvt = (HAS_POINTER_EVENTS ? 'pointermove' : 'mousemove') as 'pointermove';\nconst pointerUpEvt = (HAS_POINTER_EVENTS ? 'pointerup' : 'mouseup') as 'pointerup';\nconst pointerCancelEvt = (HAS_POINTER_EVENTS ? 'pointercancel' : 'mousecancel') as 'pointercancel';\nconst pointerLeaveEvt = (HAS_POINTER_EVENTS ? 'pointerleave' : 'mouseleave') as 'pointerleave';\nconst pointerEnterEvt = (HAS_POINTER_EVENTS ? 'pointerenter' : 'mouseenter') as 'pointerenter';\n\n/**\n * More trustworthy pointer attributes. that behave the same across browsers.\n * returns a new object. Also attaches itself to the orig event. -> event.corrected\n */\nfunction correctPointerEvent(\n    event: PointerEvent | TExtendedDOMPointerEvent,\n): TCorrectedPointerEvent {\n    if ('corrected' in event) {\n        return event.corrected;\n    }\n\n    function determineButtons(): number {\n        if (event.buttons !== undefined) {\n            return event.buttons;\n        }\n        /*\n                button -> buttons\n        none:\tundefined -> 0\n        left:\t0 -> 1\n        middle:\t1 -> 4\n        right:\t2 -> 2\n        fourth:\t3 -> 8\n        fifth:\t4 -> 16\n         */\n        if (event.button !== undefined) {\n            // old safari on mac has no buttons. remove eventually.\n            return [1, 4, 2, 8, 16][event.button];\n        }\n        return 0;\n    }\n\n    const correctedObj: TCorrectedPointerEvent = {\n        pointerId: event.pointerId,\n        pointerType: event.pointerType,\n        pageX: event.pageX,\n        pageY: event.pageY,\n        clientX: event.clientX,\n        clientY: event.clientY,\n        movementX: event.movementX,\n        movementY: event.movementY,\n        timeStamp: event.timeStamp + timeStampOffset,\n        pressure: pressureNormalizer.normalize(event.pressure, event.type, event.pointerType),\n        buttons: determineButtons(),\n        button: event.button,\n        coalescedArr: [],\n        eventPreventDefault: () => event.preventDefault(),\n        eventStopPropagation: () => event.stopPropagation(),\n    };\n    (event as TExtendedDOMPointerEvent).corrected = correctedObj;\n\n    let customPressure = null;\n    if ('pointerId' in event) {\n        if ('pressure' in event && event.buttons !== 0) {\n            if (event.pointerType === 'touch' && event.pressure === 0) {\n                correctedObj.pressure = 1;\n                customPressure = 1;\n            }\n            // Spec: If there's no pressure support, pressure is 0.5.\n            // https://w3c.github.io/pointerevents/#dom-pointerevent-pressure\n            // & in older Safari (<=16) it seems to be \"mouse\" and 0.\n            if (event.pointerType === 'mouse' && (event.pressure === 0.5 || event.pressure === 0)) {\n                correctedObj.pressure = 1;\n                customPressure = 1;\n            }\n        }\n    } else {\n        correctedObj.pointerId = 0;\n        correctedObj.pointerType = 'mouse';\n        correctedObj.pressure = (event as PointerEvent).buttons !== 0 ? 1 : 0;\n        customPressure = correctedObj.pressure;\n    }\n\n    if (\n        IS_FIREFOX &&\n        event.pointerType != 'mouse' &&\n        event.type === 'pointermove' &&\n        event.buttons === 0\n    ) {\n        // once again firefox\n        correctedObj.buttons = 1; // todo wrong if no buttons actually pressed\n    }\n\n    let coalescedEventArr: PointerEvent[] = [];\n    if ('getCoalescedEvents' in event) {\n        coalescedEventArr = event.getCoalescedEvents();\n    }\n\n    // chrome somehow movementX not same scale as pageX. todo: only chrome?\n    // so make my own\n\n    const pointerObj: TPointer = getPointer(correctedObj) || addPointer(correctedObj);\n\n    const totalLastX = pointerObj.lastPageX;\n    const totalLastY = pointerObj.lastPageY;\n\n    for (let i = 0; i < coalescedEventArr.length; i++) {\n        const eventItem = coalescedEventArr[i];\n\n        correctedObj.coalescedArr.push({\n            pageX: eventItem.pageX,\n            pageY: eventItem.pageY,\n            clientX: eventItem.clientX,\n            clientY: eventItem.clientY,\n            movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\n            movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\n            timeStamp:\n                eventItem.timeStamp === 0\n                    ? correctedObj.timeStamp\n                    : eventItem.timeStamp + timeStampOffset, // 0 in firefox\n            pressure:\n                customPressure === null\n                    ? pressureNormalizer.normalize(eventItem.pressure)\n                    : customPressure,\n        });\n\n        pointerObj.lastPageX = eventItem.pageX;\n        pointerObj.lastPageY = eventItem.pageY;\n    }\n\n    pointerObj.lastPageX = correctedObj.pageX;\n    pointerObj.lastPageY = correctedObj.pageY;\n    correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\n    correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\n\n    return correctedObj;\n}\n\nconst OPTIONS_PASSIVE = {\n    passive: false,\n};\n\n/**\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers.\n * Has some workarounds for browser specific bugs. As browsers evolve this constructor should get smaller.\n */\nexport class PointerListener {\n    private isDestroyed: boolean = false;\n\n    // ts has problems with (HTMLElement|SVGElement) when adding event listeners\n    // https://github.com/microsoft/TypeScript/issues/46819\n    private readonly targetElement: HTMLElement;\n    private readonly onPointerCallback: undefined | ((pointerEvent: TPointerEvent) => void);\n    private readonly onWheelCallback: undefined | ((wheelEvent: TWheelEvent) => void);\n    private readonly onEnterLeaveCallback: undefined | ((isOver: boolean) => void);\n    private readonly maxPointers: number;\n    private readonly wheelCleaner: WheelCleaner | undefined;\n    private isOverCounter: number = 0;\n\n    // pointers that are pressing a button\n    private dragObjArr: TDragObj[] = [];\n    private dragPointerIdArr: number[] = [];\n\n    // chrome input glitch workaround\n    private lastPointerType: TPointerType | null = null;\n    private didSkip: boolean = false;\n\n    // listeners\n    private readonly onPointerEnter: (() => void) | undefined;\n    private readonly onPointerLeave: (() => void) | undefined;\n    private readonly onPointerMove: ((event: PointerEvent) => void) | undefined;\n    private readonly onPointerDown:\n        | ((event: PointerEvent, skipGlobal?: boolean) => void)\n        | undefined;\n    private readonly onWheel: ((e: WheelEvent) => void) | undefined;\n    private readonly onTouchMoveScribbleFix: ((e: TouchEvent) => void) | undefined;\n    private readonly windowOnPointerMove: ((event: PointerEvent) => void) | undefined;\n    private readonly windowOnPointerUp: ((event: PointerEvent) => void) | undefined;\n    private readonly windowOnPointerLeave: ((event: PointerEvent) => void) | undefined;\n    // fallback pre pointer events (iOS < 13, as of 2023-02, still 4.4% of iOS users)\n    private readonly onTouchStart: ((e: TouchEvent) => void) | undefined;\n    private readonly onTouchMove: ((e: TouchEvent) => void) | undefined;\n    private readonly onTouchEnd: ((e: TouchEvent) => void) | undefined;\n    private readonly onTouchCancel: ((e: TouchEvent) => void) | undefined;\n\n    private getDragObj(pointerId: number): TDragObj | null {\n        for (let i = 0; i < this.dragObjArr.length; i++) {\n            if (pointerId === this.dragObjArr[i].pointerId) {\n                return this.dragObjArr[i];\n            }\n        }\n        return null;\n    }\n\n    private removeDragObj(pointerId: number): TDragObj | null {\n        let removedDragObj: TDragObj | null = null;\n        for (let i = 0; i < this.dragPointerIdArr.length; i++) {\n            if (this.dragPointerIdArr[i] === pointerId) {\n                removedDragObj = this.dragObjArr[i];\n                this.dragObjArr.splice(i, 1);\n                this.dragPointerIdArr.splice(i, 1);\n                i--;\n            }\n        }\n        return removedDragObj;\n    }\n\n    /**\n     * Creates a value for onPointer, from a pointer event handler.\n     */\n    private createPointerOutEvent(\n        typeStr: TPointerEventType,\n        correctedEvent: TCorrectedPointerEvent,\n        custom?: Partial<TPointerEvent>,\n    ): TPointerEvent {\n        const bounds: DOMRect = this.targetElement.getBoundingClientRect();\n        const result: TPointerEvent = {\n            type: typeStr,\n            pointerId: correctedEvent.pointerId,\n            pointerType: correctedEvent.pointerType as TPointerType,\n            pageX: correctedEvent.pageX,\n            pageY: correctedEvent.pageY,\n            clientX: correctedEvent.clientX,\n            clientY: correctedEvent.clientY,\n            relX: correctedEvent.clientX - bounds.left + this.targetElement.scrollLeft,\n            relY: correctedEvent.clientY - bounds.top + this.targetElement.scrollTop,\n            dX: correctedEvent.movementX,\n            dY: correctedEvent.movementY,\n            time: correctedEvent.timeStamp,\n            eventPreventDefault: correctedEvent.eventPreventDefault,\n            eventStopPropagation: correctedEvent.eventStopPropagation,\n            ...custom,\n        };\n\n        if (typeStr === 'pointermove') {\n            result.coalescedArr = [];\n            if (correctedEvent.coalescedArr.length > 1) {\n                let coalescedItem;\n                for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\n                    coalescedItem = correctedEvent.coalescedArr[i];\n                    result.coalescedArr.push({\n                        pageX: coalescedItem.pageX,\n                        pageY: coalescedItem.pageY,\n                        clientX: coalescedItem.clientX,\n                        clientY: coalescedItem.clientY,\n                        relX: coalescedItem.clientX - bounds.left + this.targetElement.scrollLeft,\n                        relY: coalescedItem.clientY - bounds.top + this.targetElement.scrollTop,\n                        dX: coalescedItem.movementX,\n                        dY: coalescedItem.movementY,\n                        time: coalescedItem.timeStamp,\n                    });\n                }\n            }\n        }\n\n        return result;\n    }\n\n    private setupDocumentListeners() {\n        this.windowOnPointerMove &&\n            document.addEventListener(pointerMoveEvt, this.windowOnPointerMove, OPTIONS_PASSIVE);\n        this.windowOnPointerUp &&\n            document.addEventListener(pointerUpEvt, this.windowOnPointerUp, OPTIONS_PASSIVE);\n        this.windowOnPointerLeave &&\n            document.addEventListener(pointerCancelEvt, this.windowOnPointerLeave, OPTIONS_PASSIVE);\n        this.windowOnPointerLeave &&\n            document.addEventListener(pointerLeaveEvt, this.windowOnPointerLeave, OPTIONS_PASSIVE);\n    }\n\n    private destroyDocumentListeners() {\n        this.windowOnPointerMove &&\n            document.removeEventListener(pointerMoveEvt, this.windowOnPointerMove);\n        this.windowOnPointerUp &&\n            document.removeEventListener(pointerUpEvt, this.windowOnPointerUp);\n        this.windowOnPointerLeave &&\n            document.removeEventListener(pointerCancelEvt, this.windowOnPointerLeave);\n        this.windowOnPointerLeave &&\n            document.removeEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: TPointerListenerParams) {\n        this.targetElement = p.target as HTMLElement;\n        this.onPointerCallback = p.onPointer;\n        this.onWheelCallback = p.onWheel;\n        this.onEnterLeaveCallback = p.onEnterLeave;\n        this.maxPointers = Math.max(1, p.maxPointers ?? 1);\n\n        const finalizeWheelEvent = (e: WheelEvent | TWheelCleanerEvent): void => {\n            if (this.isDestroyed || !this.onWheelCallback) {\n                return;\n            }\n            const bounds = this.targetElement.getBoundingClientRect();\n            const whlEvent: TWheelEvent = {\n                ...(e instanceof WheelEvent\n                    ? { deltaY: e.deltaY / 120, pageX: e.pageX, pageY: e.pageY }\n                    : e),\n                relX: e.clientX - bounds.left + this.targetElement.scrollLeft,\n                relY: e.clientY - bounds.top + this.targetElement.scrollTop,\n                ...(e instanceof WheelEvent ? { event: e } : {}),\n            };\n            this.onWheelCallback(whlEvent);\n        };\n        this.wheelCleaner = p.useDirtyWheel ? undefined : new WheelCleaner(finalizeWheelEvent);\n\n        if (this.onPointerCallback) {\n            this.onPointerMove = (event: PointerEvent) => {\n                const correctedEvent = correctPointerEvent(event);\n\n                const tempLastPointerType = this.lastPointerType;\n                this.lastPointerType = correctedEvent.pointerType as TPointerType;\n\n                if (\n                    this.dragPointerIdArr.includes(correctedEvent.pointerId) ||\n                    this.dragPointerIdArr.length === this.maxPointers ||\n                    correctedEvent.pointerType === 'touch'\n                ) {\n                    this.didSkip = false;\n                    return;\n                }\n\n                // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\n                if (\n                    !this.didSkip &&\n                    correctedEvent.pointerType === 'mouse' &&\n                    tempLastPointerType === 'pen'\n                ) {\n                    this.didSkip = true;\n                    return;\n                }\n                this.didSkip = false;\n\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent);\n                this.onPointerCallback?.(outEvent);\n            };\n\n            this.onPointerDown = (event: PointerEvent, onSkipGlobal?: boolean) => {\n                //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' pointerdown');\n                if (\n                    this.dragPointerIdArr.includes(correctedEvent.pointerId) ||\n                    this.dragPointerIdArr.length === this.maxPointers ||\n                    ![1, 2, 4].includes(correctedEvent.buttons)\n                ) {\n                    //BB.throwOut('pointerdown ignored');\n                    return;\n                }\n\n                //set up global listeners\n                if (this.dragObjArr.length === 0 && !onSkipGlobal) {\n                    this.setupDocumentListeners();\n                }\n                const dragObj: TDragObj = {\n                    pointerId: correctedEvent.pointerId,\n                    pointerType: correctedEvent.pointerType as TPointerType,\n                    downPageX: correctedEvent.pageX,\n                    downPageY: correctedEvent.pageY,\n                    buttons: correctedEvent.buttons,\n                    lastPageX: correctedEvent.pageX,\n                    lastPageY: correctedEvent.pageY,\n                    lastTimeStamp: correctedEvent.timeStamp,\n                };\n                this.dragObjArr.push(dragObj);\n                this.dragPointerIdArr.push(correctedEvent.pointerId);\n\n                const outEvent: TPointerEvent = this.createPointerOutEvent(\n                    'pointerdown',\n                    correctedEvent,\n                    {\n                        downPageX: correctedEvent.pageX,\n                        downPageY: correctedEvent.pageY,\n                        button: getButtonStr(correctedEvent.buttons),\n                        pressure: correctedEvent.pressure,\n                    },\n                );\n\n                this.onPointerCallback?.(outEvent);\n            };\n\n            this.windowOnPointerMove = (event: PointerEvent) => {\n                //BB.throwOut('pointermove ' + event.pointerId);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\n                if (!this.dragPointerIdArr.includes(correctedEvent.pointerId)) {\n                    return;\n                }\n\n                const dragObj = this.getDragObj(correctedEvent.pointerId);\n\n                if (!dragObj) {\n                    // todo need to handle this!\n                    return;\n                }\n\n                //if pointer changes button its pressing -> turn into pointerup\n                if (correctedEvent.buttons !== dragObj.buttons) {\n                    //pointer up\n\n                    //remove listener\n                    if (this.dragObjArr.length === 1) {\n                        this.destroyDocumentListeners();\n                    }\n                    this.removeDragObj(correctedEvent.pointerId);\n\n                    const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\n                        downPageX: dragObj.downPageX,\n                        downPageY: dragObj.downPageY,\n                    });\n                    this.onPointerCallback?.(outEvent);\n                    return;\n                }\n\n                // ipad likes to do this\n                if (\n                    correctedEvent.pointerType === 'pen' &&\n                    correctedEvent.pageX === dragObj.lastPageX &&\n                    correctedEvent.pageY === dragObj.lastPageY &&\n                    correctedEvent.timeStamp === dragObj.lastTimeStamp\n                ) {\n                    //ignore\n                    return;\n                }\n\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY,\n                    button: getButtonStr(correctedEvent.buttons),\n                    pressure: correctedEvent.pressure,\n                });\n\n                dragObj.lastPageX = correctedEvent.pageX;\n                dragObj.lastPageY = correctedEvent.pageY;\n                dragObj.lastTimeStamp = correctedEvent.timeStamp;\n\n                this.onPointerCallback?.(outEvent);\n            };\n\n            this.windowOnPointerUp = (event: PointerEvent) => {\n                //BB.throwOut('pointerup ' + event.pointerId);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\n                if (!this.dragPointerIdArr.includes(correctedEvent.pointerId)) {\n                    return;\n                }\n\n                //remove listener\n                if (this.dragObjArr.length === 1) {\n                    this.destroyDocumentListeners();\n                }\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\n                if (!dragObj) {\n                    // todo need to handle this!\n                    return;\n                }\n\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY,\n                });\n                this.onPointerCallback?.(outEvent);\n            };\n\n            this.windowOnPointerLeave = (event: PointerEvent) => {\n                //BB.throwOut('pointerleave ' + event.pointerId);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\n                if (!this.dragPointerIdArr.includes(correctedEvent.pointerId)) {\n                    //} || event.target !== document) {\n                    return;\n                }\n\n                //remove listener\n                if (this.dragObjArr.length === 1) {\n                    this.destroyDocumentListeners();\n                }\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\n                if (!dragObj) {\n                    // todo need to handle this!\n                    return;\n                }\n\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY,\n                });\n                this.onPointerCallback?.(outEvent);\n            };\n\n            this.targetElement.addEventListener(\n                pointerMoveEvt,\n                this.onPointerMove,\n                OPTIONS_PASSIVE,\n            );\n            this.targetElement.addEventListener(\n                pointerDownEvt,\n                this.onPointerDown,\n                OPTIONS_PASSIVE,\n            );\n\n            if (!HAS_POINTER_EVENTS) {\n                const touchToFakePointer = (\n                    touch: Touch,\n                    touchEvent: TouchEvent,\n                    isDown: boolean,\n                ) => {\n                    return {\n                        pointerId: touch.identifier,\n                        pointerType: 'touch',\n                        pageX: touch.pageX,\n                        pageY: touch.pageY,\n                        clientX: touch.clientX,\n                        clientY: touch.clientY,\n                        button: isDown ? 0 : undefined,\n                        buttons: isDown ? 1 : 0,\n                        timeStamp: touchEvent.timeStamp,\n                        target: touchEvent.target,\n                        pressure: isDown ? 1 : 0,\n                        preventDefault: () => touchEvent.preventDefault(),\n                        stopPropagation: () => touchEvent.stopPropagation(),\n                    };\n                };\n\n                const handleTouch = (\n                    e: TouchEvent,\n                    type: 'start' | 'move' | 'end' | 'cancel',\n                ): void => {\n                    for (let i = 0; i < e.changedTouches.length; i++) {\n                        const touch = e.changedTouches[i];\n                        const fakePointer = touchToFakePointer(\n                            touch,\n                            e,\n                            ['start', 'move'].includes(type),\n                        );\n                        if (type === 'start') {\n                            this.onPointerDown!(fakePointer as PointerEvent, false);\n                        } else if (type === 'move') {\n                            this.windowOnPointerMove!(fakePointer as PointerEvent);\n                        } else if (type === 'end') {\n                            this.windowOnPointerUp!(fakePointer as PointerEvent);\n                        } else {\n                            this.windowOnPointerLeave!(fakePointer as PointerEvent);\n                        }\n                    }\n                };\n\n                this.onTouchStart = (e: TouchEvent): void => {\n                    e.preventDefault();\n                    handleTouch(e, 'start');\n                };\n                this.onTouchMove = (e: TouchEvent): void => {\n                    handleTouch(e, 'move');\n                };\n                this.onTouchEnd = (e: TouchEvent): void => {\n                    handleTouch(e, 'end');\n                };\n                this.onTouchCancel = (e: TouchEvent): void => {\n                    handleTouch(e, 'cancel');\n                };\n\n                this.targetElement.addEventListener(\n                    'touchstart',\n                    this.onTouchStart,\n                    OPTIONS_PASSIVE,\n                );\n                this.targetElement.addEventListener('touchmove', this.onTouchMove, OPTIONS_PASSIVE);\n                this.targetElement.addEventListener('touchend', this.onTouchEnd, OPTIONS_PASSIVE);\n                this.targetElement.addEventListener(\n                    'touchcancel',\n                    this.onTouchCancel,\n                    OPTIONS_PASSIVE,\n                );\n            }\n        }\n        if (this.onWheelCallback) {\n            this.onWheel = (e: WheelEvent) => {\n                if (this.wheelCleaner) {\n                    this.wheelCleaner.process(e);\n                } else {\n                    finalizeWheelEvent(e);\n                }\n            };\n            this.targetElement.addEventListener('wheel', this.onWheel, {\n                passive: !!p.isWheelPassive,\n            });\n        }\n        if (this.onEnterLeaveCallback) {\n            this.onPointerEnter = () => {\n                this.isOverCounter++;\n                this.onEnterLeaveCallback?.(true);\n            };\n\n            this.onPointerLeave = () => {\n                this.isOverCounter--;\n                this.onEnterLeaveCallback?.(false);\n            };\n\n            this.targetElement.addEventListener(\n                pointerEnterEvt,\n                this.onPointerEnter,\n                OPTIONS_PASSIVE,\n            );\n            this.targetElement.addEventListener(\n                pointerLeaveEvt,\n                this.onPointerLeave,\n                OPTIONS_PASSIVE,\n            );\n        }\n\n        if (p.fixScribble) {\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\n            this.onTouchMoveScribbleFix = (e: TouchEvent) => e.preventDefault();\n            this.targetElement.addEventListener(\n                'touchmove',\n                this.onTouchMoveScribbleFix,\n                OPTIONS_PASSIVE,\n            );\n        }\n    }\n\n    destroy(): void {\n        if (this.isDestroyed) {\n            return;\n        }\n        this.isDestroyed = true;\n        this.onPointerEnter &&\n            this.targetElement.removeEventListener(pointerEnterEvt, this.onPointerEnter);\n        this.onPointerLeave &&\n            this.targetElement.removeEventListener(pointerLeaveEvt, this.onPointerLeave);\n        this.onPointerMove &&\n            this.targetElement.removeEventListener(pointerMoveEvt, this.onPointerMove);\n        this.onPointerDown &&\n            this.targetElement.removeEventListener(pointerDownEvt, this.onPointerDown);\n        this.onWheel && this.targetElement.removeEventListener('wheel', this.onWheel);\n        this.destroyDocumentListeners();\n        this.onTouchMoveScribbleFix &&\n            document.removeEventListener('touchmove', this.onTouchMoveScribbleFix);\n\n        this.onTouchStart &&\n            this.targetElement.removeEventListener('touchstart', this.onTouchStart);\n        this.onTouchMove && this.targetElement.removeEventListener('touchmove', this.onTouchMove);\n        this.onTouchEnd && this.targetElement.removeEventListener('touchend', this.onTouchEnd);\n        this.onTouchCancel &&\n            this.targetElement.removeEventListener('touchcancel', this.onTouchCancel);\n    }\n}\n","export type TWheelCleanerEvent = {\n    deltaY: number;\n    pageX: number;\n    pageY: number;\n    clientX: number;\n    clientY: number;\n};\n\nconst SEQUENCE_TIMEOUT_MS = 200;\n\n/**\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\n * Normalizes regular scrolls.\n *\n * Why:\n * - trackpad scrolling is different from old school mouse scrolling\n * - but there is no way to learn from the browser if it's trackpad scrolling\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\n *      continue an arbitrary amount, at an arbitrary scale\n * - each browser does this differently. So you can't offer a consistent/controlled experience\n *\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\n */\nexport class WheelCleaner {\n    private readonly knownUnitArr: number[] = [100];\n    private sequenceLength: number = 0;\n    private sequenceUnit: null | number = null;\n    private endSequenceTimeout: undefined | ReturnType<typeof setTimeout>;\n    private toEmitDelta: null | number = null;\n    private position: null | {\n        pageX: number;\n        pageY: number;\n        clientX: number;\n        clientY: number;\n    } = null;\n\n    private emit(delta: number): void {\n        if (this.position === null || this.sequenceUnit === null) {\n            return;\n        }\n        this.callback({\n            deltaY: Math.round(delta / this.sequenceUnit),\n            pageX: this.position.pageX,\n            pageY: this.position.pageY,\n            clientX: this.position.clientX,\n            clientY: this.position.clientY,\n        });\n    }\n\n    private endSequence(): void {\n        if (this.toEmitDelta !== null) {\n            this.emit(this.toEmitDelta);\n            this.toEmitDelta = null;\n        }\n        if (this.sequenceUnit !== null && !this.knownUnitArr.includes(this.sequenceUnit)) {\n            this.knownUnitArr.push(this.sequenceUnit);\n        }\n        this.sequenceLength = 0;\n        this.sequenceUnit = null;\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(private callback: (p: TWheelCleanerEvent) => void) {}\n\n    process(event: WheelEvent): void {\n        this.position = {\n            pageX: event.pageX,\n            pageY: event.pageY,\n            clientX: event.clientX,\n            clientY: event.clientY,\n        };\n\n        if (this.endSequenceTimeout) {\n            clearTimeout(this.endSequenceTimeout);\n        }\n        this.endSequenceTimeout = setTimeout(() => this.endSequence(), SEQUENCE_TIMEOUT_MS);\n\n        //prep delta\n        let delta = event.deltaY;\n        if ('deltaMode' in event && event.deltaMode === 1) {\n            delta *= 100 / 3;\n        }\n        const absDelta = Math.abs(delta);\n\n        //sequence begins\n        if (this.sequenceLength === 0) {\n            this.sequenceLength++;\n            if (absDelta < 50) {\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\n                return;\n            }\n\n            this.sequenceUnit = absDelta;\n            if (this.knownUnitArr.includes(this.sequenceUnit)) {\n                //we know this unit - emit right away\n                this.emit(delta);\n            } else {\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\n                this.toEmitDelta = delta;\n            }\n            return;\n        }\n\n        if (this.sequenceUnit === null) {\n            //previously determined dirty sequence\n            this.toEmitDelta = null;\n            return;\n        }\n\n        //sequence continues\n        if (absDelta === 0) {\n            //ignore zero scroll\n            return;\n        }\n        if (\n            absDelta === this.sequenceUnit ||\n            (absDelta / this.sequenceUnit) % 1 < 0.0001 // a multiple\n        ) {\n            //fine\n        } else if ((this.sequenceUnit / absDelta) % 1 < 0.0001) {\n            //unit was actually a multiple - update it\n            this.sequenceUnit = absDelta;\n        } else if (absDelta !== this.sequenceUnit) {\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\n            this.sequenceUnit = null;\n            this.toEmitDelta = null;\n            return;\n        }\n\n        if (this.toEmitDelta !== null) {\n            this.emit(this.toEmitDelta);\n            this.toEmitDelta = null;\n        }\n        this.emit(delta);\n    }\n}\n","/**\n * Apple Pencil on iPad in Safari has two problems:\n * - You need to press the stylus very strong to reach 1.0 pressure, to the point where the screen starts discoloring\n * - Always fires the same pressure value on pointerdown\n *\n * This normalizer tries to fix that with a workaround.\n *\n * pressure range [0, 1]\n */\nexport class PressureNormalizer {\n    private detectionComplete = false;\n    private isApplePencil = false;\n\n    // detection\n    private initialPointerDownPressure = -1;\n    private pointerDownPressureRepeatCount = 0;\n    private pointerMoveHasDifferentPressure = false;\n\n    // ----------------------------------- public -----------------------------------\n    normalize(pressure: number, eventType?: string, pointerType?: string): number {\n        if (pointerType === 'pen') {\n            if (!this.detectionComplete) {\n                if (eventType === 'pointerdown') {\n                    if (this.initialPointerDownPressure === -1) {\n                        this.initialPointerDownPressure = pressure;\n                    } else if (this.initialPointerDownPressure === pressure) {\n                        this.pointerDownPressureRepeatCount++;\n                        if (\n                            this.pointerDownPressureRepeatCount > 1 &&\n                            this.pointerMoveHasDifferentPressure\n                        ) {\n                            this.detectionComplete = true;\n                            this.isApplePencil = true;\n                        }\n                    } else {\n                        this.detectionComplete = true;\n                        this.isApplePencil = false;\n                    }\n                } else if (eventType === 'pointermove') {\n                    if (this.initialPointerDownPressure !== pressure) {\n                        this.pointerMoveHasDifferentPressure = true;\n                    }\n                }\n            }\n\n            if (this.detectionComplete && this.isApplePencil) {\n                if (this.initialPointerDownPressure === pressure) {\n                    return 0;\n                }\n                pressure = Math.min(2, pressure * 2);\n            }\n            return pressure;\n        } else {\n            return pressure;\n        }\n    }\n}\n","import { TBounds, TKeyString, TRect } from '../bb-types';\nimport { createCanvas } from './create-canvas';\nimport { asyncLoadImage, base64ToBlob, copyObj } from './base';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { getSelectionPath2d } from '../multi-polygon/get-selection-path-2d';\n\nexport function copyCanvas(canvas: HTMLCanvasElement | HTMLImageElement): HTMLCanvasElement {\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\n    const ctx = resultCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.drawImage(canvas, 0, 0);\n    return resultCanvas;\n}\n\nexport function ctx(\n    canvas: HTMLCanvasElement,\n    options?: CanvasRenderingContext2DSettings,\n): CanvasRenderingContext2D {\n    const ctx = canvas.getContext('2d', options);\n    if (!ctx) {\n        throw new Error(\"couldn't get 2d context\");\n    }\n    return ctx;\n}\n\nexport async function loadToCanvas(path: string): Promise<HTMLCanvasElement> {\n    const im = await asyncLoadImage(path);\n    const canvas = createCanvas(im.width, im.height);\n    const ctx = canvas.getContext('2d')!;\n    ctx.drawImage(im, 0, 0);\n    return canvas;\n}\n\n/**\n * Determine if we should disable imageSmoothing for transformation.\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\n */\nexport function testShouldPixelate(\n    transform: {\n        x: number;\n        y: number;\n        width: number;\n        height: number;\n        angleDeg: number;\n    },\n    scaleX: number,\n    scaleY: number,\n): boolean {\n    if (\n        ![1, -1].includes(scaleX) ||\n        ![1, -1].includes(scaleY) ||\n        transform.width % 1 !== 0 ||\n        transform.height % 1 !== 0 ||\n        Math.abs(transform.angleDeg) % 90 !== 0\n    ) {\n        return false;\n    }\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    const width = whSwapped ? transform.height : transform.width;\n    const height = whSwapped ? transform.width : transform.height;\n    return (\n        ((Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)) &&\n        ((Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5))\n    );\n}\n\n/**\n * @param destCtx - the canvas that will be drawn on\n * @param transformImage - image that will be drawn on canvas\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\n * @param pixelated\n */\nexport function drawTransformedImageWithBounds(\n    destCtx: CanvasRenderingContext2D,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transform: {\n        x: number;\n        y: number;\n        width: number;\n        height: number;\n        angleDeg: number;\n    },\n    bounds?: { x: number; y: number; width: number; height: number },\n    pixelated?: boolean,\n): void {\n    if (!bounds) {\n        bounds = {\n            x: 0,\n            y: 0,\n            width: transformImage.width,\n            height: transformImage.height,\n        };\n    }\n\n    destCtx.save();\n    if (pixelated) {\n        destCtx.imageSmoothingEnabled = false;\n    } else {\n        destCtx.imageSmoothingEnabled = true;\n        destCtx.imageSmoothingQuality = 'high';\n    }\n\n    destCtx.translate(transform.x, transform.y);\n    destCtx.rotate((transform.angleDeg / 180) * Math.PI);\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\n    destCtx.drawImage(\n        transformImage,\n        bounds.x,\n        bounds.y,\n        bounds.width,\n        bounds.height,\n        -Math.abs(transform.width) / 2,\n        -Math.abs(transform.height) / 2,\n        Math.abs(transform.width),\n        Math.abs(transform.height),\n    );\n\n    destCtx.restore();\n}\n\n/**\n * all transformations are optional\n * center is the point around which will be scaled and rotated\n *\n * @param baseCanvas canvas - the canvas that will be drawn on\n * @param transformImage image|canvas - image that will be drawn on canvas\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\n */\nexport function drawTransformedImageOnCanvas(\n    baseCanvas: HTMLCanvasElement,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transformObj: {\n        center: { x: number; y: number };\n        scale: { x: number; y: number };\n        translate: { x: number; y: number };\n        angleDegree: number;\n    },\n): void {\n    transformObj = copyObj(transformObj);\n    if (!transformObj.center) {\n        transformObj.center = {\n            x: transformImage.width / 2,\n            y: transformImage.height / 2,\n        };\n    }\n    if (!transformObj.scale) {\n        transformObj.scale = {\n            x: 1,\n            y: 1,\n        };\n    }\n    if (!transformObj.angleDegree) {\n        transformObj.angleDegree = 0;\n    }\n    if (!transformObj.translate) {\n        transformObj.translate = {\n            x: 0,\n            y: 0,\n        };\n    }\n\n    const ctx = baseCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.save();\n    if (\n        Math.abs(transformObj.scale.x - 1) > 0.000001 ||\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\n    ) {\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = 'high';\n    } else {\n        ctx.imageSmoothingEnabled = false;\n    }\n\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\n    ctx.translate(transformObj.center.x, transformObj.center.y);\n    ctx.rotate((transformObj.angleDegree / 180) * Math.PI);\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\n\n    ctx.restore();\n}\n\nexport const createCheckerCanvas = function (size: number, isDark?: boolean): HTMLCanvasElement {\n    const canvas = createCanvas();\n    let ctx;\n    if (size < 1) {\n        canvas.width = 1;\n        canvas.height = 1;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = 'rgb(128, 128, 128)';\n        ctx.fillRect(0, 0, 1, 1);\n    } else {\n        canvas.width = size * 2;\n        canvas.height = size * 2;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = isDark ? 'rgb(90, 90, 90)' : 'rgb(255, 255, 255)';\n        ctx.fillRect(0, 0, size * 2, size * 2);\n        ctx.fillStyle = isDark ? 'rgb(63, 63, 63)' : 'rgb(200, 200, 200)';\n        ctx.fillRect(0, 0, size, size);\n        ctx.fillRect(size, size, size * 2, size * 2);\n    }\n    return canvas;\n};\n\nexport const createCheckerDataUrl = (function () {\n    // previously created dataUrls\n    const cache: TKeyString = {};\n\n    return function (\n        size: number,\n        callback?: (s: string) => void,\n        isDark?: boolean,\n    ): string | void {\n        const modeStr = isDark ? 'd' : 'l';\n\n        function create(size: number): string {\n            size = parseInt('' + size);\n            if (cache['' + size + modeStr]) {\n                return cache['' + size + modeStr];\n            }\n            const canvas = createCheckerCanvas(size, isDark);\n            const result = canvas.toDataURL('image/png');\n            cache['' + size + modeStr] = result;\n            return result;\n        }\n\n        if (callback) {\n            //async\n            setTimeout(function () {\n                callback(create(size));\n            }, 1);\n        } else {\n            //sync\n            return create(size);\n        }\n    };\n})();\n\n/**\n * smooth resize image\n * @param canvas canvas - will be resized (modified)\n * @param w\n * @param h\n * @param tmp1 canvas - optional, provide to save resources\n * @param tmp2 canvas - optional, provide to save resources\n */\nexport function resizeCanvas(\n    canvas: HTMLCanvasElement,\n    w: number,\n    h: number,\n    tmp1?: HTMLCanvasElement,\n    tmp2?: HTMLCanvasElement,\n): void {\n    //determine base 2 exponents of old and new size\n    function getBase2Obj(oldW: number, oldH: number, newW: number, newH: number) {\n        const result = {\n            oldWidthEx: Math.round(Math.log2(oldW)),\n            oldHeightEx: Math.round(Math.log2(oldH)),\n            newWidthEx: Math.ceil(Math.log2(newW)),\n            newHeightEx: Math.ceil(Math.log2(newH)),\n        };\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\n        return result;\n    }\n\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\n        return;\n    }\n    w = Math.max(w, 1);\n    h = Math.max(h, 1);\n    if (w <= canvas.width && h <= canvas.height) {\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\n\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\n\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\n        tmp1.getContext('2d')!.save();\n        tmp2.getContext('2d')!.save();\n\n        let ew, eh;\n        let buffer1 = tmp1,\n            buffer2 = tmp2;\n\n        ew = base2.oldWidthEx;\n        eh = base2.oldHeightEx;\n\n        let bufferCtx = buffer2.getContext('2d')!;\n        bufferCtx.imageSmoothingEnabled = true;\n        bufferCtx.imageSmoothingQuality = 'high';\n        bufferCtx.globalCompositeOperation = 'copy';\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\n\n        let currentWidth = buffer2.width;\n        let currentHeight = buffer2.height;\n\n        //stepwise half the size\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\n            bufferCtx = buffer1.getContext('2d')!;\n            bufferCtx.imageSmoothingEnabled = true;\n            bufferCtx.imageSmoothingQuality = 'high';\n            bufferCtx.globalCompositeOperation = 'copy';\n\n            const newWidth = ew > base2.newWidthEx ? currentWidth / 2 : currentWidth;\n            const newHeight = eh > base2.newHeightEx ? currentHeight / 2 : currentHeight;\n\n            //buffer also needs to be properly sized, unfortunately\n            buffer1.width = newWidth;\n            buffer1.height = newHeight;\n\n            bufferCtx.drawImage(\n                buffer2,\n                0,\n                0,\n                currentWidth,\n                currentHeight,\n                0,\n                0,\n                newWidth,\n                newHeight,\n            );\n            currentWidth = newWidth;\n            currentHeight = newHeight;\n\n            //swap\n            const tmp = buffer1;\n            buffer1 = buffer2;\n            buffer2 = tmp;\n        }\n\n        //when no longer can be halved, bring to target size\n        canvas.width = w;\n        canvas.height = h;\n        const canvasCtx = canvas.getContext('2d')!;\n        canvasCtx.save();\n        canvasCtx.imageSmoothingEnabled = true;\n        canvasCtx.imageSmoothingQuality = 'high';\n        canvasCtx.drawImage(buffer2, 0, 0, currentWidth, currentHeight, 0, 0, w, h);\n        canvasCtx.restore();\n        tmp1.getContext('2d')!.restore();\n        tmp2.getContext('2d')!.restore();\n    } else if (w >= canvas.width && h >= canvas.height) {\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp1.width = w;\n        tmp1.height = h;\n        const tmp1Ctx = tmp1.getContext('2d')!;\n        tmp1Ctx.save();\n        tmp1Ctx.imageSmoothingEnabled = true;\n        tmp1Ctx.imageSmoothingQuality = 'high';\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\n        tmp1Ctx.restore();\n\n        canvas.width = w;\n        canvas.height = h;\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\n    } else {\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\n    }\n}\n\n/**\n * puts naive greyscale version of image into alpha channel.\n * only writes a, doesn't write rgb\n * @param canvas\n */\nexport function convertToAlphaChannelCanvas(canvas: HTMLCanvasElement): void {\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\n    for (let i = 0; i < imdat.data.length; i += 4) {\n        if (imdat.data[i + 3] === 0) {\n            continue;\n        }\n        imdat.data[i + 3] =\n            ((imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3) *\n            (imdat.data[i + 3] / 255);\n    }\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\n}\n\n/**\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\n * or in the worst case there is a hard to fix memory leak.\n * This function manually makes the canvas use as little memory as possible.\n */\nexport function freeCanvas(canvas: HTMLCanvasElement): void {\n    canvas.width = 1;\n    canvas.height = 1;\n    canvas.remove();\n}\n\n/**\n * Determine bounding box that describes all pixels which are not fully transparent.\n * Returns undefined if empty.\n *\n * @param context\n * @param integerBounds optional - restricts the search to this area. bounds have to be integers\n */\nexport function canvasBounds(\n    context: CanvasRenderingContext2D,\n    integerBounds?: TBounds,\n): TRect | undefined {\n    const searchBounds = integerBounds ?? {\n        x1: 0,\n        y1: 0,\n        x2: context.canvas.width - 1,\n        y2: context.canvas.height - 1,\n    };\n    const searchWidth = searchBounds.x2 - searchBounds.x1 + 1;\n    const searchHeight = searchBounds.y2 - searchBounds.y1 + 1;\n\n    const imdat = context.getImageData(searchBounds.x1, searchBounds.y1, searchWidth, searchHeight);\n\n    if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\n        return {\n            x: searchBounds.x1,\n            y: searchBounds.y1,\n            width: searchBounds.x2 - searchBounds.x1 + 1,\n            height: searchBounds.y2 - searchBounds.y1 + 1,\n        };\n    }\n    const tempBounds: Partial<TBounds> = {\n        x1: undefined,\n        y1: undefined,\n        x2: undefined,\n        y2: undefined,\n    };\n    for (let i = 3; i < imdat.data.length; i += 4) {\n        if (imdat.data[i] > 0) {\n            const x = ((i - 3) / 4) % searchWidth;\n            const y = Math.floor((i - 3) / 4 / searchWidth);\n            if (tempBounds.x1 === undefined || tempBounds.x1 > x) {\n                tempBounds.x1 = x;\n            }\n            if (tempBounds.y1 === undefined) {\n                tempBounds.y1 = y;\n            }\n            if (tempBounds.x2 === undefined || tempBounds.x2 < x) {\n                tempBounds.x2 = x;\n            }\n            if (tempBounds.y2 === undefined || tempBounds.y2 < y) {\n                tempBounds.y2 = y;\n            }\n        }\n    }\n    if (\n        tempBounds.x1 === undefined ||\n        tempBounds.y1 === undefined ||\n        tempBounds.x2 === undefined ||\n        tempBounds.y2 === undefined\n    ) {\n        return undefined;\n    }\n\n    return {\n        x: tempBounds.x1 + searchBounds.x1,\n        y: tempBounds.y1 + searchBounds.y1,\n        width: tempBounds.x2! - tempBounds.x1 + 1,\n        height: tempBounds.y2! - tempBounds.y1 + 1,\n    };\n}\n\nexport function htmlCanvasToBlobAsync(canvas: HTMLCanvasElement, mimeType: string): Promise<Blob> {\n    return new Promise<Blob>((resolve, reject) => {\n        canvas.toBlob((blob) => {\n            if (blob) {\n                resolve(blob);\n            } else {\n                reject(new Error('Failed to create blob from canvas.'));\n            }\n        }, mimeType);\n    });\n}\n\nexport async function canvasToBlob(canvas: HTMLCanvasElement, mimeType: string): Promise<Blob> {\n    if ('toBlob' in HTMLCanvasElement.prototype) {\n        return await htmlCanvasToBlobAsync(canvas, mimeType);\n    } else {\n        // assume base64\n        return base64ToBlob(canvas.toDataURL(mimeType));\n    }\n}\n\nexport function drawSelectionMask(\n    selection: MultiPolygon,\n    context: CanvasRenderingContext2D,\n): void {\n    const canvas = context.canvas;\n    context.save();\n    context.fillRect(0, 0, canvas.width, canvas.height);\n    const selectionPath = getSelectionPath2d(selection);\n    context.clip(selectionPath);\n    context.fillStyle = 'white';\n    context.fillRect(0, 0, canvas.width, canvas.height);\n    context.restore();\n}\n","/*window['canvases'] = [];\n\nwindow['printCanvases'] = () => {\n    let total = 0;\n\n    console.log(window['canvases'].map(item => {\n        total += item.width * item.height;\n        return {w: item.width, h: item.height};\n    }));\n\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\n};*/\n\nexport function createCanvas(w?: number, h?: number): HTMLCanvasElement {\n    const result = document.createElement('canvas');\n    if (w && h) {\n        result.width = w;\n        result.height = h;\n    }\n    // window['canvases'].push(result);\n    return result;\n}\n","import { MultiPolygon } from 'polygon-clipping';\n\nexport function getSelectionPath2d(selection: MultiPolygon): Path2D {\n    const path = new Path2D();\n    selection.forEach((poly) => {\n        poly.forEach((ring) => {\n            ring.forEach((point, index) => {\n                if (index === 0) {\n                    path.moveTo(...point);\n                } else {\n                    path.lineTo(...point);\n                }\n            });\n        });\n        path.closePath();\n    });\n    return path;\n}\n\nexport function getSvgPathD(poly: MultiPolygon): string {\n    let result = '';\n    poly.forEach((poly) => {\n        poly.forEach((ring) => {\n            result += 'M';\n            ring.forEach((point) => {\n                result += point.join(',') + ' ';\n            });\n        });\n    });\n    return result.trim();\n}\n","// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\n// not optimized\n\ntype TMatrix4x4 = [\n    number,\n    number,\n    number,\n    number,\n    number,\n    number,\n    number,\n    number,\n    number,\n    number,\n    number,\n    number,\n    number,\n    number,\n    number,\n    number,\n];\n\nexport type TVec4 = [number, number, number, number];\n\nfunction getIdentity(): TMatrix4x4 {\n    return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n}\n\n// point  matrix\nfunction multiplyMatrixAndPoint(matrix: TMatrix4x4, point: TVec4): TVec4 {\n    return [\n        point[0] * matrix[0] + point[1] * matrix[4] + point[2] * matrix[8] + point[3] * matrix[12], // x\n        point[0] * matrix[1] + point[1] * matrix[5] + point[2] * matrix[9] + point[3] * matrix[13], // y\n        point[0] * matrix[2] + point[1] * matrix[6] + point[2] * matrix[10] + point[3] * matrix[14], // z\n        point[0] * matrix[3] + point[1] * matrix[7] + point[2] * matrix[11] + point[3] * matrix[15], // w\n    ];\n}\n\n//matrixB  matrixA\nfunction multiplyMatrices(matrixA: TMatrix4x4, matrixB: TMatrix4x4): TMatrix4x4 {\n    // Slice the second matrix up into rows\n    const row0: TVec4 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\n    const row1: TVec4 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\n    const row2: TVec4 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\n    const row3: TVec4 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\n\n    // Multiply each row by matrixA\n    const result0 = multiplyMatrixAndPoint(matrixA, row0);\n    const result1 = multiplyMatrixAndPoint(matrixA, row1);\n    const result2 = multiplyMatrixAndPoint(matrixA, row2);\n    const result3 = multiplyMatrixAndPoint(matrixA, row3);\n\n    // Turn the result rows back into a single matrix\n    return [\n        result0[0],\n        result0[1],\n        result0[2],\n        result0[3],\n        result1[0],\n        result1[1],\n        result1[2],\n        result1[3],\n        result2[0],\n        result2[1],\n        result2[2],\n        result2[3],\n        result3[0],\n        result3[1],\n        result3[2],\n        result3[3],\n    ];\n}\n\nfunction createTranslationMatrix(x: number, y: number): TMatrix4x4 {\n    return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, x, y, 0, 1];\n}\n\nfunction createRotationMatrix(angleRad: number): TMatrix4x4 {\n    //let angleRad = angleDeg / 360 * 2 * Math.PI;\n    return [\n        Math.cos(-angleRad),\n        -Math.sin(-angleRad),\n        0,\n        0,\n        Math.sin(-angleRad),\n        Math.cos(-angleRad),\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n    ];\n}\n\nfunction createScaleMatrix(f: number): TMatrix4x4 {\n    return [f, 0, 0, 0, 0, f, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n}\n\nexport const Matrix = Object.freeze({\n    getIdentity,\n    multiplyMatrixAndPoint,\n    multiplyMatrices,\n    createTranslationMatrix,\n    createRotationMatrix,\n    createScaleMatrix,\n});\n","import { TVector2D } from '../bb-types';\n\nexport const Vec2 = {\n    add: function (p1: TVector2D, p2: TVector2D): TVector2D {\n        return { x: p1.x + p2.x, y: p1.y + p2.y };\n    },\n    sub: function (p1: TVector2D, p2: TVector2D): TVector2D {\n        return { x: p1.x - p2.x, y: p1.y - p2.y };\n    },\n    nor: function (p: TVector2D): TVector2D {\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n        return { x: p.x / len, y: p.y / len };\n    },\n    len: function (p: TVector2D): number {\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n    },\n    dist: function (p1: TVector2D, p2: TVector2D): number {\n        return Vec2.len(Vec2.sub(p1, p2));\n    },\n    mul: function (p: TVector2D, s: number): TVector2D {\n        return { x: p.x * s, y: p.y * s };\n    },\n    angle: function (p1: TVector2D, p2: TVector2D): number {\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    },\n    dot: function (a: TVector2D, b: TVector2D): number {\n        const aArr = [a.x, a.y];\n        const bArr = [b.x, b.y];\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\n    },\n};\n","import { Vec2 } from './vec2';\nimport { clamp, dist, mix, pointsToAngleDeg } from './math';\nimport { TVector2D } from '../bb-types';\nimport { copyObj } from '../base/base';\n\n/**\n * project p onto line\n * @param lineStart\n * @param lineEnd\n * @param p\n */\nexport const projectPointOnLine = function (\n    lineStart: TVector2D,\n    lineEnd: TVector2D,\n    p: TVector2D,\n): TVector2D {\n    let x, y;\n    if (lineStart.x === lineEnd.x) {\n        x = lineStart.x;\n        y = p.y;\n\n        return {\n            x: x,\n            y: y,\n        };\n    }\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\n    const b = lineStart.y - m * lineStart.x;\n\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\n\n    return {\n        x: x,\n        y: y,\n    };\n};\n\n/**\n * Operations on a line made up of points\n */\nexport class PointLine {\n    private readonly segmentArr: {\n        x: number;\n        y: number;\n        length: number; // last is 0\n    }[];\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: { points: TVector2D[] }) {\n        this.segmentArr = [];\n\n        for (let i = 0; i < p.points.length; i++) {\n            ((i) => {\n                let length = 0;\n                if (i < p.points.length - 1) {\n                    length = dist(\n                        p.points[i].x,\n                        p.points[i].y,\n                        p.points[i + 1].x,\n                        p.points[i + 1].y,\n                    );\n                }\n                this.segmentArr[i] = {\n                    x: p.points[i].x,\n                    y: p.points[i].y,\n                    length: length,\n                };\n            })(i);\n        }\n    }\n\n    // ---- interface ----\n\n    /**\n     * returns point when traveling *dist* along the line, > 0\n     * @param dist\n     */\n    getAtDist(dist: number): TVector2D {\n        let remainder = Math.min(this.getLength(), dist);\n        let i = 0;\n\n        for (; remainder > this.segmentArr[i].length && i < this.segmentArr.length - 2; i++) {\n            remainder -= this.segmentArr[i].length;\n        }\n\n        const fac = Math.min(1, Math.max(0, remainder / this.segmentArr[i].length));\n\n        return {\n            x: this.segmentArr[i].x * (1 - fac) + this.segmentArr[i + 1].x * fac,\n            y: this.segmentArr[i].y * (1 - fac) + this.segmentArr[i + 1].y * fac,\n        };\n    }\n\n    /**\n     * total length of line\n     */\n    getLength(): number {\n        let result = 0;\n        for (let i = 0; i < this.segmentArr.length - 1; i++) {\n            result += this.segmentArr[i].length;\n        }\n        return result;\n    }\n}\n\nexport type TBezierLineCallback = (v: {\n    x: number;\n    y: number;\n    t: number; // [0, 1] - how far along\n    angle?: number;\n    dAngle: number;\n}) => void;\ntype TBezierLineControlsCallback = (v: {\n    p1: TVector2D;\n    p2: TVector2D;\n    p3: TVector2D;\n    p4: TVector2D;\n}) => void;\n\ntype TBezierLinePoint = {\n    x: number;\n    y: number;\n    spacing: number;\n    dir: TVector2D;\n};\n\n/**\n * Each instance is one line made up of bezier interpolated segments.\n * You feed it points. It calculates control points on its own, and the resulting curve.\n */\nexport class BezierLine {\n    private readonly pointArr: TBezierLinePoint[];\n    private lastDot: number = 0;\n    private lastPoint: TVector2D | undefined;\n    private lastCallbackPoint: TVector2D | undefined;\n    private lastAngle: number | undefined;\n    private lastSpacing: number | undefined;\n\n    /**\n     * creates bezier curve from control points\n     * @param p1 - control point 1 {x: float, y: float}\n     * @param p2 - control point 2 {x: float, y: float}\n     * @param p3 - control point 3 {x: float, y: float}\n     * @param p4 - control point 4 {x: float, y: float}\n     * @param resolution - int\n     * @returns bezier curve made up of points {x: float, y: float}\n     */\n    private getBezierPoints(\n        p1: TVector2D,\n        p2: TVector2D,\n        p3: TVector2D,\n        p4: TVector2D,\n        resolution: number,\n    ): TVector2D[] {\n        const curvePoints = [];\n        let t;\n        for (let i = 0; i <= resolution; i++) {\n            t = i / resolution;\n            curvePoints[curvePoints.length] = {\n                x:\n                    Math.pow(1 - t, 3) * p1.x +\n                    3 * Math.pow(1 - t, 2) * t * p2.x +\n                    3 * (1 - t) * Math.pow(t, 2) * p3.x +\n                    Math.pow(t, 3) * p4.x,\n                y:\n                    Math.pow(1 - t, 3) * p1.y +\n                    3 * Math.pow(1 - t, 2) * t * p2.y +\n                    3 * (1 - t) * Math.pow(t, 2) * p3.y +\n                    Math.pow(t, 3) * p4.y,\n            };\n        }\n        return curvePoints;\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {\n        this.pointArr = [];\n    }\n\n    // ---- interface ----\n\n    /**\n     * Add new point to line. \"Drawn\" line will go until the previous point.\n     *\n     * @param x - coord of new point\n     * @param y\n     * @param spacing - space between each step\n     * @param callback - calls for each step\n     * @param controlsCallback - calls that callback with the bezier control points\n     */\n    add(\n        x: number,\n        y: number,\n        spacing: number,\n        callback?: TBezierLineCallback,\n        controlsCallback?: TBezierLineControlsCallback,\n    ): void {\n        if (this.lastPoint && x === this.lastPoint.x && y === this.lastPoint.y) {\n            return;\n        }\n        this.lastPoint = { x, y };\n        this.pointArr[this.pointArr.length] = {\n            x,\n            y,\n            spacing,\n        } as TBezierLinePoint;\n\n        //calculate directions\n        if (this.pointArr.length === 1) {\n            this.lastSpacing = spacing;\n            return;\n        } else if (this.pointArr.length === 2) {\n            this.pointArr[0].dir = Vec2.nor(Vec2.sub(this.pointArr[1], this.pointArr[0]));\n            this.lastDot = spacing;\n            this.lastSpacing = spacing;\n            return;\n        } else {\n            const pointM1 = this.pointArr[this.pointArr.length - 1];\n            const pointM2 = this.pointArr[this.pointArr.length - 2];\n            const pointM3 = this.pointArr[this.pointArr.length - 3];\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\n                //when xy -3 == -1\n                pointM2.dir = copyObj(pointM3.dir);\n            }\n        }\n\n        //get bezier curve\n        const a = this.pointArr[this.pointArr.length - 3];\n        const b = this.pointArr[this.pointArr.length - 2];\n        const p1 = a;\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\n        const p4 = b;\n\n        let pointLine: PointLine;\n        if (callback) {\n            const curvePoints = this.getBezierPoints(p1, p2, p3, p4, 20);\n            pointLine = new PointLine({ points: curvePoints });\n        } else {\n            pointLine = new PointLine({ points: [p1, p4] });\n        }\n\n        //iterate over curve with spacing and callback\n        const len = pointLine.getLength();\n        let tempSpacing = mix(this.lastSpacing!, spacing, clamp(this.lastDot / len, 0, 1));\n        let d = this.lastDot;\n        for (; d <= len; d += tempSpacing) {\n            tempSpacing = mix(this.lastSpacing!, spacing, clamp(d / len, 0, 1));\n            const point = pointLine.getAtDist(d);\n            const angle = this.lastCallbackPoint\n                ? pointsToAngleDeg(this.lastCallbackPoint, point)\n                : undefined;\n            if (callback) {\n                callback({\n                    x: point.x,\n                    y: point.y,\n                    t: d / len,\n                    angle: angle,\n                    dAngle: this.lastCallbackPoint ? angle! - this.lastAngle! : 0,\n                });\n            }\n            this.lastCallbackPoint = point;\n            this.lastAngle = angle;\n        }\n\n        if (callback) {\n            this.lastDot = d - len;\n        } else {\n            this.lastDot = 0;\n            controlsCallback?.({ p1: p1, p2: p2, p3: p3, p4: p4 });\n        }\n\n        this.lastSpacing = spacing;\n    }\n\n    addFinal(\n        spacing: number,\n        callback?: TBezierLineCallback,\n        controlsCallback?: TBezierLineControlsCallback,\n    ): void {\n        if (this.pointArr.length < 2) {\n            return;\n        }\n\n        const p1 = this.pointArr[this.pointArr.length - 2];\n        const p2 = this.pointArr[this.pointArr.length - 1];\n\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\n\n        this.add(newP.x, newP.y, spacing, callback, controlsCallback);\n    }\n}\n\nexport type TSplineInputPoints = [number, number][]; // [x, y]\n\n/**\n * from SplineInterpolator.cs in the Paint.NET source code\n */\nexport class SplineInterpolator {\n    private readonly xa: number[];\n    private readonly ya: number[];\n    private readonly u: number[];\n    private readonly y2: number[];\n    private readonly first: number;\n    private readonly last: number;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(points: TSplineInputPoints) {\n        const n = points.length;\n        this.xa = [];\n        this.ya = [];\n        this.u = [];\n        this.y2 = [];\n        let i;\n\n        this.first = points[0][0];\n        this.last = points[points.length - 1][0];\n\n        points.sort(function (a, b) {\n            return a[0] - b[0];\n        });\n        for (i = 0; i < n; i++) {\n            this.xa.push(points[i][0]);\n            this.ya.push(points[i][1]);\n        }\n\n        this.u[0] = 0;\n        this.y2[0] = 0;\n\n        for (i = 1; i < n - 1; ++i) {\n            // This is the decomposition loop of the tridiagonal algorithm.\n            // y2 and u are used for temporary storage of the decomposed factors.\n            const wx = this.xa[i + 1] - this.xa[i - 1];\n            const sig = (this.xa[i] - this.xa[i - 1]) / wx;\n            const p = sig * this.y2[i - 1] + 2.0;\n\n            this.y2[i] = (sig - 1.0) / p;\n\n            const ddydx =\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n\n            this.u[i] = ((6.0 * ddydx) / wx - sig * this.u[i - 1]) / p;\n        }\n\n        this.y2[n - 1] = 0;\n\n        // This is the backsubstitution loop of the tridiagonal algorithm\n        for (i = n - 2; i >= 0; --i) {\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n        }\n    }\n\n    // ---- interface ----\n\n    getFirstX(): number {\n        return this.first;\n    }\n\n    getLastX(): number {\n        return this.last;\n    }\n\n    interpolate(x: number): number {\n        const n = this.ya.length;\n        let klo = 0;\n        let khi = n - 1;\n\n        // We will find the right place in the table by means of\n        // bisection. This is optimal if sequential calls to this\n        // routine are at random values of x. If sequential calls\n        // are in order, and closely spaced, one would do better\n        // to store previous values of klo and khi.\n        while (khi - klo > 1) {\n            const k = (khi + klo) >> 1;\n\n            if (this.xa[k] > x) {\n                khi = k;\n            } else {\n                klo = k;\n            }\n        }\n\n        const h = this.xa[khi] - this.xa[klo];\n        const a = (this.xa[khi] - x) / h;\n        const b = (x - this.xa[klo]) / h;\n\n        // Cubic spline polynomial is now evaluated.\n        return (\n            a * this.ya[klo] +\n            b * this.ya[khi] +\n            (((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h)) / 6.0\n        );\n    }\n\n    /**\n     * find x to y. simply by stepping through. suboptimal, so don't call often.\n     * searches in x 0-1 range\n     */\n    findX(y: number, resolution: number): number | undefined {\n        let x;\n        let dist: number;\n        for (let i = 0; i <= resolution; i++) {\n            const tempX = i / resolution;\n            const tempY = this.interpolate(tempX);\n            if (x === undefined) {\n                x = tempX;\n                dist = Math.abs(tempY - y);\n                continue;\n            }\n\n            const tempDist = Math.abs(tempY - y);\n\n            if (tempDist < dist!) {\n                x = tempX;\n                dist = tempDist;\n            } else {\n                //distance increasing\n                break;\n            }\n        }\n        return x;\n    }\n}\n\n/**\n * input for a spline, following curve of a power function x^n [0 - 1]\n * returns [[0, startVal], ..., [1, endVal]]\n */\nexport function powerSplineInput(\n    startVal: number,\n    endVal: number,\n    stepSize: number,\n    exponent: number = 2,\n): TSplineInputPoints {\n    function round(v: number, dec: number): number {\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\n    }\n\n    const resultArr: TSplineInputPoints = [];\n    for (let i = 0; i <= 1; i += stepSize) {\n        resultArr.push([\n            round(i, 4),\n            round(startVal + Math.pow(i, exponent) * (endVal - startVal), 4),\n        ]);\n    }\n    return resultArr;\n}\n","import { TBounds, TRect, TVector2D } from '../bb-types';\n\nexport function mix(a: number, b: number, f: number): number {\n    return a * (1 - f) + b * f;\n}\n\nexport function dist(ax: number, ay: number, bx: number, by: number): number {\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n}\n\nexport function distSquared(ax: number, ay: number, bx: number, by: number): number {\n    // faster because no square-root\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\n}\n\nexport function lenSquared(x: number, y: number): number {\n    // faster because no square-root\n    return x * x + y * y;\n}\n\nexport function pointsToAngleRad(p1: TVector2D, p2: TVector2D): number {\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n}\n\nexport function pointsToAngleDeg(p1: TVector2D, p2: TVector2D): number {\n    return (pointsToAngleRad(p1, p2) * 180) / Math.PI;\n}\n\nexport function isInsideRect(p: TVector2D, rect: TRect): boolean {\n    return (\n        rect.x <= p.x && p.x <= rect.x + rect.width && rect.y <= p.y && p.y <= rect.y + rect.height\n    );\n}\n\nexport function clamp(num: number, min: number, max: number): number {\n    return num < min ? min : num > max ? max : num;\n}\n\nexport function rotate(x: number, y: number, deg: number): TVector2D {\n    const theta = deg * (Math.PI / 180);\n    const cs = Math.cos(theta);\n    const sn = Math.sin(theta);\n\n    return {\n        x: x * cs - y * sn,\n        y: x * sn + y * cs,\n    };\n}\n\nexport function rotateAround(center: TVector2D, point: TVector2D, deg: number): TVector2D {\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\n    rot.x += center.x;\n    rot.y += center.y;\n    return rot;\n}\n\nexport function snapAngleDeg(\n    angleDeg: number,\n    snapDegIncrement: number,\n    maxDistDeg: number,\n): number {\n    const modDeg = Math.abs(angleDeg % snapDegIncrement);\n    const dist = Math.min(modDeg, snapDegIncrement - modDeg);\n\n    if (dist <= maxDistDeg) {\n        angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\n    }\n\n    return angleDeg;\n}\n\n/**\n * angle always in range [-180, 180]\n */\nexport function minimizeAngleDeg(angleDeg: number): number {\n    angleDeg = angleDeg % 360;\n    if (angleDeg > 180) {\n        angleDeg -= 360;\n    } else if (angleDeg < -180) {\n        angleDeg += 360;\n    }\n    return angleDeg;\n}\n\nexport function intDxy(remainder: TVector2D, fDx: number, fDy: number): { dX: number; dY: number } {\n    remainder.x += fDx;\n    remainder.y += fDy;\n    const dX = Math.round(remainder.x);\n    const dY = Math.round(remainder.y);\n    remainder.x -= dX;\n    remainder.y -= dY;\n    return {\n        dX,\n        dY,\n    };\n}\n\n/**\n * return closest even number\n * @param f\n */\nexport function roundEven(f: number): number {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f;\n        }\n        return f + 1;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 0) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * return closest uneven number\n * @param f\n */\nexport function roundUneven(f: number): number {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f + 1;\n        }\n        return f;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 1) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * round number to certain precision.\n * round(1.2345, 2) = 1.23\n * round(1.2345, 0) = 0\n * round(123, -1) = 120\n *\n * @param f\n * @param digits\n */\nexport function round(f: number, digits: number): number {\n    const digitMult = Math.pow(10, digits);\n    return Math.round(f /* + Number.EPSILON*/ * digitMult) / digitMult;\n}\n\n/**\n * update target so it includes bounds\n * @param target\n * @param bounds\n */\nexport function updateBounds(target: TBounds | undefined, bounds: TBounds | undefined): TBounds {\n    if (!bounds && !target) {\n        throw new Error('at least one param needs to be defined');\n    }\n    if (!bounds) {\n        return target!;\n    }\n    if (!target) {\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\n    } else {\n        target.x1 = Math.min(target.x1, bounds.x1);\n        target.y1 = Math.min(target.y1, bounds.y1);\n        target.x2 = Math.max(target.x2, bounds.x2);\n        target.y2 = Math.max(target.y2, bounds.y2);\n    }\n    return target;\n}\n\nexport function boundsOverlap(\n    bounds: TBounds | undefined,\n    limit: TBounds | undefined,\n): TBounds | undefined {\n    if (!bounds) {\n        return undefined;\n    }\n    if (!limit) {\n        return bounds;\n    }\n    const x1 = Math.max(limit.x1, bounds.x1);\n    const y1 = Math.max(limit.y1, bounds.y1);\n    const x2 = Math.min(limit.x2, bounds.x2);\n    const y2 = Math.min(limit.y2, bounds.y2);\n\n    if (x1 > x2 || y1 > y2) {\n        return undefined;\n    }\n    return { x1, y1, x2, y2 };\n}\n\n/**\n * determine overlap of bounds with width&height\n */\nexport function boundsInArea(\n    bounds: TBounds | undefined,\n    width: number,\n    height: number,\n): TBounds | undefined {\n    if (!bounds) {\n        return undefined;\n    }\n    return boundsOverlap(bounds, { x1: 0, y1: 0, x2: width - 1, y2: height - 1 });\n}\n\nexport function intBoundsWithinArea(\n    bounds: TBounds,\n    width: number,\n    height: number,\n    areIndices?: boolean,\n): TBounds | undefined {\n    const x1 = Math.max(0, Math.floor(bounds.x1));\n    const y1 = Math.max(0, Math.floor(bounds.y1));\n    const x2 = Math.min(width - (areIndices ? 1 : 0), Math.ceil(bounds.x2));\n    const y2 = Math.min(height - (areIndices ? 1 : 0), Math.ceil(bounds.y2));\n    if (x1 > x2 || y1 > y2) {\n        return undefined;\n    }\n    return { x1, y1, x2, y2 };\n}\n\nexport function boundsToRect(bounds: TBounds, areIndices?: boolean): TRect {\n    return {\n        x: bounds.x1,\n        y: bounds.y1,\n        width: bounds.x2 - bounds.x1 + (areIndices ? 1 : 0),\n        height: bounds.y2 - bounds.y1 + (areIndices ? 1 : 0),\n    };\n}\n\nexport function integerBounds(bounds: TBounds): TBounds {\n    return {\n        x1: Math.floor(bounds.x1),\n        y1: Math.floor(bounds.y1),\n        x2: Math.ceil(bounds.x2),\n        y2: Math.ceil(bounds.y2),\n    };\n}\n","// based on js color conversion http://www.webtoolkit.info/\n\nexport class HSV {\n    h: number;\n    s: number;\n    v: number;\n    constructor(h: number, s: number, v: number) {\n        this.h = Math.max(0, Math.min(360, h));\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\n        this.v = Math.max(0, Math.min(100, v));\n    }\n}\n\nexport class RGB {\n    r: number;\n    g: number;\n    b: number;\n    constructor(r: number, g: number, b: number) {\n        this.r = Math.max(0, Math.min(255, r));\n        this.g = Math.max(0, Math.min(255, g));\n        this.b = Math.max(0, Math.min(255, b));\n    }\n}\n\nexport class CMYK {\n    c: number;\n    m: number;\n    y: number;\n    k: number;\n    constructor(c: number, m: number, y: number, k: number) {\n        this.c = Math.max(0, Math.min(100, c));\n        this.m = Math.max(0, Math.min(100, m));\n        this.y = Math.max(0, Math.min(100, y));\n        this.k = Math.max(0, Math.min(100, k));\n    }\n}\n\nexport const ColorConverter = {\n    _RGBtoHSV: function (RGB: RGB): HSV {\n        const result = new HSV(0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        const minVal = Math.min(r, g, b);\n        const maxVal = Math.max(r, g, b);\n        const delta = maxVal - minVal;\n\n        result.v = maxVal;\n\n        if (delta == 0) {\n            result.h = 0;\n            result.s = 0;\n        } else {\n            result.s = delta / maxVal;\n            const del_R = ((maxVal - r) / 6 + delta / 2) / delta;\n            const del_G = ((maxVal - g) / 6 + delta / 2) / delta;\n            const del_B = ((maxVal - b) / 6 + delta / 2) / delta;\n\n            if (r == maxVal) {\n                result.h = del_B - del_G;\n            } else if (g == maxVal) {\n                result.h = 1 / 3 + del_R - del_B;\n            } else if (b == maxVal) {\n                result.h = 2 / 3 + del_G - del_R;\n            }\n\n            if (result.h < 0) {\n                result.h += 1;\n            }\n            if (result.h > 1) {\n                result.h -= 1;\n            }\n        }\n\n        result.h = Math.round(result.h * 360);\n        result.s = Math.round(result.s * 100);\n        result.v = Math.round(result.v * 100);\n\n        return result;\n    },\n\n    _HSVtoRGB: function (HSV: HSV): RGB {\n        const result = new RGB(0, 0, 0);\n\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\n\n        const h = (HSV.h / 360) % 1;\n        const s = HSV.s / 100;\n        const v = HSV.v / 100;\n\n        if (s == 0) {\n            result.r = v * 255;\n            result.g = v * 255;\n            result.b = v * 255;\n        } else {\n            var_h = h * 6;\n            var_i = Math.floor(var_h);\n            var_1 = v * (1 - s);\n            var_2 = v * (1 - s * (var_h - var_i));\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\n\n            if (var_i == 0) {\n                var_r = v;\n                var_g = var_3;\n                var_b = var_1;\n            } else if (var_i == 1) {\n                var_r = var_2;\n                var_g = v;\n                var_b = var_1;\n            } else if (var_i == 2) {\n                var_r = var_1;\n                var_g = v;\n                var_b = var_3;\n            } else if (var_i == 3) {\n                var_r = var_1;\n                var_g = var_2;\n                var_b = v;\n            } else if (var_i == 4) {\n                var_r = var_3;\n                var_g = var_1;\n                var_b = v;\n            } else {\n                var_r = v;\n                var_g = var_1;\n                var_b = var_2;\n            }\n\n            result.r = var_r * 255;\n            result.g = var_g * 255;\n            result.b = var_b * 255;\n\n            result.r = Math.round(result.r);\n            result.g = Math.round(result.g);\n            result.b = Math.round(result.b);\n        }\n\n        return result;\n    },\n\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\n        const result = new RGB(0, 0, 0);\n\n        const c = CMYK.c / 100;\n        const m = CMYK.m / 100;\n        const y = CMYK.y / 100;\n        const k = CMYK.k / 100;\n\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\n\n        result.r = Math.round(result.r * 255);\n        result.g = Math.round(result.g * 255);\n        result.b = Math.round(result.b * 255);\n\n        return result;\n    },\n\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\n        const result = new CMYK(0, 0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\n        result.c = (1 - r - result.k) / (1 - result.k);\n        result.m = (1 - g - result.k) / (1 - result.k);\n        result.y = (1 - b - result.k) / (1 - result.k);\n\n        result.c = Math.round(result.c * 100);\n        result.m = Math.round(result.m * 100);\n        result.y = Math.round(result.y * 100);\n        result.k = Math.round(result.k * 100);\n\n        return result;\n    },\n\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\n        if (o instanceof RGB) {\n            return o;\n        }\n        if (o instanceof HSV) {\n            return this._HSVtoRGB(o);\n        }\n        if (o instanceof CMYK) {\n            return this._CMYKtoRGB(o);\n        }\n        throw new Error('unknown type');\n    },\n\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\n        if (o instanceof HSV) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoHSV(o);\n        }\n        if (o instanceof CMYK) {\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\n        }\n        throw new Error('unknown type');\n    },\n\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\n        if (o instanceof CMYK) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoCMYK(o);\n        }\n        if (o instanceof HSV) {\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\n        }\n        throw new Error('unknown type');\n    },\n    toHexString: function (o: RGB): string {\n        if (o instanceof RGB || ('r' in o && 'g' in o && 'b' in o)) {\n            let ha = parseInt('' + o.r).toString(16);\n            let hb = parseInt('' + o.g).toString(16);\n            let hc = parseInt('' + o.b).toString(16);\n            if (ha.length == 1) {\n                ha = '0' + ha;\n            }\n            if (hb.length == 1) {\n                hb = '0' + hb;\n            }\n            if (hc.length == 1) {\n                hc = '0' + hc;\n            }\n            return ha + hb + hc;\n        }\n        return '#000';\n    },\n    toRgbStr: function (rgbObj: { r: number; g: number; b: number }): string {\n        return (\n            'rgb(' +\n            Math.round(rgbObj.r) +\n            ', ' +\n            Math.round(rgbObj.g) +\n            ', ' +\n            Math.round(rgbObj.b) +\n            ')'\n        );\n    },\n    toRgbaStr: function (rgbaObj: { r: number; g: number; b: number; a: number }): string {\n        return (\n            'rgba(' +\n            Math.round(rgbaObj.r) +\n            ', ' +\n            Math.round(rgbaObj.g) +\n            ', ' +\n            Math.round(rgbaObj.b) +\n            ', ' +\n            rgbaObj.a +\n            ')'\n        );\n    },\n    hexToRGB: function (hexStr: string): RGB | undefined {\n        hexStr = hexStr.trim();\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hexStr = hexStr.replace(shorthandRegex, function (m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\n        return result\n            ? new RGB(parseInt(result[1], 16), parseInt(result[2], 16), parseInt(result[3], 16))\n            : undefined;\n    },\n};\n\nexport function testIsWhiteBestContrast(rgbObj: { r: number; g: number; b: number }): boolean {\n    return rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114 < 125;\n}\n","import { css } from './base';\nimport { BB } from '../bb';\n\nexport function appendTextDiv(target: HTMLElement, text: string): HTMLDivElement {\n    const div = document.createElement('div');\n    div.innerHTML = text;\n    target.append(div);\n    return div;\n}\n\n/**\n * Is an input element focused.\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\n *\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\n */\nexport function isInputFocused(getAll: boolean = false): boolean {\n    const result: boolean =\n        !!document.activeElement &&\n        ['INPUT', 'TEXTAREA', 'SELECT'].includes(document.activeElement.tagName);\n    if (getAll) {\n        return result;\n    } else {\n        return result && !document.activeElement?.getAttribute('data-ignore-focus');\n    }\n}\n\nexport function unfocusAnyInput(): void {\n    if (isInputFocused(true)) {\n        /*\n            Unfocus anything that is focused.\n\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\n            that isn't its direct parent, then Firefox will keep anything attached to this\n            Input in memory. It will not be garbage collected until a new Input is focused.\n\n            Workaround: Temporarily create an input, focus it, detach it.\n             */\n        const focusEl = BB.el({\n            parent: document.body,\n            tagName: 'input',\n            css: {\n                opacity: '0',\n                width: '0',\n                height: '0',\n            },\n        });\n        setTimeout(() => {\n            focusEl.select();\n            focusEl.focus();\n            focusEl.remove();\n        }, 10);\n    }\n}\n\n/**\n * clears text selection in window\n */\nexport function clearSelection(): void {\n    if (window.getSelection) {\n        const sel = window.getSelection();\n        if (sel) {\n            if (sel.empty) {\n                sel.empty();\n            } else if (sel.removeAllRanges) {\n                sel.removeAllRanges();\n            }\n        }\n    }\n}\n\n/**\n * prevents being able to focus element.\n * warning: it creates a listener\n *\n * @param el - dom element\n */\nexport const makeUnfocusable = (function (): (el: HTMLElement) => void {\n    function preventFocus(event: FocusEvent): void {\n        event.preventDefault();\n        let didFocusRelated = false;\n        if (event.relatedTarget) {\n            try {\n                (event.relatedTarget as HTMLElement).focus();\n                didFocusRelated = true;\n            } catch (e) {\n                console.error('failed to focus');\n            }\n        }\n        if (!didFocusRelated) {\n            (event.currentTarget as HTMLElement).blur();\n        }\n    }\n\n    return function (el) {\n        el.setAttribute('tabindex', '-1');\n        el.addEventListener('focus', preventFocus);\n    };\n})();\n\nconst els: {\n    el: HTMLElement;\n    listeners: [keyof HTMLElementEventMap, EventListener][];\n}[] = [];\n// window['els'] = els;\n\n/**\n *\n * Create DOM element - div by default\n * params = {\n * \t    parent: someOtherDiv,\n * \t    css: {\n * \t\t    width: \"500px\",\n * \t\t    backgroundColor: \"#fff\"\n * \t    },\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\n * \t    className: \"bla\",\n *      id: \"bla\"\n * }\n *\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\n *  to prevent a memory leak.\n *\n * @param params\n */\nexport function el<GTag extends keyof HTMLElementTagNameMap = 'div'>(params?: {\n    parent?: HTMLElement;\n    css?: Partial<CSSStyleDeclaration>;\n    custom?: { [key: string]: string };\n    content?: string | (HTMLElement | string | undefined)[] | Element;\n    textContent?: string;\n    className?: string;\n    title?: string;\n    id?: string;\n    tagName?: GTag;\n    onClick?: (e: Event) => void;\n    onChange?: (e: Event) => void;\n    noRef?: boolean; // don't keep references of listeners\n}) {\n    if (!params) {\n        return document.createElement('div') as HTMLElementTagNameMap[GTag];\n    }\n    const result = document.createElement(params.tagName ? params.tagName : 'div');\n    params.css && css(result, params.css);\n\n    if (params.content) {\n        if (typeof params.content === typeof 'aa') {\n            result.innerHTML = params.content as string;\n        } else if (Array.isArray(params.content)) {\n            BB.append(result, params.content);\n        } else {\n            result.append(params.content as HTMLElement);\n        }\n    }\n    if (params.textContent) {\n        result.textContent = params.textContent;\n    }\n    if (params.className) {\n        result.className = params.className;\n    }\n    if (params.id) {\n        result.id = params.id;\n    }\n    if (params.parent) {\n        params.parent.append(result);\n    }\n    if ('title' in params && params.title !== undefined) {\n        result.title = params.title;\n    }\n    const listeners: [keyof HTMLElementEventMap, EventListener][] = [];\n    if (params.onClick !== undefined) {\n        result.addEventListener('click', params.onClick);\n        !params.noRef && listeners.push(['click', params.onClick as EventListener]);\n    }\n    if (params.onChange !== undefined) {\n        result.addEventListener('change', params.onChange);\n        !params.noRef && listeners.push(['change', params.onChange]);\n    }\n    if (listeners.length > 0) {\n        els.push({\n            el: result,\n            listeners,\n        });\n        /*div.style.backgroundColor = '#ff0';\n        div.style.border = '1px solid #ff0';*/\n    }\n    if ('custom' in params && params.custom) {\n        const customKeyArr = Object.keys(params.custom);\n        for (let i = 0; i < customKeyArr.length; i++) {\n            result.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\n        }\n    }\n    return result as HTMLElementTagNameMap[GTag];\n}\n\n/**\n * removes event listeners for Elements created via el()\n * @param el\n */\nexport function destroyEl(el?: HTMLElement): void {\n    if (!el) {\n        return;\n    }\n    for (let i = 0; i < els.length; i++) {\n        const item = els[i];\n        if (item.el === el) {\n            item.listeners.forEach((item) => {\n                el.removeEventListener(item[0], item[1]);\n            });\n            els.splice(i, 1);\n            return;\n        }\n    }\n    // not found\n    return;\n}\n\nexport function createImage(p: {\n    src?: string;\n    alt?: string;\n    width?: number;\n    height?: number;\n    className?: string;\n    css?: Partial<CSSStyleDeclaration>;\n}): HTMLImageElement {\n    const result = new Image();\n    if (p.src !== undefined) {\n        result.src = p.src;\n    }\n    if (p.alt !== undefined) {\n        result.alt = p.alt;\n    }\n    if (p.width !== undefined) {\n        result.width = p.width;\n    }\n    if (p.height !== undefined) {\n        result.height = p.height;\n    }\n    if (p.className !== undefined) {\n        result.className = p.className;\n    }\n    p.css && css(result, p.css);\n    return result;\n}\n","type TLogListener = (msg: any) => void;\n\nexport class BbLog {\n    private static listeners: TLogListener[] = [];\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {}\n\n    static subscribe(listener: TLogListener): void {\n        if (BbLog.listeners.includes(listener)) {\n            return;\n        }\n        BbLog.listeners.push(listener);\n    }\n\n    static unsubscribe(listener: TLogListener): void {\n        for (let i = 0; i < BbLog.listeners.length; i++) {\n            if (listener === BbLog.listeners[i]) {\n                BbLog.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    static emit(msg: any): void {\n        BbLog.listeners.forEach((item) => {\n            item(msg);\n        });\n    }\n}\n","/**\n * LocalStorage wrapper that does not throw exceptions.\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\n */\nexport class LocalStorage {\n    private static error: unknown | undefined;\n\n    static getItem(key: string): string | null {\n        // (disabled) eslint-disable-next-line no-null/no-null\n        let result = null;\n        try {\n            result = localStorage.getItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n        return result;\n    }\n\n    static setItem(key: string, value: string): void {\n        try {\n            localStorage.setItem(key, value);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static removeItem(key: string): void {\n        try {\n            localStorage.removeItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static getError(): unknown {\n        return this.error;\n    }\n}\n","import { TPointerEvent } from '../event.types';\nimport { copyObj } from '../../base/base';\n\nexport type TCoalescedPointerEvent = TPointerEvent & {\n    isCoalesced: boolean;\n};\n\n/**\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\n *\n * in: IPointerEvent\n * out: IPointerEvent with property isCoalesced: boolean\n *\n * todo: eventPreventDefault and eventStopPropagation are broken events w coalesced events. (because of json parse json stringify)\n * but how could that even work?\n */\nexport class CoalescedExploder {\n    private chainOut: ((e: TCoalescedPointerEvent) => void) | undefined;\n\n    // ----------------------------------- public -----------------------------------\n\n    setChainOut(func: (e: TCoalescedPointerEvent) => void) {\n        this.chainOut = func;\n    }\n\n    chainIn(event: TPointerEvent): TPointerEvent | null {\n        if (event.type === 'pointermove') {\n            if (event.coalescedArr && event.coalescedArr.length > 0) {\n                for (let i = 0; i < event.coalescedArr.length; i++) {\n                    const eventCopy: TCoalescedPointerEvent = copyObj(\n                        event,\n                    ) as TCoalescedPointerEvent;\n                    if (i === 0) {\n                        eventCopy.coalescedArr = [];\n                    }\n                    const coalescedItem = event.coalescedArr[i];\n\n                    eventCopy.pageX = coalescedItem.pageX;\n                    eventCopy.pageY = coalescedItem.pageY;\n                    eventCopy.relX = coalescedItem.relX;\n                    eventCopy.relY = coalescedItem.relY;\n                    eventCopy.dX = coalescedItem.dX;\n                    eventCopy.dY = coalescedItem.dY;\n                    eventCopy.time = coalescedItem.time;\n                    eventCopy.isCoalesced = i < event.coalescedArr.length - 1;\n\n                    this.chainOut && this.chainOut(eventCopy);\n                }\n            } else {\n                return event;\n            }\n        } else {\n            return event;\n        }\n\n        return null;\n    }\n}\n","import { dist } from '../../math/math';\nimport { TPointerEvent } from '../event.types';\n\n/**\n * A ChainElement. Detects a single tap with N 'touch' pointers\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class NFingerTapper {\n    private readonly minSilenceBeforeDurationMs = 50;\n    private readonly maxTapMs = 500;\n    private readonly maxFirstLastFingerDownMs = 250;\n    private readonly maxPressedDistancePx = 12; //5 + fingers * 5;\n\n    private chainOut: ((e: TPointerEvent) => void) | undefined;\n    private fingerArr: {\n        pointerId: number;\n        downTimeMs: number;\n        downPageX: number;\n        downPageY: number;\n        isUp?: boolean;\n    }[] = [];\n    private eventQueueArr: TPointerEvent[] = [];\n    private firstDownTime: number = 0;\n    private lastEventTime: number = 0;\n    private nowTime: number = performance.now();\n    private readonly pointersDownIdArr: number[] = [];\n    private readonly fingers: number;\n    private readonly onTap: () => void;\n    private readonly timeoutObj: {\n        firstLastDownTimeout: ReturnType<typeof setTimeout> | null;\n        tapTimeout: ReturnType<typeof setTimeout> | null;\n    } = {\n        firstLastDownTimeout: null,\n        tapTimeout: null,\n    };\n\n    private failGesture(): void {\n        if (this.eventQueueArr.length === 0) {\n            return;\n        }\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\n        for (let i = 0; i < this.eventQueueArr.length; i++) {\n            this.chainOut && this.chainOut(this.eventQueueArr[i]);\n        }\n        this.eventQueueArr = [];\n        this.fingerArr = [];\n    }\n\n    private success(): void {\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\n        this.eventQueueArr = []; // events get swallowed\n        this.fingerArr = [];\n        this.onTap();\n    }\n\n    private setupTimeout(\n        timeoutStr: 'firstLastDownTimeout' | 'tapTimeout',\n        timeMS: number,\n    ): boolean {\n        const diff = timeMS - this.nowTime;\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0) {\n            // time already up\n            return false;\n        }\n        this.timeoutObj[timeoutStr] = setTimeout(() => this.failGesture(), diff);\n        return true;\n    }\n\n    private processEvent(event: TPointerEvent): true | void {\n        const tempLastEventTime = this.lastEventTime;\n        this.lastEventTime = event.time;\n\n        if (event.type === 'pointerdown') {\n            this.pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\n                if (this.pointersDownIdArr[i] === event.pointerId) {\n                    this.pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (event.pointerType !== 'touch') {\n            if (this.fingerArr.length > 0) {\n                // already in gesture -> fail\n                this.failGesture();\n            }\n            return;\n        }\n\n        this.nowTime = performance.now();\n\n        if (event.type === 'pointerdown') {\n            //console.log('down');\n            if (this.fingerArr.length + 1 !== this.pointersDownIdArr.length) {\n                // failed before, and some fingers are still down -> fail\n                this.failGesture();\n                return;\n            }\n            if (this.fingerArr.length === this.fingers) {\n                // too many fingers down -> fail\n                //console.log(fingers + ': too many fingers down -> fail');\n                this.failGesture();\n                return;\n            }\n            if (\n                this.fingerArr.length > 0 &&\n                event.time - this.maxFirstLastFingerDownMs > this.fingerArr[0].downTimeMs\n            ) {\n                // took too long to touch with all fingers -> fail\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\n                this.failGesture();\n                return;\n            }\n            if (\n                this.fingerArr.length === 0 &&\n                event.time - this.minSilenceBeforeDurationMs < tempLastEventTime\n            ) {\n                // not enough silence before -> fail\n                //console.log(fingers + ': not enough silence before -> fail');\n                this.failGesture();\n                return;\n            }\n\n            if (this.fingerArr.length === 0) {\n                this.firstDownTime = event.time;\n\n                if (\n                    !this.setupTimeout(\n                        'firstLastDownTimeout',\n                        event.time + this.maxFirstLastFingerDownMs,\n                    ) ||\n                    !this.setupTimeout('tapTimeout', event.time + this.maxTapMs)\n                ) {\n                    // timeouts already up -> fail\n                    this.failGesture();\n                    return;\n                }\n            }\n            this.fingerArr.push({\n                pointerId: event.pointerId,\n                downTimeMs: event.time,\n                downPageX: event.pageX,\n                downPageY: event.pageY,\n            });\n            return;\n        }\n\n        if (event.type === 'pointermove') {\n            if (this.fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            let fingerObj = null;\n            for (let i = 0; i < this.fingerArr.length; i++) {\n                if (this.fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = this.fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) {\n                // finger not part of the tap is on screen -> fail\n                this.failGesture();\n                return;\n            }\n\n            if (event.time - this.maxTapMs > this.firstDownTime) {\n                // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                this.failGesture();\n                return;\n            }\n\n            const distance = dist(\n                event.pageX,\n                event.pageY,\n                fingerObj.downPageX,\n                fingerObj.downPageY,\n            );\n            if (distance > this.maxPressedDistancePx) {\n                // finger moved too much -> fail\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\n                this.failGesture();\n                return;\n            }\n        }\n\n        if (event.type === 'pointerup') {\n            if (this.fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            //console.log('up', event.pageX, event.pageY);\n            if (this.fingerArr.length !== this.fingers) {\n                // not enough fingers -> fail\n                //console.log(fingers + ': not enough fingers -> fail');\n                this.failGesture();\n                return;\n            }\n\n            let fingerObj = null;\n            let i = 0;\n            for (; i < this.fingerArr.length; i++) {\n                if (this.fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = this.fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) {\n                //do nothing\n                return;\n            }\n\n            if (event.time - this.maxTapMs > this.firstDownTime) {\n                // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                this.failGesture();\n                return;\n            }\n\n            const distance = dist(\n                event.pageX,\n                event.pageY,\n                fingerObj.downPageX,\n                fingerObj.downPageY,\n            );\n            if (distance > this.maxPressedDistancePx) {\n                // finger moved too much -> fail\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\n                //console.log(fingerArr);\n                this.failGesture();\n                return;\n            }\n\n            fingerObj.isUp = true;\n\n            let allAreUp = true;\n            for (let i = 0; i < this.fingerArr.length; i++) {\n                if (!this.fingerArr[i].isUp) {\n                    allAreUp = false;\n                    break;\n                }\n            }\n            //console.log('fingerArr', fingerArr);\n\n            if (allAreUp) {\n                // success\n                this.success();\n                return true;\n            }\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: { fingers: number; onTap: () => void }) {\n        this.fingers = p.fingers;\n        this.onTap = p.onTap;\n    }\n\n    chainIn(event: TPointerEvent): TPointerEvent | null {\n        const result = this.processEvent(event);\n\n        //console.log(fingerArr.length);\n\n        if (result === true) {\n            //tap success -> event gets swallowed\n            return null;\n        }\n        if (this.fingerArr.length === 0) {\n            return event;\n        } else {\n            this.eventQueueArr.push(event);\n        }\n\n        return null;\n    }\n\n    setChainOut(func: (e: TPointerEvent) => void): void {\n        this.chainOut = func;\n    }\n}\n","import { dist, pointsToAngleRad } from '../../math/math';\nimport { TPointerEvent } from '../event.types';\n\nexport type TPinchZoomerEvent =\n    | { type: 'end' }\n    | {\n          type: 'move';\n\n          downRelX: number;\n          downRelY: number;\n          relX: number;\n          relY: number;\n\n          angleRad: number;\n          scale: number;\n      };\n\ntype TTouchPointer = {\n    pointerId: number;\n    relX: number;\n    relY: number;\n    downRelX?: number; // only for first\n    downRelY?: number;\n};\n\ntype TPinchGesture = {\n    touchPointerArr: TTouchPointer[];\n    otherPointerIdArr: number[];\n    isInProgress: boolean;\n};\n\n/**\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\n * Further pointers are ignored, but their events get swallowed during the pinching.\n * pinching ends when ALL pointers are lifted.\n * Events passed through if no pinching.\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class PinchZoomer {\n    private readonly firstFingerMaxDistancePx = 10;\n    private readonly untilSecondFingerDurationMs = 250;\n\n    private chainOut: ((e: TPointerEvent) => void) | undefined;\n    private readonly pointersDownIdArr: number[] = [];\n    private gestureObj: null | TPinchGesture = null;\n    private eventQueueArr: TPointerEvent[] = [];\n    private nowTime: number = performance.now();\n    private readonly timeoutObj: {\n        secondFingerTimeout: ReturnType<typeof setTimeout> | null;\n    } = {\n        secondFingerTimeout: null,\n    };\n    private pincherArr: {\n        pointerId: number;\n        relX: number;\n        relY: number;\n        downRelX: number;\n        downRelY: number;\n    }[] = [];\n    private readonly onPinch: (e: TPinchZoomerEvent) => void;\n\n    private end(): void {\n        this.gestureObj = null;\n        this.eventQueueArr = [];\n    }\n\n    private fail(doSwallow?: boolean): void {\n        if (!this.gestureObj) {\n            // no gesture happening -> ignore\n            return;\n        }\n\n        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\n        if (!doSwallow) {\n            for (let i = 0; i < this.eventQueueArr.length; i++) {\n                this.chainOut && this.chainOut(this.eventQueueArr[i]);\n            }\n        }\n        this.end();\n    }\n\n    private setupFailTimeout(timeMS: number): boolean {\n        const diff = timeMS - this.nowTime;\n        if (diff <= 0) {\n            // time already up\n            return false;\n        }\n        this.timeoutObj.secondFingerTimeout = setTimeout(() => this.fail(), diff);\n        return true;\n    }\n\n    private processEvent(event: TPointerEvent): void {\n        if (event.type === 'pointerdown') {\n            this.pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\n                if (this.pointersDownIdArr[i] === event.pointerId) {\n                    this.pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        //pass through scenarios\n        if (\n            !this.gestureObj &&\n            (event.pointerType !== 'touch' || // wrong pointer type\n                (event.type === 'pointermove' && this.pointersDownIdArr.length > 0) || // failed before\n                this.pointersDownIdArr.length > 1 || // failed before\n                event.type === 'pointerup') // failed before\n        ) {\n            return;\n        }\n\n        this.nowTime = performance.now();\n\n        //pointer down\n        if (event.type === 'pointerdown') {\n            if (this.gestureObj) {\n                if (event.pointerType === 'touch') {\n                    // touch finger down - as nth pointer\n\n                    this.gestureObj.touchPointerArr.push({\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY,\n                    });\n\n                    if (this.gestureObj.isInProgress) {\n                        this.continuePinch(this.gestureObj, {\n                            type: 'down',\n                            index: this.gestureObj.touchPointerArr.length - 1,\n                        });\n                    } else {\n                        this.timeoutObj.secondFingerTimeout &&\n                            clearTimeout(this.timeoutObj.secondFingerTimeout);\n                        this.gestureObj.isInProgress = true;\n                        this.beginPinch(this.gestureObj);\n                    }\n                    return;\n                } else {\n                    // non-touch finger down - as nth pointer\n\n                    if (this.gestureObj.isInProgress) {\n                        this.gestureObj.otherPointerIdArr.push(event.pointerId);\n                    } else {\n                        // second pointer wrong type -> fail\n                        this.fail();\n                    }\n                    return;\n                }\n            } else {\n                // first finger down - can only be touch if no gestureObj\n                this.gestureObj = {\n                    touchPointerArr: [\n                        {\n                            pointerId: event.pointerId,\n                            relX: event.relX,\n                            relY: event.relY,\n                            downRelX: event.relX,\n                            downRelY: event.relY,\n                        },\n                    ],\n                    otherPointerIdArr: [],\n                    isInProgress: false,\n                };\n                if (!this.setupFailTimeout(event.time + this.untilSecondFingerDurationMs)) {\n                    // time ran out -> fail\n                    this.fail();\n                    return;\n                }\n                return;\n            }\n        }\n\n        // should not happen. something went wrong\n        if (!this.gestureObj) {\n            // throw? would make it less robust\n            this.fail();\n            return;\n        }\n\n        //pointer move\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\n            //gesture object should always exist here\n\n            let touchPointerObj: TTouchPointer | null = null;\n            let i = 0;\n            for (; i < this.gestureObj.touchPointerArr.length; i++) {\n                if (event.pointerId === this.gestureObj.touchPointerArr[i].pointerId) {\n                    touchPointerObj = this.gestureObj.touchPointerArr[i];\n                    break;\n                }\n            }\n\n            //null should not be possible. something went wrong\n            if (!touchPointerObj) {\n                // throw? would make it less robust\n                this.fail();\n                return;\n            }\n\n            touchPointerObj.relX = event.relX;\n            touchPointerObj.relY = event.relY;\n\n            if (!this.gestureObj.isInProgress) {\n                // only one finger down & pinching hasn't started\n\n                // should not happen. something went wrong\n                if (\n                    !('downRelX' in touchPointerObj && touchPointerObj.downRelX !== undefined) ||\n                    !('downRelY' in touchPointerObj && touchPointerObj.downRelY !== undefined)\n                ) {\n                    this.fail();\n                    return;\n                }\n\n                const distance = dist(\n                    touchPointerObj.downRelX,\n                    touchPointerObj.downRelY,\n                    touchPointerObj.relX,\n                    touchPointerObj.relY,\n                );\n                if (distance > this.firstFingerMaxDistancePx) {\n                    // moved too much -> fail\n                    this.fail();\n                    return;\n                }\n            } else {\n                if (i < 2) {\n                    // only first two touches can affect pinching\n                    this.continuePinch(this.gestureObj, {\n                        type: 'move',\n                        index: i,\n                    });\n                }\n            }\n\n            return;\n        }\n\n        //pointer up\n        if (event.type === 'pointerup') {\n            //gesture object should always exist here\n\n            if (event.pointerType === 'touch') {\n                let i = 0;\n                for (; i < this.gestureObj.touchPointerArr.length; i++) {\n                    if (this.gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\n                        this.gestureObj.touchPointerArr.splice(i, 1);\n                        break;\n                    }\n                }\n                if (this.gestureObj.touchPointerArr.length > 0) {\n                    this.continuePinch(this.gestureObj, {\n                        type: 'up',\n                        index: i,\n                    });\n                }\n            } else {\n                // non-touch\n                for (let i = 0; i < this.gestureObj.otherPointerIdArr.length; i++) {\n                    if (this.gestureObj.otherPointerIdArr[i] === event.pointerId) {\n                        this.gestureObj.otherPointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n\n            //all fingers lifted?\n            if (\n                this.gestureObj.touchPointerArr.length === 0 &&\n                this.gestureObj.otherPointerIdArr.length === 0\n            ) {\n                if (this.gestureObj.isInProgress) {\n                    // lifted last finger -> end of pinching\n                    this.end();\n                    this.endPinch();\n                } else {\n                    // lifted finger again before pinching started -> fail\n                    this.fail();\n                }\n                return;\n            }\n        }\n    }\n\n    private beginPinch(gestureObj: TPinchGesture): void {\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\n            const pointerObj = gestureObj.touchPointerArr[i];\n            this.pincherArr.push({\n                pointerId: pointerObj.pointerId,\n                relX: pointerObj.relX,\n                relY: pointerObj.relY,\n                downRelX: pointerObj.relX,\n                downRelY: pointerObj.relY,\n            });\n        }\n\n        const event: TPinchZoomerEvent = {\n            type: 'move',\n\n            // temp\n            downRelX: 0,\n            downRelY: 0,\n            relX: 0,\n            relY: 0,\n\n            angleRad: 0,\n            scale: 1,\n        };\n\n        if (this.pincherArr.length === 1) {\n            event.relX = this.pincherArr[0].downRelX;\n            event.relY = this.pincherArr[0].downRelY;\n        } else {\n            event.relX = 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX);\n            event.relY = 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY);\n        }\n        event.downRelX = event.relX;\n        event.downRelY = event.relY;\n\n        this.onPinch(event);\n    }\n\n    //actionObj = {type: 'down'|'move'|'up', index: number}\n    private continuePinch(\n        gestureObj: TPinchGesture,\n        actionObj: {\n            type: 'down' | 'move' | 'up';\n            index: number;\n        },\n    ): void {\n        if (actionObj.index > 1) {\n            // only first two pointers matter\n            return;\n        }\n\n        if (actionObj.type === 'move') {\n            let event: TPinchZoomerEvent;\n            this.pincherArr[actionObj.index].relX =\n                gestureObj.touchPointerArr[actionObj.index].relX;\n            this.pincherArr[actionObj.index].relY =\n                gestureObj.touchPointerArr[actionObj.index].relY;\n\n            if (this.pincherArr.length === 1) {\n                event = {\n                    type: 'move',\n                    downRelX: this.pincherArr[0].downRelX,\n                    downRelY: this.pincherArr[0].downRelY,\n                    relX: this.pincherArr[0].relX,\n                    relY: this.pincherArr[0].relY,\n                    angleRad: 0,\n                    scale: 1,\n                };\n            } else {\n                const startDist = dist(\n                    this.pincherArr[0].downRelX,\n                    this.pincherArr[0].downRelY,\n                    this.pincherArr[1].downRelX,\n                    this.pincherArr[1].downRelY,\n                );\n                const distance = dist(\n                    this.pincherArr[0].relX,\n                    this.pincherArr[0].relY,\n                    this.pincherArr[1].relX,\n                    this.pincherArr[1].relY,\n                );\n\n                const startAngle = pointsToAngleRad(\n                    {\n                        x: this.pincherArr[0].downRelX,\n                        y: this.pincherArr[0].downRelY,\n                    },\n                    {\n                        x: this.pincherArr[1].downRelX,\n                        y: this.pincherArr[1].downRelY,\n                    },\n                );\n                const angle = pointsToAngleRad(\n                    {\n                        x: this.pincherArr[0].relX,\n                        y: this.pincherArr[0].relY,\n                    },\n                    { x: this.pincherArr[1].relX, y: this.pincherArr[1].relY },\n                );\n\n                event = {\n                    type: 'move',\n                    downRelX: 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX),\n                    downRelY: 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY),\n                    relX: 0.5 * (this.pincherArr[0].relX + this.pincherArr[1].relX),\n                    relY: 0.5 * (this.pincherArr[0].relY + this.pincherArr[1].relY),\n                    angleRad: angle - startAngle,\n                    scale: distance / startDist,\n                };\n            }\n\n            this.onPinch(event);\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\n            this.endPinch();\n            this.beginPinch(gestureObj);\n        }\n    }\n\n    private endPinch(): void {\n        this.pincherArr = [];\n        this.onPinch({\n            type: 'end',\n        });\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: { onPinch: (e: TPinchZoomerEvent) => void }) {\n        this.onPinch = p.onPinch;\n    }\n\n    chainIn(event: TPointerEvent): TPointerEvent | null {\n        this.processEvent(event);\n        if (this.gestureObj) {\n            if (!this.gestureObj.isInProgress) {\n                // might still fail -> into queue\n                this.eventQueueArr.push(event);\n            }\n        } else {\n            return event;\n        }\n        return null;\n    }\n\n    setChainOut(func: (e: TPointerEvent) => void): void {\n        this.chainOut = func;\n    }\n}\n","import { TChainOutFunc } from './event-chain.types';\nimport { dist } from '../../math/math';\nimport { TPointerButton, TPointerEvent, TPointerType } from '../event.types';\n\nexport type TDoubleTapperEvent = {\n    pageX: number;\n    pageY: number;\n    relX: number;\n    relY: number;\n};\n\ntype TDoubleTapperTimeoutType = 'fail' | 'maxUntilSecondDown' | 'success';\n\n/**\n * A ChainElement. Detects double taps.\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class DoubleTapper {\n    private readonly onDoubleTap: (e: TDoubleTapperEvent) => void;\n    private chainOut: TChainOutFunc | undefined;\n    private allowedPointerTypeArr: TPointerType[] = ['touch', 'mouse', 'pen'];\n    private allowedButtonArr: TPointerButton[] = ['left'];\n    private readonly minSilenceBeforeDurationMs: number = 400;\n    private maxPressedDurationMs: number = 300;\n    private maxPressedDistancePx: number = 10;\n    private maxInbetweenDistancePx: number = 19;\n    private maxUpToUpDurationMs: number = 500;\n    private maxUntilSecondDownDurationMs: number = 300;\n    private readonly minSilenceAfterMs: number = 250;\n    private sequenceArr: (\n        | {\n              isDown: boolean;\n              time: number;\n              position: [number, number];\n              pointerId: number;\n          }\n        | {\n              isUp: boolean;\n              time: number;\n              position: [number, number];\n          }\n        | {\n              pageX: number;\n              pageY: number;\n              relX: number;\n              relY: number;\n          }\n    )[] = [];\n    private pointersDownIdArr: number[] = [];\n    private lastUpTime: number = 0;\n    private nowTime: number = 0;\n    private eventQueueArr: TPointerEvent[] = [];\n    private timeoutObj: {\n        [K in TDoubleTapperTimeoutType]: ReturnType<typeof setTimeout> | null;\n    } = {\n        fail: null,\n        maxUntilSecondDown: null,\n        success: null,\n    };\n    private readonly gestureFailed: () => void;\n\n    // double tap achieved\n    private success(): void {\n        this.timeoutObj.fail = null;\n        this.timeoutObj.success = null;\n        this.eventQueueArr = []; // events get swallowed\n        const lastSequenceItem = this.sequenceArr[this.sequenceArr.length - 1];\n        this.sequenceArr = [];\n        if ('pageX' in lastSequenceItem) {\n            this.onDoubleTap({\n                pageX: lastSequenceItem.pageX,\n                pageY: lastSequenceItem.pageY,\n                relX: lastSequenceItem.relX,\n                relY: lastSequenceItem.relY,\n            });\n        }\n    }\n\n    // returns false if time already up. otherwise sets up timeout\n    private setupTimeout(\n        timeoutStr: TDoubleTapperTimeoutType,\n        targetFunc: () => void,\n        timeMS: number,\n        noComparison?: boolean,\n    ): boolean {\n        const diff = timeMS - this.nowTime;\n        // console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0 && !noComparison) {\n            // time already up\n            return false;\n        }\n        this.timeoutObj[timeoutStr] = setTimeout(targetFunc, Math.max(0, diff));\n        return true;\n    }\n\n    /**\n     * @param event object - a pointer event from BB.PointerListener\n     */\n    private processEvent(event: TPointerEvent): void {\n        if (event.type === 'pointerdown') {\n            this.pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\n                if (this.pointersDownIdArr[i] === event.pointerId) {\n                    this.pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (!this.allowedPointerTypeArr.includes(event.pointerType)) {\n            //wrong input type -> fail\n            //console.log('wrong input type -> fail');\n            this.gestureFailed();\n            return;\n        }\n\n        this.nowTime = performance.now();\n        const lastSequenceItem =\n            this.sequenceArr.length > 0 ? this.sequenceArr[this.sequenceArr.length - 1] : null;\n        if (event.type === 'pointerup') {\n            this.lastUpTime = event.time;\n        }\n\n        if (event.type === 'pointerdown') {\n            if (this.pointersDownIdArr.length > 1) {\n                // more than one pointer down -> fail\n                //console.log('more than one pointer down -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (this.timeoutObj.success !== null) {\n                // silence-after not achieved -> fail\n                //console.log('silence-after not achieved -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (\n                this.sequenceArr.length === 0 &&\n                this.nowTime - this.lastUpTime < this.minSilenceBeforeDurationMs\n            ) {\n                // silence before not achieved -> fail\n                //console.log('silence before not achieved -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (event.button && !this.allowedButtonArr.includes(event.button)) {\n                // wrong button -> fail\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\n                this.gestureFailed();\n                return;\n            }\n            if (\n                (lastSequenceItem && 'isDown' in lastSequenceItem && lastSequenceItem.isDown) ||\n                this.sequenceArr.length > 2\n            ) {\n                // jumbled -> fail\n                //console.log('jumbled -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (lastSequenceItem && 'position' in lastSequenceItem) {\n                const distance = dist(\n                    lastSequenceItem.position[0],\n                    lastSequenceItem.position[1],\n                    event.pageX,\n                    event.pageY,\n                );\n                if (distance > this.maxInbetweenDistancePx) {\n                    //moved too much -> reset\n                    //console.log('maxInbetweenDistancePx -> reset');\n                    this.gestureFailed();\n\n                    if (\n                        'time' in lastSequenceItem &&\n                        this.nowTime - lastSequenceItem.time < this.minSilenceBeforeDurationMs\n                    ) {\n                        //silence before not achieved -> fail\n                        return;\n                    }\n                }\n            }\n            this.sequenceArr.push({\n                isDown: true,\n                time: this.nowTime,\n                position: [event.pageX, event.pageY],\n                pointerId: event.pointerId,\n            });\n            //maxUntilSecondDown\n\n            if (this.sequenceArr.length > 1) {\n                this.timeoutObj.maxUntilSecondDown &&\n                    clearTimeout(this.timeoutObj.maxUntilSecondDown);\n            } else if (\n                !this.setupTimeout(\n                    'maxUntilSecondDown',\n                    () => this.gestureFailed(),\n                    event.time + this.maxUntilSecondDownDurationMs,\n                )\n            ) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                this.gestureFailed();\n                return;\n            }\n\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n            if (\n                !this.setupTimeout(\n                    'fail',\n                    () => this.gestureFailed(),\n                    event.time + this.maxPressedDurationMs,\n                )\n            ) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                this.gestureFailed();\n                return;\n            }\n        }\n        if (\n            lastSequenceItem &&\n            event.type === 'pointermove' &&\n            'pointerId' in lastSequenceItem &&\n            lastSequenceItem.pointerId === event.pointerId\n        ) {\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                console.log('another pointer mixing in -> fail');\n                this.fail();\n                return;\n            }*/\n            const distance = dist(\n                lastSequenceItem.position[0],\n                lastSequenceItem.position[1],\n                event.pageX,\n                event.pageY,\n            );\n            if (distance > this.maxPressedDistancePx) {\n                //moved too much -> fail\n                //console.log('maxPressedDistancePx -> fail');\n                this.gestureFailed();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === 'pointerup') {\n            if ('pointerId' in lastSequenceItem && lastSequenceItem.pointerId !== event.pointerId) {\n                //another pointer mixing in -> fail\n                this.gestureFailed();\n                return;\n            }\n            if (\n                'time' in lastSequenceItem &&\n                this.nowTime >= lastSequenceItem.time + this.maxPressedDurationMs\n            ) {\n                //pressed too long -> fail\n                this.gestureFailed();\n                return;\n            }\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n\n            if (this.sequenceArr.length < 3) {\n                if (\n                    !this.setupTimeout(\n                        'fail',\n                        () => this.gestureFailed(),\n                        event.time + this.maxUpToUpDurationMs,\n                    )\n                ) {\n                    this.gestureFailed();\n                    return;\n                }\n\n                this.sequenceArr = [\n                    lastSequenceItem,\n                    {\n                        isUp: true,\n                        time: this.nowTime,\n                        position: [event.pageX, event.pageY],\n                    },\n                ];\n                return;\n            }\n\n            if (\n                'time' in this.sequenceArr[1] &&\n                this.nowTime < this.sequenceArr[1].time + this.maxUpToUpDurationMs\n            ) {\n                // double tap almost success\n                // only needs silence\n                this.sequenceArr.push({\n                    pageX: event.pageX,\n                    pageY: event.pageY,\n                    relX: event.relX,\n                    relY: event.relY,\n                });\n                if (\n                    !this.setupTimeout(\n                        'success',\n                        () => this.success(),\n                        event.time + this.minSilenceAfterMs,\n                        true,\n                    )\n                ) {\n                    this.gestureFailed();\n                }\n            } else {\n                // time up -> fail\n                this.gestureFailed();\n            }\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        onDoubleTap: (e: TDoubleTapperEvent) => void; // fires when double tap occurs\n        isInstant?: boolean;\n    }) {\n        this.onDoubleTap = p.onDoubleTap;\n        if (p.isInstant) {\n            this.minSilenceBeforeDurationMs = 0;\n            this.minSilenceAfterMs = 0;\n        }\n        this.gestureFailed = () => {\n            if (this.sequenceArr.length === 0) {\n                // no gesture started -> can be ignored\n                return;\n            }\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n            this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\n            this.timeoutObj.success && clearTimeout(this.timeoutObj.success);\n            this.timeoutObj.fail = null;\n            this.timeoutObj.maxUntilSecondDown = null;\n            this.timeoutObj.success = null;\n\n            if (this.chainOut) {\n                for (let i = 0; i < this.eventQueueArr.length; i++) {\n                    this.chainOut(this.eventQueueArr[i]);\n                }\n            }\n\n            this.eventQueueArr = [];\n            this.sequenceArr = [];\n        };\n    }\n\n    chainIn(event: TPointerEvent): TPointerEvent | null {\n        this.processEvent(event);\n\n        if (this.sequenceArr.length === 0) {\n            //existing events can not become a double tap\n            this.gestureFailed();\n            return event;\n        }\n        // events might become a double tap -> queue\n        this.eventQueueArr.push(event);\n        return null;\n    }\n\n    setChainOut(func: TChainOutFunc): void {\n        this.chainOut = func;\n    }\n\n    setAllowedPointerTypeArr(arr: TPointerType[]): void {\n        this.allowedPointerTypeArr = [...arr];\n    }\n\n    setAllowedButtonArr(arr: TPointerButton[]): void {\n        this.allowedButtonArr = [...arr];\n    }\n}\n","import { TChainOutFunc } from './event-chain.types';\nimport { TPointerEvent } from '../event.types';\n\n/**\n * only lets through events from one pointer at a time.\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class OnePointerLimiter {\n    private chainOut: TChainOutFunc | undefined;\n    private downPointerId: number | null = null;\n    private readonly ignorePointerIdArr: number[] = [];\n\n    // ----------------------------------- public -----------------------------------\n    chainIn(event: TPointerEvent): TPointerEvent | null {\n        if (this.ignorePointerIdArr.includes(event.pointerId)) {\n            if (event.type === 'pointerup') {\n                for (let i = 0; i < this.ignorePointerIdArr.length; i++) {\n                    if (this.ignorePointerIdArr[i] === event.pointerId) {\n                        this.ignorePointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n            return null;\n        }\n\n        if (this.downPointerId === null) {\n            if (event.type === 'pointerdown') {\n                this.downPointerId = event.pointerId;\n            }\n            return event;\n        } else {\n            if (event.pointerId !== this.downPointerId) {\n                if (event.type === 'pointerdown') {\n                    this.ignorePointerIdArr.push(event.pointerId);\n                }\n                return null;\n            }\n            if (event.type === 'pointerup') {\n                this.downPointerId = null;\n            }\n            return event;\n        }\n    }\n\n    setChainOut(func: TChainOutFunc): void {\n        this.chainOut = func;\n    }\n}\n","import { TChainElement, TChainOutFunc } from './event-chain.types';\nimport { TPointerEvent } from '../event.types';\n\n/**\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\n * each element in the chain might hold back the events, swallow them, transform them, or create new ones\n */\nexport class EventChain {\n    private readonly chainArr: TChainElement[];\n    private chainOut: TChainOutFunc | undefined;\n\n    private continueChain(i: number, event: TPointerEvent): null {\n        for (; i < this.chainArr.length; i++) {\n            event = this.chainArr[i].chainIn(event);\n            if (event === null) {\n                return null;\n            }\n        }\n        this.chainOut && this.chainOut(event);\n        return null;\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: { chainArr: TChainElement[] }) {\n        this.chainArr = p.chainArr;\n\n        for (let i = 0; i < this.chainArr.length; i++) {\n            ((i) => {\n                this.chainArr[i].setChainOut((event: TPointerEvent) => {\n                    this.continueChain(i + 1, event);\n                });\n            })(i);\n        }\n    }\n\n    /**\n     * feed an event into the chain\n     */\n    chainIn(event: TPointerEvent): null {\n        return this.continueChain(0, event);\n    }\n\n    /**\n     * func will be called when event has passed through the chain\n     */\n    setChainOut(func: TChainOutFunc): void {\n        this.chainOut = func;\n    }\n}\n","import { english, languages, loadLanguage, TTranslationCode } from '../../languages/languages';\nimport { LocalStorage } from '../bb/base/local-storage';\n\nexport const LS_LANGUAGE_KEY = 'klecks-language';\n\nclass LanguageStrings {\n    private data: any;\n    private listeners: (() => void)[] = [];\n    private code: string;\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {\n        // need to use setLanguage for a different language\n        this.data = { ...english };\n        this.code = 'en';\n    }\n\n    async setLanguage(langCode: string): Promise<void> {\n        if (langCode === 'en') {\n            this.data = { ...english };\n        } else {\n            this.data = { ...english, ...(await loadLanguage(langCode)) };\n        }\n        this.code = langCode;\n        document.documentElement.setAttribute('lang', langCode);\n        this.listeners.forEach((item) => {\n            item();\n        });\n    }\n\n    get(code: TTranslationCode): string {\n        if (!(code in this.data)) {\n            throw new Error(\"translation code doesn't exist: \" + code);\n        }\n        return this.data[code];\n    }\n\n    getLanguage(): { code: string; name: string } {\n        return languages.find((item) => {\n            return item.code === this.code;\n        })!;\n    }\n\n    getAutoLanguage(): { code: string; name: string } {\n        const autoCode = getLanguage(false);\n        return languages.find((item) => {\n            return item.code === autoCode;\n        })!;\n    }\n\n    getCode(): string {\n        return this.code;\n    }\n\n    // get notified on language change\n    subscribe(subscriber: () => void) {\n        if (this.listeners.includes(subscriber)) {\n            return;\n        }\n        this.listeners.push(subscriber);\n    }\n\n    unsubscribe(subscriber: () => void) {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (subscriber === this.listeners[i]) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n}\n\nexport function getLanguage(useLocalStorage?: boolean): string {\n    let result: string = 'en';\n\n    const langs: string[] = []; // from highest to lowest priority\n    const navLangs = navigator.languages ? navigator.languages : [navigator.language];\n    navLangs.forEach((item) => {\n        const split = item.split('-');\n        langs.push(item);\n        if (split.length === 2) {\n            langs.push(split[0]);\n        }\n    });\n\n    if (useLocalStorage) {\n        try {\n            const item = LocalStorage.getItem(LS_LANGUAGE_KEY);\n            if (item) {\n                langs.unshift(item);\n            }\n        } catch (e) {\n            // likely cookies disabled in Safari\n        }\n    }\n\n    for (let i = 0; i < langs.length; i++) {\n        const lang = langs[i];\n        const found = languages.find((item) => {\n            return item.code.toLowerCase() === lang.toLowerCase();\n        });\n        if (found) {\n            result = found.code;\n            break;\n        }\n    }\n    return result;\n}\n\nconst activeLanguageCode = getLanguage(true);\nexport const LANGUAGE_STRINGS = new LanguageStrings();\n\nexport const LANG = (code: TTranslationCode, replace?: { [key: string]: string }): string => {\n    if (replace) {\n        let result = LANGUAGE_STRINGS.get(code);\n        const keyArr = Object.keys(replace);\n        keyArr.forEach((key) => {\n            result = result.replace(`{${key}}`, replace[key]);\n        });\n        return result;\n    } else {\n        return LANGUAGE_STRINGS.get(code);\n    }\n};\n\nexport const initLANG = () => LANGUAGE_STRINGS.setLanguage(activeLanguageCode);\n","// generated from src/languages. \"npm run lang:build\" to update\n\nimport dataEn from './en.json';\n\nexport const english = dataEn;\nexport const languages: {code: string; name: string}[] = [\n    {\n        code: 'en',\n        name: 'English',\n    },\n    {\n        code: 'de',\n        name: 'Deutsch',\n    },\n    {\n        code: 'es',\n        name: 'Espaol',\n    },\n    {\n        code: 'fi',\n        name: 'suomi',\n    },\n    {\n        code: 'fr',\n        name: 'Franais',\n    },\n    {\n        code: 'hu',\n        name: 'Magyar',\n    },\n    {\n        code: 'id',\n        name: 'Bahasa Indonesia',\n    },\n    {\n        code: 'ja',\n        name: '',\n    },\n    {\n        code: 'jv',\n        name: 'Basa Jawa',\n    },\n    {\n        code: 'ko',\n        name: '',\n    },\n    {\n        code: 'lv',\n        name: 'Latvieu Valoda',\n    },\n    {\n        code: 'nl',\n        name: 'Nederlands',\n    },\n    {\n        code: 'pt-BR',\n        name: 'Portugus Brasil',\n    },\n    {\n        code: 'ru',\n        name: '',\n    },\n    {\n        code: 'su',\n        name: 'Basa Sunda',\n    },\n    {\n        code: 'sv',\n        name: 'Svenska',\n    },\n    {\n        code: 'zh-CN',\n        name: '',\n    },\n    {\n        code: 'zh-TW',\n        name: '',\n    },\n];\nexport const loadLanguage = async (code: string): Promise<Partial<Record<TTranslationCode, string>>> => {\n    if (code === 'en') {\n        return english;\n    } else if (code === 'de') {\n        return await import('./de.json');\n    } else if (code === 'es') {\n        return await import('./es.json');\n    } else if (code === 'fi') {\n        return await import('./fi.json');\n    } else if (code === 'fr') {\n        return await import('./fr.json');\n    } else if (code === 'hu') {\n        return await import('./hu.json');\n    } else if (code === 'id') {\n        return await import('./id.json');\n    } else if (code === 'ja') {\n        return await import('./ja.json');\n    } else if (code === 'jv') {\n        return await import('./jv.json');\n    } else if (code === 'ko') {\n        return await import('./ko.json');\n    } else if (code === 'lv') {\n        return await import('./lv.json');\n    } else if (code === 'nl') {\n        return await import('./nl.json');\n    } else if (code === 'pt-BR') {\n        return await import('./pt-BR.json');\n    } else if (code === 'ru') {\n        return await import('./ru.json');\n    } else if (code === 'su') {\n        return await import('./su.json');\n    } else if (code === 'sv') {\n        return await import('./sv.json');\n    } else if (code === 'zh-CN') {\n        return await import('./zh-CN.json');\n    } else if (code === 'zh-TW') {\n        return await import('./zh-TW.json');\n    }\n    throw new Error('unknown language code');\n};\n\nexport type TTranslationCode = 'switch-ui-left-right' | // Switch left/right UI\n    'toggle-show-tools' | // Show/Hide Tools\n    'scroll' | // Scroll\n    'donate' | // Donate\n    'home' | // Home\n    'modal-new-tab' | // Open in new tab\n    'tab-edit' | // Edit\n    'tab-file' | // File\n    'tool-brush' | // Brush\n    'tool-paint-bucket' | // Paint Bucket\n    'tool-gradient' | // Gradient\n    'tool-shape' | // Shape\n    'tool-text' | // Text\n    'tool-hand' | // Hand Tool\n    'tool-select' | // Select Tool\n    'tool-zoom' | // Zoom\n    'tool-more-tools' | // More Tools\n    'tool-more-tools-click-again' | // Click again for more tools\n    'undo' | // Undo\n    'redo' | // Redo\n    'brush-pen' | // Pen\n    'brush-blend' | // Blend\n    'brush-sketchy' | // Sketchy\n    'brush-pixel' | // Pixel\n    'brush-chemy' | // Chemy\n    'brush-smudge' | // Smudge\n    'brush-size' | // Size\n    'brush-blending' | // Blending\n    'brush-toggle-pressure' | // Toggle Pressure Sensitivity\n    'brush-pen-circle' | // Circle\n    'brush-pen-chalk' | // Chalk\n    'brush-pen-calligraphy' | // Calligraphy\n    'brush-pen-square' | // Square\n    'brush-sketchy-scale' | // Scale\n    'brush-pixel-dither' | // Dither\n    'brush-chemy-fill' | // Fill\n    'brush-chemy-stroke' | // Stroke\n    'brush-chemy-mirror-x' | // Horizontal Symmetry\n    'brush-chemy-mirror-y' | // Vertical Symmetry\n    'brush-chemy-gradient' | // Gradient\n    'brush-eraser-transparent-bg' | // Transparent Background\n    'stabilizer' | // Stabilizer\n    'stabilizer-title' | // Stroke Stabilizer\n    'eyedropper' | // Eyedropper\n    'secondary-color' | // Secondary Color\n    'manual-color-input' | // Manual Color Input\n    'mci-hex' | // Hex\n    'mci-copy' | // Copy\n    'modal-ok' | // Ok\n    'modal-cancel' | // Cancel\n    'modal-close' | // Close\n    'layers-active-layer' | // Active Layer\n    'layers-layer' | // Layer\n    'layers-copy' | // copy\n    'layers-blending' | // Blending\n    'layers-new' | // New Layer\n    'layers-remove' | // Remove Layer\n    'layers-duplicate' | // Duplicate Layer\n    'layers-merge' | // Merge with layer below\n    'layers-clear' | // Clear layer\n    'layers-merge-all' | // Merge all\n    'layers-rename' | // Rename\n    'layers-active-layer-visible' | // Active layer is visible\n    'layers-active-layer-hidden' | // Active layer is hidden\n    'layers-visibility-toggle' | // Layer Visibility\n    'layers-blend-normal' | // normal\n    'layers-blend-darken' | // darken\n    'layers-blend-multiply' | // multiply\n    'layers-blend-color-burn' | // color burn\n    'layers-blend-lighten' | // lighten\n    'layers-blend-screen' | // screen\n    'layers-blend-color-dodge' | // color dodge\n    'layers-blend-overlay' | // overlay\n    'layers-blend-soft-light' | // soft light\n    'layers-blend-hard-light' | // hard light\n    'layers-blend-difference' | // difference\n    'layers-blend-exclusion' | // exclusion\n    'layers-blend-hue' | // hue\n    'layers-blend-saturation' | // saturation\n    'layers-blend-color' | // color\n    'layers-blend-luminosity' | // luminosity\n    'layers-rename-title' | // Rename Layer\n    'layers-rename-name' | // Name\n    'layers-rename-clear' | // Clear Name\n    'layers-rename-sketch' | // Sketch\n    'layers-rename-colors' | // Colors\n    'layers-rename-shading' | // Shading\n    'layers-rename-lines' | // Lines\n    'layers-rename-effects' | // Effects\n    'layers-rename-foreground' | // Foreground\n    'layers-merge-modal-title' | // Merge/Mix Layers\n    'layers-merge-description' | // Merges the selected layer with the one underneath. Select the mix mode:\n    'file-no-autosave' | // No autosave, no cloud storage\n    'file-new' | // New\n    'file-import' | // Import\n    'file-save' | // Save\n    'file-format' | // File Format\n    'file-show-save-dialog' | // Show save dialog\n    'file-copy' | // Copy\n    'file-copy-title' | // Copy To Clipboard\n    'file-paste' | // Paste\n    'file-share' | // Share\n    'file-storage' | // Browser Storage\n    'file-storage-about' | // About Browser Storage\n    'file-storage-cant-access' | // Can't access storage.\n    'file-storage-empty' | // Empty\n    'file-storage-store' | // Store\n    'file-storage-open' | // Open\n    'file-storage-open-confirmation' | // This image is already open in another tab. Open it here too?\n    'file-storage-open-failed' | // Failed to load.\n    'file-storage-clear' | // Clear\n    'file-storage-clear-prompt' | // Clear Browser Storage? Clearing can not be undone.\n    'file-storage-storing' | // Storing\n    'file-storage-overwrite' | // Overwrite\n    'file-storage-overwrite-confirm' | // Overwrite Browser Storage? Overwritten data will be permanently deleted.\n    'file-storage-min-ago' | // {x}min ago\n    'file-storage-hours-ago' | // {x}h ago\n    'file-storage-days-ago' | // {x}d ago\n    'file-storage-month-ago' | // > 1month ago\n    'file-storage-restored' | // Restored from Browser Storage\n    'file-storage-stored' | // Stored to Browser Storage\n    'file-storage-failed' | // Failed to store to Browser Storage\n    'file-storage-failed-1' | // Failed to store. Possible causes:\n    'file-storage-failed-2' | // Out of disk space\n    'file-storage-failed-3' | // Storage disabled in incognito tab\n    'file-storage-failed-4' | // Browser doesn't support storage\n    'file-storage-failed-clear' | // Failed to clear.\n    'file-upload' | // Upload\n    'tab-recovery-recover-tabs' | // Recover closed tabs\n    'tab-recovery-explanation' | // Recovery data is only kept for a little while. Save to ensure your work is not lost.\n    'tab-recovery-total-quota-label' | // Total:\n    'tab-recovery-empty' | // Nothing to recover.\n    'tab-recovery-recover' | // Recover\n    'tab-recovery-delete' | // Delete\n    'tab-recovery-delete-confirmation' | // Delete this recovery? Deletion can not be undone.\n    'tab-recovery-failed-to-recover' | // Failed to recover tab.\n    'tab-recovery-recovered' | // Tab recovered.\n    'cleared-layer' | // Cleared layer\n    'cleared-selected-area' | // Cleared selected area\n    'filled' | // Filled\n    'filled-selected-area' | // Filled selection\n    'new-title' | // New Image\n    'new-current' | // Current\n    'new-fit' | // Fit\n    'new-oversize' | // Oversize\n    'new-square' | // Square\n    'new-landscape' | // Landscape\n    'new-portrait' | // Portrait\n    'new-screen' | // Screen\n    'new-video' | // Video\n    'new-din-paper' | // DIN Paper\n    'new-px' | // px\n    'new-ratio' | // Ratio\n    'upload-title' | // Upload to Imgur\n    'upload-link-notice' | // Anyone with the link to your uploaded image will be able to view it.\n    'upload-name' | // Title\n    'upload-title-untitled' | // Untitled\n    'upload-caption' | // Caption\n    'upload-submit' | // Upload\n    'upload-uploading' | // Uploading...\n    'upload-success' | // Upload Successful\n    'upload-failed' | // Upload failed.\n    'upload-delete' | // To delete your image from Imgur visit:\n    'cropcopy-title-copy' | // Copy To Clipboard\n    'cropcopy-title-crop' | // Crop\n    'cropcopy-mask' | // Mask unselected\n    'cropcopy-click-hold' | // Right-click or press hold to copy.\n    'cropcopy-btn-copy' | // To Clipboard\n    'cropcopy-copied' | // Copied.\n    'cropcopy-btn-crop' | // Apply Crop\n    'crop-drag-to-crop' | // Drag to crop\n    'filter-crop-extend' | // Crop/Extend\n    'filter-flip' | // Flip\n    'filter-perspective' | // Perspective\n    'filter-resize' | // Resize\n    'filter-rotate' | // Rotate\n    'filter-transform' | // Transform\n    'filter-bright-contrast' | // Bright/Contrast\n    'filter-curves' | // Curves\n    'filter-hue-sat' | // Hue/Saturation\n    'filter-invert' | // Invert\n    'filter-tilt-shift' | // Tilt Shift\n    'filter-to-alpha' | // To Alpha\n    'filter-triangle-blur' | // Triangle Blur\n    'filter-unsharp-mask' | // Unsharp Mask\n    'filter-crop-title' | // Crop / Extend\n    'filter-crop-description' | // Crop or extend the image.\n    'filter-crop-left' | // Left\n    'filter-crop-right' | // Right\n    'filter-crop-top' | // Top\n    'filter-crop-bottom' | // Bottom\n    'filter-crop-rule-thirds' | // Rule of Thirds\n    'filter-crop-fill' | // Fill\n    'filter-flip-title' | // Flip\n    'filter-flip-description' | // Flips layer or whole image.\n    'filter-flip-horizontal' | // Horizontal\n    'filter-flip-vertical' | // Vertical\n    'filter-flip-image' | // Flip Image\n    'filter-flip-layer' | // Flip Layer\n    'filter-perspective-title' | // Perspective\n    'filter-perspective-description' | // Transforms the selected layer.\n    'filter-resize-title' | // Resize\n    'filter-resize-description' | // Resizes the image.\n    'filter-rotate-title' | // Rotate\n    'filter-rotate-description' | // Rotates the image.\n    'filter-transform-empty' | // Layer is empty.\n    'filter-transform-empty-selection' | // Layer is empty in selected area.\n    'filter-transform-title' | // Transform\n    'filter-transform-description' | // Transforms selected layer. Hold Shift for additional behavior.\n    'filter-transform-rotation' | // Rotation\n    'filter-transform-flip' | // Flip\n    'filter-transform-center' | // Center\n    'filter-transform-constrain' | // Constrain\n    'filter-transform-snap' | // Snap\n    'filter-transform-snap-title' | // Snap Rotation And Position\n    'filter-bright-contrast-title' | // Brightness / Contrast\n    'filter-bright-contrast-description' | // Change brightness and contrast for the selected layer.\n    'filter-bright-contrast-brightness' | // Brightness\n    'filter-bright-contrast-contrast' | // Contrast\n    'filter-curves-title' | // Curves\n    'filter-curves-description' | // Apply curves on the selected layer.\n    'filter-curves-all' | // All\n    'filter-hue-sat-title' | // Hue / Saturation\n    'filter-hue-sat-description' | // Change hue and saturation for the selected layer.\n    'filter-hue-sat-hue' | // Hue\n    'filter-hue-sat-saturation' | // Saturation\n    'filter-applied' | // applied\n    'filter-tilt-shift-title' | // Tilt Shift\n    'filter-tilt-shift-description' | // Applies tilt shift on the selected layer.\n    'filter-tilt-shift-blur' | // Blur Radius\n    'filter-tilt-shift-gradient' | // Gradient Radius\n    'filter-to-alpha-title' | // To Alpha\n    'filter-to-alpha-description' | // Generates alpha channel for selected layer from:\n    'filter-to-alpha-inverted-lum' | // Inverted Luminance\n    'filter-to-alpha-lum' | // Luminance\n    'filter-to-alpha-replace' | // Replace RGB\n    'filter-triangle-blur-title' | // Triangle Blur\n    'filter-triangle-blur-description' | // Applies triangle blur on the selected layer.\n    'filter-unsharp-mask-title' | // Unsharp Mask\n    'filter-unsharp-mask-description' | // Sharpens the selected layer by scaling pixels away from the average of their neighbors.\n    'filter-unsharp-mask-strength' | // Strength\n    'filter-grid' | // Grid\n    'filter-grid-description' | // Draws grid on selected layer.\n    'filter-noise' | // Noise\n    'filter-noise-description' | // Adds noise to selected layer.\n    'filter-noise-scale' | // Scale\n    'filter-noise-alpha' | // Alpha\n    'filter-pattern' | // Pattern\n    'filter-pattern-description' | // Generates pattern on selected layer. Drag the preview for further controls.\n    'filter-distort' | // Distort\n    'filter-distort-description' | // Distorts the selected layer.\n    'filter-distort-phase' | // Phase\n    'filter-distort-stepsize' | // Step Size\n    'filter-distort-sync-xy' | // Sync XY\n    'filter-vanish-point' | // Vanish Point\n    'filter-vanish-point-title' | // Vanishing Point\n    'filter-vanish-point-description' | // Adds vanishing point to selected layer. Drag preview to move.\n    'filter-vanish-point-lines' | // Lines\n    'dropper-drop' | // Drop to import\n    'dropper-as-image' | // As New Image\n    'dropper-as-layer' | // As Layer\n    'import-opening' | // Opening file...\n    'import-title' | // Import Image\n    'import-too-large' | // Image too large, will be downscaled.\n    'import-btn-as-layer' | // As Layer\n    'import-btn-as-image' | // As Image\n    'import-as-layer-title' | // Import Image as New Layer\n    'import-as-layer-description' | // Adjust the position of the imported image.\n    'import-as-layer-limit-reached' | // Layer limit reached. Image will be placed on existing layer.\n    'import-as-layer-fit' | // Fit\n    'import-flatten' | // Flatten image\n    'import-unsupported-file' | // Unsupported file type. See Help for supported types.\n    'import-broken-file' | // Couldn't load image. File might be corrupted.\n    'import-psd-unsupported' | // Unsupported features. PSD had to be flattened.\n    'import-psd-limited-support' | // PSD support is limited. Flattened will more likely look correct.\n    'import-psd-too-large' | // Image exceeds maximum dimensions of {x} x {x} pixels. Unable to import.\n    'import-psd-size' | // Image size\n    'clipboard-read-fail' | // Failed to read from clipboard.\n    'clipboard-no-image' | // No image found in clipboard.\n    'hand-reset' | // Reset\n    'hand-fit' | // Fit\n    'hand-inertia-scrolling' | // Inertia Scrolling\n    'bucket-tolerance' | // Tolerance\n    'bucket-sample' | // Sample\n    'bucket-sample-title' | // Which layers to sample color from\n    'bucket-sample-all' | // All\n    'bucket-sample-active' | // Active\n    'bucket-sample-above' | // Above\n    'bucket-grow' | // Grow\n    'bucket-grow-title' | // Grow filled area (in pixels)\n    'bucket-contiguous' | // Contiguous\n    'bucket-contiguous-title' | // Only fill connected areas\n    'gradient-linear' | // Linear\n    'gradient-linear-mirror' | // Linear-Mirror\n    'gradient-radial' | // Radial\n    'shape-stroke' | // Stroke\n    'shape-fill' | // Fill\n    'shape-rect' | // Rectangle\n    'shape-ellipse' | // Ellipse\n    'shape-line' | // Line\n    'shape-line-width' | // Line Width\n    'shape-outwards' | // Outwards\n    'shape-fixed' | // Fixed 1:1\n    'shape-auto-pan' | // Auto-pan\n    'shape-auto-pan-title' | // Automatically moves as you draw\n    'text-instruction' | // Click canvas to place text\n    'text-title' | // Add Text\n    'text-text' | // Text\n    'text-font' | // Font\n    'text-placeholder' | // Your text\n    'text-color' | // Color\n    'text-size' | // Size\n    'text-line-height' | // Line Height\n    'text-letter-spacing' | // Letter Spacing\n    'text-left' | // Left\n    'text-center' | // Center\n    'text-right' | // Right\n    'text-italic' | // Italic\n    'text-bold' | // Bold\n    'text-failed-import' | // Failed to import the following files:\n    'text-supported-formats' | // Supported formats:\n    'select-select' | // Select\n    'select-transform' | // Transform\n    'select-lasso' | // Lasso\n    'select-polygon' | // Polygon\n    'select-boolean-replace' | // Replace\n    'select-boolean-add' | // Add\n    'select-boolean-subtract' | // Subtract\n    'select-all' | // All\n    'select-invert' | // Invert\n    'select-reset' | // Reset\n    'select-fill' | // Fill\n    'select-erase' | // Erase\n    'select-transform-clone' | // Clone\n    'select-transform-clone-applied' | // Cloned\n    'select-transform-move-to-layer' | // Move to layer:\n    'select-transform-applied' | // Transformation applied\n    'select-transform-empty' | // Selected area on active layer is empty.\n    'save-reminder-title' | // Unsaved Work\n    'save-reminder-text' | // Image was not saved in {a} minutes{b}. Save now to prevent eventual loss.\n    'save-reminder-save-psd' | // Save As PSD\n    'save-reminder-psd-layers' | // PSD will remember all layers.\n    'backup-drawing' | // You can backup your drawing.\n    'submit' | // Submit\n    'submit-title' | // Submit Drawing\n    'submit-prompt' | // Submit drawing?\n    'submit-submitting' | // Submitting\n    'embed-init-loading' | // Loading app\n    'embed-init-waiting' | // Waiting for image\n    'help' | // Help\n    'tab-settings' | // Settings\n    'settings-language' | // Language\n    'settings-language-reload' | // Will update after reloading.\n    'settings-theme' | // Theme\n    'settings-save-reminder-label' | // Save Reminder\n    'settings-save-reminder-disabled' | // disabled\n    'settings-save-reminder-confirm-title' | // Turn off Save Reminder?\n    'settings-save-reminder-confirm-a' | // There is no autosave and browser tabs don't last forever. If you don't periodically save you will likely lose work.\n    'settings-save-reminder-confirm-b' | // Disable at your own risk?\n    'settings-save-reminder-confirm-disable' | // Disable\n    'theme-dark' | // Dark\n    'theme-light' | // Light\n    'terms-of-service' | // Terms of Service\n    'licenses' | // Licenses\n    'source-code' | // Source Code\n    'auto' | // auto\n    'zoom-in' | // Zoom In\n    'zoom-out' | // Zoom Out\n    'radius' | // Radius\n    'constrain-proportions' | // Constrain Proportions\n    'width' | // Width\n    'height' | // Height\n    'opacity' | // Opacity\n    'scatter' | // Scatter\n    'red' | // Red\n    'green' | // Green\n    'blue' | // Blue\n    'eraser' | // Eraser\n    'center' | // Center\n    'layers' | // Layers\n    'background' | // Background\n    'scaling-algorithm' | // Scaling Algorithm\n    'algorithm-smooth' | // Smooth\n    'algorithm-pixelated' | // Pixelated\n    'preview' | // Preview\n    'angle-snap' | // Snap\n    'angle-snap-title' | // 45 Angle Snapping\n    'lock-alpha' | // Lock Alpha\n    'lock-alpha-title' | // Locks layer's alpha channel\n    'reverse' | // Reverse\n    'compare-before' | // Before\n    'compare-after' | // After\n    'loading' | // Loading\n    'more' | // More\n    'x-minutes' | // {x}min\n    'wip' | // Work in progress\n    'browser-zoom-help' | // Double-tap or pinch-out to reset browser zoom.\n    'dismiss'; // Dismiss\n","{\"switch-ui-left-right\":\"Switch left/right UI\",\"toggle-show-tools\":\"Show/Hide Tools\",\"scroll\":\"Scroll\",\"donate\":\"Donate\",\"home\":\"Home\",\"modal-new-tab\":\"Open in new tab\",\"tab-edit\":\"Edit\",\"tab-file\":\"File\",\"tool-brush\":\"Brush\",\"tool-paint-bucket\":\"Paint Bucket\",\"tool-gradient\":\"Gradient\",\"tool-shape\":\"Shape\",\"tool-text\":\"Text\",\"tool-hand\":\"Hand Tool\",\"tool-select\":\"Select Tool\",\"tool-zoom\":\"Zoom\",\"tool-more-tools\":\"More Tools\",\"tool-more-tools-click-again\":\"Click again for more tools\",\"undo\":\"Undo\",\"redo\":\"Redo\",\"brush-pen\":\"Pen\",\"brush-blend\":\"Blend\",\"brush-sketchy\":\"Sketchy\",\"brush-pixel\":\"Pixel\",\"brush-chemy\":\"Chemy\",\"brush-smudge\":\"Smudge\",\"brush-size\":\"Size\",\"brush-blending\":\"Blending\",\"brush-toggle-pressure\":\"Toggle Pressure Sensitivity\",\"brush-pen-circle\":\"Circle\",\"brush-pen-chalk\":\"Chalk\",\"brush-pen-calligraphy\":\"Calligraphy\",\"brush-pen-square\":\"Square\",\"brush-sketchy-scale\":\"Scale\",\"brush-pixel-dither\":\"Dither\",\"brush-chemy-fill\":\"Fill\",\"brush-chemy-stroke\":\"Stroke\",\"brush-chemy-mirror-x\":\"Horizontal Symmetry\",\"brush-chemy-mirror-y\":\"Vertical Symmetry\",\"brush-chemy-gradient\":\"Gradient\",\"brush-eraser-transparent-bg\":\"Transparent Background\",\"stabilizer\":\"Stabilizer\",\"stabilizer-title\":\"Stroke Stabilizer\",\"eyedropper\":\"Eyedropper\",\"secondary-color\":\"Secondary Color\",\"manual-color-input\":\"Manual Color Input\",\"mci-hex\":\"Hex\",\"mci-copy\":\"Copy\",\"modal-ok\":\"Ok\",\"modal-cancel\":\"Cancel\",\"modal-close\":\"Close\",\"layers-active-layer\":\"Active Layer\",\"layers-layer\":\"Layer\",\"layers-copy\":\"copy\",\"layers-blending\":\"Blending\",\"layers-new\":\"New Layer\",\"layers-remove\":\"Remove Layer\",\"layers-duplicate\":\"Duplicate Layer\",\"layers-merge\":\"Merge with layer below\",\"layers-clear\":\"Clear layer\",\"layers-merge-all\":\"Merge all\",\"layers-rename\":\"Rename\",\"layers-active-layer-visible\":\"Active layer is visible\",\"layers-active-layer-hidden\":\"Active layer is hidden\",\"layers-visibility-toggle\":\"Layer Visibility\",\"layers-blend-normal\":\"normal\",\"layers-blend-darken\":\"darken\",\"layers-blend-multiply\":\"multiply\",\"layers-blend-color-burn\":\"color burn\",\"layers-blend-lighten\":\"lighten\",\"layers-blend-screen\":\"screen\",\"layers-blend-color-dodge\":\"color dodge\",\"layers-blend-overlay\":\"overlay\",\"layers-blend-soft-light\":\"soft light\",\"layers-blend-hard-light\":\"hard light\",\"layers-blend-difference\":\"difference\",\"layers-blend-exclusion\":\"exclusion\",\"layers-blend-hue\":\"hue\",\"layers-blend-saturation\":\"saturation\",\"layers-blend-color\":\"color\",\"layers-blend-luminosity\":\"luminosity\",\"layers-rename-title\":\"Rename Layer\",\"layers-rename-name\":\"Name\",\"layers-rename-clear\":\"Clear Name\",\"layers-rename-sketch\":\"Sketch\",\"layers-rename-colors\":\"Colors\",\"layers-rename-shading\":\"Shading\",\"layers-rename-lines\":\"Lines\",\"layers-rename-effects\":\"Effects\",\"layers-rename-foreground\":\"Foreground\",\"layers-merge-modal-title\":\"Merge/Mix Layers\",\"layers-merge-description\":\"Merges the selected layer with the one underneath. Select the mix mode:\",\"file-no-autosave\":\"No autosave, no cloud storage\",\"file-new\":\"New\",\"file-import\":\"Import\",\"file-save\":\"Save\",\"file-format\":\"File Format\",\"file-show-save-dialog\":\"Show save dialog\",\"file-copy\":\"Copy\",\"file-copy-title\":\"Copy To Clipboard\",\"file-paste\":\"Paste\",\"file-share\":\"Share\",\"file-storage\":\"Browser Storage\",\"file-storage-about\":\"About Browser Storage\",\"file-storage-cant-access\":\"Can't access storage.\",\"file-storage-empty\":\"Empty\",\"file-storage-store\":\"Store\",\"file-storage-open\":\"Open\",\"file-storage-open-confirmation\":\"This image is already open in another tab. Open it here too?\",\"file-storage-open-failed\":\"Failed to load.\",\"file-storage-clear\":\"Clear\",\"file-storage-clear-prompt\":\"Clear Browser Storage? Clearing can not be undone.\",\"file-storage-storing\":\"Storing\",\"file-storage-overwrite\":\"Overwrite\",\"file-storage-overwrite-confirm\":\"Overwrite Browser Storage? Overwritten data will be permanently deleted.\",\"file-storage-min-ago\":\"{x}min ago\",\"file-storage-hours-ago\":\"{x}h ago\",\"file-storage-days-ago\":\"{x}d ago\",\"file-storage-month-ago\":\"> 1month ago\",\"file-storage-restored\":\"Restored from Browser Storage\",\"file-storage-stored\":\"Stored to Browser Storage\",\"file-storage-failed\":\"Failed to store to Browser Storage\",\"file-storage-failed-1\":\"Failed to store. Possible causes:\",\"file-storage-failed-2\":\"Out of disk space\",\"file-storage-failed-3\":\"Storage disabled in incognito tab\",\"file-storage-failed-4\":\"Browser doesn't support storage\",\"file-storage-failed-clear\":\"Failed to clear.\",\"file-upload\":\"Upload\",\"tab-recovery-recover-tabs\":\"Recover closed tabs\",\"tab-recovery-explanation\":\"Recovery data is only kept for a little while. Save to ensure your work is not lost.\",\"tab-recovery-total-quota-label\":\"Total:\",\"tab-recovery-empty\":\"Nothing to recover.\",\"tab-recovery-recover\":\"Recover\",\"tab-recovery-delete\":\"Delete\",\"tab-recovery-delete-confirmation\":\"Delete this recovery? Deletion can not be undone.\",\"tab-recovery-failed-to-recover\":\"Failed to recover tab.\",\"tab-recovery-recovered\":\"Tab recovered.\",\"cleared-layer\":\"Cleared layer\",\"cleared-selected-area\":\"Cleared selected area\",\"filled\":\"Filled\",\"filled-selected-area\":\"Filled selection\",\"new-title\":\"New Image\",\"new-current\":\"Current\",\"new-fit\":\"Fit\",\"new-oversize\":\"Oversize\",\"new-square\":\"Square\",\"new-landscape\":\"Landscape\",\"new-portrait\":\"Portrait\",\"new-screen\":\"Screen\",\"new-video\":\"Video\",\"new-din-paper\":\"DIN Paper\",\"new-px\":\"px\",\"new-ratio\":\"Ratio\",\"upload-title\":\"Upload to Imgur\",\"upload-link-notice\":\"Anyone with the link to your uploaded image will be able to view it.\",\"upload-name\":\"Title\",\"upload-title-untitled\":\"Untitled\",\"upload-caption\":\"Caption\",\"upload-submit\":\"Upload\",\"upload-uploading\":\"Uploading...\",\"upload-success\":\"Upload Successful\",\"upload-failed\":\"Upload failed.\",\"upload-delete\":\"To delete your image from Imgur visit:\",\"cropcopy-title-copy\":\"Copy To Clipboard\",\"cropcopy-title-crop\":\"Crop\",\"cropcopy-mask\":\"Mask unselected\",\"cropcopy-click-hold\":\"Right-click or press hold to copy.\",\"cropcopy-btn-copy\":\"To Clipboard\",\"cropcopy-copied\":\"Copied.\",\"cropcopy-btn-crop\":\"Apply Crop\",\"crop-drag-to-crop\":\"Drag to crop\",\"filter-crop-extend\":\"Crop/Extend\",\"filter-flip\":\"Flip\",\"filter-perspective\":\"Perspective\",\"filter-resize\":\"Resize\",\"filter-rotate\":\"Rotate\",\"filter-transform\":\"Transform\",\"filter-bright-contrast\":\"Bright/Contrast\",\"filter-curves\":\"Curves\",\"filter-hue-sat\":\"Hue/Saturation\",\"filter-invert\":\"Invert\",\"filter-tilt-shift\":\"Tilt Shift\",\"filter-to-alpha\":\"To Alpha\",\"filter-triangle-blur\":\"Triangle Blur\",\"filter-unsharp-mask\":\"Unsharp Mask\",\"filter-crop-title\":\"Crop / Extend\",\"filter-crop-description\":\"Crop or extend the image.\",\"filter-crop-left\":\"Left\",\"filter-crop-right\":\"Right\",\"filter-crop-top\":\"Top\",\"filter-crop-bottom\":\"Bottom\",\"filter-crop-rule-thirds\":\"Rule of Thirds\",\"filter-crop-fill\":\"Fill\",\"filter-flip-title\":\"Flip\",\"filter-flip-description\":\"Flips layer or whole image.\",\"filter-flip-horizontal\":\"Horizontal\",\"filter-flip-vertical\":\"Vertical\",\"filter-flip-image\":\"Flip Image\",\"filter-flip-layer\":\"Flip Layer\",\"filter-perspective-title\":\"Perspective\",\"filter-perspective-description\":\"Transforms the selected layer.\",\"filter-resize-title\":\"Resize\",\"filter-resize-description\":\"Resizes the image.\",\"filter-rotate-title\":\"Rotate\",\"filter-rotate-description\":\"Rotates the image.\",\"filter-transform-empty\":\"Layer is empty.\",\"filter-transform-empty-selection\":\"Layer is empty in selected area.\",\"filter-transform-title\":\"Transform\",\"filter-transform-description\":\"Transforms selected layer. Hold Shift for additional behavior.\",\"filter-transform-rotation\":\"Rotation\",\"filter-transform-flip\":\"Flip\",\"filter-transform-center\":\"Center\",\"filter-transform-constrain\":\"Constrain\",\"filter-transform-snap\":\"Snap\",\"filter-transform-snap-title\":\"Snap Rotation And Position\",\"filter-bright-contrast-title\":\"Brightness / Contrast\",\"filter-bright-contrast-description\":\"Change brightness and contrast for the selected layer.\",\"filter-bright-contrast-brightness\":\"Brightness\",\"filter-bright-contrast-contrast\":\"Contrast\",\"filter-curves-title\":\"Curves\",\"filter-curves-description\":\"Apply curves on the selected layer.\",\"filter-curves-all\":\"All\",\"filter-hue-sat-title\":\"Hue / Saturation\",\"filter-hue-sat-description\":\"Change hue and saturation for the selected layer.\",\"filter-hue-sat-hue\":\"Hue\",\"filter-hue-sat-saturation\":\"Saturation\",\"filter-applied\":\"applied\",\"filter-tilt-shift-title\":\"Tilt Shift\",\"filter-tilt-shift-description\":\"Applies tilt shift on the selected layer.\",\"filter-tilt-shift-blur\":\"Blur Radius\",\"filter-tilt-shift-gradient\":\"Gradient Radius\",\"filter-to-alpha-title\":\"To Alpha\",\"filter-to-alpha-description\":\"Generates alpha channel for selected layer from:\",\"filter-to-alpha-inverted-lum\":\"Inverted Luminance\",\"filter-to-alpha-lum\":\"Luminance\",\"filter-to-alpha-replace\":\"Replace RGB\",\"filter-triangle-blur-title\":\"Triangle Blur\",\"filter-triangle-blur-description\":\"Applies triangle blur on the selected layer.\",\"filter-unsharp-mask-title\":\"Unsharp Mask\",\"filter-unsharp-mask-description\":\"Sharpens the selected layer by scaling pixels away from the average of their neighbors.\",\"filter-unsharp-mask-strength\":\"Strength\",\"filter-grid\":\"Grid\",\"filter-grid-description\":\"Draws grid on selected layer.\",\"filter-noise\":\"Noise\",\"filter-noise-description\":\"Adds noise to selected layer.\",\"filter-noise-scale\":\"Scale\",\"filter-noise-alpha\":\"Alpha\",\"filter-pattern\":\"Pattern\",\"filter-pattern-description\":\"Generates pattern on selected layer. Drag the preview for further controls.\",\"filter-distort\":\"Distort\",\"filter-distort-description\":\"Distorts the selected layer.\",\"filter-distort-phase\":\"Phase\",\"filter-distort-stepsize\":\"Step Size\",\"filter-distort-sync-xy\":\"Sync XY\",\"filter-vanish-point\":\"Vanish Point\",\"filter-vanish-point-title\":\"Vanishing Point\",\"filter-vanish-point-description\":\"Adds vanishing point to selected layer. Drag preview to move.\",\"filter-vanish-point-lines\":\"Lines\",\"dropper-drop\":\"Drop to import\",\"dropper-as-image\":\"As New Image\",\"dropper-as-layer\":\"As Layer\",\"import-opening\":\"Opening file...\",\"import-title\":\"Import Image\",\"import-too-large\":\"Image too large, will be downscaled.\",\"import-btn-as-layer\":\"As Layer\",\"import-btn-as-image\":\"As Image\",\"import-as-layer-title\":\"Import Image as New Layer\",\"import-as-layer-description\":\"Adjust the position of the imported image.\",\"import-as-layer-limit-reached\":\"Layer limit reached. Image will be placed on existing layer.\",\"import-as-layer-fit\":\"Fit\",\"import-flatten\":\"Flatten image\",\"import-unsupported-file\":\"Unsupported file type. See Help for supported types.\",\"import-broken-file\":\"Couldn't load image. File might be corrupted.\",\"import-psd-unsupported\":\"Unsupported features. PSD had to be flattened.\",\"import-psd-limited-support\":\"PSD support is limited. Flattened will more likely look correct.\",\"import-psd-too-large\":\"Image exceeds maximum dimensions of {x} x {x} pixels. Unable to import.\",\"import-psd-size\":\"Image size\",\"clipboard-read-fail\":\"Failed to read from clipboard.\",\"clipboard-no-image\":\"No image found in clipboard.\",\"hand-reset\":\"Reset\",\"hand-fit\":\"Fit\",\"hand-inertia-scrolling\":\"Inertia Scrolling\",\"bucket-tolerance\":\"Tolerance\",\"bucket-sample\":\"Sample\",\"bucket-sample-title\":\"Which layers to sample color from\",\"bucket-sample-all\":\"All\",\"bucket-sample-active\":\"Active\",\"bucket-sample-above\":\"Above\",\"bucket-grow\":\"Grow\",\"bucket-grow-title\":\"Grow filled area (in pixels)\",\"bucket-contiguous\":\"Contiguous\",\"bucket-contiguous-title\":\"Only fill connected areas\",\"gradient-linear\":\"Linear\",\"gradient-linear-mirror\":\"Linear-Mirror\",\"gradient-radial\":\"Radial\",\"shape-stroke\":\"Stroke\",\"shape-fill\":\"Fill\",\"shape-rect\":\"Rectangle\",\"shape-ellipse\":\"Ellipse\",\"shape-line\":\"Line\",\"shape-line-width\":\"Line Width\",\"shape-outwards\":\"Outwards\",\"shape-fixed\":\"Fixed 1:1\",\"shape-auto-pan\":\"Auto-pan\",\"shape-auto-pan-title\":\"Automatically moves as you draw\",\"text-instruction\":\"Click canvas to place text\",\"text-title\":\"Add Text\",\"text-text\":\"Text\",\"text-font\":\"Font\",\"text-placeholder\":\"Your text\",\"text-color\":\"Color\",\"text-size\":\"Size\",\"text-line-height\":\"Line Height\",\"text-letter-spacing\":\"Letter Spacing\",\"text-left\":\"Left\",\"text-center\":\"Center\",\"text-right\":\"Right\",\"text-italic\":\"Italic\",\"text-bold\":\"Bold\",\"text-failed-import\":\"Failed to import the following files:\",\"text-supported-formats\":\"Supported formats:\",\"select-select\":\"Select\",\"select-transform\":\"Transform\",\"select-lasso\":\"Lasso\",\"select-polygon\":\"Polygon\",\"select-boolean-replace\":\"Replace\",\"select-boolean-add\":\"Add\",\"select-boolean-subtract\":\"Subtract\",\"select-all\":\"All\",\"select-invert\":\"Invert\",\"select-reset\":\"Reset\",\"select-fill\":\"Fill\",\"select-erase\":\"Erase\",\"select-transform-clone\":\"Clone\",\"select-transform-clone-applied\":\"Cloned\",\"select-transform-move-to-layer\":\"Move to layer:\",\"select-transform-applied\":\"Transformation applied\",\"select-transform-empty\":\"Selected area on active layer is empty.\",\"save-reminder-title\":\"Unsaved Work\",\"save-reminder-text\":\"Image was not saved in {a} minutes{b}. Save now to prevent eventual loss.\",\"save-reminder-save-psd\":\"Save As PSD\",\"save-reminder-psd-layers\":\"PSD will remember all layers.\",\"backup-drawing\":\"You can backup your drawing.\",\"submit\":\"Submit\",\"submit-title\":\"Submit Drawing\",\"submit-prompt\":\"Submit drawing?\",\"submit-submitting\":\"Submitting\",\"embed-init-loading\":\"Loading app\",\"embed-init-waiting\":\"Waiting for image\",\"help\":\"Help\",\"tab-settings\":\"Settings\",\"settings-language\":\"Language\",\"settings-language-reload\":\"Will update after reloading.\",\"settings-theme\":\"Theme\",\"settings-save-reminder-label\":\"Save Reminder\",\"settings-save-reminder-disabled\":\"disabled\",\"settings-save-reminder-confirm-title\":\"Turn off Save Reminder?\",\"settings-save-reminder-confirm-a\":\"There is no autosave and browser tabs don't last forever. If you don't periodically save you will likely lose work.\",\"settings-save-reminder-confirm-b\":\"Disable at your own risk?\",\"settings-save-reminder-confirm-disable\":\"Disable\",\"theme-dark\":\"Dark\",\"theme-light\":\"Light\",\"terms-of-service\":\"Terms of Service\",\"licenses\":\"Licenses\",\"source-code\":\"Source Code\",\"auto\":\"auto\",\"zoom-in\":\"Zoom In\",\"zoom-out\":\"Zoom Out\",\"radius\":\"Radius\",\"constrain-proportions\":\"Constrain Proportions\",\"width\":\"Width\",\"height\":\"Height\",\"opacity\":\"Opacity\",\"scatter\":\"Scatter\",\"red\":\"Red\",\"green\":\"Green\",\"blue\":\"Blue\",\"eraser\":\"Eraser\",\"center\":\"Center\",\"layers\":\"Layers\",\"background\":\"Background\",\"scaling-algorithm\":\"Scaling Algorithm\",\"algorithm-smooth\":\"Smooth\",\"algorithm-pixelated\":\"Pixelated\",\"preview\":\"Preview\",\"angle-snap\":\"Snap\",\"angle-snap-title\":\"45 Angle Snapping\",\"lock-alpha\":\"Lock Alpha\",\"lock-alpha-title\":\"Locks layer's alpha channel\",\"reverse\":\"Reverse\",\"compare-before\":\"Before\",\"compare-after\":\"After\",\"loading\":\"Loading\",\"more\":\"More\",\"x-minutes\":\"{x}min\",\"wip\":\"Work in progress\",\"browser-zoom-help\":\"Double-tap or pinch-out to reset browser zoom.\",\"dismiss\":\"Dismiss\"}","module.exports = (__parcel__import__(\"./\" + \"de.c4354d88.js\")).then(() => parcelRequire('eG4RV'));","module.exports = (__parcel__import__(\"./\" + \"es.c803f839.js\")).then(() => parcelRequire('KK4Io'));","module.exports = (__parcel__import__(\"./\" + \"fi.377694cc.js\")).then(() => parcelRequire('9cTLq'));","module.exports = (__parcel__import__(\"./\" + \"fr.9e239a10.js\")).then(() => parcelRequire('88TCU'));","module.exports = (__parcel__import__(\"./\" + \"hu.6ab39b53.js\")).then(() => parcelRequire('dpvNl'));","module.exports = (__parcel__import__(\"./\" + \"id.b62850c5.js\")).then(() => parcelRequire('kjQyW'));","module.exports = (__parcel__import__(\"./\" + \"ja.a58ebabd.js\")).then(() => parcelRequire('bsob2'));","module.exports = (__parcel__import__(\"./\" + \"jv.1bf872f3.js\")).then(() => parcelRequire('8pbYd'));","module.exports = (__parcel__import__(\"./\" + \"ko.08bd2b9e.js\")).then(() => parcelRequire('dpdrV'));","module.exports = (__parcel__import__(\"./\" + \"lv.e257a609.js\")).then(() => parcelRequire('k2wtJ'));","module.exports = (__parcel__import__(\"./\" + \"nl.f9f11996.js\")).then(() => parcelRequire('cYOZ3'));","module.exports = (__parcel__import__(\"./\" + \"pt-BR.7b5f66cd.js\")).then(() => parcelRequire('7yyvT'));","module.exports = (__parcel__import__(\"./\" + \"ru.7a39819d.js\")).then(() => parcelRequire('9eB8i'));","module.exports = (__parcel__import__(\"./\" + \"su.374d6d8b.js\")).then(() => parcelRequire('fqM0J'));","module.exports = (__parcel__import__(\"./\" + \"sv.9319fcd1.js\")).then(() => parcelRequire('gk47B'));","module.exports = (__parcel__import__(\"./\" + \"zh-CN.00e00499.js\")).then(() => parcelRequire('78jb2'));","module.exports = (__parcel__import__(\"./\" + \"zh-TW.11f2bb48.js\")).then(() => parcelRequire('ih0DG'));","window.onscroll = (e) => {\n    e.preventDefault();\n};\n","module.exports = parcelRequire.resolve(\"cancel.b4ce6a28.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"check.46a6ec75.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"remove-layer.fe38f9b0.svg\") + \"?\" + Date.now();","import { KeyListener } from '../../../../bb/input/key-listener';\nimport { DIALOG_COUNTER } from '../modal-count';\nimport { BB } from '../../../../bb/bb';\nimport { LANG } from '../../../../language/language';\nimport './scroll-fix';\nimport cancelImg from 'url:/src/app/img/ui/cancel.svg';\nimport { css } from '../../../../bb/base/base';\n\n/**\n * popup that fill whole height, with some padding.\n * currently only used for iframe popups.\n */\nexport class DynamicModal {\n    private readonly parent: HTMLElement;\n    private readonly rootEl: HTMLElement;\n    private readonly updatePos: () => void;\n    private readonly keyListener: KeyListener;\n    private readonly xButton: HTMLElement;\n    private readonly bgEl: HTMLElement;\n    private readonly onClose: ((result?: string) => void) | undefined;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        title?: HTMLElement;\n        content?: HTMLElement;\n        buttonArr?: string[];\n        autoFocus?: string | false; // todo - not implemented\n        clickOnEnter?: string; // button name - todo not implemented\n        onClose?: (result?: string) => void;\n\n        //size and position\n        width: number;\n        isMaxHeight: boolean; // todo - not implemented\n    }) {\n        DIALOG_COUNTER.increase();\n        this.onClose = p.onClose;\n        this.parent = document.body;\n        this.rootEl = BB.el({\n            parent: this.parent,\n            className: 'g-root kl-d-modal-root',\n            css: {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0',\n                overflow: 'auto',\n                animationName: 'consoleIn',\n                animationDuration: '0.3s',\n                animationTimingFunction: 'ease-out',\n            },\n            onClick: BB.handleClick,\n        });\n\n        //background element registering clicks\n        this.bgEl = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0',\n            },\n            onClick: () => this.close(),\n        });\n\n        //the actual popup box\n        const popupEl = BB.el({\n            parent: this.rootEl,\n            className: 'kl-d-modal',\n            css: {\n                position: 'absolute',\n                width: BB.isCssMinMaxSupported()\n                    ? 'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)'\n                    : (p.width ? p.width : 400) + 'px',\n                height: 'calc(100% - 40px)',\n                borderRadius: '10px',\n                overflow: 'hidden',\n            },\n        });\n\n        //x and y position via script. flex not powerful enough imo\n        this.updatePos = () => {\n            const elW = popupEl.offsetWidth;\n            const elH = popupEl.offsetHeight;\n\n            css(popupEl, {\n                left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\n                top: Math.max(20, (window.innerHeight - elH) / 2 - elH * 0.2) + 'px',\n            });\n        };\n\n        this.updatePos();\n        window.addEventListener('resize', this.updatePos);\n\n        //title row in popup\n        const titleHeight = 40;\n        const titleEl = BB.el({\n            parent: popupEl,\n            css: {\n                height: titleHeight + 'px',\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                paddingLeft: titleHeight / 2 + 'px',\n            },\n        });\n        if (p.title) {\n            titleEl.append(p.title);\n        }\n        this.xButton = BB.el({\n            parent: titleEl,\n            tagName: 'button',\n            className: 'popup-x',\n            content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\n            title: LANG('modal-close'),\n            onClick: () => this.close(),\n            css: {\n                width: titleHeight + 'px',\n                height: titleHeight + 'px',\n                lineHeight: titleHeight + 'px',\n                background: 'none',\n                boxShadow: 'none',\n            },\n            custom: {\n                tabindex: '0',\n            },\n        });\n\n        const contentEl = BB.el({\n            parent: popupEl,\n            css: {\n                height: 'calc(100% - ' + titleHeight + 'px)',\n            },\n        });\n        if (p.content) {\n            contentEl.append(p.content);\n        }\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr, e) => {\n                if (keyStr === 'esc') {\n                    e.stopPropagation();\n                    e.preventDefault(); // stay in fullscreen on Mac\n                    this.close();\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n    close(): void {\n        DIALOG_COUNTER.decrease();\n        BB.destroyEl(this.rootEl);\n        this.rootEl.remove();\n        window.removeEventListener('resize', this.updatePos);\n        this.keyListener.destroy();\n        BB.destroyEl(this.xButton);\n        BB.destroyEl(this.bgEl);\n        this.onClose && this.onClose();\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { css } from '../../../bb/base/base';\n\n/**\n * Checkbox - with label\n */\nexport class Checkbox {\n    private readonly rootEl: HTMLElement;\n    private check: HTMLInputElement;\n    private readonly doHighlight: boolean;\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: {\n        init?: boolean; // default false\n        label: string;\n        callback?: (b: boolean) => void;\n        allowTab?: boolean; // default false\n        title?: string;\n        doHighlight?: boolean; // default false\n        css?: Partial<CSSStyleDeclaration>;\n        name: string;\n    }) {\n        this.doHighlight = !!p.doHighlight;\n\n        this.rootEl = BB.el({\n            className: 'kl-checkbox',\n        });\n\n        const innerEl = BB.el({\n            parent: this.rootEl,\n            tagName: 'label',\n            className: 'kl-checkbox__inner',\n            css: {\n                display: 'flex',\n            },\n        });\n\n        this.check = BB.el({\n            parent: innerEl,\n            tagName: 'input',\n            css: {\n                margin: '0 5px 0 0',\n            },\n            custom: {\n                type: 'checkbox',\n                name: p.name,\n            },\n        });\n\n        this.check.checked = !!p.init;\n        if (this.doHighlight && this.check.checked) {\n            this.rootEl.classList.add('kl-checkbox--highlight');\n        }\n        if (!p.allowTab) {\n            this.check.tabIndex = -1;\n        }\n\n        if (p.title) {\n            innerEl.title = p.title;\n        }\n\n        const label = BB.el({\n            parent: innerEl,\n            content: p.label,\n            css: {},\n        });\n\n        this.check.onchange = () => {\n            if (this.doHighlight) {\n                this.rootEl.classList.toggle('kl-checkbox--highlight', this.check.checked);\n            }\n            p.callback && p.callback(this.check.checked);\n            setTimeout(() => {\n                this.check.blur();\n            }, 0);\n        };\n        if (p.css) {\n            css(this.rootEl, p.css);\n        }\n    }\n\n    getValue(): boolean {\n        return this.check.checked;\n    }\n\n    setValue(b: boolean): void {\n        this.check.checked = b;\n        if (this.doHighlight) {\n            this.rootEl.classList.toggle('kl-checkbox--highlight', this.check.checked);\n        }\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy(): void {\n        this.check.onchange = null;\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { TKeyString } from '../../../bb/bb-types';\nimport { KeyListener } from '../../../bb/input/key-listener';\nimport { css } from '../../../bb/base/base';\n\ntype TInputType = 'button' | 'checkbox' | 'number' | 'text' | 'color';\n\nexport type TInputParams = {\n    type?: TInputType; // default: text\n    init: string | number;\n    title?: string;\n    label?: string | HTMLElement;\n    name: string;\n\n    // for type: number\n    min?: number;\n    max?: number;\n    step?: number;\n\n    onChange?: (v: string) => void;\n\n    doScrollWithoutFocus?: boolean; // default: false\n    doResetIfInvalid?: boolean; // default: false\n\n    css?: TKeyString;\n};\n\nexport class Input {\n    private readonly rootEl: HTMLLabelElement;\n    private readonly input: HTMLInputElement;\n    private readonly type: TInputType;\n    private readonly pointerListener;\n    private readonly keyListener: KeyListener = {\n        destroy: () => {},\n    } as KeyListener;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TInputParams) {\n        this.rootEl = BB.el({\n            tagName: 'label',\n            content: p.label,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: '5px',\n            },\n        });\n\n        this.input = BB.el({\n            tagName: 'input',\n            parent: this.rootEl,\n            title: p.title,\n            custom: {\n                name: p.name,\n            },\n        });\n\n        this.type = p.type ?? 'text';\n        try {\n            this.input.type = this.type;\n        } catch (e) {\n            // ie can't deal with number\n        }\n\n        const stepSize = p.step ?? 1;\n\n        if (this.type === 'number') {\n            if (p.min !== undefined) {\n                this.input.min = '' + p.min;\n            }\n            if (p.max !== undefined) {\n                this.input.max = '' + p.max;\n            }\n            if (p.step !== undefined) {\n                this.input.step = '' + stepSize;\n            }\n        }\n\n        this.input.value = '' + p.init;\n\n        let lastValidValue = this.input.value;\n\n        /**\n         * return true if not changed\n         */\n        const handleChange = (): boolean => {\n            const oldVal = lastValidValue;\n            let newValue = this.input.value;\n            if (p.doResetIfInvalid) {\n                let didChange = false;\n                if (newValue === '') {\n                    newValue = lastValidValue;\n                    didChange = true;\n                }\n                if (p.min !== undefined && parseFloat(newValue) < p.min) {\n                    newValue = '' + p.min;\n                    didChange = true;\n                }\n                if (p.max !== undefined && parseFloat(newValue) > p.max) {\n                    newValue = '' + p.max;\n                    didChange = true;\n                }\n                if (didChange) {\n                    this.input.value = '' + newValue;\n                }\n            }\n\n            lastValidValue = newValue;\n\n            return oldVal !== newValue;\n        };\n\n        if (p.onChange) {\n            const onChange = p.onChange;\n            this.input.onchange = () => {\n                handleChange() && onChange(this.input.value);\n            };\n        }\n        if (p.css) {\n            css(this.input, p.css);\n        }\n\n        if (p.doScrollWithoutFocus && p.type === 'number' && p.onChange) {\n            const onChange = p.onChange;\n            this.keyListener = new BB.KeyListener({});\n            this.pointerListener = new BB.PointerListener({\n                target: this.input,\n                onWheel: (e) => {\n                    /*if (document.hasFocus()) { // what was the point of this?\n                        return;\n                    }*/\n                    const fac = this.keyListener.isPressed('shift') ? 4 : 1;\n                    this.input.value =\n                        '' + (parseFloat(this.input.value) - e.deltaY * stepSize * fac);\n                    handleChange() && onChange(this.input.value);\n                },\n            });\n        }\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue(): string {\n        return this.input.value;\n    }\n\n    setValue(v: string | number): void {\n        this.input.value = '' + v;\n    }\n\n    destroy(): void {\n        this.pointerListener && this.pointerListener.destroy();\n        this.keyListener.destroy();\n    }\n}\n\n// todo replace instances with class\nexport const input = function (params: {\n    type?: TInputType; // default text\n    min?: number;\n    max?: number;\n    callback: (val: string) => void;\n    init: string | number;\n    css?: TKeyString;\n}) {\n    const result = document.createElement('input');\n    if (params.type) {\n        try {\n            result.type = params.type;\n        } catch (e) {\n            /* empty */\n            // ie can't deal with number\n        }\n    } else {\n        result.type = 'text';\n    }\n    if (params.min !== undefined) {\n        result.min = '' + params.min;\n    }\n    if (params.max !== undefined) {\n        result.max = '' + params.max;\n    }\n    result.value = '' + params.init;\n    if (params.callback) {\n        result.onchange = function () {\n            params.callback(result.value);\n        };\n    }\n    if (params.css) {\n        css(result, params.css);\n    }\n\n    return result;\n};\n","import { BB } from '../../../bb/bb';\nimport { TKeyString } from '../../../bb/bb-types';\nimport { css } from '../../../bb/base/base';\n\ntype TSelectItem<ValueType> =\n    | [ValueType, string]\n    | [ValueType, string, { css: Partial<CSSStyleDeclaration> }]; // [value, label, properties]\n\n/**\n * A select dropdown\n */\nexport class Select<ValueType extends string> {\n    private readonly selectEl: HTMLSelectElement;\n    private optionArr: {\n        item: TSelectItem<ValueType> | undefined;\n        el?: HTMLOptionElement;\n    }[] = [];\n    private readonly changeListener: () => void;\n    private readonly onChange: ((val: ValueType) => void) | undefined;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        isFocusable?: boolean; // default false\n        optionArr: (TSelectItem<ValueType> | undefined)[];\n        initValue?: ValueType; // default ''\n        onChange?: (val: ValueType) => void;\n        css?: TKeyString;\n        title?: string;\n        name: string;\n    }) {\n        this.selectEl = BB.el({\n            tagName: 'select',\n            title: p.title,\n            className: 'kl-select',\n            css: {\n                cursor: 'pointer',\n                fontSize: '15px',\n                padding: '3px',\n            },\n            custom: {\n                name: p.name,\n            },\n        });\n        if (p.css) {\n            css(this.selectEl, p.css);\n        }\n\n        const isFocusable = p.isFocusable;\n        if (!isFocusable) {\n            this.selectEl.tabIndex = -1;\n        }\n        this.setOptionArr(p.optionArr);\n        if (p.onChange) {\n            this.onChange = p.onChange;\n        }\n        this.changeListener = () => {\n            if (!isFocusable) {\n                this.selectEl.blur();\n            }\n            this.onChange && this.onChange(this.getValue());\n        };\n        this.selectEl.addEventListener('change', this.changeListener);\n        this.selectEl.value = p.initValue !== undefined ? p.initValue : '';\n    }\n\n    setValue(val: ValueType | undefined): void {\n        this.selectEl.value = val === undefined ? '' : val;\n    }\n\n    getValue(): ValueType {\n        return this.selectEl.value as ValueType;\n    }\n\n    setDeltaValue(delta: number): void {\n        let index = 0;\n        for (let i = 0; i < this.optionArr.length; i++) {\n            const option = this.optionArr[i];\n            if (option.item && '' + option.item[0] === this.selectEl.value) {\n                index = i;\n                break;\n            }\n        }\n        index = Math.max(0, Math.min(this.optionArr.length - 1, index + delta));\n        const option = this.optionArr[index];\n        this.selectEl.value = option.item ? option.item[0] : '';\n        this.onChange && this.onChange(this.getValue());\n    }\n\n    getElement(): HTMLElement {\n        return this.selectEl;\n    }\n\n    updateLabel(id: ValueType, label: string): void {\n        this.optionArr.forEach((option) => {\n            if (option.item && option.item[0] === id && option.el) {\n                option.item[1] = label;\n                option.el.textContent = option.item[1];\n            }\n        });\n    }\n\n    setOptionArr(optionArr: (TSelectItem<ValueType> | undefined)[]): void {\n        const oldVal = this.selectEl.value as ValueType;\n\n        this.optionArr = [];\n        this.selectEl.innerHTML = '';\n        for (let i = 0; i < optionArr.length; i++) {\n            const item = optionArr[i];\n            if (!item) {\n                this.optionArr.push({\n                    item,\n                });\n                continue;\n            }\n            const el = document.createElement('option');\n            el.value = item[0];\n            el.textContent = item[1];\n            if (item[2]) {\n                css(el, item[2].css);\n            }\n            this.optionArr.push({\n                item,\n                el,\n            });\n            this.selectEl.append(el);\n        }\n\n        // restore old value\n        if (oldVal === '' || optionArr.findIndex((item) => item && item[0] === oldVal) > -1) {\n            this.setValue(oldVal);\n        }\n    }\n\n    destroy(): void {\n        this.selectEl.removeEventListener('change', this.changeListener);\n    }\n}\n","import { BB } from '../../../bb/bb';\n\n/**\n * Toggle button with an image\n */\nexport class ImageToggle {\n    private readonly rootEl: HTMLElement;\n    private isActive: boolean;\n\n    private update(): void {\n        this.rootEl.classList.toggle('image-toggle-active', this.isActive);\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        initValue: boolean;\n        title: string;\n        isRadio?: boolean; // if true, can't click when active\n        onChange: (b: boolean) => void;\n        image: string;\n        darkInvert?: boolean;\n    }) {\n        this.isActive = p.initValue;\n        this.rootEl = BB.el({\n            className: 'image-toggle',\n            title: p.title,\n            content: BB.el({\n                className: 'image-toggle__im' + (p.darkInvert ? ' dark-invert' : ''),\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                },\n            }),\n            onClick: (e) => {\n                e.preventDefault();\n                if (p.isRadio && this.isActive) {\n                    return;\n                }\n                this.isActive = !this.isActive;\n                this.update();\n                p.onChange(this.isActive);\n            },\n        });\n\n        this.update();\n    }\n\n    // --- interface ---\n    setValue(b: boolean): void {\n        this.isActive = b;\n        this.update();\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue(): boolean {\n        return this.isActive;\n    }\n\n    destroy(): void {\n        BB.destroyEl(this.rootEl);\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { ImageToggle } from './image-toggle';\n\ntype TOptionItem<IdType> = {\n    id: IdType;\n    title: string;\n    image: string;\n    darkInvert?: boolean;\n};\n\n/**\n * Radio input group. each one has an image\n */\nexport class ImageRadioList<IdType> {\n    private readonly rootEl: HTMLElement;\n    private activeIndex: number;\n    private readonly optionArr: {\n        id: IdType;\n        radioEl: ImageToggle;\n    }[];\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        optionArr: TOptionItem<IdType>[];\n        initId: string;\n        onChange: (id: IdType) => void;\n    }) {\n        this.rootEl = BB.el({\n            className: 'image-radio-wrapper',\n            css: {\n                display: 'flex',\n            },\n        });\n\n        this.optionArr = [];\n\n        const select = (index: number, id: IdType): void => {\n            this.activeIndex = index;\n            for (let i = 0; i < this.optionArr.length; i++) {\n                this.optionArr[i].radioEl.setValue(i === this.activeIndex);\n            }\n            p.onChange(id);\n        };\n\n        let initialIndex;\n        const createOption = (\n            index: number,\n            o: TOptionItem<IdType>,\n        ): {\n            id: IdType;\n            radioEl: ImageToggle;\n        } => {\n            if (o.id === p.initId) {\n                initialIndex = index;\n            }\n            const radioEl = new ImageToggle({\n                image: o.image,\n                title: o.title,\n                initValue: o.id === p.initId,\n                isRadio: true,\n                onChange: () => {\n                    select(index, o.id);\n                },\n                darkInvert: o.darkInvert,\n            });\n            this.rootEl.append(radioEl.getElement());\n\n            return {\n                id: o.id,\n                radioEl,\n            };\n        };\n\n        for (let i = 0; i < p.optionArr.length; i++) {\n            this.optionArr.push(createOption(i, p.optionArr[i]));\n        }\n\n        if (initialIndex === undefined) {\n            throw new Error('initId not in optionArr');\n        }\n        this.activeIndex = initialIndex;\n    }\n\n    // --- interface ---\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue(): IdType {\n        return this.optionArr[this.activeIndex].id;\n    }\n\n    destroy(): void {\n        this.optionArr.forEach((item) => {\n            item.radioEl.destroy();\n        });\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { LANG } from '../../../language/language';\nimport iconImg from 'url:/src/app/img/ui/brush-pressure.svg';\nimport { BoxToggle } from './box-toggle';\n\n/**\n * small toggle button with a pen icon - representing toggling pressure sensitivity\n * @param isChecked initial value\n * @param changeCallback called on change\n */\nexport const createPenPressureToggle = function (\n    isChecked: boolean,\n    changeCallback: (b: boolean) => void,\n): HTMLElement {\n    const toggleEl = new BoxToggle({\n        label: BB.el({\n            className: 'dark-invert',\n            css: {\n                width: '17px',\n                height: '17px',\n                backgroundImage: 'url(\"' + iconImg + '\")',\n                backgroundSize: 'contain',\n                backgroundRepeat: 'no-repeat',\n                margin: '1px',\n                borderRadius: '3px',\n            },\n        }),\n        title: LANG('brush-toggle-pressure'),\n        init: isChecked,\n        onChange: (b) => {\n            changeCallback(b);\n        },\n    });\n\n    return toggleEl.getElement();\n};\n","module.exports = parcelRequire.resolve(\"brush-pressure.0966db85.svg\") + \"?\" + Date.now();","import { BB } from '../../../bb/bb';\nimport { css } from '../../../bb/base/base';\n\nexport class BoxToggle {\n    el: HTMLElement;\n    value: boolean;\n\n    update(): void {\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        label: string | HTMLElement | SVGElement;\n        title?: string;\n        init?: boolean;\n        onChange: (b: boolean) => void;\n    }) {\n        this.value = !!p.init;\n        this.el = BB.el({\n            content: p.label,\n            title: p.title,\n            className:\n                typeof p.label === 'string'\n                    ? 'kl-box-toggle'\n                    : 'kl-box-toggle kl-box-toggle--custom-el',\n            onClick: () => {\n                this.value = !this.value;\n                this.update();\n                p.onChange(this.value);\n            },\n            css: {\n                cursor: 'pointer',\n            },\n        });\n        if (typeof p.label !== 'string') {\n            css(p.label, {\n                display: 'block',\n                pointerEvents: 'none',\n            });\n        }\n        this.update();\n    }\n\n    getValue(): boolean {\n        return this.value;\n    }\n\n    setValue(b: boolean): void {\n        this.value = b;\n        this.update();\n    }\n\n    getElement(): HTMLElement {\n        return this.el;\n    }\n\n    destroy(): void {\n        BB.destroyEl(this.el);\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { calcSliderFalloffFactor } from './slider-falloff';\nimport { TKlSliderConfig } from '../../kl-types';\nimport { LANGUAGE_STRINGS } from '../../../language/language';\nimport { KlSliderManualInput } from './kl-slider-manual-input';\nimport { SplineInterpolator } from '../../../bb/math/line';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { TPointerEvent } from '../../../bb/input/event.types';\nimport { TChainElement } from '../../../bb/input/event-chain/event-chain.types';\nimport { css } from '../../../bb/base/base';\n\n/**\n * Horizontal slider, can be changed by dragging anywhere on it. Has a label & value.\n * e.g. used for brush size\n *\n * left mouse button - set absolute value\n * right mouse button - change relative value\n * drag mouse vertically away - precision mode\n * double-click/tap slider - manual input mode\n *\n * Values can be spline interpolated\n * On change callback can be debounced\n *\n */\nexport class KlSlider {\n    /*\n    Three types of values\n    - value - the actual value, when using setValue(), getValue(), and what is emitted\n    - displayValue - the number that the user sees on the slider and in the manual input field\n        - might be further formatted with formatFunc\n        - also might be the same as value, if no toDisplayValue function provided\n    - sliderValue - the draggable position of the slider, 0 - 1\n     */\n\n    private value: number;\n\n    private readonly elementWidth: number;\n    private readonly elementHeight: number;\n    private isEnabled: boolean;\n\n    private min: number; // min value\n    private max: number; // max value\n    private useSpline: boolean;\n    private splineInterpolator: undefined | SplineInterpolator;\n    private readonly resolution: number;\n\n    private readonly isChangeOnFinal: boolean;\n    private readonly formatFunc: undefined | ((val: number) => number | string);\n    private readonly unit: string | undefined;\n\n    private readonly onChange: (val: number) => void;\n    private readonly valueToDisplayValue: (value: number) => number;\n    private readonly displayValueToValue: (displayValue: number) => number;\n\n    private readonly rootEl: HTMLElement;\n    private readonly sliderWrapperEl: HTMLElement;\n    private readonly textEl: HTMLElement; // displays label, displayValue\n    private readonly labelValueEl: HTMLElement;\n    private readonly label: string;\n    private readonly control: HTMLElement;\n    private manualInput: undefined | KlSliderManualInput;\n    private readonly manualInputRoundDigits: number | undefined;\n\n    private pointerListener: PointerListener | undefined;\n    private readonly pointerListenerTimeout: ReturnType<typeof setTimeout>;\n\n    private readonly eventResMs: undefined | number;\n    private emitValue: undefined | number; // next value for interval\n    private emitInterval: ReturnType<typeof setTimeout> | undefined; // interval of eventResMs which calls onChange()\n\n    private valueToSliderValue(value: number): number {\n        if (this.useSpline && this.splineInterpolator) {\n            return this.splineInterpolator.findX(value, Math.floor(this.resolution)) || 0;\n        }\n        return (value - this.min) / (this.max - this.min);\n    }\n\n    private sliderValueToValue(sliderValue: number): number {\n        let result = this.min + sliderValue * (this.max - this.min);\n        if (this.useSpline && this.splineInterpolator) {\n            result = this.splineInterpolator.interpolate(sliderValue) || 0;\n        }\n        return result;\n    }\n\n    private updateLabel(): void {\n        let displayValue: number | string = this.valueToDisplayValue(this.value);\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\n        displayValue = displayValue.toLocaleString(LANGUAGE_STRINGS.getCode());\n        const unit = this.unit !== undefined ? this.unit : '';\n        this.labelValueEl.textContent = displayValue + unit;\n\n        const sliderValue = this.valueToSliderValue(this.value);\n        this.control.style.width = sliderValue * this.elementWidth + 'px';\n    }\n\n    private emit(isFinal: boolean): void {\n        if (!isFinal && this.isChangeOnFinal) {\n            return;\n        }\n\n        if (isFinal || !this.eventResMs) {\n            this.onChange(this.value);\n            if (this.emitInterval) {\n                clearInterval(this.emitInterval);\n                this.emitInterval = undefined;\n            }\n            return;\n        }\n\n        if (this.emitInterval) {\n            this.emitValue = this.value;\n        } else {\n            this.onChange(this.value);\n\n            this.emitInterval = setInterval(() => {\n                if (this.emitValue === undefined) {\n                    clearInterval(this.emitInterval);\n                    this.emitInterval = undefined;\n                } else {\n                    this.onChange(this.emitValue);\n                    this.emitValue = undefined;\n                }\n            }, this.eventResMs);\n        }\n    }\n\n    private updateEnable(): void {\n        this.sliderWrapperEl.classList.toggle('slider-wrapper--disabled', !this.isEnabled);\n        css(this.sliderWrapperEl, {\n            opacity: this.isEnabled ? '' : '0.5',\n            pointerEvents: this.isEnabled ? '' : 'none',\n        });\n        if (this.manualInput) {\n            this.manualInput.setIsEnabled(this.isEnabled);\n        }\n    }\n\n    private showManualInput(): void {\n        this.manualInput = new KlSliderManualInput(\n            this.valueToDisplayValue(this.value),\n            this.valueToDisplayValue(this.min),\n            this.valueToDisplayValue(this.max),\n            this.sliderWrapperEl.getBoundingClientRect(),\n            (val) => {\n                val = this.displayValueToValue(val);\n                this.setValue(BB.clamp(val, this.min, this.max));\n                this.onChange(this.value);\n            },\n            () => {\n                css(this.sliderWrapperEl, {\n                    display: '',\n                });\n                if (this.manualInput) {\n                    this.manualInput.getElement().remove();\n                    this.manualInput.destroy();\n                }\n                this.manualInput = undefined;\n            },\n            this.manualInputRoundDigits && this.manualInputRoundDigits > 0\n                ? this.manualInputRoundDigits\n                : 0,\n        );\n        this.manualInput.setIsEnabled(this.isEnabled);\n        this.rootEl.append(this.manualInput.getElement());\n        setTimeout(() => {\n            this.manualInput && this.manualInput.focus();\n        });\n        css(this.sliderWrapperEl, {\n            display: 'none',\n        });\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: {\n        label: string;\n        width: number; // px\n        height: number; // px\n        min: number; // min value\n        max: number;\n        value: number;\n        resolution?: number; // int, if you want spline.findX() to use a custom resolution\n        curve?: 'quadratic' | [number, number][]; // optional. array is BB.SplineInterpolator points. 0-1\n        formatFunc?: (val: number) => number | string; // function to display a different number than value\n        onChange?: (val: number) => void;\n        isChangeOnFinal?: boolean; // only fire onChange on pointerUp\n        eventResMs?: number; // frequency of change events\n        isEnabled?: boolean; // default = true\n        manualInputRoundDigits?: number; // default 0, how value should be rounded for manual input\n        toDisplayValue?: (value: number) => number;\n        toValue?: (displayValue: number) => number;\n        unit?: string; // attached to end of value in output\n    }) {\n        this.isEnabled = p.isEnabled !== false;\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\n        this.useSpline = !!p.curve;\n\n        if (!p.label) {\n            throw new Error('KlSlider missing params');\n        }\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\n            if (!p.min || !p.max || !p.value) {\n                throw new Error('KlSlider broken params');\n            }\n        }\n        if (p.min >= p.max) {\n            throw new Error('KlSlider broken params');\n        }\n\n        this.min = p.min;\n        this.max = p.max;\n        this.value = BB.clamp(p.value, this.min, this.max);\n        this.elementWidth = p.width;\n        this.elementHeight = p.height;\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\n\n        this.onChange = p.onChange ? p.onChange : () => {};\n        if (!p.toValue !== !p.toDisplayValue) {\n            throw new Error('both or neither have to be set, toValue and toDisplayValue');\n        }\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue) => displayValue;\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value) => value;\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\n        this.formatFunc = p.formatFunc;\n        this.eventResMs = p.eventResMs;\n        this.unit = p.unit;\n\n        if (this.useSpline) {\n            if (!p.curve) {\n                throw new Error('curve needs to be set if useSpline true');\n            }\n            const curveArr: [number, number][] =\n                p.curve === 'quadratic' ? BB.powerSplineInput(this.min, this.max, 0.1) : p.curve;\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\n        }\n\n        this.rootEl = BB.el({\n            css: {\n                display: 'flex',\n            },\n        });\n        this.sliderWrapperEl = BB.el({\n            parent: this.rootEl,\n            className: 'slider-wrapper',\n            css: {\n                overflow: 'hidden',\n                position: 'relative',\n                width: this.elementWidth + 'px',\n                height: this.elementHeight + 'px',\n                userSelect: 'none',\n            },\n        });\n        this.rootEl.oncontextmenu = function () {\n            return false;\n        };\n        this.label = p.label;\n        const labelFontSize = this.elementHeight - 14;\n        this.labelValueEl = BB.el({\n            css: { fontWeight: 'bold' },\n        });\n        this.textEl = BB.el({\n            content: [\n                BB.el({\n                    content: this.label,\n                    css: {\n                        overflow: 'hidden',\n                        textOverflow: 'ellipsis',\n                    },\n                }),\n                this.labelValueEl,\n            ],\n            css: {\n                position: 'absolute',\n                display: 'flex',\n                alignItems: 'center',\n                padding: '0 7px',\n                height: '100%',\n                width: '100%',\n                fontSize: labelFontSize + 'px',\n                pointerEvents: 'none',\n                gap: '8px',\n            },\n        });\n        this.control = BB.el({\n            className: 'slider-inner',\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                width: this.valueToSliderValue(this.value) * this.elementWidth + 'px',\n                height: this.elementHeight + 'px',\n            },\n        });\n        const controlInner = document.createElement('div');\n\n        this.sliderWrapperEl.append(this.control, this.textEl);\n        this.control.append(controlInner);\n\n        this.updateEnable();\n\n        const doubleTapper = new BB.DoubleTapper({\n            onDoubleTap: () => {\n                this.showManualInput();\n            },\n        });\n        doubleTapper.setAllowedButtonArr(['left', 'right']);\n        const eventChain = new BB.EventChain({\n            chainArr: [doubleTapper as TChainElement],\n        });\n\n        let virtualVal: number;\n        const onPointer = (event: TPointerEvent) => {\n            event.eventPreventDefault();\n\n            if (!this.isEnabled) {\n                return;\n            }\n\n            if (event.type === 'pointerdown') {\n                // unfocus manual slider input\n                BB.unfocusAnyInput();\n\n                this.sliderWrapperEl.className = 'slider-wrapper slider-wrapper--active';\n\n                if (event.button === 'left') {\n                    let sliderValue = event.relX / this.elementWidth;\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\n                    this.value = this.sliderValueToValue(sliderValue);\n                    this.updateLabel();\n                    this.emit(false);\n                }\n                virtualVal = this.valueToSliderValue(this.value);\n            }\n\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\n                let deltaX = event.dX;\n                const deltaY = Math.abs(event.pageY - (event.downPageY || 0));\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n                deltaX *= factor;\n                deltaX /= this.elementWidth;\n\n                virtualVal += deltaX;\n\n                const sliderValue = Math.max(0, Math.min(1, virtualVal));\n                this.value = this.sliderValueToValue(sliderValue);\n                this.updateLabel();\n                this.emit(false);\n            }\n\n            if (event.type === 'pointerup') {\n                this.sliderWrapperEl.className = 'slider-wrapper';\n                this.emit(true);\n            }\n        };\n\n        this.pointerListenerTimeout = setTimeout(() => {\n            this.pointerListener = new BB.PointerListener({\n                target: this.sliderWrapperEl,\n                fixScribble: true,\n                onPointer: (e) => {\n                    onPointer(e);\n                    eventChain.chainIn(e);\n                },\n                onWheel: (event) => {\n                    let sliderValue = this.valueToSliderValue(this.value);\n                    sliderValue = BB.clamp(sliderValue - event.deltaY / 40, 0, 1);\n                    this.value = this.sliderValueToValue(sliderValue);\n                    this.updateLabel();\n                    this.onChange(this.value);\n                },\n            });\n            this.updateLabel();\n        }, 1);\n    }\n\n    changeSliderValue(f: number): void {\n        if (!this.isEnabled) {\n            return;\n        }\n        let sliderValue = this.valueToSliderValue(this.value);\n        sliderValue = BB.clamp(sliderValue + f, 0, 1);\n        this.value = this.sliderValueToValue(sliderValue);\n        this.updateLabel();\n        this.onChange(this.value);\n    }\n\n    setValue(v: number): void {\n        this.value = BB.clamp(v, this.min, this.max);\n        this.updateLabel();\n    }\n\n    getValue(): number {\n        return this.value;\n    }\n\n    getDisplayValue(): number {\n        return this.valueToDisplayValue(this.value);\n    }\n\n    update(config: TKlSliderConfig): void {\n        this.min = config.min;\n        this.max = config.max;\n        this.useSpline = !!config.curve;\n        if (this.useSpline) {\n            if (!config.curve) {\n                throw new Error('curve needs to be set if useSpline true');\n            }\n            const curveArr =\n                config.curve === 'quadratic'\n                    ? BB.powerSplineInput(this.min, this.max, 0.1)\n                    : config.curve;\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\n        } else {\n            this.splineInterpolator = undefined;\n        }\n        this.setIsEnabled(!config.isDisabled);\n    }\n\n    setIsEnabled(e: boolean): void {\n        this.isEnabled = e;\n        this.updateEnable();\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy(): void {\n        clearTimeout(this.pointerListenerTimeout);\n        this.pointerListener && this.pointerListener.destroy();\n        if (this.manualInput) {\n            this.manualInput.destroy();\n        }\n        if (this.emitInterval) {\n            clearInterval(this.emitInterval);\n        }\n    }\n}\n","/**\n * To make sliders more fine-grained. The falloff when moving cursor away from cursor.\n * Returns the factor [0,1]\n *  0 -> infinite movement required for change of 1\n *  1 -> 1px movement for change of 1\n *\n * @param deltaY vertical distance from pointerdown\n * @param isRightButton\n */\nexport function calcSliderFalloffFactor(deltaY: number, isRightButton: boolean): number {\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\n    if (isRightButton) {\n        result *= 2;\n    }\n    return 1 / result;\n}\n","import { BB } from '../../../bb/bb';\nimport { input } from './input';\nimport { css } from '../../../bb/base/base';\n\n/**\n * Used by KlSlider. Allows user to type in value in input (type=number) field, instead of dragging with mouse.\n * Input goes away when losing focus, or when pressing Enter/Escape.\n */\nexport class KlSliderManualInput {\n    private readonly input: HTMLInputElement;\n    private isEnabled: boolean = true;\n    private scrollBefore: { x: number; y: number } | undefined; // window scroll position on creation\n    private lastValue: number; // last emitted value\n    private isClosed: boolean = false;\n\n    private emit(): void {\n        if (this.lastValue !== Number(this.input.value)) {\n            this.onChange(Number(this.input.value));\n            this.lastValue = Number(this.input.value);\n        }\n    }\n\n    private privateOnClose(): void {\n        if (this.isClosed) {\n            return;\n        }\n        this.isClosed = true;\n\n        this.emit();\n        this.onClose();\n        setTimeout(() => {\n            // because iPad keyboard changes the scroll position\n            this.scrollBefore && window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\n            this.scrollBefore = undefined;\n        });\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(\n        value: number, // initial value (displayValue)\n        min: number,\n        max: number,\n        rect: DOMRect, // size of input field\n        private onChange: (displayValue: number) => void,\n        private onClose: () => void,\n        roundDigits?: number,\n    ) {\n        this.input = input({\n            type: 'number',\n            init: value,\n            min,\n            max,\n            callback: (val) => {\n                this.emit();\n            },\n        });\n        if (roundDigits !== 0) {\n            this.input.setAttribute('step', 'any');\n        }\n        this.input.onblur = () => {\n            this.privateOnClose();\n        };\n        this.input.addEventListener(\n            'keyup',\n            (e) => {\n                if (['Enter', 'Escape'].includes(e.key)) {\n                    this.privateOnClose();\n                } else {\n                    this.emit();\n                }\n            },\n            { passive: false },\n        );\n        this.input.addEventListener('wheel', () => this.emit(), { passive: false });\n\n        this.scrollBefore = {\n            x: window.scrollX,\n            y: window.scrollY,\n        };\n\n        let currentValue;\n        if (roundDigits || roundDigits === 0) {\n            currentValue = BB.round(value, roundDigits);\n        } else {\n            currentValue = value;\n        }\n        this.lastValue = currentValue;\n        this.input.value = '' + currentValue;\n\n        css(this.input, {\n            width: rect.width + 'px',\n            height: rect.height + 'px',\n        });\n    }\n\n    getElement() {\n        return this.input;\n    }\n\n    setIsEnabled(b: boolean): void {\n        this.isEnabled = b;\n    }\n\n    focus(): void {\n        this.input.focus();\n        this.input.select();\n    }\n\n    destroy(): void {\n        BB.destroyEl(this.input);\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { input } from '../components/input';\nimport { showModal } from './base/showModal';\nimport { LANG } from '../../../language/language';\nimport copyImg from 'url:/src/app/img/ui/copy.svg';\nimport { TRgb } from '../../kl-types';\nimport { RGB } from '../../../bb/color/color';\nimport { c } from '../../../bb/base/c';\nimport * as classes from './color-slider-hex-dialog.module.scss';\n\ntype TInputRow = {\n    update: () => void;\n    destroy: () => void;\n    element: HTMLElement;\n};\n\n/**\n * dialog for manually inputting the color\n */\nexport class HexColorDialog {\n    // ----------------------------------- public -----------------------------------\n    constructor(p: { color: TRgb; onClose: (rgb: TRgb | undefined) => void }) {\n        let lastValidRgb: RGB = new BB.RGB(p.color.r, p.color.g, p.color.b);\n\n        const previewEl = BB.el({\n            css: {\n                width: '20px',\n                height: '20px',\n                marginBottom: '10px',\n                boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\n                background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\n            },\n        });\n\n        // --- Hex ---\n\n        const hexLabel = BB.el({\n            content: LANG('mci-hex'),\n        });\n        const hexInput = input({\n            init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\n            css: {\n                width: '80px',\n            },\n            callback: function () {\n                let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\n                if (!rgbObj) {\n                    rgbObj = lastValidRgb;\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n                } else {\n                    lastValidRgb = rgbObj;\n                }\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\n\n                for (let i = 0; i < rgbArr.length; i++) {\n                    rgbArr[i].update();\n                }\n            },\n        });\n        const copyButton = BB.el({\n            tagName: 'button',\n            content: '<img src=\"' + copyImg + '\" height=\"20\" alt=\"\"/>',\n            title: LANG('mci-copy'),\n            onClick: function () {\n                hexInput.select();\n                navigator.clipboard.writeText(hexInput.value).then().catch();\n            },\n        });\n\n        const hexRowEl = c(\n            {\n                css: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    marginBottom: '15px',\n                    flexWrap: 'wrap',\n                    gap: '5px 10px',\n                    maxWidth: '250px',\n                },\n            },\n            [hexLabel, c(',flex,items-center,gap-10', [hexInput, copyButton])],\n        );\n        setTimeout(function () {\n            hexInput.focus();\n            hexInput.select();\n        }, 0);\n\n        // --- R G B ---\n        function createRgbInputRow(labelStr: string, attributeStr: 'r' | 'g' | 'b'): TInputRow {\n            const inputEl = input({\n                init: lastValidRgb[attributeStr],\n                min: 0,\n                max: 255,\n                type: 'number',\n                css: {\n                    width: '80px',\n                },\n                callback: function () {\n                    if (\n                        inputEl.value === '' ||\n                        parseFloat(inputEl.value) < 0 ||\n                        parseFloat(inputEl.value) > 255\n                    ) {\n                        result.update();\n                        return;\n                    }\n                    inputEl.value = '' + Math.round(parseFloat(inputEl.value));\n                    lastValidRgb[attributeStr] = Number(inputEl.value);\n                    previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n                },\n            });\n\n            const rowEl = c('tr', [c('td,pr-10', labelStr), c('td', [inputEl])]);\n\n            const result = {\n                update: (): void => {\n                    inputEl.value = '' + lastValidRgb[attributeStr];\n                },\n                destroy: (): void => {\n                    BB.unsetEventHandler(inputEl, 'onchange');\n                },\n                element: rowEl,\n            };\n            return result;\n        }\n        const rgbArr: TInputRow[] = [\n            createRgbInputRow(LANG('red'), 'r'),\n            createRgbInputRow(LANG('green'), 'g'),\n            createRgbInputRow(LANG('blue'), 'b'),\n        ];\n\n        const rootEl = c('', [\n            previewEl,\n            hexRowEl,\n            c('table.' + classes.table, [\n                c(\n                    'tbody',\n                    rgbArr.map((item) => item.element),\n                ),\n            ]),\n        ]);\n\n        showModal({\n            target: document.body,\n            message: `<b>${LANG('manual-color-input')}</b>`,\n            div: rootEl,\n            autoFocus: false,\n            clickOnEnter: 'Ok',\n            buttons: ['Ok', 'Cancel'],\n            callback: function (resultStr) {\n                BB.destroyEl(copyButton);\n                rgbArr.forEach((item) => item.destroy());\n                rgbArr.splice(0, rgbArr.length);\n\n                p.onClose(\n                    resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : undefined,\n                );\n            },\n        });\n    }\n}\n","module.exports = parcelRequire.resolve(\"copy.9e5cae90.svg\") + \"?\" + Date.now();","import { el } from './ui';\nimport { css } from './base';\n\nfunction decomposeElString(el: string) {\n    if (el === '') {\n        return {};\n    }\n\n    let split: string[];\n    let tagName: string;\n    const classes: string[] = [];\n\n    split = el.split('.');\n\n    if (split.length === 1) {\n        split = split[0].split(',');\n        tagName = split.shift()!;\n    } else {\n        tagName = split.shift()!;\n        split.forEach((item, index) => {\n            const isLast = index === split.length - 1;\n            if (isLast) {\n                split = item.split(',');\n                const last = split.shift();\n                if (last !== undefined) {\n                    classes.push(last);\n                }\n            } else {\n                classes.push(item);\n            }\n        });\n    }\n\n    const result = {} as {\n        tagName?: string;\n        classes?: string[];\n        styles?: string[];\n    };\n    if (tagName !== '') {\n        result.tagName = tagName;\n    }\n    if (classes.length > 0) {\n        result.classes = classes;\n    }\n    if (split.length > 0) {\n        result.styles = split;\n    }\n    return result;\n}\n\nfunction applyStyleNames(el: HTMLElement, styleNames: string[]) {\n    const style: Partial<CSSStyleDeclaration> = {};\n\n    const operations: {\n        [key: string]: (params: string[]) => void;\n    } = {\n        c: (params) => {\n            style.color = params[0];\n        },\n        bg: (params) => {\n            style.background = params[0];\n        },\n        p: (params) => {\n            style.padding = params[0] + 'px';\n        },\n        py: (params) => {\n            style.paddingTop = params[0] + 'px';\n            style.paddingBottom = params[0] + 'px';\n        },\n        pt: (params) => {\n            style.paddingTop = params[0] + 'px';\n        },\n        pr: (params) => {\n            style.paddingRight = params[0] + 'px';\n        },\n        pb: (params) => {\n            style.paddingBottom = params[0] + 'px';\n        },\n        pl: (params) => {\n            style.paddingLeft = params[0] + 'px';\n        },\n        mt: (params) => {\n            style.marginTop = params[0] + 'px';\n        },\n        mr: (params) => {\n            style.marginRight = params[0] + 'px';\n        },\n        mb: (params) => {\n            style.marginBottom = params[0] + 'px';\n        },\n        ml: (params) => {\n            style.marginLeft = params[0] + 'px';\n        },\n\n        // flex\n        flex: () => {\n            style.display = 'flex';\n        },\n        flexCol: () => {\n            style.flexDirection = 'column';\n        },\n        flexWrap: () => {\n            style.flexWrap = 'wrap';\n        },\n        gap: (params) => {\n            style.gap = params.map((item) => item + 'px').join(' ');\n        },\n        grow: () => {\n            style.flexGrow = '1';\n        },\n        justify: (params) => {\n            style.justifyContent = params[0];\n        },\n        items: (params) => {\n            style.alignItems = params[0];\n        },\n\n        hidden: () => {\n            style.display = 'none';\n        },\n        nowrap: () => {\n            style.whiteSpace = 'nowrap';\n        },\n        abs: (params) => {\n            style.position = 'absolute';\n            style.left = params[0] + 'px';\n            style.top = params[1] + 'px';\n        },\n        w: (params) => {\n            style.width = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        h: (params) => {\n            style.height = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        minh: (params) => {\n            style.minHeight = params[0] + 'px';\n        },\n        z: (params) => {\n            style.zIndex = params[0];\n        },\n        overflow: (params) => {\n            style.overflow = params[0];\n        },\n        pos: (params) => {\n            style.position = params[0];\n        },\n        left: (params) => {\n            style.left = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        top: (params) => {\n            style.top = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        right: (params) => {\n            style.right = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        bottom: (params) => {\n            style.bottom = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        size: (params) => {\n            style.fontSize = params[0] + 'px';\n        },\n        pointer: (params) => {\n            style.pointerEvents = params[0];\n        },\n    };\n\n    styleNames.forEach((item) => {\n        const params = item.split('-');\n        const operation = params.shift()!;\n        operations[operation](params);\n    });\n    css(el, style);\n}\n\n/**\n * composes HTML\n */\nexport function c(\n    element?: HTMLElement | string | Parameters<typeof el>[0],\n    inner?: string | (SVGElement | HTMLElement | string)[],\n): HTMLElement {\n    if (element === undefined) {\n        return document.createElement('div');\n    }\n    if (typeof element !== 'string') {\n        if (!(element instanceof HTMLElement)) {\n            element = el(element);\n        }\n        if (inner) {\n            if (typeof inner === 'string') {\n                element.innerHTML = inner;\n            } else {\n                element.append(...inner);\n            }\n        }\n\n        return element;\n    }\n\n    const decomp = decomposeElString(element);\n    const result = document.createElement(decomp.tagName ?? 'div');\n    decomp.classes && result.classList.add(...decomp.classes);\n    decomp.styles && applyStyleNames(result, decomp.styles);\n\n    if (inner) {\n        if (typeof inner === 'string') {\n            result.innerHTML = inner;\n        } else {\n            result.append(...inner);\n        }\n    }\n    return result;\n}\n",null,"import { BB } from '../../../bb/bb';\nimport { HexColorDialog } from '../modals/color-slider-hex-dialog';\nimport { calcSliderFalloffFactor } from './slider-falloff';\nimport eyedropperImg from 'url:/src/app/img/ui/tool-picker.svg';\nimport { LANG } from '../../../language/language';\nimport { TRgb } from '../../kl-types';\nimport { HSV, RGB } from '../../../bb/color/color';\nimport { ERASE_COLOR } from '../../brushes/erase-color';\nimport { css } from '../../../bb/base/base';\n\n/**\n * big main HS+V color slider\n * 2 elements: slider, and colorpreview(output) + eyedropper\n */\nexport class KlColorSlider {\n    private readonly rootEl: HTMLElement;\n    private readonly outputDiv: HTMLElement;\n    private readonly divPreview: HTMLElement;\n    private readonly hexButton: HTMLElement;\n    private readonly secondaryColorBtn: HTMLElement;\n    private primaryColorRgb: RGB;\n    private primaryColorHsv: HSV;\n    private secondaryColorRgb: RGB;\n    private secondaryColorHsv: HSV;\n    private readonly controlH: HTMLElement;\n    private readonly onEyedropper: (b: boolean) => void;\n    private isPicking: boolean;\n    private readonly pickerButton: HTMLElement;\n    private readonly width: number;\n    private readonly height: number; // hue slider and output height\n\n    private readonly SVContainer: HTMLElement;\n    private readonly pointerSV: HTMLElement;\n    private svHeight: number;\n    private readonly svGradient: HTMLElement;\n\n    private readonly emitColor: (rgb: RGB) => void;\n\n    private updatePrimaryHSV(hsv: HSV): void {\n        if (hsv.s === 0) {\n            this.primaryColorHsv = new BB.HSV(this.primaryColorHsv.h, hsv.s, hsv.v);\n        } else {\n            this.primaryColorHsv = new BB.HSV(hsv.h, hsv.s, hsv.v);\n        }\n    }\n\n    private updateSVCanvas(): void {\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(this.primaryColorHsv.h, 100, 100));\n        this.svGradient.style.setProperty(\n            '--kl-color-picker--hue',\n            '#' + BB.ColorConverter.toHexString(rgb),\n        );\n    }\n\n    private updateSVPointer(): void {\n        const left = (this.primaryColorHsv.s / 100) * this.width - 7;\n        const top = (1 - this.primaryColorHsv.v / 100) * this.svHeight - 6;\n        css(this.pointerSV, {\n            left: left + 'px',\n            top: top + 'px',\n        });\n    }\n\n    private setColPreview(): void {\n        this.divPreview.style.backgroundColor =\n            'rgb(' +\n            this.primaryColorRgb.r +\n            ',' +\n            this.primaryColorRgb.g +\n            ',' +\n            this.primaryColorRgb.b +\n            ')';\n\n        if (BB.testIsWhiteBestContrast(this.primaryColorRgb)) {\n            css(this.pickerButton, {\n                filter: 'invert(1)',\n            });\n            css(this.hexButton, {\n                filter: 'invert(1)',\n            });\n        } else {\n            css(this.pickerButton, {\n                filter: '',\n            });\n            css(this.hexButton, {\n                filter: '',\n            });\n        }\n    }\n\n    private updateSecondaryColor(): void {\n        this.secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(\n            this.secondaryColorRgb,\n        );\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: {\n        width: number;\n        height: number; // hue slider and output height\n        svHeight: number;\n        startValue: TRgb; // 0-255\n        onPick: (rgb: TRgb) => void;\n        onEyedropper: (isActive: boolean) => void;\n    }) {\n        this.rootEl = BB.el({\n            className: 'kl-color-picker',\n            css: {\n                position: 'relative',\n            },\n        });\n        this.outputDiv = BB.el({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n        this.width = p.width;\n        this.svHeight = p.svHeight;\n        this.height = p.height;\n        this.emitColor = p.onPick;\n        this.onEyedropper = p.onEyedropper;\n\n        this.primaryColorRgb = {\n            r: parseInt('' + p.startValue.r),\n            g: parseInt('' + p.startValue.g),\n            b: parseInt('' + p.startValue.b),\n        };\n        this.primaryColorHsv = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\n        this.secondaryColorRgb = {\n            r: ERASE_COLOR,\n            g: ERASE_COLOR,\n            b: ERASE_COLOR,\n        };\n        this.secondaryColorHsv = BB.ColorConverter._RGBtoHSV(this.secondaryColorRgb); // BB.HSV\n\n        const svWrapper = BB.el();\n        this.svGradient = BB.el({\n            css: {\n                background:\n                    'linear-gradient(0deg, #000 0%, rgba(255, 0, 0, 0) 100%), linear-gradient(-90deg, var(--kl-color-picker--hue) 0%, #fff 100%)',\n                width: this.width + 'px',\n                height: this.svHeight + 'px',\n            },\n        });\n\n        svWrapper.append(this.svGradient);\n\n        const divH = BB.el({\n            className: 'kl-color-picker__h',\n            css: {\n                overflow: 'hidden',\n                position: 'relative',\n                width: this.width + 'px',\n                height: this.height + 'px',\n                cursor: 'ew-resize',\n                marginTop: '1px',\n                marginBottom: '1px',\n            },\n        });\n        this.divPreview = BB.el({\n            className: 'kl-color-picker__preview',\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                width: this.height * 2.5 + 'px',\n                height: this.height + 'px',\n            },\n        });\n        this.controlH = BB.el();\n\n        const createHueBg = (targetEl: HTMLElement) => {\n            const im = new Image();\n            css(im, {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                display: 'none',\n                pointerEvents: 'none',\n            });\n            const cv = BB.canvas(this.width, this.height);\n            const ctx = BB.ctx(cv);\n            const gradH = ctx.createLinearGradient(0, 0, this.width, 0);\n            for (let i = 0; i < 1; i += 0.01) {\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\n                let ha = parseInt('' + col.r).toString(16);\n                let hb = parseInt('' + col.g).toString(16);\n                let hc = parseInt('' + col.b).toString(16);\n                if (ha.length === 1) {\n                    ha = '0' + ha;\n                }\n                if (hb.length === 1) {\n                    hb = '0' + hb;\n                }\n                if (hc.length === 1) {\n                    hc = '0' + hc;\n                }\n                gradH.addColorStop(i, '#' + ha + hb + hc);\n            }\n            ctx.fillStyle = gradH;\n            ctx.fillRect(0, 0, this.width, this.height);\n\n            targetEl.append(im);\n            im.alt = 'hue';\n            im.src = cv.toDataURL('image/png');\n            im.style.display = 'block';\n        };\n\n        this.updateSVCanvas();\n        this.rootEl.style.width = this.width + 'px';\n        this.rootEl.oncontextmenu = () => {\n            return false;\n        };\n\n        this.SVContainer = BB.el({\n            className: 'kl-color-picker__sv',\n            css: {\n                width: this.width + 'px',\n                height: this.svHeight + 'px',\n                overflow: 'hidden',\n                display: 'block',\n                position: 'relative',\n                cursor: 'crosshair',\n            },\n        });\n\n        this.pointerSV = BB.el({\n            css: {\n                width: '12px',\n                height: '12px',\n                borderRadius: '6px',\n                position: 'absolute',\n                pointerEvents: 'none',\n                boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff',\n            },\n        });\n\n        this.SVContainer.append(svWrapper, this.pointerSV);\n        this.updateSVPointer();\n        this.rootEl.append(this.SVContainer, divH);\n        this.outputDiv.append(this.divPreview);\n\n        //divH.className = \"svSlider\";\n        css(this.controlH, {\n            width: '2px',\n            height: this.height + 'px',\n            background: '#000',\n            borderLeft: '1px solid #fff',\n            position: 'absolute',\n            top: '0',\n            left: parseInt('' + ((this.primaryColorHsv.h / 360) * this.width - 1)) + 'px',\n        });\n\n        const virtualHSV = {\n            h: 0,\n            s: 0,\n            v: 0,\n        };\n\n        this.pickerButton = BB.el({\n            title: LANG('eyedropper') + ' [Alt]',\n            className: 'color-picker-preview-button',\n            css: {\n                width: '30px',\n                height: '30px',\n                backgroundImage: 'url(' + eyedropperImg + ')',\n                backgroundRepeat: 'no-repeat',\n                backgroundSize: '70%',\n                backgroundPosition: 'center',\n            },\n            onClick: () => {\n                if (this.isPicking) {\n                    this.setIsEyedropping(false);\n                } else {\n                    this.pickerButton.classList.remove('color-picker-preview-button-hover');\n                    this.pickerButton.classList.add('color-picker-preview-button-active');\n                    this.isPicking = true;\n                    this.onEyedropper(true);\n                }\n            },\n        });\n        this.isPicking = false;\n\n        const pickerButtonPointerListener = new BB.PointerListener({\n            target: this.pickerButton,\n            onEnterLeave: (isOver) => {\n                if (this.isPicking) {\n                    return;\n                }\n                this.pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\n            },\n        });\n        this.divPreview.append(this.pickerButton);\n\n        this.hexButton = BB.el({\n            content: '#',\n            className: 'color-picker-preview-button',\n            title: LANG('manual-color-input'),\n            css: {\n                height: '100%',\n                width: this.height + 'px',\n                lineHeight: this.height + 'px',\n                fontSize: this.height * 0.65 + 'px',\n            },\n            onClick: () => {\n                new HexColorDialog({\n                    color: new BB.RGB(\n                        this.primaryColorRgb.r,\n                        this.primaryColorRgb.g,\n                        this.primaryColorRgb.b,\n                    ),\n                    onClose: (rgbObj) => {\n                        if (!rgbObj) {\n                            return;\n                        }\n                        this.setColor(rgbObj);\n                        this.emitColor(\n                            new BB.RGB(\n                                this.primaryColorRgb.r,\n                                this.primaryColorRgb.g,\n                                this.primaryColorRgb.b,\n                            ),\n                        );\n                    },\n                });\n            },\n        });\n        const hexButtonPointerListener = new BB.PointerListener({\n            target: this.hexButton,\n            onEnterLeave: (isOver) => {\n                this.hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\n            },\n        });\n        this.divPreview.append(this.hexButton);\n\n        this.setColPreview();\n\n        setTimeout(() => {\n            createHueBg(divH);\n            divH.append(this.controlH);\n            const svPointerListener = new BB.PointerListener({\n                target: svWrapper,\n                fixScribble: true,\n                onPointer: (event) => {\n                    if (event.type === 'pointerdown') {\n                        // prevent manual slider input keeping focus on iPad\n                        BB.unfocusAnyInput();\n\n                        this.SVContainer.classList.toggle('kl-color-picker--active', true);\n\n                        if (event.button === 'left') {\n                            virtualHSV.s = (event.relX / this.width) * 100;\n                            virtualHSV.v = 100 - (event.relY / this.svHeight) * 100;\n\n                            this.primaryColorHsv = new BB.HSV(\n                                this.primaryColorHsv.h,\n                                virtualHSV.s,\n                                virtualHSV.v,\n                            );\n                            this.primaryColorRgb = BB.ColorConverter.toRGB(this.primaryColorHsv);\n\n                            this.updateSVPointer();\n                            this.setColPreview();\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHsv));\n                        } else {\n                            virtualHSV.s = this.primaryColorHsv.s;\n                            virtualHSV.v = this.primaryColorHsv.v;\n                        }\n                    }\n\n                    if (\n                        event.type === 'pointermove' &&\n                        ['left', 'right'].includes(event.button || '')\n                    ) {\n                        let factor = 1;\n                        if (event.button === 'right') {\n                            factor = 0.5;\n                        }\n\n                        virtualHSV.s += (event.dX / this.width) * 100 * factor;\n                        virtualHSV.v -= (event.dY / this.svHeight) * 100 * factor;\n\n                        this.primaryColorHsv = new BB.HSV(\n                            this.primaryColorHsv.h,\n                            virtualHSV.s,\n                            virtualHSV.v,\n                        );\n                        this.primaryColorRgb = BB.ColorConverter.toRGB(this.primaryColorHsv);\n                        this.updateSVPointer();\n                        this.setColPreview();\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHsv));\n                    }\n\n                    if (event.type === 'pointerup') {\n                        this.SVContainer.classList.toggle('kl-color-picker--active', false);\n                    }\n                },\n            });\n            const hPointerListener = new BB.PointerListener({\n                target: divH,\n                fixScribble: true,\n                onPointer: (event) => {\n                    if (event.type === 'pointerdown') {\n                        // prevent manual slider input keeping focus on iPad\n                        BB.unfocusAnyInput();\n\n                        divH.classList.toggle('kl-color-picker--active', true);\n\n                        if (event.button === 'left') {\n                            virtualHSV.h = (event.relX / this.width) * 359.99;\n\n                            this.primaryColorHsv = new BB.HSV(\n                                virtualHSV.h,\n                                this.primaryColorHsv.s,\n                                this.primaryColorHsv.v,\n                            );\n                            this.primaryColorRgb = BB.ColorConverter.toRGB(this.primaryColorHsv);\n                            this.controlH.style.left =\n                                Math.round((this.primaryColorHsv.h / 359.99) * this.width) -\n                                1 +\n                                'px';\n                            this.updateSVCanvas();\n                            this.setColPreview();\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHsv));\n                        } else {\n                            virtualHSV.h = this.primaryColorHsv.h;\n                        }\n                    }\n\n                    if (\n                        event.type === 'pointermove' &&\n                        ['left', 'right'].includes(event.button || '')\n                    ) {\n                        const deltaY = Math.abs(event.pageY - event.downPageY!);\n                        const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n\n                        virtualHSV.h += (event.dX / this.width) * 359.99 * factor;\n\n                        if (event.button === 'right') {\n                            virtualHSV.h = virtualHSV.h % 359.99;\n                            if (virtualHSV.h < 0) {\n                                virtualHSV.h += 359.99;\n                            }\n                        }\n                        virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                        this.primaryColorHsv = new BB.HSV(\n                            virtualHSV.h,\n                            this.primaryColorHsv.s,\n                            this.primaryColorHsv.v,\n                        );\n                        this.primaryColorRgb = BB.ColorConverter.toRGB(this.primaryColorHsv);\n                        this.controlH.style.left =\n                            Math.round((this.primaryColorHsv.h / 359.99) * this.width) - 1 + 'px';\n                        this.updateSVCanvas();\n                        this.setColPreview();\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHsv));\n                    }\n\n                    if (event.type === 'pointerup') {\n                        divH.classList.toggle('kl-color-picker--active', false);\n                    }\n                },\n            });\n        }, 1);\n\n        // --- secondary color ---\n\n        this.secondaryColorBtn = BB.el({\n            parent: this.outputDiv,\n            title: LANG('secondary-color') + ' [X]',\n            className: 'kl-color-picker__secondary',\n            css: {\n                cursor: 'pointer',\n                marginLeft: '5px',\n                width: '22px',\n                height: '22px',\n            },\n            onClick: (e) => {\n                e.preventDefault();\n                this.swapColors();\n            },\n        });\n        this.updateSecondaryColor();\n    }\n\n    setColor(c: TRgb): void {\n        this.primaryColorRgb = {\n            r: parseInt('' + c.r),\n            g: parseInt('' + c.g),\n            b: parseInt('' + c.b),\n        };\n        this.updatePrimaryHSV(BB.ColorConverter.toHSV(c));\n        this.controlH.style.left =\n            parseInt('' + ((this.primaryColorHsv.h / 359) * this.width - 1)) + 'px';\n        this.updateSVCanvas();\n        this.updateSVPointer();\n        this.setColPreview();\n    }\n\n    getColor(): RGB {\n        return new BB.RGB(this.primaryColorRgb.r, this.primaryColorRgb.g, this.primaryColorRgb.b);\n    }\n\n    getSecondaryRGB(): RGB {\n        return new BB.RGB(\n            this.secondaryColorRgb.r,\n            this.secondaryColorRgb.g,\n            this.secondaryColorRgb.b,\n        );\n    }\n\n    getIsEyedropping(): boolean {\n        return this.isPicking;\n    }\n\n    setIsEyedropping(b: boolean): void {\n        if (b) {\n            this.isPicking = true;\n            this.onEyedropper(true);\n            this.pickerButton.classList.add('color-picker-preview-button-active');\n        } else {\n            this.isPicking = false;\n            this.onEyedropper(false);\n            this.pickerButton.classList.remove('color-picker-preview-button-active');\n        }\n    }\n\n    enable(e: boolean): void {\n        const style: Partial<CSSStyleDeclaration> = {\n            pointerEvents: e ? '' : 'none',\n            opacity: e ? '1' : '0.5',\n        };\n        css(this.rootEl, style);\n        css(this.outputDiv, style);\n    }\n\n    setHeight(h: number): void {\n        h = parseInt('' + (h - this.height * 2 - 3), 10);\n        if (h === this.svHeight) {\n            return;\n        }\n        this.svHeight = h;\n        css(this.svGradient, {\n            width: this.width + 'px',\n            height: this.svHeight + 'px',\n        });\n        this.SVContainer.style.height = this.svHeight + 'px';\n        this.updateSVPointer();\n    }\n\n    swapColors(): void {\n        // swap hsv\n        let tmp: RGB | HSV = this.secondaryColorHsv;\n        this.secondaryColorHsv = this.primaryColorHsv;\n        this.updatePrimaryHSV(tmp);\n        // swap rgb\n        tmp = this.secondaryColorRgb;\n        this.secondaryColorRgb = this.primaryColorRgb;\n        this.primaryColorRgb = tmp;\n\n        this.controlH.style.left =\n            parseInt('' + ((this.primaryColorHsv.h / 359) * this.width - 1)) + 'px';\n        this.updateSVCanvas();\n        this.updateSVPointer();\n        this.setColPreview();\n        this.updateSecondaryColor();\n\n        this.emitColor(\n            new BB.RGB(this.primaryColorRgb.r, this.primaryColorRgb.g, this.primaryColorRgb.b),\n        );\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getOutputElement(): HTMLElement {\n        return this.outputDiv;\n    }\n}\n","module.exports = parcelRequire.resolve(\"tool-picker.dcb78a56.svg\") + \"?\" + Date.now();","import { THEME } from '../../theme/theme';\nimport { TRgb } from '../kl-types';\n\nexport const ERASE_COLOR = THEME.isDark() ? 255 : 255;\n\nexport function getEraseColor(): TRgb {\n    return { r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR };\n}\n","import { addIsDarkListener, isDark } from '../bb/base/base';\nimport { LocalStorage } from '../bb/base/local-storage';\n\nconst LS_THEME_KEY = 'klecks-theme';\n\nexport type TTheme = 'dark' | 'light';\ntype TThemeListener = () => void;\n\nclass Theme {\n    private storedTheme: TTheme | undefined;\n    // initialization will be overwritten.\n    private mediaQueryTheme: TTheme = 'light'; // prefers-color-scheme\n    private theme: TTheme = 'light';\n    private readonly listeners: TThemeListener[] = [];\n\n    private updateTheme(): void {\n        const oldTheme = this.theme;\n        this.theme = this.storedTheme || this.mediaQueryTheme;\n\n        if (this.theme === oldTheme) {\n            return;\n        }\n        document.body.classList.toggle('kl-theme-dark', this.theme === 'dark');\n        this.listeners.forEach((item) => item());\n    }\n\n    private readLocalStorage(): TTheme | undefined {\n        let result = LocalStorage.getItem(LS_THEME_KEY) as unknown;\n        if (!result || (typeof result === 'string' && !['dark', 'light'].includes(result))) {\n            result = undefined;\n            LocalStorage.removeItem(LS_THEME_KEY); // reset because invalid\n        }\n        return result as TTheme | undefined;\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {\n        // init media query\n        this.mediaQueryTheme = isDark() ? 'dark' : 'light';\n        addIsDarkListener(() => {\n            this.mediaQueryTheme = isDark() ? 'dark' : 'light';\n            this.updateTheme();\n        });\n\n        // init local storage\n        this.storedTheme = this.readLocalStorage();\n        addEventListener('storage', (e) => {\n            if (e.key === LS_THEME_KEY) {\n                this.storedTheme = this.readLocalStorage();\n                this.updateTheme();\n            }\n        });\n\n        this.updateTheme();\n    }\n\n    isDark(): boolean {\n        return this.theme === 'dark';\n    }\n\n    addIsDarkListener(func: TThemeListener): void {\n        if (this.listeners.includes(func)) {\n            return;\n        }\n        this.listeners.push(func);\n    }\n\n    removeIsDarkListener(func: TThemeListener): void {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (this.listeners[i] === func) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    getMediaQueryTheme(): TTheme {\n        return this.mediaQueryTheme;\n    }\n\n    getStoredTheme(): TTheme | undefined {\n        return this.storedTheme;\n    }\n\n    setStoredTheme(theme: TTheme | undefined): void {\n        if (theme) {\n            LocalStorage.setItem(LS_THEME_KEY, theme);\n        } else {\n            LocalStorage.removeItem(LS_THEME_KEY);\n        }\n        this.storedTheme = theme;\n        this.updateTheme();\n    }\n}\n\nexport const THEME = new Theme();\n","import { BB } from '../../../bb/bb';\nimport { calcSliderFalloffFactor } from './slider-falloff';\nimport { TRgb } from '../../kl-types';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { HSV } from '../../../bb/color/color';\nimport { css } from '../../../bb/base/base';\n\n/**\n * a small color slider\n */\nexport class KlColorSliderSmall {\n    private readonly rootEl: HTMLElement;\n    private color: HSV;\n    private readonly svPointerListener: PointerListener;\n    private readonly hPointerListener: PointerListener;\n    private svPointerId: number | null;\n    private hPointerId: number | null;\n    private readonly width: number;\n    private readonly heightSV: number;\n    private readonly pointerSV: HTMLElement;\n    private readonly pointerH: HTMLElement;\n    private readonly canvasSV: HTMLCanvasElement;\n\n    private updateSV(): void {\n        const ctx = BB.ctx(this.canvasSV);\n        if (!ctx) {\n            throw new Error(\"couldn't create canvas\");\n        }\n        for (let i = 0; i < this.canvasSV.height; i += 1) {\n            const gradient1 = ctx.createLinearGradient(0, 0, this.canvasSV.width, 0);\n\n            const colleft = BB.ColorConverter.toRGB(\n                new BB.HSV(this.color.h, 1, 100 - (i / this.canvasSV.height) * 100.0),\n            );\n            const colright = BB.ColorConverter.toRGB(\n                new BB.HSV(this.color.h, 100, 100 - (i / this.canvasSV.height) * 100.0),\n            );\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\n            ctx.fillStyle = gradient1;\n            ctx.fillRect(0, i, this.canvasSV.width, 1);\n        }\n    }\n\n    private updateSVPointer(): void {\n        const left = (this.color.s / 100) * this.width - 4;\n        const top = (1 - this.color.v / 100) * this.heightSV - 4;\n        css(this.pointerSV, {\n            left: left + 'px',\n            top: top + 'px',\n        });\n    }\n\n    private updateHPointer(): void {\n        this.pointerH.style.left = (this.color.h / 359.999) * this.width - 1 + 'px';\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        width: number;\n        heightSV: number; // height of saturation/value\n        heightH: number; // height of hue\n        color: TRgb;\n        callback: (c: TRgb) => void;\n    }) {\n        this.rootEl = BB.el({\n            css: {\n                width: p.width + 'px',\n                position: 'relative',\n                overflow: 'hidden',\n                userSelect: 'none',\n            },\n        });\n        this.rootEl.oncontextmenu = (e) => {\n            e.preventDefault();\n        };\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(p.color.r, p.color.g, p.color.b));\n        this.width = p.width;\n        this.heightSV = p.heightSV;\n\n        this.canvasSV = BB.canvas(10, 10);\n        css(this.canvasSV, {\n            width: this.width + 'px',\n            height: this.heightSV + 'px',\n            cursor: 'crosshair',\n        });\n\n        this.updateSV();\n\n        const canvasH = BB.canvas(p.width, p.heightH);\n        canvasH.style.cursor = 'ew-resize';\n        (() => {\n            const ctx = BB.ctx(canvasH);\n\n            const gradH = ctx.createLinearGradient(0, 0, p.width, 0);\n            for (let i = 0; i < 1; i += 0.01) {\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\n                gradH.addColorStop(\n                    i,\n                    'rgba(' +\n                        parseInt('' + col.r) +\n                        ', ' +\n                        parseInt('' + col.g) +\n                        ', ' +\n                        parseInt('' + col.b) +\n                        ', 1)',\n                );\n            }\n            ctx.fillStyle = gradH;\n            ctx.fillRect(0, 0, p.width, p.heightH);\n        })();\n        css(this.canvasSV, {\n            width: p.width + 'px',\n            height: p.heightSV + 'px',\n            overflow: 'hidden',\n            position: 'relative',\n        });\n        this.canvasSV.style.cssFloat = 'left';\n        canvasH.style.cssFloat = 'left';\n\n        this.rootEl.append(this.canvasSV, canvasH);\n\n        this.pointerSV = BB.el({\n            parent: this.rootEl,\n            css: {\n                width: '8px',\n                height: '8px',\n                borderRadius: '8px',\n                position: 'absolute',\n                pointerEvents: 'none',\n                boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff',\n            },\n        });\n\n        this.pointerH = BB.el({\n            parent: this.rootEl,\n            css: {\n                width: '0',\n                height: p.heightH + 'px',\n                borderLeft: '1px solid #fff',\n                borderRight: '1px solid #000',\n                position: 'absolute',\n                top: p.heightSV + 'px',\n                pointerEvents: 'none',\n            },\n        });\n\n        this.updateSVPointer();\n        this.updateHPointer();\n\n        const virtualHSV = {\n            h: 0,\n            s: 0,\n            v: 0,\n        };\n\n        this.svPointerId = null;\n        this.svPointerListener = new BB.PointerListener({\n            target: this.canvasSV,\n            fixScribble: true,\n            onPointer: (event) => {\n                if (event.type === 'pointerdown') {\n                    // prevent manual slider input keeping focus on iPad\n                    BB.unfocusAnyInput();\n\n                    this.svPointerId = event.pointerId;\n                    if (event.button === 'left') {\n                        virtualHSV.s = (event.relX / p.width) * 100;\n                        virtualHSV.v = 100 - (event.relY / p.heightSV) * 100;\n\n                        this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\n\n                        this.updateSVPointer();\n                        p.callback(BB.ColorConverter.toRGB(this.color));\n                    } else {\n                        virtualHSV.s = this.color.s;\n                        virtualHSV.v = this.color.v;\n                    }\n                }\n\n                if (\n                    event.type === 'pointermove' &&\n                    ['left', 'right'].includes('' + event.button) &&\n                    this.svPointerId === event.pointerId\n                ) {\n                    let factor = 1;\n                    if (event.button === 'right') {\n                        factor = 0.5;\n                    }\n\n                    virtualHSV.s += (event.dX / p.width) * 100 * factor;\n                    virtualHSV.v -= (event.dY / p.heightSV) * 100 * factor;\n\n                    this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\n                    this.updateSVPointer();\n                    p.callback(BB.ColorConverter.toRGB(this.color));\n                }\n                if (event.type === 'pointerup') {\n                    this.svPointerId = null;\n                }\n            },\n        });\n\n        this.hPointerId = null;\n        this.hPointerListener = new BB.PointerListener({\n            target: canvasH,\n            fixScribble: true,\n            onPointer: (event) => {\n                if (event.type === 'pointerdown') {\n                    this.hPointerId = event.pointerId;\n                    if (event.button === 'left') {\n                        virtualHSV.h = (event.relX / p.width) * 359.99;\n\n                        this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\n                        this.updateSV();\n                        this.updateHPointer();\n                        p.callback(BB.ColorConverter.toRGB(this.color));\n                    } else {\n                        virtualHSV.h = this.color.h;\n                    }\n                }\n\n                if (\n                    event.type === 'pointermove' &&\n                    ['left', 'right'].includes('' + event.button) &&\n                    this.hPointerId === event.pointerId\n                ) {\n                    const deltaY = Math.abs(event.pageY - event.downPageY!);\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n\n                    virtualHSV.h += (event.dX / p.width) * 359.99 * factor;\n\n                    if (event.button === 'right') {\n                        virtualHSV.h = virtualHSV.h % 359.99;\n                        if (virtualHSV.h < 0) {\n                            virtualHSV.h += 359.99;\n                        }\n                    }\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                    this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\n                    this.updateSV();\n                    this.updateHPointer();\n                    p.callback(BB.ColorConverter.toRGB(this.color));\n                }\n                if (event.type === 'pointerup') {\n                    this.hPointerId = null;\n                }\n            },\n        });\n\n        const cleardiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                clear: 'both',\n            },\n        });\n    }\n\n    // ---- interface ----\n    setColor(c: TRgb): void {\n        if (this.hPointerId !== null || this.svPointerId !== null) {\n            return;\n        }\n\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\n        this.updateSV();\n        this.updateSVPointer();\n        this.updateHPointer();\n    }\n\n    getColor(): TRgb {\n        return BB.ColorConverter.toRGB(this.color);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    end(): void {\n        this.svPointerId = null;\n        this.hPointerId = null;\n    }\n\n    destroy(): void {\n        this.svPointerListener.destroy();\n        this.hPointerListener.destroy();\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { css } from '../../../bb/base/base';\n\n/**\n * A slider that looks like this\n * ------O----\n */\nexport class PointSlider {\n    private readonly rootEl: HTMLElement;\n    private readonly sliderPoint: HTMLElement;\n    private readonly pointerListener: PointerListener;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        init: number;\n        width: number;\n        pointSize: number;\n        callback: (value: number, isFirst: boolean, isLast: boolean) => void;\n    }) {\n        this.rootEl = BB.el({\n            css: {\n                position: 'relative',\n            },\n        });\n        const sliderLine = BB.el({\n            parent: this.rootEl,\n            className: 'kl-point-slider__line',\n            css: {\n                marginTop: parseInt('' + (p.pointSize / 2 - 1)) + 'px',\n                width: p.width + 'px',\n            },\n        });\n        this.sliderPoint = BB.el({\n            parent: this.rootEl,\n            className: 'kl-point-slider__point',\n        });\n        let sliderPos: number;\n        let isDragging = false;\n\n        //sliderPoint\n        const touchAreaEl = BB.el({\n            // expand clickable area\n            parent: this.sliderPoint,\n            css: {\n                // background: 'rgba(255,0,0,0.4)',\n                margin: '-7px 0 0 -7px',\n                width: 'calc(100% + 14px)',\n                height: 'calc(100% + 7px)',\n            },\n        });\n\n        const redrawPoint = () => {\n            css(this.sliderPoint, {\n                left: sliderPos + 'px',\n            });\n        };\n        const getValue = () => {\n            return sliderPos / (p.width - p.pointSize);\n        };\n\n        {\n            let isFirst: boolean;\n            sliderPos = BB.clamp(p.init * (p.width - p.pointSize), 0, p.width - p.pointSize);\n            css(this.sliderPoint, {\n                width: p.pointSize + 'px',\n                height: p.pointSize + 'px',\n                borderRadius: p.pointSize + 'px',\n            });\n            redrawPoint();\n            let imaginaryPos: number;\n            this.pointerListener = new BB.PointerListener({\n                target: this.sliderPoint,\n                fixScribble: true,\n                onPointer: (event): void => {\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        isFirst = true;\n                        isDragging = true;\n                        imaginaryPos = sliderPos;\n                        redrawPoint();\n                        event.eventStopPropagation();\n                    } else if (event.type === 'pointermove' && event.button === 'left') {\n                        event.eventStopPropagation();\n                        imaginaryPos = imaginaryPos + event.dX;\n                        sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, p.width - p.pointSize));\n                        redrawPoint();\n                        p.callback(getValue(), isFirst, false);\n                        isFirst = false;\n                    }\n                    if (event.type === 'pointerup') {\n                        event.eventStopPropagation();\n                        isDragging = false;\n                        redrawPoint();\n                        p.callback(getValue(), false, true);\n                    }\n                },\n            });\n        }\n    }\n\n    // ---- interface ----\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    setActive(isActive: boolean): void {\n        this.sliderPoint.style.backgroundColor = isActive ? '#fff' : '#eaeaea';\n    }\n\n    destroy(): void {\n        this.pointerListener.destroy();\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { TRgba } from '../../kl-types';\nimport { ColorConverter } from '../../../bb/color/color';\nimport { c } from '../../../bb/base/c';\n\n/**\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\n * Can't deal with 0.5 alpha.\n * Rectangular buttons.\n */\nexport class ColorOptions {\n    private readonly rootEl: HTMLElement;\n    private readonly buttonArr: {\n        el: HTMLElement;\n        setIsSelected: (b: boolean) => void;\n    }[];\n    private readonly colorArr: (TRgba | null)[] = [];\n    private selectedIndex: number = 0;\n    private readonly colorInput: HTMLInputElement;\n\n    private readonly onColorInputChange: () => void;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        colorArr: (TRgba | null)[]; // duplicates will be removed\n        onChange: (rgbaObj: TRgba | null) => void;\n        label?: string;\n        initialIndex?: number; // index before duplicates were removed\n        title?: string;\n        css?: Partial<CSSStyleDeclaration>;\n    }) {\n        this.rootEl = BB.el({\n            content: p.label ? p.label : '',\n            title: p.title ?? undefined,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: '7px',\n                position: 'relative',\n                ...p.css,\n            },\n        });\n\n        this.buttonArr = [];\n        const buttonSize = 22;\n\n        this.onColorInputChange = () => {\n            const i = this.selectedIndex;\n            const color = this.colorArr[i];\n            if (!color || color.a < 1) {\n                // ignore\n                return;\n            }\n\n            const newRawColor = this.colorInput.value;\n            this.buttonArr[this.selectedIndex].el.style.backgroundColor = newRawColor;\n            this.colorArr[i] = {\n                ...ColorConverter.hexToRGB(newRawColor)!,\n                a: 1,\n            };\n            p.onChange(this.colorArr[i]);\n        };\n        this.colorInput = BB.el({\n            tagName: 'input',\n            custom: {\n                type: 'color',\n                tabIndex: '-1',\n            },\n        });\n        this.colorInput.onchange = this.onColorInputChange;\n        this.colorInput.oninput = this.onColorInputChange;\n\n        // build colorArr while removing duplicates\n        for (let i = 0; i < p.colorArr.length; i++) {\n            const item = p.colorArr[i];\n            let found = false;\n            for (let e = 0; e < this.colorArr.length; e++) {\n                const sItem = this.colorArr[e];\n                if (sItem === item) {\n                    found = true;\n                    break;\n                }\n                if (sItem === null || item === null) {\n                    continue;\n                }\n                if (\n                    sItem.r === item.r &&\n                    sItem.g === item.g &&\n                    sItem.b === item.b &&\n                    sItem.a === item.a\n                ) {\n                    found = true;\n                    break;\n                }\n            }\n            if (found) {\n                continue;\n            }\n            this.colorArr.push(item);\n            if ('initialIndex' in p && p.initialIndex === i) {\n                this.selectedIndex = this.colorArr.length - 1;\n            }\n        }\n\n        for (let i = 0; i < this.colorArr.length; i++) {\n            ((i) => {\n                const color = this.colorArr[i];\n\n                const colorButton = BB.el({\n                    parent: this.rootEl,\n                    content: color ? '' : 'X',\n                    className: 'kl-color-option',\n                    css: {\n                        width: buttonSize + 'px',\n                        height: buttonSize + 'px',\n                        backgroundColor: color ? BB.ColorConverter.toRgbaStr(color) : 'transparent',\n                        lineHeight: buttonSize + 1 + 'px',\n                    },\n                    onClick: (e) => {\n                        if (this.selectedIndex === i) {\n                            if (color && color.a === 1) {\n                                this.colorInput.showPicker\n                                    ? this.colorInput.showPicker()\n                                    : this.colorInput.click();\n                            }\n                            return;\n                        }\n\n                        e.preventDefault();\n                        this.selectedIndex = i;\n                        update();\n                        p.onChange(this.colorArr[i]); // color may change\n                    },\n                });\n                if (color && color.a === 0) {\n                    colorButton.style.background = 'var(--kl-checkerboard-background)';\n                }\n\n                const setIsSelected = (b: boolean): void => {\n                    colorButton.classList.toggle('kl-color-option--active', b);\n                };\n\n                this.buttonArr.push({\n                    el: colorButton,\n                    setIsSelected,\n                });\n            })(i);\n        }\n\n        this.rootEl.append(c(',w-0,h-0,overflow-hidden,abs-0-0', [this.colorInput]));\n\n        const update = () => {\n            for (let i = 0; i < this.buttonArr.length; i++) {\n                this.buttonArr[i].setIsSelected(i === this.selectedIndex);\n            }\n        };\n        update();\n    }\n\n    // ---- interface ----\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue(): TRgba | null {\n        return this.colorArr[this.selectedIndex];\n    }\n\n    destroy(): void {\n        this.rootEl.remove();\n        this.buttonArr.forEach((item) => {\n            BB.destroyEl(item.el);\n        });\n        this.buttonArr.splice(0, this.buttonArr.length);\n        this.colorInput.onchange = null;\n        this.colorInput.oninput = null;\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { css } from '../../../bb/base/base';\n\n/**\n * selectable options\n */\nexport class Options<IdType> {\n    private readonly rootEl: HTMLElement;\n    private selectedId: IdType;\n    private readonly optionArr: {\n        id: IdType;\n        el: HTMLElement;\n    }[];\n    private readonly onChange: ((id: IdType) => void) | undefined;\n\n    private getIndex(): number {\n        for (let i = 0; i < this.optionArr.length; i++) {\n            if (this.optionArr[i].id === this.selectedId) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    private update(): void {\n        for (let i = 0; i < this.optionArr.length; i++) {\n            this.optionArr[i].el.classList.toggle(\n                'kl-option-selected',\n                this.optionArr[i].id === this.selectedId,\n            );\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        optionArr: {\n            id: IdType;\n            label: string | HTMLElement | SVGElement;\n            title?: string;\n        }[];\n        initId?: IdType;\n        onChange?: (id: IdType) => void;\n        /** before the change happens, check if you allow it. true -> yes */\n        onBeforeChange?: (id: IdType) => boolean;\n        changeOnInit?: boolean; // trigger change on creation\n        isSmall?: boolean;\n        optionCss?: Partial<CSSStyleDeclaration>;\n        isColumn?: boolean; // displayed as column. default row\n        css?: Partial<CSSStyleDeclaration>;\n    }) {\n        this.rootEl = BB.el({ css: p.css });\n\n        const wrapperEl = BB.el({\n            parent: this.rootEl,\n            className: 'kl-option-wrapper',\n            css: {\n                display: 'flex',\n                flexDirection: p.isColumn ? 'column' : 'row',\n            },\n        });\n\n        if (p.onChange) {\n            this.onChange = p.onChange;\n        }\n        this.optionArr = [];\n        this.selectedId = 'initialId' in p && p.initId !== undefined ? p.initId : p.optionArr[0].id;\n\n        const createOption = (o: {\n            id: IdType;\n            label: string | HTMLElement | SVGElement;\n            title?: string;\n        }) => {\n            const classArr = ['kl-option'];\n            if (p.isSmall) {\n                classArr.push('kl-option--small');\n            }\n            if (typeof o.label !== 'string') {\n                classArr.push('kl-option--custom-el');\n                css(o.label, {\n                    display: 'block',\n                    pointerEvents: 'none',\n                });\n            }\n\n            const optionObj = {\n                id: o.id,\n                el: BB.el({\n                    parent: wrapperEl,\n                    content: o.label,\n                    className: classArr.join(' '),\n                    onClick: () => {\n                        if (this.selectedId !== optionObj.id) {\n                            if (p.onBeforeChange && !p.onBeforeChange(optionObj.id)) {\n                                return;\n                            }\n\n                            this.selectedId = optionObj.id;\n                            this.update();\n                            this.onChange && this.onChange(this.selectedId);\n                        }\n                    },\n                    css: p.optionCss,\n                }),\n            };\n\n            if (o.title) {\n                optionObj.el.title = o.title;\n            }\n\n            this.optionArr.push(optionObj);\n        };\n\n        for (let i = 0; i < p.optionArr.length; i++) {\n            createOption(p.optionArr[i]);\n        }\n\n        this.update();\n\n        if (p.changeOnInit) {\n            setTimeout(() => {\n                this.onChange && this.onChange(this.selectedId);\n            }, 0);\n        }\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue(): IdType {\n        return this.selectedId;\n    }\n\n    next(): void {\n        this.selectedId = this.optionArr[(this.getIndex() + 1) % this.optionArr.length].id;\n        this.update();\n        this.onChange && this.onChange(this.selectedId);\n    }\n\n    setValue(val: IdType, skipEmit?: boolean): void {\n        if (this.selectedId === val) {\n            return;\n        }\n        this.selectedId = val;\n        this.update();\n        !skipEmit && this.onChange && this.onChange(this.selectedId);\n    }\n\n    previous(): void {\n        this.selectedId =\n            this.optionArr[\n                (this.optionArr.length + this.getIndex() - 1) % this.optionArr.length\n            ].id;\n        this.update();\n        this.onChange && this.onChange(this.selectedId);\n    }\n\n    destroy(): void {\n        this.rootEl.remove();\n        this.optionArr.forEach((item) => {\n            BB.destroyEl(item.el);\n        });\n        this.optionArr.splice(0, this.optionArr.length);\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport angleSvg from 'url:/src/app/img/ui/angle.svg';\nimport { css } from '../../../bb/base/base';\n\ntype TUiState = 'left' | 'right';\n\n/**\n * display little messages at the top of KlWorkspace\n */\nexport class StatusOverlay {\n    private readonly el: HTMLDivElement;\n    private readonly innerEl: HTMLDivElement;\n    private readonly angleIm: HTMLImageElement;\n    private readonly innerInnerEl: HTMLDivElement;\n    private isWide: boolean = false; // tool space hidden\n    private uiState: TUiState = 'right';\n\n    private timeout: ReturnType<typeof setTimeout> | undefined;\n    private timeout2: ReturnType<typeof setTimeout> | undefined;\n    private timeout3: ReturnType<typeof setTimeout> | undefined;\n\n    private updateUiState() {\n        if (this.uiState === 'left') {\n            this.el.style.left = '271px';\n        } else {\n            this.el.style.removeProperty('left');\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor() {\n        this.el = BB.el({\n            className: 'top-overlay g-root',\n            onClick: BB.handleClick,\n        });\n\n        this.updateUiState();\n\n        this.innerEl = BB.el({\n            className: 'top-overlay--inner',\n        });\n\n        this.angleIm = new Image();\n        this.angleIm.src = angleSvg;\n        css(this.angleIm, {\n            verticalAlign: 'bottom',\n            width: '20px',\n            height: '20px',\n            marginLeft: '5px',\n            borderRadius: '10px',\n        });\n\n        this.innerInnerEl = document.createElement('div');\n        this.innerInnerEl.style.display = 'inline-block';\n\n        this.innerEl.append(this.innerInnerEl, this.angleIm);\n        this.el.append(this.innerEl);\n        document.body.append(this.el);\n        this.el.style.display = 'none';\n    }\n\n    setWide(b: boolean) {\n        this.isWide = b;\n\n        if (!this.el) {\n            return;\n        }\n\n        if (this.isWide) {\n            this.el.style.width = '100%';\n            this.el.style.left = '';\n        } else {\n            this.el.style.removeProperty('width');\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\n        }\n    }\n\n    setUiState(state: TUiState) {\n        this.uiState = state;\n        this.updateUiState();\n    }\n\n    out(msg: string | { type: 'transform'; angleDeg: number; scale: number }, doPulse?: boolean) {\n        if (typeof msg === 'string') {\n            this.angleIm.style.display = 'none';\n            this.innerInnerEl.style.removeProperty('font-family');\n            this.innerInnerEl.innerHTML = msg;\n        } else {\n            if (msg.type === 'transform') {\n                this.angleIm.style.display = 'inline-block';\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\n\n                if (msg.angleDeg % 90 === 0) {\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\n                } else {\n                    this.angleIm.style.boxShadow = '';\n                }\n\n                this.innerInnerEl.style.fontFamily = 'monospace';\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + '%';\n            } else {\n                this.angleIm.style.display = 'none';\n            }\n        }\n\n        if (doPulse) {\n            this.innerEl.style.animation = '';\n            setTimeout(() => (this.innerEl.style.animation = 'topOverlayPulse 0.5s ease-out'), 20);\n            clearTimeout(this.timeout3);\n            this.timeout3 = setTimeout(() => (this.innerEl.style.animation = ''), 520);\n        }\n\n        clearTimeout(this.timeout);\n        clearTimeout(this.timeout2);\n        this.el.style.animationName = doPulse ? 'consoleInFast' : 'consoleIn';\n        this.el.style.opacity = '1';\n        this.timeout = setTimeout(() => {\n            this.el.style.opacity = '0';\n            this.el.style.animationName = 'consoleOut';\n            this.timeout2 = setTimeout(() => {\n                this.el.style.display = 'none';\n            }, 450);\n        }, 1200);\n        this.el.style.display = 'flex';\n    }\n}\n","module.exports = parcelRequire.resolve(\"angle.dbd82c6a.svg\") + \"?\" + Date.now();","import { BB } from '../../../bb/bb';\nimport { KeyListener } from '../../../bb/input/key-listener';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { TRect, TVector2D } from '../../../bb/bb-types';\nimport { Preview, TPreviewMode } from '../project-viewport/preview';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { createMatrixFromTransform } from '../../../bb/transform/create-matrix-from-transform';\nimport { clamp } from '../../../bb/math/math';\nimport { LANG } from '../../../language/language';\nimport editCropImg from 'url:/src/app/img/ui/edit-crop.svg';\nimport { EventChain } from '../../../bb/input/event-chain/event-chain';\nimport { OnePointerLimiter } from '../../../bb/input/event-chain/one-pointer-limiter';\nimport { TChainElement } from '../../../bb/input/event-chain/event-chain.types';\nimport { canvasToBlob } from '../../../bb/base/canvas';\nimport { TProjectViewportProject } from '../project-viewport/project-viewport';\nimport { css } from '../../../bb/base/base';\n\nexport type TCropCopyParams = {\n    // size of dom element\n    width: number;\n\n    // size of dom element\n    height: number;\n\n    // image to be cropped\n    canvas: HTMLImageElement | HTMLCanvasElement;\n\n    // when cropping area changes\n    onChange?: (width: number, height: number) => void;\n\n    // If true, renders cropped area as invisible image on top.\n    // You can't right-click on a canvas and copy it in Firefox.\n    enableRightClickCopy: boolean;\n\n    // initial crop rect\n    init?: TRect;\n};\n\n/**\n * element that lets you crop an image and copy it via right click\n */\nexport class CropCopy {\n    private readonly rootEl: HTMLElement;\n    private readonly eventTarget: HTMLElement;\n    private cropRect: TRect = { x: 0, y: 0, width: 0, height: 0 }; // canvas coordinates\n    private readonly croppedCanvas: HTMLCanvasElement;\n    // Element that can be right-clicked to copy. Not possible with canvas in firefox.\n    // undefined if enableRightClickCopy = false\n    private readonly croppedImageElement: undefined | HTMLImageElement;\n    private croppedBlob: Blob;\n    private croppedObjectUrl: string;\n    private readonly keyListener: KeyListener;\n    private readonly pointerListener: PointerListener;\n    private canvas: HTMLImageElement | HTMLCanvasElement;\n    private readonly onChange: undefined | ((width: number, height: number) => void);\n    private readonly selectionRectEl: HTMLElement;\n    private readonly preview: Preview;\n    private mode: TPreviewMode = 'edit';\n    private previewLayer: TProjectViewportProject['layers'][number];\n\n    private resetCrop(): void {\n        this.cropRect = {\n            x: 0,\n            y: 0,\n            width: this.canvas.width,\n            height: this.canvas.height,\n        };\n    }\n\n    private getViewportSelectionRect(): TRect {\n        const transform = this.preview.getTransform();\n        const mat = createMatrixFromTransform(transform);\n        const p = applyToPoint(mat, this.cropRect);\n        return {\n            x: p.x,\n            y: p.y,\n            width: this.cropRect.width * transform.scale,\n            height: this.cropRect.height * transform.scale,\n        };\n    }\n\n    private async updateCroppedCanvas(): Promise<void> {\n        this.croppedCanvas.width = Math.round(this.cropRect.width);\n        this.croppedCanvas.height = Math.round(this.cropRect.height);\n        const ctx = BB.ctx(this.croppedCanvas);\n        ctx.drawImage(this.canvas, Math.round(-this.cropRect.x), Math.round(-this.cropRect.y));\n\n        const blob = await canvasToBlob(this.croppedCanvas, 'image/png');\n        this.croppedBlob = blob;\n        if (this.croppedObjectUrl !== '') {\n            URL.revokeObjectURL(this.croppedObjectUrl);\n        }\n        this.croppedObjectUrl = URL.createObjectURL(blob);\n        if (this.croppedImageElement) {\n            this.croppedImageElement.src = this.croppedObjectUrl;\n        }\n        this.onChange?.(this.croppedCanvas.width, this.croppedCanvas.height);\n    }\n    private updateSelectionRect(): void {\n        const rect = this.getViewportSelectionRect();\n\n        css(this.selectionRectEl, {\n            left: rect.x + 'px',\n            top: rect.y + 'px',\n            width: rect.width + 'px',\n            height: rect.height + 'px',\n            display: this.isReset() ? 'none' : '',\n        });\n        this.onChange?.(Math.round(this.cropRect.width), Math.round(this.cropRect.height));\n    }\n\n    private isReset(): boolean {\n        return (\n            this.cropRect.x === 0 &&\n            this.cropRect.y === 0 &&\n            this.cropRect.width === this.canvas.width &&\n            this.cropRect.height === this.canvas.height\n        );\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: TCropCopyParams) {\n        this.rootEl = BB.el({\n            className: 'kl-edit-crop-preview',\n            css: {\n                position: 'relative',\n                height: p.height + 'px',\n                width: p.width + 'px',\n                overflow: 'hidden',\n            },\n        });\n        if (p.onChange) {\n            this.onChange = p.onChange;\n        }\n        this.canvas = p.canvas;\n\n        if (p.init) {\n            this.cropRect = p.init;\n        } else {\n            this.resetCrop();\n        }\n\n        const isInsideSelectionRect = (p: TVector2D): boolean => {\n            return BB.isInsideRect(p, this.getViewportSelectionRect());\n        };\n\n        this.croppedCanvas = BB.canvas();\n        this.croppedBlob = {} as Blob;\n        this.croppedObjectUrl = '';\n\n        this.eventTarget = this.croppedCanvas;\n        if (p.enableRightClickCopy) {\n            this.croppedImageElement = new Image();\n            this.eventTarget = this.croppedImageElement;\n        }\n        css(this.eventTarget, {\n            height: p.height + 'px',\n            width: p.width + 'px',\n        });\n        this.rootEl.append(this.eventTarget);\n        this.updateCroppedCanvas();\n\n        this.previewLayer = {\n            image: p.canvas,\n            opacity: 1,\n            isVisible: true,\n            mixModeStr: 'source-over',\n            hasClipping: false,\n        };\n        this.preview = new Preview({\n            width: p.width,\n            height: p.height - 2, // subtract border\n            project: {\n                width: p.canvas.width,\n                height: p.canvas.height,\n                layers: [this.previewLayer],\n            },\n            hasEditMode: true,\n            onModeChange: (mode) => {\n                this.mode = mode;\n                this.preview.getElement().style.pointerEvents = mode === 'edit' ? 'none' : '';\n                this.rootEl.title = mode === 'edit' ? LANG('crop-drag-to-crop') : '';\n            },\n            onTransformChange: () => this.updateSelectionRect(),\n            padding: 20,\n            hasBorder: false,\n            editIcon: editCropImg,\n        });\n        css(this.preview.getElement(), {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            overflow: 'hidden',\n            pointerEvents: 'none',\n        });\n        this.preview.render();\n        this.rootEl.append(this.preview.getElement());\n\n        this.selectionRectEl = BB.el({\n            parent: this.preview.getElement(),\n            className: 'kl-edit-crop-preview__sel',\n        });\n        this.updateSelectionRect();\n\n        //gen crop from viewport points\n        const genCrop = (p1: TVector2D, p2: TVector2D): TRect => {\n            const mat = createMatrixFromTransform(this.preview.getTransform());\n            const inverseMat = inverse(mat);\n            const topLeftP = {\n                x: Math.min(p1.x, p2.x),\n                y: Math.min(p1.y, p2.y),\n            };\n            const bottomRightP = {\n                x: Math.max(p1.x, p2.x),\n                y: Math.max(p1.y, p2.y),\n            };\n            const origTopLeftP = applyToPoint(inverseMat, topLeftP);\n            const origBottomRightP = applyToPoint(inverseMat, bottomRightP);\n            origTopLeftP.x = clamp(Math.floor(origTopLeftP.x), 0, this.canvas.width);\n            origTopLeftP.y = clamp(Math.floor(origTopLeftP.y), 0, this.canvas.height);\n            origBottomRightP.x = clamp(Math.ceil(origBottomRightP.x), 0, this.canvas.width);\n            origBottomRightP.y = clamp(Math.ceil(origBottomRightP.y), 0, this.canvas.height);\n            return {\n                x: origTopLeftP.x,\n                y: origTopLeftP.y,\n                width: origBottomRightP.x - origTopLeftP.x,\n                height: origBottomRightP.y - origTopLeftP.y,\n            };\n        };\n\n        let startP: TVector2D | null;\n        let startCrop: TRect | null = null;\n        let isDragging = false;\n        let didMove = false;\n        let updateCropTimeout: ReturnType<typeof setTimeout>;\n        const pointerChain = new EventChain({\n            chainArr: [new OnePointerLimiter() as TChainElement],\n        });\n        pointerChain.setChainOut((event) => {\n            if (event.type === 'pointerdown' && event.button === 'left') {\n                event.eventPreventDefault();\n                isDragging = true;\n                startP = {\n                    x: event.relX,\n                    y: event.relY,\n                };\n                if (!this.isReset() && isInsideSelectionRect(startP)) {\n                    startCrop = {\n                        x: this.cropRect.x,\n                        y: this.cropRect.y,\n                        width: this.cropRect.width,\n                        height: this.cropRect.height,\n                    };\n                } else {\n                    this.cropRect = genCrop(startP, startP);\n                }\n            } else if (event.type === 'pointermove' && event.button === 'left') {\n                event.eventPreventDefault();\n                didMove = true;\n                if (startCrop) {\n                    const transform = this.preview.getTransform();\n                    this.cropRect.x =\n                        startCrop.x + Math.round((event.relX - startP!.x) / transform.scale);\n                    this.cropRect.y =\n                        startCrop.y + Math.round((event.relY - startP!.y) / transform.scale);\n                    this.cropRect.x = BB.clamp(\n                        this.cropRect.x,\n                        0,\n                        this.canvas.width - this.cropRect.width,\n                    );\n                    this.cropRect.y = BB.clamp(\n                        this.cropRect.y,\n                        0,\n                        this.canvas.height - this.cropRect.height,\n                    );\n                } else {\n                    this.cropRect = genCrop(startP!, {\n                        x: event.relX,\n                        y: event.relY,\n                    });\n                }\n                this.updateSelectionRect();\n            } else if (event.type === 'pointerup' && startP) {\n                event.eventPreventDefault();\n                isDragging = false;\n                startCrop = null;\n                startP = null;\n                if (this.cropRect.width === 0 || this.cropRect.height === 0 || !didMove) {\n                    this.resetCrop();\n                    this.updateSelectionRect();\n                }\n                didMove = false;\n                updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 1);\n            }\n        });\n        this.pointerListener = new BB.PointerListener({\n            target: this.eventTarget,\n            fixScribble: true,\n            onWheel: (event) => {\n                this.preview.onWheel(event);\n            },\n            onPointer: (event) => {\n                if (this.mode === 'hand') {\n                    event.eventPreventDefault();\n                    this.preview.onPointer(event);\n                    return;\n                }\n                pointerChain.chainIn(event);\n            },\n            maxPointers: 2,\n        });\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr, e) => {\n                if (isDragging) {\n                    return;\n                }\n                let doUpdate = false;\n                const transform = this.preview.getTransform();\n\n                const stepSize = Math.max(1, 1 / transform.scale);\n                const shiftIsPressed = this.keyListener.isPressed('shift');\n\n                if (keyStr === 'left') {\n                    if (shiftIsPressed) {\n                        this.cropRect.width = BB.clamp(\n                            this.cropRect.width - stepSize,\n                            1,\n                            this.canvas.width - this.cropRect.x,\n                        );\n                    } else {\n                        this.cropRect.x = BB.clamp(\n                            this.cropRect.x - stepSize,\n                            0,\n                            this.canvas.width - this.cropRect.width,\n                        );\n                    }\n                    doUpdate = true;\n                }\n                if (keyStr === 'right') {\n                    if (shiftIsPressed) {\n                        this.cropRect.width = BB.clamp(\n                            this.cropRect.width + stepSize,\n                            1,\n                            this.canvas.width - this.cropRect.x,\n                        );\n                    } else {\n                        this.cropRect.x = BB.clamp(\n                            this.cropRect.x + stepSize,\n                            0,\n                            this.canvas.width - this.cropRect.width,\n                        );\n                    }\n                    doUpdate = true;\n                }\n                if (keyStr === 'up') {\n                    if (shiftIsPressed) {\n                        this.cropRect.height = BB.clamp(\n                            this.cropRect.height - stepSize,\n                            1,\n                            this.canvas.height - this.cropRect.y,\n                        );\n                    } else {\n                        this.cropRect.y = BB.clamp(\n                            this.cropRect.y - stepSize,\n                            0,\n                            this.canvas.height - this.cropRect.height,\n                        );\n                    }\n                    doUpdate = true;\n                }\n                if (keyStr === 'down') {\n                    if (shiftIsPressed) {\n                        this.cropRect.height = BB.clamp(\n                            this.cropRect.height + stepSize,\n                            1,\n                            this.canvas.height - this.cropRect.y,\n                        );\n                    } else {\n                        this.cropRect.y = BB.clamp(\n                            this.cropRect.y + stepSize,\n                            0,\n                            this.canvas.height - this.cropRect.height,\n                        );\n                    }\n                    doUpdate = true;\n                }\n\n                if (doUpdate) {\n                    e.preventDefault();\n                    this.updateSelectionRect();\n                    clearTimeout(updateCropTimeout);\n                    updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 100);\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    // in input canvas coordinates\n    getCropRect(): TRect {\n        return BB.copyObj(this.cropRect);\n    }\n    getCroppedCanvas(): HTMLCanvasElement {\n        return this.croppedCanvas;\n    }\n\n    // image/png blob\n    getCroppedBlob(): Blob {\n        return this.croppedBlob;\n    }\n\n    setCanvas(canvas: HTMLCanvasElement): void {\n        this.canvas = canvas;\n        this.previewLayer.image = canvas;\n        this.updateCroppedCanvas();\n        this.preview.render();\n    }\n\n    destroy(): void {\n        if (this.croppedImageElement) {\n            this.croppedImageElement.src = '';\n        }\n        URL.revokeObjectURL(this.croppedObjectUrl);\n        this.rootEl.remove();\n        this.eventTarget.style.removeProperty('width');\n        this.eventTarget.style.removeProperty('height');\n        this.keyListener.destroy();\n        this.pointerListener.destroy();\n        this.preview.destroy();\n    }\n}\n","import { c } from '../../../bb/base/c';\nimport { ProjectViewport, TProjectViewportProject, TViewportTransform } from './project-viewport';\nimport { BB } from '../../../bb/bb';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport toolZoomInImg from 'url:/src/app/img/ui/tool-zoom-in.svg';\nimport toolZoomOutImg from 'url:/src/app/img/ui/tool-zoom-out.svg';\nimport viewportResetImg from 'url:/src/app/img/ui/viewport-reset.svg';\nimport toolHandImg from 'url:/src/app/img/ui/tool-hand.svg';\nimport editPencilImg from 'url:/src/app/img/ui/edit-pencil.svg';\nimport { EventChain } from '../../../bb/input/event-chain/event-chain';\nimport { DoubleTapper } from '../../../bb/input/event-chain/double-tapper';\nimport { TChainElement } from '../../../bb/input/event-chain/event-chain.types';\nimport * as classes from './preview.module.scss';\nimport { zoomByStep } from './utils/zoom-by-step';\nimport { PinchZoomer } from '../../../bb/input/event-chain/pinch-zoomer';\nimport { LANG } from '../../../language/language';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { createTransform } from '../../../bb/transform/create-transform';\nimport { toMetaTransform } from '../../../bb/transform/to-meta-transform';\nimport { Options } from '../components/options';\nimport { TPointerEvent, TWheelEvent } from '../../../bb/input/event.types';\nimport { createMatrixFromTransform } from '../../../bb/transform/create-matrix-from-transform';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { SelectionRenderer } from '../easel/selection-renderer';\nimport { css } from '../../../bb/base/base';\n\nexport type TPreviewMode = 'edit' | 'hand';\n\nexport type TPreviewParams = {\n    width: number;\n    height: number;\n    project: TProjectViewportProject;\n    onTransformChange?: (transform: TViewportTransform) => void;\n    hasEditMode?: boolean; // default false\n    onModeChange?: (mode: TPreviewMode) => void;\n    padding?: number; //default -> DEFAULT_PADDING\n    hasBorder?: boolean; // default true\n    editIcon?: string;\n    selection?: MultiPolygon;\n};\n\nconst DEFAULT_PADDING = 10;\n\nexport class Preview {\n    private readonly rootEl: HTMLElement;\n    private readonly project: TProjectViewportProject;\n    private viewport: ProjectViewport;\n    private readonly width: number;\n    private readonly height: number;\n    private isReset: boolean = true;\n    private readonly viewportPointerListener: PointerListener;\n    private doRender = false;\n    private readonly padding: number;\n    private animationFrameId: ReturnType<typeof requestAnimationFrame> | undefined;\n    private readonly onTransformChange: TPreviewParams['onTransformChange'] | undefined;\n    private lastEmittedTransform: TViewportTransform = {\n        x: 0,\n        y: 0,\n        scale: 0,\n        angleDeg: 0,\n    };\n    private readonly modeToggle: Options<TPreviewMode> | undefined;\n    private readonly pointerChain: EventChain;\n    private selectionRenderer: SelectionRenderer | undefined;\n\n    private renderLoop = (): void => {\n        this.animationFrameId = requestAnimationFrame(this.renderLoop);\n\n        if (this.doRender) {\n            this.doRender = false;\n            this.viewport.render();\n            const viewportTransform = this.viewport.getTransform();\n            this.selectionRenderer?.setTransform(viewportTransform);\n            if (\n                this.onTransformChange &&\n                JSON.stringify(this.lastEmittedTransform) !== JSON.stringify(viewportTransform)\n            ) {\n                this.onTransformChange(viewportTransform);\n                this.lastEmittedTransform = viewportTransform;\n            }\n        }\n    };\n\n    private requestRerender(): void {\n        this.doRender = true;\n    }\n\n    private resetOrZoom(x: number, y: number): void {\n        if (this.isReset) {\n            this.isReset = false;\n\n            const canvasP = applyToPoint(\n                inverse(createMatrixFromTransform(this.viewport.getTransform())),\n                { x, y },\n            );\n\n            this.viewport.setTransform(\n                createTransform({ x: this.width / 2, y: this.height / 2 }, canvasP, 1, 0),\n            );\n            this.requestRerender();\n        } else {\n            this.reset();\n        }\n    }\n\n    private reset(): void {\n        const fit = BB.fitInto(\n            this.project.width,\n            this.project.height,\n            this.width - this.padding * 2,\n            this.height - this.padding * 2,\n        );\n        const scale = fit.width / this.project.width;\n        this.viewport.setTransform(\n            createTransform(\n                { x: this.width / 2, y: this.height / 2 },\n                { x: this.project.width / 2, y: this.project.height / 2 },\n                scale,\n                0,\n            ),\n        );\n        this.isReset = true;\n        this.requestRerender();\n    }\n\n    private transformCanvas(\n        t:\n            | {\n                  type: 'translate';\n                  x: number;\n                  y: number;\n              }\n            | {\n                  type: 'rotate';\n                  cX: number;\n                  cY: number;\n                  angleDeg: number;\n              }\n            | {\n                  type: 'zoom';\n                  vX?: number;\n                  vY?: number;\n                  fac: number;\n              },\n    ): void {\n        if (t.type === 'translate') {\n            const old = this.viewport.getTransform();\n            if (t.x === 0 && t.y === 0) {\n                return;\n            }\n            this.viewport.setTransform({\n                ...old,\n                x: old.x + t.x,\n                y: old.y + t.y,\n            });\n        } else if (t.type === 'zoom') {\n            const old = this.viewport.getTransform();\n            const viewportRect = this.viewport.getElement().getBoundingClientRect();\n            t.vX = t.vX ?? viewportRect.width / 2;\n            t.vY = t.vY ?? viewportRect.height / 2;\n\n            const metaTransform = toMetaTransform(old, { x: t.vX, y: t.vY });\n            metaTransform.scale *= t.fac;\n\n            this.viewport.setTransform(\n                createTransform(\n                    metaTransform.viewportP,\n                    metaTransform.canvasP,\n                    metaTransform.scale,\n                    metaTransform.angleDeg,\n                ),\n            );\n        }\n        this.isReset = false;\n\n        this.requestRerender();\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TPreviewParams) {\n        this.width = p.width;\n        this.height = p.height;\n        this.project = p.project;\n        this.onTransformChange = p.onTransformChange;\n        this.padding = p.padding ?? DEFAULT_PADDING;\n\n        const fit = BB.fitInto(\n            this.project.width,\n            this.project.height,\n            this.width - this.padding * 2,\n            this.height - this.padding * 2,\n        );\n        const scale = fit.width / this.project.width;\n\n        this.viewport = new ProjectViewport({\n            width: this.width,\n            height: this.height,\n            transform: createTransform(\n                { x: this.width / 2, y: this.height / 2 },\n                { x: this.project.width / 2, y: this.project.height / 2 },\n                scale,\n                0,\n            ),\n            project: this.project,\n            useNativeResolution: false,\n            drawBackground: true,\n        });\n\n        const doubleTapper = new DoubleTapper({\n            onDoubleTap: (e) => {\n                const m = createMatrixFromTransform(this.viewport.getTransform());\n                const tl = applyToPoint(m, { x: 0, y: 0 });\n                const br = applyToPoint(m, { x: this.project.width, y: this.project.height });\n                const isInside = BB.isInsideRect(\n                    { x: e.relX, y: e.relY },\n                    {\n                        x: tl.x,\n                        y: tl.y,\n                        width: br.x - tl.x,\n                        height: br.y - tl.y,\n                    },\n                );\n\n                if (!this.isReset || isInside) {\n                    this.resetOrZoom(e.relX, e.relY);\n                }\n            },\n            isInstant: true,\n        });\n        let oldTransform: TViewportTransform | undefined = undefined;\n        const pinchZoomer = new PinchZoomer({\n            onPinch: (e) => {\n                if (e.type === 'move') {\n                    if (!oldTransform) {\n                        oldTransform = this.viewport.getTransform();\n                    }\n                    const metaTransform = toMetaTransform(oldTransform, {\n                        x: e.downRelX,\n                        y: e.downRelY,\n                    });\n                    metaTransform.scale *= e.scale;\n                    metaTransform.viewportP.x += e.relX - e.downRelX;\n                    metaTransform.viewportP.y += e.relY - e.downRelY;\n                    this.viewport.setTransform(\n                        createTransform(\n                            metaTransform.viewportP,\n                            metaTransform.canvasP,\n                            metaTransform.scale,\n                            metaTransform.angleDeg,\n                        ),\n                    );\n                    this.requestRerender();\n                    this.isReset = false;\n                } else if (e.type === 'end') {\n                    oldTransform = undefined;\n                }\n            },\n        });\n\n        this.pointerChain = new EventChain({\n            chainArr: [pinchZoomer as TChainElement, doubleTapper as TChainElement],\n        });\n        this.pointerChain.setChainOut((e) => {\n            if (e.button && ['left', 'middle'].includes(e.button)) {\n                // debugOut(JSON.stringify(e));\n                this.transformCanvas({\n                    type: 'translate',\n                    x: e.dX,\n                    y: e.dY,\n                });\n            }\n        });\n\n        this.viewport.getElement().classList.add(classes.viewport);\n        css(this.viewport.getElement(), {\n            userSelect: 'none',\n            touchAction: 'none',\n        });\n        this.viewport.getElement().addEventListener('touchend', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        this.viewport.getElement().addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        this.viewport.getElement().addEventListener('dragstart', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        this.viewportPointerListener = new PointerListener({\n            target: this.viewport.getElement(),\n            onPointer: (e) => {\n                this.pointerChain.chainIn(e);\n            },\n            onWheel: this.onWheel,\n            maxPointers: 2,\n        });\n        this.viewport.getElement().addEventListener('wheel', (e) => {\n            e.preventDefault();\n        });\n\n        const svgRoot = BB.createSvg({\n            elementType: 'svg',\n        });\n        css(svgRoot, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            width: '100%',\n            height: '100%',\n            pointerEvents: 'none',\n        });\n        if (p.selection) {\n            this.selectionRenderer = new SelectionRenderer({\n                transform: this.lastEmittedTransform,\n                selection: p.selection,\n                width: this.width,\n                height: this.height,\n            });\n            svgRoot.append(this.selectionRenderer.getElement());\n        }\n\n        if (p.hasEditMode) {\n            this.modeToggle = new Options<TPreviewMode>({\n                optionArr: (['edit', 'hand'] as const).map((id) => {\n                    const el = BB.el({\n                        className: 'dark-invert',\n                        css: {\n                            width: '28px',\n                            height: '28px',\n                            backgroundSize: 'contain',\n                            margin: '5px',\n                            backgroundImage: `url(${id === 'edit' ? (p.editIcon ?? editPencilImg) : toolHandImg})`,\n                            backgroundPosition: 'center',\n                            backgroundRepeat: 'no-repeat',\n                        },\n                    });\n\n                    return {\n                        id,\n                        label: el,\n                        title: id === 'edit' ? LANG('tab-edit') : LANG('tool-hand'),\n                    };\n                }),\n                initId: 'edit',\n                onChange: (val) => {\n                    p.onModeChange && p.onModeChange(val);\n                },\n            });\n        }\n\n        // pointer-events: auto - So the canvas can be ignored, while the buttons still work.\n        this.rootEl = c(\n            {\n                className: p.hasBorder === false ? undefined : classes.preview,\n                css: {\n                    position: 'relative',\n                    zIndex: '0', // prevent buttons from sitting on top of other modals\n                },\n            },\n            [\n                this.viewport.getElement(),\n                svgRoot,\n                ...(this.modeToggle\n                    ? [\n                          c(',pos-absolute,left-5,top-5,z-1,pointer-auto', [\n                              this.modeToggle.getElement(),\n                          ]),\n                      ]\n                    : []),\n                c(',pos-absolute,right-5,bottom-5,flex,flexCol,gap-5,z-1,pointer-auto', [\n                    c({\n                        tagName: 'button',\n                        title: LANG('hand-reset'),\n                        onClick: () => {\n                            this.reset();\n                        },\n                        content: `<img alt=\"reset\" height=\"20\" src=\"${viewportResetImg}\">`,\n                        noRef: true,\n                    }),\n                    c({\n                        tagName: 'button',\n                        title: LANG('zoom-in'),\n                        onClick: () => {\n                            const oldScale = this.viewport.getTransform().scale;\n                            const newScale = zoomByStep(oldScale, 1);\n                            this.transformCanvas({\n                                type: 'zoom',\n                                fac: newScale / oldScale,\n                            });\n                        },\n                        content: `<img alt=\"zoom-in\" height=\"20\" src=\"${toolZoomInImg}\">`,\n                        noRef: true,\n                    }),\n                    c({\n                        tagName: 'button',\n                        title: LANG('zoom-out'),\n                        onClick: () => {\n                            const oldScale = this.viewport.getTransform().scale;\n                            const newScale = zoomByStep(oldScale, -1);\n                            this.transformCanvas({\n                                type: 'zoom',\n                                fac: newScale / oldScale,\n                            });\n                        },\n                        content: `<img alt=\"zoom-out\" height=\"20\" src=\"${toolZoomOutImg}\">`,\n                        noRef: true,\n                    }),\n                ]),\n            ],\n        );\n        this.renderLoop();\n    }\n\n    render(): void {\n        this.requestRerender();\n    }\n\n    setTransform(transform: TViewportTransform): void {\n        this.viewport.setTransform(transform);\n        this.requestRerender();\n        this.isReset = false;\n    }\n\n    getTransform(): TViewportTransform {\n        return this.viewport.getTransform();\n    }\n\n    onPointer(event: TPointerEvent): void {\n        this.pointerChain.chainIn(event);\n    }\n\n    onWheel = (e: TWheelEvent): void => {\n        const viewportRect = this.viewport.getElement().getBoundingClientRect();\n        const vX = e.pageX - viewportRect.x;\n        const vY = e.pageY - viewportRect.y;\n\n        const oldScale = this.viewport.getTransform().scale;\n        const newScale = zoomByStep(oldScale, -e.deltaY / 2);\n\n        this.transformCanvas({\n            type: 'zoom',\n            vX,\n            vY,\n            fac: newScale / oldScale,\n        });\n    };\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy(): void {\n        this.animationFrameId !== undefined && cancelAnimationFrame(this.animationFrameId);\n        this.viewport.destroy();\n        this.viewportPointerListener.destroy();\n        this.rootEl.remove();\n        this.modeToggle && this.modeToggle.destroy();\n        this.selectionRenderer?.destroy();\n    }\n}\n","import { TMixMode } from '../../kl-types';\nimport { BB } from '../../../bb/bb';\nimport { css, throwIfNull } from '../../../bb/base/base';\nimport { THEME } from '../../../theme/theme';\nimport { Matrix, inverse, compose } from 'transformation-matrix';\nimport { createMatrixFromTransform } from '../../../bb/transform/create-matrix-from-transform';\nimport { matrixToTuple } from '../../../bb/math/matrix-to-tuple';\nimport { DEBUG_RENDERER_ENABLED, DEBUG_RENDER } from './debug-render';\n\nfunction fixScale(scale: number, pixels: number): number {\n    return Math.round(pixels * scale) / pixels;\n}\n\n// width, height - viewport size\nexport type TProjectViewportLayerFunc = (\n    viewportTransform: TViewportTransformXY,\n    viewportWidth: number,\n    viewportHeight: number,\n) => CanvasImageSource | { image: CanvasImageSource; transform: Matrix }; // image drawn with ctx.setTransform(transform)\n\nexport type TProjectViewportProject = {\n    width: number;\n    height: number;\n    layers: {\n        image: CanvasImageSource | TProjectViewportLayerFunc;\n        isVisible: boolean;\n        opacity: number;\n        mixModeStr: TMixMode;\n        hasClipping: boolean;\n    }[];\n};\n\nexport type TViewportTransform = {\n    scale: number;\n    angleDeg: number;\n    x: number;\n    y: number;\n};\n\nexport type TViewportTransformXY = {\n    scaleX: number;\n    scaleY: number;\n    angleDeg: number;\n    x: number;\n    y: number;\n};\n\nexport type TProjectViewportParams = {\n    width: number;\n    height: number;\n    project: TProjectViewportProject;\n    transform: TViewportTransform;\n    drawBackground?: boolean;\n    useNativeResolution?: boolean;\n    renderAfter?: (ctx: CanvasRenderingContext2D, transform: TViewportTransformXY) => void;\n    fillParent?: boolean;\n};\n\n/**\n *\n * Scale - size of one project-canvas pixel compared to CSS pixel\n *      -> 1 means 1 pixel in the drawing is the size of a CSS pixel\n *      -> independent of device pixel ratio, or what resolution the viewport\n *          canvas may actually have.\n * Translate - translates in CSS pixels\n * Viewport origin is top left (same as canvas)\n *\n * Order of transformations (matrix multiplication is reversed): translate, rotate, scale\n */\nexport class ProjectViewport {\n    private width: number;\n    private height: number;\n    private readonly canvas: HTMLCanvasElement;\n    private readonly ctx: CanvasRenderingContext2D;\n    private transform: TViewportTransform;\n\n    private project: TProjectViewportProject;\n    private useNativeResolution: boolean;\n\n    private pattern: CanvasPattern;\n    private resFactor: number;\n    private readonly drawBackground: boolean;\n    private doResize: boolean = true;\n    private readonly doFillParent: boolean;\n    private readonly renderAfter:\n        | undefined\n        | ((ctx: CanvasRenderingContext2D, transform: TViewportTransformXY) => void);\n\n    private onIsDark = (): void => {\n        this.pattern = throwIfNull(\n            this.ctx.createPattern(BB.createCheckerCanvas(10, THEME.isDark()), 'repeat'),\n        );\n        this.render();\n    };\n\n    private oldDPR = devicePixelRatio;\n    private resizeListener = () => {\n        if (devicePixelRatio !== this.oldDPR) {\n            this.canvas.style.imageRendering =\n                Math.round(devicePixelRatio) !== devicePixelRatio ? '' : 'pixelated';\n            this.oldDPR = devicePixelRatio;\n        }\n    };\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TProjectViewportParams) {\n        this.width = p.width;\n        this.height = p.height;\n        this.project = p.project;\n        this.useNativeResolution = !!p.useNativeResolution;\n        this.drawBackground = p.drawBackground ?? true;\n        this.doFillParent = !!p.fillParent;\n        this.renderAfter = p.renderAfter;\n\n        this.transform = {\n            ...p.transform,\n        };\n\n        this.resFactor = this.useNativeResolution ? devicePixelRatio : 1;\n        this.canvas = BB.canvas(this.width * this.resFactor, this.height * this.resFactor);\n        this.ctx = BB.ctx(this.canvas);\n        css(this.canvas, {\n            width: this.doFillParent ? '100%' : this.width + 'px',\n            height: this.doFillParent ? '100%' : this.height + 'px',\n            imageRendering:\n                Math.round(devicePixelRatio) !== devicePixelRatio ? undefined : 'pixelated',\n            display: 'block',\n        });\n        window.addEventListener('resize', this.resizeListener);\n\n        this.pattern = throwIfNull(\n            this.ctx.createPattern(BB.createCheckerCanvas(10, THEME.isDark()), 'repeat'),\n        );\n        THEME.addIsDarkListener(this.onIsDark);\n\n        // this.render();\n    }\n\n    render(optimizeForAnimation?: boolean): void {\n        const isDark = THEME.isDark();\n        const transform = {\n            ...this.transform,\n            x: this.transform.x,\n            y: this.transform.y,\n            scale: this.transform.scale,\n        };\n\n        if (this.doResize) {\n            this.doResize = false;\n            this.resFactor = this.useNativeResolution ? devicePixelRatio : 1;\n            this.canvas.width = Math.round(this.width * this.resFactor);\n            this.canvas.height = Math.round(this.height * this.resFactor);\n        }\n\n        const renderedTransform: TViewportTransformXY = optimizeForAnimation\n            ? {\n                  x: transform.x,\n                  y: transform.y,\n                  angleDeg: transform.angleDeg,\n                  scaleX: transform.scale,\n                  scaleY: transform.scale,\n              }\n            : {\n                  x: Math.round(transform.x),\n                  y: Math.round(transform.y),\n                  scaleX: fixScale(transform.scale, this.project.width),\n                  scaleY: fixScale(transform.scale, this.project.height),\n                  angleDeg: transform.angleDeg,\n              };\n        const renderedMat = createMatrixFromTransform(renderedTransform);\n\n        this.ctx.save();\n\n        if (\n            renderedTransform.scaleX >= 4 ||\n            (renderedTransform.scaleX === 1 && renderedTransform.angleDeg === 0)\n        ) {\n            this.ctx.imageSmoothingEnabled = false;\n        } else {\n            this.ctx.imageSmoothingEnabled = true;\n            this.ctx.imageSmoothingQuality = 'low'; // art.scale >= 1 ? 'low' : 'medium';\n        }\n        // this.ctx.imageSmoothingEnabled = false;\n\n        if (this.drawBackground) {\n            this.ctx.fillStyle = isDark ? 'rgb(33, 33, 33)' : 'rgb(158,158,158)';\n            this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n        } else {\n            this.ctx.fillStyle = this.pattern;\n            this.ctx.fillRect(0, 0, this.width, this.height);\n        }\n\n        // this.ctx.scale(this.resFactor, this.resFactor);\n        this.ctx.translate(renderedTransform.x, renderedTransform.y);\n        this.ctx.scale(renderedTransform.scaleX, renderedTransform.scaleY);\n        this.ctx.rotate((renderedTransform.angleDeg / 180) * Math.PI);\n\n        if (this.drawBackground) {\n            this.ctx.save();\n\n            this.ctx.fillStyle = THEME.isDark() ? 'rgba(255,255,255,0.25)' : 'rgba(0,0,0,0.2)';\n            const scaledPixelX = 1 / renderedTransform.scaleX;\n            const scaledPixelY = 1 / renderedTransform.scaleY;\n            this.ctx.fillRect(\n                -scaledPixelX,\n                -scaledPixelY,\n                this.project.width + scaledPixelX * 2,\n                this.project.height + scaledPixelY * 2,\n            );\n\n            this.ctx.fillStyle = this.pattern;\n            try {\n                // setTransform got browser support since 2018-2020. catch if fails.\n                this.pattern.setTransform(inverse(renderedMat));\n            } catch (e) {\n                /* */\n            }\n            this.ctx.fillRect(0, 0, this.project.width, this.project.height);\n\n            this.ctx.restore();\n        }\n\n        this.project.layers.forEach((layer) => {\n            if (!layer.isVisible || !layer.opacity) {\n                return;\n            }\n            this.ctx.save();\n            this.ctx.globalCompositeOperation = layer.mixModeStr;\n            this.ctx.globalAlpha = layer.opacity;\n\n            let image: CanvasImageSource;\n            if (typeof layer.image === 'function') {\n                const res = layer.image(renderedTransform, this.canvas.width, this.canvas.height);\n                if ('image' in res && 'transform' in res) {\n                    image = res.image;\n                    this.ctx.setTransform(...matrixToTuple(compose(renderedMat, res.transform)));\n                } else {\n                    image = res;\n                }\n            } else {\n                image = layer.image;\n            }\n            this.ctx.drawImage(image, 0, 0); // , this.project.width, this.project.height);\n            this.ctx.restore();\n        });\n\n        this.renderAfter?.(this.ctx, renderedTransform);\n\n        DEBUG_RENDERER_ENABLED &&\n            DEBUG_RENDER.render(\n                this.ctx,\n                this.project.width,\n                this.project.height,\n                renderedTransform.scaleX,\n            );\n\n        this.ctx.restore();\n    }\n\n    setSize(width: number, height: number): void {\n        this.doResize = true;\n        this.width = width;\n        this.height = height;\n\n        css(this.canvas, {\n            width: this.doFillParent ? '100%' : this.width + 'px',\n            height: this.doFillParent ? '100%' : this.height + 'px',\n        });\n    }\n\n    setTransform(transform: TViewportTransform): void {\n        this.transform = { ...transform };\n    }\n\n    setProject(project: TProjectViewportProject): void {\n        this.project = project;\n    }\n\n    getTransform(): TViewportTransform {\n        return { ...this.transform };\n    }\n\n    setUseNativeResolution(b: boolean): void {\n        this.useNativeResolution = b;\n        this.doResize = true;\n    }\n\n    getUseNativeResolution(): boolean {\n        return this.useNativeResolution;\n    }\n\n    getElement(): HTMLElement {\n        return this.canvas;\n    }\n\n    destroy(): void {\n        BB.freeCanvas(this.canvas);\n        THEME.removeIsDarkListener(this.onIsDark);\n        window.removeEventListener('resize', this.resizeListener);\n    }\n}\n","export * from './applyToPoint'\nexport * from './fromObject'\nexport * from './fromString'\nexport * from './identity'\nexport * from './inverse'\nexport * from './isAffineMatrix'\nexport * from './rotate'\nexport * from './scale'\nexport * from './shear'\nexport * from './skew'\nexport * from './toString'\nexport * from './transform'\nexport * from './translate'\nexport * from './fromTriangles'\nexport * from './smoothMatrix'\nexport * from './fromDefinition'\nexport * from './fromTransformAttribute'\nexport * from './decompose'\nexport * from './flip'\nexport * from './fromMovingPoints'\n","/**\n * Calculate a point transformed with an affine matrix\n * @param matrix {Matrix} Affine Matrix\n * @param  point {Point} Point\n * @returns {Point} Point\n */\nexport function applyToPoint (matrix, point) {\n  return Array.isArray(point)\n    ? [\n        matrix.a * point[0] + matrix.c * point[1] + matrix.e,\n        matrix.b * point[0] + matrix.d * point[1] + matrix.f\n      ]\n    : {\n        x: matrix.a * point.x + matrix.c * point.y + matrix.e,\n        y: matrix.b * point.x + matrix.d * point.y + matrix.f\n      }\n}\n\n/**\n * Calculate an array of points transformed with an affine matrix\n * @param matrix {Matrix} Affine Matrix\n * @param points {Point[]} Array of point\n * @returns {Point[]} Array of point\n */\nexport function applyToPoints (matrix, points) {\n  return points.map(point => applyToPoint(matrix, point))\n}\n","/**\n * Extract an affine matrix from an object that contains a,b,c,d,e,f keys\n * Any value could be a float or a string that contains a float\n * @param object {Object} Object that contains a,b,c,d,e,f keys\n * @return {Matrix} Affine Matrix\n */\nexport function fromObject (object) {\n  return {\n    a: parseFloat(object.a),\n    b: parseFloat(object.b),\n    c: parseFloat(object.c),\n    d: parseFloat(object.d),\n    e: parseFloat(object.e),\n    f: parseFloat(object.f)\n  }\n}\n","/**\n * @ignore\n * @type {RegExp}\n */\nconst matrixRegex = /^matrix\\(\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*\\)$/i\n\n/**\n * Parse a string formatted as matrix(a,b,c,d,e,f)\n * @param string {string} String with an affine matrix\n * @returns {Matrix} Affine Matrix\n *\n * @example\n * > fromString('matrix(1,2,3,4,5,6)')\n * {a: 1, b: 2, c: 3, d: 4, c: 5, e: 6}\n */\nexport function fromString (string) {\n  const parseFloatOrThrow = number => {\n    const n = parseFloat(number)\n    if (Number.isFinite(n)) return n // excludes NaN, +Infinite, -Infinite\n    throw new Error(`'${string}' is not a matrix`)\n  }\n\n  const prefix = string.substring(0, 7).toLowerCase()\n  const suffix = string.substring(string.length - 1)\n  const body = string.substring(7, string.length - 1)\n  const elements = body.split(',')\n\n  if (\n    prefix === 'matrix(' &&\n    suffix === ')' &&\n    elements.length === 6\n  ) {\n    return {\n      a: parseFloatOrThrow(elements[0]),\n      b: parseFloatOrThrow(elements[1]),\n      c: parseFloatOrThrow(elements[2]),\n      d: parseFloatOrThrow(elements[3]),\n      e: parseFloatOrThrow(elements[4]),\n      f: parseFloatOrThrow(elements[5])\n    }\n  }\n\n  throw new Error(`'${string}' is not a matrix`)\n}\n\n/**\n * Parse a string formatted as matrix(a,b,c,d,e,f) - Legacy implementation of `fromString(matrix)`;\n * Read this PR for details {@link https://github.com/chrvadala/transformation-matrix/pull/107}\n * @param string {string} String with an affine matrix\n * @deprecated\n * @returns {Matrix} Affine Matrix\n *\n * @example\n * > fromStringLegacy('matrix(1,2,3,4,5,6)')\n * {a: 1, b: 2, c: 3, d: 4, c: 5, e: 6}\n */\nexport function fromStringLegacy (string) {\n  const parsed = string.match(matrixRegex)\n  if (parsed === null || parsed.length < 7) throw new Error(`'${string}' is not a matrix`)\n  return {\n    a: parseFloat(parsed[1]),\n    b: parseFloat(parsed[2]),\n    c: parseFloat(parsed[3]),\n    d: parseFloat(parsed[4]),\n    e: parseFloat(parsed[5]),\n    f: parseFloat(parsed[6])\n  }\n}\n","/**\n * Identity matrix\n * @returns {Matrix} Affine Matrix\n */\nexport function identity () {\n  return {\n    a: 1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: 1,\n    f: 0\n  }\n}\n","/**\n * Calculate a matrix that is the inverse of the provided matrix\n * @param matrix {Matrix} Affine Matrix\n * @returns {Matrix} Inverted Affine Matrix\n */\nexport function inverse (matrix) {\n  // http://www.wolframalpha.com/input/?i=Inverse+%5B%7B%7Ba,c,e%7D,%7Bb,d,f%7D,%7B0,0,1%7D%7D%5D\n\n  const { a, b, c, d, e, f } = matrix\n\n  const denom = a * d - b * c\n\n  return {\n    a: d / denom,\n    b: b / -denom,\n    c: c / -denom,\n    d: a / denom,\n    e: (d * e - c * f) / -denom,\n    f: (b * e - a * f) / denom\n  }\n}\n","import { isNumeric, isObject } from './utils'\n\n/**\n * Check if the object contain an affine matrix\n * @param object {Object} Generic Plain Object\n * @return {boolean} True if is an object and contains an affine matrix\n */\n\nexport function isAffineMatrix (object) {\n  return isObject(object) &&\n    'a' in object &&\n    isNumeric(object.a) &&\n    'b' in object &&\n    isNumeric(object.b) &&\n    'c' in object &&\n    isNumeric(object.c) &&\n    'd' in object &&\n    isNumeric(object.d) &&\n    'e' in object &&\n    isNumeric(object.e) &&\n    'f' in object &&\n    isNumeric(object.f)\n}\n","export function isUndefined (val) {\n  return typeof val === 'undefined'\n}\n\nexport function isNumeric (n) {\n  return typeof n === 'number' &&\n    !Number.isNaN(n) &&\n    Number.isFinite(n)\n}\n\nexport function isObject (obj) {\n  return typeof obj === 'object' &&\n    obj !== null &&\n    !Array.isArray(obj)\n}\n\nexport function matchesShape (obj, keys) {\n  return keys.every(key => key in obj)\n}\n","import { isUndefined } from './utils'\nimport { translate } from './translate'\nimport { transform } from './transform'\n\nconst { cos, sin, PI } = Math\n/**\n * Calculate a rotation matrix\n * @param angle {number} Angle in radians\n * @param [cx] {number} If (cx,cy) are supplied the rotate is about this point\n * @param [cy] {number} If (cx,cy) are supplied the rotate is about this point\n * @returns {Matrix} Affine Matrix\n */\nexport function rotate (angle, cx, cy) {\n  const cosAngle = cos(angle)\n  const sinAngle = sin(angle)\n  const rotationMatrix = {\n    a: cosAngle,\n    c: -sinAngle,\n    e: 0,\n    b: sinAngle,\n    d: cosAngle,\n    f: 0\n  }\n  if (isUndefined(cx) || isUndefined(cy)) {\n    return rotationMatrix\n  }\n\n  return transform([\n    translate(cx, cy),\n    rotationMatrix,\n    translate(-cx, -cy)\n  ])\n}\n\n/**\n * Calculate a rotation matrix with a DEG angle\n * @param angle {number} Angle in degree\n * @param [cx] {number} If (cx,cy) are supplied the rotate is about this point\n * @param [cy] {number} If (cx,cy) are supplied the rotate is about this point\n * @returns {Matrix} Affine Matrix\n */\nexport function rotateDEG (angle, cx = undefined, cy = undefined) {\n  return rotate(angle * PI / 180, cx, cy)\n}\n","/**\n * Calculate a translate matrix\n * @param tx {number} Translation on axis x\n * @param [ty = 0] {number} Translation on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function translate (tx, ty = 0) {\n  return {\n    a: 1,\n    c: 0,\n    e: tx,\n    b: 0,\n    d: 1,\n    f: ty\n  }\n}\n","/**\n * Merge multiple matrices into one\n * @param matrices {...Matrix | Matrix[]} Matrices listed as separate parameters or in an array\n * @returns {Matrix} Affine Matrix\n */\nexport function transform (...matrices) {\n  matrices = Array.isArray(matrices[0]) ? matrices[0] : matrices\n\n  const multiply = (m1, m2) => {\n    return {\n      a: m1.a * m2.a + m1.c * m2.b,\n      c: m1.a * m2.c + m1.c * m2.d,\n      e: m1.a * m2.e + m1.c * m2.f + m1.e,\n      b: m1.b * m2.a + m1.d * m2.b,\n      d: m1.b * m2.c + m1.d * m2.d,\n      f: m1.b * m2.e + m1.d * m2.f + m1.f\n    }\n  }\n\n  switch (matrices.length) {\n    case 0:\n      throw new Error('no matrices provided')\n\n    case 1:\n      return matrices[0]\n\n    case 2:\n      return multiply(matrices[0], matrices[1])\n\n    default: {\n      const [m1, m2, ...rest] = matrices\n      const m = multiply(m1, m2)\n      return transform(m, ...rest)\n    }\n  }\n}\n\n/**\n * Merge multiple matrices into one\n * @param matrices {...Matrix | Matrix[]} Matrices listed as separate parameters or in an array\n * @returns {Matrix} Affine Matrix\n */\nexport function compose (...matrices) {\n  return transform(...matrices)\n}\n","import { isUndefined } from './utils'\nimport { translate } from './translate'\nimport { transform } from './transform'\n\n/**\n * Calculate a scaling matrix\n * @param sx {number} Scaling on axis x\n * @param [sy = sx] {number} Scaling on axis y (default sx)\n * @param [cx] {number} If (cx,cy) are supplied the scaling is about this point\n * @param [cy] {number} If (cx,cy) are supplied the scaling is about this point\n * @returns {Matrix} Affine Matrix\n */\nexport function scale (sx, sy = undefined, cx = undefined, cy = undefined) {\n  if (isUndefined(sy)) sy = sx\n\n  const scaleMatrix = {\n    a: sx,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: sy,\n    f: 0\n  }\n\n  if (isUndefined(cx) || isUndefined(cy)) {\n    return scaleMatrix\n  }\n\n  return transform([\n    translate(cx, cy),\n    scaleMatrix,\n    translate(-cx, -cy)\n  ])\n}\n","/**\n * Calculate a shear matrix\n * @param shx {number} Shear on axis x\n * @param shy {number} Shear on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function shear (shx, shy) {\n  return {\n    a: 1,\n    c: shx,\n    e: 0,\n    b: shy,\n    d: 1,\n    f: 0\n  }\n}\n","// https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/skew\nconst { tan } = Math\n\n/**\n * Calculate a skew matrix\n * @param ax {number} Skew on axis x\n * @param ay {number} Skew on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function skew (ax, ay) {\n  return {\n    a: 1,\n    c: tan(ax),\n    e: 0,\n    b: tan(ay),\n    d: 1,\n    f: 0\n  }\n}\n\n/**\n * Calculate a skew matrix using DEG angles\n * @param ax {number} Skew on axis x\n * @param ay {number} Skew on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function skewDEG (ax, ay) {\n  return skew(ax * Math.PI / 180, ay * Math.PI / 180)\n}\n","/**\n * Serialize an affine matrix to a string that can be used with CSS or SVG\n * @param matrix {Matrix} Affine Matrix\n * @returns {string} String that contains an affine matrix formatted as matrix(a,b,c,d,e,f)\n */\nexport function toCSS (matrix) {\n  return toString(matrix)\n}\n\n/**\n * Serialize an affine matrix to a string that can be used with CSS or SVG\n * @param matrix {Matrix} Affine Matrix\n * @returns {string} String that contains an affine matrix formatted as matrix(a,b,c,d,e,f)\n */\nexport function toSVG (matrix) {\n  return toString(matrix)\n}\n\n/**\n * Serialize an affine matrix to a string that can be used with CSS or SVG\n * @param matrix {Matrix} Affine Matrix\n * @returns {string} String that contains an affine matrix formatted as matrix(a,b,c,d,e,f)\n */\nexport function toString (matrix) {\n  return `matrix(${matrix.a},${matrix.b},${matrix.c},${matrix.d},${matrix.e},${matrix.f})`\n}\n","import { inverse } from './inverse'\nimport { transform } from './transform'\nimport { smoothMatrix } from './smoothMatrix'\n\n/**\n * Returns a matrix that transforms a triangle t1 into another triangle t2, or throws an exception if it is impossible.\n * @param t1 {Point[]} Array of points containing the three points for the first triangle\n * @param t2 {Point[]} Array of points containing the three points for the second triangle\n * @returns {Matrix} Matrix which transforms t1 to t2\n * @throws Exception if the matrix becomes not invertible\n */\nexport function fromTriangles (t1, t2) {\n  // point p = first point of the triangle\n  const px1 = t1[0].x != null ? t1[0].x : t1[0][0]\n  const py1 = t1[0].y != null ? t1[0].y : t1[0][1]\n  const px2 = t2[0].x != null ? t2[0].x : t2[0][0]\n  const py2 = t2[0].y != null ? t2[0].y : t2[0][1]\n\n  // point q = second point of the triangle\n  const qx1 = t1[1].x != null ? t1[1].x : t1[1][0]\n  const qy1 = t1[1].y != null ? t1[1].y : t1[1][1]\n  const qx2 = t2[1].x != null ? t2[1].x : t2[1][0]\n  const qy2 = t2[1].y != null ? t2[1].y : t2[1][1]\n\n  // point r = third point of the triangle\n  const rx1 = t1[2].x != null ? t1[2].x : t1[2][0]\n  const ry1 = t1[2].y != null ? t1[2].y : t1[2][1]\n  const rx2 = t2[2].x != null ? t2[2].x : t2[2][0]\n  const ry2 = t2[2].y != null ? t2[2].y : t2[2][1]\n\n  const r1 = {\n    a: px1 - rx1,\n    b: py1 - ry1,\n    c: qx1 - rx1,\n    d: qy1 - ry1,\n    e: rx1,\n    f: ry1\n  }\n  const r2 = {\n    a: px2 - rx2,\n    b: py2 - ry2,\n    c: qx2 - rx2,\n    d: qy2 - ry2,\n    e: rx2,\n    f: ry2\n  }\n\n  const inverseR1 = inverse(r1)\n  const affineMatrix = transform([r2, inverseR1])\n\n  // round the matrix elements to smooth the finite inversion\n  return smoothMatrix(affineMatrix)\n}\n","/**\n * Rounds all elements of the given matrix using the given precision\n * @param matrix {Matrix} An affine matrix to round\n * @param [precision] {number} A precision to use for Math.round. Defaults to 10000000000 (meaning which rounds to the 10th digit after the comma).\n * @returns {Matrix} The rounded Affine Matrix\n */\nexport function smoothMatrix (matrix, precision = 10000000000) {\n  return {\n    a: Math.round(matrix.a * precision) / precision,\n    b: Math.round(matrix.b * precision) / precision,\n    c: Math.round(matrix.c * precision) / precision,\n    d: Math.round(matrix.d * precision) / precision,\n    e: Math.round(matrix.e * precision) / precision,\n    f: Math.round(matrix.f * precision) / precision\n  }\n}\n","import { fromObject } from './fromObject'\nimport { translate } from './translate'\nimport { scale } from './scale'\nimport { rotateDEG } from './rotate'\nimport { skewDEG } from './skew'\nimport { shear } from './shear'\n\n/**\n * Converts array of matrix descriptor to array of matrix\n * @param definitionOrArrayOfDefinition {Object[]} Array of object describing the matrix\n * @returns {Matrix[]} Array of matrix\n *\n * @example\n * > fromDefinition([\n *  { type: 'matrix', a:1, b:2, c:3, d:4, e:5, f:6 },\n *  { type: 'translate', tx: 10, ty: 20 },\n *  { type: 'scale', sx: 2, sy: 4 },\n *  { type: 'rotate', angle: 90, cx: 50, cy: 25 },\n *  { type: 'skewX', angle: 45 },\n *  { type: 'skewY',  angle: 45 },\n *  { type: 'shear', shx: 10, shy: 20}\n * ])\n *\n * [\n *  { a: 1, b: 2, c: 3, d: 4, e: 5, f: 6 },\n *  { a: 1, c: 0, e: 10, b: 0, d: 1, f: 20 },\n *  { a: 2, c: 0, e: 0, b: 0, d: 4, f: 0 },\n *  { a: 6.123, c: -1, e: 0, b: 1, d: 6.123, f: 0 },\n *  { a: 1, c: 0.99.., e: 0, b: 0, d: 1, f: 0 },\n *  { a: 1, c: 0, e: 0, b: 0.99, d: 1, f: 0 },\n *  { a: 1, c: 10, e: 0, b: 20, d: 1, f: 0 }\n * ]\n **/\nexport function fromDefinition (definitionOrArrayOfDefinition) {\n  return Array.isArray(definitionOrArrayOfDefinition)\n    ? definitionOrArrayOfDefinition.map(mapper)\n    : mapper(definitionOrArrayOfDefinition)\n\n  function mapper (descriptor) {\n    switch (descriptor.type) {\n      case 'matrix':\n        if ('a' in descriptor &&\n          'b' in descriptor &&\n          'c' in descriptor &&\n          'd' in descriptor &&\n          'e' in descriptor &&\n          'f' in descriptor\n        ) {\n          return fromObject(descriptor)\n        } else {\n          throw new Error('MISSING_MANDATORY_PARAM')\n        }\n\n      case 'translate':\n        if (!('tx' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n\n        if ('ty' in descriptor) return translate(descriptor.tx, descriptor.ty)\n\n        return translate(descriptor.tx)\n\n      case 'scale':\n        if (!('sx' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n\n        if ('sy' in descriptor) return scale(descriptor.sx, descriptor.sy)\n\n        return scale(descriptor.sx)\n\n      case 'rotate':\n        if (!('angle' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n\n        if ('cx' in descriptor && 'cy' in descriptor) {\n          return rotateDEG(descriptor.angle, descriptor.cx, descriptor.cy)\n        }\n        return rotateDEG(descriptor.angle)\n\n      case 'skewX':\n        if (!('angle' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n        return skewDEG(descriptor.angle, 0)\n\n      case 'skewY':\n        if (!('angle' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n        return skewDEG(0, descriptor.angle)\n\n      case 'shear':\n        if (!('shx' in descriptor && 'shy' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n        return shear(descriptor.shx, descriptor.shy)\n\n      default:\n        throw new Error('UNSUPPORTED_DESCRIPTOR')\n    }\n  }\n}\n","import { parse } from './fromTransformAttribute.autogenerated'\n\n/**\n * Parser for SVG Trasform Attribute http://www.w3.org/TR/SVG/coords.html#TransformAttribute\n * @param transformString {string} Transform string as defined by w3 Consortium\n * @returns {MatrixDescriptor[]} Array of MatrixDescriptor\n *\n * @example\n * > fromTransformAttribute('translate(-10,-10) scale(2,2) translate(10,10)')\n * [\n *  { type: 'translate', tx: -10, ty: -10},\n *  { type: 'scale', sx: 2, sy: 2 },\n *  { type: 'translate', tx: 10, ty: 10}\n * ]\n *\n * > compose(fromDefinition(fromTransformAttribute('translate(-10, -10) scale(10, 10)')))\n * { a: 10, c: 0, e: -10, b: 0, d: 10, f: -10 }\n */\nexport function fromTransformAttribute (transformString) {\n  return parse(transformString)\n}\n","// @generated by Peggy 5.0.6.\n//\n// https://peggyjs.org/\n\n\nclass peg$SyntaxError extends SyntaxError {\n  constructor(message, expected, found, location) {\n    super(message);\n    this.expected = expected;\n    this.found = found;\n    this.location = location;\n    this.name = \"SyntaxError\";\n  }\n\n  format(sources) {\n    let str = \"Error: \" + this.message;\n    if (this.location) {\n      let src = null;\n      const st = sources.find(s => s.source === this.location.source);\n      if (st) {\n        src = st.text.split(/\\r\\n|\\n|\\r/g);\n      }\n      const s = this.location.start;\n      const offset_s = (this.location.source && (typeof this.location.source.offset === \"function\"))\n        ? this.location.source.offset(s)\n        : s;\n      const loc = this.location.source + \":\" + offset_s.line + \":\" + offset_s.column;\n      if (src) {\n        const e = this.location.end;\n        const filler = \"\".padEnd(offset_s.line.toString().length, \" \");\n        const line = src[s.line - 1];\n        const last = s.line === e.line ? e.column : line.length + 1;\n        const hatLen = (last - s.column) || 1;\n        str += \"\\n --> \" + loc + \"\\n\"\n            + filler + \" |\\n\"\n            + offset_s.line + \" | \" + line + \"\\n\"\n            + filler + \" | \" + \"\".padEnd(s.column - 1, \" \")\n            + \"\".padEnd(hatLen, \"^\");\n      } else {\n        str += \"\\n at \" + loc;\n      }\n    }\n    return str;\n  }\n\n  static buildMessage(expected, found) {\n    function hex(ch) {\n      return ch.codePointAt(0).toString(16).toUpperCase();\n    }\n\n    const nonPrintable = Object.prototype.hasOwnProperty.call(RegExp.prototype, \"unicode\")\n      ? new RegExp(\"[\\\\p{C}\\\\p{Mn}\\\\p{Mc}]\", \"gu\")\n      : null;\n    function unicodeEscape(s) {\n      if (nonPrintable) {\n        return s.replace(nonPrintable,  ch => \"\\\\u{\" + hex(ch) + \"}\");\n      }\n      return s;\n    }\n\n    function literalEscape(s) {\n      return unicodeEscape(s\n        .replace(/\\\\/g, \"\\\\\\\\\")\n        .replace(/\"/g,  \"\\\\\\\"\")\n        .replace(/\\0/g, \"\\\\0\")\n        .replace(/\\t/g, \"\\\\t\")\n        .replace(/\\n/g, \"\\\\n\")\n        .replace(/\\r/g, \"\\\\r\")\n        .replace(/[\\x00-\\x0F]/g,          ch => \"\\\\x0\" + hex(ch))\n        .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, ch => \"\\\\x\"  + hex(ch)));\n    }\n\n    function classEscape(s) {\n      return unicodeEscape(s\n        .replace(/\\\\/g, \"\\\\\\\\\")\n        .replace(/\\]/g, \"\\\\]\")\n        .replace(/\\^/g, \"\\\\^\")\n        .replace(/-/g,  \"\\\\-\")\n        .replace(/\\0/g, \"\\\\0\")\n        .replace(/\\t/g, \"\\\\t\")\n        .replace(/\\n/g, \"\\\\n\")\n        .replace(/\\r/g, \"\\\\r\")\n        .replace(/[\\x00-\\x0F]/g,          ch => \"\\\\x0\" + hex(ch))\n        .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, ch => \"\\\\x\"  + hex(ch)));\n    }\n\n    const DESCRIBE_EXPECTATION_FNS = {\n      literal(expectation) {\n        return \"\\\"\" + literalEscape(expectation.text) + \"\\\"\";\n      },\n\n      class(expectation) {\n        const escapedParts = expectation.parts.map(\n          part => (Array.isArray(part)\n            ? classEscape(part[0]) + \"-\" + classEscape(part[1])\n            : classEscape(part))\n        );\n\n        return \"[\" + (expectation.inverted ? \"^\" : \"\") + escapedParts.join(\"\") + \"]\" + (expectation.unicode ? \"u\" : \"\");\n      },\n\n      any() {\n        return \"any character\";\n      },\n\n      end() {\n        return \"end of input\";\n      },\n\n      other(expectation) {\n        return expectation.description;\n      },\n    };\n\n    function describeExpectation(expectation) {\n      return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);\n    }\n\n    function describeExpected(expected) {\n      const descriptions = expected.map(describeExpectation);\n      descriptions.sort();\n\n      if (descriptions.length > 0) {\n        let j = 1;\n        for (let i = 1; i < descriptions.length; i++) {\n          if (descriptions[i - 1] !== descriptions[i]) {\n            descriptions[j] = descriptions[i];\n            j++;\n          }\n        }\n        descriptions.length = j;\n      }\n\n      switch (descriptions.length) {\n        case 1:\n          return descriptions[0];\n\n        case 2:\n          return descriptions[0] + \" or \" + descriptions[1];\n\n        default:\n          return descriptions.slice(0, -1).join(\", \")\n            + \", or \"\n            + descriptions[descriptions.length - 1];\n      }\n    }\n\n    function describeFound(found) {\n      return found ? \"\\\"\" + literalEscape(found) + \"\\\"\" : \"end of input\";\n    }\n\n    return \"Expected \" + describeExpected(expected) + \" but \" + describeFound(found) + \" found.\";\n  }\n}\n\nfunction peg$parse(input, options) {\n  options = options !== undefined ? options : {};\n\n  const peg$FAILED = {};\n  const peg$source = options.grammarSource;\n\n  const peg$startRuleFunctions = {\n    transformList: peg$parsetransformList,\n  };\n  let peg$startRuleFunction = peg$parsetransformList;\n\n  const peg$c0 = \"matrix\";\n  const peg$c1 = \"(\";\n  const peg$c2 = \")\";\n  const peg$c3 = \"translate\";\n  const peg$c4 = \"scale\";\n  const peg$c5 = \"rotate\";\n  const peg$c6 = \"skewX\";\n  const peg$c7 = \"skewY\";\n  const peg$c8 = \",\";\n  const peg$c9 = \".\";\n\n  const peg$r0 = /^[eE]/;\n  const peg$r1 = /^[+\\-]/;\n  const peg$r2 = /^[0-9]/;\n  const peg$r3 = /^[ \\t\\r\\n]/;\n\n  const peg$e0 = peg$literalExpectation(\"matrix\", false);\n  const peg$e1 = peg$literalExpectation(\"(\", false);\n  const peg$e2 = peg$literalExpectation(\")\", false);\n  const peg$e3 = peg$literalExpectation(\"translate\", false);\n  const peg$e4 = peg$literalExpectation(\"scale\", false);\n  const peg$e5 = peg$literalExpectation(\"rotate\", false);\n  const peg$e6 = peg$literalExpectation(\"skewX\", false);\n  const peg$e7 = peg$literalExpectation(\"skewY\", false);\n  const peg$e8 = peg$literalExpectation(\",\", false);\n  const peg$e9 = peg$otherExpectation(\"fractionalConstant\");\n  const peg$e10 = peg$literalExpectation(\".\", false);\n  const peg$e11 = peg$classExpectation([\"e\", \"E\"], false, false, false);\n  const peg$e12 = peg$classExpectation([\"+\", \"-\"], false, false, false);\n  const peg$e13 = peg$classExpectation([[\"0\", \"9\"]], false, false, false);\n  const peg$e14 = peg$classExpectation([\" \", \"\\t\", \"\\r\", \"\\n\"], false, false, false);\n\n  function peg$f0(ts) {    return ts;  }\n  function peg$f1(t, ts) {    return t.concat(ts)  }\n  function peg$f2(a, b, c, d, e, f) {\n    return [{type: 'matrix', a: a, b: b, c: c, d: d, e: e, f: f}];\n  }\n  function peg$f3(tx, ty) {\n    var t = {type: 'translate', tx: tx};\n    if (ty) t.ty = ty;\n    return [t];\n  }\n  function peg$f4(sx, sy) {\n    var s = {type:'scale', sx: sx};\n    if (sy) s.sy = sy;\n    return [s];\n  }\n  function peg$f5(angle, c) {\n    var r = {type:'rotate', angle: angle};\n    if (c) {\n      r.cx = c[0];\n      r.cy = c[1];\n    }\n    return [r];\n  }\n  function peg$f6(angle) {\n    return [{type: 'skewX', angle: angle}];\n  }\n  function peg$f7(angle) {\n    return [{type: 'skewY', angle: angle}];\n  }\n  function peg$f8(f) {    return parseFloat(f.join(\"\"));  }\n  function peg$f9(i) {    return parseInt(i.join(\"\"));  }\n  function peg$f10(n) {    return n;  }\n  function peg$f11(n1, n2) {    return [n1, n2];  }\n  function peg$f12(ds) {    return ds.join(\"\");  }\n  function peg$f13(f, e) {    return [f, e || null].join(\"\")  }\n  function peg$f14(d, e) {    return [d, e].join(\"\")  }\n  function peg$f15(d1, d2) {    return [d1 ? d1.join(\"\") : null, \".\", d2.join(\"\")].join(\"\");  }\n  function peg$f16(d) {    return d.join(\"\");  }\n  function peg$f17(s, d) {    return ['e', s, d.join(\"\")].join(\"\")  }\n  let peg$currPos = options.peg$currPos | 0;\n  let peg$savedPos = peg$currPos;\n  const peg$posDetailsCache = [{ line: 1, column: 1 }];\n  let peg$maxFailPos = peg$currPos;\n  let peg$maxFailExpected = options.peg$maxFailExpected || [];\n  let peg$silentFails = options.peg$silentFails | 0;\n\n  let peg$result;\n\n  if (options.startRule) {\n    if (!(options.startRule in peg$startRuleFunctions)) {\n      throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n    }\n\n    peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n  }\n\n  function text() {\n    return input.substring(peg$savedPos, peg$currPos);\n  }\n\n  function offset() {\n    return peg$savedPos;\n  }\n\n  function range() {\n    return {\n      source: peg$source,\n      start: peg$savedPos,\n      end: peg$currPos,\n    };\n  }\n\n  function location() {\n    return peg$computeLocation(peg$savedPos, peg$currPos);\n  }\n\n  function expected(description, location) {\n    location = location !== undefined\n      ? location\n      : peg$computeLocation(peg$savedPos, peg$currPos);\n\n    throw peg$buildStructuredError(\n      [peg$otherExpectation(description)],\n      input.substring(peg$savedPos, peg$currPos),\n      location\n    );\n  }\n\n  function error(message, location) {\n    location = location !== undefined\n      ? location\n      : peg$computeLocation(peg$savedPos, peg$currPos);\n\n    throw peg$buildSimpleError(message, location);\n  }\n\n  function peg$getUnicode(pos = peg$currPos) {\n    const cp = input.codePointAt(pos);\n    if (cp === undefined) {\n      return \"\";\n    }\n    return String.fromCodePoint(cp);\n  }\n\n  function peg$literalExpectation(text, ignoreCase) {\n    return { type: \"literal\", text, ignoreCase };\n  }\n\n  function peg$classExpectation(parts, inverted, ignoreCase, unicode) {\n    return { type: \"class\", parts, inverted, ignoreCase, unicode };\n  }\n\n  function peg$anyExpectation() {\n    return { type: \"any\" };\n  }\n\n  function peg$endExpectation() {\n    return { type: \"end\" };\n  }\n\n  function peg$otherExpectation(description) {\n    return { type: \"other\", description };\n  }\n\n  function peg$computePosDetails(pos) {\n    let details = peg$posDetailsCache[pos];\n    let p;\n\n    if (details) {\n      return details;\n    } else {\n      if (pos >= peg$posDetailsCache.length) {\n        p = peg$posDetailsCache.length - 1;\n      } else {\n        p = pos;\n        while (!peg$posDetailsCache[--p]) {}\n      }\n\n      details = peg$posDetailsCache[p];\n      details = {\n        line: details.line,\n        column: details.column,\n      };\n\n      while (p < pos) {\n        if (input.charCodeAt(p) === 10) {\n          details.line++;\n          details.column = 1;\n        } else {\n          details.column++;\n        }\n\n        p++;\n      }\n\n      peg$posDetailsCache[pos] = details;\n\n      return details;\n    }\n  }\n\n  function peg$computeLocation(startPos, endPos, offset) {\n    const startPosDetails = peg$computePosDetails(startPos);\n    const endPosDetails = peg$computePosDetails(endPos);\n\n    const res = {\n      source: peg$source,\n      start: {\n        offset: startPos,\n        line: startPosDetails.line,\n        column: startPosDetails.column,\n      },\n      end: {\n        offset: endPos,\n        line: endPosDetails.line,\n        column: endPosDetails.column,\n      },\n    };\n    if (offset && peg$source && (typeof peg$source.offset === \"function\")) {\n      res.start = peg$source.offset(res.start);\n      res.end = peg$source.offset(res.end);\n    }\n    return res;\n  }\n\n  function peg$fail(expected) {\n    if (peg$currPos < peg$maxFailPos) { return; }\n\n    if (peg$currPos > peg$maxFailPos) {\n      peg$maxFailPos = peg$currPos;\n      peg$maxFailExpected = [];\n    }\n\n    peg$maxFailExpected.push(expected);\n  }\n\n  function peg$buildSimpleError(message, location) {\n    return new peg$SyntaxError(message, null, null, location);\n  }\n\n  function peg$buildStructuredError(expected, found, location) {\n    return new peg$SyntaxError(\n      peg$SyntaxError.buildMessage(expected, found),\n      expected,\n      found,\n      location\n    );\n  }\n\n  function peg$parsetransformList() {\n    let s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = peg$parsewsp();\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      s2 = peg$parsewsp();\n    }\n    s2 = peg$parsetransforms();\n    if (s2 === peg$FAILED) {\n      s2 = null;\n    }\n    s3 = [];\n    s4 = peg$parsewsp();\n    while (s4 !== peg$FAILED) {\n      s3.push(s4);\n      s4 = peg$parsewsp();\n    }\n    peg$savedPos = s0;\n    s0 = peg$f0(s2);\n\n    return s0;\n  }\n\n  function peg$parsetransforms() {\n    let s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$parsetransform();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsecommaWsp();\n      if (s3 !== peg$FAILED) {\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          s3 = peg$parsecommaWsp();\n        }\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsetransforms();\n        if (s3 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f1(s1, s3);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$parsetransform();\n    }\n\n    return s0;\n  }\n\n  function peg$parsetransform() {\n    let s0;\n\n    s0 = peg$parsematrix();\n    if (s0 === peg$FAILED) {\n      s0 = peg$parsetranslate();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parsescale();\n        if (s0 === peg$FAILED) {\n          s0 = peg$parserotate();\n          if (s0 === peg$FAILED) {\n            s0 = peg$parseskewX();\n            if (s0 === peg$FAILED) {\n              s0 = peg$parseskewY();\n            }\n          }\n        }\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsematrix() {\n    let s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11, s12, s13, s14, s15, s16, s17;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 6) === peg$c0) {\n      s1 = peg$c0;\n      peg$currPos += 6;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e0); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWsp();\n          if (s6 !== peg$FAILED) {\n            s7 = peg$parsenumber();\n            if (s7 !== peg$FAILED) {\n              s8 = peg$parsecommaWsp();\n              if (s8 !== peg$FAILED) {\n                s9 = peg$parsenumber();\n                if (s9 !== peg$FAILED) {\n                  s10 = peg$parsecommaWsp();\n                  if (s10 !== peg$FAILED) {\n                    s11 = peg$parsenumber();\n                    if (s11 !== peg$FAILED) {\n                      s12 = peg$parsecommaWsp();\n                      if (s12 !== peg$FAILED) {\n                        s13 = peg$parsenumber();\n                        if (s13 !== peg$FAILED) {\n                          s14 = peg$parsecommaWsp();\n                          if (s14 !== peg$FAILED) {\n                            s15 = peg$parsenumber();\n                            if (s15 !== peg$FAILED) {\n                              s16 = [];\n                              s17 = peg$parsewsp();\n                              while (s17 !== peg$FAILED) {\n                                s16.push(s17);\n                                s17 = peg$parsewsp();\n                              }\n                              if (input.charCodeAt(peg$currPos) === 41) {\n                                s17 = peg$c2;\n                                peg$currPos++;\n                              } else {\n                                s17 = peg$FAILED;\n                                if (peg$silentFails === 0) { peg$fail(peg$e2); }\n                              }\n                              if (s17 !== peg$FAILED) {\n                                peg$savedPos = s0;\n                                s0 = peg$f2(s5, s7, s9, s11, s13, s15);\n                              } else {\n                                peg$currPos = s0;\n                                s0 = peg$FAILED;\n                              }\n                            } else {\n                              peg$currPos = s0;\n                              s0 = peg$FAILED;\n                            }\n                          } else {\n                            peg$currPos = s0;\n                            s0 = peg$FAILED;\n                          }\n                        } else {\n                          peg$currPos = s0;\n                          s0 = peg$FAILED;\n                        }\n                      } else {\n                        peg$currPos = s0;\n                        s0 = peg$FAILED;\n                      }\n                    } else {\n                      peg$currPos = s0;\n                      s0 = peg$FAILED;\n                    }\n                  } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                  }\n                } else {\n                  peg$currPos = s0;\n                  s0 = peg$FAILED;\n                }\n              } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsetranslate() {\n    let s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 9) === peg$c3) {\n      s1 = peg$c3;\n      peg$currPos += 9;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e3); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWspNumber();\n          if (s6 === peg$FAILED) {\n            s6 = null;\n          }\n          s7 = [];\n          s8 = peg$parsewsp();\n          while (s8 !== peg$FAILED) {\n            s7.push(s8);\n            s8 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s8 = peg$c2;\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s8 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f3(s5, s6);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsescale() {\n    let s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 5) === peg$c4) {\n      s1 = peg$c4;\n      peg$currPos += 5;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e4); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWspNumber();\n          if (s6 === peg$FAILED) {\n            s6 = null;\n          }\n          s7 = [];\n          s8 = peg$parsewsp();\n          while (s8 !== peg$FAILED) {\n            s7.push(s8);\n            s8 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s8 = peg$c2;\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s8 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f4(s5, s6);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parserotate() {\n    let s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 6) === peg$c5) {\n      s1 = peg$c5;\n      peg$currPos += 6;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e5); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWspTwoNumbers();\n          if (s6 === peg$FAILED) {\n            s6 = null;\n          }\n          s7 = [];\n          s8 = peg$parsewsp();\n          while (s8 !== peg$FAILED) {\n            s7.push(s8);\n            s8 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s8 = peg$c2;\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s8 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f5(s5, s6);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseskewX() {\n    let s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 5) === peg$c6) {\n      s1 = peg$c6;\n      peg$currPos += 5;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e6); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = [];\n          s7 = peg$parsewsp();\n          while (s7 !== peg$FAILED) {\n            s6.push(s7);\n            s7 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s7 = peg$c2;\n            peg$currPos++;\n          } else {\n            s7 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s7 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f6(s5);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseskewY() {\n    let s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 5) === peg$c7) {\n      s1 = peg$c7;\n      peg$currPos += 5;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e7); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = [];\n          s7 = peg$parsewsp();\n          while (s7 !== peg$FAILED) {\n            s6.push(s7);\n            s7 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s7 = peg$c2;\n            peg$currPos++;\n          } else {\n            s7 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s7 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f7(s5);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsenumber() {\n    let s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = peg$parsesign();\n    if (s2 === peg$FAILED) {\n      s2 = null;\n    }\n    s3 = peg$parsefloatingPointConstant();\n    if (s3 !== peg$FAILED) {\n      s2 = [s2, s3];\n      s1 = s2;\n    } else {\n      peg$currPos = s1;\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f8(s1);\n    }\n    s0 = s1;\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$currPos;\n      s2 = peg$parsesign();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      s3 = peg$parseintegerConstant();\n      if (s3 !== peg$FAILED) {\n        s2 = [s2, s3];\n        s1 = s2;\n      } else {\n        peg$currPos = s1;\n        s1 = peg$FAILED;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$f9(s1);\n      }\n      s0 = s1;\n    }\n\n    return s0;\n  }\n\n  function peg$parsecommaWspNumber() {\n    let s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = peg$parsecommaWsp();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsenumber();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f10(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsecommaWspTwoNumbers() {\n    let s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = peg$parsecommaWsp();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsenumber();\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsecommaWsp();\n        if (s3 !== peg$FAILED) {\n          s4 = peg$parsenumber();\n          if (s4 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f11(s2, s4);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsecommaWsp() {\n    let s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = peg$parsewsp();\n    if (s2 !== peg$FAILED) {\n      while (s2 !== peg$FAILED) {\n        s1.push(s2);\n        s2 = peg$parsewsp();\n      }\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsecomma();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      s3 = [];\n      s4 = peg$parsewsp();\n      while (s4 !== peg$FAILED) {\n        s3.push(s4);\n        s4 = peg$parsewsp();\n      }\n      s1 = [s1, s2, s3];\n      s0 = s1;\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$parsecomma();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewsp();\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          s3 = peg$parsewsp();\n        }\n        s1 = [s1, s2];\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsecomma() {\n    let s0;\n\n    if (input.charCodeAt(peg$currPos) === 44) {\n      s0 = peg$c8;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e8); }\n    }\n\n    return s0;\n  }\n\n  function peg$parseintegerConstant() {\n    let s0, s1;\n\n    s0 = peg$currPos;\n    s1 = peg$parsedigitSequence();\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f12(s1);\n    }\n    s0 = s1;\n\n    return s0;\n  }\n\n  function peg$parsefloatingPointConstant() {\n    let s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = peg$parsefractionalConstant();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseexponent();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      peg$savedPos = s0;\n      s0 = peg$f13(s1, s2);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$parsedigitSequence();\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parseexponent();\n        if (s2 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f14(s1, s2);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsefractionalConstant() {\n    let s0, s1, s2, s3;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = peg$parsedigitSequence();\n    if (s1 === peg$FAILED) {\n      s1 = null;\n    }\n    if (input.charCodeAt(peg$currPos) === 46) {\n      s2 = peg$c9;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e10); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parsedigitSequence();\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f15(s1, s3);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$parsedigitSequence();\n      if (s1 !== peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 46) {\n          s2 = peg$c9;\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e10); }\n        }\n        if (s2 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f16(s1);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e9); }\n    }\n\n    return s0;\n  }\n\n  function peg$parseexponent() {\n    let s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = input.charAt(peg$currPos);\n    if (peg$r0.test(s1)) {\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e11); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsesign();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      s3 = peg$parsedigitSequence();\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f17(s2, s3);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsesign() {\n    let s0;\n\n    s0 = input.charAt(peg$currPos);\n    if (peg$r1.test(s0)) {\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e12); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsedigitSequence() {\n    let s0, s1;\n\n    s0 = [];\n    s1 = peg$parsedigit();\n    if (s1 !== peg$FAILED) {\n      while (s1 !== peg$FAILED) {\n        s0.push(s1);\n        s1 = peg$parsedigit();\n      }\n    } else {\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsedigit() {\n    let s0;\n\n    s0 = input.charAt(peg$currPos);\n    if (peg$r2.test(s0)) {\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e13); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsewsp() {\n    let s0;\n\n    s0 = input.charAt(peg$currPos);\n    if (peg$r3.test(s0)) {\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e14); }\n    }\n\n    return s0;\n  }\n\n  peg$result = peg$startRuleFunction();\n\n  const peg$success = (peg$result !== peg$FAILED && peg$currPos === input.length);\n  function peg$throw() {\n    if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n      peg$fail(peg$endExpectation());\n    }\n\n    throw peg$buildStructuredError(\n      peg$maxFailExpected,\n      peg$maxFailPos < input.length ? peg$getUnicode(peg$maxFailPos) : null,\n      peg$maxFailPos < input.length\n        ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)\n        : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)\n    );\n  }\n  if (options.peg$library) {\n    return /** @type {any} */ ({\n      peg$result,\n      peg$currPos,\n      peg$FAILED,\n      peg$maxFailExpected,\n      peg$maxFailPos,\n      peg$success,\n      peg$throw: peg$success ? undefined : peg$throw,\n    });\n  }\n  if (peg$success) {\n    return peg$result;\n  } else {\n    peg$throw();\n  }\n}\n\nconst peg$allowedStartRules = [\n  \"transformList\"\n];\n\nexport {\n  peg$allowedStartRules as StartRules,\n  peg$SyntaxError as SyntaxError,\n  peg$parse as parse\n};\n","import { scale } from './scale'\nimport { compose } from './transform'\n/**\n * Decompose a matrix into translation, scaling and rotation components, optionally\n * take horizontal and vertical flip in to consideration.\n * Note this function decomposes a matrix in rotation -> scaling -> translation order. I.e. for\n * certain translation T {tx, ty}, rotation R and scaling S { sx, sy }, it's only true for:\n *  decomposeTSR(compose(T, S, R)) === { translate: T, rotation: R, scale: S }\n * composing in a different order may yield a different decomposition result.\n * @param matrix {Matrix} Affine Matrix\n * @param  flipX {boolean} Whether the matrix contains vertical flip, i.e. mirrors on x-axis\n * @param  flipY {boolean} Whether the matrix contains horizontal flip, i.e. mirrors on y-axis\n * @returns {Transform} A transform object consisted by its translation, scaling\n * and rotation components.\n */\nexport function decomposeTSR (matrix, flipX = false, flipY = false) {\n  // Remove flip from the matrix first - flip could be incorrectly interpreted as\n  // rotations (e.g. flipX + flipY = rotate by 180 degrees).\n  // Note flipX is a vertical flip, and flipY is a horizontal flip.\n  if (flipX) {\n    if (flipY) {\n      matrix = compose(matrix, scale(-1, -1))\n    } else {\n      matrix = compose(matrix, scale(1, -1))\n    }\n  } else if (flipY) {\n    matrix = compose(matrix, scale(-1, 1))\n  }\n\n  const a = matrix.a; const b = matrix.b\n  const c = matrix.c; const d = matrix.d\n  let scaleX, scaleY, rotation\n\n  if (a !== 0 || c !== 0) {\n    const hypotAc = Math.hypot(a, c)\n    scaleX = hypotAc\n    scaleY = (a * d - b * c) / hypotAc\n    const acos = Math.acos(a / hypotAc)\n    rotation = c > 0 ? -acos : acos\n  } else if (b !== 0 || d !== 0) {\n    const hypotBd = Math.hypot(b, d)\n    scaleX = (a * d - b * c) / hypotBd\n    scaleY = hypotBd\n    const acos = Math.acos(b / hypotBd)\n    rotation = Math.PI / 2 + (d > 0 ? -acos : acos)\n  } else {\n    scaleX = 0\n    scaleY = 0\n    rotation = 0\n  }\n\n  // put the flip factors back\n  if (flipY) {\n    scaleX = -scaleX\n  }\n\n  if (flipX) {\n    scaleY = -scaleY\n  }\n\n  return {\n    translate: { tx: matrix.e, ty: matrix.f },\n    scale: { sx: scaleX, sy: scaleY },\n    rotation: { angle: rotation }\n  }\n}\n","/**\n * Tranformation matrix that mirrors on x-axis\n * @returns {Matrix} Affine Matrix\n */\nexport function flipX () {\n  return {\n    a: 1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: -1,\n    f: 0\n  }\n}\n\n/**\n * Tranformation matrix that mirrors on y-axis\n * @returns {Matrix} Affine Matrix\n */\nexport function flipY () {\n  return {\n    a: -1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: 1,\n    f: 0\n  }\n}\n\n/**\n * Tranformation matrix that mirrors on origin\n * @returns {Matrix} Affine Matrix\n */\nexport function flipOrigin () {\n  return {\n    a: -1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: -1,\n    f: 0\n  }\n}\n","import { translate } from './translate'\nimport { applyToPoint } from './applyToPoint'\nimport { rotate } from './rotate'\nimport { scale } from './scale'\nimport { compose } from './transform'\n\n// https://manivannan-ai.medium.com/find-the-angle-between-three-points-from-2d-using-python-348c513e2cd\n\n/**\n * Calculate a transformation matrix from a point that starts from A to A'\n * This approach can be associated to a pointer that moves on a device\n * @param {Point} startingPoint - Starting point (A)\n * @param {Point} endingPoint - Ending point (A')\n */\nexport function fromOneMovingPoint (startingPoint, endingPoint) {\n  const tx = endingPoint.x - startingPoint.x\n  const ty = endingPoint.y - startingPoint.y\n\n  return translate(tx, ty)\n}\n\n/**\n * Calculate a transformation matrix about two points that move from positions A and B to A' and B'\n * This approach can be associated to a two finger gesture on a touch device\n * @param {Point} startingPoint1 - Starting Point (A)\n * @param {Point} startingPoint2 - Starting Point (B)\n * @param {Point} endingPoint1 - Ending point (A')\n * @param {Point} endingPoint2 - Ending Point (B')\n */\nexport function fromTwoMovingPoints (startingPoint1, startingPoint2, endingPoint1, endingPoint2) {\n  // finds translation\n  const translationMatrix = fromOneMovingPoint(startingPoint1, endingPoint1)\n\n  const pointA = applyToPoint(translationMatrix, startingPoint2) // I have to translate this point\n  const center = endingPoint1\n  const pointB = endingPoint2\n\n  // finds rotation matrix\n  const angle = Math.atan2(pointB.y - center.y, pointB.x - center.x) - Math.atan2(pointA.y - center.y, pointA.x - center.x)\n  const rotationMatrix = rotate(angle, center.x, center.y)\n\n  // finds scale matrix\n  const d1 = Math.sqrt(Math.pow(pointA.x - center.x, 2) + Math.pow(pointA.y - center.y, 2))\n  const d2 = Math.sqrt(Math.pow(pointB.x - center.x, 2) + Math.pow(pointB.y - center.y, 2))\n  const scalingLevel = d2 / d1\n  const scalingMatrix = scale(scalingLevel, scalingLevel, center.x, center.y)\n\n  return compose([\n    translationMatrix,\n    scalingMatrix,\n    rotationMatrix\n  ])\n}\n","import {\n    TViewportTransform,\n    TViewportTransformXY,\n} from '../../klecks/ui/project-viewport/project-viewport';\nimport { compose, Matrix, rotate, scale, translate } from 'transformation-matrix';\n\nexport function createMatrixFromTransform(\n    transform: TViewportTransform | TViewportTransformXY,\n): Matrix {\n    const scaleX = 'scale' in transform ? transform.scale : transform.scaleX;\n    const scaleY = 'scale' in transform ? transform.scale : transform.scaleY;\n    return compose(\n        translate(transform.x, transform.y),\n        rotate((transform.angleDeg / 180) * Math.PI),\n        scale(scaleX, scaleY),\n    );\n}\n","import { Matrix } from 'transformation-matrix';\n\nexport type TMatrixTuple = [number, number, number, number, number, number];\n\nexport function matrixToTuple(m: Matrix): TMatrixTuple {\n    return [m.a, m.b, m.c, m.d, m.e, m.f];\n}\n","import { BB } from '../../../bb/bb';\nimport { throwIfNull } from '../../../bb/base/base';\nimport { HISTORY_TILE_SIZE } from '../../history/kl-history';\n\nexport const DEBUG_RENDERER_ENABLED = false;\n\nexport type TDebugRenderFunc = (\n    ctx: CanvasRenderingContext2D,\n    width: number,\n    height: number,\n    scale: number,\n) => void;\n\n/**\n * renders into all ProjectViewports\n */\nclass DebugRender {\n    private internalRenderFuncs: TDebugRenderFunc[] = [];\n    private renderFuncs: TDebugRenderFunc[] = [];\n\n    // --------------- public ---------------------\n    constructor() {\n        if (DEBUG_RENDERER_ENABLED) {\n            // draw checkerboard\n            const checkerCanvas = BB.createCheckerCanvas(256, false);\n            const pattern = throwIfNull(\n                BB.ctx(BB.canvas(HISTORY_TILE_SIZE, HISTORY_TILE_SIZE)).createPattern(\n                    checkerCanvas,\n                    'repeat',\n                ),\n            );\n            this.internalRenderFuncs.push((ctx, width, height) => {\n                ctx.fillStyle = pattern;\n                ctx.globalAlpha = 0.2;\n                ctx.fillRect(0, 0, width, height);\n            });\n        }\n    }\n\n    render(ctx: CanvasRenderingContext2D, width: number, height: number, scale: number) {\n        this.internalRenderFuncs.forEach((func) => {\n            ctx.save();\n            func(ctx, width, height, scale);\n            ctx.restore();\n        });\n        this.renderFuncs.forEach((func) => {\n            ctx.save();\n            func(ctx, width, height, scale);\n            ctx.restore();\n        });\n    }\n\n    // add something to be rendered\n    add(func: TDebugRenderFunc) {\n        this.renderFuncs.push(func);\n    }\n\n    remove(func: TDebugRenderFunc) {\n        for (let i = 0; i < this.renderFuncs.length; i++) {\n            if (this.renderFuncs[i] === func) {\n                this.renderFuncs.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    clear(): void {\n        this.renderFuncs = [];\n    }\n}\n\nexport const DEBUG_RENDER = new DebugRender();\n","import { THistoryEntry, THistoryEntryData, THistoryEntryDataComposed } from './history.types';\nimport { composeHistoryStateData } from './compose-history-state-data';\nimport { estimateBytes } from './estimate-bytes';\nimport { entryCausesChange } from './entry-causes-change';\n\n/*\ntodo memory could be better limited.\nWhen pushing, all entries and the new entry are in memory which already exceeds the limit.\nYou can potentially be 268.44 MB over the memory limit.\nThe new entry should only be created after freeing up some space in entries.\n */\n\n// tied to indexed db. don't change.\nexport const HISTORY_TILE_SIZE = 256;\n\nexport type TKlHistoryListener = () => void;\n\nexport type TKlHistoryParams = {\n    oldest: THistoryEntryDataComposed;\n};\n\nconst HISTORY_DEBUGGING = true;\n\nexport class KlHistory {\n    // total number of non-free undo steps\n    private readonly maxUndoSteps: number = 20;\n\n    /*\n    All entries together can't exceed this limit. Supersedes maxUndoSteps. Intended\n    to ensure app stability.\n\n    The worst-case (memory wise) happens when the project at max size with max layers is\n    rotated repeatedly, or the user continually imports a large project.\n\n    max image size:      2048 x 2048\n    max layers:          16\n    max history entries: 20 + 1 (+1 is the current state of KlCanvas)\n          1 layer @ 2048 x 2048 = 16,777,216 Bytes    = 16.78 MB    = 0.02 GB\n         16 layer @ 2048 x 2048 = 268,435,456 Bytes   = 268.44 MB   = 0.27 GB\n    21 x 16 layer @ 2048 x 2048 = 5,637,144,576 Bytes = 5,637.14 MB = 5.64 GB\n\n    (2024-09) Low-end Chromebooks may only have 2GB of RAM. 5.64 GB would be too much.\n    Going with 1 GB, which is 3.7 worst-case undo steps.\n     */\n    private readonly totalThresholdBytes: number = 1e9;\n\n    // up to a certain threshold an undo step counts as free, and doesn't get you closer to undo\n    // step limit. E.g. renaming a layer has virtually no impact on memory or performance.\n    private readonly isFreeThresholdBytes: number = 2048; // 2MB if there were 1000 steps like that\n\n    private entries: THistoryEntry[]; // diffs or what changed each step. 0 is oldest\n    private index: number = 0; // current action the user is on.\n    private composed: THistoryEntryDataComposed; // all diffs until current action combined\n\n    private indexOffset: number = 0; // for getting the total number of actions (beyond undo limit)\n    private changeCount: number = 0; // number keeps incrementing with each change (push, undo, redo)\n    private pauseStack: number = 0; // how often paused without unpause. push does nothing when paused.\n    private readonly listeners: TKlHistoryListener[] = []; // broadcasts on undo, redo, push\n\n    private broadcast(): void {\n        this.changeCount++;\n        setTimeout(() => {\n            for (let i = 0; i < this.listeners.length; i++) {\n                this.listeners[i]();\n            }\n        }, 1);\n    }\n\n    private updateComposed(): void {\n        this.composed = composeHistoryStateData(\n            this.entries.slice(0, this.index + 1).map((item) => item.data),\n        );\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TKlHistoryParams) {\n        this.entries = [\n            {\n                timestamp: new Date().getTime(),\n                memoryEstimateBytes: estimateBytes(p.oldest),\n                data: p.oldest,\n            },\n        ];\n        this.composed = p.oldest;\n        if (HISTORY_DEBUGGING) {\n            (window as any).getHistoryEntries = () => this.entries;\n        }\n    }\n\n    /**\n     * Needed, because sometimes there are actions that would cause other undo steps.\n     * For example a filter that does something with two layers and then merges them.\n     * That should be a single undo step, and prevent merging from creating its own undo step.\n     * Pause prevents creation of unintended undo steps.\n     */\n    pause(b: boolean): void {\n        if (b) {\n            this.pauseStack++;\n        } else {\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\n        }\n    }\n\n    /**\n     * listens to changes - on undo, redo, push\n     */\n    addListener(l: TKlHistoryListener): void {\n        this.listeners.push(l);\n    }\n\n    push(entryData: THistoryEntryData, replaceTop?: boolean): void {\n        if (this.pauseStack > 0) {\n            return;\n        }\n        const entry: THistoryEntry = {\n            timestamp: new Date().getTime(),\n            memoryEstimateBytes: estimateBytes(entryData),\n            data: entryData,\n        };\n\n        if (replaceTop && this.index > 0) {\n            this.index--;\n            // remove current top\n            while (this.index < this.entries.length - 1) {\n                this.entries.pop();\n            }\n            // it's possible that new entry replacing top is same to composed history\n            // e.g. toggle layer visibility twice\n            const isDifferent = entryCausesChange(\n                entryData,\n                composeHistoryStateData(\n                    this.entries.slice(0, this.index + 1).map((item) => item.data),\n                ),\n            );\n            // only need to push if it's different\n            isDifferent && this.entries.push(entry);\n        } else {\n            while (this.index < this.entries.length - 1) {\n                this.entries.pop();\n            }\n            this.entries.push(entry);\n        }\n\n        // determine oldest - consider maxUndoSteps, isFree, totalThresholdBytes\n        let remainingSteps = this.maxUndoSteps;\n        let oldestIndex = this.entries.length - 1;\n        let remainingBytes = this.totalThresholdBytes - entry.memoryEstimateBytes;\n        while (oldestIndex > 0 && remainingSteps >= 0) {\n            oldestIndex--;\n            const currentEntryBytes = this.entries[oldestIndex].memoryEstimateBytes;\n            if (currentEntryBytes < this.isFreeThresholdBytes) {\n                remainingBytes -= currentEntryBytes;\n                continue;\n            }\n            if (remainingSteps === 0) {\n                // already used up all steps\n                oldestIndex++;\n                break;\n            }\n            if (remainingBytes - currentEntryBytes < 0) {\n                // used up all memory\n                oldestIndex++;\n                break;\n            }\n            remainingBytes -= currentEntryBytes;\n            remainingSteps--;\n        }\n        // compose forward to the oldest index\n        while (oldestIndex > 0) {\n            const composedData = composeHistoryStateData(\n                this.entries.slice(0, oldestIndex + 1).map((item) => item.data),\n                oldestIndex,\n            );\n            const memoryEstimateBytes = estimateBytes(composedData);\n            this.entries = [\n                {\n                    timestamp: this.entries[oldestIndex].timestamp,\n                    memoryEstimateBytes,\n                    description: 'oldest',\n                    data: composedData,\n                },\n                ...this.entries.slice(oldestIndex + 1),\n            ];\n\n            this.indexOffset += oldestIndex;\n            oldestIndex = 0;\n\n            // despite the earlier check, it can still exceed the threshold\n            if (\n                this.entries.reduce((before, item) => before + item.memoryEstimateBytes, 0) >\n                this.totalThresholdBytes\n            ) {\n                oldestIndex = 1;\n            }\n        }\n        this.index = this.entries.length - 1;\n        this.updateComposed();\n        this.broadcast();\n    }\n\n    increaseIndex(): THistoryEntry {\n        if (this.canRedo()) {\n            this.index++;\n        }\n        this.updateComposed();\n        this.broadcast();\n        return this.entries[this.index];\n    }\n\n    decreaseIndex(): THistoryEntry {\n        if (this.canUndo()) {\n            this.index--;\n        }\n        this.updateComposed();\n        this.broadcast();\n        return this.entries[this.index];\n    }\n\n    canUndo(): boolean {\n        return this.index > 0;\n    }\n\n    canRedo(): boolean {\n        return this.index < this.entries.length - 1;\n    }\n\n    getEntries(): THistoryEntry[] {\n        return this.entries.slice(0, this.index + 1);\n    }\n\n    getComposed(): THistoryEntryDataComposed {\n        return this.composed;\n    }\n\n    getChangeCount(): number {\n        return this.changeCount;\n    }\n\n    getTotalIndex(): number {\n        return this.indexOffset + this.index;\n    }\n\n    isPaused(): boolean {\n        return this.pauseStack > 0;\n    }\n}\n","import {\n    THistoryEntryData,\n    THistoryEntryDataComposed,\n    THistoryEntryLayer,\n    THistoryEntryLayerComposed,\n    THistoryEntryLayerTile,\n    TLayerId,\n} from './history.types';\n\n// finds the largest index that is defined\nfunction getLatestDefined<GType>(array: (GType | undefined)[]): GType {\n    for (let i = array.length - 1; i >= 0; i--) {\n        const value = array[i];\n        if (value !== undefined) {\n            return value;\n        }\n    }\n    throw new Error('no defined entry found');\n}\n\n// in an array of maps, finds array[i][prop] for the largest index\n// where array[i][prop] is defined\nfunction getLatestDefinedProp<\n    GProp extends string,\n    GValue,\n    GArray extends { [K in GProp]?: GValue },\n>(array: (GArray | undefined)[], prop: GProp): GValue {\n    for (let i = array.length - 1; i >= 0; i--) {\n        if (!array[i]) {\n            continue;\n        }\n        const value = array[i]![prop];\n        if (value !== undefined) {\n            return value;\n        }\n    }\n    throw new Error('no defined entry found');\n}\n\n// For each tile gets the latest which is defined.\n// Each tile[] is from a history entry.\nfunction composeLayerTiles(\n    tilesEntries: ((THistoryEntryLayerTile | undefined)[] | undefined)[],\n): THistoryEntryLayerTile[] {\n    const result = [...getLatestDefined(tilesEntries)];\n    Object.entries(result).forEach(([id]) => {\n        result[+id] = getLatestDefinedProp(tilesEntries as any, id);\n    });\n    return result as THistoryEntryLayerTile[];\n}\n\n// combines layers from multiple history entries into the latest representation\nfunction composeLayer(\n    layerEntries: (THistoryEntryLayer | undefined)[],\n): THistoryEntryLayerComposed {\n    return {\n        name: getLatestDefinedProp(layerEntries, 'name'),\n        opacity: getLatestDefinedProp(layerEntries, 'opacity'),\n        isVisible: getLatestDefinedProp(layerEntries, 'isVisible'),\n        mixModeStr: getLatestDefinedProp(layerEntries, 'mixModeStr'),\n        index: getLatestDefinedProp(layerEntries, 'index'),\n        tiles: composeLayerTiles(layerEntries.map((item) => (item ? item.tiles : undefined))),\n    };\n}\n\n// combines layerMaps from multiple history entries into the latest representation\nfunction composeLayerMap(layerMaps: (Record<TLayerId, THistoryEntryLayer> | undefined)[]) {\n    const result = { ...getLatestDefined(layerMaps) };\n    Object.entries(result).forEach(([id]) => {\n        result[id] = composeLayer(layerMaps.map((item) => (item ? item[id] : undefined)));\n    });\n    return result as Record<TLayerId, THistoryEntryLayerComposed>;\n}\n\n/**\n * Combines multiple history entries into one. Entries after targetIndex are ignored.\n *\n * Each history entry only contains changes (e.g. name of layer 1 changed, or an area of layer 2 got\n * changed by a brush stroke), so it isn't the complete picture. Combining everything gives the complete picture.\n *\n * When combining it always takes the most recent data (<=targetIndex).\n * [oldest, ..., newest]\n */\nexport function composeHistoryStateData(\n    entries: THistoryEntryData[],\n    targetIndex?: number,\n): THistoryEntryDataComposed {\n    if (targetIndex === undefined) {\n        targetIndex = entries.length - 1;\n    }\n    entries = entries.slice(0, targetIndex + 1);\n    return {\n        projectId: getLatestDefinedProp(entries, 'projectId'),\n        size: getLatestDefinedProp(entries, 'size'),\n        activeLayerId: getLatestDefinedProp(entries, 'activeLayerId'),\n        selection: getLatestDefinedProp(entries, 'selection'),\n        layerMap: composeLayerMap(entries.map((item) => item.layerMap)),\n    };\n}\n","import { THistoryEntryData } from './history.types';\nimport { isLayerFill } from '../kl-types';\n\n// estimates how much memory a history entry uses\nexport function estimateBytes(entry: THistoryEntryData): number {\n    let result = 0;\n\n    // for complex selection paths\n    entry.selection?.value?.forEach((poly) => {\n        poly.forEach((ring) => {\n            result += ring.length * 2 * 8; // each number 8 bytes\n        });\n    });\n\n    entry.layerMap &&\n        Object.entries(entry.layerMap).forEach(([, layer]) => {\n            layer.tiles?.forEach((tile) => {\n                if (tile === undefined) {\n                    return;\n                }\n                if (isLayerFill(tile)) {\n                    result += tile.fill.length * 2; // 2 byte per character\n                } else {\n                    result += tile.data.width * tile.data.height * 4; // 4 channels, each 1 byte\n                }\n            });\n        });\n\n    return result;\n}\n","import { KlCanvas, TKlCanvasLayer } from './canvas/kl-canvas';\nimport { TTranslationCode } from '../../languages/languages';\nimport { KlHistory } from './history/kl-history';\nimport { THistoryEntryDataComposed, THistoryEntryLayerTile } from './history/history.types';\n\nexport type TFilterApply<T = unknown> = {\n    layer: TKlCanvasLayer; // active layer\n    klCanvas: KlCanvas;\n    input: T; // parameters chosen in modal\n    klHistory: KlHistory;\n};\n\nexport type TFilterGetDialogParam = {\n    context: CanvasRenderingContext2D; // context of selected layer\n    klCanvas: KlCanvas;\n    composed: THistoryEntryDataComposed;\n    maxWidth: number; // limit for klCanvas size\n    maxHeight: number;\n    currentColorRgb: TRgb;\n    secondaryColorRgb: TRgb;\n};\n\nexport type TFilterGetDialogResult<T = unknown> =\n    | {\n          element: HTMLElement; // contents of modal (excluding title, dialog buttons)\n          destroy?: () => void; // called when modal closed\n          width?: number; // custom modal width\n          getInput?: () => T; // called when Ok pressed\n          errorCallback?: (e: Error) => void; // dialog can call this if error happens and cancel dialog\n      }\n    | { error: string };\n\nexport type TFilter = {\n    lang: {\n        name: TTranslationCode; // title in modal\n        button: TTranslationCode; // text on button in filter tab\n        description?: TTranslationCode;\n    };\n    updatePos: boolean; // changes size/orientation of klCanvas\n    icon: string; // image url\n    isInstant?: boolean; // default false - if instant no modal\n    inEmbed: boolean; // is available in embed\n    getDialog: null | ((p: TFilterGetDialogParam) => any);\n    apply: null | ((p: TFilterApply) => boolean);\n    darkNoInvert?: boolean;\n    webGL?: boolean; // does the filter require webgl\n};\n\nexport type TLayerFromKlCanvas = {\n    context: CanvasRenderingContext2D;\n    isVisible: boolean;\n    opacity: number;\n    name: string;\n    id: number; // actually the index\n};\n\n// a subset of CanvasRenderingContext2D.globalCompositeOperation\nexport type TMixMode =\n    | 'source-over' // default aka normal\n    | 'darken'\n    | 'multiply'\n    | 'color-burn'\n    | 'lighten'\n    | 'screen'\n    | 'color-dodge'\n    | 'overlay'\n    | 'soft-light'\n    | 'hard-light'\n    | 'difference'\n    | 'exclusion'\n    | 'hue'\n    | 'saturation'\n    | 'color'\n    | 'luminosity';\n\nexport type TLayerFill = { fill: string }; // css color string. hex, rgb, rgba, color name\n\nexport function isLayerFill(obj: unknown): obj is TLayerFill {\n    return (\n        typeof obj === 'object' &&\n        obj !== null &&\n        'fill' in obj &&\n        typeof (obj as any).fill === 'string'\n    );\n}\n\nexport type TKlBasicLayer = {\n    opacity: number; // 0 - 1\n    isVisible: boolean;\n    mixModeStr?: TMixMode; // default \"source-over\"\n    image: HTMLImageElement | HTMLCanvasElement; // already loaded\n};\n\nexport type TKlProjectLayer = {\n    name: string;\n    isVisible: boolean;\n    opacity: number; // 0 - 1\n    mixModeStr?: TMixMode; // default \"source-over\"\n    image: HTMLImageElement | HTMLCanvasElement | TLayerFill | THistoryEntryLayerTile[]; // image already loaded\n};\n\n// A UUID, to make the project identifiable. (Not the recovery indexedDb key)\n// Used to test if current project is equal to what is in Browser Storage.\n// If they're not equal, it's possible to show the user a warning.\nexport type TProjectId = string;\n\nexport type TKlProject = {\n    width: number; // int\n    height: number; // int\n    layers: TKlProjectLayer[];\n    projectId: TProjectId;\n};\n\nexport type TKlProjectWithOptionalId = {\n    width: number; // int\n    height: number; // int\n    layers: TKlProjectLayer[];\n    projectId?: TProjectId;\n};\n\nexport type TRawMeta = {\n    timestamp: number;\n    thumbnail: Blob;\n    projectId: TProjectId;\n};\n\nexport type TKlProjectMeta = {\n    timestamp: number;\n    thumbnail: HTMLImageElement | HTMLCanvasElement;\n    projectId: TProjectId;\n};\n\nexport type TDeserializedKlStorageProject = {\n    project: TKlProject;\n    timestamp: number;\n    thumbnail: HTMLImageElement | HTMLCanvasElement;\n};\n\nexport type TDropOption = 'default' | 'layer' | 'image';\n\nexport type TRgb = {\n    r: number; // [0, 255]\n    g: number;\n    b: number;\n};\n\nexport type TRgba = {\n    r: number; // [0, 255]\n    g: number;\n    b: number;\n    a: number; // [0, 1]\n};\n\nexport type TGradientType = 'linear' | 'linear-mirror' | 'radial';\n\nexport type TGradient = {\n    type: TGradientType;\n    color1: TRgb;\n    isReversed: boolean; // color1 actually color2\n    opacity: number; // [0, 1]\n    doLockAlpha: boolean;\n    doSnap: boolean; // 45 deg angle snapping\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n    angleRad: number; // angle of canvas\n    isEraser: boolean;\n};\n\nexport type TShapeToolType = 'rect' | 'ellipse' | 'line';\n\nexport type TShapeToolMode = 'stroke' | 'fill';\n\nexport type TShapeToolObject = {\n    type: TShapeToolType;\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n    angleRad?: number; // angle of canvas, default 0\n    isOutwards?: boolean; // center is x1 y1, default false\n    opacity?: number; // 0-1, default 1\n    isEraser?: boolean; // default false\n    fillRgb?: { r: number; g: number; b: number }; // for rect or ellipse\n    strokeRgb?: { r: number; g: number; b: number }; // needed for line\n    lineWidth?: number; // needed for line\n    isAngleSnap?: boolean; // 45 deg angle snapping\n    isFixedRatio?: boolean; // 1:1 for rect or ellipse\n    doLockAlpha?: boolean; // default false\n};\n\nexport type TKlSliderConfig = {\n    min: number;\n    max: number;\n    curve?: [number, number][] | 'quadratic';\n    isDisabled?: boolean; // default enabled\n};\n\nexport type TSliderConfig = {\n    sizeSlider: TKlSliderConfig;\n    opacitySlider: TKlSliderConfig;\n    scatterSlider: TKlSliderConfig;\n};\n\nexport type TBrushUiInstance<GBrush> = {\n    increaseSize: (f: number) => void;\n    decreaseSize: (f: number) => void;\n    getSize: () => number;\n    setSize: (size: number) => void;\n    getOpacity: () => number;\n    setOpacity: (opacity: number) => void;\n    getScatter: () => number;\n    setScatter: (opacity: number) => void;\n    setColor: (c: TRgb) => void;\n    setLayer: (layer: TKlCanvasLayer) => void;\n    startLine: (x: number, y: number, p: number) => void;\n    goLine: (x: number, y: number, p: number, isCoalesced?: boolean) => void;\n    endLine: () => void;\n    getBrush: () => GBrush;\n    isDrawing: () => boolean;\n    getElement: () => HTMLElement;\n    getIsTransparentBg?: () => boolean;\n    getSeed?: () => number;\n    setSeed?: (s: number) => void;\n    toggleEraser?: () => void;\n};\n\nexport type TBrushUi<GBrush> = TSliderConfig & {\n    image: string;\n    tooltip: string;\n    Ui: (\n        this: TBrushUiInstance<GBrush>,\n        p: {\n            klHistory: KlHistory;\n            onSizeChange: (size: number) => void;\n            onOpacityChange: (size: number) => void;\n            onScatterChange: (size: number) => void;\n            onConfigChange: () => void;\n        },\n    ) => TBrushUiInstance<GBrush>;\n};\n\nexport type TPressureInput = {\n    x: number;\n    y: number;\n    pressure: number;\n};\n\nexport type TDrawDownEvent = {\n    type: 'down';\n    scale: number;\n    shiftIsPressed: boolean;\n    pressure: number;\n    isCoalesced: boolean;\n    x: number;\n    y: number;\n};\n\nexport type TDrawMoveEvent = {\n    type: 'move';\n    scale: number;\n    shiftIsPressed: boolean;\n    pressure: number;\n    isCoalesced: boolean;\n    x: number;\n    y: number;\n};\n\nexport type TDrawUpEvent = {\n    type: 'up';\n    scale: number;\n    shiftIsPressed: boolean;\n    isCoalesced: boolean;\n};\n\nexport type TDrawLine = {\n    type: 'line';\n    x0: number | null;\n    y0: number | null;\n    x1: number;\n    y1: number;\n    pressure0: number | null;\n    pressure1: number;\n};\n\nexport type TDrawEvent = TDrawDownEvent | TDrawMoveEvent | TDrawUpEvent | TDrawLine;\n\nexport type TToolType = 'brush' | 'paintBucket' | 'text' | 'shape' | 'gradient' | 'hand' | 'select';\n\nexport type TKlPsdError =\n    | 'mask'\n    | 'clipping'\n    | 'group'\n    | 'adjustment'\n    | 'layer-effect'\n    | 'smart-object'\n    | 'blend-mode'\n    | 'bits-per-channel';\n\nexport type TKlPsdLayer = {\n    name: string;\n    isVisible: boolean;\n    mixModeStr: TMixMode;\n    opacity: number;\n    image: HTMLCanvasElement;\n};\n\n/**\n * Psd interpreted for usage in Klecks.\n */\nexport type TKlPsd = {\n    type: 'psd';\n    canvas: HTMLCanvasElement;\n    width: number;\n    height: number;\n    layers?: TKlPsdLayer[]; // not there if flattened\n    // if one of these features show up, they become a warning\n    // because Klecks can't properly represent them (yet)\n    warningArr?: TKlPsdError[];\n    error?: boolean; // true if flattened (too many layers)\n};\n\nexport type TFillSampling = 'current' | 'all' | 'above';\n\nexport type TUiLayout = 'left' | 'right';\nexport type TExportType = 'png' | 'layers' | 'psd';\n","import { THistoryEntryData, THistoryEntryDataComposed } from './history.types';\n\n// checks if `entry` would change `composed`\nexport function entryCausesChange(\n    entry: THistoryEntryData,\n    composed: THistoryEntryDataComposed,\n): boolean {\n    if (entry.size !== undefined) {\n        if (entry.size.width !== composed.size.width) {\n            return true;\n        }\n        if (entry.size.height !== composed.size.height) {\n            return true;\n        }\n    }\n    if (entry.selection !== undefined) {\n        if (entry.selection.value !== composed.selection.value) {\n            return true;\n        }\n    }\n    if (entry.activeLayerId !== undefined) {\n        if (entry.activeLayerId !== composed.activeLayerId) {\n            return true;\n        }\n    }\n    if (entry.layerMap !== undefined) {\n        const entryLayerMapIds = Object.keys(entry.layerMap);\n        for (const layerId of Object.keys(composed.layerMap)) {\n            if (!entryLayerMapIds.includes(layerId)) {\n                return true;\n            }\n        }\n        for (const layerId of entryLayerMapIds) {\n            const composedLayer = composed.layerMap[layerId];\n            if (!composedLayer) {\n                return true;\n            }\n            const entryLayer = entry.layerMap[layerId];\n            if (entryLayer.name !== undefined && entryLayer.name !== composedLayer.name) {\n                return true;\n            }\n            if (entryLayer.opacity !== undefined && entryLayer.opacity !== composedLayer.opacity) {\n                return true;\n            }\n            if (\n                entryLayer.isVisible !== undefined &&\n                entryLayer.isVisible !== composedLayer.isVisible\n            ) {\n                return true;\n            }\n            if (\n                entryLayer.mixModeStr !== undefined &&\n                entryLayer.mixModeStr !== composedLayer.mixModeStr\n            ) {\n                return true;\n            }\n            if (entryLayer.index !== undefined && entryLayer.index !== composedLayer.index) {\n                return true;\n            }\n            if (entryLayer.tiles !== undefined) {\n                // not needed currently\n                return true;\n            }\n        }\n    }\n    return false;\n}\n","module.exports = parcelRequire.resolve(\"tool-zoom-in.7d977a87.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"tool-zoom-out.d8bf23f4.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"viewport-reset.5ce5c7b0.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"tool-hand.8dd30f77.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-pencil.26e6cef2.svg\") + \"?\" + Date.now();",null,"export function zoomByStep(oldScale: number, stepNum: number): number {\n    const step = Math.log2(oldScale);\n\n    let newStep = step / Math.abs(stepNum);\n    newStep += stepNum > 0 ? 1 : -1;\n    newStep = Math.round(newStep);\n    newStep *= Math.abs(stepNum);\n\n    return Math.pow(2, newStep);\n}\n","import { TViewportTransform } from '../../klecks/ui/project-viewport/project-viewport';\nimport { TVector2D } from '../bb-types';\nimport { applyToPoint, compose, rotate, scale as scaleFunc } from 'transformation-matrix';\n\nexport function createTransform(\n    viewportPoint: TVector2D,\n    canvasPoint: TVector2D,\n    scale: number,\n    angleDeg: number,\n): TViewportTransform {\n    const mat = compose(scaleFunc(-scale, -scale), rotate((angleDeg / 180) * Math.PI));\n    const topLeftP = applyToPoint(mat, canvasPoint);\n    topLeftP.x += viewportPoint.x;\n    topLeftP.y += viewportPoint.y;\n    return {\n        x: topLeftP.x,\n        y: topLeftP.y,\n        scale,\n        angleDeg,\n    };\n}\n","import { createMatrixFromTransform } from './create-matrix-from-transform';\nimport { TViewportTransform } from '../../klecks/ui/project-viewport/project-viewport';\nimport { TVector2D } from '../bb-types';\nimport { applyToPoint, inverse } from 'transformation-matrix';\n\nexport type TMetaTransform = {\n    viewportP: TVector2D;\n    canvasP: TVector2D;\n    scale: number;\n    angleDeg: number;\n};\n\nexport function toMetaTransform(\n    transform: TViewportTransform,\n    viewportP: TVector2D,\n): TMetaTransform {\n    const m = createMatrixFromTransform(transform);\n    const canvasP = applyToPoint(inverse(m), viewportP);\n    return {\n        viewportP,\n        canvasP,\n        scale: transform.scale,\n        angleDeg: transform.angleDeg,\n    };\n}\n","import { TViewportTransform } from '../project-viewport/project-viewport';\nimport { MultiPolygon, Pair } from 'polygon-clipping';\nimport { BB } from '../../../bb/bb';\nimport * as classes from './selection-renderer.module.scss';\nimport { Matrix } from 'transformation-matrix';\nimport { createMatrixFromTransform } from '../../../bb/transform/create-matrix-from-transform';\nimport { getSvgPathD } from '../../../bb/multi-polygon/get-selection-path-2d';\nimport { transformMultiPolygon } from '../../../bb/multi-polygon/transform-multi-polygon';\nimport { applyPolygonClipping } from '../../../bb/multi-polygon/apply-polygon-clipping';\n\nexport type TSelectionRendererParams = {\n    transform: TViewportTransform;\n    selection?: MultiPolygon;\n    width: number; // size of viewport\n    height: number; // size of viewport\n};\n\n// makes right angle rects look more crisp\nexport function roundPoly(multiPolygon: MultiPolygon): MultiPolygon {\n    return multiPolygon.map((poly) => {\n        return poly.map((ring) => {\n            return ring.map((point) => {\n                return [Math.round(point[0] + 0.5) - 0.5, Math.round(point[1] + 0.5) - 0.5] as Pair; // on .5\n            });\n        });\n    });\n}\n\nexport class SelectionRenderer {\n    private readonly rootEl: SVGElement;\n    private readonly svgPath1: SVGPathElement;\n    private readonly svgPath2: SVGPathElement;\n\n    private viewportTransform: TViewportTransform;\n    private viewportMat: Matrix;\n    private selection: undefined | MultiPolygon; // selection of project\n    private renderedSelection: null | undefined | MultiPolygon = null; // overwrites this.selection, unless it's null\n    private viewportWidth: number;\n    private viewportHeight: number;\n\n    private update(): void {\n        const selection = this.renderedSelection === null ? this.selection : this.renderedSelection;\n\n        if (!selection) {\n            this.svgPath1.setAttribute('d', '');\n            this.svgPath2.setAttribute('d', '');\n            return;\n        }\n\n        // firefox has problems with non-scaling-stroke, so we scale manually.\n        // ^ it has visual glitches when the transformation changes.\n        const transformedSelection = transformMultiPolygon(selection, this.viewportMat);\n\n        // Firefox has bad performance when zoomed in far (guess: it doesn't clip the path)\n        // So we clip manually.\n        const clipPadding = 10;\n        const clippedSelection = applyPolygonClipping('intersection', transformedSelection, [\n            [\n                [-clipPadding, -clipPadding],\n                [this.viewportWidth + clipPadding, -clipPadding],\n                [this.viewportWidth + clipPadding, this.viewportHeight + clipPadding],\n                [-clipPadding, this.viewportHeight + clipPadding],\n                [-clipPadding, -clipPadding],\n            ],\n        ]);\n\n        const d = getSvgPathD(roundPoly(clippedSelection));\n        this.svgPath1.setAttribute('d', d);\n        this.svgPath2.setAttribute('d', d);\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TSelectionRendererParams) {\n        this.viewportTransform = p.transform;\n        this.viewportMat = createMatrixFromTransform(this.viewportTransform);\n        this.selection = p.selection;\n        this.viewportWidth = p.width;\n        this.viewportHeight = p.height;\n\n        this.svgPath1 = BB.createSvg({\n            elementType: 'path',\n            'vector-effect': 'non-scaling-stroke',\n        }) as SVGPathElement;\n        this.svgPath1.classList.add(classes.whitePath);\n\n        this.svgPath2 = BB.createSvg({\n            elementType: 'path',\n            'vector-effect': 'non-scaling-stroke',\n        }) as SVGPathElement;\n        this.svgPath2.classList.add(classes.blackPath);\n        this.rootEl = BB.createSvg({\n            elementType: 'g',\n        });\n        this.rootEl.append(this.svgPath1, this.svgPath2);\n    }\n\n    setTransform(transform: TViewportTransform): void {\n        this.viewportTransform = transform;\n        this.viewportMat = createMatrixFromTransform(this.viewportTransform);\n        this.update();\n    }\n\n    setSelection(selection?: MultiPolygon): void {\n        if (this.selection === selection) {\n            return;\n        }\n        this.selection = selection;\n        // only need to update when this.selection is used\n        if (this.renderedSelection === null) {\n            this.update();\n        }\n    }\n\n    // overwrite project selection\n    setRenderedSelection(renderedSelection?: MultiPolygon, isImmediate?: boolean): void {\n        if (this.renderedSelection === renderedSelection) {\n            return;\n        }\n        this.renderedSelection = renderedSelection;\n        this.update();\n    }\n\n    // render project selection again\n    clearRenderedSelection(isImmediate?: boolean): void {\n        this.renderedSelection = null;\n        if (!isImmediate) {\n            // good enough to update on next setSelection. (to prevent flickering)\n            return;\n        }\n        this.update();\n    }\n\n    setSize(width: number, height: number): void {\n        this.viewportWidth = width;\n        this.viewportHeight = height;\n    }\n\n    getElement(): SVGElement {\n        return this.rootEl;\n    }\n\n    destroy(): void {\n        this.rootEl.remove();\n        this.selection = undefined;\n    }\n}\n",null,"import { MultiPolygon, Pair } from 'polygon-clipping';\nimport { applyToPoint, Matrix } from 'transformation-matrix';\n\nexport function transformMultiPolygon(multiPolygon: MultiPolygon, transform: Matrix): MultiPolygon {\n    return multiPolygon.map((poly) => {\n        return poly.map((ring) => {\n            return ring.map((point) => {\n                return Object.values(applyToPoint(transform, { x: point[0], y: point[1] })) as Pair;\n            });\n        });\n    });\n}\n","import * as polygonClipping from 'polygon-clipping';\nimport { Geom, MultiPolygon } from 'polygon-clipping';\n\n// wrapper to catch errors, and offer fallback\nexport function applyPolygonClipping(\n    operation: 'intersection' | 'xor' | 'union' | 'difference',\n    geom: Geom,\n    ...geoms: Geom[]\n): MultiPolygon {\n    let result: MultiPolygon = []; // initialized with fallback\n    try {\n        result = polygonClipping[operation](geom, ...geoms);\n    } catch (e) {\n        /* */\n    }\n    return result;\n}\n","(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory) :\n    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.polygonClipping = factory());\n})(this, (function () { 'use strict';\n\n    /**\n     * splaytree v3.1.2\n     * Fast Splay tree for Node and browser\n     *\n     * @author Alexander Milevski <info@w8r.name>\n     * @license MIT\n     * @preserve\n     */\n\n    /*! *****************************************************************************\r\n    Copyright (c) Microsoft Corporation. All rights reserved.\r\n    Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\n    this file except in compliance with the License. You may obtain a copy of the\r\n    License at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\n    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\n    MERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\n    See the Apache Version 2.0 License for specific language governing permissions\r\n    and limitations under the License.\r\n    ***************************************************************************** */\n\n    function __generator(thisArg, body) {\n      var _ = {\n          label: 0,\n          sent: function () {\n            if (t[0] & 1) throw t[1];\n            return t[1];\n          },\n          trys: [],\n          ops: []\n        },\n        f,\n        y,\n        t,\n        g;\n      return g = {\n        next: verb(0),\n        \"throw\": verb(1),\n        \"return\": verb(2)\n      }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n        return this;\n      }), g;\n      function verb(n) {\n        return function (v) {\n          return step([n, v]);\n        };\n      }\n      function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n          if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n          if (y = 0, t) op = [op[0] & 2, t.value];\n          switch (op[0]) {\n            case 0:\n            case 1:\n              t = op;\n              break;\n            case 4:\n              _.label++;\n              return {\n                value: op[1],\n                done: false\n              };\n            case 5:\n              _.label++;\n              y = op[1];\n              op = [0];\n              continue;\n            case 7:\n              op = _.ops.pop();\n              _.trys.pop();\n              continue;\n            default:\n              if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n                _ = 0;\n                continue;\n              }\n              if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n                _.label = op[1];\n                break;\n              }\n              if (op[0] === 6 && _.label < t[1]) {\n                _.label = t[1];\n                t = op;\n                break;\n              }\n              if (t && _.label < t[2]) {\n                _.label = t[2];\n                _.ops.push(op);\n                break;\n              }\n              if (t[2]) _.ops.pop();\n              _.trys.pop();\n              continue;\n          }\n          op = body.call(thisArg, _);\n        } catch (e) {\n          op = [6, e];\n          y = 0;\n        } finally {\n          f = t = 0;\n        }\n        if (op[0] & 5) throw op[1];\n        return {\n          value: op[0] ? op[1] : void 0,\n          done: true\n        };\n      }\n    }\n    var Node = /** @class */function () {\n      function Node(key, data) {\n        this.next = null;\n        this.key = key;\n        this.data = data;\n        this.left = null;\n        this.right = null;\n      }\n      return Node;\n    }();\n\n    /* follows \"An implementation of top-down splaying\"\r\n     * by D. Sleator <sleator@cs.cmu.edu> March 1992\r\n     */\n    function DEFAULT_COMPARE(a, b) {\n      return a > b ? 1 : a < b ? -1 : 0;\n    }\n    /**\r\n     * Simple top down splay, not requiring i to be in the tree t.\r\n     */\n    function splay(i, t, comparator) {\n      var N = new Node(null, null);\n      var l = N;\n      var r = N;\n      while (true) {\n        var cmp = comparator(i, t.key);\n        //if (i < t.key) {\n        if (cmp < 0) {\n          if (t.left === null) break;\n          //if (i < t.left.key) {\n          if (comparator(i, t.left.key) < 0) {\n            var y = t.left; /* rotate right */\n            t.left = y.right;\n            y.right = t;\n            t = y;\n            if (t.left === null) break;\n          }\n          r.left = t; /* link right */\n          r = t;\n          t = t.left;\n          //} else if (i > t.key) {\n        } else if (cmp > 0) {\n          if (t.right === null) break;\n          //if (i > t.right.key) {\n          if (comparator(i, t.right.key) > 0) {\n            var y = t.right; /* rotate left */\n            t.right = y.left;\n            y.left = t;\n            t = y;\n            if (t.right === null) break;\n          }\n          l.right = t; /* link left */\n          l = t;\n          t = t.right;\n        } else break;\n      }\n      /* assemble */\n      l.right = t.left;\n      r.left = t.right;\n      t.left = N.right;\n      t.right = N.left;\n      return t;\n    }\n    function insert(i, data, t, comparator) {\n      var node = new Node(i, data);\n      if (t === null) {\n        node.left = node.right = null;\n        return node;\n      }\n      t = splay(i, t, comparator);\n      var cmp = comparator(i, t.key);\n      if (cmp < 0) {\n        node.left = t.left;\n        node.right = t;\n        t.left = null;\n      } else if (cmp >= 0) {\n        node.right = t.right;\n        node.left = t;\n        t.right = null;\n      }\n      return node;\n    }\n    function split(key, v, comparator) {\n      var left = null;\n      var right = null;\n      if (v) {\n        v = splay(key, v, comparator);\n        var cmp = comparator(v.key, key);\n        if (cmp === 0) {\n          left = v.left;\n          right = v.right;\n        } else if (cmp < 0) {\n          right = v.right;\n          v.right = null;\n          left = v;\n        } else {\n          left = v.left;\n          v.left = null;\n          right = v;\n        }\n      }\n      return {\n        left: left,\n        right: right\n      };\n    }\n    function merge(left, right, comparator) {\n      if (right === null) return left;\n      if (left === null) return right;\n      right = splay(left.key, right, comparator);\n      right.left = left;\n      return right;\n    }\n    /**\r\n     * Prints level of the tree\r\n     */\n    function printRow(root, prefix, isTail, out, printNode) {\n      if (root) {\n        out(\"\" + prefix + (isTail ? ' ' : ' ') + printNode(root) + \"\\n\");\n        var indent = prefix + (isTail ? '    ' : '   ');\n        if (root.left) printRow(root.left, indent, false, out, printNode);\n        if (root.right) printRow(root.right, indent, true, out, printNode);\n      }\n    }\n    var Tree = /** @class */function () {\n      function Tree(comparator) {\n        if (comparator === void 0) {\n          comparator = DEFAULT_COMPARE;\n        }\n        this._root = null;\n        this._size = 0;\n        this._comparator = comparator;\n      }\n      /**\r\n       * Inserts a key, allows duplicates\r\n       */\n      Tree.prototype.insert = function (key, data) {\n        this._size++;\n        return this._root = insert(key, data, this._root, this._comparator);\n      };\n      /**\r\n       * Adds a key, if it is not present in the tree\r\n       */\n      Tree.prototype.add = function (key, data) {\n        var node = new Node(key, data);\n        if (this._root === null) {\n          node.left = node.right = null;\n          this._size++;\n          this._root = node;\n        }\n        var comparator = this._comparator;\n        var t = splay(key, this._root, comparator);\n        var cmp = comparator(key, t.key);\n        if (cmp === 0) this._root = t;else {\n          if (cmp < 0) {\n            node.left = t.left;\n            node.right = t;\n            t.left = null;\n          } else if (cmp > 0) {\n            node.right = t.right;\n            node.left = t;\n            t.right = null;\n          }\n          this._size++;\n          this._root = node;\n        }\n        return this._root;\n      };\n      /**\r\n       * @param  {Key} key\r\n       * @return {Node|null}\r\n       */\n      Tree.prototype.remove = function (key) {\n        this._root = this._remove(key, this._root, this._comparator);\n      };\n      /**\r\n       * Deletes i from the tree if it's there\r\n       */\n      Tree.prototype._remove = function (i, t, comparator) {\n        var x;\n        if (t === null) return null;\n        t = splay(i, t, comparator);\n        var cmp = comparator(i, t.key);\n        if (cmp === 0) {\n          /* found it */\n          if (t.left === null) {\n            x = t.right;\n          } else {\n            x = splay(i, t.left, comparator);\n            x.right = t.right;\n          }\n          this._size--;\n          return x;\n        }\n        return t; /* It wasn't there */\n      };\n      /**\r\n       * Removes and returns the node with smallest key\r\n       */\n      Tree.prototype.pop = function () {\n        var node = this._root;\n        if (node) {\n          while (node.left) node = node.left;\n          this._root = splay(node.key, this._root, this._comparator);\n          this._root = this._remove(node.key, this._root, this._comparator);\n          return {\n            key: node.key,\n            data: node.data\n          };\n        }\n        return null;\n      };\n      /**\r\n       * Find without splaying\r\n       */\n      Tree.prototype.findStatic = function (key) {\n        var current = this._root;\n        var compare = this._comparator;\n        while (current) {\n          var cmp = compare(key, current.key);\n          if (cmp === 0) return current;else if (cmp < 0) current = current.left;else current = current.right;\n        }\n        return null;\n      };\n      Tree.prototype.find = function (key) {\n        if (this._root) {\n          this._root = splay(key, this._root, this._comparator);\n          if (this._comparator(key, this._root.key) !== 0) return null;\n        }\n        return this._root;\n      };\n      Tree.prototype.contains = function (key) {\n        var current = this._root;\n        var compare = this._comparator;\n        while (current) {\n          var cmp = compare(key, current.key);\n          if (cmp === 0) return true;else if (cmp < 0) current = current.left;else current = current.right;\n        }\n        return false;\n      };\n      Tree.prototype.forEach = function (visitor, ctx) {\n        var current = this._root;\n        var Q = []; /* Initialize stack s */\n        var done = false;\n        while (!done) {\n          if (current !== null) {\n            Q.push(current);\n            current = current.left;\n          } else {\n            if (Q.length !== 0) {\n              current = Q.pop();\n              visitor.call(ctx, current);\n              current = current.right;\n            } else done = true;\n          }\n        }\n        return this;\n      };\n      /**\r\n       * Walk key range from `low` to `high`. Stops if `fn` returns a value.\r\n       */\n      Tree.prototype.range = function (low, high, fn, ctx) {\n        var Q = [];\n        var compare = this._comparator;\n        var node = this._root;\n        var cmp;\n        while (Q.length !== 0 || node) {\n          if (node) {\n            Q.push(node);\n            node = node.left;\n          } else {\n            node = Q.pop();\n            cmp = compare(node.key, high);\n            if (cmp > 0) {\n              break;\n            } else if (compare(node.key, low) >= 0) {\n              if (fn.call(ctx, node)) return this; // stop if smth is returned\n            }\n            node = node.right;\n          }\n        }\n        return this;\n      };\n      /**\r\n       * Returns array of keys\r\n       */\n      Tree.prototype.keys = function () {\n        var keys = [];\n        this.forEach(function (_a) {\n          var key = _a.key;\n          return keys.push(key);\n        });\n        return keys;\n      };\n      /**\r\n       * Returns array of all the data in the nodes\r\n       */\n      Tree.prototype.values = function () {\n        var values = [];\n        this.forEach(function (_a) {\n          var data = _a.data;\n          return values.push(data);\n        });\n        return values;\n      };\n      Tree.prototype.min = function () {\n        if (this._root) return this.minNode(this._root).key;\n        return null;\n      };\n      Tree.prototype.max = function () {\n        if (this._root) return this.maxNode(this._root).key;\n        return null;\n      };\n      Tree.prototype.minNode = function (t) {\n        if (t === void 0) {\n          t = this._root;\n        }\n        if (t) while (t.left) t = t.left;\n        return t;\n      };\n      Tree.prototype.maxNode = function (t) {\n        if (t === void 0) {\n          t = this._root;\n        }\n        if (t) while (t.right) t = t.right;\n        return t;\n      };\n      /**\r\n       * Returns node at given index\r\n       */\n      Tree.prototype.at = function (index) {\n        var current = this._root;\n        var done = false;\n        var i = 0;\n        var Q = [];\n        while (!done) {\n          if (current) {\n            Q.push(current);\n            current = current.left;\n          } else {\n            if (Q.length > 0) {\n              current = Q.pop();\n              if (i === index) return current;\n              i++;\n              current = current.right;\n            } else done = true;\n          }\n        }\n        return null;\n      };\n      Tree.prototype.next = function (d) {\n        var root = this._root;\n        var successor = null;\n        if (d.right) {\n          successor = d.right;\n          while (successor.left) successor = successor.left;\n          return successor;\n        }\n        var comparator = this._comparator;\n        while (root) {\n          var cmp = comparator(d.key, root.key);\n          if (cmp === 0) break;else if (cmp < 0) {\n            successor = root;\n            root = root.left;\n          } else root = root.right;\n        }\n        return successor;\n      };\n      Tree.prototype.prev = function (d) {\n        var root = this._root;\n        var predecessor = null;\n        if (d.left !== null) {\n          predecessor = d.left;\n          while (predecessor.right) predecessor = predecessor.right;\n          return predecessor;\n        }\n        var comparator = this._comparator;\n        while (root) {\n          var cmp = comparator(d.key, root.key);\n          if (cmp === 0) break;else if (cmp < 0) root = root.left;else {\n            predecessor = root;\n            root = root.right;\n          }\n        }\n        return predecessor;\n      };\n      Tree.prototype.clear = function () {\n        this._root = null;\n        this._size = 0;\n        return this;\n      };\n      Tree.prototype.toList = function () {\n        return toList(this._root);\n      };\n      /**\r\n       * Bulk-load items. Both array have to be same size\r\n       */\n      Tree.prototype.load = function (keys, values, presort) {\n        if (values === void 0) {\n          values = [];\n        }\n        if (presort === void 0) {\n          presort = false;\n        }\n        var size = keys.length;\n        var comparator = this._comparator;\n        // sort if needed\n        if (presort) sort(keys, values, 0, size - 1, comparator);\n        if (this._root === null) {\n          // empty tree\n          this._root = loadRecursive(keys, values, 0, size);\n          this._size = size;\n        } else {\n          // that re-builds the whole tree from two in-order traversals\n          var mergedList = mergeLists(this.toList(), createList(keys, values), comparator);\n          size = this._size + size;\n          this._root = sortedListToBST({\n            head: mergedList\n          }, 0, size);\n        }\n        return this;\n      };\n      Tree.prototype.isEmpty = function () {\n        return this._root === null;\n      };\n      Object.defineProperty(Tree.prototype, \"size\", {\n        get: function () {\n          return this._size;\n        },\n        enumerable: true,\n        configurable: true\n      });\n      Object.defineProperty(Tree.prototype, \"root\", {\n        get: function () {\n          return this._root;\n        },\n        enumerable: true,\n        configurable: true\n      });\n      Tree.prototype.toString = function (printNode) {\n        if (printNode === void 0) {\n          printNode = function (n) {\n            return String(n.key);\n          };\n        }\n        var out = [];\n        printRow(this._root, '', true, function (v) {\n          return out.push(v);\n        }, printNode);\n        return out.join('');\n      };\n      Tree.prototype.update = function (key, newKey, newData) {\n        var comparator = this._comparator;\n        var _a = split(key, this._root, comparator),\n          left = _a.left,\n          right = _a.right;\n        if (comparator(key, newKey) < 0) {\n          right = insert(newKey, newData, right, comparator);\n        } else {\n          left = insert(newKey, newData, left, comparator);\n        }\n        this._root = merge(left, right, comparator);\n      };\n      Tree.prototype.split = function (key) {\n        return split(key, this._root, this._comparator);\n      };\n      Tree.prototype[Symbol.iterator] = function () {\n        var current, Q, done;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              current = this._root;\n              Q = [];\n              done = false;\n              _a.label = 1;\n            case 1:\n              if (!!done) return [3 /*break*/, 6];\n              if (!(current !== null)) return [3 /*break*/, 2];\n              Q.push(current);\n              current = current.left;\n              return [3 /*break*/, 5];\n            case 2:\n              if (!(Q.length !== 0)) return [3 /*break*/, 4];\n              current = Q.pop();\n              return [4 /*yield*/, current];\n            case 3:\n              _a.sent();\n              current = current.right;\n              return [3 /*break*/, 5];\n            case 4:\n              done = true;\n              _a.label = 5;\n            case 5:\n              return [3 /*break*/, 1];\n            case 6:\n              return [2 /*return*/];\n          }\n        });\n      };\n      return Tree;\n    }();\n    function loadRecursive(keys, values, start, end) {\n      var size = end - start;\n      if (size > 0) {\n        var middle = start + Math.floor(size / 2);\n        var key = keys[middle];\n        var data = values[middle];\n        var node = new Node(key, data);\n        node.left = loadRecursive(keys, values, start, middle);\n        node.right = loadRecursive(keys, values, middle + 1, end);\n        return node;\n      }\n      return null;\n    }\n    function createList(keys, values) {\n      var head = new Node(null, null);\n      var p = head;\n      for (var i = 0; i < keys.length; i++) {\n        p = p.next = new Node(keys[i], values[i]);\n      }\n      p.next = null;\n      return head.next;\n    }\n    function toList(root) {\n      var current = root;\n      var Q = [];\n      var done = false;\n      var head = new Node(null, null);\n      var p = head;\n      while (!done) {\n        if (current) {\n          Q.push(current);\n          current = current.left;\n        } else {\n          if (Q.length > 0) {\n            current = p = p.next = Q.pop();\n            current = current.right;\n          } else done = true;\n        }\n      }\n      p.next = null; // that'll work even if the tree was empty\n      return head.next;\n    }\n    function sortedListToBST(list, start, end) {\n      var size = end - start;\n      if (size > 0) {\n        var middle = start + Math.floor(size / 2);\n        var left = sortedListToBST(list, start, middle);\n        var root = list.head;\n        root.left = left;\n        list.head = list.head.next;\n        root.right = sortedListToBST(list, middle + 1, end);\n        return root;\n      }\n      return null;\n    }\n    function mergeLists(l1, l2, compare) {\n      var head = new Node(null, null); // dummy\n      var p = head;\n      var p1 = l1;\n      var p2 = l2;\n      while (p1 !== null && p2 !== null) {\n        if (compare(p1.key, p2.key) < 0) {\n          p.next = p1;\n          p1 = p1.next;\n        } else {\n          p.next = p2;\n          p2 = p2.next;\n        }\n        p = p.next;\n      }\n      if (p1 !== null) {\n        p.next = p1;\n      } else if (p2 !== null) {\n        p.next = p2;\n      }\n      return head.next;\n    }\n    function sort(keys, values, left, right, compare) {\n      if (left >= right) return;\n      var pivot = keys[left + right >> 1];\n      var i = left - 1;\n      var j = right + 1;\n      while (true) {\n        do i++; while (compare(keys[i], pivot) < 0);\n        do j--; while (compare(keys[j], pivot) > 0);\n        if (i >= j) break;\n        var tmp = keys[i];\n        keys[i] = keys[j];\n        keys[j] = tmp;\n        tmp = values[i];\n        values[i] = values[j];\n        values[j] = tmp;\n      }\n      sort(keys, values, left, j, compare);\n      sort(keys, values, j + 1, right, compare);\n    }\n\n    /**\n     * A bounding box has the format:\n     *\n     *  { ll: { x: xmin, y: ymin }, ur: { x: xmax, y: ymax } }\n     *\n     */\n\n    const isInBbox = (bbox, point) => {\n      return bbox.ll.x <= point.x && point.x <= bbox.ur.x && bbox.ll.y <= point.y && point.y <= bbox.ur.y;\n    };\n\n    /* Returns either null, or a bbox (aka an ordered pair of points)\n     * If there is only one point of overlap, a bbox with identical points\n     * will be returned */\n    const getBboxOverlap = (b1, b2) => {\n      // check if the bboxes overlap at all\n      if (b2.ur.x < b1.ll.x || b1.ur.x < b2.ll.x || b2.ur.y < b1.ll.y || b1.ur.y < b2.ll.y) return null;\n\n      // find the middle two X values\n      const lowerX = b1.ll.x < b2.ll.x ? b2.ll.x : b1.ll.x;\n      const upperX = b1.ur.x < b2.ur.x ? b1.ur.x : b2.ur.x;\n\n      // find the middle two Y values\n      const lowerY = b1.ll.y < b2.ll.y ? b2.ll.y : b1.ll.y;\n      const upperY = b1.ur.y < b2.ur.y ? b1.ur.y : b2.ur.y;\n\n      // put those middle values together to get the overlap\n      return {\n        ll: {\n          x: lowerX,\n          y: lowerY\n        },\n        ur: {\n          x: upperX,\n          y: upperY\n        }\n      };\n    };\n\n    /* Javascript doesn't do integer math. Everything is\n     * floating point with percision Number.EPSILON.\n     *\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/EPSILON\n     */\n\n    let epsilon$1 = Number.EPSILON;\n\n    // IE Polyfill\n    if (epsilon$1 === undefined) epsilon$1 = Math.pow(2, -52);\n    const EPSILON_SQ = epsilon$1 * epsilon$1;\n\n    /* FLP comparator */\n    const cmp = (a, b) => {\n      // check if they're both 0\n      if (-epsilon$1 < a && a < epsilon$1) {\n        if (-epsilon$1 < b && b < epsilon$1) {\n          return 0;\n        }\n      }\n\n      // check if they're flp equal\n      const ab = a - b;\n      if (ab * ab < EPSILON_SQ * a * b) {\n        return 0;\n      }\n\n      // normal comparison\n      return a < b ? -1 : 1;\n    };\n\n    /**\n     * This class rounds incoming values sufficiently so that\n     * floating points problems are, for the most part, avoided.\n     *\n     * Incoming points are have their x & y values tested against\n     * all previously seen x & y values. If either is 'too close'\n     * to a previously seen value, it's value is 'snapped' to the\n     * previously seen value.\n     *\n     * All points should be rounded by this class before being\n     * stored in any data structures in the rest of this algorithm.\n     */\n\n    class PtRounder {\n      constructor() {\n        this.reset();\n      }\n      reset() {\n        this.xRounder = new CoordRounder();\n        this.yRounder = new CoordRounder();\n      }\n      round(x, y) {\n        return {\n          x: this.xRounder.round(x),\n          y: this.yRounder.round(y)\n        };\n      }\n    }\n    class CoordRounder {\n      constructor() {\n        this.tree = new Tree();\n        // preseed with 0 so we don't end up with values < Number.EPSILON\n        this.round(0);\n      }\n\n      // Note: this can rounds input values backwards or forwards.\n      //       You might ask, why not restrict this to just rounding\n      //       forwards? Wouldn't that allow left endpoints to always\n      //       remain left endpoints during splitting (never change to\n      //       right). No - it wouldn't, because we snap intersections\n      //       to endpoints (to establish independence from the segment\n      //       angle for t-intersections).\n      round(coord) {\n        const node = this.tree.add(coord);\n        const prevNode = this.tree.prev(node);\n        if (prevNode !== null && cmp(node.key, prevNode.key) === 0) {\n          this.tree.remove(coord);\n          return prevNode.key;\n        }\n        const nextNode = this.tree.next(node);\n        if (nextNode !== null && cmp(node.key, nextNode.key) === 0) {\n          this.tree.remove(coord);\n          return nextNode.key;\n        }\n        return coord;\n      }\n    }\n\n    // singleton available by import\n    const rounder = new PtRounder();\n\n    const epsilon = 1.1102230246251565e-16;\n    const splitter = 134217729;\n    const resulterrbound = (3 + 8 * epsilon) * epsilon;\n\n    // fast_expansion_sum_zeroelim routine from oritinal code\n    function sum(elen, e, flen, f, h) {\n      let Q, Qnew, hh, bvirt;\n      let enow = e[0];\n      let fnow = f[0];\n      let eindex = 0;\n      let findex = 0;\n      if (fnow > enow === fnow > -enow) {\n        Q = enow;\n        enow = e[++eindex];\n      } else {\n        Q = fnow;\n        fnow = f[++findex];\n      }\n      let hindex = 0;\n      if (eindex < elen && findex < flen) {\n        if (fnow > enow === fnow > -enow) {\n          Qnew = enow + Q;\n          hh = Q - (Qnew - enow);\n          enow = e[++eindex];\n        } else {\n          Qnew = fnow + Q;\n          hh = Q - (Qnew - fnow);\n          fnow = f[++findex];\n        }\n        Q = Qnew;\n        if (hh !== 0) {\n          h[hindex++] = hh;\n        }\n        while (eindex < elen && findex < flen) {\n          if (fnow > enow === fnow > -enow) {\n            Qnew = Q + enow;\n            bvirt = Qnew - Q;\n            hh = Q - (Qnew - bvirt) + (enow - bvirt);\n            enow = e[++eindex];\n          } else {\n            Qnew = Q + fnow;\n            bvirt = Qnew - Q;\n            hh = Q - (Qnew - bvirt) + (fnow - bvirt);\n            fnow = f[++findex];\n          }\n          Q = Qnew;\n          if (hh !== 0) {\n            h[hindex++] = hh;\n          }\n        }\n      }\n      while (eindex < elen) {\n        Qnew = Q + enow;\n        bvirt = Qnew - Q;\n        hh = Q - (Qnew - bvirt) + (enow - bvirt);\n        enow = e[++eindex];\n        Q = Qnew;\n        if (hh !== 0) {\n          h[hindex++] = hh;\n        }\n      }\n      while (findex < flen) {\n        Qnew = Q + fnow;\n        bvirt = Qnew - Q;\n        hh = Q - (Qnew - bvirt) + (fnow - bvirt);\n        fnow = f[++findex];\n        Q = Qnew;\n        if (hh !== 0) {\n          h[hindex++] = hh;\n        }\n      }\n      if (Q !== 0 || hindex === 0) {\n        h[hindex++] = Q;\n      }\n      return hindex;\n    }\n    function estimate(elen, e) {\n      let Q = e[0];\n      for (let i = 1; i < elen; i++) Q += e[i];\n      return Q;\n    }\n    function vec(n) {\n      return new Float64Array(n);\n    }\n\n    const ccwerrboundA = (3 + 16 * epsilon) * epsilon;\n    const ccwerrboundB = (2 + 12 * epsilon) * epsilon;\n    const ccwerrboundC = (9 + 64 * epsilon) * epsilon * epsilon;\n    const B = vec(4);\n    const C1 = vec(8);\n    const C2 = vec(12);\n    const D = vec(16);\n    const u = vec(4);\n    function orient2dadapt(ax, ay, bx, by, cx, cy, detsum) {\n      let acxtail, acytail, bcxtail, bcytail;\n      let bvirt, c, ahi, alo, bhi, blo, _i, _j, _0, s1, s0, t1, t0, u3;\n      const acx = ax - cx;\n      const bcx = bx - cx;\n      const acy = ay - cy;\n      const bcy = by - cy;\n      s1 = acx * bcy;\n      c = splitter * acx;\n      ahi = c - (c - acx);\n      alo = acx - ahi;\n      c = splitter * bcy;\n      bhi = c - (c - bcy);\n      blo = bcy - bhi;\n      s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\n      t1 = acy * bcx;\n      c = splitter * acy;\n      ahi = c - (c - acy);\n      alo = acy - ahi;\n      c = splitter * bcx;\n      bhi = c - (c - bcx);\n      blo = bcx - bhi;\n      t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\n      _i = s0 - t0;\n      bvirt = s0 - _i;\n      B[0] = s0 - (_i + bvirt) + (bvirt - t0);\n      _j = s1 + _i;\n      bvirt = _j - s1;\n      _0 = s1 - (_j - bvirt) + (_i - bvirt);\n      _i = _0 - t1;\n      bvirt = _0 - _i;\n      B[1] = _0 - (_i + bvirt) + (bvirt - t1);\n      u3 = _j + _i;\n      bvirt = u3 - _j;\n      B[2] = _j - (u3 - bvirt) + (_i - bvirt);\n      B[3] = u3;\n      let det = estimate(4, B);\n      let errbound = ccwerrboundB * detsum;\n      if (det >= errbound || -det >= errbound) {\n        return det;\n      }\n      bvirt = ax - acx;\n      acxtail = ax - (acx + bvirt) + (bvirt - cx);\n      bvirt = bx - bcx;\n      bcxtail = bx - (bcx + bvirt) + (bvirt - cx);\n      bvirt = ay - acy;\n      acytail = ay - (acy + bvirt) + (bvirt - cy);\n      bvirt = by - bcy;\n      bcytail = by - (bcy + bvirt) + (bvirt - cy);\n      if (acxtail === 0 && acytail === 0 && bcxtail === 0 && bcytail === 0) {\n        return det;\n      }\n      errbound = ccwerrboundC * detsum + resulterrbound * Math.abs(det);\n      det += acx * bcytail + bcy * acxtail - (acy * bcxtail + bcx * acytail);\n      if (det >= errbound || -det >= errbound) return det;\n      s1 = acxtail * bcy;\n      c = splitter * acxtail;\n      ahi = c - (c - acxtail);\n      alo = acxtail - ahi;\n      c = splitter * bcy;\n      bhi = c - (c - bcy);\n      blo = bcy - bhi;\n      s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\n      t1 = acytail * bcx;\n      c = splitter * acytail;\n      ahi = c - (c - acytail);\n      alo = acytail - ahi;\n      c = splitter * bcx;\n      bhi = c - (c - bcx);\n      blo = bcx - bhi;\n      t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\n      _i = s0 - t0;\n      bvirt = s0 - _i;\n      u[0] = s0 - (_i + bvirt) + (bvirt - t0);\n      _j = s1 + _i;\n      bvirt = _j - s1;\n      _0 = s1 - (_j - bvirt) + (_i - bvirt);\n      _i = _0 - t1;\n      bvirt = _0 - _i;\n      u[1] = _0 - (_i + bvirt) + (bvirt - t1);\n      u3 = _j + _i;\n      bvirt = u3 - _j;\n      u[2] = _j - (u3 - bvirt) + (_i - bvirt);\n      u[3] = u3;\n      const C1len = sum(4, B, 4, u, C1);\n      s1 = acx * bcytail;\n      c = splitter * acx;\n      ahi = c - (c - acx);\n      alo = acx - ahi;\n      c = splitter * bcytail;\n      bhi = c - (c - bcytail);\n      blo = bcytail - bhi;\n      s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\n      t1 = acy * bcxtail;\n      c = splitter * acy;\n      ahi = c - (c - acy);\n      alo = acy - ahi;\n      c = splitter * bcxtail;\n      bhi = c - (c - bcxtail);\n      blo = bcxtail - bhi;\n      t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\n      _i = s0 - t0;\n      bvirt = s0 - _i;\n      u[0] = s0 - (_i + bvirt) + (bvirt - t0);\n      _j = s1 + _i;\n      bvirt = _j - s1;\n      _0 = s1 - (_j - bvirt) + (_i - bvirt);\n      _i = _0 - t1;\n      bvirt = _0 - _i;\n      u[1] = _0 - (_i + bvirt) + (bvirt - t1);\n      u3 = _j + _i;\n      bvirt = u3 - _j;\n      u[2] = _j - (u3 - bvirt) + (_i - bvirt);\n      u[3] = u3;\n      const C2len = sum(C1len, C1, 4, u, C2);\n      s1 = acxtail * bcytail;\n      c = splitter * acxtail;\n      ahi = c - (c - acxtail);\n      alo = acxtail - ahi;\n      c = splitter * bcytail;\n      bhi = c - (c - bcytail);\n      blo = bcytail - bhi;\n      s0 = alo * blo - (s1 - ahi * bhi - alo * bhi - ahi * blo);\n      t1 = acytail * bcxtail;\n      c = splitter * acytail;\n      ahi = c - (c - acytail);\n      alo = acytail - ahi;\n      c = splitter * bcxtail;\n      bhi = c - (c - bcxtail);\n      blo = bcxtail - bhi;\n      t0 = alo * blo - (t1 - ahi * bhi - alo * bhi - ahi * blo);\n      _i = s0 - t0;\n      bvirt = s0 - _i;\n      u[0] = s0 - (_i + bvirt) + (bvirt - t0);\n      _j = s1 + _i;\n      bvirt = _j - s1;\n      _0 = s1 - (_j - bvirt) + (_i - bvirt);\n      _i = _0 - t1;\n      bvirt = _0 - _i;\n      u[1] = _0 - (_i + bvirt) + (bvirt - t1);\n      u3 = _j + _i;\n      bvirt = u3 - _j;\n      u[2] = _j - (u3 - bvirt) + (_i - bvirt);\n      u[3] = u3;\n      const Dlen = sum(C2len, C2, 4, u, D);\n      return D[Dlen - 1];\n    }\n    function orient2d(ax, ay, bx, by, cx, cy) {\n      const detleft = (ay - cy) * (bx - cx);\n      const detright = (ax - cx) * (by - cy);\n      const det = detleft - detright;\n      const detsum = Math.abs(detleft + detright);\n      if (Math.abs(det) >= ccwerrboundA * detsum) return det;\n      return -orient2dadapt(ax, ay, bx, by, cx, cy, detsum);\n    }\n\n    /* Cross Product of two vectors with first point at origin */\n    const crossProduct = (a, b) => a.x * b.y - a.y * b.x;\n\n    /* Dot Product of two vectors with first point at origin */\n    const dotProduct = (a, b) => a.x * b.x + a.y * b.y;\n\n    /* Comparator for two vectors with same starting point */\n    const compareVectorAngles = (basePt, endPt1, endPt2) => {\n      const res = orient2d(basePt.x, basePt.y, endPt1.x, endPt1.y, endPt2.x, endPt2.y);\n      if (res > 0) return -1;\n      if (res < 0) return 1;\n      return 0;\n    };\n    const length = v => Math.sqrt(dotProduct(v, v));\n\n    /* Get the sine of the angle from pShared -> pAngle to pShaed -> pBase */\n    const sineOfAngle = (pShared, pBase, pAngle) => {\n      const vBase = {\n        x: pBase.x - pShared.x,\n        y: pBase.y - pShared.y\n      };\n      const vAngle = {\n        x: pAngle.x - pShared.x,\n        y: pAngle.y - pShared.y\n      };\n      return crossProduct(vAngle, vBase) / length(vAngle) / length(vBase);\n    };\n\n    /* Get the cosine of the angle from pShared -> pAngle to pShaed -> pBase */\n    const cosineOfAngle = (pShared, pBase, pAngle) => {\n      const vBase = {\n        x: pBase.x - pShared.x,\n        y: pBase.y - pShared.y\n      };\n      const vAngle = {\n        x: pAngle.x - pShared.x,\n        y: pAngle.y - pShared.y\n      };\n      return dotProduct(vAngle, vBase) / length(vAngle) / length(vBase);\n    };\n\n    /* Get the x coordinate where the given line (defined by a point and vector)\n     * crosses the horizontal line with the given y coordiante.\n     * In the case of parrallel lines (including overlapping ones) returns null. */\n    const horizontalIntersection = (pt, v, y) => {\n      if (v.y === 0) return null;\n      return {\n        x: pt.x + v.x / v.y * (y - pt.y),\n        y: y\n      };\n    };\n\n    /* Get the y coordinate where the given line (defined by a point and vector)\n     * crosses the vertical line with the given x coordiante.\n     * In the case of parrallel lines (including overlapping ones) returns null. */\n    const verticalIntersection = (pt, v, x) => {\n      if (v.x === 0) return null;\n      return {\n        x: x,\n        y: pt.y + v.y / v.x * (x - pt.x)\n      };\n    };\n\n    /* Get the intersection of two lines, each defined by a base point and a vector.\n     * In the case of parrallel lines (including overlapping ones) returns null. */\n    const intersection$1 = (pt1, v1, pt2, v2) => {\n      // take some shortcuts for vertical and horizontal lines\n      // this also ensures we don't calculate an intersection and then discover\n      // it's actually outside the bounding box of the line\n      if (v1.x === 0) return verticalIntersection(pt2, v2, pt1.x);\n      if (v2.x === 0) return verticalIntersection(pt1, v1, pt2.x);\n      if (v1.y === 0) return horizontalIntersection(pt2, v2, pt1.y);\n      if (v2.y === 0) return horizontalIntersection(pt1, v1, pt2.y);\n\n      // General case for non-overlapping segments.\n      // This algorithm is based on Schneider and Eberly.\n      // http://www.cimec.org.ar/~ncalvo/Schneider_Eberly.pdf - pg 244\n\n      const kross = crossProduct(v1, v2);\n      if (kross == 0) return null;\n      const ve = {\n        x: pt2.x - pt1.x,\n        y: pt2.y - pt1.y\n      };\n      const d1 = crossProduct(ve, v1) / kross;\n      const d2 = crossProduct(ve, v2) / kross;\n\n      // take the average of the two calculations to minimize rounding error\n      const x1 = pt1.x + d2 * v1.x,\n        x2 = pt2.x + d1 * v2.x;\n      const y1 = pt1.y + d2 * v1.y,\n        y2 = pt2.y + d1 * v2.y;\n      const x = (x1 + x2) / 2;\n      const y = (y1 + y2) / 2;\n      return {\n        x: x,\n        y: y\n      };\n    };\n\n    class SweepEvent {\n      // for ordering sweep events in the sweep event queue\n      static compare(a, b) {\n        // favor event with a point that the sweep line hits first\n        const ptCmp = SweepEvent.comparePoints(a.point, b.point);\n        if (ptCmp !== 0) return ptCmp;\n\n        // the points are the same, so link them if needed\n        if (a.point !== b.point) a.link(b);\n\n        // favor right events over left\n        if (a.isLeft !== b.isLeft) return a.isLeft ? 1 : -1;\n\n        // we have two matching left or right endpoints\n        // ordering of this case is the same as for their segments\n        return Segment.compare(a.segment, b.segment);\n      }\n\n      // for ordering points in sweep line order\n      static comparePoints(aPt, bPt) {\n        if (aPt.x < bPt.x) return -1;\n        if (aPt.x > bPt.x) return 1;\n        if (aPt.y < bPt.y) return -1;\n        if (aPt.y > bPt.y) return 1;\n        return 0;\n      }\n\n      // Warning: 'point' input will be modified and re-used (for performance)\n      constructor(point, isLeft) {\n        if (point.events === undefined) point.events = [this];else point.events.push(this);\n        this.point = point;\n        this.isLeft = isLeft;\n        // this.segment, this.otherSE set by factory\n      }\n      link(other) {\n        if (other.point === this.point) {\n          throw new Error(\"Tried to link already linked events\");\n        }\n        const otherEvents = other.point.events;\n        for (let i = 0, iMax = otherEvents.length; i < iMax; i++) {\n          const evt = otherEvents[i];\n          this.point.events.push(evt);\n          evt.point = this.point;\n        }\n        this.checkForConsuming();\n      }\n\n      /* Do a pass over our linked events and check to see if any pair\n       * of segments match, and should be consumed. */\n      checkForConsuming() {\n        // FIXME: The loops in this method run O(n^2) => no good.\n        //        Maintain little ordered sweep event trees?\n        //        Can we maintaining an ordering that avoids the need\n        //        for the re-sorting with getLeftmostComparator in geom-out?\n\n        // Compare each pair of events to see if other events also match\n        const numEvents = this.point.events.length;\n        for (let i = 0; i < numEvents; i++) {\n          const evt1 = this.point.events[i];\n          if (evt1.segment.consumedBy !== undefined) continue;\n          for (let j = i + 1; j < numEvents; j++) {\n            const evt2 = this.point.events[j];\n            if (evt2.consumedBy !== undefined) continue;\n            if (evt1.otherSE.point.events !== evt2.otherSE.point.events) continue;\n            evt1.segment.consume(evt2.segment);\n          }\n        }\n      }\n      getAvailableLinkedEvents() {\n        // point.events is always of length 2 or greater\n        const events = [];\n        for (let i = 0, iMax = this.point.events.length; i < iMax; i++) {\n          const evt = this.point.events[i];\n          if (evt !== this && !evt.segment.ringOut && evt.segment.isInResult()) {\n            events.push(evt);\n          }\n        }\n        return events;\n      }\n\n      /**\n       * Returns a comparator function for sorting linked events that will\n       * favor the event that will give us the smallest left-side angle.\n       * All ring construction starts as low as possible heading to the right,\n       * so by always turning left as sharp as possible we'll get polygons\n       * without uncessary loops & holes.\n       *\n       * The comparator function has a compute cache such that it avoids\n       * re-computing already-computed values.\n       */\n      getLeftmostComparator(baseEvent) {\n        const cache = new Map();\n        const fillCache = linkedEvent => {\n          const nextEvent = linkedEvent.otherSE;\n          cache.set(linkedEvent, {\n            sine: sineOfAngle(this.point, baseEvent.point, nextEvent.point),\n            cosine: cosineOfAngle(this.point, baseEvent.point, nextEvent.point)\n          });\n        };\n        return (a, b) => {\n          if (!cache.has(a)) fillCache(a);\n          if (!cache.has(b)) fillCache(b);\n          const {\n            sine: asine,\n            cosine: acosine\n          } = cache.get(a);\n          const {\n            sine: bsine,\n            cosine: bcosine\n          } = cache.get(b);\n\n          // both on or above x-axis\n          if (asine >= 0 && bsine >= 0) {\n            if (acosine < bcosine) return 1;\n            if (acosine > bcosine) return -1;\n            return 0;\n          }\n\n          // both below x-axis\n          if (asine < 0 && bsine < 0) {\n            if (acosine < bcosine) return -1;\n            if (acosine > bcosine) return 1;\n            return 0;\n          }\n\n          // one above x-axis, one below\n          if (bsine < asine) return -1;\n          if (bsine > asine) return 1;\n          return 0;\n        };\n      }\n    }\n\n    // Give segments unique ID's to get consistent sorting of\n    // segments and sweep events when all else is identical\n    let segmentId = 0;\n    class Segment {\n      /* This compare() function is for ordering segments in the sweep\n       * line tree, and does so according to the following criteria:\n       *\n       * Consider the vertical line that lies an infinestimal step to the\n       * right of the right-more of the two left endpoints of the input\n       * segments. Imagine slowly moving a point up from negative infinity\n       * in the increasing y direction. Which of the two segments will that\n       * point intersect first? That segment comes 'before' the other one.\n       *\n       * If neither segment would be intersected by such a line, (if one\n       * or more of the segments are vertical) then the line to be considered\n       * is directly on the right-more of the two left inputs.\n       */\n      static compare(a, b) {\n        const alx = a.leftSE.point.x;\n        const blx = b.leftSE.point.x;\n        const arx = a.rightSE.point.x;\n        const brx = b.rightSE.point.x;\n\n        // check if they're even in the same vertical plane\n        if (brx < alx) return 1;\n        if (arx < blx) return -1;\n        const aly = a.leftSE.point.y;\n        const bly = b.leftSE.point.y;\n        const ary = a.rightSE.point.y;\n        const bry = b.rightSE.point.y;\n\n        // is left endpoint of segment B the right-more?\n        if (alx < blx) {\n          // are the two segments in the same horizontal plane?\n          if (bly < aly && bly < ary) return 1;\n          if (bly > aly && bly > ary) return -1;\n\n          // is the B left endpoint colinear to segment A?\n          const aCmpBLeft = a.comparePoint(b.leftSE.point);\n          if (aCmpBLeft < 0) return 1;\n          if (aCmpBLeft > 0) return -1;\n\n          // is the A right endpoint colinear to segment B ?\n          const bCmpARight = b.comparePoint(a.rightSE.point);\n          if (bCmpARight !== 0) return bCmpARight;\n\n          // colinear segments, consider the one with left-more\n          // left endpoint to be first (arbitrary?)\n          return -1;\n        }\n\n        // is left endpoint of segment A the right-more?\n        if (alx > blx) {\n          if (aly < bly && aly < bry) return -1;\n          if (aly > bly && aly > bry) return 1;\n\n          // is the A left endpoint colinear to segment B?\n          const bCmpALeft = b.comparePoint(a.leftSE.point);\n          if (bCmpALeft !== 0) return bCmpALeft;\n\n          // is the B right endpoint colinear to segment A?\n          const aCmpBRight = a.comparePoint(b.rightSE.point);\n          if (aCmpBRight < 0) return 1;\n          if (aCmpBRight > 0) return -1;\n\n          // colinear segments, consider the one with left-more\n          // left endpoint to be first (arbitrary?)\n          return 1;\n        }\n\n        // if we get here, the two left endpoints are in the same\n        // vertical plane, ie alx === blx\n\n        // consider the lower left-endpoint to come first\n        if (aly < bly) return -1;\n        if (aly > bly) return 1;\n\n        // left endpoints are identical\n        // check for colinearity by using the left-more right endpoint\n\n        // is the A right endpoint more left-more?\n        if (arx < brx) {\n          const bCmpARight = b.comparePoint(a.rightSE.point);\n          if (bCmpARight !== 0) return bCmpARight;\n        }\n\n        // is the B right endpoint more left-more?\n        if (arx > brx) {\n          const aCmpBRight = a.comparePoint(b.rightSE.point);\n          if (aCmpBRight < 0) return 1;\n          if (aCmpBRight > 0) return -1;\n        }\n        if (arx !== brx) {\n          // are these two [almost] vertical segments with opposite orientation?\n          // if so, the one with the lower right endpoint comes first\n          const ay = ary - aly;\n          const ax = arx - alx;\n          const by = bry - bly;\n          const bx = brx - blx;\n          if (ay > ax && by < bx) return 1;\n          if (ay < ax && by > bx) return -1;\n        }\n\n        // we have colinear segments with matching orientation\n        // consider the one with more left-more right endpoint to be first\n        if (arx > brx) return 1;\n        if (arx < brx) return -1;\n\n        // if we get here, two two right endpoints are in the same\n        // vertical plane, ie arx === brx\n\n        // consider the lower right-endpoint to come first\n        if (ary < bry) return -1;\n        if (ary > bry) return 1;\n\n        // right endpoints identical as well, so the segments are idential\n        // fall back on creation order as consistent tie-breaker\n        if (a.id < b.id) return -1;\n        if (a.id > b.id) return 1;\n\n        // identical segment, ie a === b\n        return 0;\n      }\n\n      /* Warning: a reference to ringWindings input will be stored,\n       *  and possibly will be later modified */\n      constructor(leftSE, rightSE, rings, windings) {\n        this.id = ++segmentId;\n        this.leftSE = leftSE;\n        leftSE.segment = this;\n        leftSE.otherSE = rightSE;\n        this.rightSE = rightSE;\n        rightSE.segment = this;\n        rightSE.otherSE = leftSE;\n        this.rings = rings;\n        this.windings = windings;\n        // left unset for performance, set later in algorithm\n        // this.ringOut, this.consumedBy, this.prev\n      }\n      static fromRing(pt1, pt2, ring) {\n        let leftPt, rightPt, winding;\n\n        // ordering the two points according to sweep line ordering\n        const cmpPts = SweepEvent.comparePoints(pt1, pt2);\n        if (cmpPts < 0) {\n          leftPt = pt1;\n          rightPt = pt2;\n          winding = 1;\n        } else if (cmpPts > 0) {\n          leftPt = pt2;\n          rightPt = pt1;\n          winding = -1;\n        } else throw new Error(`Tried to create degenerate segment at [${pt1.x}, ${pt1.y}]`);\n        const leftSE = new SweepEvent(leftPt, true);\n        const rightSE = new SweepEvent(rightPt, false);\n        return new Segment(leftSE, rightSE, [ring], [winding]);\n      }\n\n      /* When a segment is split, the rightSE is replaced with a new sweep event */\n      replaceRightSE(newRightSE) {\n        this.rightSE = newRightSE;\n        this.rightSE.segment = this;\n        this.rightSE.otherSE = this.leftSE;\n        this.leftSE.otherSE = this.rightSE;\n      }\n      bbox() {\n        const y1 = this.leftSE.point.y;\n        const y2 = this.rightSE.point.y;\n        return {\n          ll: {\n            x: this.leftSE.point.x,\n            y: y1 < y2 ? y1 : y2\n          },\n          ur: {\n            x: this.rightSE.point.x,\n            y: y1 > y2 ? y1 : y2\n          }\n        };\n      }\n\n      /* A vector from the left point to the right */\n      vector() {\n        return {\n          x: this.rightSE.point.x - this.leftSE.point.x,\n          y: this.rightSE.point.y - this.leftSE.point.y\n        };\n      }\n      isAnEndpoint(pt) {\n        return pt.x === this.leftSE.point.x && pt.y === this.leftSE.point.y || pt.x === this.rightSE.point.x && pt.y === this.rightSE.point.y;\n      }\n\n      /* Compare this segment with a point.\n       *\n       * A point P is considered to be colinear to a segment if there\n       * exists a distance D such that if we travel along the segment\n       * from one * endpoint towards the other a distance D, we find\n       * ourselves at point P.\n       *\n       * Return value indicates:\n       *\n       *   1: point lies above the segment (to the left of vertical)\n       *   0: point is colinear to segment\n       *  -1: point lies below the segment (to the right of vertical)\n       */\n      comparePoint(point) {\n        if (this.isAnEndpoint(point)) return 0;\n        const lPt = this.leftSE.point;\n        const rPt = this.rightSE.point;\n        const v = this.vector();\n\n        // Exactly vertical segments.\n        if (lPt.x === rPt.x) {\n          if (point.x === lPt.x) return 0;\n          return point.x < lPt.x ? 1 : -1;\n        }\n\n        // Nearly vertical segments with an intersection.\n        // Check to see where a point on the line with matching Y coordinate is.\n        const yDist = (point.y - lPt.y) / v.y;\n        const xFromYDist = lPt.x + yDist * v.x;\n        if (point.x === xFromYDist) return 0;\n\n        // General case.\n        // Check to see where a point on the line with matching X coordinate is.\n        const xDist = (point.x - lPt.x) / v.x;\n        const yFromXDist = lPt.y + xDist * v.y;\n        if (point.y === yFromXDist) return 0;\n        return point.y < yFromXDist ? -1 : 1;\n      }\n\n      /**\n       * Given another segment, returns the first non-trivial intersection\n       * between the two segments (in terms of sweep line ordering), if it exists.\n       *\n       * A 'non-trivial' intersection is one that will cause one or both of the\n       * segments to be split(). As such, 'trivial' vs. 'non-trivial' intersection:\n       *\n       *   * endpoint of segA with endpoint of segB --> trivial\n       *   * endpoint of segA with point along segB --> non-trivial\n       *   * endpoint of segB with point along segA --> non-trivial\n       *   * point along segA with point along segB --> non-trivial\n       *\n       * If no non-trivial intersection exists, return null\n       * Else, return null.\n       */\n      getIntersection(other) {\n        // If bboxes don't overlap, there can't be any intersections\n        const tBbox = this.bbox();\n        const oBbox = other.bbox();\n        const bboxOverlap = getBboxOverlap(tBbox, oBbox);\n        if (bboxOverlap === null) return null;\n\n        // We first check to see if the endpoints can be considered intersections.\n        // This will 'snap' intersections to endpoints if possible, and will\n        // handle cases of colinearity.\n\n        const tlp = this.leftSE.point;\n        const trp = this.rightSE.point;\n        const olp = other.leftSE.point;\n        const orp = other.rightSE.point;\n\n        // does each endpoint touch the other segment?\n        // note that we restrict the 'touching' definition to only allow segments\n        // to touch endpoints that lie forward from where we are in the sweep line pass\n        const touchesOtherLSE = isInBbox(tBbox, olp) && this.comparePoint(olp) === 0;\n        const touchesThisLSE = isInBbox(oBbox, tlp) && other.comparePoint(tlp) === 0;\n        const touchesOtherRSE = isInBbox(tBbox, orp) && this.comparePoint(orp) === 0;\n        const touchesThisRSE = isInBbox(oBbox, trp) && other.comparePoint(trp) === 0;\n\n        // do left endpoints match?\n        if (touchesThisLSE && touchesOtherLSE) {\n          // these two cases are for colinear segments with matching left\n          // endpoints, and one segment being longer than the other\n          if (touchesThisRSE && !touchesOtherRSE) return trp;\n          if (!touchesThisRSE && touchesOtherRSE) return orp;\n          // either the two segments match exactly (two trival intersections)\n          // or just on their left endpoint (one trivial intersection\n          return null;\n        }\n\n        // does this left endpoint matches (other doesn't)\n        if (touchesThisLSE) {\n          // check for segments that just intersect on opposing endpoints\n          if (touchesOtherRSE) {\n            if (tlp.x === orp.x && tlp.y === orp.y) return null;\n          }\n          // t-intersection on left endpoint\n          return tlp;\n        }\n\n        // does other left endpoint matches (this doesn't)\n        if (touchesOtherLSE) {\n          // check for segments that just intersect on opposing endpoints\n          if (touchesThisRSE) {\n            if (trp.x === olp.x && trp.y === olp.y) return null;\n          }\n          // t-intersection on left endpoint\n          return olp;\n        }\n\n        // trivial intersection on right endpoints\n        if (touchesThisRSE && touchesOtherRSE) return null;\n\n        // t-intersections on just one right endpoint\n        if (touchesThisRSE) return trp;\n        if (touchesOtherRSE) return orp;\n\n        // None of our endpoints intersect. Look for a general intersection between\n        // infinite lines laid over the segments\n        const pt = intersection$1(tlp, this.vector(), olp, other.vector());\n\n        // are the segments parrallel? Note that if they were colinear with overlap,\n        // they would have an endpoint intersection and that case was already handled above\n        if (pt === null) return null;\n\n        // is the intersection found between the lines not on the segments?\n        if (!isInBbox(bboxOverlap, pt)) return null;\n\n        // round the the computed point if needed\n        return rounder.round(pt.x, pt.y);\n      }\n\n      /**\n       * Split the given segment into multiple segments on the given points.\n       *  * Each existing segment will retain its leftSE and a new rightSE will be\n       *    generated for it.\n       *  * A new segment will be generated which will adopt the original segment's\n       *    rightSE, and a new leftSE will be generated for it.\n       *  * If there are more than two points given to split on, new segments\n       *    in the middle will be generated with new leftSE and rightSE's.\n       *  * An array of the newly generated SweepEvents will be returned.\n       *\n       * Warning: input array of points is modified\n       */\n      split(point) {\n        const newEvents = [];\n        const alreadyLinked = point.events !== undefined;\n        const newLeftSE = new SweepEvent(point, true);\n        const newRightSE = new SweepEvent(point, false);\n        const oldRightSE = this.rightSE;\n        this.replaceRightSE(newRightSE);\n        newEvents.push(newRightSE);\n        newEvents.push(newLeftSE);\n        const newSeg = new Segment(newLeftSE, oldRightSE, this.rings.slice(), this.windings.slice());\n\n        // when splitting a nearly vertical downward-facing segment,\n        // sometimes one of the resulting new segments is vertical, in which\n        // case its left and right events may need to be swapped\n        if (SweepEvent.comparePoints(newSeg.leftSE.point, newSeg.rightSE.point) > 0) {\n          newSeg.swapEvents();\n        }\n        if (SweepEvent.comparePoints(this.leftSE.point, this.rightSE.point) > 0) {\n          this.swapEvents();\n        }\n\n        // in the point we just used to create new sweep events with was already\n        // linked to other events, we need to check if either of the affected\n        // segments should be consumed\n        if (alreadyLinked) {\n          newLeftSE.checkForConsuming();\n          newRightSE.checkForConsuming();\n        }\n        return newEvents;\n      }\n\n      /* Swap which event is left and right */\n      swapEvents() {\n        const tmpEvt = this.rightSE;\n        this.rightSE = this.leftSE;\n        this.leftSE = tmpEvt;\n        this.leftSE.isLeft = true;\n        this.rightSE.isLeft = false;\n        for (let i = 0, iMax = this.windings.length; i < iMax; i++) {\n          this.windings[i] *= -1;\n        }\n      }\n\n      /* Consume another segment. We take their rings under our wing\n       * and mark them as consumed. Use for perfectly overlapping segments */\n      consume(other) {\n        let consumer = this;\n        let consumee = other;\n        while (consumer.consumedBy) consumer = consumer.consumedBy;\n        while (consumee.consumedBy) consumee = consumee.consumedBy;\n        const cmp = Segment.compare(consumer, consumee);\n        if (cmp === 0) return; // already consumed\n        // the winner of the consumption is the earlier segment\n        // according to sweep line ordering\n        if (cmp > 0) {\n          const tmp = consumer;\n          consumer = consumee;\n          consumee = tmp;\n        }\n\n        // make sure a segment doesn't consume it's prev\n        if (consumer.prev === consumee) {\n          const tmp = consumer;\n          consumer = consumee;\n          consumee = tmp;\n        }\n        for (let i = 0, iMax = consumee.rings.length; i < iMax; i++) {\n          const ring = consumee.rings[i];\n          const winding = consumee.windings[i];\n          const index = consumer.rings.indexOf(ring);\n          if (index === -1) {\n            consumer.rings.push(ring);\n            consumer.windings.push(winding);\n          } else consumer.windings[index] += winding;\n        }\n        consumee.rings = null;\n        consumee.windings = null;\n        consumee.consumedBy = consumer;\n\n        // mark sweep events consumed as to maintain ordering in sweep event queue\n        consumee.leftSE.consumedBy = consumer.leftSE;\n        consumee.rightSE.consumedBy = consumer.rightSE;\n      }\n\n      /* The first segment previous segment chain that is in the result */\n      prevInResult() {\n        if (this._prevInResult !== undefined) return this._prevInResult;\n        if (!this.prev) this._prevInResult = null;else if (this.prev.isInResult()) this._prevInResult = this.prev;else this._prevInResult = this.prev.prevInResult();\n        return this._prevInResult;\n      }\n      beforeState() {\n        if (this._beforeState !== undefined) return this._beforeState;\n        if (!this.prev) this._beforeState = {\n          rings: [],\n          windings: [],\n          multiPolys: []\n        };else {\n          const seg = this.prev.consumedBy || this.prev;\n          this._beforeState = seg.afterState();\n        }\n        return this._beforeState;\n      }\n      afterState() {\n        if (this._afterState !== undefined) return this._afterState;\n        const beforeState = this.beforeState();\n        this._afterState = {\n          rings: beforeState.rings.slice(0),\n          windings: beforeState.windings.slice(0),\n          multiPolys: []\n        };\n        const ringsAfter = this._afterState.rings;\n        const windingsAfter = this._afterState.windings;\n        const mpsAfter = this._afterState.multiPolys;\n\n        // calculate ringsAfter, windingsAfter\n        for (let i = 0, iMax = this.rings.length; i < iMax; i++) {\n          const ring = this.rings[i];\n          const winding = this.windings[i];\n          const index = ringsAfter.indexOf(ring);\n          if (index === -1) {\n            ringsAfter.push(ring);\n            windingsAfter.push(winding);\n          } else windingsAfter[index] += winding;\n        }\n\n        // calcualte polysAfter\n        const polysAfter = [];\n        const polysExclude = [];\n        for (let i = 0, iMax = ringsAfter.length; i < iMax; i++) {\n          if (windingsAfter[i] === 0) continue; // non-zero rule\n          const ring = ringsAfter[i];\n          const poly = ring.poly;\n          if (polysExclude.indexOf(poly) !== -1) continue;\n          if (ring.isExterior) polysAfter.push(poly);else {\n            if (polysExclude.indexOf(poly) === -1) polysExclude.push(poly);\n            const index = polysAfter.indexOf(ring.poly);\n            if (index !== -1) polysAfter.splice(index, 1);\n          }\n        }\n\n        // calculate multiPolysAfter\n        for (let i = 0, iMax = polysAfter.length; i < iMax; i++) {\n          const mp = polysAfter[i].multiPoly;\n          if (mpsAfter.indexOf(mp) === -1) mpsAfter.push(mp);\n        }\n        return this._afterState;\n      }\n\n      /* Is this segment part of the final result? */\n      isInResult() {\n        // if we've been consumed, we're not in the result\n        if (this.consumedBy) return false;\n        if (this._isInResult !== undefined) return this._isInResult;\n        const mpsBefore = this.beforeState().multiPolys;\n        const mpsAfter = this.afterState().multiPolys;\n        switch (operation.type) {\n          case \"union\":\n            {\n              // UNION - included iff:\n              //  * On one side of us there is 0 poly interiors AND\n              //  * On the other side there is 1 or more.\n              const noBefores = mpsBefore.length === 0;\n              const noAfters = mpsAfter.length === 0;\n              this._isInResult = noBefores !== noAfters;\n              break;\n            }\n          case \"intersection\":\n            {\n              // INTERSECTION - included iff:\n              //  * on one side of us all multipolys are rep. with poly interiors AND\n              //  * on the other side of us, not all multipolys are repsented\n              //    with poly interiors\n              let least;\n              let most;\n              if (mpsBefore.length < mpsAfter.length) {\n                least = mpsBefore.length;\n                most = mpsAfter.length;\n              } else {\n                least = mpsAfter.length;\n                most = mpsBefore.length;\n              }\n              this._isInResult = most === operation.numMultiPolys && least < most;\n              break;\n            }\n          case \"xor\":\n            {\n              // XOR - included iff:\n              //  * the difference between the number of multipolys represented\n              //    with poly interiors on our two sides is an odd number\n              const diff = Math.abs(mpsBefore.length - mpsAfter.length);\n              this._isInResult = diff % 2 === 1;\n              break;\n            }\n          case \"difference\":\n            {\n              // DIFFERENCE included iff:\n              //  * on exactly one side, we have just the subject\n              const isJustSubject = mps => mps.length === 1 && mps[0].isSubject;\n              this._isInResult = isJustSubject(mpsBefore) !== isJustSubject(mpsAfter);\n              break;\n            }\n          default:\n            throw new Error(`Unrecognized operation type found ${operation.type}`);\n        }\n        return this._isInResult;\n      }\n    }\n\n    class RingIn {\n      constructor(geomRing, poly, isExterior) {\n        if (!Array.isArray(geomRing) || geomRing.length === 0) {\n          throw new Error(\"Input geometry is not a valid Polygon or MultiPolygon\");\n        }\n        this.poly = poly;\n        this.isExterior = isExterior;\n        this.segments = [];\n        if (typeof geomRing[0][0] !== \"number\" || typeof geomRing[0][1] !== \"number\") {\n          throw new Error(\"Input geometry is not a valid Polygon or MultiPolygon\");\n        }\n        const firstPoint = rounder.round(geomRing[0][0], geomRing[0][1]);\n        this.bbox = {\n          ll: {\n            x: firstPoint.x,\n            y: firstPoint.y\n          },\n          ur: {\n            x: firstPoint.x,\n            y: firstPoint.y\n          }\n        };\n        let prevPoint = firstPoint;\n        for (let i = 1, iMax = geomRing.length; i < iMax; i++) {\n          if (typeof geomRing[i][0] !== \"number\" || typeof geomRing[i][1] !== \"number\") {\n            throw new Error(\"Input geometry is not a valid Polygon or MultiPolygon\");\n          }\n          let point = rounder.round(geomRing[i][0], geomRing[i][1]);\n          // skip repeated points\n          if (point.x === prevPoint.x && point.y === prevPoint.y) continue;\n          this.segments.push(Segment.fromRing(prevPoint, point, this));\n          if (point.x < this.bbox.ll.x) this.bbox.ll.x = point.x;\n          if (point.y < this.bbox.ll.y) this.bbox.ll.y = point.y;\n          if (point.x > this.bbox.ur.x) this.bbox.ur.x = point.x;\n          if (point.y > this.bbox.ur.y) this.bbox.ur.y = point.y;\n          prevPoint = point;\n        }\n        // add segment from last to first if last is not the same as first\n        if (firstPoint.x !== prevPoint.x || firstPoint.y !== prevPoint.y) {\n          this.segments.push(Segment.fromRing(prevPoint, firstPoint, this));\n        }\n      }\n      getSweepEvents() {\n        const sweepEvents = [];\n        for (let i = 0, iMax = this.segments.length; i < iMax; i++) {\n          const segment = this.segments[i];\n          sweepEvents.push(segment.leftSE);\n          sweepEvents.push(segment.rightSE);\n        }\n        return sweepEvents;\n      }\n    }\n    class PolyIn {\n      constructor(geomPoly, multiPoly) {\n        if (!Array.isArray(geomPoly)) {\n          throw new Error(\"Input geometry is not a valid Polygon or MultiPolygon\");\n        }\n        this.exteriorRing = new RingIn(geomPoly[0], this, true);\n        // copy by value\n        this.bbox = {\n          ll: {\n            x: this.exteriorRing.bbox.ll.x,\n            y: this.exteriorRing.bbox.ll.y\n          },\n          ur: {\n            x: this.exteriorRing.bbox.ur.x,\n            y: this.exteriorRing.bbox.ur.y\n          }\n        };\n        this.interiorRings = [];\n        for (let i = 1, iMax = geomPoly.length; i < iMax; i++) {\n          const ring = new RingIn(geomPoly[i], this, false);\n          if (ring.bbox.ll.x < this.bbox.ll.x) this.bbox.ll.x = ring.bbox.ll.x;\n          if (ring.bbox.ll.y < this.bbox.ll.y) this.bbox.ll.y = ring.bbox.ll.y;\n          if (ring.bbox.ur.x > this.bbox.ur.x) this.bbox.ur.x = ring.bbox.ur.x;\n          if (ring.bbox.ur.y > this.bbox.ur.y) this.bbox.ur.y = ring.bbox.ur.y;\n          this.interiorRings.push(ring);\n        }\n        this.multiPoly = multiPoly;\n      }\n      getSweepEvents() {\n        const sweepEvents = this.exteriorRing.getSweepEvents();\n        for (let i = 0, iMax = this.interiorRings.length; i < iMax; i++) {\n          const ringSweepEvents = this.interiorRings[i].getSweepEvents();\n          for (let j = 0, jMax = ringSweepEvents.length; j < jMax; j++) {\n            sweepEvents.push(ringSweepEvents[j]);\n          }\n        }\n        return sweepEvents;\n      }\n    }\n    class MultiPolyIn {\n      constructor(geom, isSubject) {\n        if (!Array.isArray(geom)) {\n          throw new Error(\"Input geometry is not a valid Polygon or MultiPolygon\");\n        }\n        try {\n          // if the input looks like a polygon, convert it to a multipolygon\n          if (typeof geom[0][0][0] === \"number\") geom = [geom];\n        } catch (ex) {\n          // The input is either malformed or has empty arrays.\n          // In either case, it will be handled later on.\n        }\n        this.polys = [];\n        this.bbox = {\n          ll: {\n            x: Number.POSITIVE_INFINITY,\n            y: Number.POSITIVE_INFINITY\n          },\n          ur: {\n            x: Number.NEGATIVE_INFINITY,\n            y: Number.NEGATIVE_INFINITY\n          }\n        };\n        for (let i = 0, iMax = geom.length; i < iMax; i++) {\n          const poly = new PolyIn(geom[i], this);\n          if (poly.bbox.ll.x < this.bbox.ll.x) this.bbox.ll.x = poly.bbox.ll.x;\n          if (poly.bbox.ll.y < this.bbox.ll.y) this.bbox.ll.y = poly.bbox.ll.y;\n          if (poly.bbox.ur.x > this.bbox.ur.x) this.bbox.ur.x = poly.bbox.ur.x;\n          if (poly.bbox.ur.y > this.bbox.ur.y) this.bbox.ur.y = poly.bbox.ur.y;\n          this.polys.push(poly);\n        }\n        this.isSubject = isSubject;\n      }\n      getSweepEvents() {\n        const sweepEvents = [];\n        for (let i = 0, iMax = this.polys.length; i < iMax; i++) {\n          const polySweepEvents = this.polys[i].getSweepEvents();\n          for (let j = 0, jMax = polySweepEvents.length; j < jMax; j++) {\n            sweepEvents.push(polySweepEvents[j]);\n          }\n        }\n        return sweepEvents;\n      }\n    }\n\n    class RingOut {\n      /* Given the segments from the sweep line pass, compute & return a series\n       * of closed rings from all the segments marked to be part of the result */\n      static factory(allSegments) {\n        const ringsOut = [];\n        for (let i = 0, iMax = allSegments.length; i < iMax; i++) {\n          const segment = allSegments[i];\n          if (!segment.isInResult() || segment.ringOut) continue;\n          let prevEvent = null;\n          let event = segment.leftSE;\n          let nextEvent = segment.rightSE;\n          const events = [event];\n          const startingPoint = event.point;\n          const intersectionLEs = [];\n\n          /* Walk the chain of linked events to form a closed ring */\n          while (true) {\n            prevEvent = event;\n            event = nextEvent;\n            events.push(event);\n\n            /* Is the ring complete? */\n            if (event.point === startingPoint) break;\n            while (true) {\n              const availableLEs = event.getAvailableLinkedEvents();\n\n              /* Did we hit a dead end? This shouldn't happen.\n               * Indicates some earlier part of the algorithm malfunctioned. */\n              if (availableLEs.length === 0) {\n                const firstPt = events[0].point;\n                const lastPt = events[events.length - 1].point;\n                throw new Error(`Unable to complete output ring starting at [${firstPt.x},` + ` ${firstPt.y}]. Last matching segment found ends at` + ` [${lastPt.x}, ${lastPt.y}].`);\n              }\n\n              /* Only one way to go, so cotinue on the path */\n              if (availableLEs.length === 1) {\n                nextEvent = availableLEs[0].otherSE;\n                break;\n              }\n\n              /* We must have an intersection. Check for a completed loop */\n              let indexLE = null;\n              for (let j = 0, jMax = intersectionLEs.length; j < jMax; j++) {\n                if (intersectionLEs[j].point === event.point) {\n                  indexLE = j;\n                  break;\n                }\n              }\n              /* Found a completed loop. Cut that off and make a ring */\n              if (indexLE !== null) {\n                const intersectionLE = intersectionLEs.splice(indexLE)[0];\n                const ringEvents = events.splice(intersectionLE.index);\n                ringEvents.unshift(ringEvents[0].otherSE);\n                ringsOut.push(new RingOut(ringEvents.reverse()));\n                continue;\n              }\n              /* register the intersection */\n              intersectionLEs.push({\n                index: events.length,\n                point: event.point\n              });\n              /* Choose the left-most option to continue the walk */\n              const comparator = event.getLeftmostComparator(prevEvent);\n              nextEvent = availableLEs.sort(comparator)[0].otherSE;\n              break;\n            }\n          }\n          ringsOut.push(new RingOut(events));\n        }\n        return ringsOut;\n      }\n      constructor(events) {\n        this.events = events;\n        for (let i = 0, iMax = events.length; i < iMax; i++) {\n          events[i].segment.ringOut = this;\n        }\n        this.poly = null;\n      }\n      getGeom() {\n        // Remove superfluous points (ie extra points along a straight line),\n        let prevPt = this.events[0].point;\n        const points = [prevPt];\n        for (let i = 1, iMax = this.events.length - 1; i < iMax; i++) {\n          const pt = this.events[i].point;\n          const nextPt = this.events[i + 1].point;\n          if (compareVectorAngles(pt, prevPt, nextPt) === 0) continue;\n          points.push(pt);\n          prevPt = pt;\n        }\n\n        // ring was all (within rounding error of angle calc) colinear points\n        if (points.length === 1) return null;\n\n        // check if the starting point is necessary\n        const pt = points[0];\n        const nextPt = points[1];\n        if (compareVectorAngles(pt, prevPt, nextPt) === 0) points.shift();\n        points.push(points[0]);\n        const step = this.isExteriorRing() ? 1 : -1;\n        const iStart = this.isExteriorRing() ? 0 : points.length - 1;\n        const iEnd = this.isExteriorRing() ? points.length : -1;\n        const orderedPoints = [];\n        for (let i = iStart; i != iEnd; i += step) orderedPoints.push([points[i].x, points[i].y]);\n        return orderedPoints;\n      }\n      isExteriorRing() {\n        if (this._isExteriorRing === undefined) {\n          const enclosing = this.enclosingRing();\n          this._isExteriorRing = enclosing ? !enclosing.isExteriorRing() : true;\n        }\n        return this._isExteriorRing;\n      }\n      enclosingRing() {\n        if (this._enclosingRing === undefined) {\n          this._enclosingRing = this._calcEnclosingRing();\n        }\n        return this._enclosingRing;\n      }\n\n      /* Returns the ring that encloses this one, if any */\n      _calcEnclosingRing() {\n        // start with the ealier sweep line event so that the prevSeg\n        // chain doesn't lead us inside of a loop of ours\n        let leftMostEvt = this.events[0];\n        for (let i = 1, iMax = this.events.length; i < iMax; i++) {\n          const evt = this.events[i];\n          if (SweepEvent.compare(leftMostEvt, evt) > 0) leftMostEvt = evt;\n        }\n        let prevSeg = leftMostEvt.segment.prevInResult();\n        let prevPrevSeg = prevSeg ? prevSeg.prevInResult() : null;\n        while (true) {\n          // no segment found, thus no ring can enclose us\n          if (!prevSeg) return null;\n\n          // no segments below prev segment found, thus the ring of the prev\n          // segment must loop back around and enclose us\n          if (!prevPrevSeg) return prevSeg.ringOut;\n\n          // if the two segments are of different rings, the ring of the prev\n          // segment must either loop around us or the ring of the prev prev\n          // seg, which would make us and the ring of the prev peers\n          if (prevPrevSeg.ringOut !== prevSeg.ringOut) {\n            if (prevPrevSeg.ringOut.enclosingRing() !== prevSeg.ringOut) {\n              return prevSeg.ringOut;\n            } else return prevSeg.ringOut.enclosingRing();\n          }\n\n          // two segments are from the same ring, so this was a penisula\n          // of that ring. iterate downward, keep searching\n          prevSeg = prevPrevSeg.prevInResult();\n          prevPrevSeg = prevSeg ? prevSeg.prevInResult() : null;\n        }\n      }\n    }\n    class PolyOut {\n      constructor(exteriorRing) {\n        this.exteriorRing = exteriorRing;\n        exteriorRing.poly = this;\n        this.interiorRings = [];\n      }\n      addInterior(ring) {\n        this.interiorRings.push(ring);\n        ring.poly = this;\n      }\n      getGeom() {\n        const geom = [this.exteriorRing.getGeom()];\n        // exterior ring was all (within rounding error of angle calc) colinear points\n        if (geom[0] === null) return null;\n        for (let i = 0, iMax = this.interiorRings.length; i < iMax; i++) {\n          const ringGeom = this.interiorRings[i].getGeom();\n          // interior ring was all (within rounding error of angle calc) colinear points\n          if (ringGeom === null) continue;\n          geom.push(ringGeom);\n        }\n        return geom;\n      }\n    }\n    class MultiPolyOut {\n      constructor(rings) {\n        this.rings = rings;\n        this.polys = this._composePolys(rings);\n      }\n      getGeom() {\n        const geom = [];\n        for (let i = 0, iMax = this.polys.length; i < iMax; i++) {\n          const polyGeom = this.polys[i].getGeom();\n          // exterior ring was all (within rounding error of angle calc) colinear points\n          if (polyGeom === null) continue;\n          geom.push(polyGeom);\n        }\n        return geom;\n      }\n      _composePolys(rings) {\n        const polys = [];\n        for (let i = 0, iMax = rings.length; i < iMax; i++) {\n          const ring = rings[i];\n          if (ring.poly) continue;\n          if (ring.isExteriorRing()) polys.push(new PolyOut(ring));else {\n            const enclosingRing = ring.enclosingRing();\n            if (!enclosingRing.poly) polys.push(new PolyOut(enclosingRing));\n            enclosingRing.poly.addInterior(ring);\n          }\n        }\n        return polys;\n      }\n    }\n\n    /**\n     * NOTE:  We must be careful not to change any segments while\n     *        they are in the SplayTree. AFAIK, there's no way to tell\n     *        the tree to rebalance itself - thus before splitting\n     *        a segment that's in the tree, we remove it from the tree,\n     *        do the split, then re-insert it. (Even though splitting a\n     *        segment *shouldn't* change its correct position in the\n     *        sweep line tree, the reality is because of rounding errors,\n     *        it sometimes does.)\n     */\n\n    class SweepLine {\n      constructor(queue) {\n        let comparator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Segment.compare;\n        this.queue = queue;\n        this.tree = new Tree(comparator);\n        this.segments = [];\n      }\n      process(event) {\n        const segment = event.segment;\n        const newEvents = [];\n\n        // if we've already been consumed by another segment,\n        // clean up our body parts and get out\n        if (event.consumedBy) {\n          if (event.isLeft) this.queue.remove(event.otherSE);else this.tree.remove(segment);\n          return newEvents;\n        }\n        const node = event.isLeft ? this.tree.add(segment) : this.tree.find(segment);\n        if (!node) throw new Error(`Unable to find segment #${segment.id} ` + `[${segment.leftSE.point.x}, ${segment.leftSE.point.y}] -> ` + `[${segment.rightSE.point.x}, ${segment.rightSE.point.y}] ` + \"in SweepLine tree.\");\n        let prevNode = node;\n        let nextNode = node;\n        let prevSeg = undefined;\n        let nextSeg = undefined;\n\n        // skip consumed segments still in tree\n        while (prevSeg === undefined) {\n          prevNode = this.tree.prev(prevNode);\n          if (prevNode === null) prevSeg = null;else if (prevNode.key.consumedBy === undefined) prevSeg = prevNode.key;\n        }\n\n        // skip consumed segments still in tree\n        while (nextSeg === undefined) {\n          nextNode = this.tree.next(nextNode);\n          if (nextNode === null) nextSeg = null;else if (nextNode.key.consumedBy === undefined) nextSeg = nextNode.key;\n        }\n        if (event.isLeft) {\n          // Check for intersections against the previous segment in the sweep line\n          let prevMySplitter = null;\n          if (prevSeg) {\n            const prevInter = prevSeg.getIntersection(segment);\n            if (prevInter !== null) {\n              if (!segment.isAnEndpoint(prevInter)) prevMySplitter = prevInter;\n              if (!prevSeg.isAnEndpoint(prevInter)) {\n                const newEventsFromSplit = this._splitSafely(prevSeg, prevInter);\n                for (let i = 0, iMax = newEventsFromSplit.length; i < iMax; i++) {\n                  newEvents.push(newEventsFromSplit[i]);\n                }\n              }\n            }\n          }\n\n          // Check for intersections against the next segment in the sweep line\n          let nextMySplitter = null;\n          if (nextSeg) {\n            const nextInter = nextSeg.getIntersection(segment);\n            if (nextInter !== null) {\n              if (!segment.isAnEndpoint(nextInter)) nextMySplitter = nextInter;\n              if (!nextSeg.isAnEndpoint(nextInter)) {\n                const newEventsFromSplit = this._splitSafely(nextSeg, nextInter);\n                for (let i = 0, iMax = newEventsFromSplit.length; i < iMax; i++) {\n                  newEvents.push(newEventsFromSplit[i]);\n                }\n              }\n            }\n          }\n\n          // For simplicity, even if we find more than one intersection we only\n          // spilt on the 'earliest' (sweep-line style) of the intersections.\n          // The other intersection will be handled in a future process().\n          if (prevMySplitter !== null || nextMySplitter !== null) {\n            let mySplitter = null;\n            if (prevMySplitter === null) mySplitter = nextMySplitter;else if (nextMySplitter === null) mySplitter = prevMySplitter;else {\n              const cmpSplitters = SweepEvent.comparePoints(prevMySplitter, nextMySplitter);\n              mySplitter = cmpSplitters <= 0 ? prevMySplitter : nextMySplitter;\n            }\n\n            // Rounding errors can cause changes in ordering,\n            // so remove afected segments and right sweep events before splitting\n            this.queue.remove(segment.rightSE);\n            newEvents.push(segment.rightSE);\n            const newEventsFromSplit = segment.split(mySplitter);\n            for (let i = 0, iMax = newEventsFromSplit.length; i < iMax; i++) {\n              newEvents.push(newEventsFromSplit[i]);\n            }\n          }\n          if (newEvents.length > 0) {\n            // We found some intersections, so re-do the current event to\n            // make sure sweep line ordering is totally consistent for later\n            // use with the segment 'prev' pointers\n            this.tree.remove(segment);\n            newEvents.push(event);\n          } else {\n            // done with left event\n            this.segments.push(segment);\n            segment.prev = prevSeg;\n          }\n        } else {\n          // event.isRight\n\n          // since we're about to be removed from the sweep line, check for\n          // intersections between our previous and next segments\n          if (prevSeg && nextSeg) {\n            const inter = prevSeg.getIntersection(nextSeg);\n            if (inter !== null) {\n              if (!prevSeg.isAnEndpoint(inter)) {\n                const newEventsFromSplit = this._splitSafely(prevSeg, inter);\n                for (let i = 0, iMax = newEventsFromSplit.length; i < iMax; i++) {\n                  newEvents.push(newEventsFromSplit[i]);\n                }\n              }\n              if (!nextSeg.isAnEndpoint(inter)) {\n                const newEventsFromSplit = this._splitSafely(nextSeg, inter);\n                for (let i = 0, iMax = newEventsFromSplit.length; i < iMax; i++) {\n                  newEvents.push(newEventsFromSplit[i]);\n                }\n              }\n            }\n          }\n          this.tree.remove(segment);\n        }\n        return newEvents;\n      }\n\n      /* Safely split a segment that is currently in the datastructures\n       * IE - a segment other than the one that is currently being processed. */\n      _splitSafely(seg, pt) {\n        // Rounding errors can cause changes in ordering,\n        // so remove afected segments and right sweep events before splitting\n        // removeNode() doesn't work, so have re-find the seg\n        // https://github.com/w8r/splay-tree/pull/5\n        this.tree.remove(seg);\n        const rightSE = seg.rightSE;\n        this.queue.remove(rightSE);\n        const newEvents = seg.split(pt);\n        newEvents.push(rightSE);\n        // splitting can trigger consumption\n        if (seg.consumedBy === undefined) this.tree.add(seg);\n        return newEvents;\n      }\n    }\n\n    // Limits on iterative processes to prevent infinite loops - usually caused by floating-point math round-off errors.\n    const POLYGON_CLIPPING_MAX_QUEUE_SIZE = typeof process !== \"undefined\" && process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE || 1000000;\n    const POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS = typeof process !== \"undefined\" && process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS || 1000000;\n    class Operation {\n      run(type, geom, moreGeoms) {\n        operation.type = type;\n        rounder.reset();\n\n        /* Convert inputs to MultiPoly objects */\n        const multipolys = [new MultiPolyIn(geom, true)];\n        for (let i = 0, iMax = moreGeoms.length; i < iMax; i++) {\n          multipolys.push(new MultiPolyIn(moreGeoms[i], false));\n        }\n        operation.numMultiPolys = multipolys.length;\n\n        /* BBox optimization for difference operation\n         * If the bbox of a multipolygon that's part of the clipping doesn't\n         * intersect the bbox of the subject at all, we can just drop that\n         * multiploygon. */\n        if (operation.type === \"difference\") {\n          // in place removal\n          const subject = multipolys[0];\n          let i = 1;\n          while (i < multipolys.length) {\n            if (getBboxOverlap(multipolys[i].bbox, subject.bbox) !== null) i++;else multipolys.splice(i, 1);\n          }\n        }\n\n        /* BBox optimization for intersection operation\n         * If we can find any pair of multipolygons whose bbox does not overlap,\n         * then the result will be empty. */\n        if (operation.type === \"intersection\") {\n          // TODO: this is O(n^2) in number of polygons. By sorting the bboxes,\n          //       it could be optimized to O(n * ln(n))\n          for (let i = 0, iMax = multipolys.length; i < iMax; i++) {\n            const mpA = multipolys[i];\n            for (let j = i + 1, jMax = multipolys.length; j < jMax; j++) {\n              if (getBboxOverlap(mpA.bbox, multipolys[j].bbox) === null) return [];\n            }\n          }\n        }\n\n        /* Put segment endpoints in a priority queue */\n        const queue = new Tree(SweepEvent.compare);\n        for (let i = 0, iMax = multipolys.length; i < iMax; i++) {\n          const sweepEvents = multipolys[i].getSweepEvents();\n          for (let j = 0, jMax = sweepEvents.length; j < jMax; j++) {\n            queue.insert(sweepEvents[j]);\n            if (queue.size > POLYGON_CLIPPING_MAX_QUEUE_SIZE) {\n              // prevents an infinite loop, an otherwise common manifestation of bugs\n              throw new Error(\"Infinite loop when putting segment endpoints in a priority queue \" + \"(queue size too big).\");\n            }\n          }\n        }\n\n        /* Pass the sweep line over those endpoints */\n        const sweepLine = new SweepLine(queue);\n        let prevQueueSize = queue.size;\n        let node = queue.pop();\n        while (node) {\n          const evt = node.key;\n          if (queue.size === prevQueueSize) {\n            // prevents an infinite loop, an otherwise common manifestation of bugs\n            const seg = evt.segment;\n            throw new Error(`Unable to pop() ${evt.isLeft ? \"left\" : \"right\"} SweepEvent ` + `[${evt.point.x}, ${evt.point.y}] from segment #${seg.id} ` + `[${seg.leftSE.point.x}, ${seg.leftSE.point.y}] -> ` + `[${seg.rightSE.point.x}, ${seg.rightSE.point.y}] from queue.`);\n          }\n          if (queue.size > POLYGON_CLIPPING_MAX_QUEUE_SIZE) {\n            // prevents an infinite loop, an otherwise common manifestation of bugs\n            throw new Error(\"Infinite loop when passing sweep line over endpoints \" + \"(queue size too big).\");\n          }\n          if (sweepLine.segments.length > POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS) {\n            // prevents an infinite loop, an otherwise common manifestation of bugs\n            throw new Error(\"Infinite loop when passing sweep line over endpoints \" + \"(too many sweep line segments).\");\n          }\n          const newEvents = sweepLine.process(evt);\n          for (let i = 0, iMax = newEvents.length; i < iMax; i++) {\n            const evt = newEvents[i];\n            if (evt.consumedBy === undefined) queue.insert(evt);\n          }\n          prevQueueSize = queue.size;\n          node = queue.pop();\n        }\n\n        // free some memory we don't need anymore\n        rounder.reset();\n\n        /* Collect and compile segments we're keeping into a multipolygon */\n        const ringsOut = RingOut.factory(sweepLine.segments);\n        const result = new MultiPolyOut(ringsOut);\n        return result.getGeom();\n      }\n    }\n\n    // singleton available by import\n    const operation = new Operation();\n\n    const union = function (geom) {\n      for (var _len = arguments.length, moreGeoms = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        moreGeoms[_key - 1] = arguments[_key];\n      }\n      return operation.run(\"union\", geom, moreGeoms);\n    };\n    const intersection = function (geom) {\n      for (var _len2 = arguments.length, moreGeoms = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n        moreGeoms[_key2 - 1] = arguments[_key2];\n      }\n      return operation.run(\"intersection\", geom, moreGeoms);\n    };\n    const xor = function (geom) {\n      for (var _len3 = arguments.length, moreGeoms = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n        moreGeoms[_key3 - 1] = arguments[_key3];\n      }\n      return operation.run(\"xor\", geom, moreGeoms);\n    };\n    const difference = function (subjectGeom) {\n      for (var _len4 = arguments.length, clippingGeoms = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n        clippingGeoms[_key4 - 1] = arguments[_key4];\n      }\n      return operation.run(\"difference\", subjectGeom, clippingGeoms);\n    };\n    var index = {\n      union: union,\n      intersection: intersection,\n      xor: xor,\n      difference: difference\n    };\n\n    return index;\n\n}));\n","module.exports = parcelRequire.resolve(\"edit-crop.00823a57.svg\") + \"?\" + Date.now();","import { BB } from '../../../bb/bb';\nimport { showModal } from './base/showModal';\nimport { CropCopy } from '../components/crop-copy';\nimport { LANG } from '../../../language/language';\nimport { StatusOverlay } from '../components/status-overlay';\nimport { TCropRect, TRect } from '../../../bb/bb-types';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { boundsToRect, intBoundsWithinArea } from '../../../bb/math/math';\nimport { getMultiPolyBounds } from '../../../bb/multi-polygon/get-multi-polygon-bounds';\nimport { Checkbox } from '../components/checkbox';\nimport { css } from '../../../bb/base/base';\n\nlet maskSelection = false;\n\nexport function clipboardDialog(\n    parent: HTMLElement,\n    getFullCanvas: (maskSelection?: boolean) => HTMLCanvasElement,\n    cropCallback: (crop: TCropRect) => void,\n    output: StatusOverlay,\n    showCropButton: boolean,\n    closeOnBlur: boolean = true,\n    selection?: MultiPolygon,\n): void {\n    let clipboardItemIsSupported: boolean = false;\n    try {\n        clipboardItemIsSupported = !!ClipboardItem;\n    } catch (e) {\n        /* empty */\n    }\n\n    const div = document.createElement('div');\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n\n    const maskToggle = selection\n        ? new Checkbox({\n              init: maskSelection,\n              label: LANG('cropcopy-mask'),\n              name: 'check-mask-selection',\n              css: {\n                  width: 'fit-content',\n              },\n              callback: (b) => {\n                  maskSelection = b;\n                  cropCopy.setCanvas(getFullCanvas(b));\n              },\n          })\n        : undefined;\n    const topWrapper = BB.el({\n        content: [\n            maskToggle?.getElement(),\n            LANG('crop-drag-to-crop') +\n                (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\n        ],\n        css: {\n            textAlign: 'center',\n        },\n    });\n    div.append(topWrapper);\n\n    const fullCanvas = getFullCanvas(maskSelection);\n    let init: TRect | undefined;\n    if (selection) {\n        const bounds = getMultiPolyBounds(selection);\n        const boundsInCanvas = intBoundsWithinArea(bounds, fullCanvas.width, fullCanvas.height);\n        init = boundsInCanvas ? boundsToRect(boundsInCanvas) : undefined;\n    }\n    const cropCopy = new CropCopy({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 350,\n        canvas: fullCanvas,\n        enableRightClickCopy: true,\n        init,\n    });\n    css(cropCopy.getElement(), {\n        marginTop: '10px',\n        marginLeft: '-20px',\n    });\n    div.append(cropCopy.getElement());\n\n    async function toClipboard() {\n        try {\n            const blob = cropCopy.getCroppedBlob();\n            await (navigator.clipboard as any).write([\n                new ClipboardItem({\n                    [blob.type]: blob,\n                }),\n            ]);\n            setTimeout(function () {\n                output.out(LANG('cropcopy-copied'), true);\n            }, 200);\n        } catch (err) {\n            console.error((err as Error).name, (err as Error).message);\n            return;\n        }\n    }\n\n    const keyListener = new BB.KeyListener({\n        onDown: function (keyStr, KeyEvent, comboStr) {\n            if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\n                toClipboard();\n                closeFunc && closeFunc();\n            }\n        },\n    });\n\n    let closeFunc: () => void;\n    function blur() {\n        if (closeOnBlur) {\n            closeFunc?.();\n        }\n    }\n    window.addEventListener('blur', blur);\n\n    const buttonArr = [];\n    if (clipboardItemIsSupported) {\n        buttonArr.push(LANG('cropcopy-btn-copy'));\n    }\n    if (showCropButton) {\n        buttonArr.push(LANG('cropcopy-btn-crop'));\n    }\n    buttonArr.push('Cancel');\n\n    showModal({\n        target: parent,\n        message:\n            '<b>' +\n            (showCropButton\n                ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}`\n                : `${LANG('cropcopy-title-copy')}`) +\n            '</b>',\n        div: div,\n        style: isSmall\n            ? {}\n            : {\n                  width: '540px',\n              },\n        buttons: buttonArr,\n        primaries: [LANG('cropcopy-btn-copy')],\n        callback: function (result) {\n            if (result === LANG('cropcopy-btn-copy')) {\n                toClipboard();\n            } else if (result === LANG('cropcopy-btn-crop')) {\n                const rectObj = cropCopy.getCropRect();\n                cropCallback({\n                    left: Math.round(-rectObj.x),\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\n                    top: Math.round(-rectObj.y),\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height),\n                });\n            }\n            window.removeEventListener('blur', blur);\n            BB.freeCanvas(cropCopy.getCroppedCanvas());\n            cropCopy.destroy();\n            keyListener.destroy();\n        },\n        clickOnEnter: LANG('cropcopy-btn-copy'),\n        closeFunc: function (func) {\n            closeFunc = func;\n        },\n    });\n}\n","import { MultiPolygon } from 'polygon-clipping';\nimport { TBounds } from '../bb-types';\n\nexport function getMultiPolyBounds(poly: MultiPolygon): TBounds {\n    let x1: number | undefined = undefined;\n    let y1: number | undefined = undefined;\n    let x2: number | undefined = undefined;\n    let y2: number | undefined = undefined;\n    poly.forEach((poly) => {\n        poly.forEach((ring) => {\n            ring.forEach((p) => {\n                x1 = x1 === undefined ? p[0] : Math.min(x1, p[0]);\n                y1 = y1 === undefined ? p[1] : Math.min(y1, p[1]);\n\n                x2 = x2 === undefined ? p[0] : Math.max(x2, p[0]);\n                y2 = y2 === undefined ? p[1] : Math.max(y2, p[1]);\n            });\n        });\n    });\n    if (x1 === undefined || y1 === undefined || x2 === undefined || y2 === undefined) {\n        throw 'empty poly';\n    }\n    return {\n        x1,\n        y1,\n        x2,\n        y2,\n    };\n}\n","import { BB } from '../../../../bb/bb';\nimport { Select } from '../../components/select';\nimport { PointSlider } from '../../components/point-slider';\nimport { KlCanvas, MAX_LAYERS } from '../../../canvas/kl-canvas';\nimport { TMixMode, TUiLayout } from '../../../kl-types';\nimport { LANG } from '../../../../language/language';\nimport { translateBlending } from '../../../canvas/translate-blending';\nimport { PointerListener } from '../../../../bb/input/pointer-listener';\nimport { TPointerEvent } from '../../../../bb/input/event.types';\nimport { renameLayerDialog } from './rename-layer-dialog';\nimport { mergeLayerDialog } from './merge-layer-dialog';\nimport { css, throwIfNull } from '../../../../bb/base/base';\nimport { HAS_POINTER_EVENTS } from '../../../../bb/base/browser';\nimport { c } from '../../../../bb/base/c';\nimport { DropdownMenu } from '../../components/dropdown-menu';\nimport addLayerImg from 'url:/src/app/img/ui/add-layer.svg';\nimport duplicateLayerImg from 'url:/src/app/img/ui/duplicate-layer.svg';\nimport mergeLayerImg from 'url:/src/app/img/ui/merge-layers.svg';\nimport removeLayerImg from 'url:/src/app/img/ui/remove-layer.svg';\nimport renameLayerImg from 'url:/src/app/img/ui/rename-layer.svg';\nimport caretDownImg from 'url:/src/app/img/ui/caret-down.svg';\nimport { KlHistory } from '../../../history/kl-history';\nimport { makeUnfocusable } from '../../../../bb/base/ui';\n\nconst paddingLeft = 25;\n\ntype TLayerEl = HTMLElement & {\n    label: HTMLElement;\n    opacityLabel: HTMLElement;\n    thumb: HTMLCanvasElement;\n\n    spot: number;\n    posY: number;\n    layerName: string;\n    opacity: number;\n    pointerListener: PointerListener;\n    opacitySlider: PointSlider;\n    isSelected: boolean;\n};\n\nexport type TLayersUiParams = {\n    klCanvas: KlCanvas;\n    onSelect: (layerIndex: number) => void;\n    parentEl: HTMLElement;\n    uiState: TUiLayout;\n    applyUncommitted: () => void;\n    klHistory: KlHistory;\n    onUpdateProject: () => void; // triggers update of easel\n    onClearLayer: () => void;\n};\n\nexport class LayersUi {\n    // from params\n    private klCanvas: KlCanvas;\n    private readonly onSelect: (layerIndex: number) => void;\n    private readonly parentEl: HTMLElement;\n    private uiState: TUiLayout;\n    private readonly applyUncommitted: () => void;\n    private klHistory: KlHistory;\n    private readonly onUpdateProject: () => void;\n    private readonly onClearLayer: () => void;\n\n    private readonly rootEl: HTMLElement;\n    private klCanvasLayerArr: {\n        context: CanvasRenderingContext2D;\n        opacity: number;\n        name: string;\n        mixModeStr: TMixMode;\n    }[];\n    private readonly layerListEl: HTMLElement;\n    private layerElArr: TLayerEl[];\n    private selectedSpotIndex: number;\n    private readonly removeBtn: HTMLButtonElement;\n    private readonly addBtn: HTMLButtonElement;\n    private readonly duplicateBtn: HTMLButtonElement;\n    private readonly mergeBtn: HTMLButtonElement;\n    private readonly moreDropdown: DropdownMenu<'clear-layer' | 'merge-all'>;\n    private readonly modeSelect: Select<TMixMode>;\n    private readonly largeThumbDiv: HTMLElement;\n    private oldHistoryState: number | undefined;\n\n    private readonly largeThumbCanvas: HTMLCanvasElement;\n    private largeThumbInDocument: boolean;\n    private largeThumbInTimeout: undefined | ReturnType<typeof setTimeout>;\n    private largeThumbTimeout: undefined | ReturnType<typeof setTimeout>;\n    private lastpos: number = 0;\n\n    private readonly layerHeight: number = 35;\n    private readonly layerSpacing: number = 0;\n\n    private move(oldSpotIndex: number, newSpotIndex: number): void {\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\n            throw 'layers-ui - invalid move';\n        }\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\n            ((i) => {\n                let posy = this.layerElArr[i].spot; // <- here\n                if (this.layerElArr[i].spot === oldSpotIndex) {\n                    posy = newSpotIndex;\n                } else {\n                    if (this.layerElArr[i].spot > oldSpotIndex) {\n                        posy--;\n                    }\n                    if (posy >= newSpotIndex) {\n                        posy++;\n                    }\n                }\n                this.layerElArr[i].spot = posy;\n                this.layerElArr[i].posY =\n                    (this.layerHeight + this.layerSpacing) *\n                    (this.klCanvasLayerArr.length - posy - 1);\n                this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\n            })(i);\n        }\n        if (oldSpotIndex === newSpotIndex) {\n            return;\n        }\n        this.applyUncommitted();\n        this.klCanvas.moveLayer(this.selectedSpotIndex, newSpotIndex - oldSpotIndex);\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        this.selectedSpotIndex = newSpotIndex;\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n    }\n\n    private posToSpot(p: number): number {\n        let result = parseInt('' + (p / (this.layerHeight + this.layerSpacing) + 0.5));\n        result = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, result));\n        result = this.klCanvasLayerArr.length - result - 1;\n        return result;\n    }\n\n    /**\n     * update css position of all layers that are not being dragged, while dragging\n     */\n    private updateLayersVerticalPosition(id: number, newspot: number): void {\n        newspot = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, newspot));\n        if (newspot === this.lastpos) {\n            return;\n        }\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\n            if (this.layerElArr[i].spot === id) {\n                // <- here\n                continue;\n            }\n            let posy = this.layerElArr[i].spot;\n            if (this.layerElArr[i].spot > id) {\n                posy--;\n            }\n            if (posy >= newspot) {\n                posy++;\n            }\n            this.layerElArr[i].posY =\n                (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\n            this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\n        }\n        this.lastpos = newspot;\n    }\n\n    private renameLayer(layerSpot: number): void {\n        renameLayerDialog(this.parentEl, this.klCanvas.getLayerOld(layerSpot)!.name, (newName) => {\n            if (newName === undefined || newName === this.klCanvas.getLayerOld(layerSpot)!.name) {\n                return;\n            }\n            this.klCanvas.renameLayer(layerSpot, newName);\n            //this.createLayerList();\n            this.klHistory.pause(true);\n            this.onSelect(layerSpot);\n            this.klHistory.pause(false);\n        });\n    }\n\n    private updateHeight(): void {\n        this.layerListEl.style.height = this.layerElArr.length * 35 + 'px';\n    }\n\n    private createLayerList(force?: boolean): void {\n        if (this.klHistory.getChangeCount() === this.oldHistoryState && !force) {\n            return;\n        }\n        this.oldHistoryState = this.klHistory.getChangeCount();\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n\n        const createLayerEntry = (index: number): void => {\n            const klLayer = throwIfNull(this.klCanvas.getLayerOld(index));\n            const layerName = klLayer.name;\n            const opacity = this.klCanvasLayerArr[index].opacity;\n            const isVisible = klLayer.isVisible;\n            const layercanvas = this.klCanvasLayerArr[index].context.canvas;\n\n            const layer: TLayerEl = BB.el({\n                className: 'kl-layer',\n            }) as HTMLElement as TLayerEl;\n            this.layerElArr[index] = layer;\n            layer.posY = (this.klCanvasLayerArr.length - 1) * 35 - index * 35;\n            css(layer, {\n                top: layer.posY + 'px',\n            });\n            const innerLayer = BB.el();\n            css(innerLayer, {\n                position: 'relative',\n            });\n\n            const container1 = BB.el();\n            css(container1, {\n                width: '270px',\n                height: '34px',\n            });\n            const container2 = BB.el();\n            layer.append(innerLayer);\n            innerLayer.append(container1, container2);\n\n            layer.spot = index;\n\n            //checkbox - visibility\n            {\n                const checkWrapper = BB.el({\n                    tagName: 'label',\n                    parent: container1,\n                    title: LANG('layers-visibility-toggle'),\n                    css: {\n                        display: 'flex',\n                        width: '25px',\n                        height: '100%',\n                        justifyContent: 'right',\n                        alignItems: 'center',\n                        cursor: 'pointer',\n                    },\n                });\n                const check = BB.el({\n                    tagName: 'input',\n                    parent: checkWrapper,\n                    custom: {\n                        type: 'checkbox',\n                        tabindex: '-1',\n                        name: 'layer-visibility',\n                    },\n                    css: {\n                        display: 'block',\n                        cursor: 'pointer',\n                        margin: '0',\n                        marginRight: '5px',\n                    },\n                });\n                check.checked = isVisible;\n                check.onchange = () => {\n                    this.klCanvas.setLayerIsVisible(layer.spot, check.checked);\n                    //this.createLayerList();\n                    if (layer.spot === this.selectedSpotIndex) {\n                        this.klHistory.pause(true);\n                        this.onSelect(this.selectedSpotIndex);\n                        this.klHistory.pause(false);\n                    }\n                };\n                // prevent layer getting dragged\n                const preventFunc = (e: PointerEvent | MouseEvent) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                };\n                if (HAS_POINTER_EVENTS) {\n                    checkWrapper.onpointerdown = preventFunc;\n                } else {\n                    checkWrapper.onmousedown = preventFunc;\n                }\n            }\n\n            //thumb\n            {\n                const thumbDimensions = BB.fitInto(\n                    layercanvas.width,\n                    layercanvas.height,\n                    30,\n                    30,\n                    1,\n                );\n                layer.thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\n\n                const thc = BB.ctx(layer.thumb);\n                thc.save();\n                if (layer.thumb.width > layercanvas.width) {\n                    thc.imageSmoothingEnabled = false;\n                }\n                thc.drawImage(layercanvas, 0, 0, layer.thumb.width, layer.thumb.height);\n                thc.restore();\n                css(layer.thumb, {\n                    position: 'absolute',\n                    left: (32 - layer.thumb.width) / 2 + paddingLeft + 'px',\n                    top: (32 - layer.thumb.height) / 2 + 1 + 'px',\n                    background: 'var(--kl-checkerboard-background)',\n                });\n            }\n\n            //layerlabel\n            {\n                layer.label = BB.el({\n                    className: 'kl-layer__label',\n                });\n                layer.layerName = layerName;\n                layer.label.append(layer.layerName);\n\n                css(layer.label, {\n                    position: 'absolute',\n                    left: 1 + 32 + 5 + paddingLeft + 'px',\n                    top: 1 + 'px',\n                    fontSize: '13px',\n                    width: '165px',\n                    height: '20px',\n                    overflow: 'hidden',\n                    whiteSpace: 'nowrap',\n                    textOverflow: 'ellipsis',\n                });\n\n                layer.label.ondblclick = () => {\n                    this.applyUncommitted();\n                    this.renameLayer(layer.spot);\n                };\n            }\n            //layer label opacity\n            {\n                layer.opacityLabel = BB.el({\n                    className: 'kl-layer__opacity-label',\n                });\n                layer.opacity = opacity;\n                layer.opacityLabel.append(parseInt('' + layer.opacity * 100) + '%');\n\n                css(layer.opacityLabel, {\n                    position: 'absolute',\n                    left: 250 - 1 - 5 - 50 - 5 + paddingLeft + 'px',\n                    top: 1 + 'px',\n                    fontSize: '13px',\n                    textAlign: 'right',\n                    width: '50px',\n                    transition: 'color 0.2s ease-in-out',\n                    textDecoration: isVisible ? undefined : 'line-through',\n                });\n            }\n\n            let oldOpacity: number;\n            const opacitySlider = new PointSlider({\n                init: layer.opacity,\n                width: 200,\n                pointSize: 14,\n                callback: (sliderValue, isFirst, isLast) => {\n                    if (isFirst) {\n                        oldOpacity = this.klCanvas.getLayerOld(layer.spot)!.opacity;\n                        this.klHistory.pause(true);\n                        return;\n                    }\n                    if (isLast) {\n                        this.klHistory.pause(false);\n                        if (oldOpacity !== sliderValue) {\n                            this.klCanvas.setOpacity(layer.spot, sliderValue);\n                        }\n                        return;\n                    }\n                    layer.opacityLabel.innerHTML = Math.round(sliderValue * 100) + '%';\n                    this.klCanvas.setOpacity(layer.spot, sliderValue);\n                    this.onUpdateProject();\n                },\n            });\n            css(opacitySlider.getElement(), {\n                position: 'absolute',\n                left: 39 + paddingLeft + 'px',\n                top: '17px',\n            });\n            layer.opacitySlider = opacitySlider;\n\n            //larger layer preview - hover\n            layer.thumb.onpointerover = (e) => {\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) {\n                    //shouldn't show while dragging\n                    return;\n                }\n\n                const thumbDimensions = BB.fitInto(\n                    layercanvas.width,\n                    layercanvas.height,\n                    250,\n                    250,\n                    1,\n                );\n\n                if (\n                    this.largeThumbCanvas.width !== thumbDimensions.width ||\n                    this.largeThumbCanvas.height !== thumbDimensions.height\n                ) {\n                    this.largeThumbCanvas.width = thumbDimensions.width;\n                    this.largeThumbCanvas.height = thumbDimensions.height;\n                }\n                const ctx = BB.ctx(this.largeThumbCanvas);\n                ctx.save();\n                if (this.largeThumbCanvas.width > layercanvas.width) {\n                    ctx.imageSmoothingEnabled = false;\n                }\n                ctx.imageSmoothingQuality = 'high';\n                ctx.clearRect(0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\n                ctx.drawImage(\n                    layercanvas,\n                    0,\n                    0,\n                    this.largeThumbCanvas.width,\n                    this.largeThumbCanvas.height,\n                );\n                ctx.restore();\n                css(this.largeThumbDiv, {\n                    top: e.clientY - this.largeThumbCanvas.height / 2 + 'px',\n                    opacity: '0',\n                });\n                if (!this.largeThumbInDocument) {\n                    document.body.append(this.largeThumbDiv);\n                    this.largeThumbInDocument = true;\n                }\n                clearTimeout(this.largeThumbInTimeout);\n                this.largeThumbInTimeout = setTimeout(() => {\n                    css(this.largeThumbDiv, {\n                        opacity: '1',\n                    });\n                }, 20);\n                clearTimeout(this.largeThumbTimeout);\n            };\n            layer.thumb.onpointerout = () => {\n                clearTimeout(this.largeThumbInTimeout);\n                css(this.largeThumbDiv, {\n                    opacity: '0',\n                });\n                clearTimeout(this.largeThumbTimeout);\n                this.largeThumbTimeout = setTimeout(() => {\n                    if (!this.largeThumbInDocument) {\n                        return;\n                    }\n                    this.largeThumbDiv.remove();\n                    this.largeThumbInDocument = false;\n                }, 300);\n            };\n\n            container1.append(\n                layer.thumb,\n                layer.label,\n                layer.opacityLabel,\n                opacitySlider.getElement(),\n            );\n            let dragstart = false;\n            let freshSelection = false;\n\n            //events for moving layers up and down\n            const dragEventHandler = (event: TPointerEvent) => {\n                if (event.type === 'pointerdown' && event.button === 'left') {\n                    css(layer, {\n                        transition: 'box-shadow 0.3s ease-in-out',\n                        zIndex: '1',\n                    });\n                    this.lastpos = layer.spot;\n                    freshSelection = false;\n                    if (!layer.isSelected) {\n                        freshSelection = true;\n                        this.activateLayer(layer.spot);\n                    }\n                    dragstart = true;\n                } else if (event.type === 'pointermove' && event.button === 'left') {\n                    if (dragstart) {\n                        dragstart = false;\n                        css(layer, {\n                            boxShadow: '1px 3px 5px rgba(0,0,0,0.4)',\n                        });\n                    }\n                    layer.posY += event.dY;\n                    const corrected = Math.max(\n                        0,\n                        Math.min((this.klCanvasLayerArr.length - 1) * 35, layer.posY),\n                    );\n                    layer.style.top = corrected + 'px';\n                    this.updateLayersVerticalPosition(layer.spot, this.posToSpot(layer.posY));\n                }\n                if (event.type === 'pointerup') {\n                    css(layer, {\n                        transition: 'all 0.1s linear',\n                    });\n                    setTimeout(() => {\n                        css(layer, {\n                            boxShadow: '',\n                        });\n                    }, 20);\n                    layer.posY = Math.max(\n                        0,\n                        Math.min((this.klCanvasLayerArr.length - 1) * 35, layer.posY),\n                    );\n                    layer.style.zIndex = '';\n                    const newSpot = this.posToSpot(layer.posY);\n                    const oldSpot = layer.spot;\n                    this.move(layer.spot, newSpot);\n                    if (oldSpot != newSpot) {\n                        this.klHistory.pause(true);\n                        this.onSelect(this.selectedSpotIndex);\n                        this.klHistory.pause(false);\n                    }\n                    if (oldSpot === newSpot && freshSelection) {\n                        this.applyUncommitted();\n                        this.onSelect(this.selectedSpotIndex);\n                    }\n                    freshSelection = false;\n                }\n            };\n\n            layer.pointerListener = new BB.PointerListener({\n                target: container1,\n                onPointer: dragEventHandler,\n            });\n\n            this.layerListEl.append(layer);\n        };\n        this.layerElArr = [];\n        while (this.layerListEl.firstChild) {\n            const child = this.layerListEl.firstChild as TLayerEl;\n            child.pointerListener.destroy();\n            child.opacitySlider.destroy();\n            child.remove();\n        }\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\n            createLayerEntry(i);\n        }\n        this.activateLayer(this.selectedSpotIndex);\n        this.updateHeight();\n    }\n\n    private updateButtons(): void {\n        const maxReached = this.klCanvasLayerArr.length === MAX_LAYERS;\n        const oneLayer = this.klCanvasLayerArr.length === 1;\n\n        this.addBtn.disabled = maxReached;\n        this.removeBtn.disabled = oneLayer;\n        this.duplicateBtn.disabled = maxReached;\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n        this.moreDropdown.setEnabled('merge-all', !oneLayer);\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TLayersUiParams) {\n        this.klCanvas = p.klCanvas;\n        this.onSelect = p.onSelect;\n        this.parentEl = p.parentEl;\n        this.uiState = p.uiState;\n        this.applyUncommitted = p.applyUncommitted;\n        this.klHistory = p.klHistory;\n        this.onUpdateProject = p.onUpdateProject;\n        this.onClearLayer = p.onClearLayer;\n\n        this.layerElArr = [];\n        this.layerHeight = 35;\n        this.layerSpacing = 0;\n        const width = 270;\n\n        this.largeThumbDiv = BB.el({\n            onClick: BB.handleClick,\n            css: {\n                position: 'absolute',\n                top: '500px',\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\n                pointerEvents: 'none',\n                padding: '0',\n                border: '1px solid #aaa',\n                transition: 'opacity 0.3s ease-out',\n                userSelect: 'none',\n                background: 'var(--kl-checkerboard-background)',\n            },\n        });\n        this.setUiState(this.uiState);\n        this.largeThumbCanvas = BB.canvas(200, 200);\n        this.largeThumbCanvas.style.display = 'block';\n        this.largeThumbDiv.append(this.largeThumbCanvas);\n        this.largeThumbInDocument = false;\n\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        this.selectedSpotIndex = this.klCanvasLayerArr.length - 1;\n        this.rootEl = BB.el({\n            css: {\n                marginRight: '10px',\n                marginBottom: '10px',\n                marginLeft: '10px',\n                marginTop: '10px',\n                cursor: 'default',\n                position: 'relative',\n                zIndex: '0',\n            },\n        });\n\n        const listDiv = BB.el({\n            css: {\n                width: width + 'px',\n                position: 'relative',\n                margin: '0 -10px',\n                zIndex: '0',\n            },\n        });\n\n        this.layerListEl = BB.el({\n            parent: listDiv,\n        });\n\n        this.addBtn = BB.el({ tagName: 'button' });\n        this.duplicateBtn = BB.el({ tagName: 'button' });\n        this.mergeBtn = BB.el({ tagName: 'button' });\n        this.removeBtn = BB.el({ tagName: 'button' });\n        const renameBtn = BB.el({ tagName: 'button' });\n        this.moreDropdown = new DropdownMenu({\n            button: BB.el({\n                content: `<img src=\"${caretDownImg}\" width=\"13\"/>`,\n                css: {\n                    display: 'flex',\n                    justifyContent: 'center',\n                    opacity: '0.9',\n                },\n            }),\n            buttonTitle: LANG('more'),\n            items: [\n                ['clear-layer', LANG('layers-clear')],\n                ['merge-all', LANG('layers-merge-all')],\n            ],\n            onItemClick: (id) => {\n                if (id === 'clear-layer') {\n                    this.applyUncommitted();\n                    this.onClearLayer();\n                }\n                if (id === 'merge-all') {\n                    this.applyUncommitted();\n                    const newIndex = this.klCanvas.mergeAll();\n                    if (newIndex === false) {\n                        return;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n                    this.selectedSpotIndex = newIndex;\n\n                    //this.createLayerList();\n                    this.klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    this.klHistory.pause(false);\n\n                    this.updateButtons();\n                }\n            },\n        });\n\n        this.updateButtons();\n\n        const createButtons = () => {\n            const div = BB.el();\n            const async = () => {\n                makeUnfocusable(this.addBtn);\n                makeUnfocusable(this.duplicateBtn);\n                makeUnfocusable(this.mergeBtn);\n                makeUnfocusable(this.removeBtn);\n                makeUnfocusable(renameBtn);\n\n                const commonStyle = {\n                    cssFloat: 'left',\n                    paddingLeft: '5px',\n                    paddingRight: '3px',\n                };\n                css(this.addBtn, commonStyle);\n                css(this.duplicateBtn, commonStyle);\n                css(this.mergeBtn, commonStyle);\n                css(this.removeBtn, commonStyle);\n                css(renameBtn, {\n                    cssFloat: 'left',\n                    height: '30px',\n                    lineHeight: '20px',\n                });\n\n                this.addBtn.title = LANG('layers-new');\n                this.duplicateBtn.title = LANG('layers-duplicate');\n                this.removeBtn.title = LANG('layers-remove');\n                this.mergeBtn.title = LANG('layers-merge');\n                renameBtn.title = LANG('layers-rename-title');\n\n                this.addBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\n                this.duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\n                this.mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\n                this.removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\n                renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\n                div.append(\n                    c(',flex,gap-5,mb-10', [\n                        this.addBtn,\n                        this.removeBtn,\n                        this.duplicateBtn,\n                        this.mergeBtn,\n                        renameBtn,\n                        c(',grow-1'),\n                        this.moreDropdown.getElement(),\n                    ]),\n                );\n\n                this.addBtn.onclick = () => {\n                    this.applyUncommitted();\n                    if (this.klCanvas.addLayer(this.selectedSpotIndex) === false) {\n                        return;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n\n                    this.selectedSpotIndex = this.selectedSpotIndex + 1;\n                    //this.createLayerList();\n                    this.klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    this.klHistory.pause(false);\n\n                    this.updateButtons();\n                };\n                this.duplicateBtn.onclick = () => {\n                    this.applyUncommitted();\n                    if (this.klCanvas.duplicateLayer(this.selectedSpotIndex) === false) {\n                        return;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n\n                    this.selectedSpotIndex++;\n                    //this.createLayerList();\n                    this.klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    this.klHistory.pause(false);\n\n                    this.updateButtons();\n                };\n                this.removeBtn.onclick = () => {\n                    this.applyUncommitted();\n                    if (this.layerElArr.length <= 1) {\n                        return;\n                    }\n\n                    this.klCanvas.removeLayer(this.selectedSpotIndex);\n                    if (this.selectedSpotIndex > 0) {\n                        this.selectedSpotIndex--;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n                    //this.createLayerList();\n                    this.klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    this.klHistory.pause(false);\n\n                    this.updateButtons();\n                };\n                this.mergeBtn.onclick = () => {\n                    this.applyUncommitted();\n                    if (this.selectedSpotIndex <= 0) {\n                        return;\n                    }\n                    mergeLayerDialog(this.parentEl, {\n                        topCanvas: this.klCanvasLayerArr[this.selectedSpotIndex].context.canvas,\n                        bottomCanvas:\n                            this.klCanvasLayerArr[this.selectedSpotIndex - 1].context.canvas,\n                        topOpacity: this.klCanvas.getLayerOld(this.selectedSpotIndex)!.opacity,\n                        mixModeStr: this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr,\n                        callback: (mode) => {\n                            this.klCanvas.mergeLayers(\n                                this.selectedSpotIndex,\n                                this.selectedSpotIndex - 1,\n                                mode as TMixMode | 'as-alpha',\n                            );\n                            this.klCanvasLayerArr = this.klCanvas.getLayers();\n                            this.selectedSpotIndex--;\n\n                            //this.createLayerList();\n                            this.klHistory.pause(true);\n                            this.onSelect(this.selectedSpotIndex);\n                            this.klHistory.pause(false);\n\n                            this.updateButtons();\n                        },\n                    });\n                };\n\n                renameBtn.onclick = () => {\n                    this.applyUncommitted();\n                    this.renameLayer(this.selectedSpotIndex);\n                };\n            };\n            setTimeout(async, 1);\n            return div;\n        };\n        this.rootEl.append(createButtons());\n\n        let modeWrapper;\n        {\n            modeWrapper = BB.el({\n                content: LANG('layers-blending') + '&nbsp;',\n                css: {\n                    fontSize: '15px',\n                },\n            });\n\n            this.modeSelect = new Select<TMixMode>({\n                optionArr: [\n                    'source-over',\n                    undefined,\n                    'darken',\n                    'multiply',\n                    'color-burn',\n                    undefined,\n                    'lighten',\n                    'screen',\n                    'color-dodge',\n                    undefined,\n                    'overlay',\n                    'soft-light',\n                    'hard-light',\n                    undefined,\n                    'difference',\n                    'exclusion',\n                    undefined,\n                    'hue',\n                    'saturation',\n                    'color',\n                    'luminosity',\n                ].map((item: any) => {\n                    return item ? [item, translateBlending(item)] : undefined;\n                }),\n                onChange: (val) => {\n                    this.klCanvas.setMixMode(this.selectedSpotIndex, val as TMixMode);\n                    this.update(this.selectedSpotIndex);\n                },\n                css: {\n                    marginBottom: '10px',\n                },\n                name: 'layer-blend-mode',\n            });\n\n            modeWrapper.append(this.modeSelect.getElement());\n            this.rootEl.append(modeWrapper);\n        }\n\n        this.rootEl.append(listDiv);\n\n        this.klHistory.addListener(() => {\n            if (this.rootEl.style.display !== 'block') {\n                return;\n            }\n            this.createLayerList();\n        });\n\n        this.createLayerList();\n    }\n\n    // ---- interface ----\n    update(activeLayerSpotIndex?: number): void {\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\n            this.selectedSpotIndex = activeLayerSpotIndex;\n        }\n        this.updateButtons();\n        setTimeout(() => this.createLayerList(), 1);\n    }\n\n    getSelected(): number {\n        return this.selectedSpotIndex;\n    }\n\n    activateLayer(spotIndex: number): void {\n        if (spotIndex < 0 || spotIndex > this.layerElArr.length - 1) {\n            throw (\n                'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + this.layerElArr.length\n            );\n        }\n        this.selectedSpotIndex = spotIndex;\n        this.modeSelect.setValue(this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr);\n        for (let i = 0; i < this.layerElArr.length; i++) {\n            const layer = this.layerElArr[i];\n            const isSelected = this.selectedSpotIndex === layer.spot;\n\n            css(layer, {\n                boxShadow: '',\n            });\n            layer.classList.toggle('kl-layer--selected', isSelected);\n            layer.opacitySlider.setActive(isSelected);\n            layer.isSelected = isSelected;\n        }\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n    }\n\n    setUiState(stateStr: TUiLayout): void {\n        this.uiState = stateStr;\n\n        if (this.uiState === 'left') {\n            css(this.largeThumbDiv, {\n                left: '280px',\n                right: '',\n            });\n        } else {\n            css(this.largeThumbDiv, {\n                left: '',\n                right: '280px',\n            });\n        }\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","import { BB } from '../../bb/bb';\nimport { floodFillBits } from '../image-operations/flood-fill';\nimport { drawShape } from '../image-operations/shape-tool';\nimport { renderText, TRenderTextParam } from '../image-operations/render-text';\nimport {\n    isLayerFill,\n    TFillSampling,\n    TGradient,\n    TKlProject,\n    TLayerFromKlCanvas,\n    TMixMode,\n    TRgb,\n    TShapeToolObject,\n} from '../kl-types';\nimport { drawProject } from './draw-project';\nimport { LANG } from '../../language/language';\nimport { drawGradient } from '../image-operations/gradient-tool';\nimport { TBounds, TRect } from '../../bb/bb-types';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { compose, identity, Matrix, rotate, scale, translate } from 'transformation-matrix';\nimport { getSelectionPath2d } from '../../bb/multi-polygon/get-selection-path-2d';\nimport { transformMultiPolygon } from '../../bb/multi-polygon/transform-multi-polygon';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\nimport { integerBounds } from '../../bb/math/math';\nimport { matrixToTuple } from '../../bb/math/matrix-to-tuple';\nimport { getEraseColor } from '../brushes/erase-color';\nimport { HISTORY_TILE_SIZE, KlHistory } from '../history/kl-history';\nimport { getNextLayerId } from '../history/get-next-layer-id';\nimport {\n    THistoryEntryDataComposed,\n    THistoryEntryLayerComposed,\n    TLayerId,\n} from '../history/history.types';\nimport { createFillColorTiles } from '../history/create-fill-color-tiles';\nimport { updateLayersViaComposed } from './update-layers-via-composed';\nimport { isHistoryEntryOpacityChange } from '../history/push-helpers/is-history-entry-opacity-change';\nimport { isHistoryEntryVisibilityChange } from '../history/push-helpers/is-history-entry-visibility-change';\nimport { transformBounds } from '../../bb/transform/transform-bounds';\nimport { getSelectionSampleBounds } from './get-selection-sample-bounds';\nimport { createLayerMap } from '../history/push-helpers/create-layer-map';\nimport { Eyedropper } from './eyedropper';\nimport { copyImageDataTile } from '../history/image-data-tile';\nimport { randomUuid } from '../../bb/base/base';\nimport { getSelectionBounds } from '../select-tool/get-selection-bounds';\nimport { translateMultiPolygon } from '../../bb/multi-polygon/translate-multi-polygon';\nimport { getBinaryMask } from '../select-tool/get-binary-mask';\n\n// TODO remove in 2026\n// workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n// reported 2021-13 (v96), fixed 2022-02 (v99)\n// affects: source-in, source-out, destination-in, destination-atop\nfunction workaroundForChromium1281185(ctx: CanvasRenderingContext2D): void {\n    ctx.save();\n    ctx.fillStyle = 'rgba(0,0,0,0.01)';\n    ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n    ctx.restore();\n}\n\nconst allowedMixModes = [\n    'source-over',\n    'darken',\n    'multiply',\n    'color-burn',\n    'lighten',\n    'screen',\n    'color-dodge',\n    'overlay',\n    'soft-light',\n    'hard-light',\n    'difference',\n    'exclusion',\n    'hue',\n    'saturation',\n    'color',\n    'luminosity',\n] as const;\n\nexport const MAX_LAYERS = 16;\n\nexport type TKlCanvasLayer = {\n    id: TLayerId;\n    index: number; // certain brushes need to know\n    name: string;\n    mixModeStr: TMixMode;\n    isVisible: boolean;\n    opacity: number;\n    compositeObj?: TLayerComposite;\n    canvas: HTMLCanvasElement;\n    context: CanvasRenderingContext2D;\n};\n\nexport type TSelectionSample = {\n    image: HTMLCanvasElement | undefined; // undefined if all pixels transparent\n    transformation: Matrix;\n};\n\nexport type TLayerComposite = {\n    draw: (ctx: CanvasRenderingContext2D) => void;\n};\n\nconst KL_CANVAS_DEBUGGING = false;\n\n/**\n * The image/canvas that the user paints on\n * Has layers. layers have names and opacity.\n *\n * Interacts with klHistory\n */\nexport class KlCanvas {\n    private isDestroyed = false;\n    private width: number;\n    private height: number;\n    private layers: TKlCanvasLayer[];\n    private eyedropper: Eyedropper;\n    private selection: undefined | MultiPolygon = undefined;\n    private klHistory: KlHistory;\n    /**\n     * Transforming via selection creates a selection sample, which is the area of a layer which got selected.\n     * This way consecutive transformations don't resample each time.\n     * The selection is not yet applied in the sample, so it can be sharp when drawing it. (e.g. when upscaling)\n     */\n    private selectionSample: undefined | TSelectionSample = undefined;\n\n    private updateIndices(): void {\n        this.layers.forEach((item, index) => {\n            item.index = index;\n        });\n    }\n\n    private getSelectionOrFallback(): MultiPolygon {\n        return (\n            this.selection ?? [\n                [\n                    [\n                        [0, 0],\n                        [this.width, 0],\n                        [this.width, this.height],\n                        [0, this.height],\n                        [0, 0],\n                    ],\n                ],\n            ]\n        );\n    }\n\n    /**\n     * Create selection sample from the current selection. If none, will create of entire layer.\n     */\n    private createSelectionSample(layerIndex: number): void {\n        const sampleBounds = this.getSelectionArea(layerIndex);\n\n        // empty\n        if (!sampleBounds) {\n            this.selectionSample = {\n                image: undefined,\n                transformation: identity(),\n            };\n            return;\n        }\n\n        const srcLayer = this.layers[layerIndex];\n        const sampleCanvas = BB.canvas(sampleBounds.width, sampleBounds.height);\n        const sampleCtx = BB.ctx(sampleCanvas);\n        sampleCtx.save();\n        sampleCtx.translate(-sampleBounds.x, -sampleBounds.y);\n        sampleCtx.drawImage(srcLayer.canvas, 0, 0);\n        sampleCtx.restore();\n\n        this.selectionSample = {\n            image: sampleCanvas,\n            transformation: translate(sampleBounds.x, sampleBounds.y),\n        };\n    }\n\n    /**\n     * transforms selection and selectionSample\n     */\n    private transformSelectionAndSample(transformation: Matrix): void {\n        if (!this.selectionSample) {\n            throw new Error('no selection sample');\n        }\n        if (this.selection) {\n            this.selection = transformMultiPolygon(this.selection, transformation);\n        }\n        this.selectionSample.transformation = compose([\n            transformation,\n            this.selectionSample.transformation,\n        ]);\n    }\n\n    private drawSelectionSample(layerIndex: number, isPixelated: boolean): void {\n        if (!this.selectionSample) {\n            throw new Error('no selection sample');\n        }\n\n        if (!this.selectionSample.image) {\n            // selection sample, but it's empty. noop\n            return;\n        }\n\n        const targetLayer = this.layers[layerIndex];\n        const targetCtx = BB.ctx(targetLayer.canvas);\n\n        const selection = this.getSelectionOrFallback();\n        const selectionPath = getSelectionPath2d(selection);\n\n        targetCtx.save();\n        targetCtx.clip(selectionPath);\n        targetCtx.setTransform(...matrixToTuple(this.selectionSample.transformation));\n        if (isPixelated) {\n            targetCtx.imageSmoothingEnabled = false;\n        }\n        targetCtx.drawImage(this.selectionSample.image, 0, 0);\n        targetCtx.restore();\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(\n        history: KlHistory,\n        private layerNrOffset: number = 0,\n    ) {\n        this.klHistory = history;\n        this.layers = [];\n        if (KL_CANVAS_DEBUGGING) {\n            (window as any).getCanvasLayers = () => this.layers;\n        }\n        this.eyedropper = new Eyedropper();\n        this.width = 0;\n        this.height = 0;\n        this.updateViaComposed(\n            {\n                projectId: { value: randomUuid() },\n                size: { width: 0, height: 0 },\n                activeLayerId: '',\n                selection: { value: [] },\n                layerMap: {},\n            },\n            this.klHistory.getComposed(),\n        );\n    }\n\n    /*\n     * Resets canvas -> 1 layer, 100% opacity,\n     * unless layers provided.\n     * @param p\n     */\n    reset(p: {\n        projectId?: string; // uuid\n        width: number;\n        height: number;\n        color?: TRgb; // optional - fill color\n        image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\n        layerName?: string; // if via image\n        layers?: {\n            id: TLayerId;\n            name: string;\n            isVisible: boolean;\n            opacity: number;\n            mixModeStr: TMixMode;\n            image: HTMLCanvasElement;\n        }[];\n    }): number {\n        if (\n            !p.width ||\n            !p.height ||\n            p.width < 1 ||\n            p.height < 1 ||\n            isNaN(p.width) ||\n            isNaN(p.height)\n        ) {\n            throw new Error('invalid canvas size');\n        }\n\n        this.klHistory.pause(true);\n\n        this.width = p.width;\n        this.height = p.height;\n        this.selection = undefined;\n        this.clearSelectionSample();\n\n        this.layers.splice(1, Math.max(0, this.layers.length - 1));\n\n        if (p.layers) {\n            for (let i = 0; i < p.layers.length; i++) {\n                const pItem = p.layers[i];\n                if (!this.layers[i]) {\n                    this.addLayer();\n                }\n                const layer = this.layers[i];\n                layer.id = pItem.id;\n                layer.name = pItem.name;\n                layer.isVisible = pItem.isVisible;\n                layer.mixModeStr = pItem.mixModeStr ? pItem.mixModeStr : 'source-over';\n                layer.canvas.width = this.width;\n                layer.canvas.height = this.height;\n                layer.context.drawImage(pItem.image, 0, 0);\n                this.setOpacity(i, pItem.opacity);\n            }\n        } else {\n            const layer = this.layers[0];\n            layer.name = p.layerName ? p.layerName : LANG('layers-layer') + ' 1';\n            layer.isVisible = true;\n            layer.canvas.width = this.width;\n            layer.canvas.height = this.height;\n            layer.mixModeStr = 'source-over';\n            this.setOpacity(0, 1);\n            if (p.color) {\n                this.layerFill(0, p.color);\n            } else if (p.image) {\n                layer.context.drawImage(p.image, 0, 0);\n            }\n        }\n        this.updateIndices();\n\n        this.klHistory.pause(false);\n\n        if (!this.klHistory.isPaused()) {\n            const historyEntryData: THistoryEntryDataComposed = {\n                projectId: {\n                    value: p.projectId ?? randomUuid(),\n                },\n                size: {\n                    width: this.width,\n                    height: this.height,\n                },\n                selection: { value: this.selection },\n                activeLayerId: this.layers[this.layers.length - 1].id,\n                layerMap: createLayerMap(this.layers, {\n                    attributes: 'all',\n                }) as Record<TLayerId, THistoryEntryLayerComposed>,\n            };\n            this.klHistory.push(historyEntryData);\n        }\n\n        return this.layers.length - 1;\n    }\n\n    isLayerLimitReached(): boolean {\n        return this.layers.length >= MAX_LAYERS;\n    }\n\n    getWidth(): number {\n        return this.width;\n    }\n\n    getHeight(): number {\n        return this.height;\n    }\n\n    /**\n     * without resizing\n     */\n    setSize(width: number, height: number): void {\n        this.width = width;\n        this.height = height;\n    }\n\n    getLayerCount(): number {\n        return this.layers.length;\n    }\n\n    resize(w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\n        if (\n            !w ||\n            !h ||\n            (w === this.width && h === this.height) ||\n            isNaN(w) ||\n            isNaN(h) ||\n            w < 1 ||\n            h < 1\n        ) {\n            return false;\n        }\n        w = Math.max(w, 1);\n        h = Math.max(h, 1);\n\n        let tmp1, tmp2;\n\n        if (algorithm === 'pixelated') {\n            tmp1 = BB.canvas(w, h);\n            const tmp1Ctx = BB.ctx(tmp1);\n            tmp1Ctx.imageSmoothingEnabled = false;\n            for (let i = 0; i < this.layers.length; i++) {\n                if (i > 0) {\n                    tmp1Ctx.clearRect(0, 0, w, h);\n                }\n                const layer = this.layers[i];\n                tmp1Ctx.drawImage(layer.canvas, 0, 0, w, h);\n                layer.canvas.width = w;\n                layer.canvas.height = h;\n                layer.context.drawImage(tmp1, 0, 0);\n            }\n        } else if (algorithm === 'smooth') {\n            tmp1 = BB.canvas();\n            tmp2 = BB.canvas();\n            for (let i = 0; i < this.layers.length; i++) {\n                BB.resizeCanvas(this.layers[i].canvas, w, h, tmp1, tmp2);\n            }\n        } else {\n            throw new Error('unknown resize algorithm');\n        }\n\n        if (this.selection) {\n            this.selection = transformMultiPolygon(\n                this.selection,\n                scale(w / this.width, h / this.height),\n            );\n        }\n        this.width = w;\n        this.height = h;\n\n        this.klHistory.push({\n            size: {\n                width: this.width,\n                height: this.height,\n            },\n            layerMap: createLayerMap(this.layers, { attributes: ['tiles'] }),\n            ...(this.selection ? { selection: { value: this.selection } } : {}),\n        });\n\n        return true;\n    }\n\n    /**\n     * crop / extend\n     */\n    resizeCanvas(p: {\n        left: number;\n        top: number;\n        right: number;\n        bottom: number;\n        fillColor?: TRgb;\n    }): void {\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\n        const offX = Math.round(p.left);\n        const offY = Math.round(p.top);\n\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\n        }\n\n        for (let i = 0; i < this.layers.length; i++) {\n            const ctemp = BB.canvas(this.width, this.height);\n            const layer = this.layers[i];\n            BB.ctx(ctemp).drawImage(layer.canvas, 0, 0);\n\n            layer.canvas.width = newW;\n            layer.canvas.height = newH;\n\n            layer.context.save();\n            if (i === 0 && p.fillColor) {\n                layer.context.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\n                layer.context.fillRect(0, 0, newW, newH);\n                layer.context.clearRect(offX, offY, this.width, this.height);\n            }\n            layer.context.drawImage(ctemp, offX, offY);\n            layer.context.restore();\n        }\n        this.width = newW;\n        this.height = newH;\n\n        if (this.selection) {\n            this.selection = translateMultiPolygon(this.selection, offX, offY);\n        }\n        this.klHistory.push({\n            size: {\n                width: this.width,\n                height: this.height,\n            },\n            layerMap: createLayerMap(this.layers, { attributes: ['tiles'] }),\n            ...(this.selection ? { selection: { value: this.selection } } : {}),\n        });\n    }\n\n    /**\n     * will be inserted above of selected\n     */\n    addLayer(\n        selectedIndex?: number,\n        data?: {\n            name?: string;\n            mixModeStr?: TMixMode;\n            isVisible: boolean;\n            opacity: number;\n            image: HTMLCanvasElement | HTMLImageElement | ((ctx: CanvasRenderingContext2D) => void);\n        },\n    ): false | number {\n        if (this.isLayerLimitReached()) {\n            return false;\n        }\n        const index = selectedIndex === undefined ? this.layers.length : selectedIndex + 1;\n\n        const canvas = BB.canvas(this.width, this.height);\n        const context = BB.ctx(canvas);\n        if (data) {\n            if (typeof data.image === 'function') {\n                data.image(context);\n            } else {\n                context.drawImage(data.image, 0, 0);\n            }\n        }\n\n        const layerId = getNextLayerId();\n        const layer: TKlCanvasLayer = {\n            id: layerId,\n            index,\n            name:\n                data && data.name !== undefined\n                    ? data.name\n                    : LANG('layers-layer') + ' ' + (this.layers.length + this.layerNrOffset),\n            mixModeStr: data ? (data.mixModeStr ?? 'source-over') : 'source-over',\n            isVisible: data ? data.isVisible : true,\n            opacity: data ? data.opacity : 1,\n            canvas,\n            context,\n        };\n\n        this.layers.splice(index, 0, layer);\n\n        this.klHistory.pause(true);\n        this.setOpacity(index, 1);\n        this.klHistory.pause(false);\n        this.updateIndices();\n\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                activeLayerId: layerId,\n                layerMap: createLayerMap(\n                    this.layers,\n                    { attributes: ['index'] },\n                    {\n                        layerId,\n                        attributes: 'all',\n                        tiles: data\n                            ? undefined\n                            : createFillColorTiles(this.width, this.height, 'transparent'),\n                    },\n                ),\n            });\n        }\n\n        return index;\n    }\n\n    duplicateLayer(srcIndex: number): false | number {\n        if (!this.layers[srcIndex] || this.isLayerLimitReached()) {\n            return false;\n        }\n        const srcLayer = this.layers[srcIndex];\n        const newIndex = srcIndex + 1;\n\n        const composed = this.klHistory.getComposed();\n        const srcComposed = composed.layerMap[srcLayer.id];\n\n        const canvas = BB.canvas(this.width, this.height);\n        const ctx = BB.ctx(canvas);\n        const layerId = getNextLayerId();\n        const newLayer: TKlCanvasLayer = {\n            id: layerId,\n            index: newIndex,\n            name: srcLayer.name + ' ' + LANG('layers-copy'),\n            mixModeStr: srcLayer.mixModeStr,\n            isVisible: srcLayer.isVisible,\n            opacity: srcLayer.opacity,\n            canvas,\n            context: ctx,\n        };\n\n        this.layers.splice(newIndex, 0, newLayer);\n\n        {\n            // draw into new layer from old\n            const tilesPerX = Math.ceil(this.width / HISTORY_TILE_SIZE);\n            srcComposed.tiles.forEach((tile, index) => {\n                const x = index % tilesPerX;\n                const y = Math.floor(index / tilesPerX);\n                ctx.save();\n                if (isLayerFill(tile)) {\n                    ctx.fillStyle = tile.fill;\n                    ctx.fillRect(\n                        x * HISTORY_TILE_SIZE,\n                        y * HISTORY_TILE_SIZE,\n                        HISTORY_TILE_SIZE,\n                        HISTORY_TILE_SIZE,\n                    );\n                } else {\n                    ctx.putImageData(tile.data, x * HISTORY_TILE_SIZE, y * HISTORY_TILE_SIZE);\n                }\n                ctx.restore();\n            });\n        }\n\n        this.updateIndices();\n\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                activeLayerId: layerId,\n                layerMap: createLayerMap(\n                    this.layers,\n                    { attributes: ['index'] },\n                    {\n                        layerId,\n                        attributes: 'all',\n                        tiles: srcComposed.tiles.map((tile) => {\n                            if (isLayerFill(tile)) {\n                                return { ...tile };\n                            }\n                            return copyImageDataTile(tile);\n                        }),\n                    },\n                ),\n            });\n        }\n        return srcIndex + 1;\n    }\n\n    getLayerContext(index: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\n        if (this.layers[index]) {\n            return this.layers[index].context;\n        }\n        if (doReturnNull) {\n            return null;\n        }\n        throw new Error(\n            'layer of index ' + index + ' not found (in ' + this.layers.length + ' layers)',\n        );\n    }\n\n    removeLayer(index: number): false | number {\n        const toDeleteLayer = this.layers[index];\n        if (!toDeleteLayer) {\n            return false;\n        }\n        BB.freeCanvas(toDeleteLayer.canvas);\n        this.layers.splice(index, 1);\n        this.updateIndices();\n        const activeLayerIndex = Math.max(0, index - 1);\n        const activeLayerId = this.layers[activeLayerIndex].id;\n\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                activeLayerId,\n                layerMap: createLayerMap(this.layers, { attributes: ['index'] }),\n            });\n        }\n        return activeLayerIndex;\n    }\n\n    renameLayer(index: number, name: string): boolean {\n        const targetLayer = this.layers[index];\n        if (targetLayer) {\n            targetLayer.name = name;\n        } else {\n            return false;\n        }\n\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                layerMap: createLayerMap(this.layers, {\n                    layerId: targetLayer.id,\n                    attributes: ['name'],\n                }),\n            });\n        }\n\n        return true;\n    }\n\n    setOpacity(layerIndex: number, opacity: number): void {\n        if (!this.layers[layerIndex]) {\n            return;\n        }\n        opacity = Math.max(0, Math.min(1, opacity));\n        this.layers[layerIndex].opacity = opacity;\n\n        if (!this.klHistory.isPaused()) {\n            const layerId = this.layers[layerIndex].id;\n            const topEntry = this.klHistory.getEntries().at(-1)!.data;\n            const replaceTop = isHistoryEntryOpacityChange(topEntry, layerId);\n            this.klHistory.push(\n                {\n                    layerMap: createLayerMap(this.layers, {\n                        layerId,\n                        attributes: ['opacity'],\n                    }),\n                },\n                replaceTop,\n            );\n        }\n    }\n\n    setLayerIsVisible(layerIndex: number, isVisible: boolean): void {\n        if (this.layers[layerIndex]) {\n            this.layers[layerIndex].isVisible = isVisible;\n        } else {\n            throw new Error(`layer ${layerIndex} undefined`);\n        }\n\n        if (!this.klHistory.isPaused()) {\n            const layerId = this.layers[layerIndex].id;\n            const topEntry = this.klHistory.getEntries().at(-1)!.data;\n            const replaceTop = isHistoryEntryVisibilityChange(topEntry, layerId);\n            this.klHistory.push(\n                {\n                    layerMap: createLayerMap(this.layers, {\n                        layerId,\n                        attributes: ['isVisible'],\n                    }),\n                },\n                replaceTop,\n            );\n        }\n    }\n\n    moveLayer(index: number, delta: number): void | number {\n        if (delta === 0) {\n            return;\n        }\n        if (!this.layers[index]) {\n            return;\n        }\n        const temp = this.layers[index];\n        this.layers.splice(index, 1);\n        const targetIndex = Math.max(0, Math.min(index + delta, this.layers.length));\n        this.layers.splice(targetIndex, 0, temp);\n        this.updateIndices();\n\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                activeLayerId: this.layers[targetIndex].id,\n                layerMap: createLayerMap(this.layers, { attributes: ['index'] }),\n            });\n        }\n\n        return targetIndex;\n    }\n\n    mergeLayers(\n        layerBottomIndex: number,\n        layerTopIndex: number,\n        mixModeStr: TMixMode | 'as-alpha',\n    ): void | number {\n        if (\n            !this.layers[layerBottomIndex] ||\n            !this.layers[layerTopIndex] ||\n            layerBottomIndex === layerTopIndex\n        ) {\n            return;\n        }\n        //order messed up\n        if (layerBottomIndex > layerTopIndex) {\n            const temp = layerBottomIndex;\n            layerBottomIndex = layerTopIndex;\n            layerTopIndex = temp;\n        }\n\n        const topLayer = this.layers[layerTopIndex];\n        const bottomLayer = this.layers[layerBottomIndex];\n\n        const topOpacity = this.layers[layerTopIndex].opacity;\n        const mergedPixelData = topLayer.opacity > 0;\n        if (mergedPixelData) {\n            const bottomCtx = bottomLayer.context;\n            bottomCtx.save();\n\n            if (mixModeStr === 'as-alpha') {\n                // todo remove this?\n\n                BB.convertToAlphaChannelCanvas(topLayer.canvas);\n                bottomCtx.globalCompositeOperation = 'destination-in';\n                bottomCtx.globalAlpha = topOpacity;\n                bottomCtx.drawImage(topLayer.canvas, 0, 0);\n            } else {\n                if (mixModeStr) {\n                    bottomCtx.globalCompositeOperation = mixModeStr;\n                }\n                bottomCtx.globalAlpha = topOpacity;\n                bottomCtx.drawImage(topLayer.canvas, 0, 0);\n            }\n\n            bottomCtx.restore();\n\n            mixModeStr && workaroundForChromium1281185(bottomCtx);\n        }\n        this.klHistory.pause(true);\n        this.removeLayer(layerTopIndex);\n        this.klHistory.pause(false);\n\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                activeLayerId: bottomLayer.id,\n                layerMap: createLayerMap(\n                    this.layers,\n                    { attributes: ['index'] },\n                    mergedPixelData ? { layerId: bottomLayer.id, attributes: 'all' } : undefined,\n                ),\n            });\n        }\n\n        return layerBottomIndex;\n    }\n\n    mergeAll(): number | false {\n        if (this.layers.length === 1) {\n            return false;\n        }\n\n        // draw all on bottom layer\n        const bottomLayer = this.layers[0];\n        bottomLayer.name = LANG('layers-layer') + ' 1';\n        const bottomCtx = bottomLayer.context;\n        for (let i = 1; i < this.layers.length; i++) {\n            const layer = this.layers[i];\n            if (!layer.isVisible || layer.opacity === 0) {\n                continue;\n            }\n            bottomCtx.save();\n            bottomCtx.globalCompositeOperation = layer.mixModeStr;\n            bottomCtx.globalAlpha = layer.opacity;\n            bottomCtx.drawImage(layer.canvas, 0, 0);\n            bottomCtx.restore();\n        }\n\n        this.klHistory.pause(true);\n\n        // remove upper layers\n        for (let i = this.layers.length - 1; i > 0; i--) {\n            this.removeLayer(i);\n        }\n\n        this.klHistory.pause(false);\n\n        if (!this.klHistory.isPaused()) {\n            const activeLayerId = bottomLayer.id;\n            this.klHistory.push({\n                activeLayerId,\n                layerMap: createLayerMap(this.layers, { attributes: ['tiles'] }),\n            });\n        }\n\n        return 0;\n    }\n\n    // rotates the canvas with all layers. either by 90, 180, or 270 degrees\n    rotate(deg: number): void {\n        while (deg < 0) {\n            deg += 360;\n        }\n        deg %= 360;\n        if (deg !== 90 && deg !== 180 && deg !== 270) {\n            return;\n        }\n        const temp = BB.canvas();\n        if (deg === 180) {\n            temp.width = this.width;\n            temp.height = this.height;\n        } else if (deg === 90 || deg === 270) {\n            temp.width = this.height;\n            temp.height = this.width;\n        }\n        let matrix: Matrix = identity();\n        if (deg === 90) {\n            matrix = compose(translate(this.height, 0), rotate(Math.PI / 2));\n        } else if (deg === 180) {\n            matrix = compose(translate(this.width, this.height), rotate(Math.PI));\n        } else if (deg === 270) {\n            matrix = compose(translate(0, this.width), rotate((3 * Math.PI) / 2));\n        }\n        const ctx = BB.ctx(temp);\n        for (let i = 0; i < this.layers.length; i++) {\n            ctx.clearRect(0, 0, temp.width, temp.height);\n            ctx.save();\n            ctx.setTransform(...matrixToTuple(matrix));\n            ctx.drawImage(this.layers[i].canvas, 0, 0);\n            ctx.restore();\n            this.layers[i].canvas.width = temp.width;\n            this.layers[i].canvas.height = temp.height;\n            this.layers[i].context.drawImage(temp, 0, 0);\n        }\n        this.width = temp.width;\n        this.height = temp.height;\n\n        if (this.selection) {\n            this.selection = transformMultiPolygon(this.selection, matrix);\n        }\n\n        this.klHistory.push({\n            size: {\n                width: this.width,\n                height: this.height,\n            },\n            layerMap: createLayerMap(this.layers, { attributes: ['tiles'] }),\n            ...(this.selection ? { selection: { value: this.selection } } : {}),\n        });\n    }\n\n    flip(isHorizontal: boolean, isVertical: boolean, layerIndex?: number): void {\n        if (!isHorizontal && !isVertical) {\n            return;\n        }\n\n        const temp = BB.canvas(this.width, this.height);\n        temp.width = this.width;\n        temp.height = this.height;\n        const tempCtx = BB.ctx(temp);\n\n        const matrix = compose(\n            translate(temp.width / 2, temp.height / 2),\n            scale(isHorizontal ? -1 : 1, isVertical ? -1 : 1),\n            translate(-temp.width / 2, -temp.height / 2),\n        );\n\n        for (let i = 0; i < this.layers.length; i++) {\n            if ((layerIndex || layerIndex === 0) && i !== layerIndex) {\n                continue;\n            }\n\n            tempCtx.save();\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\n            tempCtx.setTransform(...matrixToTuple(matrix));\n            tempCtx.drawImage(this.layers[i].canvas, 0, 0);\n            tempCtx.restore();\n\n            this.layers[i].context.clearRect(\n                0,\n                0,\n                this.layers[i].canvas.width,\n                this.layers[i].canvas.height,\n            );\n            this.layers[i].context.drawImage(temp, 0, 0);\n        }\n\n        if (this.selection) {\n            this.selection = transformMultiPolygon(this.selection, matrix);\n        }\n\n        const targetLayer = layerIndex === undefined ? undefined : this.layers[layerIndex];\n        this.klHistory.push({\n            layerMap: createLayerMap(\n                this.layers,\n                targetLayer\n                    ? { layerId: targetLayer.id, attributes: ['tiles'] }\n                    : { attributes: ['tiles'] },\n            ),\n            ...(this.selection ? { selection: { value: this.selection } } : {}),\n        });\n    }\n\n    // arbitrary drawing operation & focus layer\n    drawOperation(layerIndex: number, operation: (ctx: CanvasRenderingContext2D) => void): void {\n        const targetLayer = this.layers[layerIndex];\n        const ctx = targetLayer.context;\n        operation(ctx);\n\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                activeLayerId: targetLayer.id,\n                layerMap: createLayerMap(this.layers, {\n                    layerId: targetLayer.id,\n                    attributes: ['tiles'],\n                }),\n            });\n        }\n    }\n\n    layerFill(\n        layerIndex: number,\n        colorObj: TRgb,\n        compositeOperation?: string,\n        doClipSelection?: boolean,\n    ): void {\n        const ctx = this.layers[layerIndex].context;\n        ctx.save();\n        const isUniformFill =\n            !(doClipSelection && this.selection) && compositeOperation === undefined;\n        if (compositeOperation) {\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\n        }\n\n        let bounds: TBounds | undefined;\n        if (doClipSelection && this.selection) {\n            const selectionPath = getSelectionPath2d(this.selection);\n            ctx.clip(selectionPath);\n            bounds = integerBounds(getMultiPolyBounds(this.selection));\n        }\n\n        const fill = 'rgba(' + colorObj.r + ',' + colorObj.g + ',' + colorObj.b + ',1)';\n        ctx.fillStyle = fill;\n        ctx.fillRect(\n            0,\n            0,\n            this.layers[layerIndex].canvas.width,\n            this.layers[layerIndex].canvas.height,\n        );\n        ctx.restore();\n\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n        // TODO remove if chrome updated\n        ctx.save();\n        ctx.fillStyle = 'rgba(0,0,0,0.01)';\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n        ctx.restore();\n\n        /*if (!document.getElementById('testocanvas')) {\n            layerCanvasArr[layerIndex].id = 'testocanvas';\n            document.body.append(layerCanvasArr[layerIndex]);\n            BB.css(layerCanvasArr[layerIndex], {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                zIndex: '1111111',\n                transform: 'scale(0.2)',\n                border: '10px solid red',\n            });\n        }\n        if (!document.getElementById('testocanvas')) {\n            let c = document.createElement('canvas');\n            c.width = 1000;\n            c.height = 1000;\n            let ctx2 = c.getContext('2d');\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\n            c.id = 'testocanvas';\n            document.body.append(c);\n            BB.css(c, {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                zIndex: '1111111',\n                transform: 'scale(0.2)',\n                border: '10px solid red',\n            });\n        }*/\n\n        if (!this.klHistory.isPaused()) {\n            const targetLayer = this.layers[layerIndex];\n            this.klHistory.push({\n                layerMap: createLayerMap(this.layers, {\n                    layerId: targetLayer.id,\n                    attributes: ['tiles'],\n                    tiles: isUniformFill\n                        ? createFillColorTiles(this.width, this.height, fill)\n                        : undefined,\n                    bounds,\n                }),\n            });\n        }\n    }\n\n    floodFill(\n        layerIndex: number, // index of layer to be filled\n        x: number, // starting point\n        y: number,\n        rgb: TRgb | null, // fill color, if null -> erase\n        opacity: number,\n        tolerance: number,\n        sampleStr: TFillSampling,\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\n        isContiguous: boolean,\n    ): void {\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\n            return;\n        }\n        tolerance = Math.round(tolerance);\n        x = Math.round(x);\n        y = Math.round(y);\n\n        if (!['above', 'current', 'all'].includes(sampleStr)) {\n            throw new Error('invalid sampleStr');\n        }\n        const selectionMask = this.selection\n            ? getBinaryMask(this.selection, this.width, this.height)\n            : undefined;\n        if (selectionMask && selectionMask[y * this.width + x] === 0) {\n            // don't fill if outside of selection\n            return;\n        }\n\n        const targetLayer = this.layers[layerIndex];\n        let result: ReturnType<typeof floodFillBits>;\n        let targetCtx;\n        let targetImageData;\n\n        if (sampleStr === 'all') {\n            const srcCanvas =\n                this.layers.length === 1 ? this.layers[0].canvas : this.getCompleteCanvas(1);\n            const srcCtx = BB.ctx(srcCanvas);\n            const srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\n            const srcData = srcImageData.data;\n            result = floodFillBits(\n                srcData,\n                selectionMask,\n                this.width,\n                this.height,\n                x,\n                y,\n                tolerance,\n                Math.round(grow),\n                isContiguous,\n            );\n\n            targetCtx = targetLayer.context;\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\n        } else {\n            const srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\n\n            if (srcIndex >= this.layers.length) {\n                return;\n            }\n\n            const srcCtx = this.layers[srcIndex].context;\n            const srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\n            const srcData = srcImageData.data;\n            result = floodFillBits(\n                srcData,\n                selectionMask,\n                this.width,\n                this.height,\n                x,\n                y,\n                tolerance,\n                Math.round(grow),\n                isContiguous,\n            );\n\n            targetCtx = layerIndex === srcIndex ? srcCtx : targetLayer.context;\n            targetImageData =\n                layerIndex === srcIndex\n                    ? srcImageData\n                    : targetCtx.getImageData(0, 0, this.width, this.height);\n        }\n\n        const targetData = targetImageData.data;\n        if (rgb) {\n            if (opacity === 1) {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4] = rgb.r;\n                        targetData[i * 4 + 1] = rgb.g;\n                        targetData[i * 4 + 2] = rgb.b;\n                        targetData[i * 4 + 3] = 255;\n                    }\n                }\n            } else {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\n                        targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\n                        targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\n                    }\n                }\n            }\n        } else {\n            // erase\n            if (opacity === 1) {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4 + 3] = 0;\n                    }\n                }\n            } else {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 0, opacity);\n                    }\n                }\n            }\n        }\n        targetCtx.putImageData(targetImageData, 0, 0);\n\n        // const ctx = this.layers[layerIndex].context;\n        // ctx.save();\n        // ctx.fillStyle = 'rgba(255,0,0,0.2)';\n        // ctx.fillRect(\n        //     result.bounds.x1,\n        //     result.bounds.y1,\n        //     result.bounds.x2 - result.bounds.x1,\n        //     result.bounds.y2 - result.bounds.y1,\n        // );\n        // ctx.restore();\n\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                layerMap: createLayerMap(this.layers, {\n                    layerId: targetLayer.id,\n                    attributes: ['tiles'],\n                    bounds: result.bounds,\n                }),\n            });\n        }\n    }\n\n    /**\n     * draw geometric shape (circle, line, rect)\n     * @param layerIndex\n     * @param shapeObj\n     */\n    drawShape(layerIndex: number, shapeObj: TShapeToolObject): void {\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\n            return;\n        }\n        const targetLayer = this.layers[layerIndex];\n        const selectionPath = this.selection\n            ? new Path2D(getSelectionPath2d(this.selection))\n            : undefined;\n        const bounds = integerBounds(drawShape(targetLayer.context, shapeObj, selectionPath));\n\n        // debug\n        /*const ctx = this.layers[layerIndex].context;\n        ctx.save();\n        ctx.fillStyle = 'rgba(255,0,0,0.2)';\n        ctx.fillRect(bounds.x1, bounds.y1, bounds.x2 - bounds.x1, bounds.y2 - bounds.y1);\n        ctx.restore();*/\n\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                layerMap: createLayerMap(this.layers, {\n                    layerId: targetLayer.id,\n                    attributes: ['tiles'],\n                    bounds,\n                }),\n            });\n        }\n    }\n\n    drawGradient(layerIndex: number, gradientObj: TGradient): void {\n        const targetLayer = this.layers[layerIndex];\n        const selectionPath = this.selection\n            ? new Path2D(getSelectionPath2d(this.selection))\n            : undefined;\n        drawGradient(targetLayer.context, gradientObj, selectionPath);\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                layerMap: createLayerMap(this.layers, {\n                    layerId: targetLayer.id,\n                    attributes: ['tiles'],\n                }),\n            });\n        }\n    }\n\n    text(layerIndex: number, p: TRenderTextParam): void {\n        const targetLayer = this.layers[layerIndex];\n        const rect = renderText(\n            targetLayer.canvas,\n            BB.copyObj(p),\n            this.selection ? new Path2D(getSelectionPath2d(this.selection)) : undefined,\n        );\n\n        // add 2, because rect not entirely accurate\n        const padding = 2 + (p.stroke ? p.stroke.lineWidth / 2 : 0);\n        let changedBounds = transformBounds(\n            {\n                x1: rect.x,\n                y1: rect.y,\n                x2: rect.x + rect.width,\n                y2: rect.y + rect.height,\n            },\n            compose(translate(p.x, p.y), rotate(-p.angleRad)),\n        );\n        changedBounds = integerBounds({\n            x1: changedBounds.x1 - padding,\n            y1: changedBounds.y1 - padding,\n            x2: changedBounds.x2 + padding,\n            y2: changedBounds.y2 + padding,\n        });\n\n        // const ctx = this.layers[layerIndex].context;\n        // ctx.save();\n        // ctx.fillStyle = 'rgba(255,0,0,0.2)';\n        // ctx.fillRect(bounds.x1, bounds.y1, bounds.x2 - bounds.x1, bounds.y2 - bounds.y1);\n        // ctx.restore();\n\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                layerMap: createLayerMap(this.layers, {\n                    layerId: targetLayer.id,\n                    attributes: ['tiles'],\n                    bounds: changedBounds,\n                }),\n            });\n        }\n    }\n\n    eraseLayer(p: {\n        layerIndex: number;\n        useAlphaLock?: boolean; // default false\n        useSelection?: boolean; // default false\n    }): void {\n        const targetLayer = this.layers[p.layerIndex];\n        const ctx = targetLayer.context;\n        ctx.save();\n        let bounds: TBounds | undefined;\n        if (p.useSelection && this.selection) {\n            const selectionPath = getSelectionPath2d(this.selection);\n            ctx.clip(selectionPath);\n            bounds = integerBounds(getMultiPolyBounds(this.selection));\n        }\n        if (p.useAlphaLock) {\n            ctx.globalCompositeOperation = 'source-in';\n        } else {\n            ctx.globalCompositeOperation = 'destination-out';\n        }\n        ctx.fillStyle = BB.ColorConverter.toRgbStr(getEraseColor());\n        ctx.fillRect(0, 0, this.width, this.height);\n        ctx.restore();\n\n        const isUniformFill = !p.useAlphaLock && !(p.useSelection && this.selection);\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                layerMap: createLayerMap(this.layers, {\n                    layerId: targetLayer.id,\n                    attributes: ['tiles'],\n                    tiles: isUniformFill\n                        ? createFillColorTiles(this.width, this.height, 'transparent')\n                        : undefined,\n                    bounds,\n                }),\n            });\n        }\n    }\n\n    getLayers(): {\n        id: string;\n        canvas: HTMLCanvasElement;\n        context: CanvasRenderingContext2D;\n        isVisible: boolean;\n        opacity: number;\n        name: string;\n        mixModeStr: TMixMode;\n    }[] {\n        return this.layers.map((layer) => {\n            return {\n                id: layer.id,\n                canvas: layer.canvas,\n                context: layer.context,\n                isVisible: layer.isVisible,\n                opacity: layer.opacity,\n                name: layer.name,\n                mixModeStr: layer.mixModeStr,\n            };\n        });\n    }\n\n    getLayersFast(): {\n        canvas: HTMLCanvasElement;\n        isVisible: boolean;\n        opacity: number;\n        name: string;\n        mixModeStr: TMixMode;\n        compositeObj?: TLayerComposite;\n    }[] {\n        return this.layers.map((item) => {\n            return {\n                canvas: item.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                name: item.name,\n                mixModeStr: item.mixModeStr,\n                ...(item.compositeObj ? { compositeObj: item.compositeObj } : {}),\n            };\n        });\n    }\n\n    getLayerIndex(canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\n        for (let i = 0; i < this.layers.length; i++) {\n            if (this.layers[i].canvas === canvasObj) {\n                return i;\n            }\n        }\n        if (!doReturnNull) {\n            throw new Error('layer not found (in ' + this.layers.length + ' layers)');\n        }\n        return null;\n    }\n\n    getLayerOld(index: number, doReturnNull?: boolean): null | TLayerFromKlCanvas {\n        if (this.layers[index]) {\n            return {\n                context: this.layers[index].context,\n                isVisible: this.layers[index].isVisible,\n                opacity: this.layers[index].opacity,\n                name: this.layers[index].name,\n                id: index,\n            };\n        }\n        if (!doReturnNull) {\n            throw new Error(\n                'layer of index ' + index + ' not found (in ' + this.layers.length + ' layers)',\n            );\n        }\n        return null;\n    }\n\n    getLayer(index: number): TKlCanvasLayer {\n        return this.layers[index];\n    }\n\n    getColorAt(x: number, y: number): TRgb {\n        return this.eyedropper.getColorAt(x, y, this.klHistory.getComposed());\n    }\n\n    getCompleteCanvas(factor: number, maskSelection?: boolean): HTMLCanvasElement {\n        return drawProject(this.getProject(), factor, maskSelection ? this.selection : undefined);\n    }\n\n    getProject(): TKlProject {\n        return {\n            projectId: this.klHistory.getComposed().projectId.value,\n            width: this.width,\n            height: this.height,\n            layers: this.layers.map((layer) => {\n                return {\n                    name: layer.name,\n                    isVisible: layer.isVisible,\n                    opacity: layer.opacity,\n                    mixModeStr: layer.mixModeStr,\n                    image: layer.canvas,\n                };\n            }),\n        };\n    }\n\n    setMixMode(layerIndex: number, mixModeStr: TMixMode): void {\n        const targetLayer = this.layers[layerIndex];\n        targetLayer.mixModeStr = mixModeStr;\n\n        if (!this.klHistory.isPaused()) {\n            this.klHistory.push({\n                layerMap: createLayerMap(this.layers, {\n                    layerId: targetLayer.id,\n                    attributes: ['mixModeStr'],\n                }),\n            });\n        }\n    }\n\n    /**\n     * Set composite drawing step for KlCanvasWorkspace.\n     * To apply temporary manipulations to a layer.\n     *\n     * @param layerIndex\n     * @param compositeObj\n     */\n    setComposite(layerIndex: number, compositeObj: undefined | TLayerComposite): void {\n        if (!this.layers[layerIndex]) {\n            throw new Error('invalid layer');\n        }\n        this.layers[layerIndex].compositeObj = compositeObj;\n    }\n\n    setSelection(selection?: MultiPolygon): void {\n        if (!this.selection && !selection) {\n            return;\n        }\n\n        this.selection = selection;\n\n        this.klHistory.push({\n            selection: {\n                value: selection,\n            },\n        });\n    }\n\n    getSelection(): KlCanvas['selection'] {\n        return this.selection;\n    }\n\n    /**\n     * Transforms (move, not clone) the selected region (or the entire canvas if no selection).\n     * Also transforms the selection, unless there is no selection.\n     * Creates a new selection sample.\n     */\n    transformViaSelection(p: {\n        sourceLayer: number;\n        targetLayer?: number;\n        transformation: Matrix; // relative to (0,0) of canvas\n        isPixelated?: boolean; // default false\n        backgroundIsTransparent?: boolean;\n    }): void {\n        this.klHistory.pause(true);\n        this.createSelectionSample(p.sourceLayer);\n        const srcBounds = getSelectionSampleBounds(this.selectionSample!);\n        this.eraseLayer({\n            layerIndex: p.sourceLayer,\n            useSelection: true,\n            useAlphaLock: p.sourceLayer === 0 && !p.backgroundIsTransparent,\n        });\n        this.transformSelectionAndSample(p.transformation);\n        const targetBounds = getSelectionSampleBounds(this.selectionSample!);\n        this.drawSelectionSample(p.targetLayer ?? p.sourceLayer, p.isPixelated ?? false);\n        this.klHistory.pause(false);\n\n        const srcAndTargetEqual = !p.targetLayer || p.sourceLayer === p.targetLayer;\n\n        // if (srcBounds) {\n        //     const layerCtx = this.layers[p.sourceLayer].context;\n        //     layerCtx.save();\n        //     layerCtx.fillStyle = 'rgba(255,0,0,0.2)';\n        //     layerCtx.fillRect(\n        //         srcBounds.x1,\n        //         srcBounds.y1,\n        //         srcBounds.x2 - srcBounds.x1,\n        //         srcBounds.y2 - srcBounds.y1,\n        //     );\n        //     layerCtx.restore();\n        // }\n\n        // if (targetBounds) {\n        //     const layerCtx = this.layers[p.targetLayer ?? p.sourceLayer].context;\n        //     layerCtx.save();\n        //     layerCtx.fillStyle = 'rgba(0,0,255,0.2)';\n        //     layerCtx.fillRect(\n        //         targetBounds.x1,\n        //         targetBounds.y1,\n        //         targetBounds.x2 - targetBounds.x1,\n        //         targetBounds.y2 - targetBounds.y1,\n        //     );\n        //     layerCtx.restore();\n        // }\n\n        if (!this.klHistory.isPaused()) {\n            const srcLayer = this.layers[p.sourceLayer];\n            const targetLayer =\n                p.targetLayer !== undefined && p.targetLayer !== p.sourceLayer\n                    ? this.layers[p.targetLayer]\n                    : undefined;\n            this.klHistory.push({\n                selection: {\n                    value: this.selection,\n                },\n                layerMap: createLayerMap(\n                    this.layers,\n                    {\n                        layerId: srcLayer.id,\n                        attributes: ['tiles'],\n                        bounds: srcAndTargetEqual\n                            ? BB.updateBounds(srcBounds, targetBounds)\n                            : srcBounds,\n                    },\n                    targetLayer\n                        ? {\n                              layerId: targetLayer.id,\n                              attributes: ['tiles'],\n                              bounds: targetBounds,\n                          }\n                        : undefined,\n                ),\n            });\n        }\n    }\n\n    /**\n     * Transforms the selection sample (creates one if there's none, same way as in transformViaSelection)\n     * and draws a clone on target layer.\n     * Also transforms the selection, unless there is no selection.\n     */\n    transformCloneViaSelection(p: {\n        sourceLayer?: number;\n        targetLayer: number;\n        transformation: Matrix; // relative to (0,0) of canvas\n        isPixelated?: boolean; // default false\n    }): void {\n        this.klHistory.pause(true);\n        if (!this.selectionSample) {\n            if (p.sourceLayer === undefined) {\n                throw new Error('no source layer');\n            }\n            this.createSelectionSample(p.sourceLayer);\n        }\n        this.transformSelectionAndSample(p.transformation);\n        this.drawSelectionSample(p.targetLayer, p.isPixelated ?? false);\n        const targetBounds = getSelectionSampleBounds(this.selectionSample!);\n        this.klHistory.pause(false);\n\n        // if (targetBounds) {\n        //     const layerCtx = this.layers[p.targetLayer ?? p.sourceLayer].context;\n        //     layerCtx.save();\n        //     layerCtx.fillStyle = 'rgba(0,0,255,0.2)';\n        //     layerCtx.fillRect(\n        //         targetBounds.x1,\n        //         targetBounds.y1,\n        //         targetBounds.x2 - targetBounds.x1,\n        //         targetBounds.y2 - targetBounds.y1,\n        //     );\n        //     layerCtx.restore();\n        // }\n\n        if (!this.klHistory.isPaused() && targetBounds) {\n            const targetLayer = this.layers[p.targetLayer];\n            this.klHistory.push({\n                selection: {\n                    value: this.selection,\n                },\n                layerMap: createLayerMap(this.layers, {\n                    layerId: targetLayer.id,\n                    attributes: ['tiles'],\n                    bounds: targetBounds,\n                }),\n            });\n        }\n    }\n\n    // todo remove - requires rewrite of transform via selection, though\n    clearSelectionSample(): void {\n        if (!this.selectionSample) {\n            return;\n        }\n        this.selectionSample.image && BB.freeCanvas(this.selectionSample.image);\n        this.selectionSample = undefined;\n    }\n\n    getSelectionArea(layerIndex: number): TRect | undefined {\n        const srcLayer = this.layers[layerIndex];\n        const selection = this.getSelectionOrFallback();\n        return getSelectionBounds(selection, srcLayer.context);\n    }\n\n    getSelectionSample(): TSelectionSample | undefined {\n        return this.selectionSample;\n    }\n\n    /**\n     * called after undo/redo, to apply the changes to the klCanvas.\n     * before - before undo/redo was called - equivalent to current state of klCanvas.\n     * after - after undo/redo was called.\n     */\n    updateViaComposed(before: THistoryEntryDataComposed, after: THistoryEntryDataComposed): void {\n        this.width = after.size.width;\n        this.height = after.size.height;\n        this.selection = after.selection.value;\n        this.layers = updateLayersViaComposed(this.layers, before, after);\n    }\n\n    destroy(): void {\n        if (this.isDestroyed) {\n            return;\n        }\n        this.layers.forEach((layer) => {\n            BB.freeCanvas(layer.canvas);\n            layer.canvas = {} as HTMLCanvasElement;\n            layer.context = {} as CanvasRenderingContext2D;\n        });\n        this.layers = [];\n        this.isDestroyed = true;\n    }\n}\n","import { TBounds } from '../../bb/bb-types';\n\n/**\n * Set values in data within rect to 254, unless they're 255\n *\n * @param data Uint8Array\n * @param width int\n * @param x0 int\n * @param y0 int\n * @param x1 int >x0\n * @param y1 int >y0\n */\nfunction fillRect(\n    data: Uint8Array,\n    width: number,\n    x0: number,\n    y0: number,\n    x1: number,\n    y1: number,\n): void {\n    for (let x = x0; x <= x1; x++) {\n        for (let y = y0; y <= y1; y++) {\n            if (data[y * width + x] === 255) {\n                continue;\n            }\n            data[y * width + x] = 254;\n        }\n    }\n}\n\n// test, should fill, if there is a tolerance < 255\nfunction toleranceTest(\n    srcArr: Uint8ClampedArray,\n    initR: number,\n    initG: number,\n    initB: number,\n    initA: number,\n    toleranceSquared: number, // already squared for performance\n    i: number,\n): boolean {\n    return (\n        (srcArr[i * 4] - initR) ** 2 <= toleranceSquared &&\n        (srcArr[i * 4 + 1] - initG) ** 2 <= toleranceSquared &&\n        (srcArr[i * 4 + 2] - initB) ** 2 <= toleranceSquared &&\n        (srcArr[i * 4 + 3] - initA) ** 2 <= toleranceSquared\n    );\n}\n\n// check is within selection\nfunction selectionMaskTest(selectionMaskArr: Uint8Array | undefined, i: number): boolean {\n    return !selectionMaskArr || !!selectionMaskArr[i];\n}\n\n/**\n *\n * @param srcArr Uint8ClampedArray rgba\n * @param selectionMaskArr Uint8Array width x height, 0 or 1 values\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param px int\n * @param py int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n */\nfunction floodFill(\n    srcArr: Uint8ClampedArray,\n    selectionMaskArr: Uint8Array | undefined,\n    targetArr: Uint8Array,\n    width: number,\n    height: number,\n    px: number,\n    py: number,\n    tolerance: number,\n    grow: number,\n    isContiguous: boolean,\n): TBounds {\n    const initR = srcArr[(py * width + px) * 4];\n    const initG = srcArr[(py * width + px) * 4 + 1];\n    const initB = srcArr[(py * width + px) * 4 + 2];\n    const initA = srcArr[(py * width + px) * 4 + 3];\n    const view = new DataView(srcArr.buffer);\n    const init = view.getUint32((py * width + px) * 4, true);\n    const toleranceSquared = tolerance ** 2;\n    const bounds: TBounds = { x1: px, y1: py, x2: px, y2: py };\n\n    if (isContiguous) {\n        const q: number[] = []; // queue of pixel indices. they are already filled.\n        q.push(py * width + px); // starting pixel, where the user clicked to fill\n        targetArr[py * width + px] = 255;\n\n        let i: number, e: number;\n        let x: number, y: number;\n        while (q.length) {\n            // checks neighbors of queued pixels, fills, and queues them.\n            // Adds to queue after filling it. Skip if was already filled.\n\n            i = q.pop()!;\n\n            y = Math.floor(i / width);\n            x = i % width;\n\n            if (x > 0) {\n                // can go left\n                e = i - 1;\n                if (\n                    targetArr[e] !== 255 &&\n                    selectionMaskTest(selectionMaskArr, e) &&\n                    (view.getUint32(e * 4, true) === init ||\n                        (tolerance > 0 &&\n                            toleranceTest(srcArr, initR, initG, initB, initA, toleranceSquared, e)))\n                ) {\n                    bounds.x1 = Math.min(bounds.x1, x - 1);\n                    targetArr[e] = 255;\n                    q.push(e);\n                }\n            }\n            if (x < width - 1) {\n                // can go right\n                e = i + 1;\n                if (\n                    targetArr[e] !== 255 &&\n                    selectionMaskTest(selectionMaskArr, e) &&\n                    (view.getUint32(e * 4, true) === init ||\n                        (tolerance > 0 &&\n                            toleranceTest(srcArr, initR, initG, initB, initA, toleranceSquared, e)))\n                ) {\n                    bounds.x2 = Math.max(bounds.x2, x + 1);\n                    targetArr[e] = 255;\n                    q.push(e);\n                }\n            }\n            if (y > 0) {\n                // can go up\n                e = i - width;\n                if (\n                    targetArr[e] !== 255 &&\n                    selectionMaskTest(selectionMaskArr, e) &&\n                    (view.getUint32(e * 4, true) === init ||\n                        (tolerance > 0 &&\n                            toleranceTest(srcArr, initR, initG, initB, initA, toleranceSquared, e)))\n                ) {\n                    bounds.y1 = Math.min(bounds.y1, y - 1);\n                    targetArr[e] = 255;\n                    q.push(e);\n                }\n            }\n            if (y < height - 1) {\n                // can go down\n                e = i + width;\n                if (\n                    targetArr[e] !== 255 &&\n                    selectionMaskTest(selectionMaskArr, e) &&\n                    (view.getUint32(e * 4, true) === init ||\n                        (tolerance > 0 &&\n                            toleranceTest(srcArr, initR, initG, initB, initA, toleranceSquared, e)))\n                ) {\n                    bounds.y2 = Math.max(bounds.y2, y + 1);\n                    targetArr[e] = 255;\n                    q.push(e);\n                }\n            }\n        }\n    } else {\n        // not contiguous\n        for (let y = 0, i = 0; y < height; y++) {\n            for (let x = 0; x < width; x++, i++) {\n                if (\n                    view.getUint32(i * 4, true) === init ||\n                    (selectionMaskTest(selectionMaskArr, i) &&\n                        tolerance > 0 &&\n                        toleranceTest(srcArr, initR, initG, initB, initA, toleranceSquared, i))\n                ) {\n                    targetArr[i] = 255;\n                    if (x < bounds.x1) {\n                        bounds.x1 = x;\n                    }\n                    if (y < bounds.y1) {\n                        bounds.y1 = y;\n                    }\n                    if (x > bounds.x2) {\n                        bounds.x2 = x;\n                    }\n                    if (y > bounds.y2) {\n                        bounds.y2 = y;\n                    }\n                }\n            }\n        }\n    }\n\n    if (grow === 0) {\n        return bounds;\n    }\n\n    // --- grow ---\n\n    // how does it grow? it finds all pixel at the edge.\n    // then depending on what kind of edge it is, it draws a rectangle into target\n    // In the rectangle each pixel has the value 254, or else it will mess it all up.\n    // after it's all done, replaces it with 255\n    let x0, x1, y0, y1;\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\n    for (let x = bounds.x1; x <= bounds.x2; x++) {\n        for (let y = bounds.y1; y <= bounds.y2; y++) {\n            if (targetArr[y * width + x] !== 255) {\n                continue;\n            }\n\n            // bounds of rectangle\n            x0 = x;\n            x1 = x;\n            y0 = y;\n            y1 = y;\n\n            l = targetArr[y * width + x - 1] !== 255;\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\n            t = targetArr[(y - 1) * width + x] !== 255;\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\n            r = targetArr[y * width + x + 1] !== 255;\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\n            b = targetArr[(y + 1) * width + x] !== 255;\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\n\n            if (l) {\n                // left\n                x0 = x - grow;\n            }\n            if (l && tl && t) {\n                // top left\n                x0 = x - grow;\n                y0 = y - grow;\n            }\n            if (t) {\n                // top\n                y0 = Math.min(y0, y - grow);\n            }\n            if (t && tr && r) {\n                // top right\n                y0 = Math.min(y0, y - grow);\n                x1 = x + grow;\n            }\n            if (r) {\n                // right\n                x1 = Math.max(x1, x + grow);\n            }\n            if (r && br && b) {\n                // bottom right\n                x1 = Math.max(x1, x + grow);\n                y1 = Math.max(y1, y + grow);\n            }\n            if (b) {\n                // bottom\n                y1 = Math.max(y1, y + grow);\n            }\n            if (b && bl && l) {\n                // bottom left\n                x0 = Math.min(x0, x - grow);\n                y1 = Math.max(y1, y + grow);\n            }\n\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\n                continue;\n            }\n\n            fillRect(\n                targetArr,\n                width,\n                Math.max(0, x0),\n                Math.max(0, y0),\n                Math.min(width - 1, x1),\n                Math.min(height - 1, y1),\n            );\n        }\n    }\n    for (let i = 0; i < width * height; i++) {\n        if (targetArr[i] === 254) {\n            targetArr[i] = 255;\n        }\n    }\n    // expand bounds by grow\n    bounds.x1 -= grow;\n    bounds.y1 -= grow;\n    bounds.x2 += grow;\n    bounds.y2 += grow;\n\n    return bounds;\n}\n\n/**\n * Does flood fill, and returns that. an array - 0 not filled, 255 filled.\n */\nexport function floodFillBits(\n    rgbaArr: Uint8ClampedArray,\n    // width x height, 0 or 1 values\n    selectionMaskArr: Uint8Array | undefined,\n    width: number, // int\n    height: number, // int\n    x: number, // int\n    y: number, // int\n    tolerance: number, // 0 - 255\n    grow: number, // int >= 0\n    isContiguous: boolean,\n): {\n    data: Uint8Array;\n    bounds: TBounds; // what area changed\n} {\n    x = Math.round(x); // just in case\n    y = Math.round(y);\n\n    const resultArr = new Uint8Array(new ArrayBuffer(width * height));\n\n    const bounds = floodFill(\n        rgbaArr,\n        selectionMaskArr,\n        resultArr,\n        width,\n        height,\n        x,\n        y,\n        tolerance,\n        grow,\n        isContiguous,\n    );\n\n    return {\n        data: resultArr,\n        bounds,\n    };\n}\n","import { BB } from '../../bb/bb';\nimport { TRgb, TShapeToolObject } from '../kl-types';\nimport { TBounds, TRect, TVector2D } from '../../bb/bb-types';\nimport { transformBounds } from '../../bb/transform/transform-bounds';\nimport { compose, rotate } from 'transformation-matrix';\nimport { matrixToTuple } from '../../bb/math/matrix-to-tuple';\n\n/**\n * Input processor for shape tool.\n * Coordinates are in canvas space.\n * angleRad is the angle of the canvas.\n */\nexport class ShapeTool {\n    private readonly onShape: (\n        isDone: boolean,\n        x1: number,\n        y1: number,\n        x2: number,\n        y2: number,\n        angleRad: number,\n    ) => void;\n    private downX: number = 0;\n    private downY: number = 0;\n    private downAngleRad: number = 0;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        onShape: (\n            isDone: boolean,\n            x1: number,\n            y1: number,\n            x2: number,\n            y2: number,\n            angleRad: number,\n        ) => void;\n    }) {\n        this.onShape = p.onShape;\n    }\n\n    onDown(x: number, y: number, angleRad: number): void {\n        this.downX = x;\n        this.downY = y;\n        this.downAngleRad = angleRad;\n    }\n\n    onMove(x: number, y: number): void {\n        this.onShape(false, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n\n    onUp(x: number, y: number): void {\n        this.onShape(true, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n}\n\n/**\n * Draw a shape (rectangle, ellipse, line)\n */\nexport function drawShape(\n    ctx: CanvasRenderingContext2D,\n    shapeObj: TShapeToolObject,\n    selectionPath?: Path2D,\n): TBounds {\n    shapeObj = {\n        // defaults\n        angleRad: 0,\n        isOutwards: false,\n        opacity: 1,\n        isEraser: false,\n        doLockAlpha: false,\n\n        ...BB.copyObj(shapeObj),\n    };\n    let bounds: TBounds = { x1: 0, y1: 0, x2: 0, y2: 0 };\n\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\n        if (shapeObj.angleRad === undefined) {\n            throw new Error('angleRad undefined');\n        }\n\n        const lineWidth = shapeObj.lineWidth === undefined ? -1 : Math.round(shapeObj.lineWidth);\n        const angleDeg = (shapeObj.angleRad * 180) / Math.PI;\n\n        // --- prep color ---\n        if (\n            !shapeObj.isEraser &&\n            shapeObj.fillRgb === undefined &&\n            shapeObj.strokeRgb === undefined\n        ) {\n            throw new Error('fillRgb and strokeRgb undefined');\n        }\n        const colorRgb: TRgb = shapeObj.isEraser\n            ? { r: 255, g: 255, b: 255 }\n            : shapeObj.fillRgb\n              ? shapeObj.fillRgb\n              : shapeObj.strokeRgb!;\n\n        // --- prep canvas ---\n        ctx.save();\n        selectionPath && ctx.clip(selectionPath);\n        if (shapeObj.opacity) {\n            ctx.globalAlpha = shapeObj.opacity;\n        }\n        if (shapeObj.isEraser) {\n            ctx.globalCompositeOperation = 'destination-out';\n        }\n        if (shapeObj.doLockAlpha) {\n            ctx.globalCompositeOperation = 'source-atop';\n        }\n        const transformation = compose(rotate(-shapeObj.angleRad));\n        ctx.setTransform(...matrixToTuple(transformation));\n        if (shapeObj.fillRgb) {\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(colorRgb);\n        } else if (shapeObj.strokeRgb) {\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(colorRgb);\n            ctx.lineWidth = lineWidth;\n        }\n\n        let x1 = shapeObj.x1;\n        let y1 = shapeObj.y1;\n        let x2 = shapeObj.x2;\n        let y2 = shapeObj.y2;\n\n        // --- angle snapping ---\n        if (shapeObj.isAngleSnap) {\n            const r1 = BB.rotate(x1, y1, (shapeObj.angleRad / Math.PI) * 180);\n            const r2 = BB.rotate(x2, y2, (shapeObj.angleRad / Math.PI) * 180);\n\n            const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\n            const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n            const rotated = BB.rotateAround(\n                { x: x1, y: y1 },\n                { x: x2, y: y2 },\n                pAngleDegSnapped - pAngleDeg,\n            );\n            x2 = rotated.x;\n            y2 = rotated.y;\n\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) {\n                    // up or down\n                    x2 = x1;\n                } else {\n                    // left or right\n                    y2 = y1;\n                }\n            }\n        }\n\n        let x = x1;\n        let y = y1;\n        let dX = x2 - x1;\n        let dY = y2 - y1;\n\n        // --- 1:1 ratio ---\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, (shapeObj.angleRad / Math.PI) * 180);\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, (shapeObj.angleRad / Math.PI) * 180);\n\n            const rx = r1.x;\n            const ry = r1.y;\n            let rdX = r2.x - r1.x;\n            let rdY = r2.y - r1.y;\n\n            if (Math.abs(rdX) < Math.abs(rdY)) {\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\n            } else {\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\n            }\n            r2.x = rx + rdX;\n            r2.y = ry + rdY;\n\n            r1 = BB.rotate(r1.x, r1.y, (-shapeObj.angleRad / Math.PI) * 180);\n            r2 = BB.rotate(r2.x, r2.y, (-shapeObj.angleRad / Math.PI) * 180);\n\n            x1 = r1.x;\n            y1 = r1.y;\n            x2 = r2.x;\n            y2 = r2.y;\n\n            x = x1;\n            y = y1;\n            dX = x2 - x1;\n            dY = y2 - y1;\n        }\n\n        // outwards modifier\n        if (shapeObj.isOutwards) {\n            x -= dX;\n            y -= dY;\n            dX *= 2;\n            dY *= 2;\n\n            x1 = x;\n            y1 = y;\n            x2 = x + dX;\n            y2 = y + dY;\n        }\n\n        let p1;\n        let p2;\n        if (shapeObj.type === 'line') {\n            // --- line ---\n\n            // rounded\n            const x1r = Math.round(x1);\n            const y1r = Math.round(y1);\n            const x2r = Math.round(x2);\n            const y2r = Math.round(y2);\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (lineWidth % 2 === 0) {\n                if (y1r === y2r) {\n                    p1 = {\n                        x: x1f,\n                        y: y1r,\n                    };\n                    p2 = {\n                        x: x2f,\n                        y: y2r,\n                    };\n\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                } else if (x1r === x2r) {\n                    p1 = {\n                        x: x1r,\n                        y: y1f,\n                    };\n                    p2 = {\n                        x: x2r,\n                        y: y2f,\n                    };\n\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                } else {\n                    p1 = {\n                        x: x1,\n                        y: y1,\n                    };\n                    p2 = {\n                        x: x2,\n                        y: y2,\n                    };\n                }\n            } else {\n                p1 = {\n                    x: x1f,\n                    y: y1f,\n                };\n                p2 = {\n                    x: x2f,\n                    y: y2f,\n                };\n                if (y1f === y2f) {\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                    p1.y += 0.5;\n                    p2.y += 0.5;\n                } else if (x1f === x2f) {\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                    p1.x += 0.5;\n                    p2.x += 0.5;\n                } else {\n                    p1.x = x1;\n                    p1.y = y1;\n                    p2.x = x2;\n                    p2.y = y2;\n                }\n            }\n\n            bounds = {\n                x1: Math.min(p1.x, p2.x) - lineWidth / 2,\n                y1: Math.min(p1.y, p2.y) - lineWidth / 2,\n                x2: Math.max(p1.x, p2.x) + lineWidth / 2,\n                y2: Math.max(p1.y, p2.y) + lineWidth / 2,\n            };\n\n            p1 = BB.rotate(p1.x, p1.y, (shapeObj.angleRad / Math.PI) * 180);\n            p2 = BB.rotate(p2.x, p2.y, (shapeObj.angleRad / Math.PI) * 180);\n\n            ctx.beginPath();\n            ctx.moveTo(p1.x, p1.y);\n            ctx.lineTo(p2.x, p2.y);\n            ctx.stroke();\n        } else if (shapeObj.type === 'rect') {\n            // --- rect ---\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (angleDeg % 90 === 0) {\n                if (shapeObj.fillRgb) {\n                    if (x1 % 1 === 0) {\n                        x1 += 1;\n                    }\n                    if (y1 % 1 === 0) {\n                        y1 += 1;\n                    }\n                    if (x2 % 1 === 0) {\n                        x2 += 1;\n                    }\n                    if (y2 % 1 === 0) {\n                        y2 += 1;\n                    }\n\n                    p1 = {\n                        x: x1 < x2 ? x1f : x2f,\n                        y: y1 < y2 ? y1f : y2f,\n                    };\n                    p2 = {\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\n                    };\n                    p2.x = p1.x + p2.x;\n                    p2.y = p1.y + p2.y;\n                } else {\n                    if (lineWidth % 2 === 0) {\n                        p1 = {\n                            x: x1f,\n                            y: y1f,\n                        };\n                        p2 = {\n                            x: x2f,\n                            y: y2f,\n                        };\n                    } else {\n                        p1 = {\n                            x: x1f + 0.5,\n                            y: y1f + 0.5,\n                        };\n                        p2 = {\n                            x: x2f + 0.5,\n                            y: y2f + 0.5,\n                        };\n                    }\n                }\n            } else {\n                p1 = {\n                    x: x1,\n                    y: y1,\n                };\n                p2 = {\n                    x: x2,\n                    y: y2,\n                };\n            }\n\n            p1 = BB.rotate(p1.x, p1.y, (shapeObj.angleRad / Math.PI) * 180);\n            p2 = BB.rotate(p2.x, p2.y, (shapeObj.angleRad / Math.PI) * 180);\n            const rect: TRect = {\n                x: p1.x,\n                y: p1.y,\n                width: p2.x - p1.x,\n                height: p2.y - p1.y,\n            };\n\n            const padding = shapeObj.fillRgb ? 0 : lineWidth / 2;\n            bounds = transformBounds(\n                {\n                    x1: Math.min(p1.x, p2.x) - padding,\n                    y1: Math.min(p1.y, p2.y) - padding,\n                    x2: Math.max(p1.x, p2.x) + padding,\n                    y2: Math.max(p1.y, p2.y) + padding,\n                },\n                transformation,\n            );\n\n            if (shapeObj.fillRgb) {\n                ctx.fillRect(rect.x, rect.y, rect.width, rect.height);\n            } else {\n                ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);\n            }\n        } else {\n            // --- circle ---\n            p1 = BB.rotate(x1, y1, (shapeObj.angleRad / Math.PI) * 180);\n            p2 = BB.rotate(x2, y2, (shapeObj.angleRad / Math.PI) * 180);\n            x = p1.x;\n            y = p1.y;\n            dX = p2.x - p1.x;\n            dY = p2.y - p1.y;\n            const center: TVector2D = {\n                x: x + dX / 2,\n                y: y + dY / 2,\n            };\n            const rX = Math.abs(dX / 2);\n            const rY = Math.abs(dY / 2);\n\n            ctx.beginPath();\n            ctx.ellipse(center.x, center.y, rX, rY, 0, 0, Math.PI * 2);\n            if (shapeObj.fillRgb) {\n                ctx.fill();\n            } else {\n                ctx.stroke();\n            }\n            const padding = shapeObj.fillRgb ? 0 : lineWidth / 2;\n            // bounds are bigger than they need to be when it's rotated and rX ~ rY. should be good enough though.\n            bounds = transformBounds(\n                {\n                    x1: center.x - rX - padding,\n                    y1: center.y - rY - padding,\n                    x2: center.x + rX + padding,\n                    y2: center.y + rY + padding,\n                },\n                transformation,\n            );\n        }\n\n        ctx.restore();\n    } else {\n        throw new Error('unknown shape');\n    }\n\n    return bounds;\n}\n","import { TBounds } from '../bb-types';\nimport { applyToPoint, Matrix } from 'transformation-matrix';\n\nexport function transformBounds(bounds: TBounds, transform: Matrix): TBounds {\n    const p1 = applyToPoint(transform, { x: bounds.x1, y: bounds.y1 });\n    const p2 = applyToPoint(transform, { x: bounds.x2, y: bounds.y1 });\n    const p3 = applyToPoint(transform, { x: bounds.x2, y: bounds.y2 });\n    const p4 = applyToPoint(transform, { x: bounds.x1, y: bounds.y2 });\n    return {\n        x1: Math.min(p1.x, p2.x, p3.x, p4.x),\n        y1: Math.min(p1.y, p2.y, p3.y, p4.y),\n        x2: Math.max(p1.x, p2.x, p3.x, p4.x),\n        y2: Math.max(p1.y, p2.y, p3.y, p4.y),\n    };\n}\n","import { BB } from '../../bb/bb';\nimport { TBounds, TRect } from '../../bb/bb-types';\nimport { TRgba } from '../kl-types';\n\nexport type TTextFormat = 'left' | 'center' | 'right';\nexport type TTextFont = 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy' | string;\n\nexport type TRenderTextParam = {\n    text: string; // text to be drawn. can contain newlines\n\n    x: number;\n    y: number;\n    angleRad: number;\n    size: number; // px\n    align: TTextFormat;\n    isBold: boolean;\n    isItalic: boolean;\n    font: TTextFont;\n    letterSpacing?: number;\n    lineHeight?: number; // em\n    fill?: {\n        color: TRgba;\n    };\n    stroke?: {\n        color: TRgba;\n        lineWidth: number;\n    };\n};\n\n// accurately represents the bounds of the text, even it's fancy Zalgo text that tries to break layout\nfunction textMetricToRect(metrics: TextMetrics, align: TTextFormat): TRect {\n    const ascent = metrics.actualBoundingBoxAscent;\n    const descent = metrics.actualBoundingBoxDescent;\n    const left = metrics.actualBoundingBoxLeft;\n    const right = metrics.actualBoundingBoxRight;\n\n    const width = right + left; // More accurate width calculation considering left/right bounds\n    const height = ascent + descent;\n\n    if (align === 'left') {\n        return {\n            x: -left,\n            y: -ascent,\n            width: width,\n            height,\n        };\n    }\n    if (align === 'right') {\n        return {\n            x: -width,\n            y: -ascent,\n            width: width,\n            height,\n        };\n    }\n    // center\n    return {\n        x: -left,\n        y: -ascent,\n        width: width,\n        height,\n    };\n}\n\n/**\n * Draws text on a canvas.\n * Return bounds, relative to p.x, p.y.\n */\nexport function renderText(\n    canvas: HTMLCanvasElement,\n    p: TRenderTextParam,\n    selectionPath?: Path2D,\n): TRect {\n    p = BB.copyObj(p);\n\n    // setup context\n    const ctx = BB.ctx(canvas) as CanvasRenderingContext2D & {\n        letterSpacing: string;\n    };\n    ctx.save();\n    selectionPath && ctx.clip(selectionPath);\n    ctx.textAlign = p.align;\n    ctx.letterSpacing = p.letterSpacing ? p.letterSpacing + 'px' : '0';\n\n    // font\n    const fontArr = [p.size + 'px ' + (p.font ? p.font : 'sans-serif')];\n    if (p.isBold) {\n        fontArr.unshift('bold');\n    }\n    if (p.isItalic) {\n        fontArr.unshift('italic');\n    }\n    ctx.font = fontArr.join(' ');\n\n    // fill\n    ctx.fillStyle = p.fill ? BB.ColorConverter.toRgbaStr(p.fill.color) : 'transparent';\n\n    // stroke\n    ctx.strokeStyle = p.stroke ? BB.ColorConverter.toRgbaStr(p.stroke.color) : 'transparent';\n    if (p.stroke) {\n        ctx.lineWidth = p.stroke.lineWidth;\n        ctx.lineJoin = 'round';\n    }\n\n    ctx.translate(p.x, p.y);\n    ctx.rotate(-p.angleRad);\n\n    const lines = p.text.split('\\n').map((line) => line.replaceAll('\\t', '    '));\n\n    // bounds\n    const bounds: TBounds = {\n        x1: 0,\n        y1: 0,\n        x2: 0,\n        y2: 0,\n    };\n    {\n        let isFirst = true;\n        lines.forEach((line, lineIndex) => {\n            const metrics = ctx.measureText(line);\n            const x = 0;\n            const y = p.size * (p.lineHeight ?? 1) * lineIndex;\n            const mRect = textMetricToRect(metrics, p.align);\n            if (isFirst) {\n                isFirst = false;\n                bounds.x1 = x + mRect.x;\n                bounds.y1 = y + mRect.y;\n                bounds.x2 = x + mRect.x + mRect.width;\n                bounds.y2 = y + mRect.y + mRect.height;\n            } else {\n                bounds.x1 = Math.min(bounds.x1, x + mRect.x);\n                bounds.y1 = Math.min(bounds.y1, y + mRect.y);\n                bounds.x2 = Math.max(bounds.x2, x + mRect.x + mRect.width);\n                bounds.y2 = Math.max(bounds.y2, y + mRect.y + mRect.height);\n            }\n        });\n    }\n\n    // draw stroke\n    lines.forEach((line, lineIndex) => {\n        const x = 0;\n        const y = p.size * (p.lineHeight ?? 1) * lineIndex;\n        ctx.strokeText(line, x, y);\n    });\n\n    // draw fill\n    lines.forEach((line, lineIndex) => {\n        const x = 0;\n        const y = p.size * (p.lineHeight ?? 1) * lineIndex;\n        ctx.fillText(line, x, y);\n    });\n\n    ctx.restore();\n    return {\n        x: bounds.x1,\n        y: bounds.y1,\n        width: bounds.x2 - bounds.x1,\n        height: bounds.y2 - bounds.y1,\n    };\n}\n","import { BB } from '../../bb/bb';\nimport { isLayerFill, TKlProject } from '../kl-types';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { transformMultiPolygon } from '../../bb/multi-polygon/transform-multi-polygon';\nimport { scale } from 'transformation-matrix';\nimport { getSelectionPath2d } from '../../bb/multi-polygon/get-selection-path-2d';\n\nexport function drawProject(\n    project: TKlProject,\n    factor: number,\n    selection?: MultiPolygon,\n): HTMLCanvasElement {\n    const resultCanvas = BB.canvas(\n        Math.max(1, Math.round(project.width * factor)),\n        Math.max(1, Math.round(project.height * factor)),\n    );\n    const transformedSelection = selection\n        ? transformMultiPolygon(\n              selection,\n              scale(resultCanvas.width / project.width, resultCanvas.height / project.height),\n          )\n        : undefined;\n\n    const ctx = BB.ctx(resultCanvas);\n    ctx.save();\n    if (transformedSelection) {\n        ctx.clip(getSelectionPath2d(transformedSelection));\n    }\n    if (factor > 1) {\n        ctx.imageSmoothingEnabled = false;\n    }\n    for (let i = 0; i < project.layers.length; i++) {\n        const layer = project.layers[i];\n        if (!layer.isVisible || layer.opacity === 0) {\n            continue;\n        }\n        ctx.globalAlpha = layer.opacity;\n        const mixModeStr = layer.mixModeStr;\n        ctx.globalCompositeOperation = mixModeStr !== undefined ? mixModeStr : 'source-over';\n        if (isLayerFill(layer.image)) {\n            ctx.fillStyle = layer.image.fill;\n            ctx.fillRect(0, 0, resultCanvas.width, resultCanvas.height);\n        } else if (layer.image instanceof Array) {\n            throw new Error('not implemented');\n        } else {\n            ctx.drawImage(layer.image, 0, 0, resultCanvas.width, resultCanvas.height);\n        }\n    }\n    ctx.restore();\n    return resultCanvas;\n}\n","import { TGradient, TRgba } from '../kl-types';\nimport { BB } from '../../bb/bb';\n\ntype TOnGradient = (\n    isDone: boolean,\n    x1: number,\n    y1: number,\n    x2: number,\n    y2: number,\n    angleRad: number,\n) => void;\n\n/**\n * Input processor for gradient tool.\n * Coordinates are in canvas space.\n * angleRad is the angle of the canvas.\n */\nexport class GradientTool {\n    private downX: number = 0;\n    private downY: number = 0;\n    private downAngleRad: number = 0;\n    private readonly onGradient: TOnGradient;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: { onGradient: TOnGradient }) {\n        this.onGradient = p.onGradient;\n    }\n\n    onDown(x: number, y: number, angleRad: number): void {\n        this.downX = x;\n        this.downY = y;\n        this.downAngleRad = angleRad;\n    }\n\n    onMove(x: number, y: number): void {\n        this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n\n    onUp(x: number, y: number): void {\n        this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n}\n\nexport function drawGradient(\n    ctx: CanvasRenderingContext2D,\n    gradientObj: TGradient,\n    selectionPath?: Path2D,\n): void {\n    ctx.save();\n    selectionPath && ctx.clip(selectionPath);\n\n    const x1 = gradientObj.x1;\n    const y1 = gradientObj.y1;\n    let x2 = gradientObj.x2;\n    let y2 = gradientObj.y2;\n\n    if (gradientObj.doSnap) {\n        const angleDeg = (gradientObj.angleRad * 180) / Math.PI;\n\n        const r1 = BB.rotate(x1, y1, (gradientObj.angleRad / Math.PI) * 180);\n        const r2 = BB.rotate(x2, y2, (gradientObj.angleRad / Math.PI) * 180);\n\n        const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\n        const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n        const rotated = BB.rotateAround(\n            { x: x1, y: y1 },\n            { x: x2, y: y2 },\n            pAngleDegSnapped - pAngleDeg,\n        );\n        x2 = rotated.x;\n        y2 = rotated.y;\n\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) {\n                // up or down\n                x2 = x1;\n            } else {\n                // left or right\n                y2 = y1;\n            }\n        }\n    }\n\n    let baseColor = gradientObj.color1;\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) {\n        baseColor = { r: 255, g: 255, b: 255 };\n    }\n    let color1: TRgba = {\n        ...baseColor,\n        a: gradientObj.opacity,\n    };\n    let color2: TRgba = {\n        ...baseColor,\n        a: 0,\n    };\n    if (gradientObj.isReversed) {\n        const temp = color1;\n        color1 = color2;\n        color2 = temp;\n    }\n\n    let gradient: CanvasGradient;\n    if (gradientObj.type === 'linear') {\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n    } else if (gradientObj.type === 'linear-mirror') {\n        const d = {\n            x: x2 - x1,\n            y: y2 - y1,\n        };\n        gradient = ctx.createLinearGradient(x1 - d.x, y1 - d.y, x2, y2);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color2));\n        gradient.addColorStop(0.5, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n    } else if (gradientObj.type === 'radial') {\n        const r = BB.Vec2.dist({ x: x1, y: y1 }, { x: x2, y: y2 });\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n    }\n\n    ctx.fillStyle = gradient!;\n    if (gradientObj.isEraser) {\n        ctx.globalCompositeOperation = 'destination-out';\n    }\n    if (gradientObj.doLockAlpha) {\n        ctx.globalCompositeOperation = 'source-atop';\n    }\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n    ctx.restore();\n}\n","let layerId = 0;\nexport function getNextLayerId() {\n    return '' + layerId++;\n}\n","import { THistoryEntryLayerTile } from './history.types';\nimport { HISTORY_TILE_SIZE } from './kl-history';\n\nexport function createFillColorTiles(\n    width: number,\n    height: number,\n    fill: string,\n): THistoryEntryLayerTile[] {\n    const result: THistoryEntryLayerTile[] = [];\n    const tilesX = Math.ceil(width / HISTORY_TILE_SIZE);\n    const tilesY = Math.ceil(height / HISTORY_TILE_SIZE);\n    for (let y = 0; y < tilesY; y++) {\n        for (let x = 0; x < tilesX; x++) {\n            result.push({ fill });\n        }\n    }\n    return result;\n}\n","import { HISTORY_TILE_SIZE } from '../history/kl-history';\nimport { TKlCanvasLayer } from './kl-canvas';\nimport { THistoryEntryDataComposed } from '../history/history.types';\nimport { BB } from '../../bb/bb';\nimport { sortLayerMap } from '../history/sort-layer-map';\nimport { isLayerFill } from '../kl-types';\n\n/**\n * Applies history delta to the project, optimized for performance.\n * note: modifies the canvases in project\n */\nexport function updateLayersViaComposed(\n    layers: TKlCanvasLayer[],\n    before: THistoryEntryDataComposed,\n    after: THistoryEntryDataComposed,\n): TKlCanvasLayer[] {\n    const sizeDidChange =\n        before.size.width !== after.size.width || before.size.height !== after.size.height;\n\n    return Object.entries(after.layerMap)\n        .map(([id, composedAfterLayer]) => {\n            let canvas = {} as HTMLCanvasElement;\n            let context = {} as CanvasRenderingContext2D;\n            const composedBeforeLayer = before.layerMap[id];\n            const tilesPerX = Math.ceil(after.size.width / HISTORY_TILE_SIZE);\n\n            if (sizeDidChange || !composedBeforeLayer) {\n                // create new canvas\n                canvas = BB.canvas(after.size.width, after.size.height);\n                context = BB.ctx(canvas);\n\n                composedAfterLayer.tiles.forEach((item, index) => {\n                    const x = index % tilesPerX;\n                    const y = Math.floor(index / tilesPerX);\n                    if (isLayerFill(item)) {\n                        context.save();\n                        context.fillStyle = item!.fill;\n                        context.fillRect(\n                            x * HISTORY_TILE_SIZE,\n                            y * HISTORY_TILE_SIZE,\n                            HISTORY_TILE_SIZE,\n                            HISTORY_TILE_SIZE,\n                        );\n                        context.restore();\n                    } else {\n                        context.putImageData(\n                            item.data,\n                            x * HISTORY_TILE_SIZE,\n                            y * HISTORY_TILE_SIZE,\n                        );\n                    }\n                });\n            } else {\n                canvas = layers[composedBeforeLayer.index].canvas;\n                context = layers[composedBeforeLayer.index].context;\n                composedAfterLayer.tiles.forEach((item, index) => {\n                    if (item === composedBeforeLayer.tiles[index]) {\n                        // todo more advanced check ^\n                        return;\n                    }\n                    const x = index % tilesPerX;\n                    const y = Math.floor(index / tilesPerX);\n                    if (isLayerFill(item)) {\n                        context.save();\n                        context.fillStyle = item.fill;\n                        context.clearRect(\n                            x * HISTORY_TILE_SIZE,\n                            y * HISTORY_TILE_SIZE,\n                            HISTORY_TILE_SIZE,\n                            HISTORY_TILE_SIZE,\n                        );\n                        context.fillRect(\n                            x * HISTORY_TILE_SIZE,\n                            y * HISTORY_TILE_SIZE,\n                            HISTORY_TILE_SIZE,\n                            HISTORY_TILE_SIZE,\n                        );\n                        context.restore();\n                    } else {\n                        context.putImageData(\n                            item.data,\n                            x * HISTORY_TILE_SIZE,\n                            y * HISTORY_TILE_SIZE,\n                        );\n                    }\n                });\n            }\n\n            return {\n                id,\n                index: composedAfterLayer.index,\n                name: composedAfterLayer.name,\n                mixModeStr: composedAfterLayer.mixModeStr,\n                isVisible: composedAfterLayer.isVisible,\n                opacity: composedAfterLayer.opacity,\n                canvas,\n                context,\n            };\n        })\n        .sort(sortLayerMap);\n}\n","export function sortLayerMap(a: { index: number }, b: { index: number }): 1 | -1 | 0 {\n    if (a.index > b.index) {\n        return 1;\n    }\n    if (a.index < b.index) {\n        return -1;\n    }\n    return 0;\n}\n","import { THistoryEntryData } from '../history.types';\n\n// Is it a history entry where the *only* change is the opacity of layerId\nexport function isHistoryEntryOpacityChange(entry: THistoryEntryData, layerId: string): boolean {\n    const keys = Object.keys(entry);\n    if (keys.length !== 1 || !entry.layerMap) {\n        return false;\n    }\n    const ids = Object.keys(entry.layerMap);\n    for (let i = 0; i < ids.length; i++) {\n        const id = ids[i];\n        const layer = entry.layerMap[id];\n        if (id === layerId) {\n            const layerKeys = Object.keys(layer);\n            if (layerKeys.length !== 1 || layerKeys[0] !== 'opacity') {\n                return false;\n            }\n        } else {\n            const layerKeys = Object.keys(layer);\n            if (layerKeys.length > 0) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\n","import { THistoryEntryData } from '../history.types';\n\n// Is it a history entry where the *only* change is the visibility of layerId\nexport function isHistoryEntryVisibilityChange(entry: THistoryEntryData, layerId: string): boolean {\n    const keys = Object.keys(entry);\n    if (keys.length !== 1 || !entry.layerMap) {\n        return false;\n    }\n    const ids = Object.keys(entry.layerMap);\n    for (let i = 0; i < ids.length; i++) {\n        const id = ids[i];\n        const layer = entry.layerMap[id];\n        if (id === layerId) {\n            const layerKeys = Object.keys(layer);\n            if (layerKeys.length !== 1 || layerKeys[0] !== 'isVisible') {\n                return false;\n            }\n        } else {\n            const layerKeys = Object.keys(layer);\n            if (layerKeys.length > 0) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\n","import { TSelectionSample } from './kl-canvas';\nimport { TBounds } from '../../bb/bb-types';\nimport { transformBounds } from '../../bb/transform/transform-bounds';\nimport { integerBounds } from '../../bb/math/math';\n\nexport function getSelectionSampleBounds(selectionSample: TSelectionSample): TBounds | undefined {\n    if (!selectionSample.image) {\n        return undefined;\n    }\n    return integerBounds(\n        transformBounds(\n            {\n                x1: 0,\n                y1: 0,\n                x2: selectionSample.image.width,\n                y2: selectionSample.image.height,\n            },\n            selectionSample.transformation,\n        ),\n    );\n}\n","import { TKlCanvasLayer } from '../../canvas/kl-canvas';\nimport { TBounds } from '../../../bb/bb-types';\nimport { THistoryEntryLayer, THistoryEntryLayerTile, TLayerId } from '../history.types';\nimport { canvasToLayerTiles } from './canvas-to-layer-tiles';\n\ntype TLayerKey = keyof THistoryEntryLayer;\ntype TLayerMapGeneric = {\n    attributes: 'all' | TLayerKey[];\n};\ntype TLayerMapLayer = {\n    layerId: string;\n    attributes: 'all' | TLayerKey[];\n    bounds?: TBounds; // changed bounds\n    tiles?: (THistoryEntryLayerTile | undefined)[]; // custom tiles. bounds ignored if tiles set.\n};\nexport type TLayerMapConfigItem = TLayerMapGeneric | TLayerMapLayer;\n\n// create individual THistoryEntryLayer\nfunction createEntryLayer(\n    layer: TKlCanvasLayer,\n    attributes: 'all' | TLayerKey[],\n    bounds?: TBounds,\n    tiles?: (THistoryEntryLayerTile | undefined)[],\n): THistoryEntryLayer {\n    const useAll = attributes === 'all';\n    const result: THistoryEntryLayer = {};\n\n    if (useAll || attributes.includes('name')) {\n        result.name = layer.name;\n    }\n    if (useAll || attributes.includes('opacity')) {\n        result.opacity = layer.opacity;\n    }\n    if (useAll || attributes.includes('isVisible')) {\n        result.isVisible = layer.isVisible;\n    }\n    if (useAll || attributes.includes('mixModeStr')) {\n        result.mixModeStr = layer.mixModeStr;\n    }\n    if (useAll || attributes.includes('index')) {\n        result.index = layer.index;\n    }\n    if (useAll || attributes.includes('tiles')) {\n        result.tiles = tiles ?? canvasToLayerTiles(layer.context.canvas, bounds);\n    }\n    return result;\n}\n\n/**\n * Creates THistoryEntryData.layerMap from KlCanvas layers that can be pushed into history.\n *\n * items control what attributes will be set for each layer. Examples:\n * { attributes: ['index'] } - each layer only has index attribute. all layers will be in the map.\n * { layerId: '0', attributes: ['name']} - map only contains layer '0'. it only has 'name' attribute.\n * { layerId: '0', attributes: 'all'} - map only contains layer '0', with all attributes.\n * { layerId: '0', attributes: 'all'}, { attributes: ['index'] }\n *      - layer '0' has all attributes.\n *      - all other layers will be in the map, but only contain attribute 'index'.\n *\n *  Can further customize by setting what bounds changed, or provide custom tiles.\n */\nexport function createLayerMap(\n    layers: TKlCanvasLayer[],\n    ...items: (TLayerMapConfigItem | undefined)[]\n): Record<TLayerId, THistoryEntryLayer> {\n    const generic: TLayerMapGeneric = items.find((item) => item && !('layerId' in item)) ?? {\n        attributes: [],\n    };\n    const targets: TLayerMapLayer[] = items\n        .filter((item) => !!item)\n        .filter((item) => 'layerId' in item);\n\n    return Object.fromEntries(\n        layers.map((layer, index) => {\n            for (const target of targets) {\n                if (target.layerId === layer.id) {\n                    return [\n                        layer.id,\n                        createEntryLayer(layer, target.attributes, target.bounds, target.tiles),\n                    ];\n                }\n            }\n            return [layer.id, createEntryLayer(layer, generic.attributes)];\n        }),\n    );\n}\n","import { THistoryEntryLayerTile } from '../history.types';\nimport { HISTORY_TILE_SIZE } from '../kl-history';\nimport { getTileFromCanvas } from './get-tile-from-canvas';\nimport { TBounds } from '../../../bb/bb-types';\nimport { getChangedTiles } from './changed-tiles';\nimport { createImageDataTile } from '../image-data-tile';\n\nexport function canvasAndChangedTilesToLayerTiles(\n    canvas: HTMLCanvasElement,\n    changedTiles: boolean[],\n): (THistoryEntryLayerTile | undefined)[] {\n    const result: (THistoryEntryLayerTile | undefined)[] = [];\n    const tilesX = Math.ceil(canvas.width / HISTORY_TILE_SIZE);\n    const tilesY = Math.ceil(canvas.height / HISTORY_TILE_SIZE);\n\n    for (let row = 0; row < tilesY; row++) {\n        for (let col = 0; col < tilesX; col++) {\n            result.push(\n                changedTiles[row * tilesX + col]\n                    ? createImageDataTile(getTileFromCanvas(canvas, col, row, HISTORY_TILE_SIZE))\n                    : undefined,\n            );\n        }\n    }\n    return result;\n}\n\nexport function canvasToLayerTiles(canvas: HTMLCanvasElement): THistoryEntryLayerTile[];\nexport function canvasToLayerTiles(\n    canvas: HTMLCanvasElement,\n    bounds?: TBounds, // canvas area that changed. if undefined -> everything changed\n): (THistoryEntryLayerTile | undefined)[];\nexport function canvasToLayerTiles(\n    canvas: HTMLCanvasElement,\n    bounds?: TBounds, // canvas area that changed. if undefined -> everything changed\n): (THistoryEntryLayerTile | undefined)[] {\n    if (bounds) {\n        const changedTiles = getChangedTiles(bounds, canvas.width, canvas.height);\n        return canvasAndChangedTilesToLayerTiles(canvas, changedTiles);\n    } else {\n        // only do a single read back\n        const ctx = canvas.getContext('2d')!;\n        const fullImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n        const tilesX = Math.ceil(canvas.width / HISTORY_TILE_SIZE);\n        const tilesY = Math.ceil(canvas.height / HISTORY_TILE_SIZE);\n        const result: THistoryEntryLayerTile[] = [];\n\n        // manually transfer into tiles\n        for (let row = 0; row < tilesY; row++) {\n            for (let col = 0; col < tilesX; col++) {\n                const x = col * HISTORY_TILE_SIZE;\n                const y = row * HISTORY_TILE_SIZE;\n                const tileWidth = Math.min(HISTORY_TILE_SIZE, canvas.width - x);\n                const tileHeight = Math.min(HISTORY_TILE_SIZE, canvas.height - y);\n\n                const tileData = new ImageData(tileWidth, tileHeight);\n                for (let line = 0; line < tileHeight; line++) {\n                    const srcStart = ((y + line) * canvas.width + x) * 4;\n                    const destStart = line * tileWidth * 4;\n                    tileData.data.set(\n                        fullImageData.data.subarray(srcStart, srcStart + tileWidth * 4),\n                        destStart,\n                    );\n                }\n                result.push(createImageDataTile(tileData));\n            }\n        }\n        return result;\n    }\n}\n","import { BB } from '../../../bb/bb';\n\nexport function getTileFromCanvas(\n    canvas: HTMLCanvasElement,\n    col: number,\n    row: number,\n    tileSize: number,\n) {\n    const ctx = BB.ctx(canvas);\n\n    const width = Math.min(canvas.width, (col + 1) * tileSize) - col * tileSize;\n    const height = Math.min(canvas.height, (row + 1) * tileSize) - row * tileSize;\n\n    if (width <= 0 || height <= 0) {\n        throw new Error('invalid out-of-bounds tile');\n    }\n\n    return ctx.getImageData(col * tileSize, row * tileSize, width, height);\n}\n","import { TBounds } from '../../../bb/bb-types';\nimport { HISTORY_TILE_SIZE } from '../kl-history';\nimport { boundsInArea, clamp } from '../../../bb/math/math';\nimport { createArray } from '../../../bb/base/base';\n\n// returns array, each entry represents a tile, as a boolean\n// true - intersected with bounds\nexport function getChangedTiles(\n    bounds: TBounds, // canvas space\n    width: number,\n    height: number,\n    tileSize: number = HISTORY_TILE_SIZE,\n): boolean[] {\n    // ensure: 1 top left, 2 bottom right\n    bounds = {\n        x1: Math.min(bounds.x1, bounds.x2),\n        y1: Math.min(bounds.y1, bounds.y2),\n        x2: Math.max(bounds.x1, bounds.x2),\n        y2: Math.max(bounds.y1, bounds.y2),\n    };\n    const boundsInCanvas = boundsInArea(bounds, width, height);\n    const tilesX = Math.ceil(width / tileSize);\n    const tilesY = Math.ceil(height / tileSize);\n    if (!boundsInCanvas) {\n        // no change if bounds don't overlap canvas\n        return createArray(tilesX * tilesY, false);\n    }\n    const result: boolean[] = createArray(tilesX * tilesY, false);\n\n    const tileBounds = {\n        x1: clamp(Math.floor(bounds.x1 / tileSize), 0, tilesX - 1),\n        y1: clamp(Math.floor(bounds.y1 / tileSize), 0, tilesY - 1),\n        x2: clamp(Math.floor(bounds.x2 / tileSize), 0, tilesX - 1),\n        y2: clamp(Math.floor(bounds.y2 / tileSize), 0, tilesY - 1),\n    };\n    for (let i = tileBounds.x1; i <= tileBounds.x2; i++) {\n        for (let e = tileBounds.y1; e <= tileBounds.y2; e++) {\n            result[e * tilesX + i] = true;\n        }\n    }\n    return result;\n}\n\n// Combines old and new changes.\n// A tile is changed if it's changed in new or old.\nexport function updateChangedTiles(\n    oldChangedOrEmpty: boolean[], // important: can be empty array, while new has entries.\n    newChanged: boolean[],\n): boolean[] {\n    return newChanged.map((newItem, index) => {\n        return newItem || !!(oldChangedOrEmpty[index] as boolean | undefined);\n    });\n}\n","import { TImageDataTile } from './history.types';\nimport { copyImageData } from '../utils/copy-image-data';\nimport { randomUuid } from '../../bb/base/base';\n\nexport function createImageDataTile(data: ImageData): TImageDataTile {\n    return {\n        id: randomUuid(),\n        // timestamp: new Date().getTime(),\n        data: data,\n    };\n}\n\n// copy with different id\nexport function copyImageDataTile(tile: TImageDataTile): TImageDataTile {\n    return {\n        id: randomUuid(),\n        // timestamp: new Date().getTime(),\n        data: copyImageData(tile.data),\n    };\n}\n","export const copyImageData = (imageData: ImageData): ImageData => {\n    return new ImageData(new Uint8ClampedArray(imageData.data), imageData.width, imageData.height);\n};\n","import { isLayerFill, TRgb } from '../kl-types';\nimport { BB } from '../../bb/bb';\nimport { THistoryEntryDataComposed } from '../history/history.types';\nimport { HISTORY_TILE_SIZE } from '../history/kl-history';\nimport { sortLayerMap } from '../history/sort-layer-map';\n\nexport class Eyedropper {\n    // ----------------------------------- public -----------------------------------\n    constructor() {}\n\n    // Reads from history (ImageData) to avoid reading from canvas.\n    getColorAt(x: number, y: number, composed: THistoryEntryDataComposed): TRgb {\n        x = Math.floor(x);\n        y = Math.floor(y);\n        if (x < 0 || x >= composed.size.width || y < 0 || y >= composed.size.height) {\n            return new BB.RGB(0, 0, 0);\n        }\n\n        const canvas = BB.canvas(1, 1);\n        const ctx = BB.ctx(canvas);\n        ctx.imageSmoothingEnabled = false;\n\n        const tilesX = Math.ceil(composed.size.width / HISTORY_TILE_SIZE);\n        const tileCol = Math.floor(x / HISTORY_TILE_SIZE);\n        const tileRow = Math.floor(y / HISTORY_TILE_SIZE);\n        const tileIndex = tileRow * tilesX + tileCol;\n\n        Object.values(composed.layerMap)\n            .sort(sortLayerMap)\n            .forEach((layer) => {\n                if (!layer.isVisible || layer.opacity === 0) {\n                    return;\n                }\n                const tile = layer.tiles[tileIndex];\n                let fillStyle = '';\n                if (isLayerFill(tile)) {\n                    fillStyle = tile.fill;\n                } else {\n                    let tileWidth = HISTORY_TILE_SIZE;\n                    if (composed.size.width % HISTORY_TILE_SIZE !== 0 && tileCol === tilesX - 1) {\n                        tileWidth = composed.size.width % HISTORY_TILE_SIZE;\n                    }\n                    const pixelIndex =\n                        (y % HISTORY_TILE_SIZE) * tileWidth + (x % HISTORY_TILE_SIZE);\n\n                    if (tile.data.data[pixelIndex * 4 + 3] === 0) {\n                        return;\n                    }\n\n                    fillStyle = BB.ColorConverter.toRgbaStr({\n                        r: tile.data.data[pixelIndex * 4],\n                        g: tile.data.data[pixelIndex * 4 + 1],\n                        b: tile.data.data[pixelIndex * 4 + 2],\n                        a: tile.data.data[pixelIndex * 4 + 3] / 255,\n                    });\n                }\n\n                ctx.fillStyle = fillStyle;\n                ctx.globalAlpha = layer.opacity;\n                ctx.globalCompositeOperation = layer.mixModeStr;\n                ctx.fillRect(0, 0, 1, 1);\n            });\n\n        const imData = ctx.getImageData(0, 0, 1, 1);\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\n    }\n}\n","import { TRect } from '../../bb/bb-types';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\nimport { intBoundsWithinArea } from '../../bb/math/math';\nimport { canvasBounds } from '../../bb/base/canvas';\nimport { MultiPolygon } from 'polygon-clipping';\n\n// returns bounds of selection, where layer is not empty (transparent)\nexport function getSelectionBounds(\n    selection: MultiPolygon,\n    context: CanvasRenderingContext2D,\n): TRect | undefined {\n    const selectionBounds = getMultiPolyBounds(selection);\n    // integer bounds that are within the canvas\n    const canvasSelectionBounds = intBoundsWithinArea(\n        selectionBounds,\n        context.canvas.width,\n        context.canvas.height,\n        true,\n    );\n\n    // selection area outside of canvas\n    if (!canvasSelectionBounds) {\n        return undefined;\n    }\n\n    // bounds of where pixels are non-transparent\n    return canvasBounds(context, canvasSelectionBounds);\n}\n","import { MultiPolygon } from 'polygon-clipping';\n\nexport function translateMultiPolygon(poly: MultiPolygon, x: number, y: number): MultiPolygon {\n    return poly.map((poly) => {\n        return poly.map((ring) => {\n            return ring.map((p) => {\n                return [p[0] + x, p[1] + y];\n            });\n        });\n    });\n}\n","import { MultiPolygon } from 'polygon-clipping';\nimport { BB } from '../../bb/bb';\nimport { drawSelectionMask } from '../../bb/base/canvas';\n\nexport function getBinaryMask(selection: MultiPolygon, width: number, height: number): Uint8Array {\n    const result = new Uint8Array(new ArrayBuffer(width * height));\n    const canvas = BB.canvas(width, height);\n    const ctx = BB.ctx(canvas);\n    drawSelectionMask(selection, ctx);\n    const imageData = ctx.getImageData(0, 0, width, height);\n    BB.freeCanvas(canvas);\n    const len = width * height;\n    for (let i = 0, e = 0; i < len; i++, e += 4) {\n        result[i] = imageData.data[e] >>> 7;\n    }\n    return result;\n}\n","import { TMixMode } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { TTranslationCode } from '../../../languages/languages';\n\nexport function translateBlending(blendMode?: TMixMode): string {\n    if (!blendMode) {\n        return LANG('layers-blend-normal');\n    }\n\n    const codes: {\n        [key: string]: TTranslationCode;\n    } = {\n        'source-over': 'layers-blend-normal',\n        darken: 'layers-blend-darken',\n        multiply: 'layers-blend-multiply',\n        'color-burn': 'layers-blend-color-burn',\n        lighten: 'layers-blend-lighten',\n        screen: 'layers-blend-screen',\n        'color-dodge': 'layers-blend-color-dodge',\n        overlay: 'layers-blend-overlay',\n        'soft-light': 'layers-blend-soft-light',\n        'hard-light': 'layers-blend-hard-light',\n        difference: 'layers-blend-difference',\n        exclusion: 'layers-blend-exclusion',\n        hue: 'layers-blend-hue',\n        saturation: 'layers-blend-saturation',\n        color: 'layers-blend-color',\n        luminosity: 'layers-blend-luminosity',\n    };\n\n    if (!(blendMode in codes)) {\n        throw new Error('unknown blend mode');\n    }\n    return LANG(codes[blendMode]);\n}\n","import { BB } from '../../../../bb/bb';\nimport { LANG } from '../../../../language/language';\nimport { showModal } from '../../modals/base/showModal';\nimport removeLayerImg from 'url:/src/app/img/ui/remove-layer.svg';\n\nexport function renameLayerDialog(\n    parentEl: HTMLElement,\n    currentName: string,\n    callback: (newName: string | undefined) => void,\n): void {\n    const div = BB.el();\n\n    const label = BB.el({\n        content: LANG('layers-rename-name') + ':',\n        css: {\n            marginRight: '5px',\n        },\n    });\n\n    const row = BB.el({\n        css: {\n            display: 'flex',\n        },\n    });\n    const input = BB.el({ tagName: 'input' });\n    input.value = currentName;\n    input.setAttribute('data-ignore-focus', 'true');\n    input.style.flexGrow = '1';\n    const clearBtn = BB.el({\n        tagName: 'button',\n        content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\n        title: LANG('layers-rename-clear'),\n        css: {\n            marginLeft: '10px',\n        },\n        onClick: () => {\n            input.value = '';\n            input.focus();\n        },\n    });\n    const suggestions = [\n        LANG('layers-rename-sketch'),\n        LANG('layers-rename-colors'),\n        LANG('layers-rename-shading'),\n        LANG('layers-rename-lines'),\n        LANG('layers-rename-effects'),\n        LANG('background'),\n        LANG('layers-rename-foreground'),\n    ];\n    const suggestionBtns: HTMLButtonElement[] = [];\n    const row2 = BB.el({\n        css: {\n            display: 'flex',\n            flexWrap: 'wrap',\n            marginTop: '5px',\n            marginLeft: '-5px',\n        },\n    });\n    suggestions.forEach((item) => {\n        const btn = BB.el({\n            parent: row2,\n            tagName: 'button',\n            content: item,\n            onClick: () => {\n                input.value = '' + btn.textContent;\n            },\n            css: {\n                margin: '5px 0 0 5px',\n            },\n        });\n        suggestionBtns.push(btn);\n    });\n\n    div.append(label);\n    label.append(row, row2);\n    row.append(input, clearBtn);\n\n    setTimeout(() => {\n        input.focus();\n        input.select();\n    }, 10);\n\n    showModal({\n        target: parentEl,\n        message: `<b>${LANG('layers-rename-title')}</b>`,\n        div: div,\n        buttons: [LANG('layers-rename'), 'Cancel'],\n        primaries: [LANG('layers-rename')],\n        callback: (val) => {\n            BB.destroyEl(clearBtn);\n            suggestionBtns.forEach((item) => {\n                BB.destroyEl(item);\n            });\n            suggestionBtns.splice(0, suggestionBtns.length);\n            if (val === LANG('layers-rename')) {\n                callback(input.value);\n            } else {\n                callback(undefined);\n            }\n        },\n        clickOnEnter: LANG('layers-rename'),\n    });\n}\n","import { BB } from '../../../../bb/bb';\nimport { LANG } from '../../../../language/language';\nimport { Options } from '../../components/options';\nimport { translateBlending } from '../../../canvas/translate-blending';\nimport { showModal } from '../../modals/base/showModal';\nimport { TMixMode } from '../../../kl-types';\n\nexport function mergeLayerDialog(\n    parentEl: HTMLElement,\n    p: {\n        topCanvas: HTMLCanvasElement;\n        bottomCanvas: HTMLCanvasElement;\n        topOpacity: number;\n        mixModeStr: TMixMode;\n        callback: (mode: string) => void;\n    },\n): void {\n    const div = BB.el();\n    div.innerHTML = LANG('layers-merge-description');\n\n    const options = new Options({\n        optionArr: [\n            { id: p.mixModeStr, label: translateBlending(p.mixModeStr) },\n            { id: 'source-in', label: 'source-in' },\n            { id: 'source-out', label: 'source-out' },\n            { id: 'source-atop', label: 'source-atop' },\n            { id: 'destination-in', label: 'destination-in' },\n            { id: 'destination-out', label: 'destination-out' },\n            { id: 'destination-atop', label: 'destination-atop' },\n            { id: 'xor', label: 'xor' },\n        ],\n        initId: p.mixModeStr,\n        onChange: () => {\n            update();\n        },\n        isSmall: true,\n        css: {\n            marginTop: '5px',\n        },\n    });\n    div.append(options.getElement());\n\n    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\n    const preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\n    preview.title = LANG('preview');\n    preview.className = 'kl-merge-preview';\n    const spacer = BB.el({\n        content: '<br/>',\n        css: {\n            clear: 'both',\n        },\n    });\n    div.append(spacer, preview);\n\n    const alphaCanvas = BB.copyCanvas(preview);\n    BB.ctx(alphaCanvas).drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\n    BB.convertToAlphaChannelCanvas(alphaCanvas);\n\n    const update = () => {\n        const ctx = BB.ctx(preview);\n        ctx.save();\n        ctx.clearRect(0, 0, preview.width, preview.height);\n        if (preview.width > p.topCanvas.width) {\n            ctx.imageSmoothingEnabled = false;\n        }\n        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\n\n        if (options.getValue() === 'as-alpha') {\n            ctx.globalCompositeOperation = 'destination-in';\n            ctx.globalAlpha = p.topOpacity;\n            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\n        } else {\n            ctx.globalCompositeOperation = options.getValue() as GlobalCompositeOperation;\n            ctx.globalAlpha = p.topOpacity;\n            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\n        }\n        ctx.restore();\n    };\n\n    update();\n\n    const keyListener = new BB.KeyListener({\n        onDown: (keyStr: string) => {\n            if (keyStr === 'right') {\n                options.next();\n            }\n            if (keyStr === 'left') {\n                options.previous();\n            }\n        },\n    });\n\n    showModal({\n        target: parentEl,\n        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\n        div: div,\n        buttons: ['Ok', 'Cancel'],\n        clickOnEnter: 'Ok',\n        callback: (val) => {\n            keyListener.destroy();\n            options.destroy();\n            if (val === 'Ok') {\n                p.callback(options.getValue());\n            }\n        },\n    });\n}\n","import { c } from '../../../bb/base/c';\nimport { makeUnfocusable } from '../../../bb/base/ui';\n\nexport type TDropdownMenuParams<IdType extends string> = {\n    button: string | HTMLElement;\n    buttonTitle?: string;\n    items: [IdType, string][]; // id, label\n    onItemClick: (id: IdType) => void;\n};\n\nexport class DropdownMenu<IdType extends string> {\n    private readonly rootElement: HTMLElement;\n    private isExpanded: boolean = false;\n    private readonly onSetEnabled: (id: IdType, enabled: boolean) => void = () => 0;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TDropdownMenuParams<IdType>) {\n        const button = c('button,w-full,h-full', [p.button]) as HTMLButtonElement;\n        button.onclick = () => {\n            toggle(!this.isExpanded);\n        };\n        if (p.buttonTitle) {\n            button.title = p.buttonTitle;\n        }\n        makeUnfocusable(button);\n\n        const items: HTMLButtonElement[] = [];\n        const itemMap: Record<IdType, HTMLButtonElement> = {} as Record<IdType, HTMLButtonElement>;\n        p.items.forEach((item) => {\n            const itemButton = c('button', item[1]) as HTMLButtonElement;\n            makeUnfocusable(itemButton);\n            itemButton.onclick = () => {\n                toggle(false);\n                p.onItemClick(item[0]);\n            };\n            items.push(itemButton);\n            itemMap[item[0]] = itemButton;\n        });\n\n        this.onSetEnabled = (id, enabled) => {\n            itemMap[id].disabled = !enabled;\n        };\n\n        const menu = c('.kl-dropdown-menu,right-0,top-full,nowrap,hidden', items);\n\n        this.rootElement = c(',pos-relative', [button, menu]);\n\n        const toggle = (force: boolean) => {\n            this.isExpanded = force;\n            menu.style.display = this.isExpanded ? '' : 'none';\n            if (this.isExpanded) {\n                document.addEventListener('pointerdown', onPointerDown, { passive: false });\n                window.addEventListener('blur', onBlur);\n            } else {\n                document.removeEventListener('pointerdown', onPointerDown);\n                window.removeEventListener('blur', onBlur);\n            }\n        };\n\n        const onPointerDown = (e: PointerEvent) => {\n            const target = e.target as HTMLElement | null;\n            if (button.contains(target) || menu.contains(target)) {\n                return;\n            }\n            toggle(false);\n        };\n        const onBlur = () => toggle(false);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootElement;\n    }\n\n    setEnabled(id: IdType, enabled: boolean): void {\n        this.onSetEnabled(id, enabled);\n    }\n}\n","module.exports = parcelRequire.resolve(\"add-layer.37588650.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"duplicate-layer.2d570064.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"merge-layers.7ab3b9d8.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"rename-layer.5136b61a.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"caret-down.438553b3.svg\") + \"?\" + Date.now();","import { BB } from '../../../bb/bb';\nimport { TKlBasicLayer } from '../../kl-types';\nimport { css } from '../../../bb/base/base';\n\n/**\n * preview of image with layers. can do mix modes and opacity.\n * creates a canvas.\n */\nexport class KlCanvasPreview {\n    private readonly canvas: HTMLCanvasElement;\n    private readonly ctx: CanvasRenderingContext2D | null;\n    private readonly layers: TKlBasicLayer[];\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        width: number;\n        height: number;\n        layers: TKlBasicLayer[]; // items can be changed after the fact - but not the object\n    }) {\n        this.layers = p.layers;\n\n        const scale = p.width / p.layers[0].image.width;\n        const width = scale > 1 ? p.layers[0].image.width : p.width;\n        const height = scale > 1 ? p.layers[0].image.height : p.height;\n\n        this.canvas = BB.canvas(width, height);\n        this.ctx = BB.ctx(this.canvas);\n\n        css(this.canvas, {\n            width: '100%',\n            height: '100%',\n            imageRendering: scale > 1 ? 'pixelated' : undefined,\n            background: 'var(--kl-checkerboard-background)',\n            backgroundSize: '16px',\n        });\n\n        setTimeout(() => this.render(), 0);\n    }\n\n    getElement(): HTMLCanvasElement {\n        return this.canvas;\n    }\n\n    render(): void {\n        if (!this.ctx) {\n            return;\n        }\n\n        this.ctx.save();\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        for (let i = 0; i < this.layers.length; i++) {\n            const layer = this.layers[i];\n            if (!layer.isVisible || layer.opacity === 0) {\n                continue;\n            }\n            this.ctx.globalAlpha = this.layers[i].opacity;\n            this.ctx.globalCompositeOperation = this.layers[i]\n                .mixModeStr as GlobalCompositeOperation;\n            if (this.canvas.width > this.layers[i].image.width) {\n                this.ctx.imageSmoothingEnabled = false;\n            }\n            this.ctx.drawImage(this.layers[i].image, 0, 0, this.canvas.width, this.canvas.height);\n        }\n        this.ctx.restore();\n    }\n\n    destroy(): void {}\n}\n","import { BB } from '../../../bb/bb';\nimport rotateImg from 'url:/src/app/img/ui/cursor-rotate.png';\nimport { KeyListener } from '../../../bb/input/key-listener';\nimport { TVector2D } from '../../../bb/bb-types';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport {\n    copyTransform,\n    snapToPixel,\n    TFreeTransform,\n    TFreeTransformCorner,\n    TFreeTransformEdge,\n    toImageSpace,\n    toTransformSpace,\n} from './free-transform-utils';\nimport { css } from '../../../bb/base/base';\n\n/**\n * Free Transform UI\n * rotate, scale, translate\n *\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\n *      - this is what complicates things\n * - if transform region small, corner grips move out of the way\n *\n * iX iY, iP.x, iP.y - i indicates image space\n * tX tY, tP.x, tP.y - t indicates transform space\n *\n * Not sure if it can be used for navigable canvas. (especially if canvas rotates view)\n * Probably can't be extended for distort. Needs a different approach.\n *\n * --- DOM structure ---\n * rootEl {\n * \ttransEl [\n * \t\tboundsEl\n * \t\tedges[]\n * \t\tcorners[] - round grips in the corner of transform region\n * \t\tangleGrip\n * \t]\n * }\n *\n */\nexport class FreeTransform {\n    // --- private ---\n    private readonly value: TFreeTransform; // coordinates and dimensions of transformation\n    private isConstrained: boolean;\n    private ratio: number; // aspect ratio of transform\n    private viewportTransform: { scale: number; x: number; y: number };\n    private readonly scaled = {\n        // scaled coordinates and dimensions for screen space\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        corners: [{ x: 0, y: 0 }], // in transform space\n    };\n    private readonly minSnapDist = 7; // minimal snapping distance in px screen space\n    private snappingEnabled: boolean;\n    private readonly snapX: number[];\n    private readonly snapY: number[];\n    private readonly callback: (transform: TFreeTransform) => void;\n\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n    private readonly gripSize = 16;\n    private readonly edgeSize = 10;\n\n    private readonly rootEl: HTMLElement; // sits at origin of image\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\n    private readonly corners: TFreeTransformCorner[] = [];\n    private keyListener: KeyListener;\n    private boundsPointerListener: PointerListener; // BB.PointerListener\n    private anglePointerListener: PointerListener; // BB.PointerListener\n    private readonly edges: TFreeTransformEdge[] = [];\n    private readonly angleGrip: {\n        el: HTMLElement;\n        x: number; // transform space\n        y: number;\n        snap: boolean;\n        updateDOM: () => void;\n    };\n\n    private updateScaled(): void {\n        this.scaled.x = this.value.x * this.viewportTransform.scale;\n        this.scaled.y = this.value.y * this.viewportTransform.scale;\n        this.scaled.width = this.value.width * this.viewportTransform.scale;\n        this.scaled.height = this.value.height * this.viewportTransform.scale;\n        this.scaled.corners = this.corners.map((item) => {\n            return {\n                x: item.x * this.viewportTransform.scale,\n                y: item.y * this.viewportTransform.scale,\n            };\n        });\n    }\n\n    /**\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\n     * both in image space\n     *\n     * @param iX - image space\n     * @param iY - image space\n     * @private\n     */\n    private snapCorner(iX: number, iY: number): TVector2D {\n        if (!this.snappingEnabled) {\n            return { x: iX, y: iY };\n        }\n        let dist: number;\n        const snap: {\n            x?: number;\n            y?: number;\n            dist: {\n                x?: number;\n                y?: number;\n            };\n        } = {\n            x: undefined,\n            y: undefined,\n            dist: {\n                x: undefined,\n                y: undefined,\n            },\n        };\n        for (let e = 0; e < this.snapX.length; e++) {\n            dist = Math.abs(iX - this.snapX[e]);\n            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                if (snap.x === undefined || dist < snap.dist.x!) {\n                    snap.x = this.snapX[e];\n                    snap.dist.x = dist;\n                }\n            }\n        }\n        for (let e = 0; e < this.snapY.length; e++) {\n            dist = Math.abs(iY - this.snapY[e]);\n            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                if (snap.y === undefined || dist < snap.dist.y!) {\n                    snap.y = this.snapY[e];\n                    snap.dist.y = dist;\n                }\n            }\n        }\n\n        if (snap.x === undefined && snap.y === undefined) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        return {\n            x: snap.x ?? iX,\n            y: snap.y ?? iY,\n        };\n    }\n\n    /**\n     * If constrained return nearest corner pos that fits aspect ratio\n     *\n     * @param cornerIndex\n     * @param iX\n     * @param iY\n     * @private\n     */\n    private constrainCorner(cornerIndex: number, iX: number, iY: number): TVector2D {\n        if (!this.isConstrained) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        const flip = this.value.width * this.value.height < 0 ? -1 : 1;\n        return BB.projectPointOnLine(\n            { x: this.value.x, y: this.value.y },\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.value),\n            { x: iX, y: iY },\n        );\n    }\n\n    /**\n     * Update corners according to width height.\n     * Not their DOM.\n     */\n    private updateCornerPositions(): void {\n        this.corners[0].x = -this.value.width / 2; // top left\n        this.corners[0].y = -this.value.height / 2;\n\n        this.corners[1].x = this.value.width / 2; // top right\n        this.corners[1].y = -this.value.height / 2;\n\n        this.corners[2].x = this.value.width / 2; // bottom right\n        this.corners[2].y = this.value.height / 2;\n\n        this.corners[3].x = -this.value.width / 2; // bottom left\n        this.corners[3].y = this.value.height / 2;\n    }\n\n    /**\n     * If constrained and dragging an edge, restore aspect ratio\n     * Updates corner positions.\n     *\n     * @param widthChanged\n     * @param heightChanged\n     * @private\n     */\n    private restoreRatio(widthChanged: boolean, heightChanged: boolean): void {\n        if (!this.isConstrained) {\n            return;\n        }\n        const angle90 = Math.abs(this.value.angleDeg) % 90 === 0;\n        const whSwapped = Math.abs(this.value.angleDeg - 90) % 180 === 0;\n        if (heightChanged && !widthChanged) {\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\n            let newWidth = this.ratio * newHeight;\n            if (angle90) {\n                newWidth =\n                    (whSwapped ? this.value.y % 1 : this.value.x % 1) === 0\n                        ? BB.roundEven(newWidth)\n                        : BB.roundUneven(newWidth);\n            }\n            if (this.corners[1].x - this.corners[0].x < 0) {\n                newWidth *= -1;\n            }\n            this.corners[0].x = -newWidth / 2;\n            this.corners[3].x = -newWidth / 2;\n            this.corners[1].x = newWidth / 2;\n            this.corners[2].x = newWidth / 2;\n        }\n        if (!heightChanged && widthChanged) {\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\n            let newHeight = newWidth / this.ratio;\n            if (angle90) {\n                newHeight =\n                    (whSwapped ? this.value.x % 1 : this.value.y % 1) === 0\n                        ? BB.roundEven(newHeight)\n                        : BB.roundUneven(newHeight);\n            }\n            if (this.corners[3].y - this.corners[0].y < 0) {\n                newHeight *= -1;\n            }\n            this.corners[0].y = -newHeight / 2;\n            this.corners[1].y = -newHeight / 2;\n            this.corners[2].y = newHeight / 2;\n            this.corners[3].y = newHeight / 2;\n        }\n    }\n\n    /**\n     * update transform based on corners\n     * @private\n     */\n    private updateTransformViaCorners(): void {\n        // calc transform center in image space\n        const rot = BB.rotateAround(\n            { x: 0, y: 0 },\n            {\n                x: (this.corners[0].x + this.corners[1].x) / 2,\n                y: (this.corners[0].y + this.corners[3].y) / 2,\n            },\n            this.value.angleDeg,\n        );\n        this.value.x = rot.x + this.value.x;\n        this.value.y = rot.y + this.value.y;\n\n        // update size\n        this.value.width = this.corners[1].x - this.corners[0].x;\n        this.value.height = this.corners[3].y - this.corners[0].y;\n\n        // new center means corners changed their position\n        this.updateCornerPositions();\n\n        this.updateDOM();\n    }\n\n    /**\n     * updates DOM according to transform\n     * @param skipCallback\n     */\n    private updateDOM(skipCallback?: boolean): void {\n        this.updateScaled();\n\n        css(this.transEl, {\n            left: this.viewportTransform.x + this.scaled.x + 'px',\n            top: this.viewportTransform.y + this.scaled.y + 'px',\n            transformOrigin: '0 0',\n            transform: 'rotate(' + this.value.angleDeg + 'deg)',\n        });\n\n        css(this.boundsEl, {\n            width: Math.abs(this.scaled.width) + 'px',\n            height: Math.abs(this.scaled.height) + 'px',\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\n        });\n\n        this.corners[0].updateDOM();\n        this.corners[1].updateDOM();\n        this.corners[2].updateDOM();\n        this.corners[3].updateDOM();\n\n        this.edges[0].updateDOM();\n        this.edges[1].updateDOM();\n        this.edges[2].updateDOM();\n        this.edges[3].updateDOM();\n\n        this.angleGrip.x = 0;\n        this.angleGrip.y = -Math.abs(this.value.height * this.viewportTransform.scale) / 2 - 20;\n        this.angleGrip.updateDOM();\n        if (!skipCallback) {\n            if (this.callback) {\n                // why should updateDOM trigger the callback?\n                this.callback(copyTransform(this.value));\n            }\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        x: number; // center of transform region. image space\n        y: number;\n        width: number; // size of transform region. image space\n        height: number;\n        angleDeg: number; // angle of transform region. degrees\n\n        isConstrained: boolean; // proportions constrained\n        snapX: number[]; // where snapping along X axis. image space\n        snapY: number[]; // where snapping along X axis. image space\n        viewportTransform: { scale: number; x: number; y: number };\n        callback: (transform: TFreeTransform) => void;\n    }) {\n        this.viewportTransform = { ...p.viewportTransform };\n        this.value = {\n            // coordinates and dimensions of transformation\n            x: p.x,\n            y: p.y,\n            width: p.width,\n            height: p.height,\n            angleDeg: p.angleDeg,\n        };\n\n        this.isConstrained = p.isConstrained;\n\n        this.snapX = p.snapX;\n        this.snapY = p.snapY;\n        this.callback = p.callback;\n        this.snappingEnabled = true;\n        this.ratio = this.value.width / this.value.height;\n\n        this.rootEl = BB.el({\n            className: 'kl-free-transform',\n            css: {\n                userSelect: 'none',\n            },\n        });\n        this.transEl = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'absolute',\n            },\n        });\n\n        this.boundsEl = BB.el({\n            css: {\n                position: 'absolute',\n                cursor: 'move',\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\n            },\n        });\n\n        const pointerRemainder = {\n            x: 0,\n            y: 0,\n        };\n        function resetRemainder(): void {\n            pointerRemainder.x = 0;\n            pointerRemainder.y = 0;\n        }\n        this.keyListener = new BB.KeyListener({});\n\n        let boundsStartP = {\n            x: 0,\n            y: 0,\n        };\n        this.boundsPointerListener = new BB.PointerListener({\n            target: this.boundsEl,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointerdown') {\n                    boundsStartP = { x: this.value.x, y: this.value.y };\n                }\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    this.value.x =\n                        boundsStartP.x +\n                        (event.pageX - event.downPageX!) / this.viewportTransform.scale;\n                    this.value.y =\n                        boundsStartP.y +\n                        (event.pageY - event.downPageY!) / this.viewportTransform.scale;\n\n                    let dist: number;\n                    let snap: {\n                        x?: number;\n                        y?: number;\n                        distX: number;\n                        distY: number;\n                    } = {\n                        distX: -1,\n                        distY: -1,\n                    };\n                    if (this.snappingEnabled) {\n                        let i;\n                        for (i = 0; i < this.snapX.length; i++) {\n                            dist = Math.abs(this.value.x - this.snapX[i]);\n                            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                if (snap.x === undefined || dist < snap.distX) {\n                                    snap.x = this.snapX[i];\n                                    snap.distX = dist;\n                                }\n                            }\n                        }\n                        for (i = 0; i < this.snapY.length; i++) {\n                            dist = Math.abs(this.value.y - this.snapY[i]);\n                            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                if (snap.y === undefined || dist < snap.distY) {\n                                    snap.y = this.snapY[i];\n                                    snap.distY = dist;\n                                }\n                            }\n                        }\n\n                        let iP;\n                        for (i = 0; i < 4; i++) {\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.value);\n                            let j;\n                            for (j = 0; j < this.snapX.length; j++) {\n                                dist = Math.abs(iP.x - this.snapX[j]);\n                                if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                    if (snap.x === undefined || dist < snap.distX) {\n                                        snap.x = this.snapX[j] - (iP.x - this.value.x);\n                                        snap.distX = dist;\n                                    }\n                                }\n                            }\n                            for (j = 0; j < this.snapY.length; j++) {\n                                dist = Math.abs(iP.y - this.snapY[j]);\n                                if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                    if (snap.y === undefined || dist < snap.distY) {\n                                        snap.y = this.snapY[j] - (iP.y - this.value.y);\n                                        snap.distY = dist;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        let projected = BB.projectPointOnLine(\n                            { x: 0, y: boundsStartP.y },\n                            { x: 10, y: boundsStartP.y },\n                            { x: this.value.x, y: this.value.y },\n                        );\n                        let dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        snap = {\n                            x: projected.x,\n                            y: projected.y,\n                            distX: dist,\n                            distY: dist,\n                        };\n\n                        projected = BB.projectPointOnLine(\n                            { x: boundsStartP.x, y: 0 },\n                            { x: boundsStartP.x, y: 10 },\n                            { x: this.value.x, y: this.value.y },\n                        );\n                        dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) {\n                            snap = {\n                                x: projected.x,\n                                y: projected.y,\n                                distX: dist,\n                                distY: dist,\n                            };\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            { x: boundsStartP.x, y: boundsStartP.y },\n                            { x: boundsStartP.x + 1, y: boundsStartP.y + 1 },\n                            { x: this.value.x, y: this.value.y },\n                        );\n                        dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) {\n                            snap = {\n                                x: projected.x,\n                                y: projected.y,\n                                distX: dist,\n                                distY: dist,\n                            };\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            { x: boundsStartP.x, y: boundsStartP.y },\n                            { x: boundsStartP.x + 1, y: boundsStartP.y - 1 },\n                            { x: this.value.x, y: this.value.y },\n                        );\n                        dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) {\n                            snap = {\n                                x: projected.x,\n                                y: projected.y,\n                                distX: dist,\n                                distY: dist,\n                            };\n                        }\n                    }\n                    if (snap.x != undefined) {\n                        this.value.x = snap.x;\n                    }\n                    if (snap.y != undefined) {\n                        this.value.y = snap.y;\n                    }\n\n                    // snap to pixels\n                    if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                        snapToPixel(this.value);\n                        this.updateCornerPositions();\n                    }\n\n                    this.updateDOM();\n                }\n            },\n        });\n\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                const g = (this.corners[i] = {\n                    i: i,\n                    el: BB.el({\n                        css: {\n                            width: this.gripSize + 'px',\n                            height: this.gripSize + 'px',\n                            background: '#fff',\n                            /*background: [\n                                '#ff0000',\n                                '#00ff00',\n                                '#0000ff',\n                                '#ff00ff',\n                            ][i],*/\n                            borderRadius: this.gripSize + 'px',\n                            position: 'absolute',\n                            border: '2px solid #000',\n                        },\n                    }) as HTMLElement,\n                    x: 0,\n                    y: 0,\n                    virtualPos: {\n                        x: 0,\n                        y: 0,\n                    },\n                } as TFreeTransformCorner);\n                g.updateDOM = (): void => {\n                    // grip position\n                    // if it gets small: slightly offset grips, so easier to handle\n                    const offsetArr = [\n                        [-1, -1],\n                        [1, -1],\n                        [1, 1],\n                        [-1, 1],\n                    ].map((item) => {\n                        item[0] *= this.value.width > 0 ? 1 : -1;\n                        item[1] *= this.value.height > 0 ? 1 : -1;\n                        return item;\n                    });\n                    const tinyOffset =\n                        Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20\n                            ? 10\n                            : 0;\n\n                    css(g.el, {\n                        left:\n                            this.scaled.corners[g.i].x -\n                            this.gripSize / 2 +\n                            offsetArr[i][0] * tinyOffset +\n                            'px',\n                        top:\n                            this.scaled.corners[g.i].y -\n                            this.gripSize / 2 +\n                            offsetArr[i][1] * tinyOffset +\n                            'px',\n                    });\n\n                    // cursor\n                    let angle =\n                        BB.pointsToAngleDeg(\n                            {\n                                x: this.value.x,\n                                y: this.value.y,\n                            },\n                            toImageSpace(g.x, g.y, this.value),\n                        ) + 135; // offset so nw is 0\n                    while (angle < 0) {\n                        angle += 360;\n                    }\n                    const index = Math.round(angle / 45) % this.cornerCursors.length;\n                    css(g.el, {\n                        cursor: this.cornerCursors[index] + '-resize',\n                    });\n                };\n\n                g.pointerListener = new BB.PointerListener({\n                    target: this.corners[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            this.corners[i].virtualPos = toImageSpace(\n                                this.corners[i].x,\n                                this.corners[i].y,\n                                this.value,\n                            );\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\n                            this.corners[i].virtualPos.x += event.dX / this.viewportTransform.scale;\n                            this.corners[i].virtualPos.y += event.dY / this.viewportTransform.scale;\n\n                            let iP = {\n                                x: this.corners[i].virtualPos.x,\n                                y: this.corners[i].virtualPos.y,\n                            };\n                            iP = this.constrainCorner(i, iP.x, iP.y);\n                            if (!this.isConstrained) {\n                                iP = this.snapCorner(iP.x, iP.y);\n                            }\n\n                            if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                                iP.x = Math.round(iP.x);\n                                iP.y = Math.round(iP.y);\n                            }\n\n                            const tP = toTransformSpace(iP.x, iP.y, this.value);\n\n                            const dX = tP.x - this.corners[i].x;\n                            const dY = tP.y - this.corners[i].y;\n                            this.corners[i].x = tP.x;\n                            this.corners[i].y = tP.y;\n\n                            let indexes: number[] = [];\n                            if (i === 0) {\n                                // top left\n                                indexes = [3, 1, 2];\n                            } else if (i === 1) {\n                                // top right\n                                indexes = [2, 0, 3];\n                            } else if (i === 2) {\n                                // bottom right\n                                indexes = [1, 3, 0];\n                            } else if (i === 3) {\n                                // bottom left\n                                indexes = [0, 2, 1];\n                            }\n\n                            this.corners[indexes[0]].x = this.corners[i].x;\n                            this.corners[indexes[1]].y = this.corners[i].y;\n                            if (this.keyListener.isPressed('shift')) {\n                                this.corners[indexes[2]].x -= dX;\n                                this.corners[indexes[2]].y -= dY;\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\n                            }\n\n                            this.updateTransformViaCorners();\n                        }\n                    },\n                });\n            })(i);\n        }\n\n        this.updateCornerPositions();\n        this.updateScaled();\n\n        let isInverted: boolean;\n        for (let i = 0; i < 4; i++) {\n            ((i): void => {\n                this.edges[i] = {\n                    el: BB.el({\n                        css: {\n                            width: this.edgeSize + 'px',\n                            height: this.edgeSize + 'px',\n                            /*background: [\n                                '#ff000044',\n                                '#00ff0044',\n                                '#0000ff44',\n                                '#ff00ff44',\n                            ][i],*/\n                            position: 'absolute',\n                        },\n                    }) as HTMLElement,\n                } as TFreeTransformEdge;\n                const g = this.edges[i];\n                g.updateDOM = () => {\n                    if (i === 0) {\n                        css(g.el, {\n                            left:\n                                Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top:\n                                Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) -\n                                this.edgeSize +\n                                'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 1) {\n                        css(g.el, {\n                            left:\n                                Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top:\n                                Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    } else if (i === 2) {\n                        css(g.el, {\n                            left:\n                                Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\n                            top:\n                                Math.max(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 3) {\n                        css(g.el, {\n                            left:\n                                Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) -\n                                this.edgeSize +\n                                'px',\n                            top:\n                                Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    }\n                    let angleOffset = Math.round(this.value.angleDeg / 45);\n                    while (angleOffset < 0) {\n                        angleOffset += 8;\n                    }\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\n                };\n\n                const isVertical = [0, 2].includes(i);\n                g.pointerListener = new BB.PointerListener({\n                    target: this.edges[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            if (isVertical) {\n                                // top bottom\n                                isInverted = this.corners[0].y >= this.corners[3].y;\n                            } else {\n                                // left right\n                                isInverted = this.corners[0].x >= this.corners[1].x;\n                            }\n                            resetRemainder();\n                        }\n                        if (event.type === 'pointermove' && event.button === 'left') {\n                            const tfD = BB.rotateAround(\n                                { x: 0, y: 0 },\n                                {\n                                    x: event.dX / this.viewportTransform.scale,\n                                    y: event.dY / this.viewportTransform.scale,\n                                },\n                                -this.value.angleDeg,\n                            );\n                            let ti = {\n                                dX: tfD.x,\n                                dY: tfD.y,\n                            };\n                            if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\n                            }\n\n                            let indexes: number[] = [];\n                            if (i === 0) {\n                                // top\n                                indexes = [2, 3, 0, 1];\n                            } else if (i === 1) {\n                                // right\n                                indexes = [0, 3, 1, 2];\n                            } else if (i === 2) {\n                                // bottom\n                                indexes = [0, 1, 2, 3];\n                            } else if (i === 3) {\n                                // left\n                                indexes = [1, 2, 0, 3];\n                            }\n\n                            const dimension = isVertical ? 'y' : 'x';\n                            const d = isVertical ? ti.dY : ti.dX;\n\n                            if (isInverted) {\n                                this.corners[indexes[0]][dimension] += d;\n                                this.corners[indexes[1]][dimension] += d;\n                            } else {\n                                this.corners[indexes[2]][dimension] += d;\n                                this.corners[indexes[3]][dimension] += d;\n                            }\n                            if (this.keyListener.isPressed('shift')) {\n                                if (isInverted) {\n                                    this.corners[indexes[2]][dimension] -= d;\n                                    this.corners[indexes[3]][dimension] -= d;\n                                } else {\n                                    this.corners[indexes[0]][dimension] -= d;\n                                    this.corners[indexes[1]][dimension] -= d;\n                                }\n                            }\n\n                            if (isVertical) {\n                                // top bottom\n                                this.restoreRatio(false, true);\n                            } else {\n                                // left right\n                                this.restoreRatio(true, false);\n                            }\n\n                            this.updateTransformViaCorners();\n                        }\n                    },\n                });\n            })(i);\n        }\n\n        this.angleGrip = {\n            el: BB.el({\n                css: {\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\n                    width: this.gripSize + 'px',\n                    height: this.gripSize + 'px',\n                    background: '#0ff',\n                    borderRadius: this.gripSize + 'px',\n                    position: 'absolute',\n                    boxShadow: 'inset 0 0 0 2px #000',\n                },\n            }),\n            x: 0,\n            y: 0,\n            snap: false,\n            updateDOM: () => {\n                css(this.angleGrip.el, {\n                    left: this.angleGrip.x - this.gripSize / 2 + 'px',\n                    top: this.angleGrip.y - this.gripSize / 2 + 'px',\n                });\n            },\n        };\n        BB.el({\n            parent: this.angleGrip.el,\n            css: {\n                width: '2px',\n                height: '13px',\n                left: this.gripSize / 2 - 1 + 'px',\n                top: this.gripSize + 'px',\n                background: '#0ff',\n                position: 'absolute',\n            },\n        });\n\n        this.anglePointerListener = new BB.PointerListener({\n            target: this.angleGrip.el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const bounds = this.rootEl.getBoundingClientRect();\n                    const offset = {\n                        x: bounds.left - this.rootEl.scrollLeft + this.viewportTransform.x,\n                        y: bounds.top - this.rootEl.scrollTop + this.viewportTransform.y,\n                    };\n                    const iP = {\n                        x: (event.clientX - offset.x) / this.viewportTransform.scale,\n                        y: (event.clientY - offset.y) / this.viewportTransform.scale,\n                    };\n\n                    const a = BB.pointsToAngleDeg({ x: this.value.x, y: this.value.y }, iP) + 90;\n                    this.value.angleDeg = a;\n                    const snapDeg = Math.round((a / 360) * 8) * 45;\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        this.value.angleDeg = snapDeg;\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\n                        this.value.angleDeg = snapDeg;\n                    }\n                    this.updateDOM();\n                }\n                if (event.type === 'pointerup') {\n                    if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                        snapToPixel(this.value);\n                        this.updateCornerPositions();\n                        this.updateDOM();\n                    }\n                }\n            },\n        });\n\n        snapToPixel(this.value);\n        this.updateDOM(true);\n        BB.append(this.transEl, [\n            this.boundsEl,\n            this.edges[0].el,\n            this.edges[1].el,\n            this.edges[2].el,\n            this.edges[3].el,\n            this.corners[0].el,\n            this.corners[1].el,\n            this.corners[2].el,\n            this.corners[3].el,\n            this.angleGrip.el,\n        ]);\n    }\n\n    getValue(): TFreeTransform {\n        return copyTransform(this.value);\n    }\n\n    setIsConstrained(b: boolean): void {\n        this.isConstrained = b;\n        if (b && this.value.width !== 0 && this.value.height !== 0) {\n            this.ratio = Math.abs(this.value.width / this.value.height);\n        }\n    }\n\n    setSnapping(b: boolean): void {\n        this.snappingEnabled = b;\n    }\n\n    setPos(p: TVector2D): void {\n        this.value.x = p.x;\n        this.value.y = p.y;\n        this.updateDOM(true);\n    }\n\n    move(dX: number, dY: number): void {\n        this.value.x += dX;\n        this.value.y += dY;\n        this.updateDOM(false);\n    }\n\n    setSize(w: number, h: number): void {\n        this.value.width = w;\n        this.value.height = h;\n        if (Math.abs(this.value.angleDeg) % 90 === 0) {\n            snapToPixel(this.value);\n        }\n        this.updateCornerPositions();\n        this.updateDOM(false);\n    }\n\n    setAngleDeg(a: number): void {\n        this.value.angleDeg = a;\n        if (Math.abs(this.value.angleDeg) % 90 === 0) {\n            snapToPixel(this.value);\n            this.updateCornerPositions();\n        }\n        this.updateDOM(true);\n    }\n\n    setViewportTransform(transform: { scale: number; x: number; y: number }): void {\n        this.viewportTransform = transform;\n        this.updateScaled();\n        this.updateDOM();\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getRatio(): number {\n        return this.ratio;\n    }\n\n    destroy(): void {\n        this.keyListener.destroy();\n        this.boundsPointerListener.destroy();\n        this.corners.forEach((item) => item.pointerListener.destroy());\n        this.edges.forEach((item) => item.pointerListener.destroy());\n        this.anglePointerListener.destroy();\n    }\n}\n","module.exports = parcelRequire.resolve(\"cursor-rotate.f5078486.png\") + \"?\" + Date.now();","import { TVector2D } from '../../../bb/bb-types';\nimport { BB } from '../../../bb/bb';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\n\nexport type TFreeTransform = {\n    x: number; // center of transform region. image space\n    y: number;\n    width: number; // size of transform region. image space\n    height: number;\n    angleDeg: number; // angle of transform region. degrees\n};\n\nexport type TFreeTransformCorner = {\n    i: number; // index in corners array\n    el: HTMLElement; // draggable corner circle in DOM\n    x: number; // unscaled position (transform space)\n    y: number;\n    virtualPos: TVector2D; // unscaled temporary position (image space)\n    updateDOM: () => void; // update styling in DOM\n    pointerListener: PointerListener;\n};\n\nexport type TFreeTransformEdge = {\n    // derive position from corners\n    el: HTMLElement;\n    updateDOM: () => void;\n    pointerListener: PointerListener;\n};\n\n/**\n * snap entire transform to pixel grid. changes transform\n *\n * for x y:\n * If a dimension has an even size, it will be an integer.\n * If it's uneven, it sits exactly half-way between two pixels.\n *\n * @param transform\n */\nexport function snapToPixel(transform: TFreeTransform): void {\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\n        return;\n    }\n\n    transform.width = Math.round(transform.width);\n    transform.height = Math.round(transform.height);\n    // 0 is original orientation.\n    // At 90 and 270 width and height become swapped due to different orientation.\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    transform.x =\n        (whSwapped ? transform.height : transform.width) % 2 === 0\n            ? Math.round(transform.x)\n            : Math.round(transform.x - 0.5) + 0.5;\n    transform.y =\n        (whSwapped ? transform.width : transform.height) % 2 === 0\n            ? Math.round(transform.y)\n            : Math.round(transform.y - 0.5) + 0.5;\n}\n\nexport function copyTransform(transform: TFreeTransform): TFreeTransform {\n    return {\n        x: transform.x,\n        y: transform.y,\n        width: transform.width,\n        height: transform.height,\n        angleDeg: transform.angleDeg,\n    };\n}\n\n/**\n * image space to transform space\n * - origin of transform space is at center of transform bounds.\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\n * - up is where transform points up\n * - x goes right\n * - y goes down\n * @param x\n * @param y\n * @param transform\n */\nexport function toTransformSpace(x: number, y: number, transform: TFreeTransform): TVector2D {\n    let px, py;\n    px = x - transform.x;\n    py = y - transform.y;\n\n    const rot = BB.rotateAround({ x: 0, y: 0 }, { x: px, y: py }, -transform.angleDeg);\n    px = rot.x;\n    py = rot.y;\n\n    return {\n        x: px,\n        y: py,\n    };\n}\n\n/**\n * transform space to image space\n * @param x\n * @param y\n * @param transform\n */\nexport function toImageSpace(x: number, y: number, transform: TFreeTransform): TVector2D {\n    const rot = BB.rotateAround({ x: 0, y: 0 }, { x: x, y: y }, transform.angleDeg);\n    return {\n        x: rot.x + transform.x,\n        y: rot.y + transform.y,\n    };\n}\n","import { BB } from '../../../bb/bb';\nimport { FreeTransform } from './free-transform';\nimport { TKlBasicLayer } from '../../kl-types';\nimport { TRect } from '../../../bb/bb-types';\nimport { Preview } from '../project-viewport/preview';\nimport { TProjectViewportProject } from '../project-viewport/project-viewport';\nimport { TFreeTransform } from './free-transform-utils';\nimport { css } from '../../../bb/base/base';\n\n/**\n * a basic canvas where you can transform one layer(move around, rotate, scale)\n */\nexport class FreeTransformCanvas {\n    private readonly rootEl: HTMLElement;\n    private readonly freeTransform: FreeTransform;\n    private readonly layers: TKlBasicLayer[];\n    private readonly transformIndex: number;\n    private readonly imageWidth: number;\n    private readonly imageHeight: number;\n    private readonly initTransform: TRect;\n    private readonly previewLayerArr: TProjectViewportProject['layers'];\n    private readonly preview: Preview;\n    private readonly previewCanvas: HTMLCanvasElement;\n    private algorithm: 'pixelated' | 'smooth' = 'smooth';\n\n    private updatePreview(): void {\n        const transform = this.freeTransform.getValue();\n\n        const ctx = BB.ctx(this.previewCanvas);\n        ctx.save();\n        ctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        BB.drawTransformedImageWithBounds(\n            ctx,\n            this.layers[this.transformIndex].image,\n            transform,\n            undefined,\n            this.algorithm === 'pixelated' ||\n                BB.testShouldPixelate(\n                    transform,\n                    transform.width / this.initTransform.width,\n                    transform.height / this.initTransform.height,\n                ),\n        );\n        ctx.restore();\n        this.preview.render();\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        elementWidth: number;\n        elementHeight: number;\n        imageWidth: number;\n        imageHeight: number;\n        layers: TKlBasicLayer[];\n        transformIndex: number;\n    }) {\n        this.imageWidth = p.imageWidth;\n        this.imageHeight = p.imageHeight;\n\n        this.rootEl = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: p.elementWidth + 'px',\n                height: p.elementHeight + 'px',\n            },\n        });\n        this.rootEl.oncontextmenu = () => {\n            return false;\n        };\n        this.layers = p.layers;\n        this.transformIndex = p.transformIndex;\n\n        this.previewLayerArr = this.layers.map((item) => {\n            return {\n                image: item.image,\n                isVisible: item.isVisible,\n                mixModeStr: item.mixModeStr ?? 'source-over',\n                opacity: item.opacity,\n                hasClipping: false,\n            };\n        });\n        this.previewCanvas = BB.canvas(this.imageWidth, this.imageHeight);\n        this.previewLayerArr[this.previewLayerArr.length - 1].image = this.previewCanvas;\n\n        this.preview = new Preview({\n            width: p.elementWidth,\n            height: p.elementHeight,\n            project: {\n                width: p.imageWidth,\n                height: p.imageHeight,\n                layers: this.previewLayerArr,\n            },\n            hasEditMode: true,\n            onModeChange: (m) => {\n                css(this.freeTransform.getElement(), {\n                    pointerEvents: m === 'edit' ? '' : 'none',\n                    opacity: m === 'edit' ? '' : '0.5',\n                });\n            },\n            onTransformChange: (transform) => {\n                this.freeTransform.setViewportTransform(transform);\n            },\n            padding: 30,\n        });\n        css(this.preview.getElement(), {\n            overflow: 'hidden',\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n        this.rootEl.append(this.preview.getElement());\n\n        {\n            this.initTransform = {\n                x: this.imageWidth / 2,\n                y: this.imageHeight / 2,\n                width: this.layers[this.transformIndex].image.width,\n                height: this.layers[this.transformIndex].image.height,\n            };\n            this.freeTransform = new FreeTransform({\n                x: this.initTransform.x,\n                y: this.initTransform.y,\n                width: this.initTransform.width,\n                height: this.initTransform.height,\n                angleDeg: 0,\n                isConstrained: true,\n                snapX: [0, this.imageWidth],\n                snapY: [0, this.imageHeight],\n                viewportTransform: this.preview.getTransform(),\n                callback: () => {\n                    this.updatePreview();\n                },\n            });\n            this.preview.getElement().append(this.freeTransform.getElement());\n        }\n        css(this.freeTransform.getElement(), {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n        });\n        setTimeout(() => this.updatePreview(), 0);\n    }\n\n    // ---- interface ----\n    move(dX: number, dY: number): void {\n        this.freeTransform.move(dX, dY);\n    }\n\n    reset(): void {\n        const w = this.layers[this.transformIndex].image.width;\n        const h = this.layers[this.transformIndex].image.height;\n\n        this.freeTransform.setSize(w, h);\n        this.freeTransform.setPos({ x: w / 2, y: h / 2 });\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n\n    setTransformFit(): void {\n        const fit = BB.fitInto(\n            this.layers[this.transformIndex].image.width,\n            this.layers[this.transformIndex].image.height,\n            this.imageWidth,\n            this.imageHeight,\n            1,\n        );\n\n        this.freeTransform.setSize(fit.width, fit.height);\n        this.freeTransform.setPos({ x: fit.width / 2, y: fit.height / 2 });\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n\n    setTransformCenter(): void {\n        this.freeTransform.setPos({\n            x: this.imageWidth / 2,\n            y: this.imageHeight / 2,\n        });\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n\n    setAlgorithm(algo: 'pixelated' | 'smooth'): void {\n        this.algorithm = algo;\n        this.updatePreview();\n    }\n\n    /**\n     * gives you the transformation in the original scale\n     */\n    getTransformation(): TFreeTransform {\n        return this.freeTransform.getValue();\n    }\n\n    getIsPixelated(): boolean {\n        const transform = this.freeTransform.getValue();\n        return (\n            this.algorithm === 'pixelated' ||\n            BB.testShouldPixelate(\n                transform,\n                transform.width / this.initTransform.width,\n                transform.height / this.initTransform.height,\n            )\n        );\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy(): void {\n        this.freeTransform.destroy();\n        this.preview.destroy();\n        BB.freeCanvas(this.previewCanvas);\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { TBounds, TRect, TVector2D } from '../../../bb/bb-types';\nimport { KeyListener } from '../../../bb/input/key-listener';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { css } from '../../../bb/base/base';\n\ntype TUpdateElement = {\n    el: HTMLElement;\n    update: () => void;\n};\n\n/**\n * Interactive preview for crop filter. Corners and edges can be dragged.\n * the div that you append this to must be relative\n */\nexport class Cropper {\n    private readonly rootEl: HTMLElement;\n    private x: number;\n    private y: number;\n    private width: number;\n    private height: number;\n    private scale: number;\n    private readonly grips: TVector2D[]; // aka corner coordinates\n    private readonly edges: TUpdateElement[];\n    private readonly cornerElArr: TUpdateElement[];\n    private readonly darken: TUpdateElement[];\n    private readonly outline: TUpdateElement;\n    private readonly thirdsHorizontal: TUpdateElement;\n    private readonly thirdsVertical: TUpdateElement;\n    private readonly keyListener: KeyListener;\n    private readonly pointerRemainder: TVector2D;\n\n    private readonly outlinePointerListener: PointerListener;\n\n    private readonly corner0PointerListener: PointerListener;\n    private readonly corner1PointerListener: PointerListener;\n    private readonly corner2PointerListener: PointerListener;\n    private readonly corner3PointerListener: PointerListener;\n\n    private readonly edge0PointerListener: PointerListener;\n    private readonly edge1PointerListener: PointerListener;\n    private readonly edge2PointerListener: PointerListener;\n    private readonly edge3PointerListener: PointerListener;\n\n    private readonly callback: (val: TRect) => void;\n\n    private update(): void {\n        this.edges[0].update();\n        this.edges[1].update();\n        this.edges[2].update();\n        this.edges[3].update();\n        this.cornerElArr[0].update();\n        this.cornerElArr[1].update();\n        this.cornerElArr[2].update();\n        this.cornerElArr[3].update();\n        this.darken[0].update();\n        this.darken[1].update();\n        this.darken[2].update();\n        this.darken[3].update();\n        this.outline.update();\n        this.thirdsHorizontal.update();\n        this.thirdsVertical.update();\n    }\n\n    private commit(): void {\n        this.pointerRemainder.x = 0;\n        this.pointerRemainder.y = 0;\n        this.callback(this.getTransform());\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        x: number; // int, pos in relation to image\n        y: number; // int\n        width: number; // int\n        height: number; // int\n        maxW: number;\n        maxH: number;\n        scale: number; // float, zoom\n        callback: (val: TRect) => void;\n        init?: TBounds;\n    }) {\n        this.x = p.x;\n        this.y = p.y;\n        this.width = p.width;\n        this.height = p.height;\n        this.scale = p.scale;\n        this.callback = p.callback;\n\n        const maxW = p.maxW;\n        const maxH = p.maxW;\n        this.rootEl = BB.el();\n        const gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n\n        this.keyListener = new BB.KeyListener({});\n\n        css(this.rootEl, {\n            position: 'absolute',\n            left: this.x * this.scale + 'px',\n            top: this.y * this.scale + 'px',\n        });\n\n        this.outline = {\n            el: BB.el({\n                css: {\n                    position: 'absolute',\n                    border: '1px dashed #fff',\n                    cursor: 'move',\n                },\n            }),\n            update: () => {\n                css(this.outline.el, {\n                    left: this.grips[0].x * this.scale - 1 + 'px',\n                    top: this.grips[0].y * this.scale - 1 + 'px',\n                    width: (this.grips[2].x - this.grips[0].x) * this.scale + 'px',\n                    height: (this.grips[2].y - this.grips[0].y) * this.scale + 'px',\n                });\n            },\n        };\n\n        this.pointerRemainder = {\n            // needs to be reset after dragging complete\n            x: 0,\n            y: 0,\n        };\n        this.outlinePointerListener = new BB.PointerListener({\n            target: this.outline.el,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const { dX, dY } = BB.intDxy(\n                        this.pointerRemainder,\n                        event.dX / this.scale,\n                        event.dY / this.scale,\n                    );\n\n                    this.grips[0].x += dX;\n                    this.grips[0].y += dY;\n                    this.grips[1].x += dX;\n                    this.grips[1].y += dY;\n                    this.grips[2].x += dX;\n                    this.grips[2].y += dY;\n                    this.grips[3].x += dX;\n                    this.grips[3].y += dY;\n\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n\n        this.thirdsHorizontal = {\n            el: BB.el({\n                css: {\n                    position: 'absolute',\n                    borderTop: '1px solid #0ff',\n                    borderBottom: '1px solid #0ff',\n                },\n            }),\n            update: () => {\n                css(this.thirdsHorizontal.el, {\n                    left: this.grips[0].x * this.scale + 'px',\n                    top:\n                        (this.grips[0].y + (this.grips[2].y - this.grips[0].y) / 3) * this.scale +\n                        'px',\n                    width: (this.grips[2].x - this.grips[0].x) * this.scale + 'px',\n                    height: ((this.grips[2].y - this.grips[0].y) / 3) * this.scale + 'px',\n                });\n            },\n        };\n\n        this.thirdsVertical = {\n            el: BB.el({\n                css: {\n                    position: 'absolute',\n                    borderLeft: '1px solid #0ff',\n                    borderRight: '1px solid #0ff',\n                },\n            }),\n            update: () => {\n                css(this.thirdsVertical.el, {\n                    left:\n                        (this.grips[0].x + (this.grips[2].x - this.grips[0].x) / 3) * this.scale +\n                        'px',\n                    top: this.grips[0].y * this.scale + 'px',\n                    width: ((this.grips[2].x - this.grips[0].x) / 3) * this.scale + 'px',\n                    height: (this.grips[2].y - this.grips[0].y) * this.scale + 'px',\n                });\n            },\n        };\n\n        const gripSize = 40;\n        const gripOverlay = 10;\n\n        if (p.init) {\n            this.grips = [\n                { x: p.init.x1, y: p.init.y1 }, // top left\n                { x: p.init.x2, y: p.init.y1 }, // top right\n                { x: p.init.x2, y: p.init.y2 }, // bottom right\n                { x: p.init.x1, y: p.init.y2 }, //bottom left\n            ];\n        } else {\n            this.grips = [\n                { x: 0, y: 0 }, // top left\n                { x: this.width, y: 0 }, // top right\n                { x: this.width, y: this.height }, // bottom right\n                { x: 0, y: this.height }, //bottom left\n            ];\n        }\n\n        const transformTop = (dY: number) => {\n            this.grips[0].y += dY;\n            this.grips[0].y = BB.clamp(\n                this.grips[0].y,\n                this.grips[3].y - maxH,\n                this.grips[3].y - 1,\n            );\n            this.grips[1].y = this.grips[0].y;\n        };\n        const transformRight = (dX: number) => {\n            this.grips[1].x += dX;\n            this.grips[1].x = BB.clamp(\n                this.grips[1].x,\n                this.grips[0].x + 1,\n                this.grips[0].x + maxW,\n            );\n            this.grips[2].x = this.grips[1].x;\n        };\n        const transformBottom = (dY: number) => {\n            this.grips[2].y += dY;\n            this.grips[2].y = BB.clamp(\n                this.grips[2].y,\n                this.grips[1].y + 1,\n                this.grips[1].y + maxH,\n            );\n            this.grips[3].y = this.grips[2].y;\n        };\n        const transformLeft = (dX: number) => {\n            this.grips[0].x += dX;\n            this.grips[0].x = BB.clamp(\n                this.grips[0].x,\n                this.grips[1].x - maxW,\n                this.grips[1].x - 1,\n            );\n            this.grips[3].x = this.grips[0].x;\n        };\n\n        this.edges = [];\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                const el = BB.el({\n                    css: {\n                        width: gripSize + 'px',\n                        height: gripSize + 'px',\n                        //background: '#0f0',\n                        position: 'absolute',\n                    },\n                });\n\n                const update = () => {\n                    if (i === 0) {\n                        //top\n                        css(el, {\n                            left: this.grips[0].x * this.scale + gripOverlay + 'px',\n                            top: this.grips[0].y * this.scale - gripSize * 2 + gripOverlay + 'px',\n                            width:\n                                (this.grips[1].x - this.grips[0].x) * this.scale -\n                                gripOverlay * 2 +\n                                'px',\n                            height: gripSize * 2 + 'px',\n                        });\n                    } else if (i === 1) {\n                        //right\n                        css(el, {\n                            left: this.grips[1].x * this.scale - gripOverlay + 'px',\n                            top: this.grips[1].y * this.scale + gripOverlay + 'px',\n                            width: gripSize * 2 + 'px',\n                            height:\n                                (this.grips[2].y - this.grips[1].y) * this.scale -\n                                gripOverlay * 2 +\n                                'px',\n                        });\n                    } else if (i === 2) {\n                        //bottom\n                        css(el, {\n                            left: this.grips[3].x * this.scale + gripOverlay + 'px',\n                            top: this.grips[3].y * this.scale - gripOverlay + 'px',\n                            width:\n                                (this.grips[2].x - this.grips[3].x) * this.scale -\n                                gripOverlay * 2 +\n                                'px',\n                            height: gripSize * 2 + 'px',\n                        });\n                    } else if (i === 3) {\n                        //left\n                        css(el, {\n                            left: this.grips[0].x * this.scale - gripSize * 2 + gripOverlay + 'px',\n                            top: this.grips[0].y * this.scale + gripOverlay + 'px',\n                            width: gripSize * 2 + 'px',\n                            height:\n                                (this.grips[3].y - this.grips[0].y) * this.scale -\n                                gripOverlay * 2 +\n                                'px',\n                        });\n                    }\n                    const angleOffset = i * 2 + 1;\n                    el.style.cursor = gripCursors[angleOffset] + '-resize';\n                };\n\n                this.edges[i] = {\n                    el,\n                    update,\n                };\n            })(i);\n        }\n\n        this.darken = [];\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                const g = BB.el({\n                    css: {\n                        position: 'absolute',\n                        background: '#000',\n                        opacity: '0.5',\n                    },\n                });\n                const update = () => {\n                    if (i === 0) {\n                        css(g, {\n                            left: this.grips[0].x * this.scale + 'px',\n                            top: this.grips[0].y * this.scale - 8000 + 'px',\n                            width: (this.grips[1].x - this.grips[0].x) * this.scale + 'px',\n                            height: '8000px',\n                        });\n                    } else if (i === 1) {\n                        css(g, {\n                            left: this.grips[1].x * this.scale + 'px',\n                            top: this.grips[1].y * this.scale - 8000 + 'px',\n                            width: '8000px',\n                            height: 16000 + 'px',\n                        });\n                    } else if (i === 2) {\n                        css(g, {\n                            left: this.grips[3].x * this.scale + 'px',\n                            top: this.grips[3].y * this.scale + 'px',\n                            width: (this.grips[2].x - this.grips[3].x) * this.scale + 'px',\n                            height: '8000px',\n                        });\n                    } else if (i === 3) {\n                        css(g, {\n                            left: this.grips[0].x * this.scale - 8000 + 'px',\n                            top: this.grips[0].y * this.scale - 8000 + 'px',\n                            width: '8000px',\n                            height: 16000 + 'px',\n                        });\n                    }\n                };\n\n                this.darken[i] = {\n                    el: g,\n                    update,\n                };\n            })(i);\n        }\n\n        this.edge0PointerListener = new BB.PointerListener({\n            target: this.edges[0].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const { dY } = BB.intDxy(\n                        this.pointerRemainder,\n                        event.dX / this.scale,\n                        event.dY / this.scale,\n                    );\n                    transformTop(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformBottom(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        this.edge1PointerListener = new BB.PointerListener({\n            target: this.edges[1].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const { dX, dY } = BB.intDxy(\n                        this.pointerRemainder,\n                        event.dX / this.scale,\n                        event.dY / this.scale,\n                    );\n                    transformRight(dX);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformLeft(-dX);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        this.edge2PointerListener = new BB.PointerListener({\n            target: this.edges[2].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const { dX, dY } = BB.intDxy(\n                        this.pointerRemainder,\n                        event.dX / this.scale,\n                        event.dY / this.scale,\n                    );\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformTop(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        this.edge3PointerListener = new BB.PointerListener({\n            target: this.edges[3].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const { dX, dY } = BB.intDxy(\n                        this.pointerRemainder,\n                        event.dX / this.scale,\n                        event.dY / this.scale,\n                    );\n                    transformLeft(dX);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformRight(-dX);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n\n        this.cornerElArr = [];\n        (() => {\n            for (let i = 0; i < 4; i++) {\n                ((i) => {\n                    const g = BB.el({\n                        css: {\n                            //background: '#f00',\n                            width: gripSize * 2 + 'px',\n                            height: gripSize * 2 + 'px',\n                            position: 'absolute',\n                            cursor: ['nwse-resize', 'nesw-resize'][i % 2],\n                        },\n                    });\n\n                    const update = () => {\n                        if (i === 0) {\n                            //top left\n                            css(g, {\n                                left:\n                                    this.grips[0].x * this.scale -\n                                    gripSize * 2 +\n                                    gripOverlay +\n                                    'px',\n                                top:\n                                    this.grips[0].y * this.scale -\n                                    gripSize * 2 +\n                                    gripOverlay +\n                                    'px',\n                            });\n                        } else if (i === 1) {\n                            //top right\n                            css(g, {\n                                left: this.grips[1].x * this.scale - gripOverlay + 'px',\n                                top:\n                                    this.grips[1].y * this.scale -\n                                    gripSize * 2 +\n                                    gripOverlay +\n                                    'px',\n                            });\n                        } else if (i === 2) {\n                            //bottom right\n                            css(g, {\n                                left: this.grips[1].x * this.scale - gripOverlay + 'px',\n                                top: this.grips[2].y * this.scale - gripOverlay + 'px',\n                            });\n                        } else if (i === 3) {\n                            //bottom left\n                            css(g, {\n                                left:\n                                    this.grips[0].x * this.scale -\n                                    gripSize * 2 +\n                                    gripOverlay +\n                                    'px',\n                                top: this.grips[2].y * this.scale - gripOverlay + 'px',\n                            });\n                        }\n                    };\n\n                    this.cornerElArr[i] = {\n                        el: g,\n                        update,\n                    };\n                })(i);\n            }\n        })();\n        //top left\n        this.corner0PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[0].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const { dX, dY } = BB.intDxy(\n                        this.pointerRemainder,\n                        event.dX / this.scale,\n                        event.dY / this.scale,\n                    );\n                    transformLeft(dX);\n                    transformTop(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformRight(-dX);\n                        transformBottom(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        //top right\n        this.corner1PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[1].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const { dX, dY } = BB.intDxy(\n                        this.pointerRemainder,\n                        event.dX / this.scale,\n                        event.dY / this.scale,\n                    );\n                    transformRight(dX);\n                    transformTop(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformLeft(-dX);\n                        transformBottom(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        //bottom right\n        this.corner2PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[2].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const { dX, dY } = BB.intDxy(\n                        this.pointerRemainder,\n                        event.dX / this.scale,\n                        event.dY / this.scale,\n                    );\n                    transformRight(dX);\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformLeft(-dX);\n                        transformTop(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        //bottom left\n        this.corner3PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[3].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const { dX, dY } = BB.intDxy(\n                        this.pointerRemainder,\n                        event.dX / this.scale,\n                        event.dY / this.scale,\n                    );\n                    transformLeft(dX);\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformRight(-dX);\n                        transformTop(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n\n        this.rootEl.append(\n            this.darken[1].el,\n            this.darken[0].el,\n            this.darken[2].el,\n            this.darken[3].el,\n            this.thirdsHorizontal.el,\n            this.thirdsVertical.el,\n            this.outline.el,\n\n            this.edges[1].el,\n            this.edges[0].el,\n            this.edges[2].el,\n            this.edges[3].el,\n\n            this.cornerElArr[0].el,\n            this.cornerElArr[1].el,\n            this.cornerElArr[2].el,\n            this.cornerElArr[3].el,\n        );\n\n        this.update();\n    }\n\n    // ---- interface ----\n    getTransform(): TRect {\n        this.grips[1].x -= this.grips[0].x;\n        this.grips[1].y -= this.grips[0].y;\n        this.grips[2].x -= this.grips[0].x;\n        this.grips[2].y -= this.grips[0].y;\n        this.grips[3].x -= this.grips[0].x;\n        this.grips[3].y -= this.grips[0].y;\n        this.x += this.grips[0].x;\n        this.y += this.grips[0].y;\n        this.grips[0].x = 0;\n        this.grips[0].y = 0;\n        return {\n            x: this.x,\n            y: this.y,\n            width: this.grips[1].x,\n            height: this.grips[2].y,\n        };\n    }\n\n    setTransform(p: TRect): void {\n        this.x = p.x;\n        this.y = p.y;\n        this.width = p.width;\n        this.height = p.height;\n\n        css(this.rootEl, {\n            left: this.x * this.scale + 'px',\n            top: this.y * this.scale + 'px',\n        });\n\n        this.grips[0].x = 0;\n        this.grips[0].y = 0;\n        this.grips[1].x = this.width;\n        this.grips[1].y = 0;\n        this.grips[2].x = this.width;\n        this.grips[2].y = this.height;\n        this.grips[3].x = 0;\n        this.grips[3].y = this.height;\n\n        this.update();\n        this.commit();\n    }\n\n    setScale(s: number): void {\n        this.scale = s;\n        css(this.rootEl, {\n            left: this.x * this.scale + 'px',\n            top: this.y * this.scale + 'px',\n        });\n        this.update();\n    }\n\n    showThirds(b: boolean): void {\n        this.thirdsHorizontal.el.style.display = b ? 'block' : 'none';\n        this.thirdsVertical.el.style.display = b ? 'block' : 'none';\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy(): void {\n        this.keyListener.destroy();\n        this.outlinePointerListener.destroy();\n        this.corner0PointerListener.destroy();\n        this.corner1PointerListener.destroy();\n        this.corner2PointerListener.destroy();\n        this.corner3PointerListener.destroy();\n        this.edge0PointerListener.destroy();\n        this.edge1PointerListener.destroy();\n        this.edge2PointerListener.destroy();\n        this.edge3PointerListener.destroy();\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { LANG } from '../../../language/language';\nimport { TUiLayout } from '../../kl-types';\nimport { TSize2D } from '../../../bb/bb-types';\nimport { THEME } from '../../../theme/theme';\nimport { css, throwIfNull } from '../../../bb/base/base';\nimport { TKlCanvasLayer } from '../../canvas/kl-canvas';\nimport { KlHistory } from '../../history/kl-history';\n\n/**\n * Previews currently active layer\n * thumbnail (hover shows bigger preview), layer name, opacity\n *\n * internally listens to kl history. updates when there's a change.\n * but you need to update it when the active layer changed. (different canvas object)\n *\n * update visibility for performance\n */\nexport class LayerPreview {\n    private readonly rootEl: HTMLElement;\n    private readonly contentWrapperEl: HTMLElement;\n    private readonly height: number;\n    private readonly klHistory: KlHistory;\n    private layer: TKlCanvasLayer | undefined;\n    private isPreviewVisible: boolean;\n    private uiState: TUiLayout;\n\n    private readonly checkEl: HTMLInputElement;\n\n    private readonly nameLabelEl: HTMLElement;\n    private readonly opacityEl: HTMLElement;\n    private lastDrawnSize: TSize2D;\n    private lastDrawnState: number; // from KlHistory\n\n    private readonly canvasSize: number;\n    private readonly canvas: HTMLCanvasElement;\n    private readonly canvasCtx: CanvasRenderingContext2D;\n\n    private animationCount: number; // >0 means it's animating\n    private readonly animationLength: number;\n\n    private readonly animationCanvas: HTMLCanvasElement;\n    private readonly animationCanvasCtx: CanvasRenderingContext2D;\n    private animationCanvasCheckerPattern: CanvasPattern = {} as CanvasPattern;\n\n    private largeCanvasIsVisible: boolean;\n    private readonly largeCanvasWrapper: HTMLElement;\n    private readonly largeCanvasSize: number;\n    private readonly largeCanvas: HTMLCanvasElement;\n    private readonly largeCanvasCtx: CanvasRenderingContext2D;\n    private largeCanvasCheckerPattern: CanvasPattern = {} as CanvasPattern;\n\n    private updateCheckerPatterns(): void {\n        const checker = BB.createCheckerCanvas(4, THEME.isDark());\n        this.animationCanvasCheckerPattern = throwIfNull(\n            this.animationCanvasCtx.createPattern(checker, 'repeat'),\n        );\n        this.largeCanvasCheckerPattern = throwIfNull(\n            this.canvasCtx.createPattern(checker, 'repeat'),\n        );\n    }\n\n    private animate(): void {\n        if (this.animationCount === 0) {\n            return;\n        }\n\n        this.animationCount--;\n\n        this.canvasCtx.save();\n        this.canvasCtx.globalAlpha = Math.pow(\n            (this.animationLength - this.animationCount) / this.animationLength,\n            2,\n        );\n        this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\n        this.canvasCtx.restore();\n\n        if (this.animationCount > 0) {\n            requestAnimationFrame(() => this.animate());\n        }\n    }\n\n    /**\n     * is always instant\n     */\n    private drawLargeCanvas(): void {\n        if (!this.largeCanvasIsVisible || !this.layer) {\n            return;\n        }\n\n        const layerCanvas = this.layer.canvas;\n\n        const canvasDimensions = BB.fitInto(\n            layerCanvas.width,\n            layerCanvas.height,\n            this.largeCanvasSize,\n            this.largeCanvasSize,\n            1,\n        );\n        this.largeCanvas.width = Math.round(canvasDimensions.width);\n        this.largeCanvas.height = Math.round(canvasDimensions.height);\n        this.largeCanvasCtx.save();\n        if (this.largeCanvas.width > layerCanvas.width) {\n            this.largeCanvasCtx.imageSmoothingEnabled = false;\n        } else {\n            this.largeCanvasCtx.imageSmoothingEnabled = true;\n            this.largeCanvasCtx.imageSmoothingQuality = 'high';\n        }\n        this.largeCanvasCtx.fillStyle = this.largeCanvasCheckerPattern;\n        this.largeCanvasCtx.fillRect(0, 0, this.largeCanvas.width, this.largeCanvas.height);\n        this.largeCanvasCtx.drawImage(\n            layerCanvas,\n            0,\n            0,\n            this.largeCanvas.width,\n            this.largeCanvas.height,\n        );\n        this.largeCanvasCtx.restore();\n\n        const bounds = this.rootEl.getBoundingClientRect();\n        css(this.largeCanvasWrapper, {\n            top: Math.max(10, bounds.top + this.height / 2 - this.largeCanvas.height / 2) + 'px',\n        });\n    }\n\n    private updateLabel(): void {\n        if (!this.isPreviewVisible || !this.layer) {\n            return;\n        }\n\n        const layerIsVisible = this.layer.isVisible;\n        this.checkEl.parentElement!.title = layerIsVisible\n            ? LANG('layers-active-layer-visible')\n            : LANG('layers-active-layer-hidden');\n        this.checkEl.checked = layerIsVisible;\n        this.checkEl.style.boxShadow = layerIsVisible ? '' : '0 0 0 1px red';\n\n        this.nameLabelEl.textContent = this.layer.name;\n        if (this.layer.isVisible) {\n            this.opacityEl.innerHTML =\n                LANG('opacity') + '<br>' + Math.round(this.layer.opacity * 100) + '%';\n        } else {\n            this.opacityEl.innerHTML =\n                LANG('opacity') + '<br><s>' + Math.round(this.layer.opacity * 100) + '%</s>';\n        }\n    }\n\n    private draw(isInstant: boolean): void {\n        if (!this.isPreviewVisible || !this.layer) {\n            return;\n        }\n        this.updateLabel();\n\n        const layerCanvas = this.layer.canvas;\n\n        if (\n            layerCanvas.width !== this.lastDrawnSize.width ||\n            layerCanvas.height !== this.lastDrawnSize.height\n        ) {\n            const canvasDimensions = BB.fitInto(\n                layerCanvas.width,\n                layerCanvas.height,\n                this.canvasSize,\n                this.canvasSize,\n                1,\n            );\n            this.canvas.width = Math.round(canvasDimensions.width);\n            this.canvas.height = Math.round(canvasDimensions.height);\n\n            isInstant = true; // can't animate when size changed\n        }\n\n        this.animationCanvas.width = this.canvas.width;\n        this.animationCanvas.height = this.canvas.height;\n\n        this.animationCanvasCtx.save();\n        this.animationCanvasCtx.imageSmoothingEnabled = false;\n        this.animationCanvasCtx.fillStyle = this.animationCanvasCheckerPattern;\n        this.animationCanvasCtx.fillRect(\n            0,\n            0,\n            this.animationCanvas.width,\n            this.animationCanvas.height,\n        );\n        this.animationCanvasCtx.drawImage(\n            layerCanvas,\n            0,\n            0,\n            this.animationCanvas.width,\n            this.animationCanvas.height,\n        );\n        this.animationCanvasCtx.restore();\n\n        if (isInstant) {\n            this.animationCount = 0;\n            this.canvasCtx.save();\n            this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\n            this.canvasCtx.restore();\n        } else {\n            this.animationCount = this.animationLength;\n            this.animate();\n        }\n\n        this.drawLargeCanvas();\n\n        this.lastDrawnState = this.klHistory.getChangeCount();\n        this.lastDrawnSize.width = layerCanvas.width;\n        this.lastDrawnSize.height = layerCanvas.height;\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        onClick: () => void; // when clicking on layer name\n        klRootEl: HTMLElement;\n        uiState: TUiLayout;\n        klHistory: KlHistory;\n    }) {\n        // internally redraws with in an interval. checks history is something changed\n        // this update will be animated\n        // it will not be animated if the resolution changed\n        // also redraws when you call updateLayer - not animated\n\n        // syncs via updateLayer, and internally updates layer opacity via a hack\n\n        this.rootEl = BB.el({\n            className: 'kl-layer-preview',\n        });\n        this.klHistory = p.klHistory;\n        this.isPreviewVisible = true;\n        this.height = 40;\n        this.canvasSize = this.height - 10;\n        this.largeCanvasSize = 300;\n        this.lastDrawnState = -2;\n        this.lastDrawnSize = {\n            width: 0,\n            height: 0,\n        };\n        this.animationCanvas = BB.canvas(); // to help animate the transition\n        this.animationCanvasCtx = BB.ctx(this.animationCanvas);\n        this.animationLength = 30;\n        this.animationCount = 0;\n        this.largeCanvasIsVisible = false;\n        let largeCanvasAnimationTimeout: ReturnType<typeof setTimeout>;\n        const largeCanvasAnimationDurationMs = 300;\n        this.uiState = p.uiState;\n\n        // --- setup dom ---\n        this.contentWrapperEl = BB.el({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                height: this.height + 'px',\n            },\n        });\n\n        const checkWrapper = BB.el({\n            css: {\n                display: 'flex',\n                justifyContent: 'flex-end',\n                alignItems: 'center',\n                width: '23px',\n                flexShrink: '0',\n            },\n        });\n        this.checkEl = BB.el({\n            parent: checkWrapper,\n            tagName: 'input',\n            css: {\n                pointerEvents: 'none',\n            },\n            custom: {\n                type: 'checkbox',\n                disabled: 'true',\n                name: 'layer-visible',\n            },\n        });\n\n        const canvasWrapperEl = BB.el({\n            css: {\n                //background: '#f00',\n                minWidth: this.height + 'px',\n                height: this.height + 'px',\n                display: 'flex',\n                justifyContent: 'center',\n                alignItems: 'center',\n            },\n        });\n        this.canvas = BB.canvas(this.canvasSize, this.canvasSize);\n        this.canvasCtx = BB.ctx(this.canvas);\n        this.canvas.title = LANG('layers-active-layer');\n        const nameWrapper = BB.el({\n            css: {\n                //background: '#ff0',\n                flexGrow: '1',\n                paddingLeft: '10px',\n                fontSize: '13px',\n                overflow: 'hidden',\n                position: 'relative',\n            },\n        });\n        this.nameLabelEl = BB.el({\n            content: '',\n            css: {\n                cssFloat: 'left',\n                whiteSpace: 'nowrap',\n            },\n        });\n        const clickableEl = BB.el({\n            css: {\n                // background: 'rgba(0,255,0,0.6)',\n                position: 'absolute',\n                left: '10px',\n                top: '0',\n                width: '90px',\n                height: '100%',\n            },\n        });\n        if (p.onClick) {\n            clickableEl.addEventListener('click', () => p.onClick(), { passive: false });\n            this.canvas.addEventListener('click', () => p.onClick(), { passive: false });\n            checkWrapper.addEventListener('click', () => p.onClick(), { passive: false });\n        }\n        this.opacityEl = BB.el({\n            content: LANG('opacity') + '<br>100%',\n            css: {\n                minWidth: '60px',\n                fontSize: '12px',\n                textAlign: 'center',\n            },\n        });\n\n        this.largeCanvasWrapper = BB.el({\n            onClick: BB.handleClick,\n            css: {\n                pointerEvents: 'none',\n                background: '#fff',\n                position: 'absolute',\n                right: '280px',\n                top: '10px',\n                border: '1px solid #aaa',\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\n                transition: 'opacity ' + largeCanvasAnimationDurationMs + 'ms ease-in-out',\n                userSelect: 'none',\n                display: 'block',\n                ['webkitTouchCallout' as any]: 'none',\n            },\n        });\n        this.largeCanvas = BB.canvas(this.largeCanvasSize, this.largeCanvasSize);\n        this.largeCanvasWrapper.append(this.largeCanvas);\n        this.largeCanvasCtx = BB.ctx(this.largeCanvas);\n        css(this.largeCanvas, {\n            display: 'block',\n        });\n\n        canvasWrapperEl.append(this.canvas);\n        nameWrapper.append(this.nameLabelEl, clickableEl);\n        this.contentWrapperEl.append(checkWrapper, canvasWrapperEl, nameWrapper, this.opacityEl);\n        this.rootEl.append(this.contentWrapperEl);\n\n        this.updateCheckerPatterns();\n        THEME.addIsDarkListener(() => {\n            this.updateCheckerPatterns();\n            this.draw(true);\n        });\n\n        // --- update logic ---\n        // cross-fade done via 2 canvases (old and new state)\n        // both have checkerboard background drawn on them, both fully opaque\n        // -> no \"lighter\" is needed for accurate cross-fading\n\n        // label should update instantly\n        this.klHistory.addListener(() => {\n            this.updateLabel();\n        });\n\n        setInterval(() => {\n            if (!this.layer) {\n                return;\n            }\n\n            const currentState = this.klHistory.getChangeCount();\n            if (currentState === this.lastDrawnState) {\n                return;\n            }\n\n            this.draw(false);\n        }, 2000);\n\n        const removeLargeCanvas = () => {\n            this.largeCanvasWrapper.remove();\n        };\n\n        const showLargeCanvas = (b: boolean) => {\n            if (this.largeCanvasIsVisible === b) {\n                return;\n            }\n\n            clearTimeout(largeCanvasAnimationTimeout);\n            this.largeCanvasIsVisible = b;\n\n            if (b) {\n                largeCanvasAnimationTimeout = setTimeout(() => {\n                    this.drawLargeCanvas();\n                    this.largeCanvasWrapper.style.opacity = '0';\n                    p.klRootEl.append(this.largeCanvasWrapper);\n                    setTimeout(() => {\n                        this.largeCanvasWrapper.style.opacity = '1';\n                    }, 20);\n                }, 250);\n            } else {\n                this.largeCanvasWrapper.style.opacity = '0';\n                largeCanvasAnimationTimeout = setTimeout(\n                    removeLargeCanvas,\n                    largeCanvasAnimationDurationMs + 20,\n                );\n            }\n        };\n\n        const pointerListener = new BB.PointerListener({\n            target: this.canvas,\n            onEnterLeave: (b) => {\n                showLargeCanvas(b);\n            },\n        });\n    }\n\n    // ---- interface ----\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible(b: boolean): void {\n        if (this.isPreviewVisible === b) {\n            return;\n        }\n        this.isPreviewVisible = b;\n        this.contentWrapperEl.style.display = this.isPreviewVisible ? 'flex' : 'none';\n        this.rootEl.style.marginBottom = this.isPreviewVisible ? '' : '10px';\n\n        const currentState = this.klHistory.getChangeCount();\n        if (b && this.lastDrawnState !== currentState) {\n            this.draw(true);\n        }\n    }\n\n    //when the layer might have changed\n    setLayer(layer: TKlCanvasLayer): void {\n        this.layer = layer;\n        this.draw(true);\n    }\n\n    setUiState(stateStr: TUiLayout): void {\n        this.uiState = stateStr;\n\n        if (this.uiState === 'left') {\n            css(this.largeCanvasWrapper, {\n                left: '280px',\n                right: '',\n            });\n        } else {\n            css(this.largeCanvasWrapper, {\n                left: '',\n                right: '280px',\n            });\n        }\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { FreeTransformCanvas } from '../components/free-transform-canvas';\nimport { showModal } from './base/showModal';\nimport { KlCanvas } from '../../canvas/kl-canvas';\nimport { TKlBasicLayer } from '../../kl-types';\nimport { LANG } from '../../../language/language';\nimport { testIsSmall } from '../utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth } from '../utils/preview-size';\nimport { Select } from '../components/select';\nimport { css } from '../../../bb/base/base';\n\nexport function showImportAsLayerDialog(params: {\n    target: HTMLElement;\n    klCanvas: KlCanvas;\n    importImage: HTMLImageElement | HTMLCanvasElement;\n    callback: (\n        p?: {\n            x: number;\n            y: number;\n            width: number;\n            height: number;\n            angleDeg: number;\n        },\n        isPixelated?: boolean,\n    ) => void;\n}): void {\n    const div = document.createElement('div');\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\n    if (params.klCanvas.isLayerLimitReached()) {\n        const noteEl = BB.el({\n            className: 'kl-import-note',\n            content: LANG('import-as-layer-limit-reached'),\n        });\n        div.append(noteEl);\n    }\n    const isSmall = testIsSmall();\n\n    const buttonRowEl = BB.el({\n        css: {\n            display: 'flex',\n        },\n    });\n    const originalSizeBtn = BB.el({\n        tagName: 'button',\n        content: '1:1',\n        css: {\n            marginRight: '10px',\n        },\n        onClick: function () {\n            freeTransformCanvas.reset();\n        },\n    });\n    const fitSizeBtn = BB.el({\n        tagName: 'button',\n        content: LANG('import-as-layer-fit'),\n        css: {\n            marginRight: '10px',\n        },\n        onClick: function () {\n            freeTransformCanvas.setTransformFit();\n        },\n    });\n    const centerBtn = BB.el({\n        tagName: 'button',\n        content: LANG('center'),\n        css: {\n            marginRight: '10px',\n        },\n        onClick: function () {\n            freeTransformCanvas.setTransformCenter();\n        },\n    });\n    const algorithmSelect = new Select({\n        isFocusable: true,\n        optionArr: [\n            ['smooth', LANG('algorithm-smooth')],\n            ['pixelated', LANG('algorithm-pixelated')],\n        ],\n        initValue: 'smooth',\n        title: LANG('scaling-algorithm'),\n        onChange: (val): void => {\n            freeTransformCanvas.setAlgorithm(val);\n        },\n        name: 'interpolation-algorithm',\n    });\n    buttonRowEl.append(\n        originalSizeBtn,\n        fitSizeBtn,\n        centerBtn,\n        BB.el({ css: { flexGrow: '1' } }),\n        algorithmSelect.getElement(),\n    );\n    div.append(buttonRowEl);\n\n    const layers: TKlBasicLayer[] = [];\n    {\n        const klCanvasLayerArr = params.klCanvas.getLayers();\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\n            layers.push({\n                image: klCanvasLayerArr[i].context.canvas,\n                isVisible: klCanvasLayerArr[i].isVisible,\n                opacity: klCanvasLayerArr[i].opacity,\n                mixModeStr: klCanvasLayerArr[i].mixModeStr,\n            });\n        }\n    }\n    layers.push({\n        image: params.importImage,\n        isVisible: true,\n        opacity: 1,\n        mixModeStr: 'source-over',\n    });\n\n    const freeTransformCanvas = new FreeTransformCanvas({\n        elementWidth: getPreviewWidth(isSmall),\n        elementHeight: getPreviewHeight(isSmall) + 50,\n        imageWidth: params.klCanvas.getLayerContext(0)!.canvas.width,\n        imageHeight: params.klCanvas.getLayerContext(0)!.canvas.height,\n        layers: layers,\n        transformIndex: layers.length - 1,\n    });\n    css(freeTransformCanvas.getElement(), {\n        marginTop: '10px',\n        marginLeft: '-20px',\n    });\n    div.append(freeTransformCanvas.getElement());\n\n    function move(x: number, y: number): void {\n        freeTransformCanvas.move(x, y);\n    }\n\n    const keyListener = new BB.KeyListener({\n        onDown: function (keyStr) {\n            if (keyStr === 'left') {\n                move(-1, 0);\n            }\n            if (keyStr === 'right') {\n                move(1, 0);\n            }\n            if (keyStr === 'up') {\n                move(0, -1);\n            }\n            if (keyStr === 'down') {\n                move(0, 1);\n            }\n        },\n    });\n\n    showModal({\n        target: params.target,\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\n        div: div,\n        style: isSmall\n            ? undefined\n            : {\n                  width: '540px',\n              },\n        buttons: ['Ok', 'Cancel'],\n        clickOnEnter: 'Ok',\n        callback: function (buttonStr) {\n            keyListener.destroy();\n            freeTransformCanvas.destroy();\n            BB.destroyEl(originalSizeBtn);\n            BB.destroyEl(fitSizeBtn);\n            BB.destroyEl(centerBtn);\n            if (buttonStr === 'Ok') {\n                params.callback(\n                    freeTransformCanvas.getTransformation(),\n                    freeTransformCanvas.getIsPixelated(),\n                );\n            } else {\n                params.callback();\n            }\n        },\n    });\n}\n","export function testIsSmall(): boolean {\n    return window.innerWidth < 550;\n}\n","export const SMALL_PREVIEW = {\n    width: 340,\n    height: 220,\n};\n\nexport const MEDIUM_PREVIEW = {\n    width: 540,\n    height: 300,\n};\n\nexport function getPreviewWidth(isSmall: boolean): number {\n    return isSmall ? SMALL_PREVIEW.width : MEDIUM_PREVIEW.width;\n}\n\nexport function getPreviewHeight(isSmall: boolean): number {\n    return isSmall ? SMALL_PREVIEW.height : MEDIUM_PREVIEW.height;\n}\n","import { BB } from '../../../bb/bb';\nimport { LANG } from '../../../language/language';\n\ntype TDropOption = 'default' | 'layer' | 'image';\n\n/**\n * Not really generalized. UI when you drag/drop an image into window.\n * The moment you create it, it will listen.\n * */\nexport class KlImageDropper {\n    private readonly rootEl: HTMLElement;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        onDrop: (files: FileList, optionStr: TDropOption) => void;\n        target: HTMLElement;\n        enabledTest: () => boolean;\n    }) {\n        //set up DOM\n        this.rootEl = BB.el({\n            content: LANG('dropper-drop'),\n            css: {\n                paddingTop: '100px',\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                width: '100%',\n                height: '100%',\n                background: 'rgba(50, 50, 50, 0.7)',\n                color: '#fff',\n                textShadow: '2px 2px #000',\n                textAlign: 'center',\n                fontSize: '25px',\n            },\n        });\n        const wrapperEl = BB.el({\n            css: {\n                marginTop: '50px',\n                display: 'flex',\n                justifyContent: 'center',\n            },\n        });\n        const optionStyle = {\n            width: '200px',\n            padding: '50px',\n            margin: '10px',\n            //opacity: 0.5,\n            borderRadius: '20px',\n            border: '1px dashed #fff',\n            background: '#00aefe',\n            fontWeight: 'bold',\n        };\n        const optionLayerEl = BB.el({\n            content: LANG('dropper-as-layer'),\n            css: optionStyle,\n        });\n        const optionImageEl = BB.el({\n            content: LANG('dropper-as-image'),\n            css: optionStyle,\n        });\n\n        this.rootEl.append(wrapperEl);\n        wrapperEl.append(optionLayerEl, optionImageEl);\n\n        let rootCounter = 0;\n        let optionLayerCounter = 0;\n        let optionImageCounter = 0;\n\n        const destroy = () => {\n            rootCounter = 0;\n            optionLayerCounter = 0;\n            optionImageCounter = 0;\n            this.rootEl.remove();\n        };\n\n        /**\n         * check, can drop content be imported\n         */\n        const testAcceptType = (event: DragEvent): boolean => {\n            return !!event.dataTransfer && !event.dataTransfer.types.includes('text/plain');\n        };\n\n        const updateOptions = () => {\n            const boxShadow = '0 0 20px 4px #fff';\n            if (optionLayerCounter > 0) {\n                optionLayerEl.style.boxShadow = boxShadow;\n                optionImageEl.style.boxShadow = '';\n            } else if (optionImageCounter > 0) {\n                optionLayerEl.style.boxShadow = '';\n                optionImageEl.style.boxShadow = boxShadow;\n            } else {\n                optionLayerEl.style.boxShadow = '';\n                optionImageEl.style.boxShadow = '';\n            }\n        };\n\n        optionLayerEl.addEventListener(\n            'dragenter',\n            () => {\n                optionLayerCounter++;\n                updateOptions();\n            },\n            { passive: false },\n        );\n        optionLayerEl.addEventListener(\n            'dragleave',\n            () => {\n                optionLayerCounter--;\n                updateOptions();\n            },\n            { passive: false },\n        );\n        optionImageEl.addEventListener(\n            'dragenter',\n            () => {\n                optionImageCounter++;\n                updateOptions();\n            },\n            { passive: false },\n        );\n        optionImageEl.addEventListener(\n            'dragleave',\n            () => {\n                optionImageCounter--;\n                updateOptions();\n            },\n            { passive: false },\n        );\n\n        const rootDragOver = (event: DragEvent): void => {\n            if (!testAcceptType(event)) {\n                return;\n            }\n            event.stopPropagation();\n            event.preventDefault();\n        };\n\n        const rootDragEnter = (event: DragEvent): void => {\n            if (!p.enabledTest() || !testAcceptType(event)) {\n                return;\n            }\n            if (rootCounter === 0) {\n                p.target.append(this.rootEl);\n            }\n            rootCounter++;\n        };\n\n        const rootDragLeave = (event: DragEvent): void => {\n            if (!testAcceptType(event) || rootCounter === 0) {\n                return;\n            }\n            rootCounter = Math.max(0, rootCounter - 1);\n            if (rootCounter === 0) {\n                this.rootEl.remove();\n            }\n        };\n\n        const rootDrop = (event: DragEvent): void => {\n            if (\n                !testAcceptType(event) ||\n                !event.dataTransfer ||\n                event.dataTransfer.files.length === 0\n            ) {\n                destroy();\n                return;\n            }\n            event.stopPropagation();\n            event.preventDefault();\n\n            let optionStr: TDropOption = 'default';\n            if (optionLayerCounter > 0) {\n                optionStr = 'layer';\n            } else if (optionImageCounter > 0) {\n                optionStr = 'image';\n            }\n\n            p.onDrop(event.dataTransfer.files, optionStr);\n\n            if (rootCounter > 0) {\n                this.rootEl.remove();\n            }\n            rootCounter = 0;\n            optionLayerCounter = 0;\n            optionImageCounter = 0;\n            updateOptions();\n        };\n\n        window.addEventListener('dragover', rootDragOver, { passive: false });\n        window.addEventListener('dragenter', rootDragEnter, { passive: false });\n        window.addEventListener('dragleave', rootDragLeave, { passive: false });\n        window.addEventListener('drop', rootDrop, { passive: false });\n\n        // if something goes wrong and you're stuck with overlay\n        this.rootEl.addEventListener(\n            'pointerdown',\n            () => {\n                destroy();\n            },\n            { passive: false },\n        );\n        const keyListener = new BB.KeyListener({\n            onDown: (keyStr) => {\n                if (rootCounter > 0 && keyStr === 'esc') {\n                    destroy();\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n}\n","import { BB } from '../../../bb/bb';\nimport { KlColorSliderSmall } from './kl-color-slider-small';\nimport { KlSlider } from './kl-slider';\nimport { BrushSettingService, TBrushSettingEmit } from '../../brushes-ui/brush-setting-service';\nimport { LANG } from '../../../language/language';\nimport { TRgb } from '../../kl-types';\nimport { TVector2D } from '../../../bb/bb-types';\nimport { css } from '../../../bb/base/base';\n\n/**\n * Compressed HUD toolspace. When you hold ctrl+alt.\n * small color picker, brush settings\n */\nexport class OverlayToolspace {\n    private readonly rootEl: HTMLElement;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        brushSettingService: BrushSettingService; // to sync with outside\n        enabledTest: () => boolean; // calls to see if it's allowed to show\n    }) {\n        const sizeObj = {\n            width: 150,\n            svHeight: 90,\n            hHeight: 20,\n            sliderHeight: 25,\n        };\n\n        let isVisible = false;\n        this.rootEl = BB.el({\n            className: 'kl-overlay-toolspace',\n        });\n        const queuedObj: {\n            color: TRgb | null;\n            size: number | null;\n            opacity: number | null;\n        } = {\n            color: null,\n            size: null,\n            opacity: null,\n        };\n\n        // --- inputs ---\n\n        //color selection\n        const colorEl = BB.el({\n            parent: this.rootEl,\n            className: 'kl-overlay-toolspace__color',\n        });\n        const colorSlider = new KlColorSliderSmall({\n            width: sizeObj.width,\n            heightSV: sizeObj.svHeight,\n            heightH: sizeObj.hHeight,\n            color: p.brushSettingService.getColor(),\n            callback: (rgbObj: TRgb) => {\n                selectedColorEl.style.backgroundColor =\n                    'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\n                p.brushSettingService.setColor(rgbObj, subscriptionFunc);\n            },\n        });\n        const selectedColorEl = BB.el({\n            css: {\n                width: sizeObj.width + 'px',\n                height: sizeObj.hHeight + 'px',\n                pointerEvents: 'none',\n            },\n        });\n        {\n            const initialColor = p.brushSettingService.getColor();\n            selectedColorEl.style.backgroundColor =\n                'rgb(' + initialColor.r + ',' + initialColor.g + ',' + initialColor.b + ')';\n        }\n\n        colorEl.append(selectedColorEl, colorSlider.getElement());\n\n        const updateColor = (rgbObj: TRgb) => {\n            colorSlider.setColor(rgbObj);\n            selectedColorEl.style.backgroundColor =\n                'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\n        };\n\n        //brushsize slider\n\n        const sizeSlider = new KlSlider({\n            label: LANG('brush-size'),\n            width: sizeObj.width,\n            height: sizeObj.sliderHeight,\n            min: 0,\n            max: 500,\n            value: 50,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toDisplayValue: (val) => val * 2,\n            toValue: (displayValue) => displayValue / 2,\n            onChange: (v) => {\n                p.brushSettingService.setSize(v);\n            },\n            formatFunc: (displayValue) => {\n                if (displayValue < 10) {\n                    return BB.round(displayValue, 1);\n                } else {\n                    return Math.round(displayValue);\n                }\n            },\n        });\n        css(sizeSlider.getElement(), {\n            marginTop: '2px',\n        });\n\n        const opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: sizeObj.width,\n            height: sizeObj.sliderHeight,\n            min: 0,\n            max: 1,\n            value: 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toDisplayValue: (val) => val * 100,\n            toValue: (displayValue) => displayValue / 100,\n            onChange: (v) => {\n                p.brushSettingService.setOpacity(v);\n            },\n        });\n        css(opacitySlider.getElement(), {\n            margin: '2px 0',\n        });\n        this.rootEl.append(sizeSlider.getElement(), opacitySlider.getElement());\n\n        // --- general setup ---\n\n        const subscriptionFunc = (event: TBrushSettingEmit) => {\n            if (event.type === 'color') {\n                if (!isVisible) {\n                    queuedObj.color = event.value;\n                } else {\n                    updateColor(event.value);\n                }\n            }\n            if (event.type === 'size') {\n                if (!isVisible) {\n                    queuedObj.size = event.value;\n                } else {\n                    sizeSlider.setValue(event.value);\n                }\n            }\n            if (event.type === 'opacity') {\n                if (!isVisible) {\n                    queuedObj.opacity = event.value;\n                } else {\n                    opacitySlider.setValue(event.value);\n                }\n            }\n            if (event.type === 'sliderConfig') {\n                sizeSlider.update(event.value.sizeSlider);\n                opacitySlider.update(event.value.opacitySlider);\n            }\n        };\n        p.brushSettingService.subscribe(subscriptionFunc);\n        {\n            const sliderConfig = p.brushSettingService.getSliderConfig();\n            sizeSlider.update(sliderConfig.sizeSlider);\n            opacitySlider.update(sliderConfig.opacitySlider);\n            sizeSlider.setValue(p.brushSettingService.getSize());\n            opacitySlider.setValue(p.brushSettingService.getOpacity());\n        }\n\n        const updateUI = () => {\n            // unfocus manual slider input\n            BB.unfocusAnyInput();\n\n            this.rootEl.style.display = isVisible ? 'block' : 'none';\n            if (isVisible && mousePos) {\n                css(this.rootEl, {\n                    left: mousePos.x - Math.round(sizeObj.width / 2) + 'px',\n                    top:\n                        mousePos.y -\n                        Math.round(sizeObj.svHeight + (sizeObj.hHeight * 3) / 2) +\n                        'px',\n                });\n            }\n        };\n\n        let mousePos: TVector2D | null = null;\n        document.addEventListener(\n            'pointermove',\n            (event) => {\n                mousePos = {\n                    x: event.pageX,\n                    y: event.pageY,\n                };\n            },\n            { passive: false },\n        );\n\n        const keyListener = new BB.KeyListener({\n            onDown: (keyStr, event, comboStr, isRepeat) => {\n                if (isRepeat) {\n                    return;\n                }\n                if (isVisible) {\n                    isVisible = false;\n                    updateUI();\n                    return;\n                }\n\n                if (!p.enabledTest() || !mousePos) {\n                    return;\n                }\n\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\n                    event.preventDefault();\n                    isVisible = true;\n\n                    if (queuedObj.color !== null) {\n                        updateColor(queuedObj.color);\n                        queuedObj.color = null;\n                    }\n                    if (queuedObj.size !== null) {\n                        sizeSlider.setValue(queuedObj.size);\n                        queuedObj.size = null;\n                    }\n                    if (queuedObj.opacity !== null) {\n                        opacitySlider.setValue(queuedObj.opacity);\n                        queuedObj.opacity = null;\n                    }\n\n                    updateUI();\n                }\n            },\n            onUp: (keyStr, event, oldComboStr) => {\n                if (\n                    ['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) &&\n                    isVisible\n                ) {\n                    isVisible = false;\n                    colorSlider.end();\n                    updateUI();\n                }\n            },\n            onBlur: () => {\n                if (isVisible) {\n                    isVisible = false;\n                    colorSlider.end();\n                    updateUI();\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport klecksLogoImg from 'url:/src/app/img/klecks-logo.png';\nimport newImageImg from 'url:/src/app/img/ui/new-image.svg';\nimport importImg from 'url:/src/app/img/ui/import.svg';\nimport exportImg from 'url:/src/app/img/ui/export.svg';\nimport shareImg from 'url:/src/app/img/ui/share.svg';\nimport helpImg from 'url:/src/app/img/ui/help.svg';\nimport { LANG } from '../../../language/language';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { css } from '../../../bb/base/base';\n\n/**\n * Topmost row of buttons in toolspace (with the app logo)\n */\nexport class ToolspaceTopRow {\n    private readonly rootEl: HTMLElement;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        logoImg: string;\n        onLogo: () => void;\n        onNew: () => void;\n        onImport: () => void;\n        onSave: () => void;\n        onShare: () => void;\n        onHelp: () => void;\n    }) {\n        this.rootEl = BB.el({\n            className: 'kl-toolspace-row',\n            css: {\n                height: '36px',\n                display: 'flex',\n            },\n        });\n\n        function createButton(p: {\n            onClick: () => void;\n            title: string;\n            image: string;\n            contain: boolean;\n            extraPadding?: number;\n            darkInvert?: boolean;\n        }): {\n            el: HTMLElement;\n            pointerListener: PointerListener;\n        } {\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            const el = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.contain ? padding + 'px 0' : '',\n                },\n            });\n            const im = BB.el({\n                className: p.darkInvert ? 'dark-invert' : undefined,\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                    backgroundRepeat: 'no-repeat',\n                    backgroundPosition: 'center',\n                    backgroundSize: p.contain ? 'contain' : '',\n                    //filter: 'grayscale(1)',\n                    height: '100%',\n                },\n            });\n            im.style.pointerEvents = 'none';\n            el.append(im);\n            const pointerListener = new BB.PointerListener({\n                // because :hover causes problems w touch\n                target: el,\n                onEnterLeave: function (isOver) {\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\n                },\n            });\n            return {\n                el,\n                pointerListener,\n            };\n        }\n\n        const logoButton = createButton({\n            onClick: p.onLogo,\n            title: LANG('home'),\n            image: p.logoImg ? p.logoImg : klecksLogoImg,\n            contain: true,\n            darkInvert: true,\n        });\n        logoButton.el.classList.add('kl-tool-row-border-right');\n        css(logoButton.el, {\n            width: '46px',\n        });\n        const newButton = createButton({\n            onClick: p.onNew,\n            title: LANG('file-new'),\n            image: newImageImg,\n            extraPadding: 1,\n            contain: true,\n        });\n        const importButton = createButton({\n            onClick: p.onImport,\n            title: LANG('file-import'),\n            image: importImg,\n            extraPadding: 1,\n            contain: true,\n        });\n        const saveButton = createButton({\n            onClick: p.onSave,\n            title: LANG('file-save'),\n            image: exportImg,\n            extraPadding: 1,\n            contain: true,\n        });\n\n        let shareButton = null;\n        if (BB.canShareFiles()) {\n            shareButton = createButton({\n                onClick: p.onShare,\n                title: LANG('file-share'),\n                image: shareImg,\n                contain: true,\n                darkInvert: true,\n            });\n        }\n        const helpButton = createButton({\n            onClick: p.onHelp,\n            title: LANG('help'),\n            image: helpImg,\n            contain: true,\n            darkInvert: true,\n        });\n\n        BB.append(this.rootEl, [\n            logoButton.el,\n            newButton.el,\n            importButton.el,\n            saveButton.el,\n            shareButton ? shareButton.el : undefined,\n            helpButton.el,\n        ]);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","module.exports = parcelRequire.resolve(\"klecks-logo.7f87808a.png\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"new-image.39d1f21f.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"import.dbac8211.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"export.04e2b31c.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"share.90d065cc.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"help.8e9a4a1c.svg\") + \"?\" + Date.now();","import { BB } from '../../../bb/bb';\nimport { DIALOG_COUNTER } from '../modals/modal-count';\nimport toolPaintImg from 'url:/src/app/img/ui/tool-paint.svg';\nimport toolFillImg from 'url:/src/app/img/ui/tool-fill.svg';\nimport toolGradientImg from 'url:/src/app/img/ui/tool-gradient.svg';\nimport toolTextImg from 'url:/src/app/img/ui/tool-text.svg';\nimport toolShapeImg from 'url:/src/app/img/ui/tool-shape.svg';\nimport toolSelectImg from 'url:/src/app/img/ui/tool-select.svg';\nimport { LANG } from '../../../language/language';\nimport { TToolType } from '../../kl-types';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { c } from '../../../bb/base/c';\nimport { css } from '../../../bb/base/base';\n\ntype TDropdownButton = {\n    wrapper: HTMLElement;\n    show: (b: boolean) => void;\n    setIsSmall: (b: boolean) => void;\n};\n\n/**\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\n */\nexport class ToolDropdown {\n    private readonly rootEl: HTMLElement;\n    private readonly activeButton: HTMLElement;\n    private readonly smallMargin: string = '6px 0';\n    private readonly optionArr: TToolType[] = [\n        'brush',\n        'paintBucket',\n        'gradient',\n        'text',\n        'shape',\n        'select',\n    ];\n    private readonly dropdownBtnArr: TDropdownButton[];\n    private readonly arrowButton: HTMLElement;\n    private isActive: boolean;\n    private currentActiveIndex: number;\n    private readonly titleArr: string[];\n    private activeButtonIm: HTMLElement;\n    private readonly imArr;\n\n    private updateButton() {\n        this.activeButton.title =\n            this.titleArr[this.currentActiveIndex] +\n            (this.isActive ? ' (' + LANG('tool-more-tools-click-again') + ')' : '');\n        this.activeButtonIm.style.backgroundImage =\n            \"url('\" + this.imArr[this.currentActiveIndex] + \"')\";\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: { onChange: (activeStr: TToolType) => void }) {\n        this.imArr = [\n            toolPaintImg,\n            toolFillImg,\n            toolGradientImg,\n            toolTextImg,\n            toolShapeImg,\n            toolSelectImg,\n        ];\n        this.titleArr = [\n            `${LANG('tool-brush')} [B]`,\n            `${LANG('tool-paint-bucket')} [G]`,\n            `${LANG('tool-gradient')} [G]`,\n            `${LANG('tool-text')} [T]`,\n            `${LANG('tool-shape')} [U]`,\n            `${LANG('tool-select')} [L]`,\n        ];\n        this.currentActiveIndex = 0;\n        this.isActive = true;\n        let isOpen = false;\n\n        //preload images\n        setTimeout(() => {\n            for (let i = 1; i < this.imArr.length; i++) {\n                const im = new Image();\n                im.src = this.imArr[i];\n            }\n        }, 100);\n\n        this.rootEl = BB.el({\n            css: {\n                position: 'relative',\n                flexGrow: '1',\n            },\n        });\n\n        let openTimeout: ReturnType<typeof setTimeout>;\n        let isDragging = false;\n        let startX: number;\n        let startY: number;\n        let pointerListener;\n        if (BB.hasPointerEvents) {\n            pointerListener = new BB.PointerListener({\n                target: this.rootEl,\n                onPointer: (event) => {\n                    if (event.type === 'pointerdown') {\n                        if (isOpen) {\n                            return;\n                        }\n\n                        openTimeout = setTimeout(() => {\n                            showDropdown();\n                        }, 400);\n                        isDragging = true;\n                        startX = event.pageX;\n                        startY = event.pageY;\n                    } else if (event.type === 'pointermove' && isDragging) {\n                        if (!isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\n                            clearTimeout(openTimeout);\n                            showDropdown();\n                        }\n                    } else if (event.type === 'pointerup' && isDragging) {\n                        clearTimeout(openTimeout);\n                        isDragging = false;\n                        if (isOpen) {\n                            const target = document.elementFromPoint(event.pageX, event.pageY);\n                            for (let i = 0; i < this.dropdownBtnArr.length; i++) {\n                                if (target === this.dropdownBtnArr[i].wrapper) {\n                                    closeDropdown();\n                                    this.isActive = true;\n                                    this.currentActiveIndex = i;\n                                    this.updateButton();\n                                    p.onChange(this.optionArr[this.currentActiveIndex]);\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                },\n            });\n        }\n\n        this.activeButton = BB.el({\n            parent: this.rootEl,\n            className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\n            title: this.titleArr[this.currentActiveIndex],\n            onClick: (e) => {\n                if (this.isActive && !isOpen) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    showDropdown();\n                    return;\n                }\n\n                this.isActive = true;\n                p.onChange(this.optionArr[this.currentActiveIndex]);\n                if (isOpen) {\n                    closeDropdown();\n                }\n            },\n            css: {\n                padding: '10px 0',\n                pointerEvents: 'auto',\n                height: '100%',\n                boxSizing: 'border-box',\n                zIndex: '1',\n            },\n        });\n\n        // hover via JS, so hover-state not stuck on mobile\n        const activeButtonPointerListener = new PointerListener({\n            target: this.activeButton,\n            onEnterLeave: (isOver) => {\n                this.activeButton.classList.toggle('kl-tool-button--hover', isOver);\n            },\n        });\n\n        this.activeButtonIm = BB.el({\n            parent: this.activeButton,\n            className: 'dark-invert',\n            css: {\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                backgroundSize: 'contain',\n                width: 'calc(100% - 7px)',\n                height: '100%',\n                pointerEvents: 'none',\n                opacity: '0.75',\n            },\n        });\n\n        this.arrowButton = BB.el({\n            parent: this.activeButton,\n            className: 'kl-tooldropdown-caret',\n            content: c('.dark-invert'),\n            title: LANG('tool-more-tools'),\n            onClick: (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                showDropdown();\n            },\n        });\n\n        const overlay = BB.el({\n            css: {\n                position: 'absolute',\n                //background: 'rgba(255,0,0,0.5)',\n                left: '0',\n                top: '0',\n                right: '0',\n                bottom: '0',\n            },\n        });\n        const overlayPointerListener = new BB.PointerListener({\n            target: overlay,\n            onPointer: (e) => {\n                if (e.type === 'pointerdown') {\n                    e.eventPreventDefault();\n                    closeDropdown();\n                }\n            },\n        });\n\n        const dropdownWrapper = BB.el({\n            className: 'tool-dropdown-wrapper',\n            css: {\n                position: 'absolute',\n                width: '100%',\n                height: 100 * (this.optionArr.length - 1) + '%',\n                top: '100%',\n                left: '0',\n                zIndex: '-1',\n                boxSizing: 'border-box',\n                cursor: 'pointer',\n                transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\n                borderBottomLeftRadius: '5px',\n                borderBottomRightRadius: '5px',\n                overflow: 'hidden',\n            },\n        });\n\n        this.dropdownBtnArr = [];\n\n        const createDropdownButton = (p: {\n            index: number;\n            id: TToolType;\n            image: string;\n            title: string;\n            onClick: (index: number) => void;\n        }): TDropdownButton => {\n            const wrapper = BB.el({\n                parent: dropdownWrapper,\n                className: 'tool-dropdown-button',\n                title: p.title,\n                css: {\n                    padding: '10px 0',\n                    height: 100 / (this.optionArr.length - 1) + '%',\n                    boxSizing: 'border-box',\n                },\n                onClick: (e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    p.onClick(p.index);\n                },\n            });\n\n            BB.el({\n                parent: wrapper,\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                    backgroundRepeat: 'no-repeat',\n                    backgroundPosition: 'center',\n                    backgroundSize: 'contain',\n                    height: '100%',\n                    pointerEvents: 'none',\n                    opacity: '0.75',\n                },\n            });\n\n            // --- interface ---\n            const show = (b: boolean) => {\n                wrapper.style.display = b ? 'block' : 'none';\n            };\n\n            const setIsSmall = (b: boolean) => {\n                wrapper.style.padding = b ? this.smallMargin : '10px 0';\n            };\n\n            return {\n                wrapper,\n                show,\n                setIsSmall,\n            };\n        };\n\n        const onClickDropdownBtn = (index: number) => {\n            closeDropdown();\n\n            this.isActive = true;\n            this.currentActiveIndex = index;\n\n            this.updateButton();\n\n            p.onChange(this.optionArr[this.currentActiveIndex]);\n        };\n\n        for (let i = 0; i < this.optionArr.length; i++) {\n            this.dropdownBtnArr.push(\n                createDropdownButton({\n                    index: i,\n                    id: this.optionArr[i],\n                    image: this.imArr[i],\n                    title: this.titleArr[i],\n                    onClick: onClickDropdownBtn,\n                }),\n            );\n        }\n\n        const showDropdown = () => {\n            if (DIALOG_COUNTER.get() > 0) {\n                return;\n            }\n            DIALOG_COUNTER.increase(0.5);\n            isOpen = true;\n\n            for (let i = 0; i < this.optionArr.length; i++) {\n                this.dropdownBtnArr[i].show(this.currentActiveIndex !== i);\n            }\n\n            this.arrowButton.style.setProperty('opacity', '0');\n            this.arrowButton.style.setProperty('pointer-events', 'none');\n            this.rootEl.style.zIndex = '1';\n            document.body.append(overlay);\n            this.rootEl.append(dropdownWrapper);\n        };\n\n        const closeDropdown = () => {\n            DIALOG_COUNTER.decrease(0.5);\n            isOpen = false;\n            this.arrowButton.style.removeProperty('opacity');\n            this.arrowButton.style.removeProperty('pointer-events');\n            this.rootEl.style.removeProperty('z-index');\n            overlay.remove();\n            dropdownWrapper.remove();\n        };\n\n        this.updateButton();\n    }\n\n    // ---- interface ----\n\n    setIsSmall(b: boolean): void {\n        this.activeButton.style.padding = b ? this.smallMargin : '10px 0';\n        for (let i = 0; i < this.optionArr.length; i++) {\n            this.dropdownBtnArr[i].setIsSmall(b);\n        }\n        css(this.arrowButton, {\n            width: b ? '14px' : '18px',\n            height: b ? '14px' : '18px',\n        });\n    }\n\n    setActive(activeStr: TToolType): void {\n        if (this.optionArr.includes(activeStr)) {\n            this.isActive = true;\n            for (let i = 0; i < this.optionArr.length; i++) {\n                if (this.optionArr[i] === activeStr) {\n                    this.currentActiveIndex = i;\n                    break;\n                }\n            }\n            this.activeButton.classList.add('toolspace-row-button-activated');\n            this.updateButton();\n        } else {\n            this.isActive = false;\n            this.activeButton.classList.remove('toolspace-row-button-activated');\n            this.updateButton();\n        }\n    }\n\n    getActive(): TToolType {\n        return this.optionArr[this.currentActiveIndex];\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","module.exports = parcelRequire.resolve(\"tool-paint.930c7296.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"tool-fill.4b7343af.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"tool-gradient.6622cb4e.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"tool-text.9ec464d3.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"tool-shape.260b5138.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"tool-select.c1a25046.svg\") + \"?\" + Date.now();","import { BB } from '../../../bb/bb';\nimport { ToolDropdown } from './tool-dropdown';\nimport toolHandImg from 'url:/src/app/img/ui/tool-hand.svg';\nimport toolZoomInImg from 'url:/src/app/img/ui/tool-zoom-in.svg';\nimport toolZoomOutImg from 'url:/src/app/img/ui/tool-zoom-out.svg';\nimport toolUndoImg from 'url:/src/app/img/ui/tool-undo.svg';\nimport { LANG } from '../../../language/language';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { TToolType } from '../../kl-types';\nimport { css } from '../../../bb/base/base';\n\ntype TBaseToolRowButton = {\n    el: HTMLElement;\n};\n\ntype TToolRowButton = TBaseToolRowButton & {\n    pointerListener: PointerListener;\n    setIsSmall: (b: boolean) => void;\n};\n\ntype TToolRowTriangleButton = TBaseToolRowButton & {\n    setIsEnabledLeft: (b: boolean) => void;\n    setIsEnabledRight: (b: boolean) => void;\n    leftPointerListener: PointerListener;\n    rightPointerListener: PointerListener;\n};\n\n/**\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\n * heights: 54px tall, 36px small -> via setIsSmall\n */\nexport class ToolspaceToolRow {\n    private readonly rootEl: HTMLElement;\n    private readonly toolDropdown: ToolDropdown;\n    private readonly handButton: TToolRowButton;\n    private readonly zoomInButton: TToolRowButton;\n    private readonly zoomOutButton: TToolRowButton;\n    private readonly undoButton: TToolRowButton;\n    private readonly redoButton: TToolRowButton;\n    private readonly zoomInNOutButton: TToolRowTriangleButton;\n    private readonly undoNRedoButton: TToolRowTriangleButton;\n    private currentActiveStr: TToolType;\n    private readonly onActivate: (activeStr: TToolType) => void;\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: {\n        onActivate: (activeStr: TToolType) => void; // clicking on tool button - activating it\n        onZoomIn: () => void;\n        onZoomOut: () => void;\n        onUndo: () => void;\n        onRedo: () => void;\n    }) {\n        this.rootEl = BB.el({\n            className: 'kl-toolspace-row',\n            css: {\n                height: '54px',\n                display: 'flex',\n            },\n        });\n\n        this.onActivate = p.onActivate;\n        this.currentActiveStr = 'brush';\n\n        const createButton = (p: {\n            onClick: () => void;\n            image: string;\n            contain: boolean;\n            doLighten?: boolean;\n            doMirror?: boolean;\n        }): TToolRowButton => {\n            const smallMargin = p.doLighten ? '6px 0' : '8px 0';\n\n            const el = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                //title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.contain ? '10px 0' : '',\n                },\n            });\n            const im = BB.el({\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                    backgroundRepeat: 'no-repeat',\n                    backgroundPosition: 'center',\n                    backgroundSize: p.contain ? 'contain' : '',\n                    //filter: 'grayscale(1)',\n                    height: '100%',\n                    transform: p.doMirror ? 'scale(-1, 1)' : '',\n                    pointerEvents: 'none',\n                    opacity: p.doLighten ? '0.75' : '1',\n                },\n            });\n            el.append(im);\n            const pointerListener = new BB.PointerListener({\n                // because :hover causes problems w touch\n                target: el,\n                onEnterLeave: (isOver) => {\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\n                },\n            });\n            const setIsSmall = (b: boolean) => {\n                el.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\n            };\n            return {\n                el,\n                pointerListener,\n                setIsSmall,\n            };\n        };\n\n        const createTriangleButton = (p: {\n            onLeft: () => void;\n            onRight: () => void;\n            leftImage: string;\n            rightImage: string | null;\n        }): TToolRowTriangleButton => {\n            // because IE and Edge don't support clip path\n\n            const result = BB.el({\n                css: {\n                    flexGrow: '1',\n                    position: 'relative',\n                },\n            });\n\n            const svg = BB.createSvg({\n                elementType: 'svg',\n                width: '67px', // can't think of a way doing with percentage\n                height: '54px',\n                viewBox: '0 0 100 100',\n                preserveAspectRatio: 'none',\n            });\n            css(svg, {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n            });\n\n            const blurRadius = 10;\n            const blurOffsetX = 2;\n            const blurOffsetY = 2;\n\n            const defs = BB.createSvg({\n                // inset shadow via svg\n                elementType: 'defs',\n                childrenArr: [\n                    {\n                        elementType: 'filter',\n                        id: 'innershadow',\n                        x0: '-50%',\n                        y0: '-50%',\n                        width: '200%',\n                        height: '200%',\n                        childrenArr: [\n                            {\n                                elementType: 'feGaussianBlur',\n                                in: 'SourceAlpha',\n                                stdDeviation: '' + blurRadius,\n                                result: 'blur',\n                            },\n                            {\n                                elementType: 'feOffset',\n                                dx: '' + blurOffsetX,\n                                dy: '' + blurOffsetY,\n                            },\n                            {\n                                elementType: 'feComposite',\n                                in2: 'SourceAlpha',\n                                operator: 'arithmetic',\n                                k2: '-1',\n                                k3: '1',\n                                result: 'shadowDiff',\n                            },\n\n                            {\n                                elementType: 'feFlood',\n                                'flood-color': '#000',\n                                'flood-opacity': '0.2',\n                            },\n                            {\n                                elementType: 'feComposite',\n                                in2: 'shadowDiff',\n                                operator: 'in',\n                            },\n                            {\n                                elementType: 'feComposite',\n                                in2: 'SourceGraphic',\n                                operator: 'over',\n                                result: 'firstfilter',\n                            },\n\n                            {\n                                elementType: 'feGaussianBlur',\n                                in: 'firstfilter',\n                                stdDeviation: '' + blurRadius,\n                                result: 'blur2',\n                            },\n                            {\n                                elementType: 'feOffset',\n                                dx: '' + blurOffsetX,\n                                dy: '' + blurOffsetY,\n                            },\n                            {\n                                elementType: 'feComposite',\n                                in2: 'firstfilter',\n                                operator: 'arithmetic',\n                                k2: '-1',\n                                k3: '1',\n                                result: 'shadowDiff',\n                            },\n\n                            {\n                                elementType: 'feFlood',\n                                'flood-color': '#000',\n                                'flood-opacity': '0.2',\n                            },\n                            {\n                                elementType: 'feComposite',\n                                in2: 'shadowDiff',\n                                operator: 'in',\n                            },\n                            {\n                                elementType: 'feComposite',\n                                in2: 'firstfilter',\n                                operator: 'over',\n                            },\n                        ],\n                    },\n                ],\n            });\n\n            const svgTriangleLeft = BB.createSvg({\n                elementType: 'path',\n                'vector-effect': 'non-scaling-stroke',\n                d: 'M0,0 L 100,0 0,100 z',\n                fill: 'rgba(0,0,0,0)',\n                class: 'toolspace-svg-triangle-button',\n            });\n            svgTriangleLeft.onclick = () => {\n                p.onLeft();\n                svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\n            };\n\n            const svgTriangleRight = BB.createSvg({\n                elementType: 'path',\n                'vector-effect': 'non-scaling-stroke',\n                d: 'M100,100 L 100,0 0,100 z',\n                fill: 'rgba(0,0,0,0)',\n                class: 'toolspace-svg-triangle-button',\n            });\n            svgTriangleRight.onclick = () => {\n                p.onRight();\n                svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\n            };\n\n            // because :hover causes problems w touch\n            const leftPointerListener = new BB.PointerListener({\n                target: svgTriangleLeft,\n                onEnterLeave: (isOver) => {\n                    svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\n                },\n            });\n            const rightPointerListener = new BB.PointerListener({\n                target: svgTriangleRight,\n                onEnterLeave: (isOver) => {\n                    svgTriangleRight.classList.toggle(\n                        'toolspace-svg-triangle-button-hover',\n                        isOver,\n                    );\n                },\n            });\n\n            svg.append(defs, svgTriangleLeft, svgTriangleRight);\n            result.append(svg);\n\n            const leftIm = BB.el({\n                parent: result,\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: \"url('\" + p.leftImage + \"')\",\n                    backgroundRepeat: 'no-repeat',\n                    backgroundSize: 'contain',\n                    width: '20px',\n                    height: '20px',\n                    position: 'absolute',\n                    left: '10px',\n                    top: '8px',\n                    //transform: p.doMirror ? 'scale(-1, 1)' : '',\n                    pointerEvents: 'none',\n                },\n            });\n            result.append(leftIm);\n\n            const rightIm = BB.el({\n                parent: result,\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: \"url('\" + (p.rightImage ? p.rightImage : p.leftImage) + \"')\",\n                    backgroundRepeat: 'no-repeat',\n                    backgroundSize: 'contain',\n                    width: '20px',\n                    height: '20px',\n                    position: 'absolute',\n                    right: '10px',\n                    bottom: '8px',\n                    transform: p.rightImage ? '' : 'scale(-1, 1)',\n                    pointerEvents: 'none',\n                },\n            });\n\n            const setIsEnabledLeft = (b: boolean) => {\n                svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\n                leftIm.classList.toggle('toolspace-row-button-disabled', !b);\n            };\n\n            const setIsEnabledRight = (b: boolean) => {\n                svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\n                rightIm.classList.toggle('toolspace-row-button-disabled', !b);\n            };\n\n            return {\n                el: result,\n                setIsEnabledLeft,\n                setIsEnabledRight,\n                leftPointerListener,\n                rightPointerListener,\n            };\n        };\n\n        this.toolDropdown = new ToolDropdown({\n            onChange: (activeStr) => {\n                this.setActive(activeStr, true);\n            },\n        });\n        this.rootEl.append(this.toolDropdown.getElement());\n\n        this.handButton = createButton({\n            onClick: () => {\n                this.setActive('hand', true);\n            },\n            image: toolHandImg,\n            contain: true,\n            doLighten: true,\n        });\n        this.handButton.el.classList.add('kl-tool-row-border-right');\n        this.handButton.el.title = LANG('tool-hand');\n        this.rootEl.append(this.handButton.el);\n\n        this.zoomInNOutButton = createTriangleButton({\n            onLeft: p.onZoomIn,\n            onRight: p.onZoomOut,\n            leftImage: toolZoomInImg,\n            rightImage: toolZoomOutImg,\n        });\n        this.zoomInNOutButton.el.title = LANG('tool-zoom');\n        this.rootEl.append(this.zoomInNOutButton.el);\n\n        this.zoomInButton = createButton({\n            onClick: p.onZoomIn,\n            image: toolZoomInImg,\n            contain: true,\n        });\n        this.zoomInButton.el.title = LANG('zoom-in');\n        this.rootEl.append(this.zoomInButton.el);\n\n        this.zoomOutButton = createButton({\n            onClick: p.onZoomOut,\n            image: toolZoomOutImg,\n            contain: true,\n        });\n        this.zoomOutButton.el.title = LANG('zoom-out');\n        this.rootEl.append(this.zoomOutButton.el);\n\n        this.undoNRedoButton = createTriangleButton({\n            onLeft: p.onUndo,\n            onRight: p.onRedo,\n            leftImage: toolUndoImg,\n            rightImage: null,\n        });\n        this.undoNRedoButton.el.title = LANG('undo') + '/' + LANG('redo');\n        this.undoNRedoButton.setIsEnabledLeft(false);\n        this.undoNRedoButton.setIsEnabledRight(false);\n        this.rootEl.append(this.undoNRedoButton.el);\n\n        this.undoButton = createButton({\n            onClick: p.onUndo,\n            image: toolUndoImg,\n            contain: true,\n        });\n        this.undoButton.el.title = LANG('undo');\n        this.undoButton.el.classList.add('toolspace-row-button-disabled');\n        this.rootEl.append(this.undoButton.el);\n\n        this.redoButton = createButton({\n            onClick: p.onRedo,\n            image: toolUndoImg,\n            contain: true,\n            doMirror: true,\n        });\n        this.redoButton.el.title = LANG('redo');\n        this.redoButton.el.classList.add('toolspace-row-button-disabled');\n        this.rootEl.append(this.redoButton.el);\n\n        this.zoomInButton.el.style.display = 'none';\n        this.zoomOutButton.el.style.display = 'none';\n        this.undoButton.el.style.display = 'none';\n        this.redoButton.el.style.display = 'none';\n    }\n\n    // ---- interface ----\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsSmall(b: boolean): void {\n        css(this.rootEl, {\n            height: b ? '36px' : '54px',\n        });\n\n        this.toolDropdown.setIsSmall(b);\n        this.handButton.setIsSmall(b);\n        this.zoomInButton.setIsSmall(b);\n        this.zoomOutButton.setIsSmall(b);\n        this.undoButton.setIsSmall(b);\n        this.redoButton.setIsSmall(b);\n\n        if (b) {\n            this.zoomInNOutButton.el.style.display = 'none';\n            this.undoNRedoButton.el.style.display = 'none';\n            this.zoomInButton.el.style.display = 'block';\n            this.zoomOutButton.el.style.display = 'block';\n            this.undoButton.el.style.display = 'block';\n            this.redoButton.el.style.display = 'block';\n        } else {\n            this.zoomInNOutButton.el.style.display = 'block';\n            this.undoNRedoButton.el.style.display = 'block';\n            this.zoomInButton.el.style.display = 'none';\n            this.zoomOutButton.el.style.display = 'none';\n            this.undoButton.el.style.display = 'none';\n            this.redoButton.el.style.display = 'none';\n        }\n    }\n\n    setEnableZoomIn(b: boolean): void {\n        this.zoomInButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.zoomInNOutButton.setIsEnabledLeft(b);\n    }\n\n    setEnableZoomOut(b: boolean): void {\n        this.zoomOutButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.zoomInNOutButton.setIsEnabledRight(b);\n    }\n\n    setEnableUndo(b: boolean): void {\n        this.undoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.undoNRedoButton.setIsEnabledLeft(b);\n    }\n\n    setEnableRedo(b: boolean): void {\n        this.redoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.undoNRedoButton.setIsEnabledRight(b);\n    }\n\n    setActive(activeStr: TToolType, doEmit?: boolean): void {\n        if (this.currentActiveStr === activeStr) {\n            return;\n        }\n\n        this.currentActiveStr = activeStr;\n\n        this.toolDropdown.setActive(this.currentActiveStr);\n        this.handButton.el.classList.toggle(\n            'toolspace-row-button-activated',\n            this.currentActiveStr === 'hand',\n        );\n\n        if (doEmit) {\n            this.onActivate(this.currentActiveStr);\n        }\n    }\n\n    getActive(): TToolType {\n        return this.currentActiveStr;\n    }\n}\n","module.exports = parcelRequire.resolve(\"tool-undo.885233fb.svg\") + \"?\" + Date.now();","import { BB } from '../../../bb/bb';\nimport { Select } from './select';\nimport { LANG } from '../../../language/language';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\n\n/**\n * Ui to select stabilizer level. 4 options. returned as 0-3\n */\nexport class ToolspaceStabilizerRow {\n    private readonly rootEl: HTMLElement;\n    private readonly pointerListener: PointerListener;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        smoothing: number; // initial level [0,3]\n        onSelect: (level: number) => void; // [0-3], when level changes\n    }) {\n        this.rootEl = BB.el({\n            tagName: 'label',\n            className: 'kl-stabilizer',\n            content: LANG('stabilizer') + '&nbsp;',\n            title: LANG('stabilizer-title'),\n        });\n\n        const strengthSelect = new Select({\n            optionArr: [\n                ['0', '0'],\n                ['1', '1'],\n                ['2', '2'],\n                ['3', '3'],\n                ['4', '4'],\n                ['5', '5'],\n            ],\n            initValue: '' + p.smoothing,\n            onChange: function (val) {\n                p.onSelect(parseInt(val));\n            },\n            name: 'stabilizer-strength',\n        });\n        this.rootEl.append(strengthSelect.getElement());\n\n        this.pointerListener = new BB.PointerListener({\n            target: this.rootEl,\n            onWheel: function (e) {\n                strengthSelect.setDeltaValue(e.deltaY);\n            },\n        });\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { css } from '../../../bb/base/base';\n\n// type all functions\n\ntype TTabInit = {\n    id: string; // e.g. 'draw',\n    label?: string;\n    image?: string; // background image\n    title?: string;\n    isVisible?: boolean; // default is true\n    onOpen: () => void;\n    onClose: () => void;\n    css?: Partial<CSSStyleDeclaration>;\n};\n\ntype TTab = {\n    id: string;\n    isVisible: boolean;\n    onOpen: () => void;\n    onClose: () => void;\n    update: (activeTab: TTab) => void;\n    el: HTMLElement;\n    pointerListener: PointerListener;\n};\n\n/**\n * row of tabs. uses css class .tabrow__tab\n */\nexport class TabRow {\n    private readonly rootEl: HTMLElement;\n    private readonly tabArr: TTab[];\n    private activeTab: TTab;\n    private readonly roundRight: HTMLElement;\n    private readonly roundLeft: HTMLElement;\n\n    // update\n    update(): void {\n        for (let i = 0; i < this.tabArr.length; i++) {\n            this.tabArr[i].update(this.activeTab);\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        initialId: string; // e.g. 'draw'\n        useAccent?: boolean;\n        tabArr: TTabInit[];\n        height?: number;\n    }) {\n        const height = p.height ?? 35;\n        this.rootEl = BB.el({\n            className: 'tabrow',\n            css: {\n                height: height + 1 + 'px',\n            },\n        });\n\n        this.tabArr = []; //creates its own internal arr\n\n        const roundSize = 10;\n        this.roundRight = BB.el({\n            className: 'tabrow__tab__rounding-left',\n        });\n        this.roundLeft = BB.el({\n            className: 'tabrow__tab__rounding-right',\n        });\n\n        const createTab = (pTabObj: TTabInit, initialId: string, useAccent: boolean): TTab => {\n            const isVisible =\n                'isVisible' in pTabObj && pTabObj.isVisible !== undefined\n                    ? pTabObj.isVisible\n                    : true;\n            const result: TTab = {\n                id: pTabObj.id,\n                isVisible: isVisible,\n                onOpen: pTabObj.onOpen,\n                onClose: pTabObj.onClose,\n                update: (openedTabObj: TTab) => {\n                    result.el.className =\n                        openedTabObj === result\n                            ? useAccent\n                                ? 'tabrow__tab tabrow__tab--opened-accented'\n                                : 'tabrow__tab tabrow__tab--opened'\n                            : 'tabrow__tab';\n                    result.el.style.display = result.isVisible ? 'block' : 'none';\n                },\n                el: BB.el({\n                    parent: this.rootEl,\n                    content: 'label' in pTabObj ? pTabObj.label : '',\n                    title: 'title' in pTabObj ? pTabObj.title : undefined,\n                    className:\n                        initialId === pTabObj.id\n                            ? useAccent\n                                ? 'tabrow__tab tabrow__tab--opened-accented'\n                                : 'tabrow__tab tabrow__tab--opened'\n                            : 'tabrow__tab',\n                    css: {\n                        lineHeight: height + 'px',\n                        display: isVisible ? 'block' : 'none',\n                    },\n                    onClick: () => {\n                        if (this.activeTab === result) {\n                            return;\n                        }\n                        this.open(result.id);\n                    },\n                }),\n                pointerListener: {} as PointerListener,\n            };\n            if ('image' in pTabObj) {\n                BB.el({\n                    tagName: 'span',\n                    parent: result.el,\n                    className: 'dark-invert',\n                    css: {\n                        backgroundImage: `url(\"${pTabObj.image}\")`,\n                        backgroundSize: 'contain',\n                        backgroundPosition: 'center',\n                        backgroundRepeat: 'no-repeat',\n                        display: 'flex',\n                        height: height - 7 + 'px',\n                        justifyContent: 'center',\n                        margin: '4px auto',\n                    },\n                });\n            }\n            if ('css' in pTabObj && pTabObj.css !== undefined) {\n                css(result.el, pTabObj.css);\n            }\n\n            result.pointerListener = new BB.PointerListener({\n                // because :hover causes problems w touch\n                target: result.el,\n                onEnterLeave: (isOver) => {\n                    result.el.classList.toggle('tabrow__tab-hover', isOver);\n                },\n            });\n\n            if (initialId === result.id) {\n                result.onOpen();\n                result.el.append(this.roundRight, this.roundLeft);\n            } else {\n                result.onClose();\n            }\n\n            return result;\n        };\n\n        let initTabObj = null;\n        for (let i = 0; i < p.tabArr.length; i++) {\n            const tab = createTab(p.tabArr[i], p.initialId, p.useAccent || false);\n            if (tab.id === p.initialId) {\n                initTabObj = tab;\n            }\n            this.tabArr.push(tab);\n        }\n        if (!initTabObj) {\n            throw 'invalid initialId';\n        }\n        this.activeTab = initTabObj;\n    }\n\n    // ---- interface ----\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    open(tabId: string): void {\n        for (let i = 0; i < this.tabArr.length; i++) {\n            if (this.tabArr[i].id === tabId) {\n                if (this.activeTab === this.tabArr[i]) {\n                    // already open\n                    return;\n                }\n                this.activeTab.onClose();\n                this.activeTab = this.tabArr[i];\n                this.activeTab.onOpen();\n                this.activeTab.el.append(this.roundRight, this.roundLeft);\n                this.update();\n                return;\n            }\n        }\n        throw 'TabRow.open - invalid tabId';\n    }\n\n    getOpenedTabId(): string {\n        return '' + this.activeTab.id;\n    }\n\n    setIsVisible(tabId: string, isVisible: boolean): void {\n        for (let i = 0; i < this.tabArr.length; i++) {\n            if (this.tabArr[i].id === tabId) {\n                this.tabArr[i].isVisible = isVisible;\n                this.update();\n                return;\n            }\n        }\n        throw 'TabRow.setIsVisible - invalid tabId';\n    }\n\n    destroy(): void {\n        this.tabArr.forEach((item) => {\n            BB.destroyEl(item.el);\n            item.pointerListener.destroy();\n        });\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport angleImg from 'url:/src/app/img/ui/angle.svg';\nimport rotateImg from 'url:/src/app/img/ui/edit-rotate.svg';\nimport { LANG } from '../../../language/language';\nimport { Checkbox } from '../components/checkbox';\nimport { LocalStorage } from '../../../bb/base/local-storage';\nimport { css } from '../../../bb/base/base';\nimport { makeUnfocusable } from '../../../bb/base/ui';\n\nconst LS_INERTIA_KEY = 'kl-inertia-scroll';\n\n/**\n * Ui, when hand tool tab is open.\n */\nexport class HandUi {\n    private readonly rootEl: HTMLElement;\n    private readonly onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\n    private isVisible: boolean = true;\n    private scale: number;\n    private angleDeg: number;\n    private readonly scaleEl: HTMLElement;\n    private readonly angleEl: HTMLElement;\n    private readonly angleIm: HTMLImageElement;\n\n    private updateUi(): void {\n        this.scaleEl.innerHTML = Math.round(this.scale * 100) + '%';\n        this.angleEl.innerHTML = Math.round(this.angleDeg) + '';\n\n        css(this.angleIm, {\n            transform: 'rotate(' + this.angleDeg + 'deg)',\n            boxShadow:\n                this.angleDeg % 90 === 0\n                    ? 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)'\n                    : '',\n        });\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: {\n        scale: number; // initial value\n        angleDeg: number; // initial value\n        onReset: () => void;\n        onFit: () => void;\n        onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\n        onChangeUseInertiaScrolling: (b: boolean) => void;\n    }) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.scale = p.scale;\n        this.angleDeg = p.angleDeg;\n        this.onAngleChange = p.onAngleChange;\n\n        const row1 = BB.el({\n            css: {\n                marginBottom: '10px',\n                display: 'flex',\n            },\n        });\n        const row2 = BB.el({\n            css: {\n                display: 'flex',\n                marginBottom: '10px',\n            },\n        });\n        const row3 = BB.el({\n            css: {\n                display: 'flex',\n            },\n        });\n        this.rootEl.append(row1, row2, row3);\n\n        this.scaleEl = BB.el({\n            css: {\n                width: '65px',\n                userSelect: 'none',\n                fontFamily: 'monospace',\n            },\n        });\n        row1.append(this.scaleEl);\n\n        this.angleIm = new Image();\n        this.angleIm.src = angleImg;\n        css(this.angleIm, {\n            verticalAlign: 'bottom',\n            width: '20px',\n            height: '20px',\n            marginRight: '5px',\n            borderRadius: '10px',\n            background: 'rgba(0,0,0,0.2)',\n            userSelect: 'none',\n        });\n        row1.append(this.angleIm);\n\n        this.angleEl = BB.el({\n            parent: row1,\n            css: {\n                userSelect: 'none',\n            },\n        });\n\n        this.updateUi();\n\n        const resetButton = BB.el({\n            tagName: 'button',\n            content: LANG('hand-reset'),\n            onClick: p.onReset,\n        });\n        makeUnfocusable(resetButton);\n\n        const fitButton = BB.el({\n            tagName: 'button',\n            content: LANG('hand-fit'),\n            css: {\n                marginLeft: '10px',\n            },\n            onClick: p.onFit,\n        });\n        makeUnfocusable(fitButton);\n        row2.append(resetButton, fitButton);\n\n        const leftRotateIcon = new Image();\n        leftRotateIcon.height = 20;\n        leftRotateIcon.src = rotateImg;\n        leftRotateIcon.alt = 'Rotate';\n        css(leftRotateIcon, {\n            transform: 'scale(-1, 1)',\n        });\n        const leftRotateButton = BB.el({\n            tagName: 'button',\n            content: leftRotateIcon,\n            onClick: function () {\n                p.onAngleChange(-15, true);\n            },\n        });\n        makeUnfocusable(leftRotateButton);\n\n        const resetAngleButton = BB.el({\n            tagName: 'button',\n            content: '0',\n            css: {\n                marginLeft: '10px',\n            },\n            onClick: function () {\n                p.onAngleChange(0);\n            },\n        });\n        makeUnfocusable(resetAngleButton);\n\n        const rightRotateButton = BB.el({\n            tagName: 'button',\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\n            css: {\n                marginLeft: '10px',\n            },\n            onClick: function () {\n                p.onAngleChange(15, true);\n            },\n        });\n        makeUnfocusable(rightRotateButton);\n        row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\n\n        const inertiaToggle = new Checkbox({\n            label: LANG('hand-inertia-scrolling'),\n            init: LocalStorage.getItem(LS_INERTIA_KEY) === 'true',\n            callback: (b) => {\n                LocalStorage.setItem(LS_INERTIA_KEY, '' + b);\n                p.onChangeUseInertiaScrolling(b);\n            },\n            name: 'enable-inertia-scrolling',\n        });\n        setTimeout(() => {\n            p.onChangeUseInertiaScrolling(inertiaToggle.getValue());\n        }, 500);\n        css(inertiaToggle.getElement(), {\n            marginTop: '10px',\n            display: 'inline-block',\n        });\n        this.rootEl.append(inertiaToggle.getElement());\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible(pIsVisible: boolean): void {\n        this.isVisible = pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.updateUi();\n        }\n    }\n\n    update(pScale: number, pAngleDeg: number): void {\n        this.scale = pScale;\n        this.angleDeg = pAngleDeg;\n        if (this.isVisible) {\n            this.updateUi();\n        }\n    }\n}\n","module.exports = parcelRequire.resolve(\"edit-rotate.0bf5c419.svg\") + \"?\" + Date.now();","import { BB } from '../../../bb/bb';\nimport { KlSlider } from '../components/kl-slider';\nimport { Select } from '../components/select';\nimport { Checkbox } from '../components/checkbox';\nimport { LANG } from '../../../language/language';\nimport { TFillSampling } from '../../kl-types';\nimport { KlColorSlider } from '../components/kl-color-slider';\nimport { css } from '../../../bb/base/base';\n\n/**\n * Paint Bucket tab contents (color slider, opacity slider, etc)\n */\nexport class FillUi {\n    private readonly rootEl: HTMLElement;\n    private isVisible: boolean;\n    private readonly colorDiv: HTMLElement;\n    private readonly colorSlider: KlColorSlider;\n    private readonly toleranceSlider: KlSlider;\n    private readonly opacitySlider: KlSlider;\n    private readonly modeSelect: Select<string>;\n    private readonly growSelect: Select<string>;\n    private isContiguous: boolean;\n    private readonly eraserToggle: Checkbox;\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: {\n        colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n    }) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.isVisible = true;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        this.colorSlider = p.colorSlider;\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 250,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: 1,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n        });\n        this.rootEl.append(this.opacitySlider.getElement());\n\n        this.toleranceSlider = new KlSlider({\n            label: LANG('bucket-tolerance'),\n            width: 250,\n            height: 30,\n            min: 0,\n            max: 255,\n            value: 20 * (255 / 100),\n            toValue: (displayValue) => displayValue * (255 / 100),\n            toDisplayValue: (value) => value / (255 / 100),\n        });\n        css(this.toleranceSlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(this.toleranceSlider.getElement());\n\n        const selectRow = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                marginTop: '10px',\n            },\n        });\n\n        const modeWrapper = BB.el({\n            content: LANG('bucket-sample') + '&nbsp;',\n            title: LANG('bucket-sample-title'),\n            css: {\n                fontSize: '15px',\n            },\n        });\n        this.modeSelect = new Select({\n            optionArr: [\n                ['all', LANG('bucket-sample-all')],\n                ['current', LANG('bucket-sample-active')],\n                ['above', LANG('bucket-sample-above')],\n            ],\n            initValue: 'all',\n            name: 'sampling-mode',\n        });\n        const modePointerListener = new BB.PointerListener({\n            target: this.modeSelect.getElement(),\n            onWheel: (e) => {\n                this.modeSelect.setDeltaValue(e.deltaY);\n            },\n        });\n        modeWrapper.append(this.modeSelect.getElement());\n        selectRow.append(modeWrapper);\n\n        const growWrapper = BB.el({\n            content: LANG('bucket-grow') + '&nbsp;',\n            title: LANG('bucket-grow-title'),\n            css: {\n                fontSize: '15px',\n                marginLeft: '10px',\n            },\n        });\n        this.growSelect = new Select({\n            optionArr: [\n                ['0', '0'],\n                ['1', '1'],\n                ['2', '2'],\n                ['3', '3'],\n                ['4', '4'],\n                ['5', '5'],\n                ['6', '6'],\n                ['7', '7'],\n            ],\n            initValue: '0',\n            name: 'fill-growth',\n        });\n        const growPointerListener = new BB.PointerListener({\n            target: this.growSelect.getElement(),\n            onWheel: (e) => {\n                this.growSelect.setDeltaValue(e.deltaY);\n            },\n        });\n        growWrapper.append(this.growSelect.getElement());\n        selectRow.append(growWrapper);\n\n        this.isContiguous = true;\n        const contiguousToggle = new Checkbox({\n            init: true,\n            label: LANG('bucket-contiguous'),\n            title: LANG('bucket-contiguous-title'),\n            callback: (b) => {\n                this.isContiguous = b;\n            },\n            name: 'is-contiguous',\n        });\n\n        this.eraserToggle = new Checkbox({\n            init: false,\n            label: LANG('eraser'),\n            name: 'eraser-toggle',\n        });\n\n        this.rootEl.append(\n            BB.el({\n                content: [contiguousToggle.getElement(), this.eraserToggle.getElement()],\n                css: {\n                    display: 'flex',\n                    marginTop: '10px',\n                    gap: '10px',\n                },\n            }),\n        );\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible(pIsVisible: boolean): void {\n        this.isVisible = pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.colorDiv.append(\n                this.colorSlider.getElement(),\n                this.colorSlider.getOutputElement(),\n            );\n        }\n    }\n\n    /**\n     * [0, 1]\n     */\n    getTolerance(): number {\n        // slider may display 0 when value is 1 -> avoid confusing users\n        if (Math.round(this.toleranceSlider.getDisplayValue()) === 0) {\n            return 0;\n        }\n        return this.toleranceSlider.getValue();\n    }\n\n    getOpacity(): number {\n        return this.opacitySlider.getValue();\n    }\n\n    getSample(): TFillSampling {\n        return this.modeSelect.getValue() as TFillSampling;\n    }\n\n    getGrow(): number {\n        return parseInt(this.growSelect.getValue(), 10);\n    }\n\n    getContiguous(): boolean {\n        return this.isContiguous;\n    }\n\n    getIsEraser(): boolean {\n        return this.eraserToggle.getValue();\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { LANG } from '../../../language/language';\nimport { KlColorSlider } from '../components/kl-color-slider';\n\n/**\n * Text Tool tab contents (color slider)\n */\nexport class TextUi {\n    private readonly rootEl: HTMLElement;\n    private readonly colorDiv: HTMLElement;\n    private isVisible: boolean = true;\n    private readonly colorSlider: KlColorSlider;\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: {\n        colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n    }) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.colorSlider = p.colorSlider;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        const hint = BB.el({\n            parent: this.rootEl,\n            content: LANG('text-instruction'),\n        });\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible(pIsVisible: boolean): void {\n        this.isVisible = pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.colorDiv.append(\n                this.colorSlider.getElement(),\n                this.colorSlider.getOutputElement(),\n            );\n        }\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { Options } from '../components/options';\nimport { Checkbox } from '../components/checkbox';\nimport { KlSlider } from '../components/kl-slider';\nimport { LANG } from '../../../language/language';\nimport { TShapeToolMode, TShapeToolType } from '../../kl-types';\nimport { KlColorSlider } from '../components/kl-color-slider';\nimport { css } from '../../../bb/base/base';\n\n/**\n * Shape Tool tab contents\n */\nexport class ShapeUi {\n    private readonly rootEl: HTMLElement;\n    private isVisible: boolean;\n    private readonly colorDiv: HTMLElement;\n    private readonly colorSlider: KlColorSlider;\n    private shape: TShapeToolType = 'rect';\n    private mode: TShapeToolMode = 'stroke';\n    private readonly eraserToggle: Checkbox;\n    private readonly opacitySlider: KlSlider;\n    private readonly lineWidthSlider: KlSlider;\n    private readonly outwardsToggle: Checkbox;\n    private readonly fixedToggle: Checkbox;\n    private readonly snapToggle: Checkbox;\n    private readonly lockAlphaToggle: Checkbox;\n    private readonly panningToggle: Checkbox;\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: {\n        colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n        onChangePanning: (doPan: boolean) => void;\n    }) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.isVisible = true;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        this.colorSlider = p.colorSlider;\n\n        const previewSize = 35;\n        const previewPadding = 8;\n\n        const rectStrokeSvgRect = BB.createSvg({\n            elementType: 'rect',\n            x: '' + previewPadding,\n            width: '' + (previewSize - previewPadding * 2),\n        });\n        const rectStrokeSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        rectStrokeSvg.classList.add('dark-invert');\n        rectStrokeSvg.append(rectStrokeSvgRect);\n        css(rectStrokeSvg, {\n            display: 'block',\n        });\n\n        const rectFilledSvgRect = BB.createSvg({\n            elementType: 'rect',\n            x: '' + previewPadding,\n            width: '' + (previewSize - previewPadding * 2),\n        });\n        const rectFilledSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        rectFilledSvg.classList.add('dark-invert');\n        rectFilledSvg.append(rectFilledSvgRect);\n        css(rectFilledSvg, {\n            display: 'block',\n        });\n\n        const ellipseStrokeSvgEllipse = BB.createSvg({\n            elementType: 'ellipse',\n            cx: '' + previewSize / 2,\n            cy: '' + previewSize / 2,\n            rx: '' + (previewSize / 2 - previewPadding),\n        });\n        const ellipseStrokeSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        ellipseStrokeSvg.classList.add('dark-invert');\n        ellipseStrokeSvg.append(ellipseStrokeSvgEllipse);\n        css(ellipseStrokeSvg, {\n            display: 'block',\n        });\n\n        const ellipseFilledSvgEllipse = BB.createSvg({\n            elementType: 'ellipse',\n            cx: '' + previewSize / 2,\n            cy: '' + previewSize / 2,\n            rx: '' + (previewSize / 2 - previewPadding),\n        });\n        const ellipseFilledSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        ellipseFilledSvg.classList.add('dark-invert');\n        ellipseFilledSvg.append(ellipseFilledSvgEllipse);\n        css(ellipseFilledSvg, {\n            display: 'block',\n        });\n\n        const lineSvgLine = BB.createSvg({\n            elementType: 'line',\n            x1: '' + previewPadding,\n            x2: '' + (previewSize - previewPadding),\n        });\n        const lineSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        lineSvg.classList.add('dark-invert');\n        lineSvg.append(lineSvgLine);\n        css(lineSvg, {\n            display: 'block',\n        });\n\n        const updatePreviews = () => {\n            const strokeWidth =\n                BB.clamp(Math.round(this.lineWidthSlider.getValue() / 10), 1, 10) + 'px';\n\n            const squish = 1.35;\n\n            css(rectStrokeSvgRect, {\n                fill: 'none',\n                stroke: 'black',\n                strokeWidth: strokeWidth,\n            });\n            css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\n\n            css(ellipseStrokeSvgEllipse, {\n                fill: 'none',\n                stroke: 'black',\n                strokeWidth: strokeWidth,\n            });\n            css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\n\n            css(lineSvgLine, {\n                fill: 'none',\n                stroke: 'black',\n                strokeWidth: strokeWidth,\n            });\n\n            if (this.fixedToggle.getValue()) {\n                rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n                rectFilledSvgRect.setAttribute('y', '' + previewPadding);\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n            } else {\n                rectStrokeSvgRect.setAttribute('y', '' + previewPadding * squish);\n                rectStrokeSvgRect.setAttribute(\n                    'height',\n                    '' + (previewSize - previewPadding * squish * 2),\n                );\n                rectFilledSvgRect.setAttribute('y', '' + previewPadding * squish);\n                rectFilledSvgRect.setAttribute(\n                    'height',\n                    '' + (previewSize - previewPadding * squish * 2),\n                );\n\n                ellipseStrokeSvgEllipse.setAttribute(\n                    'ry',\n                    '' + (previewSize / 2 - previewPadding * squish),\n                );\n                ellipseFilledSvgEllipse.setAttribute(\n                    'ry',\n                    '' + (previewSize / 2 - previewPadding * squish),\n                );\n            }\n\n            if (this.snapToggle.getValue()) {\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\n                lineSvgLine.setAttribute('y2', '' + previewPadding);\n            } else {\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\n                lineSvgLine.setAttribute('y2', '' + previewPadding * squish);\n            }\n        };\n\n        const row1 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'start',\n            },\n        });\n\n        const shapeOptions = new Options({\n            optionArr: [\n                {\n                    id: 'rect-stroke',\n                    label: rectStrokeSvg,\n                    title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\n                },\n                {\n                    id: 'ellipse-stroke',\n                    label: ellipseStrokeSvg,\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\n                },\n                {\n                    id: 'line',\n                    label: lineSvg,\n                    title: LANG('shape-line'),\n                },\n                {\n                    id: 'rect-fill',\n                    label: rectFilledSvg,\n                    title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\n                },\n                {\n                    id: 'ellipse-fill',\n                    label: ellipseFilledSvg,\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\n                },\n            ],\n            initId: this.shape + ' ' + this.mode,\n            onChange: (id) => {\n                const split = id.split('-');\n                this.shape = split[0] as TShapeToolType;\n                this.mode = split[1] as TShapeToolMode;\n\n                css(this.fixedToggle.getElement(), {\n                    display: this.shape === 'line' ? 'none' : '',\n                });\n                css(this.snapToggle.getElement(), {\n                    display: this.shape === 'line' ? '' : 'none',\n                });\n                css(this.lineWidthSlider.getElement(), {\n                    display: this.shape !== 'line' && this.mode === 'fill' ? 'none' : '',\n                });\n            },\n            changeOnInit: true,\n            css: {\n                width: '120px',\n            },\n        });\n        row1.append(shapeOptions.getElement());\n\n        this.eraserToggle = new Checkbox({\n            init: false,\n            label: LANG('eraser'),\n            callback: () => {\n                updatePreviews();\n            },\n            name: 'enable-eraser',\n        });\n\n        this.lockAlphaToggle = new Checkbox({\n            init: false,\n            label: LANG('lock-alpha'),\n            title: LANG('lock-alpha-title'),\n            doHighlight: true,\n            name: 'enable-alpha-lock',\n        });\n        this.lockAlphaToggle.getElement().style.marginTop = '10px';\n\n        this.panningToggle = new Checkbox({\n            init: false,\n            label: LANG('shape-auto-pan'),\n            title: LANG('shape-auto-pan-title'),\n            callback: (b) => p.onChangePanning(b),\n            name: 'enable-auto-pan',\n        });\n        this.panningToggle.getElement().style.marginTop = '10px';\n\n        row1.append(\n            BB.el({\n                content: [\n                    this.eraserToggle.getElement(),\n                    this.lockAlphaToggle.getElement(),\n                    this.panningToggle.getElement(),\n                ],\n            }),\n        );\n\n        this.lineWidthSlider = new KlSlider({\n            label: LANG('shape-line-width'),\n            width: 250,\n            height: 30,\n            min: 1,\n            max: 200,\n            value: 4,\n            curve: 'quadratic',\n            onChange: () => {\n                updatePreviews();\n            },\n        });\n        css(this.lineWidthSlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(this.lineWidthSlider.getElement());\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 250,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: 1,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n        });\n        css(this.opacitySlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(this.opacitySlider.getElement());\n\n        const row2 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n                gap: '10px',\n            },\n        });\n\n        this.outwardsToggle = new Checkbox({\n            init: false,\n            label: LANG('shape-outwards'),\n            name: 'enable-outwards',\n        });\n        row2.append(this.outwardsToggle.getElement());\n\n        this.fixedToggle = new Checkbox({\n            init: false,\n            label: LANG('shape-fixed'),\n            callback: () => {\n                updatePreviews();\n            },\n            name: 'enable-fixed-proportions',\n        });\n        row2.append(this.fixedToggle.getElement());\n\n        this.snapToggle = new Checkbox({\n            init: false,\n            label: LANG('angle-snap'),\n            title: LANG('angle-snap-title'),\n            callback: () => {\n                updatePreviews();\n            },\n            name: 'enable-angle-snapping',\n        });\n        row2.append(this.snapToggle.getElement());\n\n        updatePreviews();\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible(pIsVisible: boolean): void {\n        this.isVisible = pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.colorDiv.append(this.colorSlider.getElement());\n            this.colorDiv.append(this.colorSlider.getOutputElement());\n            //update();\n        }\n    }\n\n    getShape(): TShapeToolType {\n        return this.shape;\n    }\n\n    getMode(): TShapeToolMode {\n        return this.mode;\n    }\n\n    getIsEraser(): boolean {\n        return this.eraserToggle.getValue();\n    }\n\n    getOpacity(): number {\n        return this.opacitySlider.getValue();\n    }\n\n    getLineWidth(): number {\n        return this.lineWidthSlider.getValue();\n    }\n\n    getIsOutwards(): boolean {\n        return this.outwardsToggle.getValue();\n    }\n\n    getIsFixed(): boolean {\n        return this.fixedToggle.getValue();\n    }\n\n    getIsSnap(): boolean {\n        return this.snapToggle.getValue();\n    }\n\n    getDoLockAlpha(): boolean {\n        return this.lockAlphaToggle.getValue();\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { Select } from '../components/select';\nimport { ColorOptions } from '../components/color-options';\nimport { showModal } from './base/showModal';\nimport { LANG } from '../../../language/language';\nimport { TRgb, TRgba } from '../../kl-types';\nimport { TSize2D } from '../../../bb/bb-types';\nimport { table } from '../components/table';\nimport { css } from '../../../bb/base/base';\n\nexport function newImageDialog(p: {\n    currentColor: TRgb; // current color\n    secondaryColor: TRgb;\n    maxCanvasSize: number;\n    canvasWidth: number; // current canvas size\n    canvasHeight: number; // current canvas size\n    workspaceWidth: number;\n    workspaceHeight: number;\n    onConfirm: (width: number, height: number, color: TRgba) => void;\n    onCancel: () => void;\n}): void {\n    const currentColor = p.currentColor;\n    const secondaryColor = p.secondaryColor;\n    const maxCanvasSize = p.maxCanvasSize;\n    const canvasWidth = p.canvasWidth;\n    const canvasHeight = p.canvasHeight;\n    const workspaceWidth = p.workspaceWidth;\n    const workspaceHeight = p.workspaceHeight;\n    const onConfirm = p.onConfirm;\n    const onCancel = p.onCancel;\n\n    function createRatioSize(\n        ratioX: number,\n        ratioY: number,\n        width: number,\n        height: number,\n        padding: number,\n    ): TSize2D {\n        return BB.fitInto(\n            ratioX,\n            ratioY,\n            Math.min(maxCanvasSize, width - padding),\n            Math.min(maxCanvasSize, height - padding),\n            1,\n        );\n    }\n\n    const newImDiv = BB.el();\n    const widthInput = BB.el({ tagName: 'input', custom: { name: 'image-width' } });\n    const unitStyle = {\n        color: '#888',\n        fontSize: '12px',\n        marginLeft: '5px',\n    };\n    const widthUnit = BB.el({\n        textContent: LANG('new-px'),\n        css: unitStyle,\n    });\n    const heightInput = BB.el({ tagName: 'input', custom: { name: 'image-height' } });\n    const heightUnit = BB.el({\n        textContent: LANG('new-px'),\n        css: unitStyle,\n    });\n\n    widthInput.setAttribute('data-ignore-focus', 'true');\n    heightInput.setAttribute('data-ignore-focus', 'true');\n\n    widthInput.type = 'number';\n    widthInput.min = '1';\n    widthInput.max = '' + maxCanvasSize;\n    css(widthInput, {\n        width: '70px',\n    });\n\n    heightInput.type = 'number';\n    heightInput.min = '1';\n    heightInput.max = '' + maxCanvasSize;\n    heightInput.style.width = '70px';\n    widthInput.value = '' + canvasWidth;\n    heightInput.value = '' + canvasHeight;\n    widthInput.onclick = (): void => {\n        widthInput.focus();\n        updateRatio();\n    };\n    heightInput.onclick = (): void => {\n        heightInput.focus();\n        updateRatio();\n    };\n\n    const sizeTable = table([\n        [LANG('width') + ':&nbsp;', widthInput, widthUnit],\n        [BB.el({ css: { height: '5px' } }), '', ''],\n        [LANG('height') + ':&nbsp;', heightInput, heightUnit],\n    ]);\n    css(sizeTable, {\n        marginBottom: '10px',\n    });\n\n    const ratioWrapper = BB.el({\n        css: {\n            marginTop: '5px',\n            color: '#888',\n        },\n    });\n\n    const templateWrapper = BB.el({\n        css: {\n            display: 'flex',\n            flexWrap: 'wrap',\n            gap: '5px',\n            marginBottom: '10px',\n        },\n    });\n    const presetBtnConfig = { tagName: 'button', css: { flexGrow: '1' } } as const;\n    const presetFitBtn = BB.el(presetBtnConfig);\n    const presetCurrentBtn = BB.el(presetBtnConfig);\n    const presetSquareBtn = BB.el(presetBtnConfig);\n    const presetLandscapeBtn = BB.el(presetBtnConfig);\n    const presetPortraitBtn = BB.el(presetBtnConfig);\n    const presetOversizeBtn = BB.el(presetBtnConfig);\n\n    presetCurrentBtn.textContent = LANG('new-current');\n    presetFitBtn.textContent = LANG('new-fit');\n    presetOversizeBtn.textContent = LANG('new-oversize');\n    presetLandscapeBtn.textContent = LANG('new-landscape');\n    presetPortraitBtn.textContent = LANG('new-portrait');\n    presetSquareBtn.textContent = LANG('new-square');\n\n    templateWrapper.append(\n        presetCurrentBtn,\n        presetFitBtn,\n        presetOversizeBtn,\n        presetSquareBtn,\n        presetLandscapeBtn,\n        presetPortraitBtn,\n    );\n\n    const templatePadding = 0;\n\n    presetCurrentBtn.onclick = function (): void {\n        widthInput.value = '' + canvasWidth;\n        heightInput.value = '' + canvasHeight;\n        updateRatio();\n    };\n    presetFitBtn.onclick = function (): void {\n        widthInput.value = '' + workspaceWidth;\n        heightInput.value = '' + workspaceHeight;\n        updateRatio();\n    };\n    presetOversizeBtn.onclick = function (): void {\n        widthInput.value = '' + (workspaceWidth + 500);\n        heightInput.value = '' + (workspaceHeight + 500);\n        updateRatio();\n    };\n    presetSquareBtn.onclick = function (): void {\n        const sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetLandscapeBtn.onclick = function (): void {\n        const sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetPortraitBtn.onclick = function (): void {\n        const sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n\n    const select = new Select({\n        isFocusable: true,\n        optionArr: [\n            ['screen', LANG('new-screen')],\n            ['16 9', LANG('new-video') + ' 16:9'],\n            ['3 2', '3:2'],\n            ['5 3', '5:3'],\n            ['2 1', '2:1'],\n            ['paper', LANG('new-din-paper') + ' 2:1'],\n            ['9 16', '9:16'],\n            ['2 3', '2:3'],\n            ['3 5', '3:5'],\n            ['1 2', '1:2'],\n            ['1 1.4142135623730951', '1:2'],\n        ],\n        onChange: function (val): void {\n            if (val === 'screen') {\n                widthInput.value = '' + window.screen.width;\n                heightInput.value = '' + window.screen.height;\n            } else if (val === 'paper') {\n                const sizeObj = createRatioSize(\n                    Math.sqrt(2),\n                    1,\n                    workspaceWidth,\n                    workspaceHeight,\n                    templatePadding,\n                );\n                widthInput.value = '' + Math.round(sizeObj.width);\n                heightInput.value = '' + Math.round(sizeObj.height);\n            } else {\n                const split = val.split(' ');\n                const sizeObj = createRatioSize(\n                    parseFloat(split[0]),\n                    parseFloat(split[1]),\n                    workspaceWidth,\n                    workspaceHeight,\n                    templatePadding,\n                );\n                widthInput.value = '' + Math.round(sizeObj.width);\n                heightInput.value = '' + Math.round(sizeObj.height);\n            }\n            updateRatio();\n            select.setValue(undefined);\n        },\n        name: 'image-format',\n    });\n    setTimeout(() => {\n        // safari: not empty without also setting it to null via timeout\n        select.setValue(undefined);\n    }, 0);\n    css(select.getElement(), {\n        width: '80px',\n        flexGrow: '1',\n    });\n    templateWrapper.append(select.getElement());\n\n    let backgroundRgba = { r: 255, g: 255, b: 255, a: 1 };\n\n    const colorOptionsArr = [\n        { r: 255, g: 255, b: 255, a: 1 },\n        { r: 0, g: 0, b: 0, a: 1 },\n        { r: 0, g: 0, b: 0, a: 0 },\n        {\n            r: currentColor.r,\n            g: currentColor.g,\n            b: currentColor.b,\n            a: 1,\n        },\n        {\n            r: secondaryColor.r,\n            g: secondaryColor.g,\n            b: secondaryColor.b,\n            a: 1,\n        },\n    ];\n\n    const colorOptions = new ColorOptions({\n        colorArr: colorOptionsArr,\n        initialIndex: 0,\n        onChange: function (rgbaObj): void {\n            backgroundRgba = rgbaObj!;\n            preview.style.backgroundColor =\n                'rgba(' +\n                rgbaObj!.r +\n                ',' +\n                rgbaObj!.g +\n                ',' +\n                rgbaObj!.b +\n                ', ' +\n                rgbaObj!.a +\n                ')';\n        },\n    });\n\n    const previewWrapper = BB.el({\n        className: 'kl-transparent-preview',\n        css: {\n            boxSizing: 'border-box',\n            width: '340px',\n            height: '140px',\n            display: 'table',\n            padding: '10px',\n            marginTop: '10px',\n            marginLeft: '-20px',\n            background: 'var(--kl-checkerboard-background)',\n        },\n    });\n    const preview = BB.el({\n        className: 'kl-transparent-preview__canvas',\n        css: {\n            width: 200 + 'px',\n            height: 100 + 'px',\n            backgroundColor:\n                'rgba(' +\n                backgroundRgba.r +\n                ',' +\n                backgroundRgba.g +\n                ',' +\n                backgroundRgba.b +\n                ', ' +\n                backgroundRgba.a +\n                ')',\n            marginLeft: 'auto',\n            marginRight: 'auto',\n            color: '#aaa',\n            fontSize: '16px',\n            fontWeight: 'bold',\n            textAlign: 'center',\n            verticalAlign: 'center',\n            display: 'table',\n            overflow: 'hidden',\n        },\n    });\n    BB.el({\n        parent: previewWrapper,\n        content: preview,\n        css: {\n            display: 'table-cell',\n            verticalAlign: 'middle',\n        },\n    });\n    BB.el({\n        parent: preview,\n        css: {\n            display: 'table-cell',\n            verticalAlign: 'middle',\n        },\n    });\n\n    function updateRatio(): void {\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\n\n        function hcf(u: number, v: number): number {\n            let U = u,\n                V = v;\n\n            while (true) {\n                if (!(U %= V)) {\n                    return V;\n                }\n                if (!(V %= U)) {\n                    return U;\n                }\n            }\n        }\n\n        let w = parseInt(widthInput.value);\n        let h = parseInt(heightInput.value);\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\n            if (w > maxCanvasSize) {\n                w = maxCanvasSize;\n            } else if (h > maxCanvasSize) {\n                h = maxCanvasSize;\n            }\n\n            widthInput.value = '' + w;\n            heightInput.value = '' + h;\n        }\n\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\n        const commonRatios = [\n            [1, 2],\n            [2, 1],\n            [2, 3],\n            [3, 2],\n            [3, 4],\n            [4, 3],\n            [4, 5],\n            [5, 4],\n            [16, 9],\n            [9, 16],\n            [3, 2],\n            [2, 3],\n            [5, 3],\n            [3, 5],\n            [2, 1],\n            [1, 2],\n            [1.414, 1],\n            [1, 1.414],\n        ];\n        const reducedArr = BB.reduce(w, h);\n        let closestRatio = commonRatios[0];\n        let closestDistance = Math.abs(\n            commonRatios[0][0] / commonRatios[0][1] - reducedArr[0] / reducedArr[1],\n        );\n        for (let i = 0; i < commonRatios.length; i++) {\n            if (\n                Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) <\n                closestDistance\n            ) {\n                closestRatio = commonRatios[i];\n                closestDistance = Math.abs(\n                    commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1],\n                );\n            }\n        }\n        //display ratio\n        if (closestDistance > 0 && closestDistance < 0.005) {\n            ratioWrapper.innerText =\n                LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\n        } else {\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\n        }\n\n        const realw = w;\n        const T = hcf(w, h);\n        w /= T;\n        h /= T;\n        w *= 260;\n        h *= 260;\n        if (w > 260) {\n            h = (260 / w) * h;\n            w = 260;\n        }\n        if (h > 100) {\n            w = (100 / h) * w;\n            h = 100;\n        }\n\n        preview.style.width = w + 'px';\n        preview.style.height = h + 'px';\n        previewWrapper.style.backgroundSize = Math.round(Math.max(4, 60 * (w / realw))) + 'px';\n    }\n\n    widthInput.onchange = (): void => {\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\n            widthInput.value = '1';\n        }\n        updateRatio();\n    };\n    widthInput.onkeyup = (): void => {\n        updateRatio();\n    };\n    heightInput.onchange = (): void => {\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\n            heightInput.value = '1';\n        }\n        updateRatio();\n    };\n    heightInput.onkeyup = (): void => {\n        updateRatio();\n    };\n    updateRatio();\n\n    newImDiv.append(templateWrapper);\n    const secondRow = BB.el({\n        parent: newImDiv,\n        css: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'flex-end',\n        },\n    });\n    const secondRowLeft = BB.el({\n        parent: secondRow,\n    });\n    secondRowLeft.append(sizeTable, ratioWrapper);\n    secondRow.append(colorOptions.getElement());\n\n    newImDiv.append(previewWrapper);\n\n    showModal({\n        target: document.body,\n        message: `<b>${LANG('new-title')}</b>`,\n        div: newImDiv,\n        buttons: ['Ok', 'Cancel'],\n        callback: function (result) {\n            BB.unsetEventHandler(widthInput, 'onclick', 'onchange', 'onkeyup');\n            BB.unsetEventHandler(widthInput, 'onclick', 'onchange', 'onkeyup');\n\n            BB.unsetEventHandler(presetCurrentBtn, 'onclick');\n            BB.unsetEventHandler(presetFitBtn, 'onclick');\n            BB.unsetEventHandler(presetOversizeBtn, 'onclick');\n            BB.unsetEventHandler(presetSquareBtn, 'onclick');\n            BB.unsetEventHandler(presetLandscapeBtn, 'onclick');\n            BB.unsetEventHandler(presetPortraitBtn, 'onclick');\n\n            select.destroy();\n            colorOptions.destroy();\n\n            if (\n                result === 'Cancel' ||\n                parseInt(widthInput.value) <= 0 ||\n                parseInt(heightInput.value) <= 0 ||\n                isNaN(parseInt(widthInput.value)) ||\n                isNaN(parseInt(heightInput.value))\n            ) {\n                onCancel();\n                return;\n            }\n            onConfirm(parseInt(widthInput.value), parseInt(heightInput.value), backgroundRgba);\n        },\n        clickOnEnter: 'Ok',\n    });\n}\n","import { BB } from '../../../bb/bb';\n\nexport function table(\n    data: (HTMLElement | string)[][],\n    cellProps?: Record<string, { rowspan: number }>, // {'0.2': {...}} -> row 1, col 3\n): HTMLElement {\n    const result = BB.el({\n        tagName: 'table',\n        className: 'kl-table',\n    });\n    data.forEach((row, rowIndex) => {\n        const rowEl = BB.el({\n            tagName: 'tr',\n        });\n        rowEl.append(\n            ...row.map((el, colIndex) => {\n                const cellEl = BB.el({\n                    tagName: 'td',\n                    content: el,\n                });\n\n                const key = rowIndex + '.' + colIndex;\n                if (cellProps !== undefined && key in cellProps) {\n                    cellEl.rowSpan = cellProps[key].rowspan;\n                }\n\n                return cellEl;\n            }),\n        );\n        result.append(rowEl);\n    });\n    return result;\n}\n","import { BB } from '../../../bb/bb';\nimport collapseImg from 'url:/src/app/img/ui/ui-collapse.svg';\nimport { LANG } from '../../../language/language';\nimport { TUiLayout } from '../../kl-types';\n\n/**\n * button that allows to collapse toolspace (for mobile)\n */\nexport class ToolspaceCollapser {\n    private readonly rootEl: HTMLElement;\n    private orientation: TUiLayout;\n    private readonly icon: HTMLElement;\n    private stateIsOpen: boolean;\n\n    private update(): void {\n        if (this.orientation === 'left') {\n            this.icon.style.transform = this.stateIsOpen ? 'rotate(180deg)' : '';\n        } else {\n            this.icon.style.transform = this.stateIsOpen ? '' : 'rotate(180deg)';\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: { onChange: () => void }) {\n        this.stateIsOpen = true;\n        this.orientation = 'right';\n\n        this.rootEl = BB.el({\n            className: 'kl-toolspace-toggle',\n            css: {\n                width: '36px',\n                height: '36px',\n                background: 'rgba(100, 100, 100, 0.9)',\n                color: '#fff',\n                textAlign: 'center',\n                lineHeight: '36px',\n                cursor: 'pointer',\n                userSelect: 'none',\n                padding: '6px',\n                boxSizing: 'border-box',\n            },\n            title: LANG('toggle-show-tools'),\n            onClick: (e) => {\n                e.preventDefault();\n                this.stateIsOpen = !this.stateIsOpen;\n                this.update();\n                p.onChange();\n            },\n        });\n\n        this.icon = BB.el({\n            parent: this.rootEl,\n            css: {\n                backgroundImage: `url(${collapseImg})`,\n                width: '100%',\n                height: '100%',\n                backgroundSize: 'contain',\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                userSelect: 'none',\n            },\n        });\n        this.update();\n        this.rootEl.oncontextmenu = () => {\n            return false;\n        };\n    }\n\n    // ---- interface ----\n\n    isOpen(): boolean {\n        return this.stateIsOpen;\n    }\n\n    setIsOpen(b: boolean): void {\n        this.stateIsOpen = b;\n        this.update();\n    }\n\n    setOrientation(dirStr: TUiLayout): void {\n        this.orientation = dirStr;\n        this.update();\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","module.exports = parcelRequire.resolve(\"ui-collapse.0d2f3fb5.svg\") + \"?\" + Date.now();","import { BB } from '../../../../bb/bb';\nimport { TRenderTextParam } from '../../../image-operations/render-text';\nimport { showModal } from '../base/showModal';\nimport { TRgb } from '../../../kl-types';\nimport { KlCanvas } from '../../../canvas/kl-canvas';\nimport { LANG } from '../../../../language/language';\nimport { TextToolFillUI } from './text-tool-fill-ui';\nimport { TextToolFontUI } from './text-tool-font-ui';\nimport { TextToolStrokeUI } from './text-tool-stroke-ui';\nimport { TextToolTextUI } from './text-tool-text-ui';\nimport { TextToolViewportUI } from './text-tool-viewport-ui';\nimport * as classes from './text-tool-dialog.module.scss';\nimport { c } from '../../../../bb/base/c';\nimport { TabRow } from '../../components/tab-row';\n\nexport function textToolDialog(p: {\n    klCanvas: KlCanvas;\n    layerIndex: number;\n    primaryColor: TRgb;\n    secondaryColor: TRgb;\n\n    text: TRenderTextParam;\n    onConfirm: (confirmP: TRenderTextParam) => void;\n}): void {\n    const rootEl = BB.el({});\n    let text = BB.copyObj(p.text);\n\n    const viewportWrapper = BB.el({\n        className: classes.viewportWrapper,\n    });\n\n    const viewportUI = new TextToolViewportUI({\n        text: text,\n        klCanvas: p.klCanvas,\n        layerIndex: p.layerIndex,\n        onDragEnd: () => (tabs.getOpenedTabId() === 'text' ? textUI.focus() : 0),\n    });\n    viewportUI.render();\n\n    function onUpdate(p: Partial<TRenderTextParam>) {\n        text = {\n            ...text,\n            ...p,\n        };\n        viewportUI.setText(text);\n    }\n\n    const fontUI = new TextToolFontUI({\n        ...text,\n        onUpdate: (p) => {\n            onUpdate(p);\n        },\n    });\n\n    const colorWrapper = BB.el({\n        css: {\n            display: 'flex',\n            gap: '10px',\n            flexDirection: 'column',\n        },\n    });\n    const fillUI = new TextToolFillUI({\n        fill: text.fill,\n        primaryColor: p.primaryColor,\n        secondaryColor: p.secondaryColor,\n        onUpdate: (p) => {\n            onUpdate(p);\n        },\n    });\n    const strokeUI = new TextToolStrokeUI({\n        stroke: text.stroke,\n        primaryColor: p.primaryColor,\n        secondaryColor: p.secondaryColor,\n        onUpdate: (p) => {\n            onUpdate(p);\n        },\n    });\n    const textUI = new TextToolTextUI({\n        text: text.text,\n        onUpdate: (p) => {\n            p.text !== undefined && modal.setIgnoreBackground(p.text.length > 0);\n            onUpdate(p);\n        },\n    });\n\n    const tabs = new TabRow({\n        initialId: 'text',\n        height: 40,\n        tabArr: [\n            {\n                id: 'text',\n                label: LANG('text-text'),\n                onOpen: () => {\n                    textUI.getElement().style.display = '';\n                    textUI.focus();\n                },\n                onClose: () => {\n                    textUI.getElement().style.display = 'none';\n                },\n            },\n            {\n                id: 'font',\n                label: LANG('text-font'),\n                onOpen: () => {\n                    fontUI.getElement().style.display = 'flex';\n                },\n                onClose: () => {\n                    fontUI.getElement().style.display = 'none';\n                },\n            },\n            {\n                id: 'color',\n                label: LANG('text-color'),\n                onOpen: () => {\n                    colorWrapper.style.display = 'flex';\n                },\n                onClose: () => {\n                    colorWrapper.style.display = 'none';\n                },\n            },\n        ],\n    });\n    tabs.getElement().classList.add(classes.tab);\n    rootEl.append(\n        c('', [\n            c(viewportWrapper, [viewportUI.getElement()]),\n            c('.' + classes.viewportInputs, [viewportUI.getInputsElement()]),\n            c('.tabrow.' + classes.tabWrapper, [c(',w-240,h-40'), tabs.getElement()]),\n\n            c('.' + classes.inputs, [\n                c(colorWrapper, [fillUI.getElement(), strokeUI.getElement()]),\n                fontUI.getElement(),\n                textUI.getElement(),\n            ]),\n        ]),\n    );\n\n    const onResize = () => {\n        const b = viewportWrapper.getBoundingClientRect();\n        const w = Math.ceil(b.width);\n        const h = Math.ceil(b.height);\n        viewportUI.setSize(w, h);\n    };\n    window.addEventListener('resize', onResize);\n    setTimeout(() => {\n        onResize();\n    });\n    setTimeout(() => {\n        textUI.focus();\n    }, 100);\n\n    // prevent mobile keyboards scrolling page\n    function onScroll(): void {\n        window.scrollTo(0, 0);\n    }\n    window.addEventListener('scroll', onScroll, { passive: false });\n\n    const onModalExit = (val: string) => {\n        window.removeEventListener('resize', onResize);\n        window.removeEventListener('scroll', onScroll);\n        viewportUI.destroy();\n        fontUI.destroy();\n        fillUI.destroy();\n        strokeUI.destroy();\n        textUI.destroy();\n        tabs.destroy();\n\n        if (val === 'Ok') {\n            p.onConfirm({\n                ...viewportUI.getValues(),\n                ...fontUI.getValues(),\n                ...fillUI.getValues(),\n                ...strokeUI.getValues(),\n                ...textUI.getValues(),\n            });\n        }\n    };\n\n    const modal = showModal({\n        target: document.body,\n        message: `<b>${LANG('text-title')}</b>`,\n        div: rootEl,\n        buttons: ['Ok', 'Cancel'],\n        ignoreBackground: p.text.text.length > 0,\n        callback: onModalExit,\n        style: {\n            width: 'calc(100% - 50px)',\n            maxWidth: '1000px',\n            minWidth: '300px',\n            boxSizing: 'border-box',\n        },\n        clickOnEnter: 'Ok',\n    });\n}\n","import { TRenderTextParam } from '../../../image-operations/render-text';\nimport { TRgb, TRgba } from '../../../kl-types';\nimport { ColorOptions } from '../../components/color-options';\nimport { KlSlider } from '../../components/kl-slider';\nimport { LANG } from '../../../../language/language';\nimport { c } from '../../../../bb/base/c';\nimport { createSvg } from '../../../../bb/base/base';\n\ntype TFillParams = Pick<TRenderTextParam, 'fill'>;\n\nexport type TFillUIParams = TFillParams & {\n    primaryColor: TRgb;\n    secondaryColor: TRgb;\n    onUpdate: (v: Partial<TFillParams>) => void;\n};\n\nexport class TextToolFillUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly colorOptions: ColorOptions;\n    private readonly opacitySlider: KlSlider;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TFillUIParams) {\n        const emit = (): void => {\n            p.onUpdate(this.getValues());\n        };\n\n        const colorOptionsArr: (TRgba | null)[] = [\n            null,\n            p.fill\n                ? {\n                      ...p.fill.color,\n                      a: 1,\n                  }\n                : null,\n            {\n                ...p.primaryColor,\n                a: 1,\n            },\n            {\n                ...p.secondaryColor,\n                a: 1,\n            },\n            { r: 0, g: 0, b: 0, a: 1 },\n            { r: 255, g: 255, b: 255, a: 1 },\n        ];\n\n        this.colorOptions = new ColorOptions({\n            colorArr: colorOptionsArr,\n            initialIndex: p.fill ? 1 : 0,\n            title: LANG('shape-fill'),\n            onChange: (c) => {\n                this.opacitySlider.getElement().style.display = c !== null ? '' : 'none';\n                emit();\n            },\n        });\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 150,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: p.fill ? p.fill.color.a : 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: () => emit(),\n        });\n        this.opacitySlider.getElement().style.display = p.fill ? '' : 'none';\n\n        const svg = createSvg({\n            elementType: 'svg',\n            class: 'dark-invert',\n            width: '25px',\n            height: '25px',\n            viewBox: '0 0 30 30',\n\n            childrenArr: [\n                {\n                    elementType: 'polyline',\n                    points: '0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0',\n                    'transform-origin': '15px 15px',\n                    transform: 'scale(0.8)',\n                    fill: '#000c',\n                },\n            ],\n        });\n\n        this.rootEl = c(',flex,gap-10,items-center,flexWrap,minh-30', [\n            svg,\n            this.colorOptions.getElement(),\n            this.opacitySlider.getElement(),\n        ]);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues(): TFillParams {\n        const c = this.colorOptions.getValue();\n        if (c === null || c?.a === 0) {\n            return {\n                fill: undefined,\n            };\n        }\n        const color = {\n            ...c,\n            a: this.opacitySlider.getValue(),\n        };\n        return {\n            fill: {\n                color,\n            },\n        };\n    }\n\n    destroy(): void {\n        this.colorOptions.destroy();\n        this.opacitySlider.destroy();\n    }\n}\n","import { BB } from '../../../../bb/bb';\nimport { TRenderTextParam, TTextFormat } from '../../../image-operations/render-text';\nimport { Input } from '../../components/input';\nimport { LANG } from '../../../../language/language';\nimport { ImageRadioList } from '../../components/image-radio-list';\nimport alignLeftImg from 'url:/src/app/img/ui/align-left.svg';\nimport alignCenterImg from 'url:/src/app/img/ui/align-center.svg';\nimport alignRightImg from 'url:/src/app/img/ui/align-right.svg';\nimport typoItalicImg from 'url:/src/app/img/ui/typo-italic.svg';\nimport typoBoldImg from 'url:/src/app/img/ui/typo-bold.svg';\nimport { ImageToggle } from '../../components/image-toggle';\nimport { Select } from '../../components/select';\nimport { c } from '../../../../bb/base/c';\nimport { PointerListener } from '../../../../bb/input/pointer-listener';\nimport { FONTS } from '../../../../../fonts/fonts';\nimport { showModal } from '../base/showModal';\n\ntype TFontParams = Pick<\n    TRenderTextParam,\n    'font' | 'size' | 'letterSpacing' | 'lineHeight' | 'align' | 'isItalic' | 'isBold'\n>;\n\nexport type TFontUIParams = TFontParams & {\n    onUpdate: (v: Partial<TFontParams>) => void;\n};\n\nconst importedFonts: {\n    fontFamily: string;\n    fontName: string; // visible to user\n}[] = [\n    { fontFamily: 'sans-serif', fontName: 'Sans-serif' },\n    { fontFamily: 'serif', fontName: 'Serif' },\n    { fontFamily: 'monospace', fontName: 'Monospace' },\n    { fontFamily: 'cursive', fontName: 'Cursive' },\n    { fontFamily: 'fantasy', fontName: 'Fantasy' },\n    ...FONTS.map((item) => {\n        return {\n            fontFamily: item.name,\n            fontName: item.name,\n        };\n    }),\n];\n\nlet didLoadBundledFonts = false;\nasync function loadBundledFonts(): Promise<void> {\n    if (didLoadBundledFonts) {\n        return;\n    }\n    didLoadBundledFonts = true;\n    const promises = FONTS.map(async (item) => {\n        const response = await fetch(item.url);\n        const buffer = await response.arrayBuffer();\n        const font = new FontFace(item.name, buffer);\n        // await font.load();\n        document.fonts.add(font);\n    });\n\n    await Promise.all(promises);\n}\n\nexport class TextToolFontUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly fontSelect: Select<string>;\n    private readonly fontPointerListener: PointerListener;\n\n    private readonly importButton: HTMLButtonElement;\n\n    private readonly sizeInput: Input;\n    private readonly lineHeightInput: Input;\n    private readonly letterSpacingInput: Input;\n\n    private readonly alignRadioList: ImageRadioList<TTextFormat>;\n    private readonly italicToggle: ImageToggle;\n    private readonly boldToggle: ImageToggle;\n\n    private readonly onUpdate: (v: Partial<TFontParams>) => void;\n    private readonly onFocus: () => void;\n\n    // only load fonts when interacting with the font input\n    private loadBundledFonts(): void {\n        !didLoadBundledFonts &&\n            loadBundledFonts().then(() => {\n                this.onUpdate({\n                    font: this.fontSelect.getValue(),\n                });\n            });\n    }\n\n    private importFont(): void {\n        const acceptedExtensions = ['ttf', 'otf', 'woff', 'woff2', 'eot'];\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.multiple = true;\n        input.accept = acceptedExtensions.map((item) => '.' + item).join(', ');\n        input.focus();\n        input.click();\n        input.onchange = async () => {\n            if (!input.files || input.files.length === 0) {\n                return;\n            }\n            let toSelect: string | undefined = undefined;\n            const failedToLoadFilenames: string[] = [];\n            let acceptedAtLeastOne = false;\n\n            const fontFamilies = importedFonts.map((i) => i.fontFamily);\n            for (let i = 0; i < input.files.length; i++) {\n                const file = input.files[i];\n\n                const fontName = 'kl-' + importedFonts.length;\n                if (fontFamilies.includes(fontName)) {\n                    continue;\n                }\n                if (!toSelect) {\n                    toSelect = fontName;\n                    this.importButton.disabled = true;\n                    this.importButton.innerText = LANG('loading');\n                }\n\n                const split = file.name.split('.');\n                split.pop();\n\n                importedFonts.push({\n                    fontFamily: fontName,\n                    fontName: split.join('.'),\n                });\n                const font = new FontFace(fontName, await file.arrayBuffer());\n                try {\n                    await font.load();\n                    document.fonts.add(font);\n                    acceptedAtLeastOne = true;\n                } catch (err) {\n                    failedToLoadFilenames.push(file.name);\n                }\n            }\n\n            if (failedToLoadFilenames.length > 0) {\n                showModal({\n                    target: document.body,\n                    message: BB.el({\n                        content: [\n                            LANG('text-failed-import'),\n                            c('br'),\n                            failedToLoadFilenames.join(', '),\n                            c('br'),\n                            c('br'),\n                            LANG('text-supported-formats'),\n                            c('br'),\n                            acceptedExtensions.join(', '),\n                        ],\n                    }),\n                    type: 'error',\n                });\n            }\n\n            if (!acceptedAtLeastOne) {\n                this.importButton.disabled = false;\n                this.importButton.innerText = LANG('file-import');\n                return;\n            }\n\n            // update font selection\n            setTimeout(() => {\n                this.fontSelect.setOptionArr(\n                    importedFonts.map((i) => {\n                        return [\n                            i.fontFamily,\n                            i.fontName,\n                            {\n                                css: {\n                                    fontFamily: i.fontFamily,\n                                    fontSize: '1.2em',\n                                },\n                            },\n                        ];\n                    }),\n                );\n                this.fontSelect.setValue(toSelect);\n                this.onUpdate({\n                    font: toSelect,\n                });\n                this.importButton.disabled = false;\n                this.importButton.innerText = LANG('file-import');\n            });\n        };\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TFontUIParams) {\n        this.onUpdate = p.onUpdate;\n\n        this.fontSelect = new Select<string>({\n            initValue: p.font,\n            optionArr: importedFonts.map((i) => {\n                return [\n                    i.fontFamily,\n                    i.fontName,\n                    {\n                        css: {\n                            fontFamily: i.fontFamily,\n                            fontSize: '1.2em',\n                        },\n                    },\n                ];\n            }),\n            isFocusable: true,\n            css: {\n                width: '180px',\n            },\n            onChange: (v) => {\n                this.loadBundledFonts();\n                p.onUpdate({\n                    font: v,\n                });\n            },\n            name: 'font',\n        });\n        this.onFocus = () => this.loadBundledFonts();\n        this.fontSelect.getElement().addEventListener('focus', this.onFocus);\n        this.fontPointerListener = new BB.PointerListener({\n            target: this.fontSelect.getElement(),\n            onWheel: (e) => this.fontSelect.setDeltaValue(e.deltaY),\n        });\n\n        this.importButton = BB.el({\n            tagName: 'button',\n            content: LANG('file-import'),\n            onClick: () => {\n                this.importFont();\n            },\n        });\n\n        const sizeLabel = BB.el({\n            content: [\n                BB.el({\n                    tagName: 'span',\n                    content: 'A',\n                    css: {\n                        fontSize: '0.6em',\n                    },\n                }),\n                'A',\n            ],\n            css: {\n                width: '25px',\n                height: '25px',\n                display: 'flex',\n                justifyContent: 'center',\n                alignItems: 'center',\n                fontSize: '1.2em',\n                userSelect: 'none',\n            },\n        });\n        this.sizeInput = new Input({\n            title: LANG('text-size'),\n            type: 'number',\n            min: 0,\n            max: 1000,\n            init: p.size,\n            onChange: (v) => {\n                p.onUpdate({\n                    size: parseFloat(v),\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: '70px',\n            },\n            name: 'font-size',\n        });\n\n        this.lineHeightInput = new Input({\n            label: LANG('text-line-height'),\n            type: 'number',\n            min: 0,\n            max: 10,\n            step: 0.1,\n            init: p.lineHeight ?? 1,\n            onChange: (v) => {\n                p.onUpdate({\n                    lineHeight: parseFloat(v),\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: '60px',\n            },\n            name: 'line-height',\n        });\n\n        this.letterSpacingInput = new Input({\n            label: LANG('text-letter-spacing'),\n            type: 'number',\n            min: -100,\n            max: 100,\n            init: p.letterSpacing ?? 0,\n            onChange: (v) => {\n                p.onUpdate({\n                    letterSpacing: parseFloat(v),\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: '60px',\n            },\n            name: 'letter-spacing',\n        });\n\n        this.alignRadioList = new ImageRadioList<TTextFormat>({\n            optionArr: [\n                {\n                    id: 'left',\n                    title: LANG('text-left'),\n                    image: alignLeftImg,\n                    darkInvert: true,\n                },\n                {\n                    id: 'center',\n                    title: LANG('text-center'),\n                    image: alignCenterImg,\n                    darkInvert: true,\n                },\n                {\n                    id: 'right',\n                    title: LANG('text-right'),\n                    image: alignRightImg,\n                    darkInvert: true,\n                },\n            ],\n            initId: p.align,\n            onChange: (v) =>\n                p.onUpdate({\n                    align: v,\n                }),\n        });\n\n        this.italicToggle = new ImageToggle({\n            image: typoItalicImg,\n            title: LANG('text-italic'),\n            initValue: p.isItalic,\n            onChange: (v) =>\n                p.onUpdate({\n                    isItalic: v,\n                }),\n            darkInvert: true,\n        });\n\n        this.boldToggle = new ImageToggle({\n            image: typoBoldImg,\n            title: LANG('text-bold'),\n            initValue: p.isBold,\n            onChange: (v) =>\n                p.onUpdate({\n                    isBold: v,\n                }),\n            darkInvert: true,\n        });\n\n        this.rootEl = c(',flex,flexWrap,gap-10-15,items-center', [\n            c(',flex,gap-5,items-center', [sizeLabel, this.sizeInput.getElement()]),\n            c(',flex,gap-5', [this.fontSelect.getElement(), this.importButton]),\n            c(',flex,gap-7', [\n                this.alignRadioList.getElement(),\n                this.italicToggle.getElement(),\n                this.boldToggle.getElement(),\n            ]),\n            this.letterSpacingInput.getElement(),\n            this.lineHeightInput.getElement(),\n        ]);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues(): TFontParams {\n        return {\n            font: this.fontSelect.getValue(),\n            size: +this.sizeInput.getValue(),\n            letterSpacing: +this.letterSpacingInput.getValue(),\n            lineHeight: +this.lineHeightInput.getValue(),\n            align: this.alignRadioList.getValue(),\n            isItalic: this.italicToggle.getValue(),\n            isBold: this.boldToggle.getValue(),\n        };\n    }\n\n    destroy(): void {\n        this.fontPointerListener.destroy();\n        this.fontSelect.getElement().removeEventListener('focus', this.onFocus);\n        this.fontSelect.destroy();\n        BB.destroyEl(this.importButton);\n        this.sizeInput.destroy();\n        this.lineHeightInput.destroy();\n        this.letterSpacingInput.destroy();\n        this.alignRadioList.destroy();\n        this.italicToggle.destroy();\n        this.boldToggle.destroy();\n    }\n}\n","module.exports = parcelRequire.resolve(\"align-left.c601c367.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"align-center.f8d393aa.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"align-right.202af848.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"typo-italic.57b6dde7.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"typo-bold.11d19099.svg\") + \"?\" + Date.now();","import fontCaveat from 'url:./Caveat-Regular.woff2';\nimport fontClimateCrisis from 'url:./ClimateCrisis-Regular-VariableFont_YEAR.woff2';\nimport fontCorrectionBrush from 'url:./CorrectionBrush.woff2';\nimport fontDancingScript from 'url:./DancingScript-Regular.woff2';\nimport fontDiabolik from 'url:./Diabolik-Regular-VF.woff2';\nimport fontFreckleFace from 'url:./FreckleFace-Regular.woff2';\nimport fontGloock from 'url:./Gloock-Regular.woff2';\nimport fontPacha from 'url:./Pacha.woff2';\nimport fontGochiHand from 'url:./GochiHand-Regular.woff2';\nimport fontPassionOne from 'url:./PassionOne-Bold.woff2';\nimport fontPixeloidSans from 'url:./PixeloidSans.woff2';\nimport fontPlaypenSans from 'url:./PlaypenSans-Thin.woff2';\nimport fontQuicksandLight from 'url:./Quicksand-Light.woff2';\nimport fontSilkscreen from 'url:./Silkscreen-Regular.woff2';\nimport fontTehroc from 'url:./Tehroc-Regular.woff2';\nimport fontYunga from 'url:./YUNGA-Display.woff2';\n\nexport const FONTS: {\n    name: string;\n    url: string;\n}[] = [\n    { name: 'Caveat', url: fontCaveat },\n    { name: 'ClimateCrisis', url: fontClimateCrisis },\n    { name: 'CorrectionBrush', url: fontCorrectionBrush },\n    { name: 'DancingScript', url: fontDancingScript },\n    { name: 'Diabolik', url: fontDiabolik },\n    { name: 'FreckleFace', url: fontFreckleFace },\n    { name: 'Gloock', url: fontGloock },\n    { name: 'GochiHand', url: fontGochiHand },\n    { name: 'Pacha', url: fontPacha },\n    { name: 'PassionOne', url: fontPassionOne },\n    { name: 'PixeloidSans', url: fontPixeloidSans },\n    { name: 'PlaypenSans', url: fontPlaypenSans },\n    { name: 'Quicksand', url: fontQuicksandLight },\n    { name: 'Silkscreen', url: fontSilkscreen },\n    { name: 'Tehroc', url: fontTehroc },\n    { name: 'YUNGA', url: fontYunga },\n];\n","module.exports = parcelRequire.resolve(\"Caveat-Regular.50521ece.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"ClimateCrisis-Regular-VariableFont_YEAR.b0c25ef5.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"CorrectionBrush.38545121.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"DancingScript-Regular.b20219dc.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"Diabolik-Regular-VF.cefbc30e.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"FreckleFace-Regular.e438c5c5.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"Gloock-Regular.29fd06d3.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"Pacha.985a6859.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"GochiHand-Regular.7e3e9420.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"PassionOne-Bold.eef4c2c8.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"PixeloidSans.bd2cd19a.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"PlaypenSans-Thin.afb1d197.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"Quicksand-Light.dd9b8927.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"Silkscreen-Regular.412b5f16.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"Tehroc-Regular.4bbc1157.woff2\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"YUNGA-Display.c64dbbaa.woff2\") + \"?\" + Date.now();","import { BB } from '../../../../bb/bb';\nimport { TRenderTextParam } from '../../../image-operations/render-text';\nimport { TRgb, TRgba } from '../../../kl-types';\nimport { ColorOptions } from '../../components/color-options';\nimport { KlSlider } from '../../components/kl-slider';\nimport { LANG } from '../../../../language/language';\nimport { c } from '../../../../bb/base/c';\nimport { createSvg } from '../../../../bb/base/base';\n\ntype TStrokeParams = Pick<TRenderTextParam, 'stroke'>;\n\nexport type TStrokeUIParams = TStrokeParams & {\n    primaryColor: TRgb;\n    secondaryColor: TRgb;\n    onUpdate: (v: Partial<TStrokeParams>) => void;\n};\n\nexport class TextToolStrokeUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly colorOptions: ColorOptions;\n    private readonly opacitySlider: KlSlider;\n    private readonly lineWidthSlider: KlSlider;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TStrokeUIParams) {\n        this.rootEl = BB.el({\n            css: {\n                boxShadow: '0 0 0 1px #aaa',\n            },\n        });\n\n        const emit = (): void => {\n            p.onUpdate(this.getValues());\n        };\n\n        const colorOptionsArr: (TRgba | null)[] = [\n            null,\n            p.stroke\n                ? {\n                      ...p.stroke.color,\n                      a: 1,\n                  }\n                : null,\n            {\n                ...p.secondaryColor,\n                a: 1,\n            },\n            {\n                ...p.primaryColor,\n                a: 1,\n            },\n            { r: 255, g: 255, b: 255, a: 1 },\n            { r: 0, g: 0, b: 0, a: 1 },\n        ];\n\n        this.colorOptions = new ColorOptions({\n            colorArr: colorOptionsArr,\n            initialIndex: p.stroke ? 1 : 0,\n            title: LANG('shape-stroke'),\n            onChange: (c) => {\n                this.opacitySlider.getElement().style.display = c !== null ? '' : 'none';\n                this.lineWidthSlider.getElement().style.display = c !== null ? '' : 'none';\n                emit();\n            },\n        });\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 150,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: p.stroke ? p.stroke.color.a : 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: () => emit(),\n        });\n\n        this.lineWidthSlider = new KlSlider({\n            label: LANG('shape-line-width'),\n            width: 150,\n            height: 30,\n            min: 0.5,\n            max: 100,\n            value: p.stroke ? p.stroke.lineWidth : 2,\n            eventResMs: 1000 / 30,\n            curve: 'quadratic',\n            onChange: () => emit(),\n        });\n\n        this.opacitySlider.getElement().style.display = p.stroke ? '' : 'none';\n        this.lineWidthSlider.getElement().style.display = p.stroke ? '' : 'none';\n\n        const svg = createSvg({\n            elementType: 'svg',\n            class: 'dark-invert',\n            width: '25px',\n            height: '25px',\n            viewBox: '0 0 30 30',\n\n            childrenArr: [\n                {\n                    elementType: 'polyline',\n                    points: '0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0',\n                    fill: 'none',\n                    stroke: '#000c',\n                    'stroke-width': '3',\n                    'transform-origin': '15px 15px',\n                    transform: 'scale(0.8)',\n                },\n            ],\n        });\n\n        this.rootEl = c(',flex,gap-10,items-center,flexWrap,minh-30', [\n            svg,\n            this.colorOptions.getElement(),\n            this.opacitySlider.getElement(),\n            this.lineWidthSlider.getElement(),\n        ]);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues(): TStrokeParams {\n        const c = this.colorOptions.getValue();\n        if (c === null || c?.a === 0) {\n            return {\n                stroke: undefined,\n            };\n        }\n        const color = {\n            ...c,\n            a: this.opacitySlider.getValue(),\n        };\n        return {\n            stroke: {\n                color,\n                lineWidth: this.lineWidthSlider.getValue(),\n            },\n        };\n    }\n\n    destroy(): void {\n        this.colorOptions.destroy();\n        this.opacitySlider.destroy();\n        this.lineWidthSlider.destroy();\n    }\n}\n","import { TRenderTextParam } from '../../../image-operations/render-text';\nimport { BB } from '../../../../bb/bb';\nimport { LANG } from '../../../../language/language';\nimport { c } from '../../../../bb/base/c';\n\ntype TTextParams = Pick<TRenderTextParam, 'text'>;\n\nexport type TTextUIParams = TTextParams & {\n    onUpdate: (v: Partial<TTextParams>) => void;\n};\n\nexport class TextToolTextUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly textInput: HTMLTextAreaElement;\n    private lastEmittedText: string;\n    private readonly onUpdate: (v: Partial<TTextParams>) => void;\n\n    private readonly onInput = (): void => {\n        this.emit();\n    };\n\n    private emit(): void {\n        const text = this.textInput.value;\n        if (text === this.lastEmittedText) {\n            return;\n        }\n        this.lastEmittedText = text;\n        this.onUpdate({\n            text,\n        });\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TTextUIParams) {\n        this.lastEmittedText = p.text;\n        this.onUpdate = p.onUpdate;\n\n        this.rootEl = c('');\n\n        this.textInput = BB.el({\n            tagName: 'textarea',\n            parent: this.rootEl,\n            content: p.text,\n            custom: {\n                placeholder: LANG('text-placeholder'),\n            },\n            css: {\n                whiteSpace: 'pre',\n                overflow: 'auto',\n                width: '100%',\n                height: '70px',\n                resize: 'vertical',\n            },\n            onChange: () => {\n                this.emit();\n            },\n        });\n\n        this.textInput.addEventListener('input', this.onInput);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues(): TTextParams {\n        return {\n            text: this.textInput.value,\n        };\n    }\n\n    focus(): void {\n        this.textInput.focus();\n    }\n\n    destroy(): void {\n        BB.destroyEl(this.textInput);\n        this.textInput.removeEventListener('input', this.onInput);\n    }\n}\n","import { BB } from '../../../../bb/bb';\nimport { css, throwIfNull } from '../../../../bb/base/base';\nimport { THEME } from '../../../../theme/theme';\nimport { renderText, TRenderTextParam } from '../../../image-operations/render-text';\nimport { KlCanvas } from '../../../canvas/kl-canvas';\nimport { KlSlider } from '../../components/kl-slider';\nimport { PointerListener } from '../../../../bb/input/pointer-listener';\nimport { LANG } from '../../../../language/language';\nimport toolZoomInImg from 'url:/src/app/img/ui/tool-zoom-in.svg';\nimport toolZoomOutImg from 'url:/src/app/img/ui/tool-zoom-out.svg';\nimport { c } from '../../../../bb/base/c';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { KeyListener } from '../../../../bb/input/key-listener';\nimport { getSelectionPath2d } from '../../../../bb/multi-polygon/get-selection-path-2d';\n\ntype TViewportParams = Pick<TRenderTextParam, 'x' | 'y' | 'angleRad'>;\n\ntype TViewportUIParams = {\n    text: TRenderTextParam;\n    klCanvas: KlCanvas;\n    layerIndex: number;\n    onDragEnd: () => void;\n};\n\nexport class TextToolViewportUI {\n    private readonly rootEl: HTMLElement;\n    private readonly inputsRootEl: HTMLElement;\n    private readonly previewWrapper: HTMLElement;\n    private text: TRenderTextParam;\n    private offset: TVector2D = { x: 0, y: 0 };\n    private interval: ReturnType<typeof setInterval> | undefined;\n    private readonly selectionPath: Path2D | undefined;\n\n    private width: number;\n    private height: number;\n    private zoomFac: number = 0;\n    private scale: number = 1;\n\n    private readonly layerArr: ReturnType<KlCanvas['getLayersFast']> = [];\n    private readonly layerIndex: number;\n\n    private readonly textCanvas: HTMLCanvasElement;\n    private readonly textCtx: CanvasRenderingContext2D;\n\n    private readonly targetCanvas: HTMLCanvasElement;\n    private readonly targetCtx: CanvasRenderingContext2D;\n\n    private readonly layersCanvas: HTMLCanvasElement;\n    private readonly layersCtx: CanvasRenderingContext2D;\n\n    private readonly previewCanvas: HTMLCanvasElement;\n    private readonly previewCtx: CanvasRenderingContext2D;\n\n    private readonly emptyCanvas: HTMLCanvasElement;\n    private readonly emptyCanvasLight: HTMLCanvasElement;\n\n    private checkerPattern: CanvasPattern;\n\n    private readonly rotationSlider: KlSlider;\n    private readonly zoomInBtn: HTMLButtonElement;\n    private readonly zoomOutBtn: HTMLButtonElement;\n\n    private readonly eventCapture: HTMLElement;\n\n    private readonly previewPointerListener: PointerListener;\n    private readonly keyListener: KeyListener;\n\n    private readonly onDarkChange = () => {\n        this.checkerPattern = throwIfNull(\n            this.previewCtx.createPattern(BB.createCheckerCanvas(8, THEME.isDark()), 'repeat'),\n        );\n        this.render();\n    };\n\n    private canZoom(d: number): boolean {\n        return this.zoomFac !== Math.min(2, Math.max(-2, this.zoomFac + d));\n    }\n\n    private changeZoomFac(d: number): void {\n        this.zoomFac = Math.min(2, Math.max(-2, this.zoomFac + d));\n        this.render();\n        this.zoomInBtn.disabled = !this.canZoom(1);\n        this.zoomOutBtn.disabled = !this.canZoom(-1);\n    }\n\n    /** Move text by x y **/\n    private move(x: number, y: number): void {\n        const rotated = BB.rotate(x, y, (-this.rotationSlider.getValue() / Math.PI) * 180);\n        this.text.x += rotated.x / this.scale;\n        this.text.y += rotated.y / this.scale;\n        this.render();\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TViewportUIParams) {\n        this.rootEl = c();\n        this.text = p.text;\n        this.layerIndex = p.layerIndex;\n        const selection = p.klCanvas.getSelection();\n        this.selectionPath = selection ? new Path2D(getSelectionPath2d(selection)) : undefined;\n\n        const isSmallWidth = window.innerWidth < 550;\n        const isSmallHeight = window.innerHeight < 630;\n\n        // --- preview ---\n        // Text drawn on klCanvas-sized canvas: textCanvas\n        // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\n        //      they are transformed. canvas size of final preview\n        // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\n        // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\n\n        this.width = isSmallWidth ? 340 : 540;\n        this.height = isSmallWidth ? (isSmallHeight ? 210 : 260) : isSmallHeight ? 230 : 350;\n\n        this.layerArr = p.klCanvas.getLayersFast();\n        this.textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\n        this.textCtx = BB.ctx(this.textCanvas);\n        this.targetCanvas = BB.canvas(this.width, this.height);\n        this.targetCtx = BB.ctx(this.targetCanvas);\n        this.layersCanvas = BB.canvas(this.width, this.height);\n        this.layersCtx = BB.ctx(this.layersCanvas);\n        this.previewCanvas = BB.canvas(this.width, this.height); // the one that is visible\n        this.previewCtx = BB.ctx(this.previewCanvas);\n        css(this.previewCanvas, {\n            display: 'block',\n        });\n        this.previewWrapper = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'relative',\n                width: this.width + 'px',\n                cursor: 'move',\n                touchAction: 'none',\n            },\n        });\n        BB.el({\n            // inset shadow on preview\n            parent: this.previewWrapper,\n            className: 'kl-text-preview-wrapper',\n        });\n        this.previewWrapper.append(this.previewCanvas);\n        this.checkerPattern = throwIfNull(\n            this.previewCtx.createPattern(BB.createCheckerCanvas(8, THEME.isDark()), 'repeat'),\n        );\n        this.emptyCanvas = BB.canvas(1, 1);\n        this.emptyCanvasLight = BB.canvas(1, 1);\n        {\n            let ctx = BB.ctx(this.emptyCanvas);\n            ctx.fillRect(0, 0, 1, 1);\n\n            ctx = BB.ctx(this.emptyCanvasLight);\n            ctx.fillStyle = '#fff';\n            ctx.fillRect(0, 0, 1, 1);\n        }\n\n        THEME.addIsDarkListener(this.onDarkChange);\n\n        this.previewCanvas.oncontextmenu = (e) => e.preventDefault();\n        let dragged = false;\n        let isDown = false;\n        let offsetDragged = false;\n        this.previewPointerListener = new BB.PointerListener({\n            target: this.previewCanvas,\n            onPointer: (e) => {\n                // drag detect\n                if (e.type === 'pointerdown') {\n                    dragged = false;\n                    isDown = true;\n                }\n                if (e.type === 'pointermove' && isDown) {\n                    dragged = true;\n                }\n                if (e.type === 'pointerup') {\n                    if (isDown && dragged && e.pointerType === 'mouse') {\n                        // With touch/pen it would be annoying to focus again,\n                        // because it probably pops out the keyboard.\n                        p.onDragEnd();\n                    }\n                    dragged = false;\n                    isDown = false;\n                }\n\n                if (e.type === 'pointermove' && e.button === 'left') {\n                    e.eventPreventDefault();\n                    this.offset = { x: 0, y: 0 };\n                    this.move(-e.dX, -e.dY);\n                }\n                if (e.type === 'pointerdown' && e.button === 'right') {\n                    document.body.append(this.eventCapture);\n                }\n                if (e.type === 'pointerup') {\n                    setTimeout(() => this.eventCapture.remove(), 20);\n                }\n                if (e.type === 'pointermove' && e.button === 'right') {\n                    offsetDragged = true;\n                    e.eventPreventDefault();\n                    this.offset.x -= e.dX;\n                    this.offset.y -= e.dY;\n                    this.render();\n                }\n                if (e.type === 'pointerup' && offsetDragged) {\n                    let count = 0;\n                    this.interval = setInterval(() => {\n                        if (count > 8) {\n                            clearInterval(this.interval);\n                            this.offset = { x: 0, y: 0 };\n                            this.render();\n                        }\n                        this.offset = {\n                            x: this.offset.x * 0.6,\n                            y: this.offset.y * 0.6,\n                        };\n                        this.render();\n                        count++;\n                    }, 10);\n\n                    this.offset = {\n                        x: this.offset.x * 0.6,\n                        y: this.offset.y * 0.6,\n                    };\n                    this.render();\n                }\n            },\n            onWheel: (e) => {\n                this.changeZoomFac(-e.deltaY);\n            },\n        });\n\n        const wheelPrevent = (event: WheelEvent): void => event.preventDefault();\n        this.previewCanvas.addEventListener('wheel', wheelPrevent, { passive: false });\n\n        this.rotationSlider = new KlSlider({\n            label: LANG('filter-transform-rotation'),\n            width: 150,\n            height: 30,\n            min: -Math.PI,\n            max: Math.PI,\n            value: p.text.angleRad,\n            resolution: 225,\n            // eventResMs: 1000 / 30,\n            toValue: (deg) => (deg * Math.PI) / 180,\n            toDisplayValue: (rad) => (rad / Math.PI) * 180,\n            onChange: () => {\n                this.offset = { x: 0, y: 0 };\n                this.render();\n            },\n            unit: '',\n        });\n\n        this.zoomInBtn = BB.el({\n            tagName: 'button',\n            content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\n            title: LANG('zoom-in'),\n            onClick: () => this.changeZoomFac(1),\n            css: {\n                fontWeight: 'bold',\n            },\n        });\n        this.zoomOutBtn = BB.el({\n            tagName: 'button',\n            content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\n            title: LANG('zoom-out'),\n            onClick: () => this.changeZoomFac(-1),\n            css: {\n                fontWeight: 'bold',\n            },\n        });\n\n        this.eventCapture = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                right: '0',\n                bottom: '0',\n                zIndex: '999',\n                cursor: 'move',\n            },\n        });\n        this.eventCapture.oncontextmenu = (e) => e.preventDefault();\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr) => {\n                if (BB.isInputFocused(true)) {\n                    return;\n                }\n                const factor = this.keyListener.isPressed('shift') ? 4 : 1;\n                if (keyStr === 'left') {\n                    this.move(-factor, 0);\n                }\n                if (keyStr === 'right') {\n                    this.move(factor, 0);\n                }\n                if (keyStr === 'up') {\n                    this.move(0, -factor);\n                }\n                if (keyStr === 'down') {\n                    this.move(0, factor);\n                }\n            },\n        });\n\n        this.inputsRootEl = c(',flex,gap-5', [\n            this.rotationSlider.getElement(),\n            c(),\n            this.zoomInBtn,\n            this.zoomOutBtn,\n        ]);\n    }\n\n    render(): void {\n        // try to draw very much like klCanvasWorkspace\n\n        const angleRad = this.rotationSlider.getValue();\n\n        // --- draw text ---\n        this.textCtx.clearRect(0, 0, this.textCanvas.width, this.textCanvas.height);\n        const bounds = renderText(\n            this.textCanvas,\n            {\n                ...this.text,\n                x: this.text.x,\n                y: this.text.y,\n                angleRad: this.rotationSlider.getValue(),\n            },\n            this.selectionPath,\n        );\n\n        if (this.selectionPath) {\n            this.textCtx.save();\n            this.textCtx.setLineDash([4]);\n            this.textCtx.strokeStyle = '#000';\n            this.textCtx.stroke(this.selectionPath);\n            this.textCtx.lineDashOffset = 4;\n            this.textCtx.strokeStyle = '#fff';\n            this.textCtx.stroke(this.selectionPath);\n            this.textCtx.restore();\n        }\n\n        // transform offset\n        const transformedOffset = BB.Vec2.mul(\n            BB.rotate(this.offset.x, this.offset.y, (-angleRad / Math.PI) * 180),\n            1 / this.scale,\n        );\n\n        // --- determine transformation of viewport ---\n        // text should always be visible\n        bounds.x -= 3;\n        bounds.y -= 3;\n        bounds.width += 6;\n        bounds.height += 6;\n        const rotatedXY = BB.rotate(bounds.x, bounds.y, (-angleRad / Math.PI) * 180);\n        const rotatedWH = BB.rotate(bounds.width, bounds.height, (-angleRad / Math.PI) * 180);\n        const centerX = this.text.x + rotatedXY.x + rotatedWH.x / 2 + transformedOffset.x;\n        const centerY = this.text.y + rotatedXY.y + rotatedWH.y / 2 + transformedOffset.y;\n\n        const padding = 100;\n        const fitBounds = BB.fitInto(\n            bounds.width,\n            bounds.height,\n            this.width - padding,\n            this.height - padding,\n        );\n        this.scale = Math.min(1, fitBounds.width / bounds.width);\n        this.scale = Math.min(4, this.scale * Math.pow(2, this.zoomFac));\n\n        // --- compose text and target layer ---\n        this.targetCtx.save();\n\n        if (this.scale >= 4) {\n            this.targetCtx.imageSmoothingEnabled = false;\n        } else {\n            this.targetCtx.imageSmoothingEnabled = true;\n            this.targetCtx.imageSmoothingQuality = this.scale >= 1 ? 'low' : 'medium';\n        }\n\n        this.targetCtx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        this.targetCtx.translate(this.width / 2, this.height / 2);\n        this.targetCtx.scale(this.scale, this.scale);\n        this.targetCtx.rotate(angleRad);\n        this.targetCtx.drawImage(this.layerArr[this.layerIndex].canvas, -centerX, -centerY);\n        this.targetCtx.drawImage(this.textCanvas, -centerX, -centerY);\n        this.targetCtx.restore();\n\n        const isDark = THEME.isDark();\n\n        // --- layers ---\n        this.layersCtx.save();\n\n        this.layersCtx.fillStyle = isDark ? 'rgb(33,33,33)' : 'rgb(158,158,158)';\n        this.layersCtx.fillRect(0, 0, this.width, this.height);\n\n        {\n            // bg\n            this.layersCtx.save();\n\n            this.layersCtx.translate(this.width / 2, this.height / 2);\n            this.layersCtx.scale(this.scale, this.scale);\n            this.layersCtx.rotate(angleRad);\n\n            this.layersCtx.imageSmoothingEnabled = false;\n\n            //outline\n            const borderSize = 1 / this.scale;\n            this.layersCtx.globalAlpha = isDark ? 0.25 : 0.2;\n            this.layersCtx.drawImage(\n                isDark ? this.emptyCanvasLight : this.emptyCanvas,\n                -centerX - borderSize,\n                -centerY - borderSize,\n                this.textCanvas.width + borderSize * 2,\n                this.textCanvas.height + borderSize * 2,\n            );\n            this.layersCtx.globalAlpha = 1;\n\n            //erase\n            this.layersCtx.globalCompositeOperation = 'destination-out';\n            this.layersCtx.drawImage(\n                this.emptyCanvas,\n                -centerX,\n                -centerY,\n                this.textCanvas.width,\n                this.textCanvas.height,\n            );\n\n            this.layersCtx.restore();\n        }\n\n        {\n            // individual layers\n\n            if (this.scale >= 4) {\n                this.layersCtx.imageSmoothingEnabled = false;\n            } else {\n                this.layersCtx.imageSmoothingEnabled = true;\n                this.layersCtx.imageSmoothingQuality = this.scale >= 1 ? 'low' : 'medium';\n            }\n\n            // layers below\n            this.layersCtx.save();\n            this.layersCtx.translate(this.width / 2, this.height / 2);\n            this.layersCtx.scale(this.scale, this.scale);\n            this.layersCtx.rotate(angleRad);\n            for (let i = 0; i < this.layerIndex; i++) {\n                if (this.layerArr[i].isVisible && this.layerArr[i].opacity > 0) {\n                    this.layersCtx.globalAlpha = this.layerArr[i].opacity;\n                    this.layersCtx.globalCompositeOperation = this.layerArr[i].mixModeStr;\n                    this.layersCtx.drawImage(this.layerArr[i].canvas, -centerX, -centerY);\n                }\n            }\n            this.layersCtx.restore();\n\n            // target layer\n            this.layersCtx.globalAlpha =\n                this.layerArr[this.layerIndex].opacity *\n                (this.layerArr[this.layerIndex].isVisible ? 1 : 0);\n            this.layersCtx.globalCompositeOperation = this.layerArr[this.layerIndex].mixModeStr;\n            this.layersCtx.drawImage(this.targetCanvas, 0, 0);\n\n            // layers above\n            this.layersCtx.save();\n            this.layersCtx.translate(this.width / 2, this.height / 2);\n            this.layersCtx.scale(this.scale, this.scale);\n            this.layersCtx.rotate(angleRad);\n            for (let i = this.layerIndex + 1; i < this.layerArr.length; i++) {\n                if (this.layerArr[i].isVisible && this.layerArr[i].opacity > 0) {\n                    this.layersCtx.globalAlpha = this.layerArr[i].opacity;\n                    this.layersCtx.globalCompositeOperation = this.layerArr[i].mixModeStr;\n                    this.layersCtx.drawImage(this.layerArr[i].canvas, -centerX, -centerY);\n                }\n            }\n            this.layersCtx.restore();\n        }\n\n        this.layersCtx.restore();\n\n        // --- final composite ---\n        this.previewCtx.save();\n        this.previewCtx.fillStyle = this.checkerPattern;\n        this.previewCtx.fillRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        this.previewCtx.drawImage(this.layersCanvas, 0, 0);\n        this.previewCtx.restore();\n\n        // bounds\n        this.previewCtx.save();\n        this.previewCtx.globalCompositeOperation = 'difference';\n        this.previewCtx.strokeStyle = '#fff';\n        this.previewCtx.lineWidth = 0.5;\n        this.previewCtx.translate(-this.offset.x, -this.offset.y);\n        this.previewCtx.strokeRect(\n            Math.round(this.width / 2 - (bounds.width / 2) * this.scale) + 0.5,\n            Math.round(this.height / 2 - (bounds.height / 2) * this.scale) + 0.5,\n            Math.round(bounds.width * this.scale),\n            Math.round(bounds.height * this.scale),\n        );\n        this.previewCtx.restore();\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getInputsElement(): HTMLElement {\n        return this.inputsRootEl;\n    }\n\n    getValues(): TViewportParams {\n        return {\n            x: this.text.x,\n            y: this.text.y,\n            angleRad: this.rotationSlider.getValue(),\n        };\n    }\n\n    setText(text: Omit<TRenderTextParam, 'x' | 'y' | 'angleRad'>): void {\n        const x = this.text.x;\n        const y = this.text.y;\n        const angleRad = this.text.angleRad;\n        this.text = {\n            ...text,\n            x,\n            y,\n            angleRad,\n        };\n        this.render();\n    }\n\n    setSize(width: number, height: number): void {\n        // prevents: Failed to execute 'drawImage' on 'CanvasRenderingContext2D':\n        // The image argument is a canvas element with a width or height of 0.\n        width = Math.max(1, width);\n        height = Math.max(1, height);\n\n        if (width === this.width && height === this.height) {\n            return;\n        }\n\n        this.width = width;\n        this.height = height;\n\n        this.targetCanvas.width = this.width;\n        this.targetCanvas.height = this.height;\n\n        this.layersCanvas.width = this.width;\n        this.layersCanvas.height = this.height;\n\n        this.previewCanvas.width = this.width;\n        this.previewCanvas.height = this.height;\n\n        this.previewWrapper.style.width = this.width + 'px';\n\n        this.render();\n    }\n\n    destroy(): void {\n        BB.destroyEl(this.rootEl);\n        BB.destroyEl(this.inputsRootEl);\n        BB.destroyEl(this.previewWrapper);\n        clearInterval(this.interval);\n\n        this.rotationSlider.destroy();\n        BB.destroyEl(this.zoomInBtn);\n        BB.destroyEl(this.zoomOutBtn);\n        this.eventCapture.remove();\n        this.previewPointerListener.destroy();\n        this.keyListener.destroy();\n        THEME.removeIsDarkListener(this.onDarkChange);\n    }\n}\n",null,"import { BB } from '../../../bb/bb';\nimport { CropCopy } from '../components/crop-copy';\nimport { Checkbox } from '../components/checkbox';\nimport { showModal } from './base/showModal';\nimport { LANG } from '../../../language/language';\nimport { TKeyString, TRect } from '../../../bb/bb-types';\nimport { TKlPsd, TKlPsdError } from '../../kl-types';\nimport { css } from '../../../bb/base/base';\n\n/**\n * Shows first dialog when importing an image.\n * Where you can crop, and select import as layer or as image.\n */\nexport function showImportImageDialog(p: {\n    image:\n        | TKlPsd\n        | {\n              type: 'image';\n              width: number;\n              height: number;\n              canvas: HTMLImageElement | HTMLCanvasElement;\n          };\n    maxSize: number;\n    target: HTMLElement;\n    callback: (\n        val:\n            | {\n                  type: 'as-image' | 'as-layer';\n                  image: HTMLImageElement | HTMLCanvasElement;\n              }\n            | {\n                  type: 'as-image-psd';\n                  image: TKlPsd;\n                  cropObj: TRect;\n              }\n            | {\n                  type: 'cancel';\n              },\n    ) => void;\n}): void {\n    const rootEl = BB.el();\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n    const style: TKeyString = isSmall ? {} : { width: '540px' };\n\n    const resolutionEl = BB.el({\n        css: {\n            marginTop: '10px',\n            textAlign: 'center',\n            color: '#888',\n            lineHeight: '20px',\n        },\n    });\n\n    const cropCopy = new CropCopy({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 400,\n        canvas: p.image.canvas,\n        enableRightClickCopy: false,\n        onChange: (width, height): void => {\n            if (!resolutionEl) {\n                return;\n            }\n            updateResolution(width, height);\n        },\n    });\n    css(cropCopy.getElement(), {\n        marginLeft: '-20px',\n    });\n    cropCopy.getElement().title = LANG('crop-drag-to-crop');\n\n    rootEl.append(cropCopy.getElement(), resolutionEl);\n\n    function updateResolution(w: number, h: number): void {\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\n\n        if (fit.width < w) {\n            resolutionEl.innerHTML = `<span class=\"kl-text-error\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\n            resolutionEl.title = LANG('import-too-large');\n        } else {\n            resolutionEl.innerHTML = `${w} X ${h}`;\n            resolutionEl.title = '';\n        }\n    }\n    updateResolution(p.image.width, p.image.height);\n\n    let doFlatten = false;\n    function showWarnings(psdWarningArr: TKlPsdError[]): void {\n        const contentArr = [];\n        const warningMap = {\n            mask: 'Masks not supported. Mask was applied.',\n            clipping: 'Clipping not supported. Clipping layers were merged.',\n            group: 'Groups not supported. Layers were ungrouped.',\n            adjustment: 'Adjustment layers not supported.',\n            'layer-effect': 'Layer effects not supported.',\n            'smart-object': 'Smart objects not supported.',\n            'blend-mode': 'Unsupported layer blend mode.',\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\n        };\n        for (let i = 0; i < psdWarningArr.length; i++) {\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\n        }\n        alert(contentArr.join('\\n'));\n    }\n\n    let flattenCheckbox: Checkbox;\n    let warningsEl: HTMLElement | undefined;\n    if (p.image.type === 'psd') {\n        if (p.image.layers) {\n            flattenCheckbox = new Checkbox({\n                init: doFlatten,\n                label: LANG('import-flatten'),\n                callback: (b): void => {\n                    doFlatten = b;\n                },\n                name: 'flatten-image',\n            });\n            rootEl.append(flattenCheckbox.getElement());\n\n            if (p.image.warningArr) {\n                const noteEl = BB.el({\n                    className: 'kl-import-note',\n                    content: LANG('import-psd-limited-support'),\n                });\n                const warnings = p.image.warningArr;\n                warningsEl = BB.el({\n                    parent: noteEl,\n                    tagName: 'a',\n                    content: 'Details',\n                    css: { marginLeft: '5px' },\n                    onClick: () => showWarnings(warnings),\n                });\n                rootEl.append(noteEl);\n            }\n        } else {\n            const noteEl = BB.el({\n                className: 'kl-import-note',\n                content: LANG('import-psd-unsupported'),\n            });\n            rootEl.append(noteEl);\n        }\n    }\n\n    function callback(result: string): void {\n        const croppedCanvas = cropCopy.getCroppedCanvas();\n        const cropRect = cropCopy.getCropRect();\n        const isCropped = p.image.width !== cropRect.width || p.image.height !== cropRect.height;\n        cropCopy.destroy();\n        BB.destroyEl(warningsEl);\n        if (flattenCheckbox) {\n            flattenCheckbox.destroy();\n        }\n\n        if (result === LANG('import-btn-as-layer')) {\n            p.callback({\n                type: 'as-layer',\n                image: isCropped ? croppedCanvas : p.image.canvas,\n            });\n            if (!isCropped) {\n                BB.freeCanvas(croppedCanvas);\n            }\n        } else if (result === LANG('import-btn-as-image')) {\n            if (p.image.type === 'psd') {\n                if (doFlatten) {\n                    delete p.image.layers;\n                }\n                p.callback({\n                    type: 'as-image-psd',\n                    image: p.image,\n                    cropObj: cropRect,\n                });\n                BB.freeCanvas(croppedCanvas);\n            } else if (p.image.type === 'image') {\n                p.callback({\n                    type: 'as-image',\n                    image: croppedCanvas,\n                });\n            }\n        } else {\n            p.callback({\n                type: 'cancel',\n            });\n            BB.freeCanvas(croppedCanvas);\n        }\n    }\n    showModal({\n        target: p.target,\n        message: `<b>${LANG('import-title')}</b>`,\n        div: rootEl,\n        style,\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), 'Cancel'],\n        primaries: [LANG('import-btn-as-layer'), LANG('import-btn-as-image')],\n        callback,\n        autoFocus: 'As Image',\n    });\n}\n","import { createCanvas } from '../../bb/base/create-canvas';\nimport { BlendMode, Layer, Psd } from 'ag-psd/dist/psd';\nimport { TKlProject, TKlPsd, TKlPsdError, TKlPsdLayer, TMixMode } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { MAX_LAYERS } from '../canvas/kl-canvas';\nimport { BB } from '../../bb/bb';\nimport { randomUuid, throwIfUndefined } from '../../bb/base/base';\n\nlet kl2PsdMap: Record<TMixMode, BlendMode>;\nlet psd2KlMap: Record<BlendMode, TMixMode>;\n\nfunction init(): void {\n    if (kl2PsdMap) {\n        return;\n    }\n    kl2PsdMap = {\n        'source-over': 'normal',\n\n        darken: 'darken',\n        multiply: 'multiply',\n        'color-burn': 'color burn',\n\n        lighten: 'lighten',\n        screen: 'screen',\n        'color-dodge': 'color dodge',\n\n        overlay: 'overlay',\n        'soft-light': 'soft light',\n        'hard-light': 'hard light',\n\n        difference: 'difference',\n        exclusion: 'exclusion',\n\n        hue: 'hue',\n        saturation: 'saturation',\n        color: 'color',\n        luminosity: 'luminosity',\n    };\n    psd2KlMap = Object.fromEntries(Object.entries(kl2PsdMap).map((a) => a.reverse()));\n}\n\nexport function blendPsdToKl(str: BlendMode): TMixMode {\n    init();\n    return psd2KlMap[str];\n}\n\nexport function blendKlToPsd(str: TMixMode): BlendMode {\n    init();\n    return kl2PsdMap[str];\n}\n\n/**\n * Converts ag-psd object into something that KlCanvas can represent\n * @param psdObj\n */\nexport function readPsd(psdObj: Psd): TKlPsd {\n    if (!psdObj.canvas) {\n        throw new Error('psdObj.canvas undefined');\n    }\n    const result: TKlPsd = {\n        type: 'psd',\n        canvas: psdObj.canvas,\n        width: psdObj.width,\n        height: psdObj.height,\n    };\n\n    function addWarning(warningStr: TKlPsdError): void {\n        if (!result.warningArr) {\n            result.warningArr = [];\n        }\n        if (result.warningArr.includes(warningStr)) {\n            return;\n        }\n        result.warningArr.push(warningStr);\n    }\n\n    function getMixModeStr(blendMode: BlendMode): TMixMode {\n        let mixModeStr: TMixMode = blendPsdToKl(blendMode);\n        if (!mixModeStr) {\n            addWarning('blend-mode');\n            mixModeStr = 'source-over';\n        }\n        return mixModeStr;\n    }\n\n    if (psdObj.bitsPerChannel !== 8) {\n        addWarning('bits-per-channel');\n    }\n\n    if (!psdObj.children) {\n        result.error = true;\n        return result;\n    }\n\n    // count resulting layers\n    const maxLayers = MAX_LAYERS;\n    let layerCount = 0;\n    function countWithinGroup(groupObj: Layer): number {\n        let result = 0;\n        if (groupObj.blendMode) {\n            const mixModeStr = blendPsdToKl(groupObj.blendMode);\n            if (mixModeStr && mixModeStr !== 'source-over') {\n                return 1;\n            }\n        }\n        if (groupObj.children) {\n            for (let i = 0; i < groupObj.children.length; i++) {\n                const item = groupObj.children[i];\n                if (item.clipping || item.adjustment) {\n                    continue;\n                }\n\n                if (item.children) {\n                    addWarning('group');\n                    result += countWithinGroup(item);\n                } else {\n                    result++;\n                }\n            }\n        }\n        return result;\n    }\n    layerCount += countWithinGroup(psdObj);\n    if (layerCount > maxLayers) {\n        result.error = true;\n        return result;\n    }\n\n    result.layers = [];\n\n    function prepareMask(maskCanvas: HTMLCanvasElement, defaultColor: number): void {\n        const groupMaskCtx = BB.ctx(maskCanvas);\n        const imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n        if (defaultColor === 0) {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = imData.data[i];\n            }\n        } else {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = 255 - imData.data[i];\n            }\n        }\n        groupMaskCtx.putImageData(imData, 0, 0);\n    }\n\n    function convertGroup(psdGroupObj: Layer): TKlPsdLayer[] {\n        let resultArr: TKlPsdLayer[] = [];\n        const groupIsVisible = !psdGroupObj.hidden;\n        const groupOpacity = throwIfUndefined(psdGroupObj.opacity, 'groupOpacity is undefined');\n        const groupMixModeStr = getMixModeStr(psdGroupObj.blendMode!);\n        let groupCanvas;\n        let groupCtx;\n        if (groupMixModeStr !== 'source-over') {\n            groupCanvas = createCanvas(result.width, result.height);\n            groupCtx = BB.ctx(groupCanvas);\n        }\n\n        // prepare group mask\n        if (psdGroupObj.mask) {\n            addWarning('mask');\n            prepareMask(psdGroupObj.mask.canvas!, psdGroupObj.mask.defaultColor!);\n        }\n\n        if (psdGroupObj.children) {\n            for (let i = 0; i < psdGroupObj.children.length; i++) {\n                const item = psdGroupObj.children[i];\n                if (item.clipping) {\n                    continue;\n                }\n                if (item.adjustment) {\n                    addWarning('adjustment');\n                    continue;\n                }\n\n                const hasClipping =\n                    (item.children || item.canvas) &&\n                    psdGroupObj.children[i + 1] &&\n                    psdGroupObj.children[i + 1].clipping;\n                if (hasClipping) {\n                    addWarning('clipping');\n                }\n\n                if (item.children) {\n                    const convertedChildGroupItems = convertGroup(item);\n\n                    for (let e = 0; e < convertedChildGroupItems.length; e++) {\n                        const innerItem = convertedChildGroupItems[e];\n                        const innerCtx = BB.ctx(innerItem.image);\n\n                        // clipping\n                        if (hasClipping) {\n                            const clippingCanvas = createCanvas(result.width, result.height);\n                            const clippingCtx = BB.ctx(clippingCanvas);\n                            clippingCtx.drawImage(innerItem.image, 0, 0);\n\n                            for (\n                                let f = i + 1;\n                                f < psdGroupObj.children.length && psdGroupObj.children[f].clipping;\n                                f++\n                            ) {\n                                const clippingItem = psdGroupObj.children[f];\n                                if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                                    continue;\n                                }\n                                if (clippingItem.blendMode === undefined) {\n                                    throw new Error('clippingItem.blendMode undefined');\n                                }\n                                if (clippingItem.opacity === undefined) {\n                                    throw new Error('clippingItem.opacity undefined');\n                                }\n                                if (clippingItem.canvas === undefined) {\n                                    throw new Error('clippingItem.canvas undefined');\n                                }\n                                if (clippingItem.left === undefined) {\n                                    throw new Error('clippingItem.left undefined');\n                                }\n                                if (clippingItem.top === undefined) {\n                                    throw new Error('clippingItem.top undefined');\n                                }\n                                clippingCtx.globalCompositeOperation = getMixModeStr(\n                                    clippingItem.blendMode,\n                                );\n                                clippingCtx.globalAlpha = clippingItem.opacity;\n                                clippingCtx.drawImage(\n                                    clippingItem.canvas,\n                                    clippingItem.left,\n                                    clippingItem.top,\n                                );\n                            }\n\n                            innerCtx.globalCompositeOperation = 'source-atop';\n                            innerCtx.drawImage(clippingCanvas, 0, 0);\n                        }\n\n                        // group mask\n                        if (psdGroupObj.mask) {\n                            innerCtx.globalCompositeOperation =\n                                psdGroupObj.mask.defaultColor === 0\n                                    ? 'destination-in'\n                                    : 'destination-out';\n                            if (psdGroupObj.mask.canvas === undefined) {\n                                throw new Error('psdGroupObj.mask.canvas undefined');\n                            }\n                            if (psdGroupObj.mask.left === undefined) {\n                                throw new Error('psdGroupObj.mask.left undefined');\n                            }\n                            if (psdGroupObj.mask.top === undefined) {\n                                throw new Error('psdGroupObj.mask.top undefined');\n                            }\n                            innerCtx.drawImage(\n                                psdGroupObj.mask.canvas,\n                                psdGroupObj.mask.left,\n                                psdGroupObj.mask.top,\n                            );\n                        }\n\n                        if (groupCanvas) {\n                            if (groupCtx === undefined) {\n                                throw new Error('groupCtx undefined');\n                            }\n                            groupCtx.globalCompositeOperation = innerItem.mixModeStr;\n                            groupCtx.globalAlpha = innerItem.opacity;\n                            groupCtx.drawImage(innerItem.image, 0, 0);\n                        } else {\n                            innerItem.opacity = innerItem.opacity * groupOpacity;\n                            resultArr.push(innerItem);\n                        }\n                    }\n\n                    continue;\n                }\n\n                const canvas = createCanvas(result.width, result.height);\n                const ctx = BB.ctx(canvas);\n                if (item.canvas) {\n                    // if a layer is empty it has no canvas\n                    if (item.top === undefined) {\n                        throw new Error('item.top undefined');\n                    }\n                    if (item.left === undefined) {\n                        throw new Error('item.left undefined');\n                    }\n                    ctx.drawImage(item.canvas, item.left, item.top);\n                }\n\n                // effects\n                if (item.effects) {\n                    addWarning('layer-effect');\n                }\n\n                // mask\n                if (item.mask) {\n                    addWarning('mask');\n                    if (item.mask.canvas === undefined) {\n                        throw new Error('item.mask.canvas undefined');\n                    }\n                    if (item.mask.defaultColor === undefined) {\n                        throw new Error('item.mask.defaultColor undefined');\n                    }\n                    if (item.mask.left === undefined) {\n                        throw new Error('item.mask.left undefined');\n                    }\n                    if (item.mask.top === undefined) {\n                        throw new Error('item.mask.top undefined');\n                    }\n                    prepareMask(item.mask.canvas, item.mask.defaultColor);\n\n                    ctx.globalCompositeOperation =\n                        item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                    ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\n                }\n\n                // clipping\n                if (hasClipping) {\n                    if (item.right === undefined) {\n                        throw new Error('item.right undefined');\n                    }\n                    if (item.left === undefined) {\n                        throw new Error('item.left undefined');\n                    }\n                    if (item.bottom === undefined) {\n                        throw new Error('item.bottom undefined');\n                    }\n                    if (item.top === undefined) {\n                        throw new Error('item.top undefined');\n                    }\n                    if (item.canvas === undefined) {\n                        throw new Error('item.canvas undefined');\n                    }\n                    const clippingCanvas = createCanvas(\n                        item.right - item.left,\n                        item.bottom - item.top,\n                    );\n                    const clippingCtx = BB.ctx(clippingCanvas);\n                    clippingCtx.drawImage(item.canvas, 0, 0);\n\n                    for (\n                        let e = i + 1;\n                        e < psdGroupObj.children.length && psdGroupObj.children[e].clipping;\n                        e++\n                    ) {\n                        const clippingItem = psdGroupObj.children[e];\n                        if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                            continue;\n                        }\n                        if (clippingItem.blendMode === undefined) {\n                            throw new Error('clippingItem.blendMode undefined');\n                        }\n                        if (clippingItem.opacity === undefined) {\n                            throw new Error('clippingItem.opacity undefined');\n                        }\n                        if (clippingItem.canvas === undefined) {\n                            throw new Error('clippingItem.canvas undefined');\n                        }\n                        if (clippingItem.left === undefined) {\n                            throw new Error('clippingItem.left undefined');\n                        }\n                        if (clippingItem.top === undefined) {\n                            throw new Error('clippingItem.top undefined');\n                        }\n                        clippingCtx.globalCompositeOperation = getMixModeStr(\n                            clippingItem.blendMode,\n                        );\n                        clippingCtx.globalAlpha = clippingItem.opacity;\n                        clippingCtx.drawImage(\n                            clippingItem.canvas,\n                            clippingItem.left - item.left,\n                            clippingItem.top - item.top,\n                        );\n                    }\n\n                    ctx.globalCompositeOperation = 'source-atop';\n                    ctx.drawImage(clippingCanvas, item.left, item.top);\n                }\n\n                // group mask\n                if (psdGroupObj.mask) {\n                    ctx.globalCompositeOperation =\n                        psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                    if (psdGroupObj.mask.canvas === undefined) {\n                        throw new Error('psdGroupObj.mask.canvas undefined');\n                    }\n                    if (psdGroupObj.mask.left === undefined) {\n                        throw new Error('psdGroupObj.mask.left undefined');\n                    }\n                    if (psdGroupObj.mask.top === undefined) {\n                        throw new Error('psdGroupObj.mask.top undefined');\n                    }\n                    ctx.drawImage(\n                        psdGroupObj.mask.canvas,\n                        psdGroupObj.mask.left,\n                        psdGroupObj.mask.top,\n                    );\n                }\n\n                if (item.blendMode === undefined) {\n                    throw new Error('item.blendMode undefined');\n                }\n                if (item.hidden === undefined) {\n                    throw new Error('item.hidden  undefined');\n                }\n                if (item.opacity === undefined) {\n                    throw new Error('item.opacity undefined');\n                }\n\n                if (groupCanvas && groupCtx) {\n                    if (groupOpacity > 0) {\n                        groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\n                        groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\n                        groupCtx.drawImage(canvas, 0, 0);\n                    }\n                } else {\n                    if (item.name === undefined) {\n                        throw new Error('item.name undefined');\n                    }\n                    resultArr.push({\n                        name: item.name,\n                        isVisible: !item.hidden && groupIsVisible,\n                        opacity: item.opacity * groupOpacity,\n                        mixModeStr: getMixModeStr(item.blendMode),\n                        image: canvas,\n                    });\n                }\n            }\n        }\n\n        if (groupCanvas) {\n            if (psdGroupObj.name === undefined) {\n                throw new Error('psdGroupObj.name undefined');\n            }\n            resultArr = [\n                {\n                    name: psdGroupObj.name,\n                    isVisible: groupIsVisible,\n                    opacity: groupOpacity,\n                    mixModeStr: groupMixModeStr,\n                    image: groupCanvas,\n                },\n            ];\n        }\n\n        return resultArr;\n    }\n\n    result.layers = convertGroup({\n        name: 'root',\n        opacity: 1,\n        blendMode: 'normal',\n        children: psdObj.children,\n    });\n\n    return result;\n}\n\nexport function klPsdToKlProject(klPsd: TKlPsd): TKlProject {\n    // only share references to Canvas elements\n    const result: TKlProject = {\n        projectId: randomUuid(),\n        width: klPsd.width,\n        height: klPsd.height,\n        layers: [],\n    };\n    if (klPsd.layers) {\n        result.layers = klPsd.layers.map((item) => {\n            return {\n                name: item.name,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                image: item.image,\n            };\n        });\n    } else {\n        // flattened\n        result.layers = [\n            {\n                name: LANG('background'),\n                isVisible: true,\n                opacity: 1,\n                mixModeStr: 'source-over',\n                image: klPsd.canvas,\n            },\n        ];\n    }\n    return result;\n}\n","import { TFilter } from '../kl-types';\nimport glBrightnessContrastImg from 'url:/src/app/img/ui/edit-brightness-contrast.svg';\nimport cropExtendImg from 'url:/src/app/img/ui/edit-crop.svg';\nimport glCurvesImg from 'url:/src/app/img/ui/edit-curves.svg';\nimport flipImg from 'url:/src/app/img/ui/edit-flip.svg';\nimport glHueSaturationImg from 'url:/src/app/img/ui/edit-hue-saturation.svg';\nimport invertImg from 'url:/src/app/img/ui/edit-invert.png';\nimport glPerspectiveImg from 'url:/src/app/img/ui/edit-perspective.svg';\nimport resizeImg from 'url:/src/app/img/ui/edit-resize.svg';\nimport rotateImg from 'url:/src/app/img/ui/edit-rotate.svg';\nimport glTiltShiftImg from 'url:/src/app/img/ui/edit-tilt-shift.png';\nimport toAlphaImg from 'url:/src/app/img/ui/edit-to-alpha.svg';\nimport transformImg from 'url:/src/app/img/ui/edit-transform.svg';\nimport glBlurImg from 'url:/src/app/img/ui/edit-triangle-blur.png';\nimport glUnsharpMaskImg from 'url:/src/app/img/ui/edit-unsharp-mask.png';\nimport gridImg from 'url:/src/app/img/ui/edit-grid.svg';\nimport noiseImg from 'url:/src/app/img/ui/edit-noise.svg';\nimport patternImg from 'url:/src/app/img/ui/edit-pattern.svg';\nimport vanishPointImg from 'url:/src/app/img/ui/edit-vanish-point.svg';\nimport distortImg from 'url:/src/app/img/ui/edit-distort.svg';\n\nexport const FILTER_LIB_STATUS = {\n    isLoaded: false,\n};\nexport const FILTER_LIB: {\n    [key: string]: TFilter;\n} = {\n    brightnessContrast: {\n        lang: {\n            name: 'filter-bright-contrast-title',\n            button: 'filter-bright-contrast',\n            description: 'filter-bright-contrast-description',\n        },\n        icon: glBrightnessContrastImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    cropExtend: {\n        lang: {\n            name: 'filter-crop-title',\n            button: 'filter-crop-extend',\n            description: 'filter-crop-description',\n        },\n        icon: cropExtendImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    curves: {\n        lang: {\n            name: 'filter-curves-title',\n            button: 'filter-curves',\n            description: 'filter-curves-description',\n        },\n        icon: glCurvesImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    distort: {\n        lang: {\n            name: 'filter-distort',\n            button: 'filter-distort',\n            description: 'filter-distort-description',\n        },\n        icon: distortImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    flip: {\n        lang: {\n            name: 'filter-flip-title',\n            button: 'filter-flip',\n            description: 'filter-flip-description',\n        },\n        icon: flipImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    hueSaturation: {\n        lang: {\n            name: 'filter-hue-sat-title',\n            button: 'filter-hue-sat',\n            description: 'filter-hue-sat-description',\n        },\n        icon: glHueSaturationImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    invert: {\n        lang: {\n            name: 'filter-invert',\n            button: 'filter-invert',\n        },\n        icon: invertImg,\n        updatePos: false,\n        isInstant: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    perspective: {\n        lang: {\n            name: 'filter-perspective-title',\n            button: 'filter-perspective',\n            description: 'filter-perspective-description',\n        },\n        icon: glPerspectiveImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    resize: {\n        lang: {\n            name: 'filter-resize-title',\n            button: 'filter-resize',\n            description: 'filter-resize-description',\n        },\n        icon: resizeImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    rotate: {\n        lang: {\n            name: 'filter-rotate-title',\n            button: 'filter-rotate',\n            description: 'filter-rotate-description',\n        },\n        icon: rotateImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    tiltShift: {\n        lang: {\n            name: 'filter-tilt-shift-title',\n            button: 'filter-tilt-shift',\n            description: 'filter-tilt-shift-description',\n        },\n        icon: glTiltShiftImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    toAlpha: {\n        lang: {\n            name: 'filter-to-alpha-title',\n            button: 'filter-to-alpha',\n            description: 'filter-to-alpha-description',\n        },\n        icon: toAlphaImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    transform: {\n        lang: {\n            name: 'filter-transform-title',\n            button: 'filter-transform',\n            description: 'filter-transform-description',\n        },\n        icon: transformImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    blur: {\n        lang: {\n            name: 'filter-triangle-blur-title',\n            button: 'filter-triangle-blur',\n            description: 'filter-triangle-blur-description',\n        },\n        icon: glBlurImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    unsharpMask: {\n        lang: {\n            name: 'filter-unsharp-mask-title',\n            button: 'filter-unsharp-mask',\n            description: 'filter-unsharp-mask-description',\n        },\n        icon: glUnsharpMaskImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    grid: {\n        lang: {\n            name: 'filter-grid',\n            button: 'filter-grid',\n            description: 'filter-grid-description',\n        },\n        icon: gridImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    noise: {\n        lang: {\n            name: 'filter-noise',\n            button: 'filter-noise',\n            description: 'filter-noise-description',\n        },\n        icon: noiseImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    pattern: {\n        lang: {\n            name: 'filter-pattern',\n            button: 'filter-pattern',\n            description: 'filter-pattern-description',\n        },\n        icon: patternImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    vanishPoint: {\n        lang: {\n            name: 'filter-vanish-point-title',\n            button: 'filter-vanish-point',\n            description: 'filter-vanish-point-description',\n        },\n        icon: vanishPointImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n};\n","module.exports = parcelRequire.resolve(\"edit-brightness-contrast.801e17db.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-curves.f11acb76.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-flip.41de8f5f.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-hue-saturation.bd5ac257.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-invert.8023d182.png\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-perspective.4fe3a845.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-resize.9bfddd2a.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-tilt-shift.a1cb8c2a.png\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-to-alpha.70fac010.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-transform.fcc11c6b.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-triangle-blur.e071772f.png\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-unsharp-mask.6ffa0a5a.png\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-grid.bd32cfc5.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-noise.c4c69290.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-pattern.c2a47275.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-vanish-point.91c076dd.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"edit-distort.ff66b3d2.svg\") + \"?\" + Date.now();","import { PenBrush } from './pen-brush';\nimport { BlendBrush } from './blend-brush';\nimport { SketchyBrush } from './sketchy-brush';\nimport { PixelBrush } from './pixel-brush';\nimport { EraserBrush } from './eraser-brush';\nimport { SmudgeBrush } from './smudge-brush';\nimport { ChemyBrush } from './chemy-brush';\n\nexport const BRUSHES = {\n    PenBrush,\n    BlendBrush,\n    SketchyBrush,\n    PixelBrush,\n    ChemyBrush,\n    SmudgeBrush,\n    EraserBrush,\n};\n","import { BB } from '../../bb/bb';\nimport { ALPHA_IM_ARR } from './brushes-common';\nimport { TPressureInput, TRgb } from '../kl-types';\nimport { BezierLine } from '../../bb/math/line';\nimport { KlHistory } from '../history/kl-history';\nimport { getPushableLayerChange } from '../history/push-helpers/get-pushable-layer-change';\nimport { TBounds } from '../../bb/bb-types';\nimport { canvasAndChangedTilesToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\nimport { getChangedTiles, updateChangedTiles } from '../history/push-helpers/changed-tiles';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { getSelectionPath2d } from '../../bb/multi-polygon/get-selection-path-2d';\nimport { boundsOverlap, integerBounds } from '../../bb/math/math';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\n\nconst ALPHA_CIRCLE = 0;\nconst ALPHA_CHALK = 1;\nconst ALPHA_CAL = 2; // calligraphy\nconst ALPHA_SQUARE = 3;\n\nconst TWO_PI = 2 * Math.PI;\n\nexport class PenBrush {\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private klHistory: KlHistory = {} as KlHistory;\n\n    private settingHasOpacityPressure: boolean = false;\n    private settingHasScatterPressure: boolean = false;\n    private settingHasSizePressure: boolean = true;\n    private settingSize: number = 2;\n    private settingSpacing: number = 0.8489;\n    private settingOpacity: number = 1;\n    private settingScatter: number = 0;\n    private settingColor: TRgb = {} as TRgb;\n    private settingColorStr: string = '';\n    private settingAlphaId: number = ALPHA_CIRCLE;\n    private settingLockLayerAlpha: boolean = false;\n\n    private hasDrawnDot: boolean = false;\n    private lineToolLastDot: number = 0;\n    private lastInput: TPressureInput = { x: 0, y: 0, pressure: 0 };\n    private lastInput2: TPressureInput = { x: 0, y: 0, pressure: 0 };\n    private inputArr: TPressureInput[] = [];\n    private inputIsDrawing: boolean = false;\n    private bezierLine: BezierLine | null = null;\n\n    // mipmapping\n    private readonly alphaCanvas128: HTMLCanvasElement = BB.canvas(128, 128);\n    private readonly alphaCanvas64: HTMLCanvasElement = BB.canvas(64, 64);\n    private readonly alphaCanvas32: HTMLCanvasElement = BB.canvas(32, 32);\n    private readonly alphaOpacityArr: number[] = [1, 0.9, 1, 1];\n\n    private changedTiles: boolean[] = [];\n\n    private selection: MultiPolygon | undefined;\n    private selectionPath: Path2D | undefined;\n    private selectionBounds: TBounds | undefined;\n\n    private updateChangedTiles(bounds: TBounds) {\n        const boundsWithinSelection = boundsOverlap(bounds, this.selectionBounds);\n        if (!boundsWithinSelection) {\n            return;\n        }\n        this.changedTiles = updateChangedTiles(\n            this.changedTiles,\n            getChangedTiles(\n                boundsWithinSelection,\n                this.context.canvas.width,\n                this.context.canvas.height,\n            ),\n        );\n    }\n\n    private updateAlphaCanvas() {\n        if (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE) {\n            return;\n        }\n\n        const instructionArr: [HTMLCanvasElement, number][] = [\n            [this.alphaCanvas128, 128],\n            [this.alphaCanvas64, 64],\n            [this.alphaCanvas32, 32],\n        ];\n\n        let ctx;\n\n        for (let i = 0; i < instructionArr.length; i++) {\n            ctx = BB.ctx(instructionArr[i][0] as any);\n\n            ctx.save();\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.fillStyle =\n                'rgba(' +\n                this.settingColor.r +\n                ', ' +\n                this.settingColor.g +\n                ', ' +\n                this.settingColor.b +\n                ', ' +\n                this.alphaOpacityArr[this.settingAlphaId] +\n                ')';\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.globalCompositeOperation = 'destination-in';\n            ctx.imageSmoothingQuality = 'high';\n            ctx.drawImage(\n                ALPHA_IM_ARR[this.settingAlphaId],\n                0,\n                0,\n                instructionArr[i][1],\n                instructionArr[i][1],\n            );\n\n            ctx.restore();\n        }\n    }\n\n    private calcOpacity(pressure: number): number {\n        return this.settingOpacity * (this.settingHasOpacityPressure ? pressure * pressure : 1);\n    }\n\n    private calcScatter(pressure: number): number {\n        return (\n            this.settingScatter * this.settingSize * (this.settingHasScatterPressure ? pressure : 1)\n        );\n    }\n\n    /**\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     * @param scatter\n     * @param angle\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\n     */\n    private drawDot(\n        x: number,\n        y: number,\n        size: number,\n        opacity: number,\n        scatter: number,\n        angle?: number,\n        before?: [number, number, number, number, number, number | undefined],\n    ): void {\n        if (size <= 0) {\n            return;\n        }\n\n        if (this.settingLockLayerAlpha) {\n            this.context.globalCompositeOperation = 'source-atop';\n        }\n\n        if (!before || before[3] !== opacity) {\n            this.context.globalAlpha = opacity;\n        }\n\n        if (\n            !before &&\n            (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE)\n        ) {\n            this.context.fillStyle = this.settingColorStr;\n        }\n\n        if (scatter > 0) {\n            // scatter equally distributed over area of a circle\n            const scatterAngleRad = Math.random() * 2 * Math.PI;\n            const distance = Math.sqrt(Math.random()) * scatter;\n            x += Math.cos(scatterAngleRad) * distance;\n            y += Math.sin(scatterAngleRad) * distance;\n        }\n\n        const boundsSize =\n            this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_CAL\n                ? size\n                : size * Math.sqrt(2);\n        this.updateChangedTiles({\n            x1: Math.floor(x - boundsSize),\n            y1: Math.floor(y - boundsSize),\n            x2: Math.ceil(x + boundsSize),\n            y2: Math.ceil(y + boundsSize),\n        });\n\n        if (this.settingAlphaId === ALPHA_CIRCLE) {\n            this.context.beginPath();\n            this.context.arc(x, y, size, 0, TWO_PI);\n            this.context.closePath();\n            this.context.fill();\n            this.hasDrawnDot = true;\n        } else if (this.settingAlphaId === ALPHA_SQUARE) {\n            if (angle !== undefined) {\n                this.context.save();\n                this.context.translate(x, y);\n                this.context.rotate((angle / 180) * Math.PI);\n                this.context.fillRect(-size, -size, size * 2, size * 2);\n                this.context.restore();\n                this.hasDrawnDot = true;\n            }\n        } else {\n            // other brush alphas\n            this.context.save();\n            this.context.translate(x, y);\n            let targetMipmap = this.alphaCanvas128;\n            if (size <= 32 && size > 16) {\n                targetMipmap = this.alphaCanvas64;\n            } else if (size <= 16) {\n                targetMipmap = this.alphaCanvas32;\n            }\n            this.context.scale(size, size);\n            if (this.settingAlphaId === ALPHA_CHALK) {\n                this.context.rotate(((x + y) * 53123) % TWO_PI); // without mod it sometimes looks different\n            }\n            this.context.drawImage(targetMipmap, -1, -1, 2, 2);\n\n            this.context.restore();\n            this.hasDrawnDot = true;\n        }\n    }\n\n    // continueLine\n    private continueLine(x: number | null, y: number | null, size: number, pressure: number): void {\n        if (this.bezierLine === null) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\n        }\n\n        const drawArr: [number, number, number, number, number, number | undefined][] = []; //draw instructions. will be all drawn at once\n\n        const dotCallback = (val: {\n            x: number;\n            y: number;\n            t: number;\n            angle?: number;\n            dAngle: number;\n        }): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.calcOpacity(localPressure);\n            const localSize = Math.max(\n                0.1,\n                this.settingSize * (this.settingHasSizePressure ? localPressure : 1),\n            );\n            const localScatter = this.calcScatter(localPressure);\n            drawArr.push([val.x, val.y, localSize, localOpacity, localScatter, val.angle]);\n        };\n\n        const localSpacing = size * this.settingSpacing;\n        if (x === null || y === null) {\n            this.bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        this.context.save();\n        let before: (typeof drawArr)[number] | undefined = undefined;\n        for (let i = 0; i < drawArr.length; i++) {\n            const item = drawArr[i];\n            this.drawDot(item[0], item[1], item[2], item[3], item[4], item[5], before);\n            before = item;\n        }\n        this.context.restore();\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {}\n\n    // ---- interface ----\n\n    startLine(x: number, y: number, p: number): void {\n        this.selection = this.klHistory.getComposed().selection.value;\n        this.selectionPath = this.selection ? getSelectionPath2d(this.selection) : undefined;\n        this.selectionBounds = this.selection\n            ? integerBounds(getMultiPolyBounds(this.selection))\n            : undefined;\n\n        this.changedTiles = [];\n        p = BB.clamp(p, 0, 1);\n        const localOpacity = this.calcOpacity(p);\n        const localSize = this.settingHasSizePressure\n            ? Math.max(0.1, p * this.settingSize)\n            : Math.max(0.1, this.settingSize);\n        const localScatter = this.calcScatter(p);\n\n        this.hasDrawnDot = false;\n\n        this.inputIsDrawing = true;\n        this.context.save();\n        this.selectionPath && this.context.clip(this.selectionPath);\n        this.drawDot(x, y, localSize, localOpacity, localScatter);\n        this.context.restore();\n\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2.pressure = p;\n\n        this.inputArr = [\n            {\n                x,\n                y,\n                pressure: p,\n            },\n        ];\n    }\n\n    goLine(x: number, y: number, p: number): void {\n        if (!this.inputIsDrawing) {\n            return;\n        }\n\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure\n            ? Math.max(0.1, this.lastInput.pressure * this.settingSize)\n            : Math.max(0.1, this.settingSize);\n\n        this.context.save();\n        this.selectionPath && this.context.clip(this.selectionPath);\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n        /*context.fillStyle = 'red';\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\n\n        this.context.restore();\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput2.pressure = this.lastInput.pressure;\n        this.lastInput.pressure = pressure;\n\n        this.inputArr.push({\n            x,\n            y,\n            pressure: p,\n        });\n    }\n\n    endLine(): void {\n        const localSize = this.settingHasSizePressure\n            ? Math.max(0.1, this.lastInput.pressure * this.settingSize)\n            : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.selectionPath && this.context.clip(this.selectionPath);\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\n        this.context.restore();\n\n        this.inputIsDrawing = false;\n\n        if (this.settingAlphaId === ALPHA_SQUARE && !this.hasDrawnDot) {\n            // find max pressure input, use that one\n            let maxInput = this.inputArr[0];\n            this.inputArr.forEach((item) => {\n                if (item.pressure > maxInput.pressure) {\n                    maxInput = item;\n                }\n            });\n\n            this.context.save();\n            this.selectionPath && this.context.clip(this.selectionPath);\n            const p = BB.clamp(maxInput.pressure, 0, 1);\n            const localOpacity = this.calcOpacity(p);\n            const localScatter = this.calcScatter(p);\n            this.drawDot(maxInput.x, maxInput.y, localSize, localOpacity, localScatter, 0);\n            this.context.restore();\n        }\n\n        this.bezierLine = null;\n\n        if (this.changedTiles.some((item) => item)) {\n            this.klHistory.push(\n                getPushableLayerChange(\n                    this.klHistory.getComposed(),\n                    canvasAndChangedTilesToLayerTiles(this.context.canvas, this.changedTiles),\n                ),\n            );\n        }\n\n        this.hasDrawnDot = false;\n        this.inputArr = [];\n    }\n\n    drawLineSegment(x1: number, y1: number, x2: number, y2: number): void {\n        this.selection = this.klHistory.getComposed().selection.value;\n        this.selectionPath = this.selection ? getSelectionPath2d(this.selection) : undefined;\n        this.selectionBounds = this.selection\n            ? integerBounds(getMultiPolyBounds(this.selection))\n            : undefined;\n        this.changedTiles = [];\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n        this.lastInput.pressure = 1;\n\n        if (this.inputIsDrawing || x1 === undefined) {\n            return;\n        }\n\n        const angle = BB.pointsToAngleDeg({ x: x1, y: y1 }, { x: x2, y: y2 });\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        const bdist = this.settingSize * this.settingSpacing;\n        this.lineToolLastDot = this.settingSize * this.settingSpacing;\n        this.context.save();\n        this.selectionPath && this.context.clip(this.selectionPath);\n        const localScatter = this.calcScatter(1);\n        for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            this.drawDot(\n                x1 + eX * loopDist,\n                y1 + eY * loopDist,\n                this.settingSize,\n                this.settingOpacity,\n                localScatter,\n                angle,\n            );\n        }\n        this.context.restore();\n\n        if (this.changedTiles.some((item) => item)) {\n            this.klHistory.push(\n                getPushableLayerChange(\n                    this.klHistory.getComposed(),\n                    canvasAndChangedTilesToLayerTiles(this.context.canvas, this.changedTiles),\n                ),\n            );\n        }\n    }\n\n    //IS\n    isDrawing(): boolean {\n        return this.inputIsDrawing;\n    }\n\n    //SET\n    setAlpha(a: number): void {\n        if (this.settingAlphaId === a) {\n            return;\n        }\n        this.settingAlphaId = a;\n        this.updateAlphaCanvas();\n    }\n\n    setColor(c: TRgb): void {\n        if (this.settingColor === c) {\n            return;\n        }\n        this.settingColor = { r: c.r, g: c.g, b: c.b };\n        this.settingColorStr =\n            'rgb(' +\n            this.settingColor.r +\n            ',' +\n            this.settingColor.g +\n            ',' +\n            this.settingColor.b +\n            ')';\n        this.updateAlphaCanvas();\n    }\n\n    setContext(c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory(klHistory: KlHistory): void {\n        this.klHistory = klHistory;\n    }\n\n    setSize(s: number): void {\n        this.settingSize = s;\n    }\n\n    setOpacity(o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setScatter(o: number): void {\n        this.settingScatter = o;\n    }\n\n    setSpacing(s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure(b: boolean): void {\n        this.settingHasSizePressure = b;\n    }\n\n    opacityPressure(b: boolean): void {\n        this.settingHasOpacityPressure = b;\n    }\n\n    scatterPressure(b: boolean): void {\n        this.settingHasScatterPressure = b;\n    }\n\n    setLockAlpha(b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    //GET\n    getSpacing(): number {\n        return this.settingSpacing;\n    }\n\n    getSize(): number {\n        return this.settingSize;\n    }\n\n    getOpacity(): number {\n        return this.settingOpacity;\n    }\n\n    getScatter(): number {\n        return this.settingScatter;\n    }\n\n    getLockAlpha(): boolean {\n        return this.settingLockLayerAlpha;\n    }\n}\n","import { genBrushAlpha01, genBrushAlpha02 } from './alphas/brush-alphas';\n\nexport const ALPHA_IM_ARR: HTMLCanvasElement[] = []; // used by default brush\nALPHA_IM_ARR[1] = genBrushAlpha01(128);\nALPHA_IM_ARR[2] = genBrushAlpha02(128);\n","import { BB } from '../../../bb/bb';\nimport { noise } from '../../../bb/math/perlin';\nimport { TVector2D } from '../../../bb/bb-types';\n\n// chalk\nexport function genBrushAlpha01(w: number): HTMLCanvasElement {\n    const scaleFac = w / 500;\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    const ctx = BB.ctx(canvas);\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            const i = (y * w + x) * 4;\n\n            // base noise\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\n            let noisePattern =\n                100 + ((noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2) * 100;\n            noisePattern -= ((noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2) * 100;\n\n            // fade out in circular shape\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\n            const falloff = BB.clamp(\n                1 -\n                    ((centerDist - w / 2.5) / (w / 14) +\n                        noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\n                0,\n                1,\n            );\n            noisePattern = noisePattern * falloff;\n\n            // make the middle darker\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\n            noisePattern = noisePattern * falloff2;\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}\n\n// https://www.shadertoy.com/view/3tdSDj\nfunction udSegment(p: TVector2D, a: TVector2D, b: TVector2D): number {\n    const ba = BB.Vec2.sub(b, a);\n    const pa = BB.Vec2.sub(p, a);\n    const h = BB.clamp(BB.Vec2.dot(pa, ba) / BB.Vec2.dot(ba, ba), 0.0, 1.0);\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\n}\n\n// calligraphy\nexport function genBrushAlpha02(w: number): HTMLCanvasElement {\n    const pDist = 1 / 4;\n    let centerSize = 2 / 3;\n    let transitionSize = 1 / 3;\n    centerSize *= pDist;\n    transitionSize *= pDist;\n    const p1 = { x: pDist * w, y: w - w * pDist };\n    const p2 = { x: w - w * pDist, y: pDist * w };\n\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    const ctx = BB.ctx(canvas);\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            const i = (y * w + x) * 4;\n\n            let col = udSegment({ x: x, y: y }, p1, p2);\n\n            col = BB.clamp(255 - ((col - w * centerSize) / (w * transitionSize)) * 255, 0, 255);\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = col;\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}\n","/*\n * A speed-improved perlin and simplex noise algorithms for 2D.\n *\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\n * Better rank ordering method by Stefan Gustavson in 2012.\n * Converted to Javascript by Joseph Gentle.\n *\n * Version 2012-03-09\n *\n * This code was placed in the public domain by its original author,\n * Stefan Gustavson. You may use it as you see fit, but\n * attribution is appreciated.\n *\n */\n\nconst myModule = {} as any;\n\nclass Grad {\n    constructor(\n        public x: number,\n        public y: number,\n        public z: number,\n    ) {}\n\n    dot2(x: number, y: number): number {\n        return this.x * x + this.y * y;\n    }\n}\n/*\nGrad.prototype.dot3 = function(x, y, z) {\n    return this.x*x + this.y*y + this.z*z;\n};*/\n\nconst grad3 = [\n    new Grad(1, 1, 0),\n    new Grad(-1, 1, 0),\n    new Grad(1, -1, 0),\n    new Grad(-1, -1, 0),\n    new Grad(1, 0, 1),\n    new Grad(-1, 0, 1),\n    new Grad(1, 0, -1),\n    new Grad(-1, 0, -1),\n    new Grad(0, 1, 1),\n    new Grad(0, -1, 1),\n    new Grad(0, 1, -1),\n    new Grad(0, -1, -1),\n];\n\nconst p = [\n    151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69,\n    142, 8, 99, 37, 240, 21, 10, 23, 190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219,\n    203, 117, 35, 11, 32, 57, 177, 33, 88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168, 68, 175,\n    74, 165, 71, 134, 139, 48, 27, 166, 77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230,\n    220, 105, 92, 41, 55, 46, 245, 40, 244, 102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76,\n    132, 187, 208, 89, 18, 169, 200, 196, 135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186,\n    3, 64, 52, 217, 226, 250, 124, 123, 5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59,\n    227, 47, 16, 58, 17, 182, 189, 28, 42, 223, 183, 170, 213, 119, 248, 152, 2, 44, 154, 163, 70,\n    221, 153, 101, 155, 167, 43, 172, 9, 129, 22, 39, 253, 19, 98, 108, 110, 79, 113, 224, 232, 178,\n    185, 112, 104, 218, 246, 97, 228, 251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81,\n    51, 145, 235, 249, 14, 239, 107, 49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115,\n    121, 50, 45, 127, 4, 150, 254, 138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195,\n    78, 66, 215, 61, 156, 180,\n];\n// To remove the need for index wrapping, double the permutation table length\nconst perm = new Array(512);\nconst gradP = new Array(512);\n\n// This isn't a very good seeding function, but it works ok. It supports 2^16\n// different seed values. Write something better if you need more seeds.\nmyModule.seed = function (seed: number): void {\n    if (seed > 0 && seed < 1) {\n        // Scale the seed out\n        seed *= 65536;\n    }\n\n    seed = Math.floor(seed);\n    if (seed < 256) {\n        seed |= seed << 8;\n    }\n\n    for (let i = 0; i < 256; i++) {\n        let v;\n        if (i & 1) {\n            v = p[i] ^ (seed & 255);\n        } else {\n            v = p[i] ^ ((seed >> 8) & 255);\n        }\n\n        perm[i] = perm[i + 256] = v;\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\n    }\n};\n\nmyModule.seed(0);\n\n/*\nfor (let i=0; i<256; i++) {\n  perm[i] = perm[i + 256] = p[i];\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\n}*/\n\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\nconst F2 = 0.5 * (Math.sqrt(3) - 1);\nconst G2 = (3 - Math.sqrt(3)) / 6;\n\n/*let F3 = 1/3;\nlet G3 = 1/6;*/\n\n// 2D simplex noise\nmyModule.simplex2 = function (xin: number, yin: number): number {\n    let n0, n1, n2; // Noise contributions from the three corners\n    // Skew the input space to determine which simplex cell we're in\n    const s = (xin + yin) * F2; // Hairy factor for 2D\n    let i = Math.floor(xin + s);\n    let j = Math.floor(yin + s);\n    const t = (i + j) * G2;\n    const x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\n    const y0 = yin - j + t;\n    // For the 2D case, the simplex shape is an equilateral triangle.\n    // Determine which simplex we are in.\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n    if (x0 > y0) {\n        // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n        i1 = 1;\n        j1 = 0;\n    } else {\n        // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n        i1 = 0;\n        j1 = 1;\n    }\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n    // c = (3-sqrt(3))/6\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n    const y1 = y0 - j1 + G2;\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\n    const y2 = y0 - 1 + 2 * G2;\n    // Work out the hashed gradient indices of the three simplex corners\n    i &= 255;\n    j &= 255;\n    const gi0 = gradP[i + perm[j]];\n    const gi1 = gradP[i + i1 + perm[j + j1]];\n    const gi2 = gradP[i + 1 + perm[j + 1]];\n    // Calculate the contribution from the three corners\n    let t0 = 0.5 - x0 * x0 - y0 * y0;\n    if (t0 < 0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot2(x0, y0); // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.5 - x1 * x1 - y1 * y1;\n    if (t1 < 0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\n    }\n    let t2 = 0.5 - x2 * x2 - y2 * y2;\n    if (t2 < 0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 70 * (n0 + n1 + n2);\n};\n/*\n// 3D simplex noise\nmyModule.simplex3 = function(xin, yin, zin) {\n    let n0, n1, n2, n3; // Noise contributions from the four corners\n\n    // Skew the input space to determine which simplex cell we're in\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\n    let i = Math.floor(xin+s);\n    let j = Math.floor(yin+s);\n    let k = Math.floor(zin+s);\n\n    let t = (i+j+k)*G3;\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\n    let y0 = yin-j+t;\n    let z0 = zin-k+t;\n\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n    // Determine which simplex we are in.\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n    if (x0 >= y0) {\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\n    } else {\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\n    }\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n    // c = 1/6.\n    let x1 = x0 - i1 + G3; // Offsets for second corner\n    let y1 = y0 - j1 + G3;\n    let z1 = z0 - k1 + G3;\n\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\n    let y2 = y0 - j2 + 2 * G3;\n    let z2 = z0 - k2 + 2 * G3;\n\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\n    let y3 = y0 - 1 + 3 * G3;\n    let z3 = z0 - 1 + 3 * G3;\n\n    // Work out the hashed gradient indices of the four simplex corners\n    i &= 255;\n    j &= 255;\n    k &= 255;\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\n\n    // Calculate the contribution from the four corners\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\n    if (t0<0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\n    if (t1<0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\n    }\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\n    if (t2<0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\n    }\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\n    if (t3<0) {\n        n3 = 0;\n    } else {\n        t3 *= t3;\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 32 * (n0 + n1 + n2 + n3);\n\n};\n*/\n// ##### Perlin noise stuff\n/*\nfunction fade(t) {\n    return t*t*t*(t*(t*6-15)+10);\n}\n\nfunction lerp(a, b, t) {\n    return (1-t)*a + t*b;\n}\n\n// 2D Perlin Noise\nmyModule.perlin2 = function(x, y) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y);\n    // Get relative xy coordinates of point within that cell\n    x = x - X; y = y - Y;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255;\n\n    // Calculate noise contributions from each of the four corners\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\n\n    // Compute the fade curve value for x\n    let u = fade(x);\n\n    // Interpolate the four results\n    return lerp(\n        lerp(n00, n10, u),\n        lerp(n01, n11, u),\n        fade(y));\n};*/\n/*\n// 3D Perlin Noise\nmyModule.perlin3 = function(x, y, z) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\n    // Get relative xyz coordinates of point within that cell\n    x = x - X; y = y - Y; z = z - Z;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255; Z = Z & 255;\n\n    // Calculate noise contributions from each of the eight corners\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\n\n    // Compute the fade curve value for x, y, z\n    let u = fade(x);\n    let v = fade(y);\n    let w = fade(z);\n\n    // Interpolate\n    return lerp(\n        lerp(\n            lerp(n000, n100, u),\n            lerp(n001, n101, u), w),\n        lerp(\n            lerp(n010, n110, u),\n            lerp(n011, n111, u), w),\n        v);\n};*/\n\nexport const noise = myModule;\n","import {\n    THistoryEntryData,\n    THistoryEntryDataComposed,\n    THistoryEntryLayerTile,\n} from '../history.types';\nimport { canvasToLayerTiles } from './canvas-to-layer-tiles';\n\n// create a history entry where the currently active layer changes its tiles\nexport function getPushableLayerChange(\n    composed: THistoryEntryDataComposed,\n    imageOrTiles: HTMLCanvasElement | (THistoryEntryLayerTile | undefined)[],\n): THistoryEntryData {\n    const activeLayerId = composed.activeLayerId;\n    const layerMap = Object.fromEntries(\n        Object.entries(composed.layerMap).map(([layerId, layerItem]) => {\n            if (layerId === activeLayerId) {\n                return [\n                    layerId,\n                    {\n                        tiles:\n                            imageOrTiles instanceof HTMLCanvasElement\n                                ? canvasToLayerTiles(imageOrTiles)\n                                : [...imageOrTiles],\n                    },\n                ];\n            }\n\n            return [layerId, {}];\n        }),\n    );\n    return {\n        layerMap,\n    };\n}\n","import { BB } from '../../bb/bb';\nimport { isLayerFill, TRgb, TRgba } from '../kl-types';\nimport { TBounds, TPressureInput } from '../../bb/bb-types';\nimport { boundsOverlap, clamp, integerBounds } from '../../bb/math/math';\nimport { BezierLine, TBezierLineCallback } from '../../bb/math/line';\nimport { HISTORY_TILE_SIZE, KlHistory } from '../history/kl-history';\nimport { getPushableLayerChange } from '../history/push-helpers/get-pushable-layer-change';\nimport { copyImageData } from '../utils/copy-image-data';\nimport { createArray } from '../../bb/base/base';\nimport { createImageDataTile } from '../history/image-data-tile';\nimport { getBinaryMask } from '../select-tool/get-binary-mask';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\nimport { getChangedTiles } from '../history/push-helpers/changed-tiles';\n\ntype TDrawBufferItem = {\n    x: number;\n    y: number;\n    size: number;\n    opacity: number;\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n    r: number;\n    g: number;\n    b: number;\n};\n\nexport class BlendBrush {\n    // testing mode - context only gets updated when line is finished\n    private isTesting: boolean = false;\n\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private layerId: string = 'NOT_SET';\n    private color: TRgb = {} as TRgb;\n    private size: number = 29; // radius - 0.5 - 99999\n    private opacity: number = 0.6; // 0-1\n    private blending: number = 0.65; // 0-1\n\n    private settingLockLayerAlpha: boolean = false;\n    private settingSizePressure: boolean = true;\n    private settingOpacityPressure: boolean = false;\n\n    private blendCol: TRgba = { r: 0, g: 0, b: 0, a: 1 }; // todo docs\n    private blendMix: number = 0.45; // todo docs\n    private mixCol: TRgb = { r: 0, g: 0, b: 0 }; // todo docs\n    private localColOld: TRgba = {} as TRgba; // todo docs\n\n    private isDrawing: boolean = false;\n    private lastInput: TPressureInput = { x: 0, y: 0, pressure: 0 }; // todo docs\n    private lastInput2: TPressureInput = { x: 0, y: 0, pressure: 0 }; // todo docs\n    private bezierLine: undefined | BezierLine;\n\n    private klHistory: KlHistory = {} as KlHistory;\n    private redrawBounds: TBounds | undefined;\n    private cells: (ImageData | undefined)[] = [];\n    private drawBuffer: TDrawBufferItem[] = [];\n\n    private selectionBounds: TBounds | undefined;\n    private mask: Uint8Array | undefined;\n\n    private updateRedrawBounds(bounds: TBounds): void {\n        const boundsWithinSelection = boundsOverlap(bounds, this.selectionBounds);\n        if (!boundsWithinSelection) {\n            return;\n        }\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, boundsWithinSelection);\n    }\n\n    private getCellsWidth(): number {\n        return Math.ceil(this.context.canvas.width / HISTORY_TILE_SIZE);\n    }\n\n    /**\n     * draw cells onto context\n     * @param cells\n     */\n    private drawCells(cells: (ImageData | undefined)[]): void {\n        const cellsW = this.getCellsWidth();\n        cells.forEach((imageData, index) => {\n            if (!imageData) {\n                return;\n            }\n            const cellOffsetX = (index % cellsW) * HISTORY_TILE_SIZE;\n            const cellOffsetY = Math.floor(index / cellsW) * HISTORY_TILE_SIZE;\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\n        });\n    }\n\n    /**\n     * draw changed cells (changed by brushstroke) onto context\n     * @private\n     */\n    private drawChangedCells(): void {\n        if (!this.redrawBounds) {\n            return;\n        }\n\n        const cells: typeof this.cells = this.cells.map(() => undefined);\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\n        touchedCells.forEach((isTouched, index) => {\n            if (isTouched) {\n                cells[index] = this.cells[index];\n            }\n        });\n        this.drawCells(cells);\n        this.redrawBounds = undefined;\n    }\n\n    private getTouchedCells(bounds: TBounds): boolean[] {\n        const touchedCells = this.cells.map(() => false);\n        const cellsW = this.getCellsWidth();\n        bounds = {\n            x1: Math.floor(bounds.x1 / HISTORY_TILE_SIZE),\n            y1: Math.floor(bounds.y1 / HISTORY_TILE_SIZE),\n            x2: Math.floor(bounds.x2 / HISTORY_TILE_SIZE),\n            y2: Math.floor(bounds.y2 / HISTORY_TILE_SIZE),\n        };\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\n                touchedCells[e * cellsW + i] = true;\n            }\n        }\n        return touchedCells;\n    }\n\n    /**\n     * Slice up bounds according to cells\n     * @param bounds\n     * @private\n     */\n    private sliceBounds(bounds: TBounds): { index: number; bounds: TBounds }[] {\n        const boundsWithinSelection = boundsOverlap(bounds, this.selectionBounds);\n        if (!boundsWithinSelection) {\n            return [];\n        }\n        const cellsW = this.getCellsWidth();\n        const result: { index: number; bounds: TBounds }[] = [];\n        const touchedCells = this.getTouchedCells(boundsWithinSelection);\n\n        touchedCells.forEach((cell, i) => {\n            if (!cell) {\n                return;\n            }\n\n            const cellOffsetX = (i % cellsW) * HISTORY_TILE_SIZE;\n            const cellOffsetY = Math.floor(i / cellsW) * HISTORY_TILE_SIZE;\n            const cellWidth = this.cells[i]!.width;\n            const cellHeight = this.cells[i]!.height;\n\n            const inCellBounds = {\n                x1: Math.max(0, boundsWithinSelection.x1 - cellOffsetX),\n                y1: Math.max(0, boundsWithinSelection.y1 - cellOffsetY),\n                x2: Math.min(cellWidth - 1, boundsWithinSelection.x2 - cellOffsetX),\n                y2: Math.min(cellHeight - 1, boundsWithinSelection.y2 - cellOffsetY),\n            };\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\n                return;\n            }\n            result.push({\n                index: i,\n                bounds: inCellBounds,\n            });\n        });\n\n        return result;\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    private copyFromCanvas(bounds: TBounds | undefined): void {\n        if (!bounds) {\n            return;\n        }\n\n        const touchedCells = this.getTouchedCells(bounds);\n        const composedLayer = this.klHistory.getComposed().layerMap[this.layerId];\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.cells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            const composedTile = composedLayer.tiles[i];\n            if (isLayerFill(composedTile)) {\n                const canvas = BB.canvas(HISTORY_TILE_SIZE, HISTORY_TILE_SIZE);\n                const ctx = BB.ctx(canvas);\n                ctx.fillStyle = composedTile.fill;\n                ctx.fillRect(0, 0, HISTORY_TILE_SIZE, HISTORY_TILE_SIZE);\n                this.cells[i] = ctx.getImageData(0, 0, HISTORY_TILE_SIZE, HISTORY_TILE_SIZE);\n            } else {\n                this.cells[i] = copyImageData(composedTile.data);\n            }\n        });\n    }\n\n    private getAverage(x: number, y: number, size: number): TRgba {\n        size = Math.max(0.5, size * 0.75);\n        const x1 = Math.max(0, Math.floor(x - size));\n        const y1 = Math.max(0, Math.floor(y - size));\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return { r: 0, g: 0, b: 0, a: 0 };\n        }\n\n        let ar = 0,\n            ag = 0,\n            ab = 0,\n            aa = 0;\n\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\n        const cellsW = this.getCellsWidth();\n\n        slicedBounds.forEach((slice) => {\n            const cellOffsetX = (slice.index % cellsW) * HISTORY_TILE_SIZE;\n            const cellOffsetY = Math.floor(slice.index / cellsW) * HISTORY_TILE_SIZE;\n            const width = this.cells[slice.index]!.width;\n            const data = this.cells[slice.index]!.data;\n            const bounds = slice.bounds;\n\n            for (let i = bounds.y1, globalY = i + cellOffsetY; i <= bounds.y2; i++, globalY++) {\n                for (\n                    let e = bounds.x1, globalX = e + cellOffsetX, e2 = (i * width + bounds.x1) * 4;\n                    e <= bounds.x2;\n                    e++, globalX++, e2 += 4\n                ) {\n                    if (\n                        this.mask &&\n                        this.mask[globalY * this.context.canvas.width + globalX] === 0\n                    ) {\n                        // don't same where the mask is 0\n                        continue;\n                    }\n\n                    const alpha = data[e2 + 3] / 255;\n                    if (alpha === 0) {\n                        continue;\n                    }\n\n                    ar += data[e2] * alpha;\n                    ag += data[e2 + 1] * alpha;\n                    ab += data[e2 + 2] * alpha;\n                    aa += alpha;\n                }\n            }\n        });\n\n        if (aa !== 0) {\n            ar /= aa;\n            ag /= aa;\n            ab /= aa;\n            aa = Math.min(1, aa);\n        }\n        return { r: ar, g: ag, b: ab, a: aa };\n    }\n\n    private getDotBounds(x: number, y: number, size: number): TBounds | undefined {\n        size = Math.max(0.5, size);\n        const x1 = Math.max(0, Math.floor(x - size));\n        const y1 = Math.max(0, Math.floor(y - size));\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return undefined;\n        }\n        return { x1, y1, x2, y2 };\n    }\n\n    private drawDot(params: TDrawBufferItem): void {\n        // array with random numbers. faster than Math.random()\n        let randI = 0;\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n        const randArr: number[] = [];\n        for (let i = 0; i < randLen; i++) {\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n        }\n\n        // thin lines take more than just 1 sample\n        const sampleArr = [8, 4, 4, 4, 2, 2, 2, 2, 2, 2]; // <0.5, 0.5, 1, 1.5, etc.\n        const samples = sampleArr[Math.floor(params.size * 2)];\n        const samplesSquared: number = samples ? samples * samples : 0;\n        const sampleOffsets: number[] = [];\n        if (samples) {\n            let i = 0;\n            for (let n = 0; n < samples; n++) {\n                for (let m = 0; m < samples; m++, i += 2) {\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\n                }\n            }\n        }\n\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\n        // to optimize calculations\n        const invSharpness = 1 - sharpness;\n        const sharpnessSubtrahend = sharpness / invSharpness;\n        const sizeSquared = params.size * params.size;\n        const distDivisor = (sizeSquared * invSharpness) / params.opacity;\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\n\n        const slicedBounds = this.sliceBounds({\n            x1: params.x1,\n            y1: params.y1,\n            x2: params.x2,\n            y2: params.y2,\n        });\n\n        const cellsW = this.getCellsWidth();\n        slicedBounds.forEach((slice) => {\n            const cellOffsetX = (slice.index % cellsW) * HISTORY_TILE_SIZE;\n            const cellOffsetY = Math.floor(slice.index / cellsW) * HISTORY_TILE_SIZE;\n            const cellWidth = this.cells[slice.index]!.width;\n            const data = this.cells[slice.index]!.data;\n\n            // i - y index within cell\n            // e - x index within cell\n\n            // e2 - index in image data (a tile)\n            // mi - index in mask (one mask for the entire image)\n\n            // ri - y index within image relative to dot-center\n            // re - x index within image relative to dot-center\n\n            for (\n                let i = slice.bounds.y1, ri = i + cellOffsetY - params.y;\n                i <= slice.bounds.y2;\n                i++, ri++\n            ) {\n                for (\n                    let e = slice.bounds.x1,\n                        mi =\n                            (i + cellOffsetY) * this.context.canvas.width +\n                            (slice.bounds.x1 + cellOffsetX),\n                        e2 = (i * cellWidth + slice.bounds.x1) * 4,\n                        re = e + cellOffsetX - params.x;\n                    e <= slice.bounds.x2;\n                    e++, mi++, e2 += 4, re++\n                ) {\n                    if (this.mask && this.mask[mi] === 0) {\n                        continue;\n                    }\n\n                    // O = over -> brush-dot\n                    // U = under -> image\n\n                    let alphaO = 0;\n                    if (samplesSquared) {\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\n                            const dist = BB.lenSquared(\n                                re + sampleOffsets[f],\n                                ri + sampleOffsets[f + 1],\n                            );\n                            if (dist >= sizeSquared) {\n                                continue;\n                            }\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                        }\n                        if (!alphaO) {\n                            continue;\n                        }\n                        alphaO /= samplesSquared;\n                    } else {\n                        // technically needs + 0.5 offset, but not noticeable with large brush\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\n                        if (dist >= sizeSquared) {\n                            continue;\n                        }\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                    }\n\n                    const invAlphaO = 1 - alphaO;\n                    const alphaU = data[e2 + 3] / 255;\n\n                    if (this.settingLockLayerAlpha) {\n                        const underR = params.r * alphaO + data[e2] * invAlphaO;\n                        const underG = params.g * alphaO + data[e2 + 1] * invAlphaO;\n                        const underB = params.b * alphaO + data[e2 + 2] * invAlphaO;\n                        if (alphaU) {\n                            data[e2] = Math.floor(underR + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\n                        }\n                    } else {\n                        const underR = params.r * alphaO + data[e2] * alphaU * invAlphaO;\n                        const underG = params.g * alphaO + data[e2 + 1] * alphaU * invAlphaO;\n                        const underB = params.b * alphaO + data[e2 + 2] * alphaU * invAlphaO;\n\n                        const newAlpha = 1 - invAlphaO * (1 - alphaU);\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\n                        if (newAlpha) {\n                            data[e2] = Math.floor(underR / newAlpha + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG / newAlpha + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB / newAlpha + randArr[randI]);\n                        }\n                    }\n                    randI = (randI + 1) % randLen;\n                }\n            }\n        });\n    }\n\n    private calcSpacing(size: number): number {\n        return BB.mix(\n            (size * 2) / 2, // until size 5.3\n            (size * 2) / 9, // at size 24\n            clamp((size - 2.7) / (12 - 2.7), 0, 1),\n        );\n    }\n\n    private continueLine(\n        x: number | undefined,\n        y: number | undefined,\n        p: number,\n        isCoalesced: boolean,\n    ): void {\n        this.drawBuffer = [];\n\n        let localPressure;\n        let localOpacity;\n        let localSize = this.settingSizePressure\n            ? Math.max(1, p * this.size)\n            : Math.max(1, this.size);\n\n        const bDist = this.calcSpacing(localSize);\n\n        const avgX = x === undefined ? this.lastInput.x : x;\n        const avgY = y === undefined ? this.lastInput.y : y;\n\n        let localColNew: TRgba;\n\n        if (this.blending === 0) {\n            this.mixCol.r = this.color.r;\n            this.mixCol.g = this.color.g;\n            this.mixCol.b = this.color.b;\n        } else {\n            let average;\n            if (isCoalesced) {\n                average = {\n                    r: this.localColOld.r,\n                    g: this.localColOld.g,\n                    b: this.localColOld.b,\n                    a: 0,\n                };\n            } else {\n                const avgParams = [\n                    avgX,\n                    avgY,\n                    this.settingSizePressure\n                        ? Math.max(0.5, p * this.size)\n                        : Math.max(0.5, this.size),\n                ];\n                const bounds = this.getDotBounds(avgParams[0], avgParams[1], avgParams[2]);\n                if (bounds) {\n                    this.copyFromCanvas(bounds);\n                }\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\n            }\n            localColNew = { r: 0, g: 0, b: 0, a: 0 };\n\n            if (average.a > 0 && this.blendCol.a === 0) {\n                this.blendCol.r = average.r;\n                this.blendCol.g = average.g;\n                this.blendCol.b = average.b;\n                this.blendCol.a = average.a;\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n            } else {\n                if (average.a === 0) {\n                    average.r = this.color.r;\n                    average.g = this.color.g;\n                    average.b = this.color.b;\n                    average.a = 1 - this.blending;\n                }\n\n                this.blendCol.r = BB.mix(\n                    this.blendCol.r,\n                    BB.mix(this.blendCol.r, average.r, this.blendMix),\n                    average.a,\n                );\n                this.blendCol.g = BB.mix(\n                    this.blendCol.g,\n                    BB.mix(this.blendCol.g, average.g, this.blendMix),\n                    average.a,\n                );\n                this.blendCol.b = BB.mix(\n                    this.blendCol.b,\n                    BB.mix(this.blendCol.b, average.b, this.blendMix),\n                    average.a,\n                );\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n            }\n        }\n\n        const bezierCallback: TBezierLineCallback = (val) => {\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\n                return;\n            }\n            const factor = val.t;\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = this.settingOpacityPressure\n                ? this.opacity * localPressure * localPressure\n                : this.opacity;\n            localSize = this.settingSizePressure\n                ? Math.max(0.1, localPressure * this.size)\n                : Math.max(0.1, this.size);\n            if (this.blending != 0) {\n                this.mixCol.r = BB.mix(this.localColOld.r, localColNew.r, factor);\n                this.mixCol.g = BB.mix(this.localColOld.g, localColNew.g, factor);\n                this.mixCol.b = BB.mix(this.localColOld.b, localColNew.b, factor);\n            }\n            if (this.blending === 1 && this.localColOld.a === 0) {\n                this.mixCol.r = localColNew.r;\n                this.mixCol.g = localColNew.g;\n                this.mixCol.b = localColNew.b;\n            }\n            const bounds = this.getDotBounds(val.x, val.y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: val.x,\n                    y: val.y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixCol.r, this.blending),\n                    g: BB.mix(this.color.g, this.mixCol.g, this.blending),\n                    b: BB.mix(this.color.b, this.mixCol.b, this.blending),\n                });\n            }\n        };\n\n        if (x === undefined || y === undefined) {\n            this.bezierLine!.addFinal(bDist, bezierCallback);\n        } else {\n            this.bezierLine!.add(x, y, bDist, bezierCallback);\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach((item) => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.localColOld = localColNew!;\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {}\n\n    setHistory(klHistory: KlHistory): void {\n        this.klHistory = klHistory;\n    }\n\n    getSize(): number {\n        return this.size;\n    }\n\n    setSize(s: number): void {\n        this.size = s;\n    }\n\n    getOpacity(): number {\n        return this.opacity;\n    }\n\n    setOpacity(o: number): void {\n        this.opacity = o;\n    }\n\n    getBlending(): number {\n        return this.blending;\n    }\n\n    setBlending(b: number): void {\n        this.blending = b;\n    }\n\n    setColor(c: TRgb): void {\n        this.color = BB.copyObj(c);\n    }\n\n    setContext(c: CanvasRenderingContext2D, id: string): void {\n        this.context = c;\n        this.layerId = id;\n    }\n\n    setSizePressure(b: boolean): void {\n        this.settingSizePressure = b;\n    }\n\n    setOpacityPressure(b: boolean): void {\n        this.settingOpacityPressure = b;\n    }\n\n    getLockAlpha(): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha(b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    getIsDrawing(): boolean {\n        return this.isDrawing;\n    }\n\n    setIsTesting(b: boolean): void {\n        this.isTesting = b;\n    }\n\n    startLine(x: number, y: number, p: number): void {\n        const selection = this.klHistory.getComposed().selection.value;\n        this.selectionBounds = selection ? integerBounds(getMultiPolyBounds(selection)) : undefined;\n        this.mask = selection\n            ? getBinaryMask(selection, this.context.canvas.width, this.context.canvas.height)\n            : undefined;\n        const totalCells =\n            Math.ceil(this.context.canvas.width / HISTORY_TILE_SIZE) *\n            Math.ceil(this.context.canvas.height / HISTORY_TILE_SIZE);\n        this.cells = createArray(totalCells, undefined);\n\n        this.isDrawing = true;\n\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = this.settingOpacityPressure ? this.opacity * p * p : this.opacity;\n        const localSize = this.settingSizePressure\n            ? Math.max(0.1, p * this.size)\n            : Math.max(0.1, this.size);\n        if (this.blending === 0) {\n            this.mixCol.r = this.color.r;\n            this.mixCol.g = this.color.g;\n            this.mixCol.b = this.color.b;\n        } else {\n            this.copyFromCanvas(this.getDotBounds(x, y, localSize));\n\n            const average = this.getAverage(\n                x,\n                y,\n                this.settingSizePressure ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size),\n            );\n            if (average.a === 0) {\n                this.blendCol = {\n                    r: this.color.r,\n                    g: this.color.g,\n                    b: this.color.b,\n                    a: 1 - this.blending,\n                };\n            } else {\n                this.blendCol = {\n                    r: average.r,\n                    g: average.g,\n                    b: average.b,\n                    a: average.a,\n                };\n            }\n\n            this.mixCol.r = this.blendCol.r;\n            this.mixCol.g = this.blendCol.g;\n            this.mixCol.b = this.blendCol.b;\n        }\n\n        this.localColOld = {\n            r: this.mixCol.r,\n            g: this.mixCol.g,\n            b: this.mixCol.b,\n            a: this.blendCol.a,\n        };\n\n        this.redrawBounds = undefined;\n        this.drawBuffer = [];\n\n        if (this.blending < 1 || this.blendCol.a > 0) {\n            const bounds = this.getDotBounds(x, y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: x,\n                    y: y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixCol.r, this.blending),\n                    g: BB.mix(this.color.g, this.mixCol.g, this.blending),\n                    b: BB.mix(this.color.b, this.mixCol.b, this.blending),\n                });\n            }\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach((item) => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.bezierLine = new BB.BezierLine();\n        this.bezierLine.add(x, y, 0, function () {});\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n\n        if (!this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    goLine(x: number, y: number, p: number, isCoalesced: boolean): void {\n        if (!this.isDrawing) {\n            return;\n        }\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n\n        if (!this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    endLine(): void {\n        if (this.bezierLine) {\n            this.continueLine(undefined, undefined, this.lastInput.pressure, false);\n        }\n\n        this.isDrawing = false;\n        this.bezierLine = undefined;\n\n        this.drawChangedCells();\n\n        if (this.cells.some((item) => item)) {\n            let cells = this.cells;\n            if (this.selectionBounds) {\n                const tilesInSelection = getChangedTiles(\n                    this.selectionBounds,\n                    this.context.canvas.width,\n                    this.context.canvas.height,\n                );\n                cells = cells.map((cell, index) => {\n                    return tilesInSelection[index] ? cell : undefined;\n                });\n            }\n\n            this.klHistory.push(\n                getPushableLayerChange(\n                    this.klHistory.getComposed(),\n                    cells.map((cell) => {\n                        return cell ? createImageDataTile(cell) : undefined;\n                    }),\n                ),\n            );\n        }\n        this.cells = [];\n    }\n\n    drawLineSegment(x1: number, y1: number, x2: number, y2: number): void {\n        const dx = x2 - x1;\n        const dy = y2 - y1;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        const steps = Math.ceil(distance / 10);\n\n        this.startLine(x1, y1, 1);\n\n        for (let i = 1; i <= steps; i++) {\n            const t = i / steps;\n            const xi = x1 + dx * t;\n            const yi = y1 + dy * t;\n            this.goLine(xi, yi, 1, false);\n        }\n\n        this.endLine();\n    }\n}\n","import { BB } from '../../bb/bb';\nimport { TPressureInput, TRgb } from '../kl-types';\nimport { KlHistory } from '../history/kl-history';\nimport { getPushableLayerChange } from '../history/push-helpers/get-pushable-layer-change';\nimport { TBounds } from '../../bb/bb-types';\nimport { canvasToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { getSelectionPath2d } from '../../bb/multi-polygon/get-selection-path-2d';\nimport { boundsOverlap, integerBounds } from '../../bb/math/math';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\n\nconst sampleCanvas = BB.canvas(32, 32);\nconst sampleCtx = BB.ctx(sampleCanvas);\n\nexport class SketchyBrush {\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private settingColor: TRgb = {} as TRgb;\n    private settingSize: number = 1;\n    private settingOpacity: number = 0.2;\n    private settingBlending: number = 0.5;\n    private settingScale: number = 1;\n    private lastX: number = 0;\n    private lastY: number = 0;\n    private inputIsDrawing: boolean = false;\n    private lastInput: TPressureInput = { x: 0, y: 0, pressure: 0 };\n    private klHistory: KlHistory = {} as KlHistory;\n    private sketchySeed: number = 0;\n    private points: [number, number][] = []; // x y\n    private count: number = 0;\n    private readonly mixMode = [\n        (c1: TRgb): TRgb => {\n            return c1;\n        },\n        (c1: TRgb, c2: TRgb): TRgb => {\n            // why\n            const result = new BB.RGB(c1.r, c1.g, c1.b);\n            result.r *= c2.r / 255;\n            result.g *= c2.g / 255;\n            result.b *= c2.b / 255;\n            return result;\n        },\n    ];\n\n    private changedBounds: TBounds | undefined;\n\n    private selection: MultiPolygon | undefined;\n    private selectionPath: Path2D | undefined;\n    private selectionBounds: TBounds | undefined;\n\n    private rand(): number {\n        this.sketchySeed++;\n        return Math.sin(6324634.2345 * Math.cos(this.sketchySeed * 5342.3423)) * 0.5 + 0.5;\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {}\n\n    // ---- interface ----\n\n    setHistory(klHistory: KlHistory): void {\n        this.klHistory = klHistory;\n    }\n\n    setSeed(s: number): void {\n        this.sketchySeed = parseInt('' + s);\n    }\n\n    getSeed(): number {\n        return parseInt('' + this.sketchySeed);\n    }\n\n    getSize(): number {\n        return this.settingSize / 2;\n    }\n\n    setColor(c: TRgb): void {\n        this.settingColor = c;\n    }\n\n    getOpacity(): number {\n        return this.settingOpacity;\n    }\n\n    setOpacity(o: number): void {\n        this.settingOpacity = o;\n    }\n\n    getBlending(): number {\n        return this.settingBlending;\n    }\n\n    setBlending(b: number): void {\n        this.settingBlending = b;\n    }\n\n    setSize(s: number): void {\n        this.settingSize = s * 2;\n    }\n\n    getScale(): number {\n        return this.settingScale;\n    }\n\n    setScale(s: number): void {\n        this.settingScale = s;\n    }\n\n    setContext(c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    startLine(x: number, y: number, pressure: number, shift?: boolean): void {\n        this.selection = this.klHistory.getComposed().selection.value;\n        this.selectionPath = this.selection ? getSelectionPath2d(this.selection) : undefined;\n        this.selectionBounds = this.selection\n            ? integerBounds(getMultiPolyBounds(this.selection))\n            : undefined;\n        this.changedBounds = undefined;\n        if (shift && this.lastInput.x) {\n            this.inputIsDrawing = true;\n            this.endLine();\n        } else {\n            this.inputIsDrawing = true;\n            this.lastX = x;\n            this.lastY = y;\n            this.lastInput.x = x;\n            this.lastInput.y = y;\n        }\n    }\n\n    goLine(p_x: number, p_y: number, pressure: number, preMixedColor: TRgb | undefined): void {\n        if (!this.inputIsDrawing || (p_x === this.lastInput.x && p_y === this.lastInput.y)) {\n            return;\n        }\n\n        let e, b, a, g;\n        const x = parseInt('' + p_x);\n        const y = parseInt('' + p_y);\n        this.points.push([x, y]);\n\n        let mixr = this.settingColor.r;\n        let mixg = this.settingColor.g;\n        let mixb = this.settingColor.b;\n\n        if (preMixedColor) {\n            mixr = preMixedColor.r;\n            mixg = preMixedColor.g;\n            mixb = preMixedColor.b;\n        } else {\n            if (this.settingBlending !== 0) {\n                if (\n                    x + 5 >= 0 &&\n                    y + 5 >= 0 &&\n                    x - 5 < this.context.canvas.width - 1 &&\n                    y - 5 < this.context.canvas.height - 1\n                ) {\n                    mixr = 0;\n                    mixg = 0;\n                    mixb = 0;\n                    const mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x - 5));\n                    const mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y - 5));\n                    let mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x + 5));\n                    let mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y + 5));\n                    mixW -= mixX;\n                    mixH -= mixY;\n\n                    if (mixW > 0 && mixH > 0) {\n                        const imDat = this.context.getImageData(mixX, mixY, mixW, mixH);\n                        let countMix = 0;\n                        for (let i = 0; i < imDat.data.length; i += 4) {\n                            mixr += imDat.data[i + 0];\n                            mixg += imDat.data[i + 1];\n                            mixb += imDat.data[i + 2];\n                            countMix++;\n                        }\n                        mixr /= countMix;\n                        mixg /= countMix;\n                        mixb /= countMix;\n                    }\n\n                    const mixed = this.mixMode[0](new BB.RGB(mixr, mixg, mixb), this.settingColor);\n                    mixr = parseInt(\n                        '' + BB.mix(this.settingColor.r, mixed.r, this.settingBlending),\n                    );\n                    mixg = parseInt(\n                        '' + BB.mix(this.settingColor.g, mixed.g, this.settingBlending),\n                    );\n                    mixb = parseInt(\n                        '' + BB.mix(this.settingColor.b, mixed.b, this.settingBlending),\n                    );\n                }\n            }\n        }\n\n        this.context.save();\n        this.selectionPath && this.context.clip(this.selectionPath);\n        this.context.strokeStyle =\n            'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\n        this.context.lineWidth = this.settingSize;\n\n        this.context.beginPath();\n        this.context.moveTo(this.lastX, this.lastY);\n        this.context.lineTo(x, y);\n\n        for (e = 0; e < this.points.length; e++) {\n            b = this.points[e][0] - this.points[this.count][0];\n            a = this.points[e][1] - this.points[this.count][1];\n            g = b * b + a * a;\n            if (\n                g < 4000 * this.settingScale * this.settingScale &&\n                this.rand() > g / 2000 / this.settingScale / this.settingScale\n            ) {\n                this.context.moveTo(\n                    this.points[this.count][0] + b * 0.3,\n                    this.points[this.count][1] + a * 0.3,\n                );\n                this.context.lineTo(this.points[e][0] - b * 0.3, this.points[e][1] - a * 0.3);\n            }\n        }\n\n        this.context.stroke();\n        this.context.restore();\n\n        this.count++;\n        this.lastX = x;\n        this.lastY = y;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n\n        this.changedBounds = BB.updateBounds(this.changedBounds, {\n            x1: Math.floor(x - this.settingSize / 2),\n            y1: Math.floor(y - this.settingSize / 2),\n            x2: Math.ceil(x + this.settingSize / 2),\n            y2: Math.ceil(y + this.settingSize / 2),\n        });\n    }\n\n    endLine(): void {\n        this.inputIsDrawing = false;\n        this.count = 0;\n        this.points = [];\n\n        if (this.changedBounds) {\n            const boundsWithinSelection = boundsOverlap(this.changedBounds, this.selectionBounds);\n            const layerData = canvasToLayerTiles(this.context.canvas, boundsWithinSelection);\n            if (layerData.some((item) => item)) {\n                this.klHistory.push(\n                    getPushableLayerChange(this.klHistory.getComposed(), layerData),\n                );\n            }\n        }\n    }\n    //cheap 'n' ugly\n\n    drawLineSegment(x1: number, y1: number, x2: number, y2: number): void {\n        this.changedBounds = undefined;\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n\n        if (this.inputIsDrawing || x1 === undefined) {\n            return;\n        }\n        this.selection = this.klHistory.getComposed().selection.value;\n        this.selectionPath = this.selection ? getSelectionPath2d(this.selection) : undefined;\n        this.selectionBounds = this.selection\n            ? integerBounds(getMultiPolyBounds(this.selection))\n            : undefined;\n\n        this.context.save();\n        this.selectionPath && this.context.clip(this.selectionPath);\n        this.context.lineWidth = this.settingSize;\n\n        const mixCol = {\n            r: this.settingColor.r,\n            g: this.settingColor.g,\n            b: this.settingColor.b,\n        };\n        if (\n            x1 + 5 >= 0 &&\n            y1 + 5 >= 0 &&\n            x1 - 5 < this.context.canvas.width - 1 &&\n            y1 - 5 < this.context.canvas.height - 1\n        ) {\n            mixCol.r = 0;\n            mixCol.g = 0;\n            mixCol.b = 0;\n            const mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x1 - 5));\n            const mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y1 - 5));\n            let mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x1 + 5));\n            let mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y1 + 5));\n            mixW -= mixX;\n            mixH -= mixY;\n            if (mixW > 0 && mixH > 0) {\n                const w = Math.min(sampleCanvas.width, mixW);\n                const h = Math.min(sampleCanvas.height, mixH);\n                sampleCtx.save();\n                sampleCtx.globalCompositeOperation = 'copy';\n                sampleCtx.drawImage(this.context.canvas, mixX, mixY, mixW, mixH, 0, 0, w, h);\n                sampleCtx.restore();\n\n                const imDat = sampleCtx.getImageData(mixX, mixY, mixW, mixH);\n                let countMix = 0;\n                for (let i = 0; i < imDat.data.length; i += 4) {\n                    mixCol.r += imDat.data[i + 0];\n                    mixCol.g += imDat.data[i + 1];\n                    mixCol.b += imDat.data[i + 2];\n                    countMix++;\n                }\n                mixCol.r /= countMix;\n                mixCol.g /= countMix;\n                mixCol.b /= countMix;\n            }\n        }\n        const mixed = this.mixMode[0](new BB.RGB(mixCol.r, mixCol.g, mixCol.b), this.settingColor);\n        mixCol.r = parseInt(\n            '' +\n                (this.settingBlending * mixed.r + this.settingColor.r * (1 - this.settingBlending)),\n        );\n        mixCol.g = parseInt(\n            '' +\n                (this.settingBlending * mixed.g + this.settingColor.g * (1 - this.settingBlending)),\n        );\n        mixCol.b = parseInt(\n            '' +\n                (this.settingBlending * mixed.b + this.settingColor.b * (1 - this.settingBlending)),\n        );\n        this.context.strokeStyle =\n            'rgba(' +\n            mixCol.r +\n            ', ' +\n            mixCol.g +\n            ', ' +\n            mixCol.b +\n            ', ' +\n            this.settingOpacity +\n            ')';\n        this.context.beginPath();\n        this.context.moveTo(x1, y1);\n        this.context.lineTo(x2, y2);\n        this.context.stroke();\n        this.context.strokeStyle =\n            'rgba(' +\n            mixCol.r +\n            ', ' +\n            mixCol.g +\n            ', ' +\n            mixCol.b +\n            ', ' +\n            this.settingOpacity +\n            ')';\n        this.context.restore();\n\n        this.changedBounds = BB.updateBounds(this.changedBounds, {\n            x1: Math.floor(x1 - this.settingSize / 2),\n            y1: Math.floor(y1 - this.settingSize / 2),\n            x2: Math.ceil(x1 + this.settingSize / 2),\n            y2: Math.ceil(y1 + this.settingSize / 2),\n        });\n        this.changedBounds = BB.updateBounds(this.changedBounds, {\n            x1: Math.floor(x2 - this.settingSize / 2),\n            y1: Math.floor(y2 - this.settingSize / 2),\n            x2: Math.ceil(x2 + this.settingSize / 2),\n            y2: Math.ceil(y2 + this.settingSize / 2),\n        });\n\n        if (this.changedBounds) {\n            const boundsWithinSelection = boundsOverlap(this.changedBounds, this.selectionBounds);\n            const layerData = canvasToLayerTiles(this.context.canvas, boundsWithinSelection);\n            if (layerData.some((item) => item)) {\n                this.klHistory.push(\n                    getPushableLayerChange(this.klHistory.getComposed(), layerData),\n                );\n            }\n        }\n    }\n\n    isDrawing(): boolean {\n        return this.inputIsDrawing;\n    }\n}\n","import { BB } from '../../bb/bb';\nimport { TPressureInput, TRgb } from '../kl-types';\nimport { TBounds, TRect, TVector2D } from '../../bb/bb-types';\nimport { BezierLine } from '../../bb/math/line';\nimport { ERASE_COLOR } from './erase-color';\nimport { throwIfNull } from '../../bb/base/base';\nimport { KlHistory } from '../history/kl-history';\nimport { getPushableLayerChange } from '../history/push-helpers/get-pushable-layer-change';\nimport { getChangedTiles, updateChangedTiles } from '../history/push-helpers/changed-tiles';\nimport { canvasAndChangedTilesToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { getSelectionPath2d } from '../../bb/multi-polygon/get-selection-path-2d';\nimport { boundsOverlap, boundsToRect, integerBounds, updateBounds } from '../../bb/math/math';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\n\nexport class PixelBrush {\n    private klHistory: KlHistory = {} as KlHistory;\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private settingHasSizePressure: boolean = true;\n    private settingHasOpacityPressure: boolean = false;\n    private settingSize: number = 0.5;\n    private settingSpacing: number = 0.9;\n    private settingOpacity: number = 1;\n    private settingColor: TRgb = {} as TRgb;\n    private settingColorStr: string = '';\n    private settingLockLayerAlpha: boolean = false;\n    private settingIsEraser: boolean = false;\n    private settingUseDither: boolean = true;\n    private inputIsDrawing: boolean = false;\n    private lineToolLastDot: number = 0;\n    private lastInput: TPressureInput = { x: 0, y: 0, pressure: 0 };\n    private lastInput2: TPressureInput = { x: 0, y: 0, pressure: 0 };\n    private bezierLine: BezierLine | null = null;\n    private readonly ditherArr: [number, number][] = [\n        [3, 2],\n        [1, 0],\n        [3, 0],\n        [1, 2],\n        [2, 1],\n        [0, 3],\n        [0, 1],\n        [2, 3],\n\n        [2, 0],\n        [0, 2],\n        [0, 0],\n        [2, 2],\n        [1, 1],\n        [3, 3],\n        [3, 1],\n        [1, 3],\n    ];\n    private readonly ditherCanvas: HTMLCanvasElement;\n    private readonly ditherCtx: CanvasRenderingContext2D;\n    private ditherPattern: CanvasPattern = {} as CanvasPattern;\n\n    /*\n        Draw brush into fresh canvas for each line,\n        because otherwise chrome slows the main canvas down.\n        Multiple reads on a canvas -> canvas moved to CPU. (my guess)\n     */\n    private canvasClone: HTMLCanvasElement = {} as HTMLCanvasElement;\n    private ctxClone: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n\n    // area that changed since last redraw\n    private redrawBounds: TBounds | undefined;\n    // changed tiles that will be pushed to history\n    private historyTiles: boolean[] = [];\n\n    private bresenheimPath: Path2D | undefined;\n\n    private selection: MultiPolygon | undefined;\n    private selectionPath: Path2D | undefined;\n    private selectionBounds: TBounds | undefined;\n\n    private updateChangedTiles(bounds: TBounds) {\n        // fix bounds\n        bounds = {\n            x1: Math.min(bounds.x1, bounds.x2),\n            y1: Math.min(bounds.y1, bounds.y2),\n            x2: Math.max(bounds.x1, bounds.x2),\n            y2: Math.max(bounds.y1, bounds.y2),\n        };\n        const boundsWithinSelection = boundsOverlap(bounds, this.selectionBounds);\n        if (!boundsWithinSelection) {\n            return;\n        }\n        const changedTiles = getChangedTiles(\n            boundsWithinSelection,\n            this.context.canvas.width,\n            this.context.canvas.height,\n        );\n        this.redrawBounds = this.redrawBounds\n            ? updateBounds(this.redrawBounds, boundsWithinSelection)\n            : boundsWithinSelection;\n        this.historyTiles = updateChangedTiles(this.historyTiles, changedTiles);\n    }\n\n    private initClone(): void {\n        this.canvasClone = BB.canvas(this.context.canvas.width, this.context.canvas.height);\n        this.ctxClone = BB.ctx(this.canvasClone);\n        this.ctxClone.drawImage(this.context.canvas, 0, 0);\n    }\n\n    private freeClone(): void {\n        BB.freeCanvas(this.canvasClone);\n        this.ctxClone = {} as CanvasRenderingContext2D;\n    }\n\n    private redrawToCanvas(): void {\n        if (!this.redrawBounds) {\n            return;\n        }\n        const boundsRect = boundsToRect(this.redrawBounds, true);\n        this.context.save();\n        this.context.clearRect(boundsRect.x, boundsRect.y, boundsRect.width, boundsRect.height);\n        this.context.drawImage(\n            this.canvasClone,\n            boundsRect.x,\n            boundsRect.y,\n            boundsRect.width,\n            boundsRect.height,\n            boundsRect.x,\n            boundsRect.y,\n            boundsRect.width,\n            boundsRect.height,\n        );\n        this.context.restore();\n        this.redrawBounds = undefined;\n    }\n\n    private updateDither(): void {\n        this.ditherCtx.clearRect(0, 0, 4, 4);\n        this.ditherCtx.fillStyle = this.settingIsEraser\n            ? `rgb(${ERASE_COLOR},${ERASE_COLOR},${ERASE_COLOR})`\n            : this.settingColorStr;\n        for (\n            let i = 0;\n            i < Math.max(1, Math.round(this.settingOpacity * this.ditherArr.length));\n            i++\n        ) {\n            this.ditherCtx.fillRect(this.ditherArr[i][0], this.ditherArr[i][1], 1, 1);\n        }\n        this.ditherPattern = throwIfNull(this.context.createPattern(this.ditherCanvas, 'repeat'));\n    }\n\n    /**\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\n     */\n    private cubicCurveOverThreshold(\n        p1: TVector2D,\n        p2: TVector2D,\n        p3: TVector2D,\n        p4: TVector2D,\n        maxAngleRad: number,\n    ): boolean {\n        const d = BB.Vec2.nor({\n            x: p4.x - p1.x,\n            y: p4.y - p1.y,\n        });\n        const d2 = BB.Vec2.nor({\n            x: p2.x - p1.x,\n            y: p2.y - p1.y,\n        });\n        const d3 = BB.Vec2.nor({\n            x: p4.x - p3.x,\n            y: p4.y - p3.y,\n        });\n        // const a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\n        // const a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\n\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > maxAngleRad;\n    }\n\n    private plotCubicBezierLine(p1: TVector2D, p2: TVector2D, p3: TVector2D, p4: TVector2D): void {\n        const isOverThreshold = this.cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\n\n        p1.x = Math.floor(p1.x);\n        p1.y = Math.floor(p1.y);\n        p4.x = Math.floor(p4.x);\n        p4.y = Math.floor(p4.y);\n\n        const dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\n        if (!isOverThreshold || dist < 7) {\n            this.updateChangedTiles({\n                x1: p1.x,\n                y1: p1.y,\n                x2: p4.x,\n                y2: p4.y,\n            });\n            this.plotLine(p1.x, p1.y, p4.x, p4.y, true);\n            return;\n        }\n\n        const n = Math.max(2, Math.round(dist / 4));\n        const pointArr = [];\n        for (let i = 0; i <= n; i++) {\n            const t = i / n;\n            const a = Math.pow(1 - t, 3);\n            const b = 3 * t * Math.pow(1 - t, 2);\n            const c = 3 * Math.pow(t, 2) * (1 - t);\n            const d = Math.pow(t, 3);\n            pointArr.push({\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y,\n            });\n        }\n\n        for (let i = 0; i < n; i++) {\n            this.updateChangedTiles({\n                x1: Math.round(pointArr[i].x),\n                y1: Math.round(pointArr[i].y),\n                x2: Math.round(pointArr[i + 1].x),\n                y2: Math.round(pointArr[i + 1].y),\n            });\n            this.plotLine(\n                Math.round(pointArr[i].x),\n                Math.round(pointArr[i].y),\n                Math.round(pointArr[i + 1].x),\n                Math.round(pointArr[i + 1].y),\n                true,\n            );\n        }\n    }\n\n    private drawDot(x: number, y: number, size: number, opacity: number): void {\n        const rect: TRect = {\n            x: Math.round(x + -size),\n            y: Math.round(y + -size),\n            width: Math.round(size * 2),\n            height: Math.round(size * 2),\n        };\n        this.updateChangedTiles({\n            x1: rect.x,\n            y1: rect.y,\n            x2: rect.x + rect.width,\n            y2: rect.y + rect.height,\n        });\n\n        this.ctxClone.save();\n        if (this.settingIsEraser) {\n            this.ctxClone.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\n            if (this.settingLockLayerAlpha) {\n                this.ctxClone.globalCompositeOperation = 'source-atop';\n            } else {\n                this.ctxClone.globalCompositeOperation = 'destination-out';\n            }\n        } else {\n            this.ctxClone.fillStyle = this.settingUseDither\n                ? this.ditherPattern\n                : this.settingColorStr;\n            if (this.settingLockLayerAlpha) {\n                this.ctxClone.globalCompositeOperation = 'source-atop';\n            }\n        }\n        this.ctxClone.globalAlpha = this.settingUseDither ? 1 : opacity;\n\n        this.ctxClone.fillRect(rect.x, rect.y, rect.width, rect.height);\n        this.ctxClone.restore();\n    }\n\n    private continueLine(x: number | null, y: number | null, size: number, pressure: number): void {\n        if (this.bezierLine === null) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\n        }\n\n        this.ctxClone.save();\n        this.selectionPath && this.ctxClone.clip(this.selectionPath);\n\n        const dotCallback = (val: {\n            x: number;\n            y: number;\n            t: number;\n            angle?: number;\n            dAngle: number;\n        }): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity =\n                this.settingOpacity *\n                (this.settingHasOpacityPressure ? localPressure * localPressure : 1);\n            const localSize = Math.max(\n                0.5,\n                this.settingSize * (this.settingHasSizePressure ? localPressure : 1),\n            );\n            this.drawDot(val.x, val.y, localSize, localOpacity);\n        };\n\n        const controlCallback = (controlObj: {\n            p1: TVector2D;\n            p2: TVector2D;\n            p3: TVector2D;\n            p4: TVector2D;\n        }): void => {\n            this.plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\n        };\n\n        if (Math.round(this.settingSize * 2) === 1) {\n            this.bresenheimPath = new Path2D();\n            if (x === null || y === null) {\n                this.bezierLine.addFinal(4, undefined, controlCallback);\n            } else {\n                this.bezierLine.add(x, y, 4, undefined, controlCallback);\n            }\n            if (this.settingIsEraser) {\n                this.ctxClone.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\n                if (this.settingLockLayerAlpha) {\n                    this.ctxClone.globalCompositeOperation = 'source-atop';\n                } else {\n                    this.ctxClone.globalCompositeOperation = 'destination-out';\n                }\n            } else {\n                this.ctxClone.fillStyle = this.settingUseDither\n                    ? this.ditherPattern\n                    : this.settingColorStr;\n                if (this.settingLockLayerAlpha) {\n                    this.ctxClone.globalCompositeOperation = 'source-atop';\n                }\n            }\n            this.ctxClone.globalAlpha = this.settingUseDither ? 1 : this.settingOpacity;\n            this.ctxClone.fill(this.bresenheimPath!);\n            this.bresenheimPath = undefined;\n        } else {\n            const localSpacing = size * this.settingSpacing;\n\n            if (x === null || y === null) {\n                this.bezierLine.addFinal(localSpacing, dotCallback);\n            } else {\n                this.bezierLine.add(x, y, localSpacing, dotCallback);\n            }\n        }\n\n        this.ctxClone.restore();\n    }\n\n    /**\n     * bresenheim line drawing\n     */\n    private plotLine(x0: number, y0: number, x1: number, y1: number, skipFirst: boolean): void {\n        x0 = Math.floor(x0);\n        y0 = Math.floor(y0);\n        x1 = Math.floor(x1);\n        y1 = Math.floor(y1);\n\n        const dX = Math.abs(x1 - x0);\n        const sX = x0 < x1 ? 1 : -1;\n        const dY = -Math.abs(y1 - y0);\n        const sY = y0 < y1 ? 1 : -1;\n        let err = dX + dY;\n\n         \n        while (true) {\n            if (skipFirst) {\n                skipFirst = false;\n            } else {\n                this.bresenheimPath?.rect(x0, y0, 1, 1);\n            }\n            if (x0 === x1 && y0 === y1) {\n                break;\n            }\n            const e2 = 2 * err;\n            if (e2 >= dY) {\n                err += dY;\n                x0 += sX;\n            }\n            if (e2 <= dX) {\n                err += dX;\n                y0 += sY;\n            }\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {\n        this.ditherCanvas = BB.canvas(4, 4);\n        this.ditherCtx = BB.ctx(this.ditherCanvas);\n    }\n\n    // ---- interface ----\n\n    startLine(x: number, y: number, p: number): void {\n        this.selection = this.klHistory.getComposed().selection.value;\n        this.selectionPath = this.selection ? getSelectionPath2d(this.selection) : undefined;\n        this.selectionBounds = this.selection\n            ? integerBounds(getMultiPolyBounds(this.selection))\n            : undefined;\n        this.historyTiles = [];\n        this.redrawBounds = undefined;\n        if (this.settingUseDither) {\n            this.updateDither();\n        }\n        this.initClone();\n\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = this.settingHasOpacityPressure\n            ? this.settingOpacity * p * p\n            : this.settingOpacity;\n        const localSize = this.settingHasSizePressure\n            ? Math.max(0.5, p * this.settingSize)\n            : Math.max(0.5, this.settingSize);\n\n        this.inputIsDrawing = true;\n        this.ctxClone.save();\n        this.selectionPath && this.ctxClone.clip(this.selectionPath);\n        this.drawDot(x, y, localSize, localOpacity);\n        this.ctxClone.restore();\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.redrawToCanvas();\n    }\n\n    goLine(x: number, y: number, p: number): void {\n        if (!this.inputIsDrawing) {\n            return;\n        }\n\n        //debug\n        //drawDot(x, y, 1, 0.5);\n\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure\n            ? Math.max(0.1, this.lastInput.pressure * this.settingSize)\n            : Math.max(0.1, this.settingSize);\n\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = pressure;\n        this.redrawToCanvas();\n    }\n\n    endLine(): void {\n        this.selection = this.klHistory.getComposed().selection.value;\n        this.selectionPath = this.selection ? getSelectionPath2d(this.selection) : undefined;\n        const localSize = this.settingHasSizePressure\n            ? Math.max(0.1, this.lastInput.pressure * this.settingSize)\n            : Math.max(0.1, this.settingSize);\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\n\n        //debug\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\n        //drawDot(x, y, 10, 0.1);\n\n        this.inputIsDrawing = false;\n\n        this.bezierLine = null;\n\n        this.redrawToCanvas();\n        if (this.historyTiles.some((item) => item)) {\n            this.klHistory.push(\n                getPushableLayerChange(\n                    this.klHistory.getComposed(),\n                    canvasAndChangedTilesToLayerTiles(this.canvasClone, this.historyTiles),\n                ),\n            );\n        }\n        this.freeClone();\n    }\n\n    drawLineSegment(x1: number, y1: number, x2: number, y2: number): void {\n        this.startLine(x1, y1, 1);\n        this.goLine(x2, y2, 1);\n        this.endLine();\n    }\n\n    //IS\n    isDrawing(): boolean {\n        return this.inputIsDrawing;\n    }\n\n    //SET\n    setColor(c: TRgb): void {\n        if (this.settingColor === c) {\n            return;\n        }\n        this.settingColor = c;\n        this.settingColorStr =\n            'rgb(' +\n            this.settingColor.r +\n            ',' +\n            this.settingColor.g +\n            ',' +\n            this.settingColor.b +\n            ')';\n    }\n\n    setContext(c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory(klHistory: KlHistory): void {\n        this.klHistory = klHistory;\n    }\n\n    setSize(s: number): void {\n        this.settingSize = Math.round(s * 2) / 2;\n    }\n\n    setOpacity(o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setSpacing(s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure(b: boolean): void {\n        this.settingHasSizePressure = b;\n    }\n\n    opacityPressure(b: boolean): void {\n        this.settingHasOpacityPressure = b;\n    }\n\n    setLockAlpha(b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    setIsEraser(b: boolean): void {\n        this.settingIsEraser = b;\n    }\n\n    setUseDither(b: boolean): void {\n        this.settingUseDither = b;\n    }\n\n    //GET\n    getSpacing(): number {\n        return this.settingSpacing;\n    }\n\n    getSize(): number {\n        return this.settingSize;\n    }\n\n    getOpacity(): number {\n        return this.settingOpacity;\n    }\n\n    getLockAlpha(): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    getIsEraser(): boolean {\n        return this.settingIsEraser;\n    }\n\n    getUseDither(): boolean {\n        return this.settingUseDither;\n    }\n}\n","import { BB } from '../../bb/bb';\nimport { TPressureInput } from '../kl-types';\nimport { BezierLine } from '../../bb/math/line';\nimport { ERASE_COLOR } from './erase-color';\nimport { TKlCanvasLayer } from '../canvas/kl-canvas';\nimport { KlHistory } from '../history/kl-history';\nimport { getPushableLayerChange } from '../history/push-helpers/get-pushable-layer-change';\nimport { TBounds } from '../../bb/bb-types';\nimport { canvasAndChangedTilesToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\nimport { getChangedTiles, updateChangedTiles } from '../history/push-helpers/changed-tiles';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { getSelectionPath2d } from '../../bb/multi-polygon/get-selection-path-2d';\nimport { boundsOverlap, integerBounds } from '../../bb/math/math';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\n\nexport class EraserBrush {\n    private size: number = 30;\n    private spacing: number = 0.4;\n    private opacity: number = 1;\n    private useSizePressure: boolean = true;\n    private useOpacityPressure: boolean = false;\n    private isTransparentBG: boolean = false;\n\n    private klHistory: KlHistory = {} as KlHistory;\n    private isBaseLayer: boolean = false;\n    private layer: TKlCanvasLayer = {} as TKlCanvasLayer;\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n\n    private started: boolean = false;\n    private lastDot: number | undefined;\n    private lastInput: TPressureInput = { x: 0, y: 0, pressure: 0 };\n    private lastInput2: TPressureInput = { x: 0, y: 0, pressure: 0 };\n    private bezierLine: BezierLine | undefined;\n\n    private changedTiles: boolean[] = [];\n\n    private selection: MultiPolygon | undefined;\n    private selectionPath: Path2D | undefined;\n    private selectionBounds: TBounds | undefined;\n\n    private updateChangedTiles(bounds: TBounds) {\n        const boundsWithinSelection = boundsOverlap(bounds, this.selectionBounds);\n        if (!boundsWithinSelection) {\n            return;\n        }\n        this.changedTiles = updateChangedTiles(\n            this.changedTiles,\n            getChangedTiles(bounds, this.context.canvas.width, this.context.canvas.height),\n        );\n    }\n\n    private drawDot(x: number, y: number, size: number, opacity: number): void {\n        this.context.save();\n        if (this.isBaseLayer) {\n            if (this.isTransparentBG) {\n                this.context.globalCompositeOperation = 'destination-out';\n            } else {\n                this.context.globalCompositeOperation = 'source-atop';\n            }\n        } else {\n            this.context.globalCompositeOperation = 'destination-out';\n        }\n        const radgrad = this.context.createRadialGradient(size, size, 0, size, size, size);\n        let sharpness = Math.pow(opacity, 2);\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\n        const oFac = Math.max(0, Math.min(1, opacity));\n        const localOpacity = 2 * oFac - oFac * oFac;\n        radgrad.addColorStop(\n            sharpness,\n            `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, ` + localOpacity + ')',\n        );\n        radgrad.addColorStop(1, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, 0)`);\n        this.context.fillStyle = radgrad;\n        this.context.translate(x - size, y - size);\n        this.context.fillRect(0, 0, size * 2, size * 2);\n        this.context.restore();\n\n        this.updateChangedTiles({\n            x1: Math.floor(x - size),\n            y1: Math.floor(y - size),\n            x2: Math.ceil(x + size),\n            y2: Math.ceil(y + size),\n        });\n    }\n\n    private continueLine(x: number | undefined, y: number | undefined, p: number): void {\n        p = Math.max(0, Math.min(1, p));\n        let localPressure;\n        let localOpacity;\n        let localSize = this.useSizePressure\n            ? Math.max(0.1, p * this.size)\n            : Math.max(0.1, this.size);\n\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * localSize * this.spacing);\n\n        const bezierCallback = (val: {\n            x: number;\n            y: number;\n            t: number;\n            angle?: number;\n            dAngle: number;\n        }): void => {\n            const factor = val.t;\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = this.useOpacityPressure\n                ? this.opacity * localPressure * localPressure\n                : this.opacity;\n            localSize = this.useSizePressure\n                ? Math.max(0.1, localPressure * this.size)\n                : Math.max(0.1, this.size);\n\n            this.drawDot(val.x, val.y, localSize, localOpacity);\n        };\n\n        this.context.save();\n        this.selectionPath && this.context.clip(this.selectionPath);\n        if (x === undefined || y === undefined) {\n            this.bezierLine!.addFinal(bdist, bezierCallback);\n        } else {\n            this.bezierLine!.add(x, y, bdist, bezierCallback);\n        }\n        this.context.restore();\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {}\n\n    // ---- interface ----\n    startLine(x: number, y: number, p: number): void {\n        this.selection = this.klHistory.getComposed().selection.value;\n        this.selectionPath = this.selection ? getSelectionPath2d(this.selection) : undefined;\n        this.selectionBounds = this.selection\n            ? integerBounds(getMultiPolyBounds(this.selection))\n            : undefined;\n        this.changedTiles = [];\n        this.isBaseLayer = 0 === this.layer.index;\n\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = this.useOpacityPressure ? this.opacity * p * p : this.opacity;\n        const localSize = this.useSizePressure\n            ? Math.max(0.1, p * this.size)\n            : Math.max(0.1, this.size);\n\n        this.started = true;\n        if (localSize > 1) {\n            this.context.save();\n            this.selectionPath && this.context.clip(this.selectionPath);\n            this.drawDot(x, y, localSize, localOpacity);\n            this.context.restore();\n        }\n        this.lastDot = localSize * this.spacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n\n        this.bezierLine = new BB.BezierLine();\n        this.bezierLine.add(x, y, 0, () => undefined);\n    }\n\n    goLine(x: number, y: number, p: number): void {\n        if (!this.started) {\n            return;\n        }\n\n        this.continueLine(x, y, this.lastInput.pressure);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n    }\n\n    endLine(): void {\n        if (this.bezierLine) {\n            this.continueLine(undefined, undefined, this.lastInput.pressure);\n        }\n\n        this.started = false;\n        this.bezierLine = undefined;\n\n        if (this.changedTiles.some((item) => item)) {\n            this.klHistory.push(\n                getPushableLayerChange(\n                    this.klHistory.getComposed(),\n                    canvasAndChangedTilesToLayerTiles(this.context.canvas, this.changedTiles),\n                ),\n            );\n        }\n    }\n\n    drawLineSegment(x1: number, y1: number, x2: number, y2: number): void {\n        this.selection = this.klHistory.getComposed().selection.value;\n        this.selectionPath = this.selection ? getSelectionPath2d(this.selection) : undefined;\n        this.selectionBounds = this.selection\n            ? integerBounds(getMultiPolyBounds(this.selection))\n            : undefined;\n        this.changedTiles = [];\n        this.isBaseLayer = 0 === this.layer.index;\n\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n\n        if (this.started || x1 === undefined) {\n            return;\n        }\n\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * this.size * this.spacing);\n        this.lastDot = 0;\n        this.context.save();\n        this.selectionPath && this.context.clip(this.selectionPath);\n        for (loopDist = this.lastDot; loopDist <= mouseDist; loopDist += bdist) {\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.size, this.opacity);\n        }\n        this.context.restore();\n\n        if (this.changedTiles.some((item) => item)) {\n            this.klHistory.push(\n                getPushableLayerChange(\n                    this.klHistory.getComposed(),\n                    canvasAndChangedTilesToLayerTiles(this.context.canvas, this.changedTiles),\n                ),\n            );\n        }\n    }\n\n    //IS\n    isDrawing(): boolean {\n        return this.started;\n    }\n\n    //SET\n    setLayer(layer: TKlCanvasLayer): void {\n        this.layer = layer;\n        this.context = layer.context;\n    }\n\n    setHistory(klHistory: KlHistory): void {\n        this.klHistory = klHistory;\n    }\n\n    setSize(s: number): void {\n        this.size = s;\n    }\n\n    setOpacity(o: number): void {\n        this.opacity = o;\n    }\n\n    sizePressure(b: boolean): void {\n        this.useSizePressure = b;\n    }\n\n    opacityPressure(b: boolean): void {\n        this.useOpacityPressure = b;\n    }\n\n    setTransparentBG(b: boolean): void {\n        this.isTransparentBG = b;\n    }\n\n    //GET\n    getSize(): number {\n        return this.size;\n    }\n\n    getOpacity(): number {\n        return this.opacity;\n    }\n}\n","import { BB } from '../../bb/bb';\nimport { TBounds, TPressureInput, TVector2D } from '../../bb/bb-types';\nimport { TRgb } from '../kl-types';\nimport { boundsOverlap, clamp, integerBounds } from '../../bb/math/math';\nimport { BezierLine, TBezierLineCallback } from '../../bb/math/line';\nimport { KlHistory } from '../history/kl-history';\nimport { getPushableLayerChange } from '../history/push-helpers/get-pushable-layer-change';\nimport { canvasToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\nimport { createArray } from '../../bb/base/base';\nimport { getBinaryMask } from '../select-tool/get-binary-mask';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\n\n// let statCount = 1;\n// let statAcc = 0;\n// stats on win10, chrome, size 100, opacity 80, smudge()\n// unoptimized: 1 ms\n// minimal: 0.09 ms\n// minimal + circle: 0.5ms\n// minimal + circle + ix, iy: 0.23ms\n// unoptimized + ix, iy: 0.64 ms\n// unoptimized + ix, iy + sans rounding: 0.61 ms\n// ix, iy + sans rounding + sans random: 0.32ms\n// ix, iy + sans rounding + fast random: 0.46 ms\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\n\nconst CELL_SIZE = 256;\n\ntype TSmudgeParams = {\n    aP: TVector2D;\n    bP: TVector2D;\n    size: {\n        w: number;\n        h: number;\n    };\n    brush: {\n        center: TVector2D;\n        size: number;\n        opacity: number;\n        alphaLock: boolean;\n    };\n};\n\n/**\n * determine bounds of smudge\n * @param imWidth\n * @param imHeight\n * @param aP\n * @param bP\n * @param size\n */\nfunction prepSmudge(\n    imWidth: number,\n    imHeight: number,\n    aP: TVector2D, // top left of source, integers\n    bP: TVector2D, // top left of dest, integers\n    size: { w: number; h: number }, // size of both rectangles, integers\n): {\n    aP: TVector2D;\n    bP: TVector2D;\n    size: { w: number; h: number };\n} | null {\n    if (aP.x === bP.x && aP.y === bP.y) {\n        return null;\n    }\n\n    aP = BB.copyObj(aP);\n    bP = BB.copyObj(bP);\n    size = BB.copyObj(size);\n\n    // corner behavior\n    // cut down rectangles, if a or b go outside\n    // i.e. if user drags partially or fully outside the canvas\n    {\n        let top = 0;\n        let right = 0;\n        let bottom = 0;\n        let left = 0;\n\n        if (aP.x < 0) {\n            left = -aP.x;\n        }\n        if (aP.y < 0) {\n            top = -aP.y;\n        }\n        if (bP.x < 0) {\n            left = Math.max(left, -bP.x);\n        }\n        if (bP.y < 0) {\n            top = Math.max(top, -bP.y);\n        }\n        if (aP.x + size.w > imWidth) {\n            right = aP.x + size.w - imWidth;\n        }\n        if (aP.y + size.h > imHeight) {\n            bottom = aP.y + size.h - imHeight;\n        }\n        if (bP.x + size.w > imWidth) {\n            right = Math.max(right, bP.x + size.w - imWidth);\n        }\n        if (bP.y + size.h > imHeight) {\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\n        }\n\n        aP.x += left;\n        bP.x += left;\n        aP.y += top;\n        bP.y += top;\n\n        size.w = size.w - left - right;\n        size.h = size.h - top - bottom;\n        if (size.w <= 0 || size.h <= 0) {\n            return null;\n        }\n    }\n\n    return {\n        aP: {\n            x: aP.x,\n            y: aP.y,\n        },\n        bP: {\n            x: bP.x,\n            y: bP.y,\n        },\n        size: {\n            w: size.w,\n            h: size.h,\n        },\n    };\n}\n\n/**\n * Pixel operations that do the smudging via ImageData\n * @param imageData\n * @param p\n */\nfunction smudge(imageData: ImageData, mask: Uint8Array | undefined, p: TSmudgeParams): void {\n    p = BB.copyObj(p);\n\n    const cSize = p.brush.size;\n    const cX = p.brush.center.x;\n    const cY = p.brush.center.y;\n\n    /*if (statCount % 1000 === 0) {\n        console.log(statAcc / 1000);\n        statAcc = 0;\n    }\n    let start = performance.now();*/\n\n    // determine offset\n    const aIndex = p.aP.y * imageData.width + p.aP.x;\n    const bIndex = p.bP.y * imageData.width + p.bP.x;\n    const offset = (bIndex - aIndex) * 4;\n\n    // array with random numbers. faster than Math.random()\n    let randI = 0;\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n    const randArr: number[] = [];\n    for (let i = 0; i < randLen; i++) {\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n    }\n\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\n\n    const pixel = (ai: number, bi: number, ix: number, iy: number): void => {\n        const dist = BB.dist(cX, cY, ix, iy);\n        const fac =\n            1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\n\n        if (fac === 1) {\n            return;\n        }\n        if (mask && (mask[ai / 4] === 0 || mask[bi / 4] === 0)) {\n            return;\n        }\n\n        if (!imageData.data[ai + 3]) {\n            /* empty */\n        } else if (!imageData.data[bi + 3]) {\n            // don't mix if target fully transparent. pixel might have a strange color.\n            imageData.data[bi] = imageData.data[ai];\n            imageData.data[bi + 1] = imageData.data[ai + 1];\n            imageData.data[bi + 2] = imageData.data[ai + 2];\n        } else {\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\n            // not totally accurate. TODO same compositing as blend brush\n            let fac2;\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\n                fac2 = 1 - (imageData.data[ai + 3] / imageData.data[bi + 3]) * (1 - fac);\n            } else {\n                fac2 = (imageData.data[bi + 3] / imageData.data[ai + 3]) * fac;\n            }\n\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\n            // No +0.5, because it cancels out with rand.\n            imageData.data[bi] = Math.floor(\n                BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI],\n            );\n            imageData.data[bi + 1] = Math.floor(\n                BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI],\n            );\n            imageData.data[bi + 2] = Math.floor(\n                BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI],\n            );\n\n            randI = (randI + 1) % randLen;\n        }\n        // Always mix alpha. unless alpha lock\n        if (!p.brush.alphaLock) {\n            imageData.data[bi + 3] = Math.floor(\n                BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5,\n            );\n        }\n    };\n\n    const bx1 = p.bP.x * 4;\n    const bx2 = bx1 + (p.size.w - 1) * 4;\n\n    // transfer of pixels depends on direction of smudging if there is overlap\n    if (p.aP.y < p.bP.y) {\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (\n                let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1;\n                x >= bx1 + yStart;\n                x -= 4, x2 -= 4, ix--\n            ) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else if (p.aP.y > p.bP.y) {\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (\n                let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1;\n                x >= bx1 + yStart;\n                x -= 4, x2 -= 4, ix--\n            ) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else {\n        if (p.aP.x < p.bP.x) {\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (\n                    let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1;\n                    x >= bx1 + yStart;\n                    x -= 4, x2 -= 4, ix--\n                ) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        } else {\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (\n                    let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x;\n                    x < bx2 + yStart;\n                    x += 4, x2 += 4, ix++\n                ) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        }\n    }\n\n    //statCount++;\n    //statAcc += performance.now() - start;\n}\n\nexport class SmudgeBrush {\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private klHistory: KlHistory = {} as KlHistory;\n\n    private settingColor: TRgb = { r: 0, g: 0, b: 0 };\n    private settingSize: number = 35;\n    private settingSpacing: number = 0.20446882736951905;\n    private settingOpacity: number = 0.8;\n    private settingHasSizePressure: boolean = false;\n    private settingHasOpacityPressure: boolean = false;\n    private settingLockLayerAlpha: boolean = false;\n\n    private lineToolLastDot: number = 0;\n    private lastInput: TPressureInput = { x: 0, y: 0, pressure: 0 };\n    private lastInput2: TPressureInput = { x: 0, y: 0, pressure: 0 };\n    private lastDot: TVector2D | undefined;\n\n    private isDrawing: boolean = false;\n\n    private bezierLine: BezierLine | undefined;\n\n    private redrawBounds: TBounds | undefined;\n    private completeRedrawBounds: TBounds | undefined;\n\n    private copyImageData: ImageData = {} as ImageData;\n\n    private drawBuffer: TSmudgeParams[] = [];\n\n    private copiedCells: boolean[] = [];\n\n    private selectionBounds: TBounds | undefined;\n    private mask: Uint8Array | undefined;\n\n    // workaround for https://github.com/microsoft/TypeScript/issues/41654\n    private resetRedrawBounds(): void {\n        this.redrawBounds = undefined;\n    }\n\n    private updateRedrawBounds(bounds: TBounds): void {\n        const boundsWithinSelection = boundsOverlap(bounds, this.selectionBounds);\n        if (!boundsWithinSelection) {\n            return;\n        }\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, boundsWithinSelection);\n    }\n\n    private updateCompleteRedrawBounds(x1: number, y1: number, x2: number, y2: number): void {\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, {\n            x1,\n            y1,\n            x2,\n            y2,\n        });\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    copyFromCanvas(): void {\n        const touchedCells = this.copiedCells.map(() => false);\n\n        const bounds: TBounds[] = [];\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\n\n        if (!this.redrawBounds) {\n            return;\n        }\n        bounds.push({\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\n        });\n        bounds.forEach((item) => {\n            for (let i = item.x1; i <= item.x2; i++) {\n                for (let e = item.y1; e <= item.y2; e++) {\n                    touchedCells[e * cellsW + i] = true;\n                }\n            }\n        });\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.copiedCells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            this.copiedCells[i] = true;\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w =\n                ((Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE) +\n                1;\n            const h =\n                ((Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE) +\n                1;\n\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = BB.canvas(w, h);\n            const tmpCtx = BB.ctx(tmpCanvas);\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\n\n            const data = tmpCtx.getImageData(0, 0, w, h);\n\n            for (let i = 0; i < h; i++) {\n                for (\n                    let e = 0,\n                        e2 = i * w * 4,\n                        e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4;\n                    e < w;\n                    e++, e2 += 4, e3 += 4\n                ) {\n                    this.copyImageData.data[e3] = data.data[e2];\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\n                }\n            }\n        });\n    }\n\n    /**\n     * fill drawBuffer with params about to be drawn\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     */\n    prepDot(x: number, y: number, size: number, opacity: number): void {\n        if (!this.lastDot) {\n            this.lastDot = {\n                x: x,\n                y: y,\n            };\n            return;\n        }\n\n        size = Math.round(size);\n\n        const w = Math.round(size * 2);\n        const h = Math.round(size * 2);\n\n        const bounds = prepSmudge(\n            this.copyImageData.width,\n            this.copyImageData.height,\n            {\n                x: Math.round(this.lastDot.x - size),\n                y: Math.round(this.lastDot.y - size),\n            },\n            {\n                x: Math.round(x - size),\n                y: Math.round(y - size),\n            },\n            {\n                w,\n                h,\n            },\n        );\n\n        if (bounds) {\n            const params: TSmudgeParams = {\n                aP: bounds.aP,\n                bP: bounds.bP,\n                size: bounds.size,\n                brush: {\n                    center: { x, y },\n                    size,\n                    opacity,\n                    alphaLock: this.settingLockLayerAlpha,\n                },\n            };\n            this.updateRedrawBounds({\n                x1: params.bP.x,\n                y1: params.bP.y,\n                x2: params.bP.x + params.brush.size * 2,\n                y2: params.bP.y + params.brush.size * 2,\n            });\n            this.drawBuffer.push(params);\n        }\n\n        this.lastDot = {\n            x: x,\n            y: y,\n        };\n    }\n\n    continueLine(\n        x: number | undefined,\n        y: number | undefined,\n        size: number,\n        pressure: number,\n    ): void {\n        this.drawBuffer = [];\n\n        if (!this.bezierLine) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function () {});\n        }\n\n        const drawArr: Parameters<typeof this.prepDot>[] = []; //draw instructions. will be all drawn at once\n\n        const dotCallback: TBezierLineCallback = (val): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity =\n                this.settingOpacity *\n                (this.settingHasOpacityPressure ? localPressure * localPressure : 1);\n            const localSize = Math.max(\n                0.1,\n                this.settingSize * (this.settingHasSizePressure ? localPressure : 1),\n            );\n            drawArr.push([val.x, val.y, localSize, localOpacity]); //, val.angle]);\n        };\n\n        const localSpacing = (size * this.settingSpacing) / 3;\n        if (x === undefined || y === undefined) {\n            this.bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        for (let i = 0; i < drawArr.length; i++) {\n            const item = drawArr[i];\n            this.prepDot(item[0], item[1], item[2], item[3]);\n        }\n\n        this.copyFromCanvas();\n\n        for (let i = 0; i < this.drawBuffer.length; i++) {\n            smudge(this.copyImageData, this.mask, this.drawBuffer[i]);\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor() {}\n\n    startLine(x: number, y: number, p: number): void {\n        const selection = this.klHistory.getComposed().selection.value;\n        this.selectionBounds = selection ? integerBounds(getMultiPolyBounds(selection)) : undefined;\n        this.mask = selection\n            ? getBinaryMask(selection, this.context.canvas.width, this.context.canvas.height)\n            : undefined;\n        p = BB.clamp(p, 0, 1);\n        const localOpacity = this.settingHasOpacityPressure\n            ? this.settingOpacity * p * p\n            : this.settingOpacity;\n        const localSize = this.settingHasSizePressure\n            ? Math.max(0.1, p * this.settingSize)\n            : Math.max(0.1, this.settingSize);\n\n        this.lastDot = undefined;\n        this.isDrawing = true;\n\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\n        const totalCells =\n            Math.ceil(this.context.canvas.width / CELL_SIZE) *\n            Math.ceil(this.context.canvas.height / CELL_SIZE);\n        this.copiedCells = createArray(totalCells, false);\n\n        this.prepDot(x, y, localSize, localOpacity);\n\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2.pressure = p;\n\n        this.completeRedrawBounds = undefined;\n    }\n\n    goLine(x: number, y: number, p: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        this.resetRedrawBounds();\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure\n            ? Math.max(0.1, this.lastInput.pressure * this.settingSize)\n            : Math.max(0.1, this.settingSize);\n\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1,\n                this.redrawBounds.y2 - this.redrawBounds.y1,\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2,\n            );\n        }\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput2.pressure = this.lastInput.pressure;\n        this.lastInput.pressure = pressure;\n    }\n\n    endLine(): void {\n        this.resetRedrawBounds();\n        const localSize = this.settingHasSizePressure\n            ? Math.max(0.1, this.lastInput.pressure * this.settingSize)\n            : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.continueLine(undefined, undefined, localSize, this.lastInput.pressure);\n        this.context.restore();\n\n        this.isDrawing = false;\n        this.bezierLine = undefined;\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1,\n                this.redrawBounds.y2 - this.redrawBounds.y1,\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2,\n            );\n        }\n\n        if (this.completeRedrawBounds) {\n            this.klHistory.push(\n                getPushableLayerChange(\n                    this.klHistory.getComposed(),\n                    canvasToLayerTiles(this.context.canvas, this.completeRedrawBounds),\n                ),\n            );\n        }\n        this.copyImageData = {} as ImageData;\n    }\n\n    drawImage(im: ImageData | HTMLCanvasElement, x: number, y: number): void {\n        if (im instanceof ImageData) {\n            this.context.putImageData(im, x, y);\n        } else {\n            this.context.clearRect(x, y, im.width, im.height);\n            this.context.drawImage(im, x, y);\n        }\n    }\n\n    drawLineSegment(x1: number, y1: number, x2: number, y2: number): void {\n        return;\n        /*\n        // todo\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = settingSize * settingSpacing;\n        lineToolLastDot = settingSize * settingSpacing;\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\n        }\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"SmudgeBrush\"],\n            actions: []\n        };\n        // todo\n        history.add(historyEntry);*/\n    }\n\n    getIsDrawing(): boolean {\n        return this.isDrawing;\n    }\n\n    setColor(c: TRgb): void {\n        if (\n            this.settingColor.r === c.r &&\n            this.settingColor.g === c.g &&\n            this.settingColor.b === c.b\n        ) {\n            return;\n        }\n        this.settingColor = { r: c.r, g: c.g, b: c.b };\n    }\n\n    setContext(c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory(klHistory: KlHistory): void {\n        this.klHistory = klHistory;\n    }\n\n    setSize(s: number): void {\n        this.settingSize = s;\n    }\n\n    setOpacity(o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setSpacing(s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure(b: boolean): void {\n        this.settingHasSizePressure = b;\n    }\n\n    opacityPressure(b: boolean): void {\n        this.settingHasOpacityPressure = b;\n    }\n\n    setLockAlpha(b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    getSpacing(): number {\n        return this.settingSpacing;\n    }\n\n    getSize(): number {\n        return this.settingSize;\n    }\n\n    getOpacity(): number {\n        return this.settingOpacity;\n    }\n\n    getLockAlpha(): boolean {\n        return this.settingLockLayerAlpha;\n    }\n}\n","import { BB } from '../../bb/bb';\nimport { TRgb } from '../kl-types';\nimport { TBounds } from '../../bb/bb-types';\nimport { ERASE_COLOR } from './erase-color';\nimport { KlHistory } from '../history/kl-history';\nimport { getPushableLayerChange } from '../history/push-helpers/get-pushable-layer-change';\nimport { canvasToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { getSelectionPath2d } from '../../bb/multi-polygon/get-selection-path-2d';\nimport { boundsOverlap, integerBounds } from '../../bb/math/math';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\n\ntype TChemyMode = 'fill' | 'stroke';\n\nexport class ChemyBrush {\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private settingColor: TRgb = {} as TRgb;\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\n    private settingOpacity: number = 1; // 0-1\n    private settingLockLayerAlpha: boolean = false;\n    private settingIsEraser: boolean = false;\n    private settingMode: TChemyMode = 'fill';\n    private settingDistort: number = 0; // 0 - 1\n    private settingXSymmetry: boolean = false;\n    private settingYSymmetry: boolean = false;\n    private settingGradient: boolean = false;\n\n    private isDrawing: boolean = false;\n\n    private klHistory: KlHistory = {} as KlHistory;\n\n    private copyCanvas: HTMLCanvasElement = {} as HTMLCanvasElement;\n    private path: { x: number; y: number }[] = [];\n    private minY: number = 0;\n    private maxY: number = 0;\n    private completeRedrawBounds: TBounds | undefined;\n\n    private selection: MultiPolygon | undefined;\n    private selectionPath: Path2D | undefined;\n    private selectionBounds: TBounds | undefined;\n\n    private updateCompleteRedrawBounds(x: number, y: number): void {\n        let bounds = { x1: x, y1: y, x2: x, y2: y };\n        if (this.settingXSymmetry) {\n            bounds = BB.updateBounds(bounds, {\n                x1: -x + this.copyCanvas.width,\n                y1: y,\n                x2: -x + this.copyCanvas.width,\n                y2: y,\n            });\n        }\n        if (this.settingYSymmetry) {\n            bounds = BB.updateBounds(bounds, {\n                x1: x,\n                y1: -y + this.copyCanvas.height,\n                x2: x,\n                y2: -y + this.copyCanvas.height,\n            });\n        }\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\n\n        const boundsWithinSelection = this.selectionBounds\n            ? boundsOverlap(bounds, this.selectionBounds)\n            : bounds;\n        if (!boundsWithinSelection) {\n            return;\n        }\n        this.completeRedrawBounds = BB.updateBounds(\n            this.completeRedrawBounds,\n            boundsWithinSelection,\n        );\n    }\n\n    private drawShape(): void {\n        this.context.save();\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n        this.context.drawImage(this.copyCanvas, 0, 0);\n        this.selectionPath && this.context.clip(this.selectionPath);\n\n        const color = { ...this.settingColor };\n        if (this.settingIsEraser) {\n            color.r = ERASE_COLOR;\n            color.g = ERASE_COLOR;\n            color.b = ERASE_COLOR;\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            } else {\n                this.context.globalCompositeOperation = 'destination-out';\n            }\n        } else {\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            }\n        }\n\n        if (this.path.length > 1) {\n            // path\n            const path = new Path2D();\n            this.path.forEach((item, index) => {\n                if (index === 0) {\n                    path.moveTo(item.x, item.y);\n                } else {\n                    path.lineTo(item.x, item.y);\n                }\n            });\n\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\n                r: color.r,\n                g: color.g,\n                b: color.b,\n                a: this.settingOpacity,\n            });\n            if (this.settingGradient) {\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\n                const gradient = this.context.createLinearGradient(\n                    0,\n                    startAtTop ? this.minY : this.maxY,\n                    0,\n                    startAtTop ? this.maxY : this.minY,\n                );\n                gradient.addColorStop(\n                    0,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: this.settingOpacity,\n                    }),\n                );\n                gradient.addColorStop(\n                    1,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: 0,\n                    }),\n                );\n                style = gradient;\n            }\n\n            // setup params\n            if (this.settingMode === 'fill') {\n                this.context.fillStyle = style;\n            } else {\n                this.context.lineWidth = this.settingSize * 2;\n                this.context.lineJoin = 'bevel';\n                this.context.strokeStyle = style;\n            }\n\n            // draw\n            const draw = () => {\n                if (this.settingMode === 'fill') {\n                    this.context.fill(path);\n                } else {\n                    this.context.stroke(path);\n                }\n            };\n\n            draw();\n            if (this.settingXSymmetry) {\n                this.context.save();\n                this.context.translate(this.context.canvas.width / 2, 0);\n                this.context.scale(-1, 1);\n                this.context.translate(-this.context.canvas.width / 2, 0);\n                draw();\n                this.context.restore();\n            }\n            if (this.settingYSymmetry) {\n                this.context.save();\n                this.context.translate(0, this.context.canvas.height / 2);\n                this.context.scale(1, -1);\n                this.context.translate(0, -this.context.canvas.height / 2);\n                draw();\n                this.context.restore();\n                if (this.settingXSymmetry) {\n                    this.context.save();\n                    this.context.translate(\n                        this.context.canvas.width / 2,\n                        this.context.canvas.height / 2,\n                    );\n                    this.context.scale(-1, -1);\n                    this.context.translate(\n                        -this.context.canvas.width / 2,\n                        -this.context.canvas.height / 2,\n                    );\n                    draw();\n                    this.context.restore();\n                }\n            }\n        }\n\n        this.context.restore();\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {}\n\n    setHistory(klHistory: KlHistory): void {\n        this.klHistory = klHistory;\n    }\n\n    getSize(): number {\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\n    }\n\n    setSize(s: number): void {\n        this.settingSize = s;\n    }\n\n    getOpacity(): number {\n        return this.settingOpacity;\n    }\n\n    setOpacity(o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setColor(c: TRgb): void {\n        this.settingColor = BB.copyObj(c);\n    }\n\n    setContext(c: CanvasRenderingContext2D) {\n        this.context = c;\n    }\n\n    setMode(mode: TChemyMode): void {\n        this.settingMode = mode;\n    }\n\n    getMode(): TChemyMode {\n        return this.settingMode;\n    }\n\n    setDistort(distort: number): void {\n        this.settingDistort = BB.clamp(distort, 0, 1);\n    }\n\n    getDistort(): number {\n        return this.settingDistort;\n    }\n\n    setXSymmetry(b: boolean): void {\n        this.settingXSymmetry = b;\n    }\n\n    getXSymmetry(): boolean {\n        return this.settingXSymmetry;\n    }\n\n    setYSymmetry(b: boolean): void {\n        this.settingYSymmetry = b;\n    }\n\n    getYSymmetry(): boolean {\n        return this.settingYSymmetry;\n    }\n\n    setGradient(b: boolean): void {\n        this.settingGradient = b;\n    }\n\n    getGradient(): boolean {\n        return this.settingGradient;\n    }\n\n    getLockAlpha(): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha(b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    getIsEraser(): boolean {\n        return this.settingIsEraser;\n    }\n\n    setIsEraser(b: boolean): void {\n        this.settingIsEraser = b;\n    }\n\n    getIsDrawing(): boolean {\n        return this.isDrawing;\n    }\n\n    startLine(x: number, y: number): void {\n        this.selection = this.klHistory.getComposed().selection.value;\n        this.selectionPath = this.selection ? getSelectionPath2d(this.selection) : undefined;\n        this.selectionBounds = this.selection\n            ? integerBounds(getMultiPolyBounds(this.selection))\n            : undefined;\n        this.isDrawing = true;\n        this.path = [{ x, y }];\n        this.minY = y;\n        this.maxY = y;\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\n        BB.ctx(this.copyCanvas).drawImage(this.context.canvas, 0, 0);\n        this.completeRedrawBounds = undefined;\n        this.updateCompleteRedrawBounds(x, y);\n    }\n\n    goLine(x: number, y: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        const pos = { x, y };\n        if (this.settingDistort > 0) {\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\n        }\n\n        this.minY = Math.min(this.minY, pos.y);\n        this.maxY = Math.max(this.maxY, pos.y);\n        this.path.push(pos);\n        this.updateCompleteRedrawBounds(x, y);\n        this.drawShape();\n    }\n\n    endLine(): void {\n        this.isDrawing = false;\n        this.completeRedrawBounds = BB.boundsInArea(\n            this.completeRedrawBounds,\n            this.copyCanvas.width,\n            this.copyCanvas.height,\n        );\n        if (this.path.length > 1 && this.completeRedrawBounds) {\n            const layerData = canvasToLayerTiles(this.context.canvas, this.completeRedrawBounds);\n            this.klHistory.push(getPushableLayerChange(this.klHistory.getComposed(), layerData));\n        }\n        this.path = [];\n        this.copyCanvas = {} as HTMLCanvasElement;\n    }\n\n    drawLineSegment(x1: number, y1: number, x2: number, y2: number): void {\n        // might make sense for stroke\n    }\n}\n","import { penBrushUi } from './pen-brush-ui';\nimport { blendBrushUi } from './blend-brush-ui';\nimport { sketchyBrushUi } from './sketchy-brush-ui';\nimport { pixelBrushUi } from './pixel-brush-ui';\nimport { eraserBrushUi } from './eraser-brush-ui';\nimport { smudgeBrushUi } from './smudge-brush-ui';\nimport { chemyBrushUi } from './chemy-brush-ui';\nimport { TBrushUi } from '../kl-types';\n\n/**\n * UI for brushes.\n * Each brush ui carries the brush with it.\n * So if you want to draw, you do it through the UI. should be changed sometime.\n */\n\nexport const BRUSHES_UI: {\n    [key: string]: TBrushUi<any>;\n} = {\n    penBrush: penBrushUi,\n    blendBrush: blendBrushUi,\n    sketchyBrush: sketchyBrushUi,\n    pixelBrush: pixelBrushUi,\n    chemyBrush: chemyBrushUi,\n    smudgeBrush: smudgeBrushUi,\n    eraserBrush: eraserBrushUi,\n};\n","import { BB } from '../../bb/bb';\nimport { BRUSHES } from '../brushes/brushes';\nimport { EVENT_RES_MS } from './brushes-consts';\nimport { Checkbox } from '../ui/components/checkbox';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport { createPenPressureToggle } from '../ui/components/create-pen-pressure-toggle';\nimport brushIconImg from 'url:/src/app/img/ui/brush-pen.svg';\nimport { genBrushAlpha01, genBrushAlpha02 } from '../brushes/alphas/brush-alphas';\nimport { TBrushUi } from '../kl-types';\nimport { LANG, LANGUAGE_STRINGS } from '../../language/language';\nimport { Options } from '../ui/components/options';\nimport { PenBrush } from '../brushes/pen-brush';\n\nexport const penBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pen'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.powerSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n            curve: [\n                [0, 1 / 100],\n                [0.5, 30 / 100],\n                [1, 1],\n            ],\n        },\n        scatterSlider: {\n            min: 0,\n            max: 100,\n            curve: BB.powerSplineInput(0, 100, 0.1, 2.5),\n        },\n    } as TBrushUi<PenBrush>;\n\n    let alphaNames = [\n        LANG('brush-pen-circle'),\n        LANG('brush-pen-chalk'),\n        LANG('brush-pen-calligraphy'),\n        LANG('brush-pen-square'),\n    ];\n    LANGUAGE_STRINGS.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pen');\n        alphaNames = [\n            LANG('brush-pen-circle'),\n            LANG('brush-pen-chalk'),\n            LANG('brush-pen-calligraphy'),\n            LANG('brush-pen-square'),\n        ];\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new BRUSHES.PenBrush();\n        brush.setHistory(p.klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n        let scatterSlider: KlSlider;\n\n        const alphaOptions = new Options({\n            optionArr: [0, 1, 2, 3].map((id) => {\n                const alpha = BB.el({\n                    className: 'dark-invert',\n                    css: {\n                        width: '31px',\n                        height: '31px',\n                        backgroundSize: 'contain',\n                        margin: '2px',\n                    },\n                });\n                const canvas = BB.canvas(70, 70);\n                const ctx = BB.ctx(canvas);\n                if (id === 0 || id === 3) {\n                    if (id === 0) {\n                        ctx.beginPath();\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else {\n                        ctx.fillRect(5, 5, 60, 60);\n                    }\n                } else if (id === 1) {\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\n                } else if (id === 2) {\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\n                }\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\n\n                return {\n                    id: id,\n                    label: alpha,\n                    title: alphaNames[id],\n                };\n            }),\n            initId: 0,\n            onChange: (id) => {\n                brush.setAlpha(id);\n            },\n        });\n\n        const lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n            css: {\n                display: 'inline-block',\n            },\n            name: 'lock-alpha-toggle',\n        });\n\n        const spacingSpline = new BB.SplineInterpolator([\n            [0, 15],\n            [8, 7],\n            [14, 4],\n            [30, 3],\n            [50, 2.7],\n            [100, 2],\n        ]);\n\n        function setSize(size: number) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n            scatterSlider = new KlSlider({\n                label: LANG('scatter'),\n                width: 225,\n                height: 30,\n                min: brushInterface.scatterSlider.min,\n                max: brushInterface.scatterSlider.max,\n                value: brushInterface.scatterSlider.min,\n                curve: brushInterface.scatterSlider.curve,\n                eventResMs: EVENT_RES_MS,\n                onChange: (val) => {\n                    brush.setScatter(val);\n                    p.onScatterChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n            const pressureScatterToggle = createPenPressureToggle(false, function (b) {\n                brush.scatterPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [sizeSlider.getElement(), pressureSizeToggle],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [opacitySlider.getElement(), pressureOpacityToggle],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [scatterSlider.getElement(), pressureScatterToggle],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                }),\n                BB.el({\n                    content: alphaOptions.getElement(),\n                    css: {\n                        marginTop: '10px',\n                    },\n                }),\n                BB.el({\n                    content: lockAlphaToggle.getElement(),\n                    css: {\n                        marginTop: '10px',\n                    },\n                }),\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.getScatter = function () {\n            return brush.getScatter();\n        };\n        this.setScatter = function (scatter) {\n            brush.setScatter(scatter);\n            scatterSlider.setValue(scatter);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setLayer = function (layer) {\n            brush.setContext(layer.context);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as TBrushUi<PenBrush>['Ui'];\n    return brushInterface;\n})();\n","export const EVENT_RES_MS = 20;\n","module.exports = parcelRequire.resolve(\"brush-pen.3d165b19.svg\") + \"?\" + Date.now();","import { BB } from '../../bb/bb';\nimport { createPenPressureToggle } from '../ui/components/create-pen-pressure-toggle';\nimport { EVENT_RES_MS } from './brushes-consts';\nimport { Checkbox } from '../ui/components/checkbox';\nimport { BRUSHES } from '../brushes/brushes';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport brushIconImg from 'url:/src/app/img/ui/brush-blend.svg';\nimport { TBrushUi } from '../kl-types';\nimport { LANG, LANGUAGE_STRINGS } from '../../language/language';\nimport { BlendBrush } from '../brushes/blend-brush';\n\nexport const blendBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-blend'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.powerSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as TBrushUi<BlendBrush>;\n\n    LANGUAGE_STRINGS.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-blend');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new BRUSHES.BlendBrush();\n        brush.setHistory(p.klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        function setSize(size: number): void {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 58,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n            const blendingSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 225,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: function (val) {\n                    brush.setBlending(val);\n                },\n            });\n            blendingSlider.getElement().style.marginTop = '10px';\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.setSizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.setOpacityPressure(b);\n            });\n\n            const lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                    display: 'inline-block',\n                },\n                name: 'lock-alpha',\n            });\n\n            div.append(\n                BB.el({\n                    content: [sizeSlider.getElement(), pressureSizeToggle],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [opacitySlider.getElement(), pressureOpacityToggle],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                }),\n                blendingSlider.getElement(),\n                lockAlphaToggle.getElement(),\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setLayer = function (layer) {\n            brush.setContext(layer.context, layer.id);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y, p, false); // looks weird with isCoalesced\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as TBrushUi<BlendBrush>['Ui'];\n\n    return brushInterface;\n})();\n","module.exports = parcelRequire.resolve(\"brush-blend.4bf2ab02.svg\") + \"?\" + Date.now();","import { BRUSHES } from '../brushes/brushes';\nimport { EVENT_RES_MS } from './brushes-consts';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport brushIconImg from 'url:/src/app/img/ui/brush-sketchy.png';\nimport { TBrushUi } from '../kl-types';\nimport { LANG, LANGUAGE_STRINGS } from '../../language/language';\nimport { BB } from '../../bb/bb';\nimport { SketchyBrush } from '../brushes/sketchy-brush';\n\nexport const sketchyBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-sketchy'),\n        sizeSlider: {\n            min: 0.5,\n            max: 10,\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as TBrushUi<SketchyBrush>;\n\n    LANGUAGE_STRINGS.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-sketchy');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new BRUSHES.SketchyBrush();\n        brush.setHistory(p.klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        function setSize(size: number) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize() * 2,\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: function (val) {\n                    brush.setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n            const blendSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 250,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: function (val) {\n                    brush.setBlending(val);\n                },\n            });\n            const scaleSlider = new KlSlider({\n                label: LANG('brush-sketchy-scale'),\n                width: 250,\n                height: 30,\n                min: 1,\n                max: 20,\n                value: brush.getScale(),\n                eventResMs: EVENT_RES_MS,\n                onChange: function (val) {\n                    brush.setScale(val);\n                },\n            });\n            opacitySlider.getElement().style.marginTop = '10px';\n            blendSlider.getElement().style.marginTop = '10px';\n            scaleSlider.getElement().style.marginTop = '10px';\n            div.append(\n                sizeSlider.getElement(),\n                opacitySlider.getElement(),\n                blendSlider.getElement(),\n                scaleSlider.getElement(),\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setLayer = function (layer) {\n            brush.setContext(layer.context);\n        };\n        this.startLine = function (x, y, pressure) {\n            brush.startLine(x, y, pressure);\n        };\n        this.goLine = function (x, y, pressure) {\n            brush.goLine(x, y, pressure, undefined);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getSeed = function () {\n            return parseInt('' + brush.getSeed());\n        };\n        this.setSeed = function (s) {\n            brush.setSeed(parseInt('' + s));\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as TBrushUi<SketchyBrush>['Ui'];\n\n    return brushInterface;\n})();\n","module.exports = parcelRequire.resolve(\"brush-sketchy.c262a660.png\") + \"?\" + Date.now();","import { BB } from '../../bb/bb';\nimport { BRUSHES } from '../brushes/brushes';\nimport { EVENT_RES_MS } from './brushes-consts';\nimport { Checkbox } from '../ui/components/checkbox';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport { createPenPressureToggle } from '../ui/components/create-pen-pressure-toggle';\nimport brushIconImg from 'url:/src/app/img/ui/brush-pixel.svg';\nimport { TBrushUi } from '../kl-types';\nimport { LANG, LANGUAGE_STRINGS } from '../../language/language';\nimport { PixelBrush } from '../brushes/pixel-brush';\n\nexport const pixelBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pixel'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.powerSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n            curve: [\n                [0, 1 / 100],\n                [0.5, 0.3],\n                [1, 1],\n            ],\n        },\n    } as TBrushUi<PixelBrush>;\n\n    LANGUAGE_STRINGS.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pixel');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new BRUSHES.PixelBrush();\n        brush.setHistory(p.klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        const lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n            name: 'lock-alpha-toggle',\n        });\n\n        const eraserToggle = new Checkbox({\n            init: brush.getIsEraser(),\n            label: LANG('eraser'),\n            callback: function (b) {\n                brush.setIsEraser(b);\n            },\n            name: 'eraser-toggle',\n        });\n\n        const ditherToggle = new Checkbox({\n            init: brush.getUseDither(),\n            label: LANG('brush-pixel-dither'),\n            callback: function (b) {\n                brush.setUseDither(b);\n            },\n            name: 'dither-toggle',\n        });\n\n        const spacingSpline = new BB.SplineInterpolator([\n            [0.5, 0.45],\n            [100, 4],\n        ]);\n\n        function setSize(size: number) {\n            brush.setSize(size);\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [sizeSlider.getElement(), pressureSizeToggle],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                opacitySlider.getElement(),\n            );\n\n            const toggleRow = BB.el({\n                parent: div,\n                css: {\n                    display: 'flex',\n                    marginTop: '10px',\n                    gap: '10px',\n                    flexWrap: 'wrap',\n                },\n            });\n\n            toggleRow.append(\n                lockAlphaToggle.getElement(),\n                eraserToggle.getElement(),\n                ditherToggle.getElement(),\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size * 2);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity * 100);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setLayer = function (layer) {\n            brush.setContext(layer.context);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.toggleEraser = () => {\n            eraserToggle.setValue(!eraserToggle.getValue());\n            brush.setIsEraser(eraserToggle.getValue());\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as TBrushUi<PixelBrush>['Ui'];\n    return brushInterface;\n})();\n","module.exports = parcelRequire.resolve(\"brush-pixel.2db493a1.svg\") + \"?\" + Date.now();","import { BB } from '../../bb/bb';\nimport { BRUSHES } from '../brushes/brushes';\nimport { EVENT_RES_MS } from './brushes-consts';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport { createPenPressureToggle } from '../ui/components/create-pen-pressure-toggle';\nimport { Checkbox } from '../ui/components/checkbox';\nimport brushIconImg from 'url:/src/app/img/ui/brush-eraser.svg';\nimport { TBrushUi } from '../kl-types';\nimport { LANG, LANGUAGE_STRINGS } from '../../language/language';\nimport { EraserBrush } from '../brushes/eraser-brush';\n\nexport const eraserBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('eraser') + ' [E]',\n        sizeSlider: {\n            min: 0.5,\n            max: 200,\n            curve: BB.powerSplineInput(0.5, 200, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as TBrushUi<EraserBrush>;\n\n    LANGUAGE_STRINGS.subscribe(() => {\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new BRUSHES.EraserBrush();\n        brush.setHistory(p.klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n        let isTransparentBg = false;\n\n        function setSize(size: number) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 30,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [sizeSlider.getElement(), pressureSizeToggle],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [opacitySlider.getElement(), pressureOpacityToggle],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                }),\n            );\n\n            const transparencyToggle = new Checkbox({\n                init: false,\n                label: LANG('brush-eraser-transparent-bg'),\n                callback: function (b) {\n                    isTransparentBg = b;\n                    brush.setTransparentBG(b);\n                },\n                css: {\n                    marginTop: '10px',\n                },\n                name: 'transparency-toggle',\n            });\n            div.append(transparencyToggle.getElement());\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function () {};\n\n        this.setLayer = function (layer) {\n            brush.setLayer(layer);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.getIsTransparentBg = function () {\n            return isTransparentBg;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as TBrushUi<EraserBrush>['Ui'];\n\n    return brushInterface;\n})();\n","module.exports = parcelRequire.resolve(\"brush-eraser.f54a9f13.svg\") + \"?\" + Date.now();","import { BB } from '../../bb/bb';\nimport { BRUSHES } from '../brushes/brushes';\nimport { EVENT_RES_MS } from './brushes-consts';\nimport { Checkbox } from '../ui/components/checkbox';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport { createPenPressureToggle } from '../ui/components/create-pen-pressure-toggle';\nimport brushIconImg from 'url:/src/app/img/ui/brush-smudge.svg';\nimport { TBrushUi } from '../kl-types';\nimport { LANG, LANGUAGE_STRINGS } from '../../language/language';\nimport { SmudgeBrush } from '../brushes/smudge-brush';\n\nexport const smudgeBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-smudge'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.powerSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n            curve: [\n                [0, 1 / 100],\n                [0.5, 0.3],\n                [1, 1],\n            ],\n        },\n    } as TBrushUi<SmudgeBrush>;\n\n    LANGUAGE_STRINGS.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-smudge');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new BRUSHES.SmudgeBrush();\n        brush.setHistory(p.klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        const lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n            css: {\n                display: 'inline-block',\n            },\n            name: 'lock-alpha-toggle',\n        });\n\n        const spacingSpline = new BB.SplineInterpolator([\n            [0, 15],\n            [8, 7],\n            [14, 4],\n            [30, 3],\n            [50, 2.7],\n            [100, 2],\n        ]);\n\n        function setSize(size: number) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(false, function (b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [sizeSlider.getElement(), pressureSizeToggle],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [opacitySlider.getElement(), pressureOpacityToggle],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                }),\n            );\n\n            const bottomRow = BB.el({\n                parent: div,\n                css: {\n                    marginTop: '10px',\n                },\n            });\n            bottomRow.append(lockAlphaToggle.getElement());\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setLayer = function (layer) {\n            brush.setContext(layer.context);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as TBrushUi<SmudgeBrush>['Ui'];\n    return brushInterface;\n})();\n","module.exports = parcelRequire.resolve(\"brush-smudge.e7d43e2c.svg\") + \"?\" + Date.now();","import { BB } from '../../bb/bb';\nimport { EVENT_RES_MS } from './brushes-consts';\nimport { Checkbox } from '../ui/components/checkbox';\nimport { BRUSHES } from '../brushes/brushes';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport brushIconImg from 'url:/src/app/img/ui/brush-chemy.svg';\nimport { TBrushUi } from '../kl-types';\nimport { Options } from '../ui/components/options';\nimport { BoxToggle } from '../ui/components/box-toggle';\nimport { LANG, LANGUAGE_STRINGS } from '../../language/language';\nimport { ChemyBrush } from '../brushes/chemy-brush';\nimport { css } from '../../bb/base/base';\n\nexport const chemyBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-chemy'),\n        sizeSlider: {\n            min: 0.25,\n            max: 25,\n            curve: BB.powerSplineInput(0.25, 25, 0.1),\n            isDisabled: true,\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as TBrushUi<ChemyBrush>;\n\n    LANGUAGE_STRINGS.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-chemy');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new BRUSHES.ChemyBrush();\n        brush.setHistory(p.klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        function setSize(size: number) {\n            brush.setSize(size);\n        }\n\n        let eraserToggle: Checkbox;\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: EVENT_RES_MS,\n                isEnabled: brush.getMode() === 'stroke',\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 5) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: EVENT_RES_MS,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            css(opacitySlider.getElement(), {\n                marginTop: '10px',\n            });\n\n            eraserToggle = new Checkbox({\n                init: brush.getIsEraser(),\n                label: LANG('eraser'),\n                callback: function (b) {\n                    brush.setIsEraser(b);\n                },\n                css: {\n                    marginTop: '10px',\n                    marginLeft: '10px',\n                },\n                name: 'eraser-toggle',\n            });\n\n            const lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                },\n                name: 'lock-alpha-toggle',\n            });\n\n            const toggleRow = BB.el({\n                css: {\n                    display: 'flex',\n                    marginTop: '10px',\n                },\n            });\n\n            const iconSize = 35;\n            const padding = 8;\n            const actualIconSize = iconSize - padding * 2;\n            const halfSize = actualIconSize / 2;\n\n            const modeOptions = new Options({\n                optionArr: [\n                    {\n                        id: 'fill',\n                        label: BB.createSvg({\n                            class: 'dark-invert',\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: '#000',\n                                    css: {\n                                        transformOrigin: '0 0',\n                                        transform: `translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    },\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-fill'),\n                    },\n                    {\n                        id: 'stroke',\n                        label: BB.createSvg({\n                            class: 'dark-invert',\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: 'none',\n                                    stroke: '#000',\n                                    css: {\n                                        strokeWidth: '0.12px',\n                                        transformOrigin: '0 0',\n                                        transform: `translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    },\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-stroke'),\n                    },\n                ],\n                initId: brush.getMode(),\n                onChange: (id: string): void => {\n                    brush.setMode(id as 'stroke' | 'fill');\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\n\n                    const brushSize = brush.getSize();\n                    sizeSlider.setValue(brushSize);\n                    p.onSizeChange(brushSize);\n                    p.onConfigChange();\n                },\n            });\n\n            const mirrorXToggle = new BoxToggle({\n                label: BB.createSvg({\n                    class: 'dark-invert',\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            css: {\n                                strokeWidth: '1px',\n                            },\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\n                        },\n                    ],\n                }),\n                title: LANG('brush-chemy-mirror-x'),\n                init: brush.getXSymmetry(),\n                onChange: (b) => {\n                    brush.setXSymmetry(b);\n                },\n            });\n\n            const mirrorYToggle = new BoxToggle({\n                label: BB.createSvg({\n                    class: 'dark-invert',\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            css: {\n                                strokeWidth: '1px',\n                            },\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\n                        },\n                    ],\n                }),\n                title: LANG('brush-chemy-mirror-y'),\n                init: brush.getYSymmetry(),\n                onChange: (b) => {\n                    brush.setYSymmetry(b);\n                },\n            });\n\n            const gradientToggle = new BoxToggle({\n                label: BB.createSvg({\n                    class: 'dark-invert',\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'defs',\n                            childrenArr: [\n                                {\n                                    elementType: 'linearGradient',\n                                    id: 'gradient',\n                                    x1: '0',\n                                    y1: '0',\n                                    x2: '0',\n                                    y2: '1',\n                                    childrenArr: [\n                                        {\n                                            elementType: 'stop',\n                                            offset: '0%',\n                                            'stop-color': 'rgba(0,0,0,0)',\n                                        },\n                                        {\n                                            elementType: 'stop',\n                                            offset: '100%',\n                                            'stop-color': 'rgba(0,0,0,1)',\n                                        },\n                                    ],\n                                },\n                            ],\n                        },\n                        {\n                            elementType: 'rect',\n                            fill: \"url('#gradient')\",\n                            x: '' + padding,\n                            y: '' + padding,\n                            width: '' + actualIconSize,\n                            height: '' + actualIconSize,\n                        },\n                    ],\n                }),\n                title: LANG('brush-chemy-gradient'),\n                init: brush.getGradient(),\n                onChange: (b) => {\n                    brush.setGradient(b);\n                },\n            });\n\n            css(mirrorXToggle.getElement(), {\n                marginLeft: '10px',\n            });\n            {\n                const margin = {\n                    marginLeft: '4px',\n                };\n                css(mirrorYToggle.getElement(), margin);\n                css(gradientToggle.getElement(), margin);\n            }\n\n            toggleRow.append(\n                modeOptions.getElement(),\n                mirrorXToggle.getElement(),\n                mirrorYToggle.getElement(),\n                gradientToggle.getElement(),\n            );\n\n            div.append(\n                sizeSlider.getElement(),\n                opacitySlider.getElement(),\n                toggleRow,\n                BB.el({\n                    content: [lockAlphaToggle.getElement(), eraserToggle.getElement()],\n                    css: {\n                        display: 'flex',\n                    },\n                }),\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setLayer = function (layer) {\n            brush.setContext(layer.context);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.toggleEraser = () => {\n            eraserToggle.setValue(!eraserToggle.getValue());\n            brush.setIsEraser(eraserToggle.getValue());\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as TBrushUi<ChemyBrush>['Ui'];\n\n    return brushInterface;\n})();\n","module.exports = parcelRequire.resolve(\"brush-chemy.cc5e3952.svg\") + \"?\" + Date.now();","import { BB } from '../../../bb/bb';\nimport { DynamicModal } from './base/dynamic-modal';\nimport { LANG } from '../../../language/language';\n\nexport function showIframeModal(url: string, isEmbed: boolean) {\n    // window very small, modal might look bad\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\n        window.open(url);\n        return;\n    }\n\n    const iframe = BB.el({\n        tagName: 'iframe',\n        custom: {\n            src: url,\n        },\n        css: {\n            width: '100%',\n            height: '100%',\n            opacity: '0',\n        },\n    });\n    setTimeout(() => {\n        iframe.style.opacity = ''; // fallback\n    }, 500);\n\n    const titleEl = BB.el();\n\n    let linkEl: HTMLElement | undefined;\n    if (!isEmbed) {\n        linkEl = BB.el({\n            tagName: 'a',\n            parent: titleEl,\n            content: LANG('modal-new-tab'),\n            custom: {\n                href: 'help',\n                target: '_blank',\n            },\n            onClick: function () {\n                popup.close();\n            },\n        });\n        iframe.onload = () => {\n            if (linkEl && iframe.contentWindow) {\n                try {\n                    BB.setAttributes(linkEl, {\n                        href: '' + iframe.contentWindow.location,\n                    });\n                } catch (e) {\n                    // might not have access\n                }\n            }\n            iframe.style.opacity = '';\n        };\n    }\n\n    const popup = new DynamicModal({\n        title: titleEl,\n        content: iframe,\n        width: 880,\n        isMaxHeight: true,\n        onClose: () => {\n            if (linkEl) {\n                iframe.src = 'about:blank';\n                BB.destroyEl(linkEl);\n                linkEl = undefined;\n            }\n        },\n    });\n}\n","import { BB } from '../../../bb/bb';\n\nexport class RadioList {\n    el: HTMLDivElement;\n    inputs: HTMLInputElement[] = [];\n\n    constructor({\n        name,\n        init,\n        items,\n        ignoreFocus,\n    }: {\n        name: string;\n        init?: string;\n        items: {\n            label: string;\n            value: string;\n        }[];\n        ignoreFocus?: boolean; // default false\n    }) {\n        this.el = BB.el({\n            className: 'kl-radio',\n        });\n\n        items.forEach((item) => {\n            const label = BB.el({\n                tagName: 'label',\n            });\n            const input = BB.el({\n                tagName: 'input',\n                parent: label,\n                custom: {\n                    name: name,\n                    value: item.value,\n                    type: 'radio',\n                },\n            });\n            if (ignoreFocus) {\n                input.setAttribute('data-ignore-focus', 'true');\n            }\n            if (init === item.value) {\n                input.checked = true;\n            }\n            label.append(item.label);\n            this.el.append(label);\n            this.inputs.push(input);\n        });\n    }\n\n    getValue(): string | null {\n        for (let i = 0; i < this.inputs.length; i++) {\n            if (this.inputs[i].checked) {\n                return this.inputs[i].value;\n            }\n        }\n        return null;\n    }\n\n    getElement() {\n        return this.el;\n    }\n}\n","import { BB } from '../../../bb/bb';\n\nimport removeLayerImg from 'url:/src/app/img/ui/remove-layer.svg';\nimport { TKlProject } from '../../kl-types';\nimport { ProjectStore, TProjectStoreListener } from '../../storage/project-store';\nimport { KL } from '../../kl';\nimport { LANG } from '../../../language/language';\nimport { showModal } from '../modals/base/showModal';\nimport { timestampToAge } from '../utils/timestamp-to-age';\nimport { BrowserStorageHeaderUi } from './browser-storage-header-ui';\nimport * as classes from './browser-storage-ui.module.scss';\nimport { makeUnfocusable } from '../../../bb/base/ui';\nimport { requestPersistentStorage } from '../../storage/request-persistent-storage';\nimport { copyCanvas } from '../../../bb/base/canvas';\n\nexport type TBrowserStorageUiParams = {\n    projectStore: ProjectStore;\n    getProject: () => TKlProject;\n    klRootEl: HTMLElement;\n    applyUncommitted: () => void;\n    options?: { hideClearButton?: boolean; isFocusable?: boolean }; // isFocusable default = false\n    onOpen?: () => void;\n    onStored: () => void;\n};\n\nexport class BrowserStorageUi {\n    private readonly rootEl: HTMLDivElement;\n    private readonly contentEl: HTMLDivElement;\n    private readonly previewEl: HTMLDivElement = {} as HTMLDivElement;\n    private readonly header: BrowserStorageHeaderUi;\n    private readonly ageEl: HTMLElement = {} as HTMLElement;\n    private readonly emptyEl: HTMLElement = {} as HTMLElement;\n    private readonly openButtonEl: HTMLButtonElement | undefined;\n    private readonly storeButtonEl: HTMLButtonElement = {} as HTMLButtonElement;\n    private readonly clearButtonEl: HTMLButtonElement = {} as HTMLButtonElement;\n    private readonly storeListener: TProjectStoreListener = {} as TProjectStoreListener;\n    private isFirst: boolean = true;\n\n    private timestamp: number | undefined;\n    private thumbnail: HTMLImageElement | HTMLCanvasElement | undefined;\n    private projectStore: ProjectStore;\n    private readonly getProject: () => TKlProject;\n    private readonly onStored: () => void;\n    private readonly klRootEl: HTMLElement;\n    private readonly applyUncommitted: () => void;\n    private options: { hideClearButton?: boolean; isFocusable?: boolean } | undefined;\n    private readonly onOpen: (() => void) | undefined;\n    private readonly updateAgeInterval: ReturnType<typeof setInterval>;\n\n    private updateAge(): void {\n        if (!this.timestamp) {\n            return;\n        }\n        this.ageEl.textContent = timestampToAge(this.timestamp);\n    }\n\n    private resetButtons(): void {\n        this.previewEl.classList.remove('kl-storage-preview--disabled');\n        if (this.timestamp) {\n            if (this.openButtonEl) {\n                this.openButtonEl.disabled = false;\n            }\n            this.storeButtonEl.textContent = LANG('file-storage-overwrite');\n            this.storeButtonEl.disabled = false;\n            this.clearButtonEl.disabled = false;\n        } else {\n            if (this.openButtonEl) {\n                this.openButtonEl.disabled = true;\n            }\n            this.storeButtonEl.textContent = LANG('file-storage-store');\n            this.storeButtonEl.disabled = false;\n            this.clearButtonEl.disabled = true;\n        }\n    }\n\n    private updateThumb(\n        timestamp?: number,\n        thumbnail?: HTMLImageElement | HTMLCanvasElement,\n    ): void {\n        this.timestamp = timestamp;\n        this.thumbnail?.remove();\n        this.thumbnail = thumbnail ? copyCanvas(thumbnail) : undefined;\n\n        const thumbnailCanvas = this.thumbnail; // typescript being weird\n        if (thumbnailCanvas && timestamp) {\n            thumbnailCanvas.classList.add('kl-storage-preview__im');\n            this.ageEl.remove();\n            this.emptyEl.remove();\n            this.updateAge();\n            this.previewEl.append(thumbnailCanvas, this.ageEl);\n            this.previewEl.style.pointerEvents = this.onOpen ? '' : 'none';\n\n            if (typeof performance !== 'undefined' && timestamp > performance.timeOrigin) {\n                const animEl = BB.el({\n                    parent: this.previewEl,\n                    className: classes.animEl,\n                });\n                setTimeout(() => {\n                    animEl.remove();\n                }, 500);\n            }\n        } else {\n            this.ageEl.remove();\n            this.previewEl.append(this.emptyEl);\n            this.previewEl.style.pointerEvents = 'none'; // prevent title\n        }\n        this.resetButtons();\n    }\n\n    private async store(): Promise<void> {\n        const meta = this.projectStore.getCurrentMeta();\n        const project = this.getProject();\n\n        if (meta && meta.projectId !== project.projectId) {\n            const doOverwrite = await new Promise<boolean>((resolve, reject) => {\n                showModal({\n                    target: document.body,\n                    type: 'warning',\n                    message: LANG('file-storage-overwrite-confirm'),\n                    buttons: [LANG('file-storage-overwrite'), 'Cancel'],\n                    callback: async (result) => {\n                        if (result === 'Cancel') {\n                            resolve(false);\n                            return;\n                        }\n                        resolve(true);\n                    },\n                });\n            });\n            if (!doOverwrite) {\n                return;\n            }\n        }\n\n        this.applyUncommitted();\n        await requestPersistentStorage();\n        if (this.openButtonEl) {\n            this.openButtonEl.disabled = true;\n        }\n        this.storeButtonEl.textContent = LANG('file-storage-storing');\n        this.storeButtonEl.disabled = true;\n        this.clearButtonEl.disabled = true;\n        this.previewEl.classList.add('kl-storage-preview--disabled');\n        await new Promise((resolve) => {\n            setTimeout(() => resolve(null), 20);\n        });\n        try {\n            await this.projectStore.store(project);\n            this.onStored();\n        } catch (e) {\n            this.resetButtons();\n            KL.popup({\n                target: this.klRootEl,\n                type: 'error',\n                message: [\n                    `${LANG('file-storage-failed-1')}<ul>`,\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\n                    '</ul>',\n                ].join(''),\n                buttons: ['Ok'],\n            });\n            setTimeout(() => {\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\n            }, 0);\n        }\n    }\n\n    private async clear(): Promise<void> {\n        showModal({\n            target: document.body,\n            type: 'warning',\n            message: LANG('file-storage-clear-prompt'),\n            buttons: [LANG('file-storage-clear'), 'Cancel'],\n            deleteButtonName: LANG('file-storage-clear'),\n            callback: async (result) => {\n                if (result === 'Cancel') {\n                    return;\n                }\n\n                if (this.openButtonEl) {\n                    this.openButtonEl.disabled = true;\n                }\n                this.storeButtonEl.disabled = true;\n                this.clearButtonEl.disabled = true;\n                try {\n                    await this.projectStore.clear();\n                } catch (e) {\n                    this.resetButtons();\n                    KL.popup({\n                        target: this.klRootEl,\n                        type: 'error',\n                        message: LANG('file-storage-failed-clear'),\n                        buttons: ['Ok'],\n                    });\n                    setTimeout(() => {\n                        throw new Error('storage-ui: failed to clear browser storage, ' + e);\n                    }, 0);\n                }\n            },\n        });\n    }\n\n    private showError(): void {\n        this.contentEl.innerHTML = '';\n        BB.el({\n            parent: this.contentEl,\n            content: ' ' + LANG('file-storage-cant-access'),\n            css: {\n                marginTop: '10px',\n            },\n        });\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TBrowserStorageUiParams) {\n        this.updateAgeInterval = setInterval(() => this.updateAge(), 1000 * 60);\n        this.projectStore = p.projectStore;\n        this.getProject = p.getProject;\n        this.onStored = p.onStored;\n        this.klRootEl = p.klRootEl;\n        this.applyUncommitted = p.applyUncommitted;\n        this.options = p.options;\n        this.onOpen = p.onOpen;\n\n        this.rootEl = BB.el({});\n\n        this.header = new BrowserStorageHeaderUi();\n        this.rootEl.append(this.header.getElement());\n\n        this.contentEl = BB.el({\n            parent: this.rootEl,\n        });\n\n        if (!this.projectStore.getIsAvailable()) {\n            this.showError();\n            return;\n        }\n\n        this.previewEl = BB.el({\n            className: 'kl-storage-preview',\n            onClick: () => this.onOpen?.(),\n            title: LANG('file-storage-open'),\n            noRef: true,\n        });\n        this.emptyEl = BB.el({\n            content: LANG('file-storage-empty'),\n        });\n        this.ageEl = BB.el({\n            css: {\n                position: 'absolute',\n                right: '0',\n                bottom: '0',\n                width: '100%',\n                textAlign: 'center',\n                background: 'rgba(0,0,0,0.7)',\n                color: '#fff',\n                fontSize: '13px',\n            },\n        });\n        if (this.onOpen) {\n            this.openButtonEl = BB.el({\n                tagName: 'button',\n                className: 'grid-button',\n                content: LANG('file-storage-open'),\n                css: {\n                    margin: '0',\n                },\n                onClick: () => this.onOpen?.(),\n                noRef: true,\n            });\n        }\n        this.storeButtonEl = BB.el({\n            tagName: 'button',\n            className: 'grid-button',\n            content: LANG('file-storage-store'),\n            css: {\n                margin: '0',\n            },\n            onClick: () => this.store(),\n            noRef: true,\n        });\n        this.clearButtonEl = BB.el({\n            tagName: 'button',\n            className: 'grid-button kl-button-delete',\n            content:\n                '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\n            css: {\n                margin: '0',\n            },\n            onClick: () => this.clear(),\n            noRef: true,\n        });\n        if (!this.options?.isFocusable) {\n            this.openButtonEl && makeUnfocusable(this.openButtonEl);\n            makeUnfocusable(this.storeButtonEl);\n            makeUnfocusable(this.clearButtonEl);\n        }\n\n        if (this.options?.hideClearButton) {\n            this.clearButtonEl.style.visibility = 'hidden';\n        }\n\n        this.contentEl.append(\n            BB.el({\n                content: [\n                    BB.el({\n                        content: this.previewEl,\n                        css: {\n                            alignSelf: 'stretch',\n                            flexGrow: '1',\n                        },\n                    }),\n                    BB.el({\n                        content: [this.openButtonEl, this.storeButtonEl, this.clearButtonEl],\n                        css: {\n                            display: 'flex',\n                            gap: '10px',\n                            flexDirection: 'column',\n                        },\n                    }),\n                ],\n                css: {\n                    marginTop: '10px',\n                    display: 'flex',\n                    gap: '10px',\n                },\n            }),\n        );\n\n        this.storeListener = {\n            onUpdate: (project) => {\n                this.updateThumb(project?.timestamp, project?.thumbnail);\n            },\n        };\n        this.projectStore.subscribe(this.storeListener);\n        this.updateThumb();\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    show(): void {\n        if (this.isFirst) {\n            this.isFirst = false;\n            if (!this.projectStore.getIsAvailable()) {\n                this.showError();\n            } else {\n                (async () => {\n                    try {\n                        await this.projectStore.update();\n                        const meta = this.projectStore.getCurrentMeta();\n                        if (meta) {\n                            this.updateThumb(meta.timestamp, meta.thumbnail);\n                        } else {\n                            this.updateThumb();\n                        }\n                    } catch (e) {\n                        this.showError();\n                        throw new Error(\n                            'browser-storage-ui: failed initial read browser storage, ' + e,\n                        );\n                    }\n                })();\n            }\n        }\n    }\n\n    hide(): void {\n        // ...\n    }\n\n    destroy(): void {\n        this.header.destroy();\n        BB.destroyEl(this.storeButtonEl);\n        BB.destroyEl(this.clearButtonEl);\n        clearInterval(this.updateAgeInterval);\n        this.projectStore.unsubscribe(this.storeListener);\n    }\n}\n","import { LANG } from '../../../language/language';\n\nexport function timestampToAge(timestamp: number): string {\n    let age = new Date().getTime() - timestamp;\n    let ageStr;\n    age = Math.floor(age / 1000 / 60);\n    ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\n    if (age > 60) {\n        age = Math.floor(age / 60);\n        ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\n        if (age > 24) {\n            age = Math.floor(age / 24);\n            ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\n            if (age > 31) {\n                ageStr = LANG('file-storage-month-ago');\n            }\n        }\n    }\n    return ageStr;\n}\n","import { BB } from '../../../bb/bb';\nimport { LANG } from '../../../language/language';\nimport { showIframeModal } from '../modals/show-iframe-modal';\n\nexport class BrowserStorageHeaderUi {\n    private readonly rootEl: HTMLElement;\n    private readonly infoButton: HTMLElement;\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {\n        this.infoButton = BB.el({\n            content: '?',\n            className: 'kl-info-btn',\n            title: LANG('file-storage-about'),\n            onClick: () => {\n                showIframeModal('./help/#help-browser-storage', false);\n            },\n        });\n\n        this.rootEl = BB.el({\n            content: LANG('file-storage'),\n            css: {\n                display: 'flex',\n                margin: '-5px 0',\n                gap: '6px',\n            },\n        });\n        this.rootEl.append(this.infoButton);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    show(): void {}\n\n    destroy(): void {\n        BB.destroyEl(this.infoButton);\n    }\n}\n",null,"/**\n * https://developer.mozilla.org/en-US/docs/Web/API/StorageManager/persist\n * Might reduce deletions of indexedDB data by browser.\n *\n * \"The best time to request your storage be marked as persistent is when you save critical user\n * data, and the request should ideally be **wrapped in a user gesture**.\"\n * from https://web.dev/articles/persistent-storage\n */\nexport async function requestPersistentStorage(): Promise<void> {\n    if ('storage' in navigator && 'persist' in navigator.storage) {\n        await navigator.storage.persist();\n    }\n}\n","import { TDeserializedKlStorageProject, TKlProject, TKlProjectMeta, TRawMeta } from '../kl-types';\nimport {\n    PROJECT_STORE_THUMBNAIL_SIZE_PX,\n    ProjectConverter,\n    TKlStorageProjectRead,\n    TKlStorageProjectWrite,\n} from './project-converter';\nimport { LocalStorage } from '../../bb/base/local-storage';\nimport { BROWSER_STORAGE_STORE, IMAGE_DATA_STORE, KL_INDEXED_DB } from './kl-indexed-db';\nimport { isBlob, randomUuid } from '../../bb/base/base';\nimport { TIdb } from './kl-indexed-db.types';\nimport { BB } from '../../bb/bb';\nimport { canvasToBlob } from '../../bb/base/canvas';\n\nexport type TImageDataReference = {\n    id: string; // id of imageDataStore entry\n    //sizeBytes: number;\n};\n\nexport function isTImageDataReference(input: unknown): input is TImageDataReference {\n    return (\n        typeof input === 'object' &&\n        input !== null &&\n        'id' in input &&\n        typeof (input as any).id === 'string'\n    );\n}\n\nasync function createFallbackThumbnail(): Promise<Blob> {\n    // very basic fallback. only affects data stored before version 0.5.1 (2022)\n    return await canvasToBlob(\n        BB.canvas(PROJECT_STORE_THUMBNAIL_SIZE_PX, PROJECT_STORE_THUMBNAIL_SIZE_PX),\n        'image/png',\n    );\n}\n\nexport type TProjectStoreListener = {\n    onUpdate: (meta?: TKlProjectMeta) => void;\n};\n\n/**\n * simplified interface for storing projects into browser storage\n */\nexport class ProjectStore {\n    private listeners: TProjectStoreListener[] = [];\n    private isAvailable: boolean = true;\n    private currentMeta: TKlProjectMeta | undefined;\n\n    private async lowLevelStore(project: TKlStorageProjectWrite): Promise<void> {\n        // get image data ids\n        const rawOld = (await KL_INDEXED_DB.get(BROWSER_STORAGE_STORE, 1)) as\n            | TKlStorageProjectWrite\n            | undefined;\n        const deleteIds: string[] = [];\n        if (rawOld) {\n            if (isTImageDataReference(rawOld.thumbnail)) {\n                deleteIds.push(rawOld.thumbnail.id);\n            }\n            for (const layer of rawOld.layers) {\n                if (isTImageDataReference(layer.blob)) {\n                    deleteIds.push(layer.blob.id);\n                }\n            }\n        }\n\n        // prepare for storing\n        const imageDataList: { id: string; data: Blob }[] = [];\n        const thumbnail = {\n            id: randomUuid(),\n        };\n        imageDataList.push({\n            id: thumbnail.id,\n            data: project.thumbnail!,\n        });\n        const layers: TIdb['V2']['ProjectStore']['Write']['layers'] = [];\n        for (const layer of project.layers) {\n            const blob = {\n                id: randomUuid(),\n            };\n            imageDataList.push({\n                id: blob.id,\n                data: layer.blob,\n            });\n            layers.push({\n                ...layer,\n                blob,\n            });\n        }\n        const raw: TIdb['V2']['ProjectStore']['Write'] = {\n            ...project,\n            thumbnail,\n            layers,\n        };\n\n        // store first. so nothing will be lost if something goes wrong\n        for (const imageData of imageDataList) {\n            await KL_INDEXED_DB.set(IMAGE_DATA_STORE, imageData.id, imageData.data);\n        }\n\n        await KL_INDEXED_DB.set(BROWSER_STORAGE_STORE, undefined, raw);\n\n        // remove obsolete imageData\n        for (const id of deleteIds) {\n            await KL_INDEXED_DB.remove(IMAGE_DATA_STORE, id);\n        }\n    }\n\n    private async lowLevelReadMeta(): Promise<TRawMeta | undefined> {\n        const raw = (await KL_INDEXED_DB.get(\n            BROWSER_STORAGE_STORE,\n            1,\n        )) as TIdb['V2']['ProjectStore']['Read'];\n        if (!raw) {\n            return undefined;\n        }\n\n        let thumbnail: Blob | undefined;\n        if (isTImageDataReference(raw.thumbnail)) {\n            const thumbnailReadResult = (await KL_INDEXED_DB.get(\n                IMAGE_DATA_STORE,\n                raw.thumbnail.id,\n            )) as TIdb['V2']['ImageDataStore']['Read'] | undefined;\n            if (isBlob(thumbnailReadResult)) {\n                thumbnail = thumbnailReadResult;\n            }\n        } else {\n            thumbnail = raw.thumbnail;\n        }\n        thumbnail = thumbnail ?? (await createFallbackThumbnail());\n\n        return {\n            projectId: raw.projectId ?? randomUuid(),\n            timestamp: raw.timestamp,\n            thumbnail,\n        };\n    }\n\n    private async lowLevelRead(): Promise<TKlStorageProjectRead | undefined> {\n        const raw = (await KL_INDEXED_DB.get(\n            BROWSER_STORAGE_STORE,\n            1,\n        )) as TIdb['V2']['ProjectStore']['Read'];\n        if (!raw) {\n            return undefined;\n        }\n\n        let thumbnail: Blob | undefined;\n        if (isTImageDataReference(raw.thumbnail)) {\n            const thumbnailReadResult = (await KL_INDEXED_DB.get(\n                IMAGE_DATA_STORE,\n                raw.thumbnail.id,\n            )) as TIdb['V2']['ImageDataStore']['Read'] | undefined;\n            if (isBlob(thumbnailReadResult)) {\n                thumbnail = thumbnailReadResult;\n            }\n        } else {\n            thumbnail = raw.thumbnail;\n        }\n        thumbnail = thumbnail ?? (await createFallbackThumbnail());\n\n        const layers: TKlStorageProjectRead['layers'] = [];\n        for (const layer of raw.layers) {\n            let blob: Blob | undefined;\n            if (isTImageDataReference(layer.blob)) {\n                const readResult = (await KL_INDEXED_DB.get(IMAGE_DATA_STORE, layer.blob.id)) as\n                    | TIdb['V2']['ImageDataStore']['Read']\n                    | undefined;\n                if (isBlob(readResult)) {\n                    blob = readResult;\n                }\n            } else {\n                blob = layer.blob;\n            }\n            layers.push({\n                ...layer,\n                isVisible: layer.isVisible ?? true,\n                mixModeStr: layer.mixModeStr ?? 'source-over',\n                blob,\n            });\n        }\n        return {\n            ...raw,\n            projectId: raw.projectId ?? randomUuid(),\n            thumbnail,\n            layers,\n        };\n    }\n\n    private async lowLevelClear(): Promise<void> {\n        // get image data ids\n        const rawOld = (await KL_INDEXED_DB.get(BROWSER_STORAGE_STORE, 1)) as\n            | TIdb['V2']['ProjectStore']['Read']\n            | undefined;\n        const deleteIds: string[] = [];\n        if (rawOld) {\n            if (isTImageDataReference(rawOld.thumbnail)) {\n                deleteIds.push(rawOld.thumbnail.id);\n            }\n            for (const layer of rawOld.layers) {\n                if (isTImageDataReference(layer.blob)) {\n                    deleteIds.push(layer.blob.id);\n                }\n            }\n        }\n\n        await KL_INDEXED_DB.remove(BROWSER_STORAGE_STORE, 1);\n        for (const id of deleteIds) {\n            await KL_INDEXED_DB.remove(IMAGE_DATA_STORE, id);\n        }\n    }\n\n    private emit(meta?: TKlProjectMeta): void {\n        this.currentMeta = meta ? { ...meta } : undefined;\n        this.listeners.forEach((item) => {\n            item.onUpdate(meta);\n        });\n    }\n\n    private updateTimestamp(): void {\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor() {\n        if (!KL_INDEXED_DB.getIsAvailable()) {\n            this.isAvailable = false;\n            return;\n        }\n\n        window.addEventListener('storage', async (e) => {\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\n                return;\n            }\n            await this.update();\n        });\n    }\n\n    async update(): Promise<void> {\n        try {\n            this.emit(await this.readMeta());\n        } catch (e) {\n            if (e instanceof Error && e.message.indexOf('db-error') === 0) {\n                this.isAvailable = false;\n            }\n        }\n    }\n\n    async read(): Promise<TDeserializedKlStorageProject | undefined> {\n        let storageProject: TKlStorageProjectRead | undefined;\n        try {\n            storageProject = await this.lowLevelRead();\n        } catch (e) {\n            this.isAvailable = false;\n            throw new Error('db-error: ' + e);\n        }\n        if (!storageProject) {\n            return undefined;\n        }\n        let result;\n        try {\n            result = await ProjectConverter.readStorageProject(storageProject);\n        } catch (e) {\n            throw new Error('format-error: ' + e);\n        }\n        return result;\n    }\n\n    async readMeta(): Promise<TKlProjectMeta | undefined> {\n        let blobMeta: TRawMeta | undefined;\n        try {\n            blobMeta = await this.lowLevelReadMeta();\n        } catch (e) {\n            this.isAvailable = false;\n            throw new Error('db-error: ' + e);\n        }\n        if (!blobMeta) {\n            return undefined;\n        }\n        let result;\n        try {\n            result = await ProjectConverter.readStorageMeta(blobMeta);\n        } catch (e) {\n            throw new Error('format-error: ' + e);\n        }\n        return result;\n    }\n\n    async store(project: TKlProject): Promise<void> {\n        try {\n            const storageProject = await ProjectConverter.createStorageProject(project);\n            await this.lowLevelStore(storageProject);\n        } catch (e) {\n            this.isAvailable = false;\n            throw new Error('db-error: ' + e);\n        }\n        this.updateTimestamp();\n        setTimeout(async () => {\n            const meta = await this.readMeta();\n            this.emit(meta);\n        });\n    }\n\n    async clear(): Promise<void> {\n        await this.lowLevelClear();\n        this.updateTimestamp();\n        setTimeout(() => this.emit(), 0);\n    }\n\n    subscribe(listener: TProjectStoreListener): void {\n        if (this.listeners.includes(listener)) {\n            return;\n        }\n        this.listeners.push(listener);\n    }\n\n    unsubscribe(listener: TProjectStoreListener): void {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (listener === this.listeners[i]) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    getIsAvailable(): boolean {\n        this.isAvailable = this.isAvailable && KL_INDEXED_DB.getIsAvailable();\n        return this.isAvailable;\n    }\n\n    getCurrentMeta(): TKlProjectMeta | undefined {\n        return this.currentMeta;\n    }\n}\n","import { TKlProject, TKlProjectMeta, TMixMode, TRawMeta } from '../kl-types';\nimport { BB } from '../../bb/bb';\nimport { drawProject } from '../canvas/draw-project';\nimport { canvasToBlob } from '../../bb/base/canvas';\n\nexport type TReadStorageProjectResult = {\n    project: TKlProject;\n    timestamp: number;\n    thumbnail: HTMLImageElement | HTMLCanvasElement;\n};\n\n/**\n * project after being read from \"browser storage\" via \"low level\" methods\n */\nexport type TKlStorageProjectRead = {\n    id: 1;\n    projectId: string;\n    timestamp: number;\n    thumbnail: Blob; // png\n    width: number; // int\n    height: number; // int\n    layers: {\n        name: string;\n        isVisible: boolean;\n        opacity: number; // 0 - 1\n        mixModeStr: TMixMode;\n        blob?: Blob; // png\n    }[];\n};\n/**\n * project about to be stored into \"browser storage\" via \"low level\" methods\n */\nexport type TKlStorageProjectWrite = {\n    id: 1;\n    projectId: string;\n    timestamp: number;\n    thumbnail: Blob; // png\n    width: number; // int\n    height: number; // int\n    layers: {\n        name: string;\n        isVisible: boolean;\n        opacity: number; // 0 - 1\n        mixModeStr: TMixMode;\n        blob: Blob; // png\n    }[];\n};\n\nexport const PROJECT_STORE_THUMBNAIL_SIZE_PX = 240;\n\nexport function loadImage(blob: Blob): Promise<HTMLImageElement> {\n    return new Promise<HTMLImageElement>((resolve, reject) => {\n        const im = new Image();\n        try {\n            im.src = BB.imageBlobToUrl(blob);\n        } catch (e) {\n            reject('imageBlobToUrl, ' + (e instanceof Error ? e.message : ''));\n            return;\n        }\n        im.onload = (): void => {\n            URL.revokeObjectURL(im.src);\n            resolve(im);\n        };\n        im.onabort = (): void => {\n            URL.revokeObjectURL(im.src);\n            reject('layer image failed loading (abort)');\n        };\n        // This does occur. Maybe decoder runs of memory or storage corruption.\n        im.onerror = (): void => {\n            URL.revokeObjectURL(im.src);\n            reject('layer image failed loading (error)');\n        };\n    });\n}\n\n/**\n * for:\n * - preparing project to be stored in ProjectStore\n * - reading a project that came out of the ProjectStore\n */\nexport class ProjectConverter {\n    private static createThumbnail(project: TKlProject): HTMLCanvasElement {\n        const size = BB.fitInto(\n            project.width,\n            project.height,\n            PROJECT_STORE_THUMBNAIL_SIZE_PX,\n            PROJECT_STORE_THUMBNAIL_SIZE_PX,\n        );\n        const factor = size.width / project.width;\n        return drawProject(project, factor);\n    }\n\n    static async createStorageProject(project: TKlProject): Promise<TKlStorageProjectWrite> {\n        const layers: TKlStorageProjectWrite['layers'] = [];\n        for (const item of project.layers) {\n            let blob;\n            if (item.image instanceof HTMLCanvasElement) {\n                blob = await canvasToBlob(item.image as HTMLCanvasElement, 'image/png');\n            } else {\n                // todo image\n                throw new Error('Not implemented');\n            }\n            layers.push({\n                name: item.name,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr ?? 'source-over',\n                blob,\n            });\n        }\n\n        return {\n            id: 1,\n            projectId: project.projectId,\n            timestamp: new Date().getTime(),\n            thumbnail: await canvasToBlob(ProjectConverter.createThumbnail(project), 'image/png'),\n            width: project.width,\n            height: project.height,\n            layers,\n        };\n    }\n\n    static async readStorageProject(\n        storageProject: TKlStorageProjectRead,\n    ): Promise<TReadStorageProjectResult> {\n        if (\n            !storageProject.width ||\n            !storageProject.height ||\n            isNaN(storageProject.width) ||\n            isNaN(storageProject.height) ||\n            storageProject.width < 1 ||\n            storageProject.height < 1\n        ) {\n            throw new Error(\n                'readStorageProject invalid canvas size: ' +\n                    storageProject.width +\n                    ', ' +\n                    storageProject.height,\n            );\n        }\n        const project: TKlProject = {\n            projectId: storageProject.projectId,\n            width: storageProject.width,\n            height: storageProject.height,\n            layers: (\n                await Promise.all(\n                    storageProject.layers.map((layer) => {\n                        if (layer.blob) {\n                            return loadImage(layer.blob).catch(\n                                () => new Image(storageProject.width, storageProject.height),\n                            );\n                        }\n                        return new Image(storageProject.width, storageProject.height);\n                    }),\n                )\n            ).map((image, i) => {\n                const storageLayer = storageProject.layers[i];\n                return {\n                    name: storageLayer.name,\n                    isVisible: storageLayer.isVisible,\n                    opacity: storageLayer.opacity,\n                    mixModeStr: storageLayer.mixModeStr,\n                    image,\n                };\n            }),\n        };\n\n        return {\n            project: project,\n            timestamp: storageProject.timestamp,\n            thumbnail: await loadImage(storageProject.thumbnail).catch(\n                () => new Image(PROJECT_STORE_THUMBNAIL_SIZE_PX, PROJECT_STORE_THUMBNAIL_SIZE_PX),\n            ),\n        };\n    }\n\n    static async readStorageMeta(rawMeta: TRawMeta): Promise<TKlProjectMeta> {\n        return {\n            projectId: rawMeta.projectId,\n            timestamp: rawMeta.timestamp,\n            thumbnail: rawMeta.thumbnail\n                ? await loadImage(rawMeta.thumbnail).catch(\n                      () =>\n                          new Image(\n                              PROJECT_STORE_THUMBNAIL_SIZE_PX,\n                              PROJECT_STORE_THUMBNAIL_SIZE_PX,\n                          ),\n                  )\n                : BB.canvas(10, 10),\n        };\n    }\n}\n","import { IndexedDb } from '../../bb/base/indexed-db';\n\nlet dbName = 'Klecks';\nexport function setKlIndexedDbName(name: string): void {\n    dbName = name;\n}\nexport function getKlIndexedDbName(): string {\n    return dbName;\n}\n\nexport const RECOVERY_STORE = 'RecoveryStore'; // key is string\nexport const IMAGE_DATA_STORE = 'ImageDataStore'; // key is string\nexport const BROWSER_STORAGE_STORE = 'ProjectStore'; // key is number\nexport const KL_INDEXED_DB_STORES = [RECOVERY_STORE, IMAGE_DATA_STORE, BROWSER_STORAGE_STORE];\nexport const KL_INDEXED_DB_VERSION = 2;\nexport const KL_INDEXED_DB_UPGRADER = (event: IDBVersionChangeEvent) => {\n    const oldVersion = event.oldVersion;\n    const db = (event.target as IDBOpenDBRequest).result;\n    if (oldVersion < 1) {\n        const store = db.createObjectStore(BROWSER_STORAGE_STORE, {\n            keyPath: 'id',\n        });\n        store.createIndex('id', 'id', { unique: true });\n    }\n    if (oldVersion < 2) {\n        db.createObjectStore(IMAGE_DATA_STORE);\n        db.createObjectStore(RECOVERY_STORE);\n    }\n};\n\nexport const KL_INDEXED_DB = new IndexedDb({});\n","import { timeoutWrapper } from './base';\n\nexport type TIndexedDbUpgrader = (event: IDBVersionChangeEvent) => void;\n\n// 2025-05-20\n// Blobs not supported on iPad in private tabs.\n// Blobs are required for indexed db to be useful. Data urls would be wasteful.\nconst areBlobUrlsSupported = async function (): Promise<boolean> {\n    let result = true;\n    const dbName = 'kl-blob-url-test';\n    try {\n        const blob = new Blob(['test'], { type: 'text/plain' });\n        const db = await timeoutWrapper(\n            new Promise<IDBDatabase>((resolve, reject) => {\n                const request = indexedDB.open(dbName, 1);\n                request.onerror = () => reject(request.error);\n                request.onsuccess = () => resolve(request.result);\n                request.onupgradeneeded = (event) => {\n                    const db = (event.target as IDBOpenDBRequest).result;\n                    db.createObjectStore('testStore');\n                };\n            }),\n            'areBlobUrlsSupported.createDb',\n        );\n\n        await timeoutWrapper(\n            new Promise<void>((resolve, reject) => {\n                const transaction = db.transaction('testStore', 'readwrite');\n                const store = transaction.objectStore('testStore');\n                const request = store.put(blob, 'testStore');\n                transaction.onabort = () => resolve();\n                request.onsuccess = () => resolve();\n                request.onerror = () => reject(request.error);\n            }),\n            'areBlobUrlsSupported.storeBlob',\n        );\n\n        db.close();\n    } catch (e) {\n        result = false;\n    }\n    try {\n        indexedDB.deleteDatabase(dbName);\n    } catch (e) {\n        // IDBFactory.deleteDatabase() called in an invalid security context\n    }\n\n    return result;\n};\n\n// todo would it make sense that a single failure causes a complete failure?\ntype TGetResultItem = {\n    status: 'success' | 'error';\n};\n\nexport type TIndexedDbParams = object;\n\nexport class IndexedDb {\n    private dbVersion: number = -1;\n    private dbName: string = '';\n    private storeNames: string[] = [];\n    private db: IDBDatabase | undefined;\n    private upgrader: TIndexedDbUpgrader = () => {};\n    private isAvailable: boolean = true;\n    private disconnectTimeout: ReturnType<typeof setTimeout> | undefined;\n    private openTransactionCount: number = 0;\n\n    private disconnect(): void {\n        this.db?.close();\n        this.db = undefined;\n    }\n\n    private async autoDisconnectWrapper<G>(activity: () => Promise<G>): Promise<G> {\n        try {\n            this.openTransactionCount++;\n            clearTimeout(this.disconnectTimeout);\n            return await activity();\n        } finally {\n            this.openTransactionCount--;\n            if (this.openTransactionCount === 0) {\n                // When a new version of the app upgrades the DB, old tabs holding open connections would\n                // block the upgrade.\n                // -> Close DB connections when inactive.\n                clearTimeout(this.disconnectTimeout);\n                this.disconnectTimeout = setTimeout(() => this.disconnect(), 1000);\n            }\n        }\n    }\n\n    private async openDb(): Promise<void> {\n        if (this.db) {\n            return;\n        }\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open(this.dbName, this.dbVersion);\n\n            request.onupgradeneeded = (event) => {\n                this.upgrader(event);\n            };\n\n            request.onsuccess = (event) => {\n                this.db = (event.target as IDBOpenDBRequest).result;\n                this.db.onversionchange = () => {\n                    this.isAvailable = false;\n                    this.disconnect();\n                    throw new Error('idb onversionchange');\n                };\n                resolve();\n            };\n\n            request.onerror = (event) => {\n                this.isAvailable = false;\n                reject((event.target as IDBOpenDBRequest).error);\n            };\n        });\n    }\n\n    private getTransaction(\n        storeName: string,\n        mode: IDBTransactionMode,\n    ): { transaction: IDBTransaction; objectStore: IDBObjectStore } {\n        if (!this.storeNames.includes(storeName)) {\n            throw new Error(`indexedDb store \"${storeName}\" not found in \"${this.dbName}\"`);\n        }\n\n        const transaction = this.db!.transaction(storeName, mode);\n        return {\n            transaction,\n            objectStore: transaction.objectStore(storeName),\n        };\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TIndexedDbParams) {}\n\n    init(\n        dbName: string,\n        objectStoreNames: string[],\n        version: number,\n        upgrader: TIndexedDbUpgrader,\n    ) {\n        if (this.dbName !== '') {\n            throw new Error('IndexedDb already initialized');\n        }\n\n        this.dbName = dbName;\n        this.storeNames = [...objectStoreNames];\n        this.dbVersion = version;\n        this.upgrader = upgrader;\n    }\n\n    async testConnection(): Promise<boolean> {\n        this.isAvailable = this.isAvailable && (await areBlobUrlsSupported());\n        if (!this.isAvailable) {\n            return this.isAvailable;\n        }\n        try {\n            for (const name of this.storeNames) {\n                await timeoutWrapper(this.openDb(), 'indexed-db.testConnection.openDb');\n                const { transaction } = this.getTransaction(name, 'readonly');\n                transaction.abort();\n            }\n        } catch (e) {\n            this.isAvailable = false;\n        }\n        return this.isAvailable;\n    }\n\n    async set(store: string, key: IDBValidKey | undefined, value: unknown): Promise<void> {\n        return this.autoDisconnectWrapper(async () => {\n            await this.openDb();\n            return await new Promise((resolve, reject) => {\n                const { transaction, objectStore } = this.getTransaction(store, 'readwrite');\n                transaction.onabort = () => reject(transaction.error);\n                const request = objectStore.put(value, key);\n                request.onsuccess = () => {\n                    resolve();\n                };\n                request.onerror = () => reject(request.error);\n            });\n        });\n    }\n\n    async get(store: string, key: IDBValidKey): Promise<unknown> {\n        return this.autoDisconnectWrapper(async () => {\n            await this.openDb();\n            return await new Promise((resolve, reject) => {\n                const { transaction, objectStore } = this.getTransaction(store, 'readonly');\n                transaction.onabort = () => reject(transaction.error);\n                const request = objectStore.get(key);\n                request.onsuccess = () => resolve(request.result);\n                request.onerror = () => reject(request.error);\n            });\n        });\n    }\n\n    async has(store: string, key: IDBValidKey): Promise<boolean> {\n        return this.autoDisconnectWrapper(async () => {\n            await this.openDb();\n            return await new Promise((resolve, reject) => {\n                const { transaction, objectStore } = this.getTransaction(store, 'readonly');\n                transaction.onabort = () => reject(transaction.error);\n                const request = objectStore.getKey(key);\n                request.onsuccess = () => resolve(!!request.result);\n                request.onerror = () => reject(request.error);\n            });\n        });\n    }\n\n    async getKeys(store: string): Promise<string[]> {\n        return this.autoDisconnectWrapper(async () => {\n            await this.openDb();\n            return await new Promise((resolve, reject) => {\n                const { transaction, objectStore } = this.getTransaction(store, 'readonly');\n                transaction.onabort = () => reject(transaction.error);\n                const request = objectStore.getAllKeys();\n                request.onsuccess = () => resolve(request.result.map((key) => key.toString()));\n                request.onerror = () => reject(request.error);\n            });\n        });\n    }\n\n    async remove(store: string, key: IDBValidKey): Promise<void> {\n        return this.autoDisconnectWrapper(async () => {\n            await this.openDb();\n            return await new Promise((resolve, reject) => {\n                const { transaction, objectStore } = this.getTransaction(store, 'readwrite');\n                transaction.onabort = () => reject(transaction.error);\n                const request = objectStore.delete(key);\n                request.onsuccess = () => {\n                    resolve();\n                };\n                request.onerror = () => reject(request.error);\n            });\n        });\n    }\n\n    async bulkSet(\n        store: string,\n        entries: { key: IDBValidKey | undefined; value: unknown }[],\n    ): Promise<void> {\n        return this.autoDisconnectWrapper(async () => {\n            await this.openDb();\n            return new Promise((resolve, reject) => {\n                const { transaction, objectStore } = this.getTransaction(store, 'readwrite');\n                transaction.onabort = () => reject(transaction.error);\n                transaction.onerror = () => reject(transaction.error);\n                transaction.oncomplete = () => resolve();\n\n                for (const { key, value } of entries) {\n                    const request = objectStore.put(value, key);\n                    request.onerror = () => reject(request.error);\n                }\n            });\n        });\n    }\n\n    async bulkGet(store: string, keys: IDBValidKey[]): Promise<Record<string, unknown>> {\n        return this.autoDisconnectWrapper(async () => {\n            await this.openDb();\n            return new Promise((resolve, reject) => {\n                const results: Record<string, unknown> = {};\n                const { transaction, objectStore } = this.getTransaction(store, 'readonly');\n                transaction.onabort = () => reject(transaction.error);\n                transaction.onerror = () => reject(transaction.error);\n                transaction.oncomplete = () => resolve(results);\n\n                keys.forEach((key, idx) => {\n                    const request = objectStore.get(key);\n                    request.onsuccess = () => (results['' + key] = request.result);\n                    request.onerror = () => reject(request.error);\n                });\n            });\n        });\n    }\n\n    async bulkRemove(store: string, keys: IDBValidKey[]): Promise<void> {\n        return this.autoDisconnectWrapper(async () => {\n            await this.openDb();\n            return new Promise((resolve, reject) => {\n                const { transaction, objectStore } = this.getTransaction(store, 'readwrite');\n                transaction.onabort = () => reject(transaction.error);\n                transaction.onerror = () => reject(transaction.error);\n                transaction.oncomplete = () => resolve();\n\n                for (const key of keys) {\n                    const request = objectStore.delete(key);\n                    request.onerror = () => reject(request.error);\n                }\n            });\n        });\n    }\n\n    getIsAvailable(): boolean {\n        return this.isAvailable;\n    }\n\n    destroy(): void {\n        this.disconnect();\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { KL } from '../../kl';\nimport { BrowserStorageUi } from '../components/browser-storage-ui';\nimport { TDropOption, TExportType, TKlProject } from '../../kl-types';\nimport { ProjectStore } from '../../storage/project-store';\nimport { LANG } from '../../../language/language';\nimport newImageImg from 'url:/src/app/img/ui/new-image.svg';\nimport exportImg from 'url:/src/app/img/ui/export.svg';\nimport shareImg from 'url:/src/app/img/ui/share.svg';\nimport uploadImg from 'url:/src/app/img/ui/upload.svg';\nimport importImg from 'url:/src/app/img/ui/import.svg';\nimport { Checkbox } from '../components/checkbox';\nimport { LocalStorage } from '../../../bb/base/local-storage';\nimport { KlRecoveryManager, TKlRecoveryListener } from '../../storage/kl-recovery-manager';\nimport { showRecoveryManagerPanel } from '../modals/recovery-manager-panel/show-recovery-manager-panel';\nimport * as classes from './file-ui.module.scss';\nimport { BrowserStorageHeaderUi } from '../components/browser-storage-header-ui';\nimport { css } from '../../../bb/base/base';\n\nconst LS_SHOW_SAVE_DIALOG = 'kl-save-dialog';\n\nconst createSpacer = (): HTMLElement => {\n    const el = document.createElement('div');\n    const clearer = document.createElement('div');\n    const line = BB.el({\n        className: 'grid-hr',\n    });\n    el.append(clearer, line);\n    css(clearer, {\n        clear: 'both',\n    });\n    return el;\n};\n\nconst createButtonContent = (text: string, icon: string, noInvert?: boolean): string => {\n    return `<img ${noInvert ? 'class=\"dark-no-invert\"' : ''} src='${icon}' alt='icon' height='20'/>${text}`;\n};\n\nexport type TFileUiParams = {\n    klRootEl: HTMLElement;\n    projectStore?: ProjectStore;\n    getProject: () => TKlProject;\n    exportType: TExportType;\n    onExportTypeChange: (type: TExportType) => void;\n    onFileSelect: (fileList: FileList, optionStr: TDropOption) => void;\n    onSaveImageToComputer: () => void;\n    onNewImage: () => void;\n    onShareImage: (callback: () => void) => void;\n    onUpload: () => void;\n    applyUncommitted: () => void;\n    onChangeShowSaveDialog: (b: boolean) => void;\n    klRecoveryManager?: KlRecoveryManager;\n    onOpenBrowserStorage: () => void;\n    onStoredToBrowserStorage: () => void;\n};\n\nexport class FileUi {\n    // from params\n    private exportType: TExportType;\n    private readonly applyUncommitted: () => void;\n\n    private readonly rootEl: HTMLDivElement;\n    private importInput: undefined | HTMLInputElement;\n    private browserStorageUi: undefined | BrowserStorageUi;\n    private klRecoveryManager: KlRecoveryManager | undefined;\n    private recoveryCountBubble: HTMLElement | undefined;\n    private recoveryListener: TKlRecoveryListener = (metas) => {\n        if (!this.recoveryCountBubble) {\n            return;\n        }\n        const count = metas.length;\n        if (count === 0) {\n            this.recoveryCountBubble.style.display = 'none';\n        } else {\n            this.recoveryCountBubble.textContent = '' + count;\n            this.recoveryCountBubble.style.display = 'inline-block';\n        }\n    };\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: TFileUiParams) {\n        this.exportType = p.exportType;\n        this.applyUncommitted = p.applyUncommitted;\n\n        this.rootEl = document.createElement('div');\n\n        const asyncCreation = (): void => {\n            // --- hint ---\n            const saveNote = BB.el({\n                className: 'kl-toolspace-note',\n                textContent: LANG('file-no-autosave'),\n                css: {\n                    margin: '10px 10px 0 10px',\n                },\n            });\n\n            // --- new, import, save ---\n            const newButton = BB.el({\n                tagName: 'button',\n                className: 'grid-button',\n                content: createButtonContent(LANG('file-new'), newImageImg, true),\n                custom: {\n                    tabIndex: '-1',\n                },\n                css: {\n                    cssFloat: 'left',\n                },\n                onClick: () => p.onNewImage(),\n            });\n            const importButton = BB.el({\n                tagName: 'button',\n                className: 'grid-button',\n                content: createButtonContent(LANG('file-import'), importImg, true),\n                css: {\n                    position: 'relative',\n                    cursor: 'pointer',\n                    cssFloat: 'left',\n                },\n                custom: {\n                    tabIndex: '-1',\n                },\n                onClick: () => this.importInput!.click(),\n            });\n            this.importInput = BB.el({\n                tagName: 'input',\n                css: {\n                    display: 'none',\n                },\n                onChange: () => {\n                    this.applyUncommitted();\n                    this.importInput!.files && p.onFileSelect(this.importInput!.files, 'default');\n                    this.importInput!.value = '';\n                },\n                custom: {\n                    tabIndex: '-1',\n                },\n            });\n            this.importInput.type = 'file';\n            this.importInput.multiple = true;\n            this.importInput.accept = 'image/*,.psd'; // .psd needed for chrome, although it's image/vnd.adobe.photoshop\n            const saveButton = BB.el({\n                tagName: 'button',\n                className: 'grid-button grid-button--filter',\n                content: createButtonContent(LANG('file-save'), exportImg),\n                custom: {\n                    tabIndex: '-1',\n                },\n                css: {\n                    cssFloat: 'left',\n                    flex: '1 0 0',\n                    margin: '0',\n                },\n                onClick: () => p.onSaveImageToComputer(),\n            });\n            const canShowSaveDialog = 'showSaveFilePicker' in window;\n            const showSaveDialogRaw = LocalStorage.getItem(LS_SHOW_SAVE_DIALOG);\n            const initialShowSaveDialog =\n                showSaveDialogRaw === null ? false : showSaveDialogRaw === 'true';\n            const saveDialogCheckbox = new Checkbox({\n                init: initialShowSaveDialog,\n                label: LANG('file-show-save-dialog'),\n                callback: (value) => {\n                    if (value) {\n                        LocalStorage.setItem(LS_SHOW_SAVE_DIALOG, 'true');\n                    } else {\n                        LocalStorage.removeItem(LS_SHOW_SAVE_DIALOG); // default is false\n                    }\n                    p.onChangeShowSaveDialog(value);\n                },\n                css: {\n                    maxWidth: 'fit-content',\n                },\n                name: 'show-save-dialog',\n            });\n            p.onChangeShowSaveDialog(initialShowSaveDialog);\n\n            // export filetype dropdown\n            const exportTypeSelect = new KL.Select({\n                optionArr: [\n                    ['png', 'PNG'],\n                    ['psd', 'PSD'],\n                    ['layers', LANG('layers') + ' (PNG)'],\n                ],\n                initValue: this.exportType,\n                onChange: (val) => {\n                    this.exportType = val as TExportType;\n                    p.onExportTypeChange(this.exportType);\n                    p.onSaveImageToComputer();\n                },\n                title: LANG('file-format'),\n                name: 'export-type',\n            });\n            css(exportTypeSelect.getElement(), {\n                height: '30px',\n                width: 'calc(50% - 10px)',\n                flex: '1 0 0',\n            });\n\n            // --- browser storage ---\n            let browserStorageFallbackEl: HTMLElement | undefined;\n            if (p.projectStore) {\n                this.browserStorageUi = new BrowserStorageUi({\n                    projectStore: p.projectStore,\n                    getProject: p.getProject,\n                    klRootEl: p.klRootEl,\n                    applyUncommitted: this.applyUncommitted,\n                    onOpen: p.onOpenBrowserStorage,\n                    onStored: () => p.onStoredToBrowserStorage(),\n                });\n                css(this.browserStorageUi.getElement(), {\n                    margin: '10px',\n                });\n            } else {\n                const header = new BrowserStorageHeaderUi();\n                browserStorageFallbackEl = BB.el({\n                    content: [\n                        header.getElement(),\n                        BB.el({\n                            content: ' ' + LANG('file-storage-cant-access'),\n                            css: {\n                                marginTop: '10px',\n                            },\n                        }),\n                    ],\n                    css: {\n                        margin: '10px 10px 0 10px',\n                    },\n                });\n            }\n\n            const saveRow = BB.el({\n                content: [\n                    BB.el({\n                        content: [saveButton, exportTypeSelect.getElement()],\n                        css: {\n                            display: 'flex',\n                            gap: '10px',\n                        },\n                    }),\n                    ...(canShowSaveDialog ? [saveDialogCheckbox.getElement()] : []),\n                ],\n                css: {\n                    display: 'flex',\n                    flexDirection: 'column',\n                    gap: '10px',\n                    margin: '10px 10px 0 10px',\n                },\n            });\n\n            // --- recovery ---\n            this.klRecoveryManager = p.klRecoveryManager;\n            const recoveryWrapper = BB.el({});\n            this.recoveryCountBubble = BB.el({\n                className: classes.recoveryBubble,\n            });\n\n            const recoveryBrowserButton = BB.el({\n                tagName: 'button',\n                content: [LANG('tab-recovery-recover-tabs'), this.recoveryCountBubble],\n                onClick: () => showRecoveryManagerPanel(this.klRecoveryManager),\n                custom: {\n                    tabIndex: '-1',\n                },\n                css: {\n                    margin: '10px 0 0 10px',\n                    width: 'calc(100% - 20px)',\n                },\n            });\n\n            recoveryWrapper.append(recoveryBrowserButton, createSpacer());\n\n            (async () => {\n                if (!this.klRecoveryManager) {\n                    return;\n                }\n                this.klRecoveryManager.subscribe(this.recoveryListener);\n                await this.klRecoveryManager.update();\n                this.klRecoveryManager.unsubscribe(this.recoveryListener);\n            })();\n\n            // --- upload, share ---\n            const shareButton = BB.el({\n                tagName: 'button',\n                className: 'grid-button',\n                content: createButtonContent(LANG('file-share'), shareImg),\n                custom: {\n                    tabIndex: '-1',\n                },\n                css: {\n                    cssFloat: 'left',\n                },\n                onClick: () => {\n                    shareButton.disabled = true;\n                    p.onShareImage(() => {\n                        shareButton.disabled = false;\n                    });\n                },\n            });\n            const uploadImgurButton = BB.el({\n                tagName: 'button',\n                className: 'grid-button',\n                content: createButtonContent(LANG('file-upload'), uploadImg),\n                custom: {\n                    tabIndex: '-1',\n                },\n                css: {\n                    cssFloat: 'left',\n                },\n                onClick: () => {\n                    p.onUpload();\n                },\n            });\n\n            BB.append(this.rootEl, [\n                saveNote,\n                newButton,\n                importButton,\n                BB.el({ css: { clear: 'both' } }),\n                saveRow,\n                createSpacer(),\n                this.browserStorageUi?.getElement(),\n                browserStorageFallbackEl,\n                createSpacer(),\n                recoveryWrapper,\n                uploadImgurButton,\n                BB.canShareFiles() ? shareButton : undefined,\n                BB.el({ css: { clear: 'both' } }),\n            ]);\n        };\n\n        setTimeout(asyncCreation, 1);\n    }\n\n    refresh(): void {}\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible(isVisible: boolean): void {\n        if (isVisible) {\n            this.refresh();\n            this.browserStorageUi?.show();\n            if (this.klRecoveryManager) {\n                this.klRecoveryManager.subscribe(this.recoveryListener);\n                this.klRecoveryManager.update();\n            }\n        } else {\n            if (this.klRecoveryManager) {\n                this.klRecoveryManager.unsubscribe(this.recoveryListener);\n            }\n        }\n    }\n\n    triggerImport(): void {\n        this.importInput && this.importInput.click();\n    }\n}\n","module.exports = parcelRequire.resolve(\"upload.9cba70c2.svg\") + \"?\" + Date.now();","import { showModal } from '../base/showModal';\nimport { BB } from '../../../../bb/bb';\nimport { RecoveryManagerPanel } from './recovery-manager-panel';\nimport { KlRecoveryManager } from '../../../storage/kl-recovery-manager';\nimport { KL_INDEXED_DB } from '../../../storage/kl-indexed-db';\nimport { KL } from '../../../kl';\nimport { LANG } from '../../../../language/language';\n\nexport function showRecoveryManagerPanel(klRecoveryManager?: KlRecoveryManager) {\n    if (!klRecoveryManager || !KL_INDEXED_DB.getIsAvailable()) {\n        KL.popup({\n            target: document.body,\n            type: 'error',\n            message: LANG('file-storage-cant-access'),\n            buttons: ['Ok'],\n        });\n        return;\n    }\n\n    const recoveryManager = new RecoveryManagerPanel({ klRecoveryManager });\n\n    const rootEl = BB.el({ content: [recoveryManager.getElement()] });\n\n    const onModalExit = (val: string) => {\n        recoveryManager.destroy();\n    };\n    const modal = showModal({\n        target: document.body,\n        message: `<b>${LANG('tab-recovery-recover-tabs')}</b>`,\n        div: rootEl,\n        buttons: [LANG('modal-close')],\n        callback: onModalExit,\n        style: {\n            width: 'calc(100% - 50px)',\n            maxWidth: '1000px',\n            minWidth: '300px',\n            boxSizing: 'border-box',\n        },\n        clickOnEnter: 'Ok',\n    });\n}\n","import { BB } from '../../../../bb/bb';\nimport {\n    DEBUG_RETURN_ALL_RECOVERIES,\n    KlRecoveryManager,\n    RECOVERY_MEMORY_LIMIT_BYTES,\n    RECOVERY_THUMB_HEIGHT_PX,\n    TRecoveryMetaData,\n} from '../../../storage/kl-recovery-manager';\nimport { timestampToAge } from '../../utils/timestamp-to-age';\nimport { showModal } from '../base/showModal';\nimport { copyCanvas } from '../../../../bb/base/canvas';\nimport * as classes from './recovery-manager-panel.module.scss';\nimport { LANG } from '../../../../language/language';\nimport removeLayerImg from 'url:/src/app/img/ui/remove-layer.svg';\nimport { css } from '../../../../bb/base/base';\n\nexport type TRecoveryManagerPanelParams = {\n    klRecoveryManager: KlRecoveryManager;\n};\n\nexport class RecoveryManagerPanel {\n    private readonly rootEl: HTMLElement;\n    private readonly recoveryListener = (\n        metas: TRecoveryMetaData[],\n        totalMemoryUsedBytes: number,\n    ) => {\n        this.update(metas, totalMemoryUsedBytes);\n    };\n    private readonly klRecoveryManager: KlRecoveryManager;\n\n    async update(metas: TRecoveryMetaData[], totalMemoryUsedBytes: number): Promise<void> {\n        const elements: HTMLElement[] = [];\n        metas\n            .sort((a, b) => {\n                if (a.timestamp > b.timestamp) {\n                    return -1;\n                }\n                if (a.timestamp < b.timestamp) {\n                    return 1;\n                }\n                return 0;\n            })\n            .forEach((meta) => {\n                const recoverBtn = BB.el({\n                    tagName: 'a',\n                    className: 'kl-button kl-button-link',\n                    content: LANG('tab-recovery-recover'),\n                    custom: {\n                        href: '#' + meta.id,\n                        target: '_blank',\n                    },\n                });\n                const deleteBtn = BB.el({\n                    tagName: 'button',\n                    className: 'kl-button-delete',\n                    content: `<img src=\"${removeLayerImg}\" height=\"20\"/>${LANG('tab-recovery-delete')}`,\n                    onClick: () => {\n                        deleteBtn.blur();\n                        const thumbnail2 = copyCanvas(meta.thumbnail!);\n                        css(thumbnail2, {\n                            alignSelf: 'start',\n                            background: 'var(--kl-checkerboard-background)',\n                            maxWidth: '100%',\n                        });\n                        showModal({\n                            target: document.body,\n                            type: 'warning',\n                            message: BB.el({\n                                content: [LANG('tab-recovery-delete-confirmation'), thumbnail2],\n                                css: {\n                                    display: 'flex',\n                                    flexDirection: 'column',\n                                    gap: '10px',\n                                },\n                            }),\n                            buttons: [LANG('tab-recovery-delete'), 'Cancel'],\n                            deleteButtonName: LANG('tab-recovery-delete'),\n                            callback: async (result) => {\n                                if (result === 'Cancel') {\n                                    return;\n                                }\n                                await this.klRecoveryManager.remove(+meta.id);\n                            },\n                        });\n                    },\n                    noRef: true,\n                });\n\n                const preview = meta.thumbnail!;\n\n                const previewWrapper = BB.el({\n                    tagName: 'a',\n                    content: preview,\n                    className: classes.preview,\n                    title: LANG('tab-recovery-recover'),\n                    css: {\n                        minHeight: RECOVERY_THUMB_HEIGHT_PX + 'px',\n                    },\n                    custom: {\n                        href: '#' + meta.id,\n                        target: '_blank',\n                    },\n                });\n\n                const infoEl = BB.el({\n                    content: [\n                        timestampToAge(meta.timestamp),\n                        ', ' + BB.round(meta.memoryEstimateBytes / 1000000, 1) + ' MB',\n                    ],\n                    css: {\n                        textAlign: 'center',\n                    },\n                });\n\n                elements.push(\n                    BB.el({\n                        content: [previewWrapper, infoEl, recoverBtn, deleteBtn],\n                        css: {\n                            display: 'flex',\n                            flexDirection: 'column',\n                            gap: '5px',\n                            maxWidth: '100%',\n                        },\n                    }),\n                );\n            });\n\n        this.rootEl.innerHTML = '';\n        if (DEBUG_RETURN_ALL_RECOVERIES) {\n            this.rootEl.append(\n                BB.el({\n                    content: 'Debug On - SHOWING ALL TABS',\n                    css: { background: 'red' },\n                }),\n            );\n        }\n        this.rootEl.append(\n            BB.el({\n                content: LANG('tab-recovery-explanation'),\n                className: 'kl-toolspace-note',\n            }),\n            BB.el({\n                content:\n                    LANG('tab-recovery-total-quota-label') +\n                    ' ' +\n                    BB.round(totalMemoryUsedBytes / 1000000, 1) +\n                    ' MB / ' +\n                    BB.round(RECOVERY_MEMORY_LIMIT_BYTES / 1000000, 1) +\n                    ' MB',\n                css: {\n                    margin: '10px 0',\n                },\n            }),\n            BB.el({\n                content: [...elements],\n                css: {\n                    display: 'flex',\n                    flexWrap: 'wrap',\n                    gap: '20px 10px',\n                    justifyContent: 'space-evenly',\n                },\n            }),\n        );\n        if (elements.length === 0) {\n            this.rootEl.append(LANG('tab-recovery-empty'));\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TRecoveryManagerPanelParams) {\n        this.klRecoveryManager = p.klRecoveryManager;\n        this.rootEl = BB.el({ content: LANG('loading') });\n        this.klRecoveryManager.subscribe(this.recoveryListener);\n        setTimeout(async () => {\n            try {\n                await this.klRecoveryManager.update();\n            } catch (e) {\n                setTimeout(() => {\n                    throw e;\n                });\n                this.rootEl.innerHTML = 'error';\n            }\n        });\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy(): void {\n        this.klRecoveryManager.unsubscribe(this.recoveryListener);\n    }\n}\n","import { KlHistory } from '../history/kl-history';\nimport { TDeserializedKlStorageProject } from '../kl-types';\nimport {\n    changeRecoveryId,\n    clearOldRecoveries,\n    deleteRecovery,\n    getIdsFromRecoveryStore,\n    getMetadata,\n    getRecovery,\n    removeOrphans,\n    storeRecovery,\n} from './kl-recovery-storage';\nimport { createArray, sleep, timeoutWrapper } from '../../bb/base/base';\nimport { CrossTabChannel } from '../../bb/base/cross-tab-channel';\nimport { KL_INDEXED_DB } from './kl-indexed-db';\n\nexport const RECOVERY_THUMB_WIDTH_PX = 300;\nexport const RECOVERY_THUMB_HEIGHT_PX = 180;\nexport const RECOVERY_AGE_LIMIT_MS = 1000 * 60 * 60 * 24 * 7; // 1 week\nexport const RECOVERY_MEMORY_LIMIT_BYTES = 1e9;\nconst FIRST_RECOVERY_AFTER_MS = 1000 * 60 * 5;\nexport const FIRST_RECOVERY_AFTER_CHANGES = 8;\nconst SUBSEQUENT_RECOVERY_AFTER_MS = 1000 * 60;\nconst SUBSEQUENT_RECOVERY_AFTER_CHANGES = 4;\nexport const DEBUG_RETURN_ALL_RECOVERIES: boolean = false;\nexport const DEBUG_INSTANT_RECOVERY: boolean = false;\n\nexport function setHash(value?: string) {\n    if (value === undefined) {\n        history.replaceState(null, '', ' ');\n        return;\n    }\n    // avoid creating a new history state\n    history.replaceState(\n        null,\n        '',\n        window.location.origin + window.location.pathname + window.location.search + '#' + value,\n    );\n}\nfunction getHash(): string | undefined {\n    // returns without the \"#\"\n    return window.location.hash ? window.location.hash.substring(1) : undefined;\n}\n\nconst ignoredHashes = ['licenses'];\n\nfunction hashToTabId(rawHash: string | undefined): number | undefined {\n    if (rawHash === undefined || ignoredHashes.includes(rawHash)) {\n        return undefined;\n    }\n    const num = +rawHash;\n    if (isNaN(num) || num < 0 || num % 1 !== 0) {\n        return undefined;\n    }\n    return num;\n}\n\nfunction genNewId(takenIds: number[]): number {\n    const limit = 1000;\n    if (takenIds.length >= limit) {\n        throw new Error('No available IDs');\n    }\n    const idSet = new Set(takenIds);\n    const pool = createArray(limit, 0)\n        .map((_, index) => index)\n        .filter((id) => !idSet.has(id));\n    const index = Math.floor(Math.random() * pool.length);\n    if (pool[index] === undefined) {\n        throw new Error('No available IDs');\n    }\n    return pool[index];\n}\n\nexport type TKlRecoveryListener = (\n    metas: TRecoveryMetaData[],\n    totalMemoryUsedBytes: number,\n) => void;\n\nexport type TKlRecoveryManagerParams = object;\n\n/**\n * handles all recovery logic.\n * - determines the tabId\n * - stores and updates the recovery automatically\n * - updates the hash in the url\n * - does cleanup (orphans, old drawings, exceeding memory)\n */\nexport class KlRecoveryManager {\n    private klHistory: KlHistory = {} as KlHistory;\n    private isStoring: boolean = false;\n    private getThumbnail: ((factor: number) => HTMLCanvasElement) | undefined;\n    private tabId: number | undefined; // undefined if tab without hash in URL\n    private listeners: Set<TKlRecoveryListener> = new Set<TKlRecoveryListener>();\n    private readonly crossTabChannel: CrossTabChannel = new CrossTabChannel('kl-tab-communication');\n    private noRecoveryReason:\n        | 'noTabIdHash'\n        | 'alreadyOpened'\n        | 'idNotFound'\n        | 'idChangeFailed'\n        | undefined;\n\n    private announceTabId(): void {\n        this.crossTabChannel.postMessage({ type: 'new-tab' });\n    }\n\n    private initListeners(): void {\n        document.addEventListener('visibilitychange', () => {\n            if (document.hidden) {\n                return;\n            }\n            // changes may have happened since tab last visible\n\n            // might not register a tab is closed without timeout\n            setTimeout(() => {\n                this.update();\n            }, 500);\n        });\n\n        window.addEventListener('focus', () => {\n            setTimeout(() => {\n                this.update();\n            }, 500);\n        });\n\n        this.crossTabChannel.subscribe((message) => {\n            if (message.type === 'new-tab') {\n                if (document.hidden) {\n                    // we'll update when tab visible. noop.\n                    return;\n                }\n                setTimeout(() => {\n                    this.update();\n                }, 500);\n            }\n            if (message.type === 'request-ids') {\n                if (this.tabId !== undefined) {\n                    this.crossTabChannel.postMessage({ type: 'response-ids', id: this.tabId });\n                }\n            }\n        });\n\n        // I think this is not needed\n        let debounceTimeout: ReturnType<typeof setTimeout> | undefined;\n        /*KL_INDEXED_DB.addListener(async () => {\n            if (document.hidden) {\n                return;\n            }\n            console.log('indexed db change!');\n            clearTimeout(debounceTimeout);\n            debounceTimeout = setTimeout(async () => {\n                this.update();\n            }, 100);\n        });*/\n    }\n\n    private async emitUpdate(): Promise<void> {\n        if (!KL_INDEXED_DB.getIsAvailable()) {\n            return;\n        }\n\n        const ids = await getIdsFromRecoveryStore();\n        const otherTabIds = await this.getIdsFromTabs();\n        const tabIds = DEBUG_RETURN_ALL_RECOVERIES\n            ? ids\n            : ids.filter((id) => !otherTabIds.includes(id) && id !== this.tabId);\n        const drawings = await Promise.all(\n            tabIds.map((id) => {\n                return getMetadata('' + id, true);\n            }),\n        );\n\n        const totalMemoryUsedBytes = await this.getTotalMemoryUsedBytes();\n        this.listeners.forEach((listener) => {\n            listener(drawings, totalMemoryUsedBytes);\n        });\n    }\n\n    setHash(id: number | undefined): void {\n        setHash(id === undefined ? undefined : '' + id);\n        this.announceTabId();\n    }\n\n    private async getIdsFromTabs(): Promise<number[]> {\n        this.crossTabChannel.postMessage({ type: 'request-ids' });\n        const result: number[] = [];\n        const onMessage = (message: any) => {\n            if (message.type === 'response-ids') {\n                result.push(+message.id);\n            }\n        };\n        this.crossTabChannel.subscribe(onMessage);\n        await sleep(100);\n        this.crossTabChannel.unsubscribe(onMessage);\n        return result;\n    }\n\n    private async getTotalMemoryUsedBytes(): Promise<number> {\n        const ids = await getIdsFromRecoveryStore();\n        let result = 0;\n        for (const id of ids) {\n            const meta = await getMetadata('' + id);\n            result += meta.memoryEstimateBytes;\n        }\n        return result;\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TKlRecoveryManagerParams) {\n        this.initListeners();\n    }\n\n    async getRecovery(): Promise<TDeserializedKlStorageProject | undefined> {\n        // is there a tabId?\n        const initialTabId: number | undefined = hashToTabId(getHash());\n        if (initialTabId === undefined) {\n            this.noRecoveryReason = 'noTabIdHash';\n            // we get a tabId later\n            return undefined;\n        }\n\n        // is there another tab with the same tabId?\n        const openTabIds = await this.getIdsFromTabs();\n        if (openTabIds.includes(initialTabId)) {\n            this.noRecoveryReason = 'alreadyOpened';\n            // Already exists -> unset tabId. Nothing to load.\n            this.setHash(undefined);\n            return undefined;\n        }\n        // is id in storage?\n        const storedIds = await getIdsFromRecoveryStore();\n        if (!storedIds.includes(initialTabId)) {\n            this.noRecoveryReason = 'idNotFound';\n            // not found -> unset tabId and abort\n            this.setHash(undefined);\n            return undefined;\n        }\n\n        // change id of drawing and tab\n        const newId = genNewId(storedIds);\n        if (!(await changeRecoveryId(initialTabId, newId))) {\n            this.noRecoveryReason = 'idChangeFailed';\n            this.setHash(undefined);\n            return undefined;\n        }\n        this.setHash(newId); // update hash\n\n        const result = await getRecovery(newId);\n        if (result) {\n            this.tabId = newId;\n        }\n        setTimeout(() => {\n            // don't disrupt loading\n            removeOrphans();\n        });\n        return result;\n    }\n\n    setKlHistory(klHistory: KlHistory) {\n        this.klHistory = klHistory;\n        let startTime = new Date().getTime();\n        let lastStoredChangeCount = 0;\n\n        this.klHistory.addListener(async () => {\n            if (this.isStoring) {\n                return;\n            }\n            const changeCount = this.klHistory.getChangeCount();\n            if (!DEBUG_INSTANT_RECOVERY) {\n                const deltaMs = new Date().getTime() - startTime;\n                // initial store after 5 minutes\n                if (\n                    this.tabId === undefined &&\n                    (deltaMs < FIRST_RECOVERY_AFTER_MS ||\n                        changeCount < FIRST_RECOVERY_AFTER_CHANGES)\n                ) {\n                    return;\n                }\n                // subsequent store after 1 minutes\n                if (\n                    this.tabId !== undefined &&\n                    (deltaMs < SUBSEQUENT_RECOVERY_AFTER_MS ||\n                        changeCount - lastStoredChangeCount < SUBSEQUENT_RECOVERY_AFTER_CHANGES)\n                ) {\n                    return;\n                }\n            }\n\n            let isFreshDrawing = false;\n            if (!this.tabId) {\n                const storedIds = await timeoutWrapper(\n                    getIdsFromRecoveryStore(),\n                    'setKlHistory.getIdsFromStore',\n                );\n                this.tabId = genNewId(storedIds);\n                isFreshDrawing = true;\n            }\n            this.isStoring = true;\n            try {\n                await storeRecovery(this.tabId, this.klHistory.getComposed(), this.getThumbnail!);\n                startTime = new Date().getTime();\n            } catch (e) {\n                setTimeout(() => {\n                    throw e;\n                });\n            }\n            if (isFreshDrawing) {\n                this.setHash(this.tabId);\n                await clearOldRecoveries();\n            }\n            startTime = new Date().getTime();\n            lastStoredChangeCount = changeCount;\n            this.isStoring = false;\n        });\n    }\n\n    setGetThumbnail(getThumbnail: (factor: number) => HTMLCanvasElement) {\n        this.getThumbnail = getThumbnail;\n    }\n\n    /**\n     * Listener will be informed about recoveries in closed tabs.\n     * totalMemoryUsesBytes includes recoveries in open tabs\n     */\n    subscribe(listener: TKlRecoveryListener): void {\n        this.listeners.add(listener);\n    }\n\n    unsubscribe(listener: TKlRecoveryListener): void {\n        this.listeners.delete(listener);\n    }\n\n    // re-checks what recoveries exist\n    async update(): Promise<void> {\n        if (this.listeners.size > 0) {\n            await this.emitUpdate();\n        }\n    }\n\n    async remove(recoveryId: number): Promise<void> {\n        await deleteRecovery('' + recoveryId);\n        this.update();\n    }\n\n    getTabId(): number | undefined {\n        return this.tabId;\n    }\n\n    getNoRecoveryReason(): KlRecoveryManager['noRecoveryReason'] {\n        return this.noRecoveryReason;\n    }\n\n    destroy(): void {\n        // todo\n    }\n}\n\nexport type TRecoveryMetaData = {\n    id: string;\n    width: number;\n    height: number;\n    timestamp: number;\n    thumbnail?: HTMLImageElement | HTMLCanvasElement;\n    memoryEstimateBytes: number;\n};\n","import {\n    BROWSER_STORAGE_STORE,\n    IMAGE_DATA_STORE,\n    KL_INDEXED_DB,\n    RECOVERY_STORE,\n} from './kl-indexed-db';\nimport { loadImage } from './project-converter';\nimport { isLayerFill, TDeserializedKlStorageProject, TKlProjectLayer } from '../kl-types';\nimport { BB } from '../../bb/bb';\nimport { HISTORY_TILE_SIZE } from '../history/kl-history';\nimport { THistoryEntryDataComposed, THistoryEntryLayerTile } from '../history/history.types';\nimport { sortLayerMap } from '../history/sort-layer-map';\nimport { fitInto, isBlob, randomUuid, timeoutWrapper } from '../../bb/base/base';\nimport {\n    RECOVERY_AGE_LIMIT_MS,\n    RECOVERY_MEMORY_LIMIT_BYTES,\n    RECOVERY_THUMB_HEIGHT_PX,\n    RECOVERY_THUMB_WIDTH_PX,\n    TRecoveryMetaData,\n} from './kl-recovery-manager';\nimport { TIdb } from './kl-indexed-db.types';\nimport { isTImageDataReference } from './project-store';\n\nexport async function getIdsFromRecoveryStore(): Promise<number[]> {\n    const keys = await KL_INDEXED_DB.getKeys(RECOVERY_STORE);\n    return keys.map((item) => +item);\n}\n\nexport async function getImageDataIdsFromStorage(): Promise<string[]> {\n    return await KL_INDEXED_DB.getKeys(IMAGE_DATA_STORE);\n}\n\nexport async function clearOldRecoveries(): Promise<void> {\n    const ids = await KL_INDEXED_DB.getKeys(RECOVERY_STORE);\n    const recoveries = (await Promise.all(\n        ids.map((id) => {\n            return KL_INDEXED_DB.get(RECOVERY_STORE, id);\n        }),\n    )) as TIdb['V2']['RecoveryStore']['Read'][];\n    await Promise.all(\n        recoveries.map((recovery, index) => {\n            if (recovery.timestamp < new Date().getTime() - RECOVERY_AGE_LIMIT_MS) {\n                return deleteRecovery(ids[index]);\n            }\n            return Promise.resolve();\n        }),\n    );\n}\n\nasync function loadFromImageDataStore(\n    id: string,\n    commonCtx: CanvasRenderingContext2D,\n): Promise<ImageData> {\n    const result = (await KL_INDEXED_DB.get(IMAGE_DATA_STORE, id)) as\n        | TIdb['V2']['ImageDataStore']['Read']\n        | undefined;\n    if (!result) {\n        commonCtx.clearRect(0, 0, HISTORY_TILE_SIZE, HISTORY_TILE_SIZE);\n        return commonCtx.getImageData(0, 0, HISTORY_TILE_SIZE, HISTORY_TILE_SIZE);\n    }\n    if (isBlob(result)) {\n        let image: HTMLImageElement | undefined;\n        try {\n            image = await loadImage(result);\n        } catch (e) {\n            // someday maybe pass error with result, to show user something went wrong\n        }\n        commonCtx.canvas.width = image?.width ?? commonCtx.canvas.width;\n        commonCtx.canvas.height = image?.height ?? commonCtx.canvas.height;\n        // no clear needed, because size was set\n        image && commonCtx.drawImage(image, 0, 0);\n        return commonCtx.getImageData(0, 0, commonCtx.canvas.width, commonCtx.canvas.height);\n    }\n    return result;\n}\n\nasync function getRawRecoveryProject(\n    id: number,\n): Promise<TIdb['V2']['RecoveryStore']['Read'] | undefined> {\n    return (await KL_INDEXED_DB.get(RECOVERY_STORE, '' + id)) as\n        | TIdb['V2']['RecoveryStore']['Read']\n        | undefined;\n}\n\n/**\n * Removes orphaned tiles. Doesn't delete those still referenced.\n */\nexport async function removeOrphans(candidateIds?: string[]): Promise<void> {\n    const imageDataIds = candidateIds ?? (await getImageDataIdsFromStorage());\n    const usedIds = new Set<string>();\n    const recoveryIds = await getIdsFromRecoveryStore();\n    for (const id of recoveryIds) {\n        const raw = (await KL_INDEXED_DB.get(RECOVERY_STORE, '' + id)) as\n            | TIdb['V2']['RecoveryStore']['Read']\n            | undefined;\n        if (!raw) {\n            continue;\n        }\n        for (const layer of raw.layers) {\n            for (const tile of layer.image) {\n                if (!isLayerFill(tile)) {\n                    usedIds.add(tile.id);\n                }\n            }\n        }\n        usedIds.add(raw.thumbnail);\n    }\n\n    // also have to check browser storage store\n    const browserStorageRaw = (await KL_INDEXED_DB.get(\n        BROWSER_STORAGE_STORE,\n        1,\n    )) as TIdb['V2']['ProjectStore']['Read'];\n    if (browserStorageRaw) {\n        if (isTImageDataReference(browserStorageRaw.thumbnail)) {\n            usedIds.add(browserStorageRaw.thumbnail.id);\n        }\n        for (const layer of browserStorageRaw.layers) {\n            if (isTImageDataReference(layer.blob)) {\n                usedIds.add(layer.blob.id);\n            }\n        }\n    }\n\n    // remove entries\n    await KL_INDEXED_DB.bulkRemove(\n        IMAGE_DATA_STORE,\n        imageDataIds.filter((id) => !usedIds.has(id)),\n    );\n}\n\nexport async function getRecovery(\n    tabId: number,\n): Promise<TDeserializedKlStorageProject | undefined> {\n    const raw = (await KL_INDEXED_DB.get(RECOVERY_STORE, '' + tabId)) as\n        | TIdb['V2']['RecoveryStore']['Read']\n        | undefined;\n    if (raw === undefined) {\n        return undefined;\n    }\n\n    // shared canvas to load tiles\n    const canvas = BB.canvas(HISTORY_TILE_SIZE, HISTORY_TILE_SIZE);\n    const ctx = BB.ctx(canvas);\n\n    // speed up by loading in parallel\n    const layers: TKlProjectLayer[] = [];\n    await Promise.all<void>(\n        raw.layers.map(async (layerSerialized, index) => {\n            const tiles: THistoryEntryLayerTile[] = [];\n            for (let index = 0; index < layerSerialized.image.length; index++) {\n                const tile = layerSerialized.image[index];\n                if (isLayerFill(tile)) {\n                    tiles.push(tile);\n                } else {\n                    tiles.push({\n                        id: tile.id,\n                        data: await loadFromImageDataStore(tile.id, ctx),\n                    });\n                }\n            }\n            layers[index] = {\n                ...layerSerialized,\n                image: tiles,\n            };\n        }),\n    );\n\n    return {\n        project: {\n            projectId: (raw.projectId as string | undefined) ?? randomUuid(), // was not always defined during beta\n            width: raw.width,\n            height: raw.height,\n            layers,\n        },\n        timestamp: 0,\n        thumbnail: await getThumbnail(raw.thumbnail),\n    };\n}\n\nasync function getThumbnail(id: string): Promise<HTMLImageElement | HTMLCanvasElement> {\n    const canvas = BB.canvas(HISTORY_TILE_SIZE, HISTORY_TILE_SIZE);\n    const ctx = BB.ctx(canvas);\n    const imageData = await loadFromImageDataStore(id, ctx);\n    canvas.width = imageData.width;\n    canvas.height = imageData.height;\n    ctx.putImageData(imageData, 0, 0);\n    return canvas;\n}\n\n// returns false if recovery doesn't exist\nexport async function changeRecoveryId(oldId: number, newId: number): Promise<boolean> {\n    const storedProjectSerialized = await getRawRecoveryProject(oldId);\n    if (!storedProjectSerialized) {\n        // nothing to do\n        return false;\n    }\n    storedProjectSerialized.timestamp = new Date().getTime();\n    await KL_INDEXED_DB.set(RECOVERY_STORE, '' + newId, storedProjectSerialized);\n    await KL_INDEXED_DB.remove(RECOVERY_STORE, '' + oldId);\n    return true;\n}\n\nexport async function storeRecovery(\n    tabId: number,\n    composed: THistoryEntryDataComposed,\n    getThumbnail: (factor: number) => HTMLCanvasElement,\n): Promise<void> {\n    let orphanCandidates: string[] | undefined;\n\n    try {\n        // get thumbnail early to be accurate\n        const fit = fitInto(\n            composed.size.width,\n            composed.size.height,\n            RECOVERY_THUMB_WIDTH_PX,\n            RECOVERY_THUMB_HEIGHT_PX,\n        );\n        const thumbCanvas = getThumbnail(fit.width / composed.size.width);\n\n        const sortedComposedLayers = Object.values(composed.layerMap).sort(sortLayerMap);\n\n        // make a list of existing imageData ids in A (stored project)\n        const storedProjectSerialized = await timeoutWrapper(\n            getRawRecoveryProject(tabId),\n            'storeRecovery.getRawRecoveryProject',\n        );\n        const storedImageDataIds = new Set(\n            storedProjectSerialized?.layers.flatMap((layer) => {\n                return layer.image\n                    .map((tile) => (!isLayerFill(tile) ? tile.id : undefined))\n                    .filter((id) => id !== undefined);\n            }),\n        );\n        storedProjectSerialized && storedImageDataIds.add(storedProjectSerialized.thumbnail);\n\n        // to help calculate updated memoryEstimateBytes\n        const storedImageDataSizes: Record<string, number> = {};\n        storedProjectSerialized &&\n            storedProjectSerialized.layers.forEach((layer) => {\n                layer.image.forEach((tile) => {\n                    if (!isLayerFill(tile)) {\n                        storedImageDataSizes[tile.id] = tile.sizeBytes || 0;\n                    }\n                });\n            });\n\n        // make a list of imageData ids in B (to be stored)\n        const idsFromProject = new Set(\n            sortedComposedLayers.flatMap((layer) => {\n                return layer.tiles.flatMap((tile) => {\n                    return isLayerFill(tile) ? [] : [tile.id];\n                });\n            }),\n        );\n\n        // the to delete list: not in B (aka no longer stored)\n        orphanCandidates = [...storedImageDataIds].filter((id) => {\n            return !idsFromProject.has(id);\n        });\n\n        const layers: TIdb['V2']['RecoveryStore']['Write']['layers'] = [];\n        const imageDataList: { id: string; data: TIdb['V2']['ImageDataStore']['Write'] }[] = [];\n\n        // estimate memory\n        let memoryEstimateBytes = 0;\n\n        for (const composedLayer of sortedComposedLayers) {\n            layers.push({\n                name: composedLayer.name,\n                isVisible: composedLayer.isVisible,\n                opacity: composedLayer.opacity,\n                mixModeStr: composedLayer.mixModeStr,\n                image: await (async () => {\n                    const result: TIdb['V2']['RecoveryStore']['Write']['layers'][number]['image'] =\n                        [];\n                    for (const tile of composedLayer.tiles) {\n                        if (isLayerFill(tile)) {\n                            result.push(tile);\n                            memoryEstimateBytes += tile.fill.length;\n                        } else {\n                            let size = 0;\n                            if (storedImageDataIds.has(tile.id)) {\n                                size = storedImageDataSizes[tile.id];\n                            } else {\n                                imageDataList.push({\n                                    id: tile.id,\n                                    data: tile.data,\n                                });\n                                size = tile.data.width * tile.data.height * 4; // 4 channels, each 1 byte\n                            }\n                            memoryEstimateBytes += size;\n                            result.push({ id: tile.id, sizeBytes: size });\n                        }\n                    }\n                    return result;\n                })(),\n            });\n        }\n        const thumbImageData: { id: string; data: ImageData } = {\n            id: randomUuid(),\n            data: (() => {\n                const thumbCtx = BB.ctx(thumbCanvas);\n                return thumbCtx.getImageData(0, 0, thumbCanvas.width, thumbCanvas.height);\n            })(),\n        };\n        imageDataList.push(thumbImageData);\n        memoryEstimateBytes += thumbImageData.data.width * thumbImageData.data.height * 4; // 4 channels, each 1 byte\n\n        const serialized: TIdb['V2']['RecoveryStore']['Write'] = {\n            projectId: composed.projectId.value,\n            width: composed.size.width,\n            height: composed.size.height,\n            timestamp: new Date().getTime(), // - RECOVERY_AGE_LIMIT_MS,\n            thumbnail: thumbImageData.id,\n            layers,\n            memoryEstimateBytes,\n        };\n\n        // check will we be over the memory limit - if so, removed oldest drawings until we won't.\n        const totalExceptDrawingBytes = await timeoutWrapper(\n            getTotalMemoryExceptCurrentDrawing(tabId),\n            'storeRecovery.getTotalMemory',\n        );\n        if (totalExceptDrawingBytes + memoryEstimateBytes > RECOVERY_MEMORY_LIMIT_BYTES) {\n            const overLimitByBytes =\n                totalExceptDrawingBytes + memoryEstimateBytes - RECOVERY_MEMORY_LIMIT_BYTES;\n            let toBeRemovedBytes = 0;\n            const idsToRemove: string[] = [];\n            const metas = (await getAllMeta()).sort((a, b) => {\n                if (a.timestamp > b.timestamp) {\n                    return 1;\n                }\n                if (a.timestamp < b.timestamp) {\n                    return -1;\n                }\n                return 0;\n            });\n            metas.forEach((meta) => {\n                if (toBeRemovedBytes >= overLimitByBytes) {\n                    // removed enough\n                    return;\n                }\n                idsToRemove.push(meta.id);\n                toBeRemovedBytes += meta.memoryEstimateBytes;\n            });\n            // also make sure to remove the imagedata\n            for (const id of idsToRemove) {\n                await deleteRecovery(id);\n            }\n        }\n\n        // store first. so nothing will be lost if something goes wrong\n        await timeoutWrapper(\n            KL_INDEXED_DB.bulkSet(\n                IMAGE_DATA_STORE,\n                imageDataList.map((item) => {\n                    return {\n                        key: item.id,\n                        value: item.data,\n                    };\n                }),\n            ),\n            'storeRecovery.storeTile',\n            1000 * 30,\n        );\n\n        await timeoutWrapper(\n            KL_INDEXED_DB.set(RECOVERY_STORE, '' + tabId, serialized),\n            'storeRecovery.storeRecovery',\n        );\n    } finally {\n        /*\n        Orphaned tiles are possible and must be cleaned up, even if there's a timeout or other exception.\n         */\n        await timeoutWrapper(removeOrphans(orphanCandidates), 'storeRecovery.removeOrphans', 8000);\n    }\n}\n\nexport async function deleteRecovery(id: string): Promise<void> {\n    const recovery = (await KL_INDEXED_DB.get(RECOVERY_STORE, id)) as\n        | TIdb['V2']['RecoveryStore']['Read']\n        | undefined;\n    if (!recovery) {\n        return;\n    }\n    await KL_INDEXED_DB.remove(RECOVERY_STORE, id);\n\n    const orphanCandidates: string[] = [recovery.thumbnail];\n    for (const layer of recovery.layers) {\n        for (const tile of layer.image) {\n            if (!isLayerFill(tile)) {\n                orphanCandidates.push(tile.id);\n            }\n        }\n    }\n\n    // prevent deletion of tiles referenced by multiple recoveries.\n    await removeOrphans(orphanCandidates);\n}\n\nasync function getAllMeta(): Promise<TRecoveryMetaData[]> {\n    const ids = await getIdsFromRecoveryStore();\n    const result: TRecoveryMetaData[] = [];\n    for (const id of ids) {\n        result.push(await getMetadata('' + id));\n    }\n    return result;\n}\n\nasync function getTotalMemoryExceptCurrentDrawing(tabId: number): Promise<number> {\n    const ids = await getIdsFromRecoveryStore();\n    let result = 0;\n    for (const id of ids) {\n        if (id === tabId) {\n            continue;\n        }\n        const meta = await getMetadata('' + id);\n        result += meta.memoryEstimateBytes;\n    }\n    return result;\n}\n\nexport async function getMetadata(\n    drawingId: string,\n    includeThumbnail?: boolean,\n): Promise<TRecoveryMetaData> {\n    const raw = await KL_INDEXED_DB.get(RECOVERY_STORE, drawingId);\n    if (raw === undefined) {\n        throw new Error('drawing not found');\n    }\n    const parsed = raw as TIdb['V2']['RecoveryStore']['Read'];\n\n    return {\n        id: drawingId,\n        width: parsed.width,\n        height: parsed.height,\n        thumbnail: includeThumbnail ? await getThumbnail(parsed.thumbnail) : undefined,\n        timestamp: parsed.timestamp,\n        memoryEstimateBytes: parsed.memoryEstimateBytes,\n    };\n}\n","import { LocalStorage } from './local-storage';\nimport { randomUuid } from './base';\n\nexport type TCrossTabChannelListener = (message: any) => void;\ntype TLsEntry = {\n    timestamp: number;\n    originId: string; // uuid of current tab\n    message: any;\n};\n\nconst originId = randomUuid();\n\n/**\n * broadcast channel with local storage fallback\n */\nexport class CrossTabChannel {\n    private readonly broadcastChannel: BroadcastChannel | undefined;\n    private readonly broadcastChannelListeners: {\n        preListener: (message: MessageEvent) => void; // extracts message.data\n        listener: TCrossTabChannelListener;\n    }[] = [];\n\n    // for fallback\n    private lastReadTimestamp: number = new Date().getTime();\n    private readonly maxAgeMs = 1000 * 10;\n    private readonly localStoragePrefix = 'cross-tab-channel--';\n    private readonly localStorageListeners: Set<TCrossTabChannelListener> = new Set();\n\n    private readonly onLocalStorageChange = (e: StorageEvent) => {\n        if (e.key !== this.getLsKey() || e.newValue === null) {\n            // case 1: irrelevant key changed\n            // case 2: null means no new message\n            // -> noop\n            return;\n        }\n        try {\n            const entries = JSON.parse(e.newValue) as TLsEntry[];\n            entries.forEach((entry) => {\n                if (entry.originId === originId || entry.timestamp <= this.lastReadTimestamp) {\n                    // ignore messages from our own tab, or that aren't new\n                    return;\n                }\n                this.lastReadTimestamp = entry.timestamp;\n                this.localStorageListeners.forEach((listener) => listener(entry.message));\n            });\n        } catch (error) {\n            // probably invalid value -> reset\n            LocalStorage.removeItem(this.getLsKey());\n        }\n    };\n\n    private getLsKey(): string {\n        return this.localStoragePrefix + this.name;\n    }\n\n    // ----------------------------------- public ----------------------------------\n    constructor(private name: string) {\n        if (typeof BroadcastChannel !== 'undefined') {\n            this.broadcastChannel = new BroadcastChannel(name);\n        }\n    }\n\n    postMessage(message: any): void {\n        if (this.broadcastChannel) {\n            this.broadcastChannel.postMessage(message);\n        } else {\n            const now = new Date().getTime();\n            let raw: string | null = null;\n            try {\n                raw = LocalStorage.getItem(this.getLsKey());\n            } catch (error) {\n                // probably invalid value -> reset\n            }\n            let entries: TLsEntry[] = raw === null ? [] : JSON.parse(raw);\n            entries = entries.filter((entry) => {\n                // delete old entries\n                return entry.timestamp > now - this.maxAgeMs;\n            });\n            entries.push({\n                timestamp: now,\n                originId,\n                message,\n            });\n            LocalStorage.setItem(this.getLsKey(), JSON.stringify(entries));\n        }\n    }\n\n    subscribe(listener: TCrossTabChannelListener): void {\n        if (this.broadcastChannel) {\n            const preListener = (message: MessageEvent) => listener(message.data);\n            this.broadcastChannelListeners.push({\n                preListener,\n                listener,\n            });\n            this.broadcastChannel.addEventListener('message', preListener);\n        } else {\n            if (this.localStorageListeners.size === 0) {\n                window.addEventListener('storage', this.onLocalStorageChange);\n            }\n            this.localStorageListeners.add(listener);\n        }\n    }\n\n    unsubscribe(listener: TCrossTabChannelListener): void {\n        if (this.broadcastChannel) {\n            const match = this.broadcastChannelListeners.find((item) => item.listener === listener);\n            if (match) {\n                this.broadcastChannel.removeEventListener('message', match.preListener);\n            }\n        } else {\n            this.localStorageListeners.delete(listener);\n            if (this.localStorageListeners.size === 0) {\n                window.removeEventListener('storage', this.onLocalStorageChange);\n            }\n        }\n    }\n\n    close(): void {\n        if (this.broadcastChannel) {\n            this.broadcastChannel.close();\n        }\n    }\n}\n",null,null,"import { BB } from '../../../bb/bb';\nimport { KL } from '../../kl';\nimport { TKeyString } from '../../../bb/bb-types';\nimport { StatusOverlay } from '../components/status-overlay';\nimport { KlCanvas, TKlCanvasLayer } from '../../canvas/kl-canvas';\nimport { LANG } from '../../../language/language';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../../kl-types';\nimport { KlColorSlider } from '../components/kl-color-slider';\nimport { LayersUi } from './layers-ui/layers-ui';\nimport { RGB } from '../../../bb/color/color';\nimport { getSharedFx } from '../../../fx-canvas/shared-fx';\nimport { c } from '../../../bb/base/c';\nimport { KlHistory } from '../../history/kl-history';\nimport copyImg from 'url:/src/app/img/ui/copy.svg';\nimport { createImage } from '../../../bb/base/ui';\n\nexport type TEditUiParams = {\n    klRootEl: HTMLElement;\n    klColorSlider: KlColorSlider;\n    layersUi: LayersUi;\n    getCurrentColor: () => RGB;\n    maxCanvasSize: number;\n    klCanvas: KlCanvas;\n    getCurrentLayer: () => TKlCanvasLayer;\n    isEmbed: boolean;\n    statusOverlay: StatusOverlay;\n    onCanvasChanged: () => void; // dimensions/orientation changed\n    applyUncommitted: () => void;\n    klHistory: KlHistory;\n    onCopyToClipboard: () => void;\n    onPaste: () => void;\n};\n\nexport class EditUi {\n    // from params\n    private readonly klRootEl: HTMLElement;\n    private readonly klColorSlider: KlColorSlider;\n    private readonly layersUi: LayersUi;\n    private readonly getCurrentColor: () => RGB;\n    private readonly maxCanvasSize: number;\n    private readonly klCanvas: KlCanvas;\n    private readonly getCurrentLayer: () => TKlCanvasLayer;\n    private readonly isEmbed: boolean;\n    private readonly statusOverlay: StatusOverlay;\n    private readonly onCanvasChanged: () => void; // dimensions/orientation changed\n    private readonly applyUncommitted: () => void;\n    private readonly klHistory: KlHistory;\n    private readonly onCopyToClipboard: () => void;\n    private readonly onPaste: () => void;\n\n    private readonly rootEl: HTMLDivElement;\n    private isInit = false;\n\n    private testHasWebGL(): boolean {\n        return !!getSharedFx();\n    }\n\n    private init(): void {\n        const filters = KL.FILTER_LIB;\n        const buttons = [];\n\n        if (!KL.FILTER_LIB_STATUS.isLoaded) {\n            throw new Error('filters not loaded');\n        }\n\n        const hasWebGL: boolean = this.testHasWebGL();\n\n        if (!hasWebGL) {\n            const note = BB.el({\n                parent: this.rootEl,\n                className: 'kl-toolspace-note',\n                content: 'Features disabled because WebGL is failing.',\n                css: {\n                    margin: '10px',\n                    marginBottom: '0',\n                },\n            });\n            const noteButton = BB.el({\n                parent: note,\n                tagName: 'button',\n                textContent: 'Learn More',\n                css: {\n                    marginLeft: '5px',\n                },\n            });\n            noteButton.onclick = () => {\n                KL.popup({\n                    target: this.klRootEl,\n                    message: '<b>WebGL is not working</b>',\n                    div: BB.el({\n                        content: `\nSee if your browser supports WebGL and has it enabled: <a href=\"https://get.webgl.org\" target=\"_blank\" rel=\"noopener noreferrer\">get.webgl.org</a><br>\n<br>\nRecently (2023-05) a number of Chrome users on Chrome OS reported that WebGL fails, although it is enabled & supported.\nThis has been reported to Google.\n`,\n                    }),\n                    buttons: ['Ok'],\n                    clickOnEnter: 'Ok',\n                });\n            };\n        }\n\n        const createButton = (filterKey: string): HTMLElement => {\n            const filter = filters[filterKey];\n\n            const button = BB.el({\n                tagName: 'button',\n                className: 'grid-button grid-button--filter',\n                content: [\n                    createImage({\n                        alt: 'icon',\n                        src: filter.icon,\n                        width: 18,\n                        height: 20,\n                        className: filter.darkNoInvert ? 'dark-no-invert' : '',\n                        css: {\n                            marginRight: '3px',\n                        },\n                    }),\n                    LANG(filter.lang.button),\n                ],\n                css: {\n                    lineHeight: '20px',\n                    fontSize: '12px',\n                },\n                custom: {\n                    tabIndex: '-1',\n                },\n            });\n\n            const filterName = LANG(filter.lang.name);\n\n            let isEnabled = true;\n            if (filter.webGL && !hasWebGL) {\n                isEnabled = false;\n            }\n\n            if (isEnabled) {\n                button.onclick = () => {\n                    this.applyUncommitted();\n                    type TOptions = 'Ok' | 'Cancel';\n                    const dialogButtons: TOptions[] = ['Ok', 'Cancel'];\n\n                    const finishedDialog = (\n                        result: TOptions,\n                        filterDialog: TFilterGetDialogResult<any>,\n                    ): void => {\n                        if ('error' in filterDialog) {\n                            return;\n                        }\n                        if (result == 'Cancel') {\n                            if (filterDialog.destroy) {\n                                filterDialog.destroy();\n                            }\n                            return;\n                        }\n                        let input;\n                        try {\n                            input = filterDialog.getInput!(); // also destroys\n                        } catch (e) {\n                            if (\n                                (e as Error).message.indexOf('.getInput is not a function') !== -1\n                            ) {\n                                throw (\n                                    'filterDialog.getInput is not a function, filter: ' + filterName\n                                );\n                            } else {\n                                throw e;\n                            }\n                        }\n                        applyFilter(input);\n                    };\n\n                    if (!('apply' in filters[filterKey])) {\n                        KL.popup({\n                            target: this.klRootEl,\n                            message: 'Application not fully loaded',\n                            type: 'error',\n                        });\n                        return;\n                    }\n\n                    const applyFilter = (input: any) => {\n                        const filterResult = filters[filterKey].apply!({\n                            layer: this.getCurrentLayer(),\n                            klCanvas: this.klCanvas,\n                            klHistory: this.klHistory,\n                            input: input,\n                        } as TFilterApply);\n                        if (!filterResult) {\n                            KL.popup({\n                                target: this.klRootEl,\n                                message: \"Couldn't apply the edit action\",\n                                type: 'error',\n                            });\n                        }\n                        filters[filterKey].updatePos && this.onCanvasChanged();\n                        this.layersUi.update();\n                    };\n\n                    if (filters[filterKey].isInstant) {\n                        button.blur();\n                        applyFilter(null);\n                        this.statusOverlay.out(\n                            '\"' + filterName + '\" ' + LANG('filter-applied'),\n                            true,\n                        );\n                    } else {\n                        const secondaryColorRGB = this.klColorSlider.getSecondaryRGB();\n                        let filterDialog: TFilterGetDialogResult<any> | undefined = undefined;\n\n                        try {\n                            filterDialog = filters[filterKey].getDialog!({\n                                context: this.getCurrentLayer().context,\n                                klCanvas: this.klCanvas,\n                                maxWidth: this.maxCanvasSize,\n                                maxHeight: this.maxCanvasSize,\n                                currentColorRgb: {\n                                    r: this.getCurrentColor().r,\n                                    g: this.getCurrentColor().g,\n                                    b: this.getCurrentColor().b,\n                                },\n                                secondaryColorRgb: {\n                                    r: secondaryColorRGB.r,\n                                    g: secondaryColorRGB.g,\n                                    b: secondaryColorRGB.b,\n                                },\n                                composed: this.klHistory.getComposed(),\n                            } as TFilterGetDialogParam) as TFilterGetDialogResult;\n                        } catch (e) {\n                            setTimeout(() => {\n                                throw e;\n                            });\n                        }\n\n                        if (!filterDialog || 'error' in filterDialog) {\n                            KL.popup({\n                                target: this.klRootEl,\n                                message: filterDialog\n                                    ? filterDialog.error\n                                    : 'Error: Could not perform action.',\n                                type: 'error',\n                            });\n                            return;\n                        }\n\n                        let closeFunc: () => void;\n                        // Todo should move into getDialogParams\n                        filterDialog.errorCallback = (e) => {\n                            KL.popup({\n                                target: this.klRootEl,\n                                message: 'Error: Could not perform action.',\n                                type: 'error',\n                            });\n                            setTimeout(() => {\n                                throw e;\n                            }, 0);\n                            closeFunc();\n                        };\n\n                        const style: TKeyString = {};\n                        if ('width' in filterDialog) {\n                            style.width = filterDialog.width + 'px';\n                        }\n\n                        let title: HTMLElement;\n                        {\n                            const els: HTMLElement[] = [c('b', filterName)];\n                            if (filter.lang.description !== undefined) {\n                                els.push(\n                                    c(\n                                        {\n                                            className: 'kl-info-btn',\n                                            onClick: () => {\n                                                KL.popup({\n                                                    target: this.klRootEl,\n                                                    message: LANG(filter.lang.description!),\n                                                });\n                                            },\n                                            title: LANG(filter.lang.description!),\n                                            noRef: true,\n                                        },\n                                        '?',\n                                    ),\n                                );\n                            }\n                            title = c(',flex,gap-5', els);\n                        }\n\n                        KL.popup({\n                            target: this.klRootEl,\n                            message: title,\n                            div: filterDialog.element,\n                            style: style,\n                            buttons: dialogButtons,\n                            clickOnEnter: 'Ok',\n                            callback: (result) => {\n                                finishedDialog(result as TOptions, filterDialog!);\n                            },\n                            closeFunc: (func) => {\n                                closeFunc = func;\n                            },\n                        });\n                    }\n                };\n            } else {\n                button.disabled = true;\n            }\n\n            buttons.push(button);\n            return button;\n        };\n\n        const addGroup = (groupArr: string[]): void => {\n            Object.entries(filters).forEach(([filterKey, filter]) => {\n                if (!groupArr.includes(filterKey)) {\n                    return;\n                }\n                if (this.isEmbed && !filter.inEmbed) {\n                    return;\n                }\n                this.rootEl.append(createButton(filterKey));\n            });\n        };\n\n        const groupA = ['cropExtend', 'flip', 'perspective', 'resize', 'rotate', 'transform'];\n        const groupB = [\n            'brightnessContrast',\n            'curves',\n            'distort',\n            'hueSaturation',\n            'invert',\n            'tiltShift',\n            'toAlpha',\n            'blur',\n            'unsharpMask',\n        ];\n        const groupC = ['grid', 'noise', 'pattern', 'vanishPoint'];\n\n        if (!this.isEmbed) {\n            const copyBtn = BB.el({\n                tagName: 'button',\n                className: 'grid-button grid-button--filter',\n                content: [\n                    createImage({\n                        alt: 'icon',\n                        src: copyImg,\n                        width: 18,\n                        height: 20,\n                        css: {\n                            marginRight: '3px',\n                        },\n                    }),\n                    LANG('file-copy'),\n                ],\n                onClick: () => this.onCopyToClipboard(),\n                title: LANG('file-copy-title'),\n                custom: {\n                    tabIndex: '-1',\n                },\n                css: {\n                    lineHeight: '20px',\n                },\n            });\n\n            const pasteBtn = BB.el({\n                tagName: 'button',\n                className: 'grid-button grid-button--filter',\n                content: [\n                    BB.el({\n                        css: {\n                            height: '20px',\n                            cssFloat: 'left',\n                        },\n                    }),\n                    LANG('file-paste'),\n                ],\n                custom: {\n                    tabIndex: '-1',\n                },\n                css: {\n                    lineHeight: '20px',\n                },\n                onClick: () => this.onPaste(),\n            });\n\n            this.rootEl.append(copyBtn, pasteBtn, BB.el({ className: 'grid-hr' }));\n        }\n        addGroup(groupA);\n        this.rootEl.append(BB.el({ className: 'grid-hr' }));\n        addGroup(groupB);\n        this.rootEl.append(BB.el({ className: 'grid-hr' }));\n        addGroup(groupC);\n\n        this.isInit = true;\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: TEditUiParams) {\n        this.klRootEl = p.klRootEl;\n        this.klColorSlider = p.klColorSlider;\n        this.layersUi = p.layersUi;\n        this.getCurrentColor = p.getCurrentColor;\n        this.maxCanvasSize = p.maxCanvasSize;\n        this.klCanvas = p.klCanvas;\n        this.getCurrentLayer = p.getCurrentLayer;\n        this.isEmbed = p.isEmbed;\n        this.statusOverlay = p.statusOverlay;\n        this.onCanvasChanged = p.onCanvasChanged;\n        this.applyUncommitted = p.applyUncommitted;\n        this.klHistory = p.klHistory;\n        this.onCopyToClipboard = p.onCopyToClipboard;\n        this.onPaste = p.onPaste;\n\n        this.rootEl = BB.el();\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    show(): void {\n        if (!this.isInit) {\n            this.init();\n        }\n        this.rootEl.style.display = 'block';\n    }\n\n    hide(): void {\n        this.rootEl.style.display = 'none';\n    }\n}\n","import { fxCanvas } from './fx-canvas';\nimport { TFxCanvas } from './fx-canvas-types';\n\nlet failed = false;\nlet fx: TFxCanvas | null = null;\n\nexport function getSharedFx(): TFxCanvas | null {\n    // failed previously, don't need to try again.\n    if (failed) {\n        return fx;\n    }\n\n    if (!fx || fx._.gl.isContextLost()) {\n        try {\n            fx = fxCanvas();\n        } catch (e) {\n            failed = true;\n            fx = null;\n            setTimeout(() => {\n                throw e;\n            });\n        }\n    }\n    return fx;\n}\n","import { brightnessContrast } from './filters/brightness-contrast';\nimport { FxShader } from './core/fx-shader';\nimport { gl, setGl } from './core/gl';\nimport { FxTexture } from './core/fx-texture';\nimport { curves } from './filters/curves';\nimport { hueSaturation } from './filters/hue-saturation';\nimport { noise } from './filters/noise';\nimport { triangleBlur } from './filters/triangle-blur';\nimport { tiltShift } from './filters/tilt-shift';\nimport { matrixWarp } from './filters/matrix-warp';\nimport { unsharpMask } from './filters/unsharp-mask';\nimport { toAlpha } from './filters/to-alpha';\nimport { invert } from './filters/invert';\nimport { perspective } from './filters/perspective';\nimport { unmultiplyAlpha } from './filters/unmultiply-alpha';\nimport { distort } from './filters/distort';\nimport { multiplyAlpha } from './filters/multiply-alpha';\nimport { TFxCanvas, TFxGl, TFxSupportedElements, TWrappedTexture } from './fx-canvas-types';\nimport { BB } from '../bb/bb';\nimport { mask } from './filters/mask';\n\n/*\n * based on glfx.js\n * https://github.com/evanw/glfx.js/\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n */\n\n/**\n * Before you can apply any filters you will need a canvas, which stores the result of the filters you apply.\n * Canvas creation is done through fxCanvas(), which creates and returns a new WebGL <canvas> tag with additional\n * methods specific to fxCanvas. This call will throw an error message if the browser doesn't support WebGL.\n *\n * This library provides realtime image effects using WebGL. There are three parts to it:\n * - texture - a raw source of image data (created from <img> <canvas> or <video>)\n * - filter - an image effect (represents one or more WebGL shaders)\n * - canvas - an image buffer that stores the results (a WebGL <canvas> tag)\n */\nexport const fxCanvas: () => TFxCanvas = (function () {\n    function wrapTexture(texture: FxTexture): TWrappedTexture {\n        return {\n            _: texture,\n            loadContentsOf: function (element) {\n                // Make sure that we're using the correct global WebGL context\n                setGl(this._.gl);\n                this._.loadContentsOf(element);\n            },\n            destroy: function () {\n                // Make sure that we're using the correct global WebGL context\n                setGl(this._.gl);\n                this._.destroy();\n            },\n        };\n    }\n\n    function texture(element: TFxSupportedElements) {\n        return wrapTexture(FxTexture.fromElement(element));\n    }\n\n    function getTextureType(): GLenum {\n        let textureType: GLenum = gl.UNSIGNED_BYTE;\n\n        // Go for floating point buffer textures if we can, it'll make the bokeh\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\n        // render to a floating-point texture when linear filtering is enabled.\n        // See http://crbug.com/172278 for more information.\n        if (\n            gl.getExtension('WEBGL_color_buffer_float') && // firefox shows warning without this line\n            gl.getExtension('OES_texture_float') &&\n            gl.getExtension('OES_texture_float_linear')\n        ) {\n            const testTexture = new FxTexture(100, 100, gl.RGBA, gl.FLOAT);\n            try {\n                // Only use gl.FLOAT if we can render to it\n                testTexture.drawTo(function () {\n                    textureType = gl.FLOAT;\n                });\n            } catch (e) {\n                /* empty */\n            }\n            testTexture.destroy();\n        }\n        return textureType;\n    }\n\n    function initialize(this: TFxCanvas, width: number, height: number): void {\n        const textureType = getTextureType();\n        if (this._.texture) {\n            this._.texture.destroy();\n        }\n        if (this._.spareTexture) {\n            this._.spareTexture.destroy();\n        }\n        this.width = width;\n        this.height = height;\n        this._.texture = new FxTexture(width, height, gl.RGBA, textureType);\n        this._.spareTexture = new FxTexture(width, height, gl.RGBA, textureType);\n        this._.extraTexture = this._.extraTexture || new FxTexture(0, 0, gl.RGBA, textureType);\n        this._.flippedShader =\n            this._.flippedShader ||\n            new FxShader(\n                null,\n                `\nuniform sampler2D texture;\nvarying vec2 texCoord;\nvoid main() {\n    gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\n}\n        `,\n                'flippedShader',\n            );\n        this._.isInitialized = true;\n    }\n\n    function draw(\n        this: TFxCanvas,\n        texture: TWrappedTexture,\n        width?: number,\n        height?: number,\n    ): TFxCanvas {\n        if (\n            !this._.isInitialized ||\n            texture._.width != this.width ||\n            texture._.height != this.height\n        ) {\n            initialize.call(\n                this,\n                width ? width : texture._.width,\n                height ? height : texture._.height,\n            );\n        }\n\n        texture._.use();\n        this._.texture.drawTo(function () {\n            FxShader.getDefaultShader().drawRect();\n        });\n\n        return this;\n    }\n\n    function update(this: TFxCanvas): TFxCanvas {\n        this._.texture.use();\n        this._.flippedShader.drawRect();\n        return this;\n    }\n\n    function contents(this: TFxCanvas): TWrappedTexture {\n        const texture = new FxTexture(\n            this._.texture.width,\n            this._.texture.height,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n        );\n        this._.texture.use();\n        texture.drawTo(function () {\n            FxShader.getDefaultShader().drawRect();\n        });\n        return wrapTexture(texture);\n    }\n\n    /*\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\n       Length of the array will be width * height * 4.\n    */\n    function getPixelArray(this: TFxCanvas): Uint8Array {\n        const w = this._.texture.width;\n        const h = this._.texture.height;\n        const array = new Uint8Array(w * h * 4);\n        this._.texture.drawTo(function () {\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\n        });\n        return array;\n    }\n\n    function wrap<F extends (...args: any[]) => unknown>(fn: F): F {\n        return <F>function (this: TFxCanvas, ...args: any[]) {\n            // Make sure that we're using the correct global WebGL context\n            setGl(this._.gl);\n            // Now that the context has been switched, we can call the wrapped function\n            return fn.apply(this, args);\n        };\n    }\n\n    function getWebGlContext(\n        canvas: HTMLCanvasElement,\n        options?: WebGLContextAttributes,\n    ): WebGLRenderingContext | null {\n        const contextNames = ['webgl', 'experimental-webgl', 'webgl2'];\n        let context: WebGLRenderingContext | null = null;\n        contextNames.forEach((name) => {\n            if (context) {\n                return;\n            }\n            // get.webgl.org does a try-catch\n            try {\n                context = canvas.getContext(name, options) as typeof context;\n            } catch (e) {\n                /* empty */\n            }\n        });\n        return context;\n    }\n\n    return (): TFxCanvas => {\n        if (!window.WebGLRenderingContext) {\n            throw 'WebGLRenderingContext not set. Browser does not support WebGL.';\n        }\n\n        const canvas: TFxCanvas = BB.canvas(1, 1) as TFxCanvas;\n        const context = getWebGlContext(canvas, { premultipliedAlpha: false });\n        if (!context) {\n            throw 'This browser does not support WebGL';\n        }\n        setGl(context as TFxGl);\n\n        canvas._ = {\n            gl,\n            isInitialized: false,\n            texture: null,\n            spareTexture: null,\n            flippedShader: null,\n        } as any;\n\n        // Core methods\n        canvas.texture = wrap(texture);\n        canvas.initialize = wrap(initialize);\n        canvas.draw = wrap(draw);\n        canvas.update = wrap(update);\n        canvas.contents = wrap(contents);\n        canvas.getPixelArray = wrap(getPixelArray);\n\n        // Filter methods\n        canvas.brightnessContrast = wrap(brightnessContrast);\n        canvas.hueSaturation = wrap(hueSaturation);\n        canvas.triangleBlur = wrap(triangleBlur);\n        canvas.unsharpMask = wrap(unsharpMask);\n        canvas.perspective = wrap(perspective);\n        canvas.matrixWarp = wrap(matrixWarp);\n        canvas.tiltShift = wrap(tiltShift);\n        canvas.noise = wrap(noise);\n        canvas.curves = wrap(curves);\n        canvas.invert = wrap(invert);\n        canvas.multiplyAlpha = wrap(multiplyAlpha);\n        canvas.unmultiplyAlpha = wrap(unmultiplyAlpha);\n        canvas.toAlpha = wrap(toAlpha);\n        canvas.distort = wrap(distort);\n        canvas.mask = wrap(mask);\n\n        return canvas as TFxCanvas;\n    };\n})();\n","import { BB } from '../../bb/bb';\nimport { simpleShader } from '../core/simple-shader';\nimport { FxShader } from '../core/fx-shader';\nimport { gl } from '../core/gl';\nimport { TFxCanvas } from '../fx-canvas-types';\n\n/**\n * Brightness / Contrast\n * Provides additive brightness and multiplicative contrast control.\n * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\n * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n */\nexport type TFilterBrightnessContrast = (\n    this: TFxCanvas,\n    brightness: number,\n    contrast: number,\n) => TFxCanvas;\n\nexport const brightnessContrast: TFilterBrightnessContrast = function (brightness, contrast) {\n    gl.brightnessContrast =\n        gl.brightnessContrast ||\n        new FxShader(\n            null,\n            '\\\n        uniform sampler2D texture;\\\n        uniform float brightness;\\\n        uniform float contrast;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.rgb += brightness;\\\n            if (contrast > 0.0) {\\\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\n            } else {\\\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\n            }\\\n            gl_FragColor = clamp(color, 0.0, 1.0);\\\n        }\\\n    ',\n            'brightnessContrast',\n        );\n\n    simpleShader.call(this, gl.brightnessContrast, {\n        brightness: BB.clamp(brightness, -1, 1),\n        contrast: BB.clamp(contrast, -1, 1),\n    });\n\n    return this;\n};\n","import { TFxCanvas, TUniforms } from '../fx-canvas-types';\nimport { FxTexture } from './fx-texture';\nimport { FxShader } from './fx-shader';\n\nexport function simpleShader(\n    this: TFxCanvas,\n    shader: FxShader,\n    uniforms: TUniforms<number | number[]>,\n    textureIn?: FxTexture,\n    textureOut?: FxTexture,\n): void {\n    (textureIn || this._.texture).use();\n    this._.spareTexture.drawTo(function () {\n        shader.uniforms(uniforms).drawRect();\n    });\n    this._.spareTexture.swapWith(textureOut || this._.texture);\n}\n","import { gl } from './gl';\nimport { TUniforms } from '../fx-canvas-types';\nimport { BB } from '../../bb/bb';\n\n// VERTEX_SHADER | FRAGMENT_SHADER\ntype TShaderType = GLenum;\n\nconst defaultVertexSource =\n    '\\\n    attribute vec2 vertex;\\\n    attribute vec2 _texCoord;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        texCoord = _texCoord;\\\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\n    }';\n\nconst defaultFragmentSource =\n    '\\\n    uniform sampler2D texture;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        gl_FragColor = texture2D(texture, texCoord);\\\n    }';\n\nfunction isArray(obj: unknown): obj is unknown[] {\n    return Object.prototype.toString.call(obj) == '[object Array]';\n}\n\nfunction isNumber(obj: unknown): obj is number {\n    return Object.prototype.toString.call(obj) == '[object Number]';\n}\n\nlet floatPrecision: 'lowp' | 'mediump' | 'highp' | undefined;\n\nexport class FxShader {\n    // ---- static ----\n    static getDefaultShader(): FxShader {\n        gl.defaultShader = gl.defaultShader || new FxShader();\n        return gl.defaultShader;\n    }\n\n    // ---- private ----\n\n    private compileSource(type: TShaderType, source: string, nameStr: string): WebGLShader {\n        const shader = BB.throwIfNull(gl.createShader(type));\n        gl.shaderSource(shader, source.replace(/#define.*/, '')); // glslify adds a line add the beginning that breaks it\n        gl.compileShader(shader);\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\n        }\n        return shader;\n    }\n\n    /**\n     * HIGH_FLOAT | MEDIUM_FLOAT\n     */\n    private testPrecisionSupport(precisionType: GLenum): boolean {\n        const format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\n        return format !== null && format.precision !== 0;\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(vertexSource?: string | null, fragmentSource?: string | null, nameStr?: string) {\n        this.vertexAttribute = null;\n        this.texCoordAttribute = null;\n        this.program = BB.throwIfNull(gl.createProgram());\n        vertexSource = vertexSource || defaultVertexSource;\n        fragmentSource = fragmentSource || defaultFragmentSource;\n        if (!floatPrecision) {\n            floatPrecision = this.testPrecisionSupport(gl.HIGH_FLOAT)\n                ? 'highp'\n                : this.testPrecisionSupport(gl.MEDIUM_FLOAT)\n                  ? 'mediump'\n                  : 'lowp';\n        }\n        fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\n        gl.attachShader(\n            this.program,\n            this.compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'),\n        );\n        gl.attachShader(\n            this.program,\n            this.compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'),\n        );\n        gl.linkProgram(this.program);\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n            throw 'link error: ' + gl.getProgramInfoLog(this.program);\n        }\n    }\n\n    // ---- interface ----\n\n    vertexAttribute: null | number;\n    texCoordAttribute: null | number;\n    program: WebGLProgram | null; // null = destroyed\n\n    destroy(): void {\n        gl.deleteProgram(this.program);\n        this.program = null;\n    }\n\n    uniforms(uniforms: TUniforms<number | number[]>): FxShader {\n        gl.useProgram(this.program);\n        Object.entries(uniforms).forEach(([name, value]) => {\n            const location = gl.getUniformLocation(this.program!, name);\n            if (location === null) {\n                // will be null if the uniform isn't used in the shader\n                return;\n            }\n\n            if (isArray(value)) {\n                switch (value.length) {\n                    case 1:\n                        gl.uniform1fv(location, new Float32Array(value));\n                        break;\n                    case 2:\n                        gl.uniform2fv(location, new Float32Array(value));\n                        break;\n                    case 3:\n                        gl.uniform3fv(location, new Float32Array(value));\n                        break;\n                    case 4:\n                        gl.uniform4fv(location, new Float32Array(value));\n                        break;\n                    case 9:\n                        gl.uniformMatrix3fv(location, false, new Float32Array(value));\n                        break;\n                    case 16:\n                        gl.uniformMatrix4fv(location, false, new Float32Array(value));\n                        break;\n                    default:\n                        throw (\n                            'dont\\'t know how to load uniform \"' +\n                            name +\n                            '\" of length ' +\n                            value.length\n                        );\n                }\n            } else if (isNumber(value)) {\n                gl.uniform1f(location, value);\n            } else {\n                throw (\n                    'attempted to set uniform \"' +\n                    name +\n                    '\" to invalid value ' +\n                    ((value as any) || 'undefined').toString()\n                );\n            }\n        });\n        // allow chaining\n        return this;\n    }\n\n    //\n    /**\n     * textures are uniforms too but for some reason can't be specified by gl.uniform1f,\n     * even though floating point numbers represent the integers 0 through 7 exactly\n     */\n    textures(textures: Record<string, GLint>): FxShader {\n        gl.useProgram(this.program);\n\n        Object.entries(textures).forEach(([name, value]) => {\n            gl.uniform1i(gl.getUniformLocation(this.program!, name), value);\n        });\n\n        // allow chaining\n        return this;\n    }\n\n    drawRect(left?: number, top?: number, right?: number, bottom?: number): void {\n        let undefined;\n        const viewport = gl.getParameter(gl.VIEWPORT);\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\n        if (gl.vertexBuffer === undefined || gl.vertexBuffer === null) {\n            gl.vertexBuffer = BB.throwIfNull(gl.createBuffer());\n        }\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n        gl.bufferData(\n            gl.ARRAY_BUFFER,\n            new Float32Array([left, top, left, bottom, right, top, right, bottom]),\n            gl.STATIC_DRAW,\n        );\n        if (gl.texCoordBuffer == null) {\n            gl.texCoordBuffer = BB.throwIfNull(gl.createBuffer());\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n            gl.bufferData(\n                gl.ARRAY_BUFFER,\n                new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]),\n                gl.STATIC_DRAW,\n            );\n        }\n        if (this.vertexAttribute == null) {\n            this.vertexAttribute = gl.getAttribLocation(this.program!, 'vertex');\n            gl.enableVertexAttribArray(this.vertexAttribute);\n        }\n        if (this.texCoordAttribute == null) {\n            this.texCoordAttribute = gl.getAttribLocation(this.program!, '_texCoord');\n            gl.enableVertexAttribArray(this.texCoordAttribute);\n        }\n        gl.useProgram(this.program);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n        gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n        gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n    }\n}\n","import { TFxGl } from '../fx-canvas-types';\n\nexport let gl: TFxGl;\n\nexport function setGl(newGl: TFxGl | null): void {\n    // more problems setting type to null\n    gl = newGl as TFxGl;\n}\n","import { gl } from './gl';\nimport { BB } from '../../bb/bb';\nimport { TFxGl, TFxSupportedElements } from '../fx-canvas-types';\n\n/**\n * Format           Type                    Channels    Bytes per pixel\n * RGBA             UNSIGNED_BYTE           4           4\n * RGB              UNSIGNED_BYTE           3           3\n * RGBA             UNSIGNED_SHORT_4_4_4_4  4           2\n * RGBA             UNSIGNED_SHORT_5_5_5_1  4           2\n * RGB              UNSIGNED_SHORT_5_6_5    3           2\n * LUMINANCE_ALPHA  UNSIGNED_BYTE           2           2\n * LUMINANCE        UNSIGNED_BYTE           1           1\n * ALPHA            UNSIGNED_BYTE           1           1\n *\n * https://webglfundamentals.org/webgl/lessons/webgl-data-textures.html\n */\nexport type TTextureFormat = GLenum;\nexport type TTextureType = GLenum;\n\nexport class FxTexture {\n    // ---- static ----\n    static fromElement(element: TFxSupportedElements): FxTexture {\n        const texture = new FxTexture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\n        texture.loadContentsOf(element);\n        return texture;\n    }\n\n    // ---- private ----\n    private canvas: HTMLCanvasElement | null;\n    private type: TTextureType;\n\n    /*\n    // never seen this being used\n    private getCanvas(texture: Texture): CanvasRenderingContext2D {\n        if (this.canvas == null) {\n            this.canvas = BB.canvas(texture.width, texture.height);\n        }\n        this.canvas.width = texture.width;\n        this.canvas.height = texture.height;\n        const c = BB.ctx(this.canvas);\n        c.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        return c;\n    }*/\n\n    // ----------------------------------- public -----------------------------------\n    constructor(width: number, height: number, format: TTextureFormat, type: TTextureType) {\n        this.gl = gl;\n        this.id = BB.throwIfNull(gl.createTexture());\n        this.width = width;\n        this.height = height;\n        this.format = format;\n        this.type = type;\n        this.canvas = null;\n\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        if (width && height) {\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                this.format,\n                width,\n                height,\n                0,\n                this.format,\n                this.type,\n                null,\n            );\n        }\n    }\n\n    // ---- interface ----\n\n    gl: TFxGl;\n    width: number;\n    height: number;\n    id: WebGLTexture | null; // null -> destroyed\n    format: TTextureFormat;\n\n    loadContentsOf(element: TFxSupportedElements): void {\n        this.width = element.width || (element as HTMLVideoElement).videoWidth;\n        this.height = element.height || (element as HTMLVideoElement).videoHeight!;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\n    }\n\n    initFromBytes(width: number, height: number, data: number[]): void {\n        this.width = width;\n        this.height = height;\n        this.format = gl.RGBA;\n        this.type = gl.UNSIGNED_BYTE;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            width,\n            height,\n            0,\n            gl.RGBA,\n            this.type,\n            new Uint8Array(data),\n        );\n    }\n\n    destroy(): void {\n        gl.deleteTexture(this.id);\n        this.id = null;\n    }\n\n    use(unit?: number): void {\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n    }\n\n    unuse(unit: number): void {\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    }\n\n    ensureFormat(width: number, height: number, format: TTextureFormat, type: TTextureType): void {\n        // change the format only if required\n        if (\n            width != this.width ||\n            height != this.height ||\n            format != this.format ||\n            type != this.type\n        ) {\n            this.width = width;\n            this.height = height;\n            this.format = format;\n            this.type = type;\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                this.format,\n                width,\n                height,\n                0,\n                this.format,\n                this.type,\n                null,\n            );\n        }\n    }\n\n    ensureFormatViaTexture(texture: FxTexture): void {\n        this.ensureFormat(texture.width, texture.height, texture.format, texture.type);\n    }\n\n    drawTo(callback: () => void): void {\n        // start rendering to this texture\n        gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n            throw new Error('incomplete framebuffer');\n        }\n        gl.viewport(0, 0, this.width, this.height);\n\n        // do the drawing\n        callback();\n\n        // stop rendering to this texture\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /*\n    // never seen this being used\n    fillUsingCanvas (callback: (canvas: CanvasRenderingContext2D) => void): Texture {\n        callback(this.getCanvas(this));\n        this.format = gl.RGBA;\n        this.type = gl.UNSIGNED_BYTE;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.canvas);\n        return this;\n    }\n\n    // never seen this being used\n    toImage (image: HTMLImageElement): void {\n        this.use();\n        Shader.getDefaultShader().drawRect();\n        const size = this.width * this.height * 4;\n        const pixels = new Uint8Array(size);\n        const c = this.getCanvas(this);\n        const data = c.createImageData(this.width, this.height);\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n        for (let i = 0; i < size; i++) {\n            data.data[i] = pixels[i];\n        }\n        c.putImageData(data, 0, 0);\n        image.src = this.canvas.toDataURL();\n    }\n     */\n\n    swapWith(other: FxTexture): void {\n        let temp;\n\n        temp = other.id;\n        other.id = this.id;\n        this.id = temp;\n\n        temp = other.width;\n        other.width = this.width;\n        this.width = temp;\n\n        temp = other.height;\n        other.height = this.height;\n        this.height = temp;\n\n        temp = other.format;\n        other.format = this.format;\n        this.format = temp;\n\n        // type?\n    }\n}\n","import { splineInterpolate } from '../math/spline-interpolate';\nimport { gl } from '../core/gl';\nimport { FxShader } from '../core/fx-shader';\nimport { simpleShader } from '../core/simple-shader';\nimport { TFxCanvas } from '../fx-canvas-types';\n\n/**\n * Curves\n * @description A powerful mapping tool that transforms the colors in the image\n *              by an arbitrary function. The function is interpolated between\n *              a set of 2D points using splines. The curves filter can take\n *              either one or three arguments which will apply the mapping to\n *              either luminance or RGB values, respectively.\n * @param red   A list of points that define the function for the red channel.\n *              Each point is a list of two values: the value before the mapping\n *              and the value after the mapping, both in the range 0 to 1. For\n *              example, [[0,1], [1,0]] would invert the red channel while\n *              [[0,0], [1,1]] would leave the red channel unchanged.\n * @param green A list of points that define the function for the green\n *              channel (just like for red).\n * @param blue  list of points that define the function for the blue\n *              channel (just like for red).\n */\nexport type TFilterCurves = (\n    this: TFxCanvas,\n    red: [number, number][],\n    green: [number, number][],\n    blue: [number, number][],\n) => TFxCanvas;\n\nexport const curves: TFilterCurves = function (red, green, blue) {\n    // Create the ramp texture\n    const redRamp = splineInterpolate(red);\n    const greenRamp = splineInterpolate(green);\n    const blueRamp = splineInterpolate(blue);\n    const array: number[] = [];\n    for (let i = 0; i < 256; i++) {\n        array.splice(array.length, 0, redRamp[i], greenRamp[i], blueRamp[i], 255);\n    }\n    this._.extraTexture.initFromBytes(256, 1, array);\n    this._.extraTexture.use(1);\n\n    gl.curves =\n        gl.curves ||\n        new FxShader(\n            null,\n            '\\\n        uniform sampler2D texture;\\\n        uniform sampler2D map;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.r = texture2D(map, vec2(color.r)).r;\\\n            color.g = texture2D(map, vec2(color.g)).g;\\\n            color.b = texture2D(map, vec2(color.b)).b;\\\n            gl_FragColor = color;\\\n        }\\\n    ',\n            'curves',\n        );\n\n    gl.curves.textures({\n        map: 1,\n    });\n    simpleShader.call(this, gl.curves, {});\n\n    return this;\n};\n","import { BB } from '../../bb/bb';\n\nexport function splineInterpolate(points: [number, number][]): number[] {\n    const interpolator = new BB.SplineInterpolator(points);\n    const array = [];\n    for (let i = 0; i < 256; i++) {\n        array.push(BB.clamp(Math.floor(interpolator.interpolate(i / 255) * 256), 0, 255));\n    }\n    return array;\n}\n","import { gl } from '../core/gl';\nimport { FxShader } from '../core/fx-shader';\nimport { simpleShader } from '../core/simple-shader';\nimport { BB } from '../../bb/bb';\nimport { TFxCanvas } from '../fx-canvas-types';\n\n/**\n * Hue / Saturation\n * @description      Provides rotational hue and multiplicative saturation control. RGB color space\n *                   can be imagined as a cube where the axes are the red, green, and blue color\n *                   values. Hue changing works by rotating the color vector around the grayscale\n *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\n *                   Saturation is implemented by scaling all color channel values either toward\n *                   or away from the average color channel value.\n * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\n *                   and 1 is 180 degree rotation in the positive direction)\n * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n */\nexport type TFilterHueSaturation = (this: TFxCanvas, hue: number, saturation: number) => TFxCanvas;\n\nexport const hueSaturation: TFilterHueSaturation = function (hue, saturation) {\n    gl.hueSaturation =\n        gl.hueSaturation ||\n        new FxShader(\n            null,\n            '\\\n        uniform sampler2D texture;\\\n        uniform float hue;\\\n        uniform float saturation;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            \\\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\n            float angle = hue * 3.14159265;\\\n            float s = sin(angle), c = cos(angle);\\\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\n            float len = length(color.rgb);\\\n            color.rgb = vec3(\\\n                dot(color.rgb, weights.xyz),\\\n                dot(color.rgb, weights.zxy),\\\n                dot(color.rgb, weights.yzx)\\\n            );\\\n            \\\n            /* saturation adjustment */\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            if (saturation > 0.0) {\\\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\n            } else {\\\n                color.rgb += (average - color.rgb) * (-saturation);\\\n            }\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ',\n            'hueSaturation',\n        );\n\n    simpleShader.call(this, gl.hueSaturation, {\n        hue: BB.clamp(hue, -1, 1),\n        saturation: BB.clamp(saturation, -1, 1),\n    });\n\n    return this;\n};\n","import { gl } from '../core/gl';\nimport { FxShader } from '../core/fx-shader';\nimport { simpleShader } from '../core/simple-shader';\nimport shaderNoise from '../shaders/shader-noise.glsl';\nimport { TFxCanvas } from '../fx-canvas-types';\n\n/**\n * Noise\n * draws noise, completely replaces original image\n */\nexport type TFilterNoise = (\n    this: TFxCanvas,\n    seed: number | undefined, // float, any value okay - default 0\n    type: number, // 1 value, 2 simplex, 3 cellular\n    scale: [number, number], // float, small scale will show repeating patterns\n    offset: [number, number], // offset x, y - large offsets will show repeating patterns\n    octaves: number, // int 0 - 4\n    samples: number, // 1 | 4 | 8 -> super-sampling\n    peaks: number, // how often it will ramp *additionally* from 0 to 1\n    brightness: number, // range [-1, 1]\n    contrast: number, // range [-1, 1]\n    isReversed: boolean, // reverse 0-1 range\n    colA: { r: number; g: number; b: number } | undefined, // which color at 0, if rgb - default black\n    colB: { r: number; g: number; b: number } | undefined, // which color at 1, if rgb - default white\n    channels: 'rgb' | 'alpha', // which channel to target\n) => TFxCanvas;\n\nexport const noise: TFilterNoise = function (\n    seed,\n    type,\n    scale,\n    offset,\n    octaves,\n    samples,\n    peaks,\n    brightness,\n    contrast,\n    isReversed,\n    colA,\n    colB,\n    channels,\n) {\n    gl.noise = gl.noise || new FxShader(null, shaderNoise.replace(/#define.*/, ''), 'noise');\n    simpleShader.call(this, gl.noise, {\n        seed: seed || 0,\n        type,\n        scale: [scale[0], scale[1]],\n        offset,\n        octaves,\n        samples,\n        texSize: [this.width, this.height],\n        peaks,\n        brightness,\n        contrast,\n        isReversed: isReversed ? 1.0 : 0.0,\n        colA: colA ? [colA.r / 255, colA.g / 255, colA.b / 255] : [0, 0, 0],\n        colB: colB ? [colB.r / 255, colB.g / 255, colB.b / 255] : [1, 1, 1],\n        channels: channels === 'rgb' ? 0 : 1,\n    });\n\n    return this;\n};\n","uniform sampler2D texture;\nvarying vec2 texCoord;\nuniform vec2 texSize;\n\nuniform float seed;\nuniform float type;\nuniform vec2 scale;\nuniform vec2 offset;\nuniform float octaves;\nuniform float samples;\n\nuniform float peaks;\nuniform float contrast;\nuniform float brightness;\nuniform float isReversed;\n\nuniform vec3 colA;\nuniform vec3 colB;\n\nuniform float channels; // 0 - rgb, 1 - alpha\n\n// fbm, cellular_noise based on\n// https://github.com/Gonkee/Gonkees-Shaders\n// MIT, Copyright  Gonkee\n\n// hash & simplex based on\n// https://www.shadertoy.com/view/Msf3WH\n// MIT, Copyright  2013 Inigo Quilez\n// https://www.youtube.com/c/InigoQuilez\n// https://iquilezles.org\n\n\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat value_noise(vec2 coord){\n    return rand(floor(coord) / 100.0);\n}\n\nfloat cellular_noise(vec2 coord) {\n    vec2 i = floor(coord);\n    vec2 f = fract(coord);\n\n    float min_dist = 99999.0;\n    for (float x = -1.0; x <= 1.0; x++) {\n        for (float y = -1.0; y <= 1.0; y++) {\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\n            min_dist = min(min_dist, dist);\n        }\n    }\n    return min_dist;\n}\n\n// ---------- Simplex Alternative ---------------------\n\nvec3 hash(vec3 p)\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\n, dot(p, vec3(269.5, 183.3, 246.1))\n, dot(p, vec3(113.5, 271.9, 124.6)))\n;return fract(sin(p)*43758.5453123)*2.-1.; }\n\nmat3 hash(mat3 p)\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\n\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\n\n//return noiseGra13dx as .x, and its derivatives as .yzw\n// https://www.shadertoy.com/view/llByD1\nvec3 noiseGra13dx(in vec3 x) {\n    vec3 p=floor(x), w=fract(x)\n    #if 1\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\n    #else\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\n    #endif\n    //gradients\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\n    //projections\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\n    //interpolations\n    float g=dot(G, w), f=dot(F, w-vec3(1));\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\n    mat3 S=D-mat3(G, G, G), W=D-E;\n    a.x=(a.x+a.y+a.z)+f-g;\n    ;float b=u.x*u.y*u.z;\n\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\n    return 0.5 + 0.5 * result.xxx;\n}\n\nfloat fbm(vec2 coord) {\n    float normalize_factor = 0.0;\n    float value = 0.0;\n    float scale = 0.5;\n\n    for (float i = 0.0; i < 7.0; i++){\n        if (i < octaves) {\n            if (type == 0.0) {\n                value += value_noise(coord) * scale;\n            } else if (type == 1.0) {\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\n            } else if (type == 2.0) {\n                value += cellular_noise(coord) * scale;\n            }\n            normalize_factor += scale;\n            coord *= 2.0;\n            scale *= 0.5;\n        }\n    }\n    return value / normalize_factor;\n}\n\nfloat render (vec2 pos) {\n    float result = fbm(pos);\n    //\n\n    if (peaks > 0.0) {\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\n    }\n\n    result += brightness;\n    if (contrast > 0.0) {\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\n    } else if (contrast < 0.0) {\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\n    }\n\n    if (isReversed == 1.0) {\n        result = 1.0 - result;\n    }\n    return result;\n}\n\n\nvoid main() {\n    vec4 color;\n\n    vec2 seedOffset;\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\n\n    float val = 0.0;\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\n\n    if (samples == 1.0) {\n        val = render(basePos);\n\n    }/* else if (samples == 4.0) {\n        for (float i = 0.0; i < 2.0; i++) {\n            for (float e = 0.0; e < 2.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\n            }\n        }\n        val /= 4.0;\n\n    }*/ else if (samples == 16.0) {\n        for (float i = 0.0; i < 4.0; i++) {\n            for (float e = 0.0; e < 4.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\n            }\n        }\n        val /= 16.0;\n    }\n\n    if (channels == 0.0) {\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\n    } else {\n        gl_FragColor = vec4(vec3(1.0), val);\n    }\n}","import { gl } from '../core/gl';\nimport { FxShader } from '../core/fx-shader';\nimport { randomShaderFunc } from '../shaders/random-shader-func';\nimport { simpleShader } from '../core/simple-shader';\nimport { TFxCanvas } from '../fx-canvas-types';\n\n/**\n * Triangle Blur\n * @description  This is the most basic blur filter, which convolves the image with a\n *               pyramid filter. The pyramid filter is separable and is applied as two\n *               perpendicular triangle filters.\n *               Note: Requires alpha to be premultiplied.\n * @param radius The radius of the pyramid convolved with the image.\n */\nexport type TFilterTriangleBlur = (this: TFxCanvas, radius: number) => TFxCanvas;\n\nexport const triangleBlur: TFilterTriangleBlur = function (radius) {\n    gl.triangleBlur =\n        gl.triangleBlur ||\n        new FxShader(\n            null,\n            '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' +\n                randomShaderFunc +\n                '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n        }\\\n    ',\n            'triangleBlur',\n        );\n\n    simpleShader.call(this, gl.triangleBlur, {\n        delta: [radius / this.width, 0],\n    });\n    simpleShader.call(this, gl.triangleBlur, {\n        delta: [0, radius / this.height],\n    });\n\n    return this;\n};\n","// returns a random number between 0 and 1\nexport const randomShaderFunc =\n    '\\\n    float random(vec3 scale, float seed) {\\\n        /* use the fragment position for a different seed per-pixel */\\\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\n    }\\\n';\n","import { gl } from '../core/gl';\nimport { FxShader } from '../core/fx-shader';\nimport { randomShaderFunc } from '../shaders/random-shader-func';\nimport { simpleShader } from '../core/simple-shader';\nimport { TFxCanvas } from '../fx-canvas-types';\n\n/**\n * Tilt Shift\n * @description          Simulates the shallow depth of field normally encountered in close-up\n *                       photography, which makes the scene seem much smaller than it actually\n *                       is. This filter assumes the scene is relatively planar, in which case\n *                       the part of the scene that is completely in focus can be described by\n *                       a line (the intersection of the focal plane and the scene). An example\n *                       of a planar scene might be looking at a road from above at a downward\n *                       angle. The image is then blurred with a blur radius that starts at zero\n *                       on the line and increases further from the line.\n *                       Note: Requires alpha to be premultiplied.\n *\n * @param startX         The x coordinate of the start of the line segment.\n * @param startY         The y coordinate of the start of the line segment.\n * @param endX           The x coordinate of the end of the line segment.\n * @param endY           The y coordinate of the end of the line segment.\n * @param blurRadius     The maximum radius of the pyramid blur.\n * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\n */\nexport type TFilterTiltShift = (\n    this: TFxCanvas,\n    startX: number,\n    startY: number,\n    endX: number,\n    endY: number,\n    blurRadius: number,\n    gradientRadius: number,\n) => TFxCanvas;\n\nexport const tiltShift: TFilterTiltShift = function (\n    startX,\n    startY,\n    endX,\n    endY,\n    blurRadius,\n    gradientRadius,\n) {\n    gl.tiltShift =\n        gl.tiltShift ||\n        new FxShader(\n            null,\n            '\\\n        uniform sampler2D texture;\\\n        uniform float blurRadius;\\\n        uniform float gradientRadius;\\\n        uniform vec2 start;\\\n        uniform vec2 end;\\\n        uniform vec2 delta;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        ' +\n                randomShaderFunc +\n                '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n        }\\\n    ',\n            'tiltShift',\n        );\n\n    const dx = endX - startX;\n    const dy = endY - startY;\n    const d = Math.sqrt(dx * dx + dy * dy);\n    simpleShader.call(this, gl.tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [startX, startY],\n        end: [endX, endY],\n        delta: [dx / d, dy / d],\n        texSize: [this.width, this.height],\n    });\n    simpleShader.call(this, gl.tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [startX, startY],\n        end: [endX, endY],\n        delta: [-dy / d, dx / d],\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};\n","import { gl } from '../core/gl';\nimport { warpShader } from '../shaders/warp-shader';\nimport { simpleShader } from '../core/simple-shader';\nimport { getInverse } from '../math/matrix';\nimport { TFxCanvas, TMat2x2, TMat3x3, TMatDeep3x3 } from '../fx-canvas-types';\n\n/**\n * Matrix Warp\n * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\n *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\n *                        3x3 matrix, where x and y are in units of pixels.\n * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\n *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\n *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\n * @param inverse         A boolean value that, when true, applies the inverse transformation\n *                        instead. (optional, defaults to false)\n * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\n *                        instead of screen-space coordinates. Texture-space coordinates range\n *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\n *                        to use for simple operations like flipping and rotating.\n */\nexport type TFilterMatrixWarp = (\n    this: TFxCanvas,\n    matrix: TMat2x2 | TMat3x3 | TMatDeep3x3,\n    inverse?: boolean,\n    useTextureSpace?: boolean,\n) => TFxCanvas;\n\nexport const matrixWarp: TFilterMatrixWarp = function (matrix, inverse, useTextureSpace) {\n    gl.matrixWarp =\n        gl.matrixWarp ||\n        warpShader(\n            '\\\n        uniform mat3 matrix;\\\n        uniform bool useTextureSpace;\\\n    ',\n            '\\\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\n        vec3 warp = matrix * vec3(coord, 1.0);\\\n        coord = warp.xy / warp.z;\\\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\n    ',\n        );\n\n    // Flatten all members of matrix into one big list\n    matrix = matrix.flat() as TMat2x2 | TMat3x3;\n\n    // Extract a 3x3 matrix out of the arguments\n    if (matrix.length == 4) {\n        matrix = [matrix[0], matrix[1], 0, matrix[2], matrix[3], 0, 0, 0, 1];\n    } else if (matrix.length != 9) {\n        throw 'can only warp with 2x2 or 3x3 matrix';\n    }\n\n    simpleShader.call(this, gl.matrixWarp, {\n        matrix: inverse ? getInverse(matrix) : matrix,\n        texSize: [this.width, this.height],\n        useTextureSpace: useTextureSpace ? 1 : 0,\n    });\n\n    return this;\n};\n","import { FxShader } from '../core/fx-shader';\n\nexport function warpShader(uniformsStr: string, warpStr: string): FxShader {\n    return new FxShader(\n        null,\n        uniformsStr +\n            '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        vec2 coord = texCoord * texSize;\\\n        ' +\n            warpStr +\n            '\\\n        gl_FragColor = texture2D(texture, coord / texSize);\\\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\n        if (coord != clampedCoord) {\\\n            /* fade to transparent if we are outside the image */\\\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\n        }\\\n    }',\n        'warp',\n    );\n}\n","import { TMat3x3 } from '../fx-canvas-types';\n\n// from javax.media.jai.PerspectiveTransform\n\n/**\n * Creates a PerspectiveTransform that maps the unit square onto an arbitrary quadrilateral.\n */\nexport function getSquareToQuad(\n    x0: number,\n    y0: number,\n    x1: number,\n    y1: number,\n    x2: number,\n    y2: number,\n    x3: number,\n    y3: number,\n): TMat3x3 {\n    const dx1 = x1 - x2;\n    const dy1 = y1 - y2;\n    const dx2 = x3 - x2;\n    const dy2 = y3 - y2;\n    const dx3 = x0 - x1 + x2 - x3;\n    const dy3 = y0 - y1 + y2 - y3;\n    const det = dx1 * dy2 - dx2 * dy1;\n    const a = (dx3 * dy2 - dx2 * dy3) / det;\n    const b = (dx1 * dy3 - dx3 * dy1) / det;\n    return [\n        x1 - x0 + a * x1,\n        y1 - y0 + a * y1,\n        a,\n        x3 - x0 + b * x3,\n        y3 - y0 + b * y3,\n        b,\n        x0,\n        y0,\n        1,\n    ];\n}\n\nexport function getInverse(m: TMat3x3): TMat3x3 {\n    const a = m[0],\n        b = m[1],\n        c = m[2];\n    const d = m[3],\n        e = m[4],\n        f = m[5];\n    const g = m[6],\n        h = m[7],\n        i = m[8];\n    const det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\n    return [\n        (e * i - f * h) / det,\n        (c * h - b * i) / det,\n        (b * f - c * e) / det,\n        (f * g - d * i) / det,\n        (a * i - c * g) / det,\n        (c * d - a * f) / det,\n        (d * h - e * g) / det,\n        (b * g - a * h) / det,\n        (a * e - b * d) / det,\n    ];\n}\n\nexport function multiply(a: TMat3x3, b: TMat3x3): TMat3x3 {\n    return [\n        a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\n        a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\n        a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\n        a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\n        a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\n        a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\n        a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\n        a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\n        a[6] * b[2] + a[7] * b[5] + a[8] * b[8],\n    ];\n}\n","import { gl } from '../core/gl';\nimport { FxShader } from '../core/fx-shader';\nimport { simpleShader } from '../core/simple-shader';\nimport { TFxCanvas } from '../fx-canvas-types';\n\n/**\n * Unsharp Mask\n * @description    A form of image sharpening that amplifies high-frequencies in the image. It\n *                 is implemented by scaling pixels away from the average of their neighbors.\n * @param radius   The blur radius that calculates the average of the neighboring pixels.\n * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\n */\nexport type TFilterUnsharpMask = (this: TFxCanvas, radius: number, strength: number) => TFxCanvas;\n\nexport const unsharpMask: TFilterUnsharpMask = function (radius, strength) {\n    gl.unsharpMask =\n        gl.unsharpMask ||\n        new FxShader(\n            null,\n            '\\\n        uniform sampler2D blurredTexture;\\\n        uniform sampler2D originalTexture;\\\n        uniform float strength;\\\n        uniform float threshold;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\n            vec4 original = texture2D(originalTexture, texCoord);\\\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\n        }\\\n    ',\n            'unsharpMask',\n        );\n\n    // Store a copy of the current texture in the second texture unit\n    this._.extraTexture.ensureFormatViaTexture(this._.texture);\n    this._.texture.use();\n    this._.extraTexture.drawTo(function () {\n        FxShader.getDefaultShader().drawRect();\n    });\n\n    // Blur the current texture, then use the stored texture to detect edges\n    this._.extraTexture.use(1);\n    this.triangleBlur(radius);\n    gl.unsharpMask.textures({\n        originalTexture: 1,\n    });\n    simpleShader.call(this, gl.unsharpMask, {\n        strength: strength,\n    });\n    this._.extraTexture.unuse(1);\n\n    return this;\n};\n","import { gl } from '../core/gl';\nimport { FxShader } from '../core/fx-shader';\nimport { simpleShader } from '../core/simple-shader';\nimport { TFxCanvas } from '../fx-canvas-types';\nimport { TRgba } from '../../klecks/kl-types';\n\n/**\n * To Alpha\n * @description   Generates alpha channel from luminance (r+g+b)\n * @param isInverted    boolean - invert luminance\n * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\n */\nexport type TFilterToAlpha = (\n    this: TFxCanvas,\n    isInverted: boolean,\n    replaceRGBA: TRgba | null,\n) => TFxCanvas;\n\nexport const toAlpha: TFilterToAlpha = function (isInverted, replaceRGBA) {\n    gl.toAlpha =\n        gl.toAlpha ||\n        new FxShader(\n            null,\n            '\\\n    uniform bool isInverted;\\\n    uniform vec4 replace;\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\n        if (isInverted) alpha = 1.0 - alpha;\\\n        alpha = min(color.a, alpha);\\\n        if (replace.a > 0.0) color = replace;\\\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\n    }\\\n',\n            'toAlpha',\n        );\n\n    simpleShader.call(this, gl.toAlpha, {\n        isInverted: isInverted ? 1 : 0,\n        replace: replaceRGBA\n            ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a]\n            : [0, 0, 0, 0],\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};\n","import { gl } from '../core/gl';\nimport { FxShader } from '../core/fx-shader';\nimport { simpleShader } from '../core/simple-shader';\nimport { TFxCanvas } from '../fx-canvas-types';\n\n/**\n * Invert\n * @description   Inverts color of each pixel\n */\nexport type TFilterInvert = (this: TFxCanvas) => TFxCanvas;\n\nexport const invert: TFilterInvert = function () {\n    gl.invert =\n        gl.invert ||\n        new FxShader(\n            null,\n            '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        color.rgb = 1.0 - color.rgb;\\\n        gl_FragColor = color;\\\n    }\\\n',\n            'invert',\n        );\n\n    simpleShader.call(this, gl.invert, {\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};\n","import { getInverse, getSquareToQuad, multiply } from '../math/matrix';\nimport { TFxCanvas } from '../fx-canvas-types';\n\nexport type TRectanglePoints = [\n    number,\n    number, // point a\n    number,\n    number, // point b\n    number,\n    number, // point c\n    number,\n    number, // point d\n];\n\n/**\n * Perspective\n * @description  Warps one quadrangle to another with a perspective transform. This can be used to\n *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\n *               Note: Requires alpha to be premultiplied.\n * @param before The x and y coordinates of four points before the transform in a flat list. This\n *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\n *               (cx, cy), and (dx, dy).\n * @param after  The x and y coordinates of four points after the transform in a flat list, just\n *               like the other argument.\n */\nexport type TFilterPerspective = (\n    this: TFxCanvas,\n    before: TRectanglePoints,\n    after: TRectanglePoints,\n) => TFxCanvas;\n\nexport const perspective: TFilterPerspective = function (before, after) {\n    const a = getSquareToQuad(...after);\n    const b = getSquareToQuad(...before);\n    const c = multiply(getInverse(a), b);\n    return this.matrixWarp(c);\n};\n","import { gl } from '../core/gl';\nimport { FxShader } from '../core/fx-shader';\nimport { simpleShader } from '../core/simple-shader';\nimport { TFxCanvas } from '../fx-canvas-types';\n\n/**\n * unmultiplyAlpha\n * reverses alpha multiply\n */\nexport type TFilterUnmultiplyAlpha = (this: TFxCanvas) => TFxCanvas;\n\nexport const unmultiplyAlpha: TFilterUnmultiplyAlpha = function () {\n    gl.unmultiplyAlpha =\n        gl.unmultiplyAlpha ||\n        new FxShader(\n            null,\n            '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        if(color.a > 0.0) {\\\n            color.rgb /= color.a;\\\n        }\\\n        gl_FragColor = color;\\\n    }\\\n',\n            'unmultiplyAlpha',\n        );\n\n    simpleShader.call(this, gl.unmultiplyAlpha, {\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};\n","import { gl } from '../core/gl';\nimport { warpShader } from '../shaders/warp-shader';\nimport { simpleShader } from '../core/simple-shader';\nimport { TFxCanvas } from '../fx-canvas-types';\n\nexport type TFilterDistortSettings = {\n    stepSize: number; // [1, inf]\n    distortType: 0 | 1 | 2;\n    scale: { x: number; y: number };\n    strength: { x: number; y: number };\n    phase: { x: number; y: number };\n    offset: { x: number; y: number };\n};\n\n/**\n * Distort\n * Distorts image (moves pixels around)\n */\nexport type TFilterDistort = (this: TFxCanvas, settings: TFilterDistortSettings) => TFxCanvas;\n\n/**\n * @filter        Distort\n * @description   Distorts image (moves pixels around)\n *                Note: Requires alpha to be premultiplied.\n */\nexport const distort: TFilterDistort = function (settings) {\n    gl.distort =\n        gl.distort ||\n        warpShader(\n            `\n    uniform float stepSize;\n    uniform vec2 scale;\n    uniform vec2 strength;\n    uniform vec2 phase;\n    uniform float type;\n    uniform vec2 offset;\n`,\n            `\n    const float PI = 3.14159265;\n    float x = coord.x + offset.x;\n    float y = coord.y + offset.y;\n    if (stepSize > 1.0) {\n        x = floor(x / stepSize) * stepSize;\n        y = floor(y / stepSize) * stepSize;\n    }\n    float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;\n    float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;\n    if (type == 0.0) {\n        coord.y += distortX;\n        coord.x += distortY;\n    } else if (type == 1.0) {\n        coord.x += distortX;\n        coord.y += distortY;\n    } else if (type == 2.0) {\n        x -= offset.x;\n        y -= offset.y;\n        gl_FragColor = texture2D(texture, vec2(x, y) / texSize);\n        coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;\n        coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;\n    }\n    coord.x = mod(coord.x, texSize.x);\n    coord.y = mod(coord.y, texSize.y);\n`,\n        );\n\n    simpleShader.call(this, gl.distort, {\n        stepSize: settings.stepSize,\n        type: settings.distortType,\n        scale: [settings.scale.x, settings.scale.y],\n        strength: [settings.strength.x, settings.strength.y],\n        phase: [settings.phase.x, settings.phase.y],\n        offset: [settings.offset.x, settings.offset.y],\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};\n","import { gl } from '../core/gl';\nimport { FxShader } from '../core/fx-shader';\nimport { simpleShader } from '../core/simple-shader';\nimport { TFxCanvas } from '../fx-canvas-types';\n\n/**\n * multiplyAlpha\n * applies alpha multiply\n */\nexport type TFilterMultiplyAlpha = (this: TFxCanvas) => TFxCanvas;\n\nexport const multiplyAlpha: TFilterMultiplyAlpha = function () {\n    gl.multiplyAlpha =\n        gl.multiplyAlpha ||\n        new FxShader(\n            null,\n            '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        color.rgb *= color.a;\\\n        gl_FragColor = color;\\\n    }\\\n',\n            'multiplyAlpha',\n        );\n\n    simpleShader.call(this, gl.multiplyAlpha, {\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};\n","import { gl } from '../core/gl';\nimport { FxShader } from '../core/fx-shader';\nimport { simpleShader } from '../core/simple-shader';\nimport { TFxCanvas, TWrappedTexture } from '../fx-canvas-types';\n\n/**\n * Mask\n * @description Blends with an unfiltered image using a mask.\n * @param maskTexture mask (grayscale). 0 - unfiltered, 255 - filtered\n * @param originalTexture original/unfiltered image. undefined -> empty original\n */\nexport type TFilterMask = (\n    this: TFxCanvas,\n    maskTexture: TWrappedTexture,\n    originalTexture?: TWrappedTexture,\n) => TFxCanvas;\n\nexport const mask: TFilterMask = function (maskTexture, originalTexture) {\n    maskTexture._.use(1);\n\n    if (originalTexture) {\n        originalTexture._.use(2);\n    } else {\n        // should be faster than introducing a conditional in the shader\n        this._.extraTexture.use(2);\n        this._.extraTexture.initFromBytes(1, 1, [0, 0, 0, 0]);\n    }\n\n    gl.mask =\n        gl.mask ||\n        new FxShader(\n            null,\n            `\n        uniform sampler2D texture;\n        uniform sampler2D mask;\n        uniform sampler2D original;\n        varying vec2 texCoord;\n\n        void main() {\n            vec4 filteredCol = texture2D(texture, texCoord);\n            vec4 originalCol = texture2D(original, texCoord);\n            float maskStrength = texture2D(mask, texCoord).r;\n            gl_FragColor = mix(originalCol, filteredCol, maskStrength);\n        }\n        `,\n            'mask',\n        );\n\n    gl.mask.textures({\n        mask: 1,\n        original: 2,\n    });\n\n    simpleShader.call(this, gl.mask, {});\n\n    return this;\n};\n","import { BB } from '../../../bb/bb';\nimport { KL } from '../../kl';\nimport { KlCanvas } from '../../canvas/kl-canvas';\nimport { LANG } from '../../../language/language';\nimport loadingImg from 'url:/src/app/img/ui/loading.gif';\nimport { canvasToBlob } from '../../../bb/base/canvas';\nimport { css } from '../../../bb/base/base';\n\ntype TImgurUploadResponse = {\n    // just a subset\n    id: string;\n    datetime: number;\n    type: string;\n    width: number;\n    height: number;\n    deletehash: string;\n    name: string;\n    link: string;\n};\n\n/**\n * uploads canvas, opens new tab with the upload progress & then opens the image page.\n */\nasync function upload(\n    canvas: HTMLCanvasElement,\n    title: string,\n    description: string,\n    type: 'png' | 'jpeg',\n    imgurKey: string,\n): Promise<TImgurUploadResponse> {\n    const imageBlob = await canvasToBlob(canvas, 'image/' + type);\n\n    const newTab = window.open();\n\n    if (!newTab) {\n        throw new Error('could not create new tab');\n    }\n\n    const label = newTab.document.createElement('div');\n    const gif = newTab.document.createElement('img');\n    gif.src = loadingImg;\n    label.append(gif);\n    css(gif, {\n        filter: 'invert(1)',\n    });\n    css(newTab.document.body, {\n        backgroundColor: '#121211',\n        backgroundImage: 'linear-gradient(#2b2b2b 0%, #121211 50%)',\n        backgroundRepeat: 'no-repeat',\n    });\n\n    const labelText = newTab.document.createElement('div');\n    labelText.style.marginTop = '10px';\n    label.append(labelText);\n    labelText.textContent = LANG('upload-uploading');\n\n    newTab.document.body.append(label);\n    css(label, {\n        marginLeft: 'auto',\n        marginRight: 'auto',\n        marginTop: '100px',\n        fontFamily: 'system-ui, sans-serif',\n        fontSize: '20px',\n        textAlign: 'center',\n        transition: 'opacity 0.3s ease-in-out',\n        opacity: '0',\n        color: '#ccc',\n    });\n    setTimeout(function () {\n        label.style.opacity = '1';\n    }, 20);\n\n    let response;\n    try {\n        const formData = new FormData();\n        formData.append('title', title);\n        formData.append('description', description);\n        formData.append('image', imageBlob);\n        response = await fetch('https://api.imgur.com/3/image', {\n            method: 'POST',\n            headers: {\n                Authorization: 'Client-ID ' + imgurKey,\n            },\n            body: formData,\n        });\n    } catch (e) {\n        newTab.close();\n        throw e;\n    }\n    if (!response.ok) {\n        newTab.close();\n        throw new Error();\n    }\n    const data: TImgurUploadResponse = (await response.json()).data;\n\n    newTab.location.href = data.link.replace(/\\.(jpg|png)/, '');\n\n    return data;\n}\n\nexport function imgurUpload(\n    klCanvas: KlCanvas,\n    klRootEl: HTMLElement,\n    imgurKey: string, // API key\n    onUploaded: () => void,\n): void {\n    if (!imgurKey) {\n        throw new Error('imgur key missing');\n    }\n\n    const inputTitle = BB.el({ tagName: 'input', custom: { name: 'image-title' } });\n    inputTitle.type = 'text';\n    inputTitle.value = LANG('upload-title-untitled');\n    const inputDescription = BB.el({\n        tagName: 'textarea',\n        custom: {\n            rows: '2',\n            name: 'image-description',\n        },\n        css: {\n            width: '100%',\n            maxWidth: '100%',\n        },\n    });\n\n    const labelTitle = BB.el({\n        textContent: LANG('upload-name') + ':',\n    });\n    const labelDescription = BB.el({\n        textContent: LANG('upload-caption') + ':',\n        css: {\n            marginTop: '10px',\n        },\n    });\n\n    const tos = BB.el({\n        content: `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('terms-of-service')}</a>`,\n    });\n\n    const typeRadio = new KL.RadioList({\n        name: 'filetype',\n        init: 'jpeg',\n        items: [\n            { label: 'JPG', value: 'jpeg' },\n            { label: 'PNG', value: 'png' },\n        ],\n        ignoreFocus: true,\n    });\n    css(typeRadio.getElement(), {\n        marginBottom: '10px',\n    });\n\n    const outDiv = BB.el();\n    const infoHint = BB.el({\n        className: 'info-hint',\n        textContent: LANG('upload-link-notice'),\n    });\n    outDiv.append(\n        infoHint,\n        typeRadio.getElement(),\n        labelTitle,\n        inputTitle,\n        labelDescription,\n        inputDescription,\n        tos,\n    );\n    KL.popup({\n        target: klRootEl,\n        message: `<b>${LANG('upload-title')}</b>`,\n        type: 'upload',\n        div: outDiv,\n        buttons: [LANG('upload-submit'), 'Cancel'],\n        clickOnEnter: LANG('upload-submit'),\n        primaries: [LANG('upload-submit')],\n        autoFocus: LANG('upload-submit'),\n        callback: async function (val) {\n            if (val === LANG('upload-submit') || val === 'Yes' || val === 'Ok') {\n                try {\n                    const result = await upload(\n                        klCanvas.getCompleteCanvas(1),\n                        inputTitle.value,\n                        inputDescription.value,\n                        typeRadio.getValue() as 'png' | 'jpeg',\n                        imgurKey,\n                    );\n\n                    KL.popup({\n                        target: klRootEl,\n                        type: 'ok',\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/delete/${result.deletehash}</a><br><br>`,\n                        buttons: ['Ok'],\n                    });\n                    onUploaded();\n                } catch (e) {\n                    KL.popup({\n                        target: klRootEl,\n                        type: 'error',\n                        message: LANG('upload-failed'),\n                        buttons: ['Ok'],\n                    });\n                }\n            }\n        },\n    });\n}\n","module.exports = parcelRequire.resolve(\"loading.68659e0a.gif\") + \"?\" + Date.now();","export type TAgPsd = Awaited<typeof import('ag-psd')>;\nlet agPsdLazy: TAgPsd;\n\nexport async function loadAgPsd(): Promise<TAgPsd> {\n    if (!agPsdLazy) {\n        agPsdLazy = await import('ag-psd');\n    }\n    return agPsdLazy;\n}\n","module.exports = (__parcel__import__(\"./\" + \"dist.85077542.js\")).then(() => parcelRequire('lfV2S'));","import { KL } from '../../kl';\nimport { BB } from '../../../bb/bb';\nimport { LANG } from '../../../language/language';\nimport { ProjectStore } from '../../storage/project-store';\nimport { TKlProject } from '../../kl-types';\nimport { KlHistory } from '../../history/kl-history';\nimport { LocalStorage } from '../../../bb/base/local-storage';\nimport * as classes from './save-reminder.module.scss';\nimport { BrowserStorageUi } from './browser-storage-ui';\n\nexport type TSaveReminderSetting = '20min' | '40min' | 'disabled';\n\nconst DEBUG_TIME_LIMIT_MS: undefined | number = undefined;\nconst DEBUG_UNSAVED_ACTIONS_LIMIT: undefined | number = undefined;\n// minimum number of actions required for reminder to show up (regardless of time limit)\nconst UNSAVED_ACTIONS_LIMIT = DEBUG_UNSAVED_ACTIONS_LIMIT ?? 100;\nconst LS_REMINDER_KEY = 'kl-save-reminder';\n\nexport type TSaveReminderParams = {\n    onSaveAsPsd: () => void;\n    isDrawing: () => boolean;\n    projectStore: ProjectStore; // needed if showReminder\n    getProject: () => TKlProject; // needed if showReminder\n    onStored: () => void;\n    applyUncommitted: () => void;\n    klHistory: KlHistory;\n};\n\n/**\n * remind user of saving, keep user aware of save state\n */\nexport class SaveReminder {\n    private readonly onSaveAsPsd: () => void;\n    private readonly isDrawing: () => boolean;\n    private readonly projectStore: ProjectStore;\n    private readonly getProject: () => TKlProject;\n    private readonly onStored: () => void;\n    private readonly applyUncommitted: () => void;\n    private klHistory: KlHistory = {} as KlHistory;\n\n    private setting: TSaveReminderSetting;\n    private lastSavedHistoryIndex: number | undefined;\n    private lastSavedAt: number = 0;\n\n    private lastReminderShownAt: number = 0;\n    private closeFunc: (() => void) | undefined;\n\n    showPopup(): void {\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\n\n        const contentEl = BB.el();\n\n        contentEl.append(\n            BB.el({\n                content: LANG('save-reminder-text', {\n                    a: '<strong>' + min,\n                    b: '</strong>',\n                }),\n                css: {\n                    marginBottom: '20px',\n                },\n            }),\n        );\n\n        const psdWrapper = BB.el({\n            className: classes.psdWrapper,\n        });\n        const storageWrapper = BB.el({\n            css: {\n                margin: '0 -20px',\n                padding: '20px',\n                paddingBottom: '0',\n            },\n        });\n        contentEl.append(psdWrapper, storageWrapper);\n\n        const psdBtn = BB.el({\n            tagName: 'button',\n            className: 'kl-button kl-button-primary kl-button--extra-focus',\n            content: LANG('save-reminder-save-psd'),\n            onClick: () => {\n                this.applyUncommitted();\n                this.onSaveAsPsd();\n            },\n            css: { padding: '14px' },\n            noRef: true,\n        });\n        psdWrapper.append(\n            psdBtn,\n            BB.el({\n                content: ' ' + LANG('save-reminder-psd-layers'),\n                css: {\n                    marginTop: '10px',\n                },\n            }),\n        );\n\n        const storageUi = new BrowserStorageUi({\n            projectStore: this.projectStore,\n            getProject: this.getProject,\n            klRootEl: document.body,\n            applyUncommitted: this.applyUncommitted,\n            options: {\n                hideClearButton: true,\n                isFocusable: true,\n            },\n            onStored: () => this.onStored(),\n        });\n        storageUi.show();\n        storageWrapper.append(storageUi.getElement());\n\n        KL.popup({\n            type: 'warning',\n            target: document.body,\n            message: `<b>${LANG('save-reminder-title')}</b>`,\n            div: contentEl,\n            ignoreBackground: true,\n            callback: () => {\n                storageUi.destroy();\n                BB.destroyEl(psdBtn);\n                this.closeFunc = undefined;\n                this.lastReminderShownAt = performance.now();\n            },\n            closeFunc: (f) => {\n                this.closeFunc = f;\n            },\n        });\n        setTimeout(() => {\n            psdBtn.focus();\n        }, 40);\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TSaveReminderParams) {\n        this.onSaveAsPsd = p.onSaveAsPsd;\n        this.isDrawing = p.isDrawing;\n        this.projectStore = p.projectStore;\n        this.getProject = p.getProject;\n        this.onStored = p.onStored;\n        this.applyUncommitted = p.applyUncommitted;\n        this.klHistory = p.klHistory;\n\n        this.setting =\n            (LocalStorage.getItem(LS_REMINDER_KEY) as TSaveReminderSetting | null) ?? '40min';\n    }\n\n    init(): void {\n        if (this.lastSavedHistoryIndex !== undefined) {\n            // already initialized\n            return;\n        }\n        this.lastSavedHistoryIndex = this.klHistory.getTotalIndex();\n        this.lastReminderShownAt = performance.now();\n        this.lastSavedAt = performance.now();\n\n        setInterval(() => {\n            if (document.visibilityState !== 'visible') {\n                return;\n            }\n\n            const unsavedActions = Math.abs(\n                this.klHistory.getTotalIndex() - this.lastSavedHistoryIndex!,\n            );\n\n            const timeLimitMs =\n                DEBUG_TIME_LIMIT_MS ??\n                1000 *\n                    60 *\n                    {\n                        '20min': 20,\n                        '40min': 40,\n                        disabled: 0,\n                    }[this.setting];\n\n            if (\n                timeLimitMs > 0 &&\n                KL.DIALOG_COUNTER.get() === 0 &&\n                !this.isDrawing() &&\n                this.lastReminderShownAt + timeLimitMs < performance.now() &&\n                unsavedActions >= UNSAVED_ACTIONS_LIMIT\n            ) {\n                this.showPopup();\n            }\n        }, 1000 * 5);\n    }\n\n    reset(): void {\n        if (this.lastSavedHistoryIndex === undefined) {\n            // not initialized\n            return;\n        }\n\n        this.lastSavedHistoryIndex = this.klHistory.getTotalIndex();\n        this.lastReminderShownAt = performance.now();\n        this.lastSavedAt = performance.now();\n        window.onbeforeunload = null;\n\n        if (this.closeFunc) {\n            this.closeFunc();\n        }\n    }\n\n    getSetting(): TSaveReminderSetting {\n        return this.setting;\n    }\n\n    setSetting(setting: TSaveReminderSetting): void {\n        this.setting = setting;\n        LocalStorage.setItem(LS_REMINDER_KEY, this.setting);\n    }\n}\n",null,"import { BB } from '../../bb/bb';\nimport { KL } from '../kl';\nimport { KlCanvas } from '../canvas/kl-canvas';\nimport { TExportType } from '../kl-types';\nimport { saveAs } from '../../bb/base/save-as';\nimport { Psd } from 'ag-psd/dist/psd';\nimport { KL_CONFIG } from '../kl-config';\nimport { canvasToBlob } from '../../bb/base/canvas';\n\nexport class SaveToComputer {\n    private showSaveDialog: boolean = true;\n\n    private async saveImage(\n        canvas: HTMLCanvasElement,\n        filename: string,\n        mimeType: string,\n        showDialog: boolean = false,\n    ): Promise<void> {\n        const blob = await canvasToBlob(canvas, mimeType);\n        await saveAs(blob, filename, showDialog);\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(\n        private getExportType: () => TExportType,\n        private klCanvas: KlCanvas,\n        private onSaved: () => void,\n    ) {}\n\n    async save(format?: 'psd' | 'layers' | 'png'): Promise<void> {\n        if (!format) {\n            format = this.getExportType();\n        }\n\n        if (format === 'png') {\n            const extension = 'png';\n            const mimeType = 'image/png';\n            const filename = BB.getDate() + KL_CONFIG.filenameBase + '.' + extension;\n            const fullCanvas = this.klCanvas.getCompleteCanvas(1);\n            try {\n                await this.saveImage(fullCanvas, filename, mimeType, this.showSaveDialog);\n            } catch (error) {\n                //fallback for old browsers\n                alert('could not save');\n                throw new Error('failed png export');\n            }\n        } else if (format === 'layers') {\n            const extension = 'png';\n            const mimeType = 'image/png';\n            const fileBase = BB.getDate() + KL_CONFIG.filenameBase;\n            const layerArr = this.klCanvas.getLayersFast();\n            for (let i = 0; i < layerArr.length; i++) {\n                const item = layerArr[i];\n                const fnameArr = [\n                    fileBase,\n                    '_',\n                    ('' + (i + 1)).padStart(2, '0'),\n                    '_',\n                    item.name,\n                    '.',\n                    extension,\n                ];\n                await this.saveImage(item.canvas, fnameArr.join(''), mimeType);\n            }\n        } else if (format === 'psd') {\n            const layerArr = this.klCanvas.getLayersFast();\n\n            const psdConfig: Psd = {\n                width: this.klCanvas.getWidth(),\n                height: this.klCanvas.getHeight(),\n                children: [],\n                canvas: this.klCanvas.getCompleteCanvas(1),\n            };\n            for (let i = 0; i < layerArr.length; i++) {\n                const item = layerArr[i];\n                psdConfig.children!.push({\n                    name: item.name,\n                    hidden: !item.isVisible,\n                    opacity: item.opacity,\n                    canvas: item.canvas,\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n                    left: 0,\n                    top: 0,\n                });\n            }\n\n            KL.loadAgPsd()\n                .then((agPsdLazy) => {\n                    const buffer = agPsdLazy.writePsdBuffer(psdConfig);\n                    const blob = new Blob([buffer], {\n                        type: 'image/vnd.adobe.photoshop',\n                    });\n                    saveAs(\n                        blob,\n                        BB.getDate() + KL_CONFIG.filenameBase + '.psd',\n                        this.showSaveDialog,\n                    );\n                })\n                .catch(() => {\n                    alert('Error: failed to load PSD library');\n                });\n        }\n        this.onSaved();\n    }\n\n    setShowSaveDialog(b: boolean) {\n        this.showSaveDialog = b;\n    }\n}\n","type TFilePickerAcceptType = {\n    description?: string;\n    accept: Record<string, string[]>;\n};\n\ntype TMimeType = string;\nconst types: Record<TMimeType, TFilePickerAcceptType> = {\n    'image/png': {\n        description: 'PNG Image',\n        accept: { 'image/png': ['.png'] },\n    },\n    'image/vnd.adobe.photoshop': {\n        description: 'Adobe Photoshop Document',\n        accept: { 'image/vnd.adobe.photoshop': ['.psd'] },\n    },\n    // jpg etc\n} as const;\n\n// resolves to true if it saves via file picker (or user aborted)\nasync function saveViaFilePicker(blob: Blob, fileName: string): Promise<boolean> {\n    const mimeType = blob.type;\n    if ('showSaveFilePicker' in window) {\n        let fileHandle: FileSystemFileHandle | undefined;\n        if (!types[mimeType]) {\n            console.error('unknown mime type:', mimeType);\n            return false;\n        }\n        try {\n            fileHandle = await (window.showSaveFilePicker as any)({\n                suggestedName: fileName,\n                types: [types[mimeType]],\n            });\n        } catch (e) {\n            if (e instanceof Error && e.name === 'AbortError') {\n                // cancelled dialog\n                return true;\n            }\n            console.log('unpredicted error', e);\n            return false;\n        }\n        if (!fileHandle) {\n            return false;\n        }\n        const writableStream = await fileHandle.createWritable();\n        await writableStream.write(blob);\n        await writableStream.close();\n        return true;\n    } else {\n        return false;\n    }\n}\n\nexport async function saveAs(\n    blob: Blob,\n    fileName: string,\n    showDialog: boolean = false,\n): Promise<void> {\n    if (showDialog && (await saveViaFilePicker(blob, fileName))) {\n        return;\n    }\n\n    // Namespace is used to prevent conflict w/ Chrome Poper Blocker extension (Issue https://github.com/eligrey/FileSaver.js/issues/561)\n    const a = document.createElementNS('http://www.w3.org/1999/xhtml', 'a') as HTMLAnchorElement;\n    a.download = fileName;\n    a.rel = 'noopener';\n    const objectUrl = URL.createObjectURL(blob);\n    a.href = objectUrl;\n\n    setTimeout(() => URL.revokeObjectURL(objectUrl), 40 /* sec */ * 1000);\n    setTimeout(() => {\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n    }, 1);\n}\n","type TKlConfig = {\n    filenameBase: string; // part of filename when downloading drawing\n    disableAutoFit?: boolean;\n};\n\nexport const KL_CONFIG: TKlConfig = {\n    filenameBase: 'Klecks',\n};\n","import { TRgb, TSliderConfig } from '../kl-types';\n\nexport type TBrushSettingEmit =\n    | { type: 'color'; value: TRgb }\n    | { type: 'opacity'; value: number }\n    | { type: 'size'; value: number }\n    | { type: 'scatter'; value: number }\n    | { type: 'sliderConfig'; value: TSliderConfig };\n\nexport type TBrushSettingSubscriber = (p: TBrushSettingEmit) => void;\n\nexport type TBrushSettingServiceParams = {\n    onSetColor: (rgb: TRgb) => void;\n    onSetSize: (size: number) => void;\n    onSetOpacity: (opacity: number) => void;\n    onSetScatter: (scatter: number) => void;\n    onGetColor: () => TRgb;\n    onGetSize: () => number;\n    onGetOpacity: () => number;\n    onGetScatter: () => number;\n    onGetSliderConfig: () => TSliderConfig;\n};\n\n/**\n * Central place to update brush settings, and to subscribe to changes.\n */\nexport class BrushSettingService {\n    private static instance: BrushSettingService;\n    subscriberArr: TBrushSettingSubscriber[] = [];\n\n    // from params\n    private readonly onSetColor: (rgb: TRgb) => void;\n    private readonly onSetSize: (size: number) => void;\n    private readonly onSetOpacity: (opacity: number) => void;\n    private readonly onSetScatter: (scatter: number) => void;\n    private readonly onGetColor: () => TRgb;\n    private readonly onGetSize: () => number;\n    private readonly onGetOpacity: () => number;\n    private readonly onGetScatter: () => number;\n    private readonly onGetSliderConfig: () => TSliderConfig;\n\n    private emit(obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (this.subscriberArr[i] === skipSubscriber) {\n                continue;\n            }\n            this.subscriberArr[i](obj);\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: TBrushSettingServiceParams) {\n        this.onSetColor = p.onSetColor;\n        this.onSetSize = p.onSetSize;\n        this.onSetOpacity = p.onSetOpacity;\n        this.onSetScatter = p.onSetScatter;\n        this.onGetColor = p.onGetColor;\n        this.onGetSize = p.onGetSize;\n        this.onGetOpacity = p.onGetOpacity;\n        this.onGetScatter = p.onGetScatter;\n        this.onGetSliderConfig = p.onGetSliderConfig;\n\n        if (BrushSettingService.instance) {\n            throw new Error('BrushSettingService already instantiated');\n        }\n        BrushSettingService.instance = this;\n    }\n\n    emitColor(color: TRgb, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'color',\n                value: color,\n            },\n            skipSubscriber,\n        );\n    }\n\n    emitSize(size: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'size',\n                value: size,\n            },\n            skipSubscriber,\n        );\n    }\n\n    emitOpacity(opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'opacity',\n                value: opacity,\n            },\n            skipSubscriber,\n        );\n    }\n\n    emitScatter(scatter: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'scatter',\n                value: scatter,\n            },\n            skipSubscriber,\n        );\n    }\n\n    emitSliderConfig(sliderConfig: TSliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\n        this.emit(\n            {\n                type: 'sliderConfig',\n                value: sliderConfig,\n            },\n            skipSubscriber,\n        );\n    }\n\n    /**\n     * set current brush color\n     * @param color\n     * @param skipSubscriber\n     */\n    setColor(color: TRgb, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetColor(color);\n        this.emitColor(color, skipSubscriber);\n    }\n\n    /**\n     * set current brush size\n     * @param size\n     * @param skipSubscriber\n     */\n    setSize(size: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetSize(size);\n        // why not emitting?\n    }\n\n    /**\n     * set current opacity\n     * @param opacity\n     * @param skipSubscriber\n     */\n    setOpacity(opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetOpacity(opacity);\n        // why not emitting?\n    }\n\n    /**\n     * set current scatter\n     * @param scatter\n     * @param skipSubscriber\n     */\n    setScatter(scatter: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetScatter(scatter);\n        // why not emitting?\n    }\n\n    /**\n     * get current brush color\n     */\n    getColor(): TRgb {\n        return this.onGetColor();\n    }\n\n    getSize(): number {\n        return this.onGetSize();\n    }\n\n    getOpacity(): number {\n        return this.onGetOpacity();\n    }\n\n    getScatter(): number {\n        return this.onGetScatter();\n    }\n\n    getSliderConfig(): TSliderConfig {\n        return this.onGetSliderConfig();\n    }\n\n    /**\n     * subscribe to changes\n     * @param func\n     */\n    subscribe(func: TBrushSettingSubscriber): void {\n        if (this.subscriberArr.includes(func)) {\n            return;\n        }\n        this.subscriberArr.push(func);\n    }\n\n    unsubscribe(func: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (func === this.subscriberArr[i]) {\n                this.subscriberArr.splice(i, 1);\n                i--;\n            }\n        }\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { LANG, LANGUAGE_STRINGS, LS_LANGUAGE_KEY } from '../../../language/language';\nimport { KL } from '../../kl';\nimport { languages } from '../../../../languages/languages';\nimport bitbofLogoImg from 'url:/src/app/img/bitbof-logo.svg';\nimport klecksLogoImg from 'url:/src/app/img/klecks-logo.png';\nimport uiSwapImg from 'url:/src/app/img/ui/ui-swap-lr.svg';\nimport { LocalStorage } from '../../../bb/base/local-storage';\nimport { THEME, TTheme } from '../../../theme/theme';\nimport { addIsDarkListener, css, nullToUndefined } from '../../../bb/base/base';\nimport { showLicensesDialog } from '../modals/licenses-dialog/show-licenses-dialog';\nimport { c } from '../../../bb/base/c';\nimport { SaveReminder } from '../components/save-reminder';\nimport { showModal } from '../modals/base/showModal';\nimport { createImage } from '../../../bb/base/ui';\n\nexport type TSettingsUiParams = {\n    onLeftRight: () => void;\n    saveReminder: SaveReminder | undefined;\n    customAbout?: HTMLElement;\n};\n\nexport class SettingsUi {\n    private readonly rootEl: HTMLElement;\n\n    // ----------------------------------- public -----------------------------------\n    constructor({ onLeftRight, saveReminder, customAbout }: TSettingsUiParams) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n\n        // ---- language ----\n        const autoLanguage = LANGUAGE_STRINGS.getAutoLanguage();\n\n        const langWrapper = BB.el({\n            parent: this.rootEl,\n            content: BB.el({\n                content: LANG('settings-language') + ':',\n                css: {\n                    marginRight: '5px',\n                    marginBottom: '2px',\n                },\n            }),\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                flexWrap: 'wrap',\n            },\n        });\n\n        const options: [string, string][] = [\n            ['auto', LANG('auto') + `  ${autoLanguage.name} (${autoLanguage.code})`] as [\n                string,\n                string,\n            ],\n            ...languages.map((item) => {\n                return [item.code, item.name + ` (${item.code})`] as [string, string];\n            }),\n        ];\n        const languageSelect = new KL.Select({\n            initValue: nullToUndefined(\n                LocalStorage.getItem(LS_LANGUAGE_KEY)\n                    ? LocalStorage.getItem(LS_LANGUAGE_KEY)\n                    : 'auto',\n            ),\n            optionArr: options,\n            onChange: (val) => {\n                if (val === 'auto') {\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\n                } else {\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\n                }\n                languageHint.style.display = 'block';\n            },\n            name: 'language',\n        });\n        css(languageSelect.getElement(), {\n            flexGrow: '1',\n        });\n        const languageHint = BB.el({\n            className: 'kl-toolspace-note',\n            content: LANG('settings-language-reload'),\n            css: {\n                display: 'none',\n                marginTop: '5px',\n                flexGrow: '1',\n            },\n        });\n\n        langWrapper.append(languageSelect.getElement(), languageHint);\n\n        // ---- theme ----\n        function themeToLabel(theme: TTheme): string {\n            return theme === 'dark' ? ' ' + LANG('theme-dark') : ' ' + LANG('theme-light');\n        }\n        const themeSelect = new KL.Select({\n            optionArr: [\n                ['auto', LANG('auto') + '  ' + themeToLabel(THEME.getMediaQueryTheme())],\n                ['light', themeToLabel('light')],\n                ['dark', themeToLabel('dark')],\n            ],\n            initValue: THEME.getStoredTheme() || 'auto',\n            onChange: (val): void => {\n                THEME.setStoredTheme(val === 'auto' ? undefined : val);\n            },\n            name: 'ui-theme',\n        });\n        css(themeSelect.getElement(), {\n            flexGrow: '1',\n        });\n        addIsDarkListener(() => {\n            themeSelect.updateLabel(\n                'auto',\n                LANG('auto') + '  ' + themeToLabel(THEME.getMediaQueryTheme()),\n            );\n        });\n        BB.el({\n            parent: this.rootEl,\n            content: [\n                BB.el({\n                    content: LANG('settings-theme') + ':',\n                    css: {\n                        marginRight: '5px',\n                        marginBottom: '2px',\n                    },\n                }),\n                themeSelect.getElement(),\n            ],\n            css: {\n                marginTop: '15px',\n                display: 'flex',\n                alignItems: 'center',\n                flexWrap: 'wrap',\n            },\n        });\n\n        // ---- save reminder ----\n        if (saveReminder) {\n            const reminderSelect = new KL.Select({\n                optionArr: [\n                    ['20min', LANG('x-minutes', { x: '20' })],\n                    ['40min', LANG('x-minutes', { x: '40' })],\n                    ['disabled', ' ' + LANG('settings-save-reminder-disabled')],\n                ],\n                initValue: saveReminder.getSetting(),\n                onChange: (val) => {\n                    if (val !== 'disabled') {\n                        saveReminder.setSetting(val);\n                        return;\n                    }\n                    const disableStr = LANG('settings-save-reminder-confirm-disable');\n                    showModal({\n                        target: document.body,\n                        message: '' + LANG('settings-save-reminder-confirm-title'),\n                        div: c('', [\n                            c('.info-hint', LANG('settings-save-reminder-confirm-a')),\n                            LANG('settings-save-reminder-confirm-b'),\n                        ]),\n                        buttons: [disableStr, 'Cancel'],\n                        callback: (result) => {\n                            if (result === disableStr) {\n                                saveReminder.setSetting(val);\n                            } else {\n                                reminderSelect.setValue(saveReminder.getSetting());\n                            }\n                        },\n                    });\n                },\n                name: 'save-reminder-interval',\n            });\n            reminderSelect.getElement().style.flexGrow = '1';\n\n            this.rootEl.append(\n                c(',flex,items-center,gap-5,mt-15,flexWrap', [\n                    LANG('settings-save-reminder-label') + ':',\n                    reminderSelect.getElement(),\n                ]),\n            );\n        }\n\n        // ---- flip ui ----\n        BB.el({\n            tagName: 'button',\n            parent: this.rootEl,\n            content: [\n                createImage({\n                    alt: 'icon',\n                    src: uiSwapImg,\n                    width: 18,\n                    height: 20,\n                    css: {\n                        marginRight: '5px',\n                    },\n                }),\n                LANG('switch-ui-left-right'),\n            ],\n            onClick: () => onLeftRight(),\n            css: {\n                marginTop: '15px',\n            },\n            custom: {\n                tabIndex: '-1',\n            },\n        });\n\n        // ---- about ----\n        this.rootEl.append(BB.el({ className: 'grid-hr', css: { margin: '10px 0' } }));\n\n        function makeLicenses() {\n            return BB.el({\n                tagName: 'a',\n                content: LANG('licenses'),\n                onClick: () => showLicensesDialog(),\n            });\n        }\n\n        if (customAbout) {\n            this.rootEl.append(customAbout);\n            if (!customAbout.innerHTML) {\n                const minimalAbout = BB.el({\n                    parent: customAbout,\n                    css: {\n                        textAlign: 'center',\n                    },\n                });\n                minimalAbout.append(\n                    BB.el({\n                        content: [\n                            createImage({\n                                alt: 'icon',\n                                height: 20,\n                                src: bitbofLogoImg,\n                                css: {\n                                    verticalAlign: 'middle',\n                                },\n                            }),\n                            ' ',\n                            BB.el({\n                                tagName: 'a',\n                                content: 'bitbof',\n                                custom: {\n                                    href: 'https://bitbof.com',\n                                    target: '_blank',\n                                    tabIndex: '-1',\n                                },\n                            }),\n                            '  2025',\n                            BB.el({ tagName: 'br' }),\n                        ],\n                    }),\n                    makeLicenses(),\n                );\n            }\n        } else {\n            const versionEl = BB.el({\n                parent: this.rootEl,\n                css: {\n                    textAlign: 'center',\n                },\n                content: [\n                    createImage({\n                        alt: 'Klecks',\n                        className: 'dark-invert',\n                        height: 25,\n                        src: klecksLogoImg,\n                    }),\n                    BB.el({ tagName: 'br' }),\n                    createImage({\n                        alt: 'icon',\n                        height: 20,\n                        src: bitbofLogoImg,\n                        css: {\n                            verticalAlign: 'middle',\n                        },\n                    }),\n                    ' ',\n                    BB.el({\n                        tagName: 'a',\n                        content: 'bitbof',\n                        custom: {\n                            href: 'https://bitbof.com',\n                            target: '_blank',\n                            tabIndex: '-1',\n                        },\n                    }),\n                    '  2025',\n                    BB.el({ tagName: 'br' }),\n                ],\n            });\n\n            versionEl.append(\n                makeLicenses(),\n                document.createTextNode(' | '),\n                BB.el({\n                    tagName: 'a',\n                    content: LANG('donate'),\n                    custom: {\n                        href: 'https://kleki.com/donate/',\n                        target: '_blank',\n                    },\n                }),\n                document.createTextNode(' | '),\n                BB.el({\n                    tagName: 'a',\n                    content: LANG('source-code'),\n                    custom: {\n                        href: 'https://klecks.org',\n                        target: '_blank',\n                    },\n                }),\n            );\n        }\n\n        window.addEventListener('storage', (e) => {\n            if (e.key !== LS_LANGUAGE_KEY) {\n                return;\n            }\n            languageSelect.setValue(\n                nullToUndefined(\n                    LocalStorage.getItem(LS_LANGUAGE_KEY)\n                        ? LocalStorage.getItem(LS_LANGUAGE_KEY)\n                        : 'auto',\n                ),\n            );\n        });\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","module.exports = parcelRequire.resolve(\"bitbof-logo.f3f958f4.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"ui-swap-lr.df4af825.svg\") + \"?\" + Date.now();","import { c } from '../../../../bb/base/c';\nimport * as classes from './show-licenses-dialog.module.scss';\nimport { DynamicModal } from '../base/dynamic-modal';\nimport { BB } from '../../../../bb/bb';\nimport { LANG } from '../../../../language/language';\n\nexport function showLicensesDialog() {\n    const libraries = c('.' + classes.licenses, LANG('loading'));\n    const fonts = c('.' + classes.licenses, LANG('loading'));\n\n    const content = c(',flex,flexCol,gap-10', [libraries, fonts]);\n\n    new DynamicModal({\n        title: BB.el({\n            content: LANG('licenses'),\n        }),\n        content: BB.el({\n            content,\n            css: {\n                height: '100%',\n                overflowY: 'auto',\n                padding: '10px',\n                boxSizing: 'border-box',\n            },\n        }),\n        width: 800,\n        isMaxHeight: true,\n        onClose: () => {\n            if (window.location.hash === '#licenses') {\n                history.replaceState(\n                    '',\n                    document.title,\n                    window.location.pathname + window.location.search,\n                );\n            }\n        },\n    });\n\n    import('./licenses').then((result) => {\n        libraries.innerHTML = '';\n        result.LICENSES.forEach((item) => {\n            libraries.append(\n                c('details', [c('summary', item.title), c('', item.full.replace(/\\n/g, '<br>'))]),\n            );\n        });\n    });\n\n    import('../../../../../fonts/font-licenses').then((result) => {\n        fonts.innerHTML = '';\n        result.FONT_LICENSES.forEach((item) => {\n            fonts.append(\n                c('details', [\n                    c('summary', 'Font: ' + item.title),\n                    c('', item.full.replace(/\\n/g, '<br>')),\n                ]),\n            );\n        });\n    });\n}\n",null,"module.exports = (__parcel__import__(\"./\" + \"licenses.70ce967d.js\")).then(() => parcelRequire('iZDwU'));","module.exports = (__parcel__import__(\"./\" + \"font-licenses.44a33bed.js\")).then(() => parcelRequire('02i01'));","import { BB } from '../../../bb/bb';\nimport { LANG } from '../../../language/language';\nimport { DIALOG_COUNTER } from '../modals/modal-count';\nimport { css } from '../../../bb/base/base';\n\n/**\n * Scroll buttons at the top and bottom of toolspace\n * Show up when window is very small.\n * Allow user to scroll up and down toolspace.\n */\nexport class ToolspaceScroller {\n    private readonly toolspace: HTMLElement;\n    private readonly upBtn: HTMLElement;\n    private readonly downBtn: HTMLElement;\n    private downInterval: any;\n    private upInterval: any;\n\n    private update(): void {\n        let newUpDisplay = this.upBtn.style.display;\n        let newDownDisplay = this.downBtn.style.display;\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) {\n            // small buffer where it's not worth it\n            if (!this.upInterval) {\n                newUpDisplay = this.toolspace.scrollTop === 0 ? 'none' : 'block';\n            }\n            if (!this.downInterval) {\n                newDownDisplay =\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >=\n                    this.toolspace.scrollHeight\n                        ? 'none'\n                        : 'block';\n            }\n        } else {\n            newUpDisplay = 'none';\n            newDownDisplay = 'none';\n        }\n        // check to prevent infinite MutationObserver loop in Pale Moon\n        if (newUpDisplay !== this.upBtn.style.display) {\n            this.upBtn.style.display = newUpDisplay;\n        }\n        if (newDownDisplay !== this.downBtn.style.display) {\n            this.downBtn.style.display = newDownDisplay;\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: { toolspace: HTMLElement; uiState: 'left' | 'right' }) {\n        this.toolspace = p.toolspace;\n        this.upBtn = BB.el({\n            parent: this.toolspace,\n            title: LANG('scroll'),\n            className: 'kl-scroller',\n            css: {\n                top: '0',\n                transform: 'rotate(180deg)',\n            },\n        });\n        this.downBtn = BB.el({\n            parent: this.toolspace,\n            title: LANG('scroll'),\n            className: 'kl-scroller',\n            css: {\n                bottom: '0',\n            },\n        });\n        this.updateUiState(p.uiState);\n\n        const upListener = new BB.PointerListener({\n            target: this.upBtn,\n            onPointer: (e) => {\n                if (e.type === 'pointerdown') {\n                    this.upInterval = setInterval(() => {\n                        this.toolspace.scrollBy(0, -13);\n                        this.update();\n                    }, 20);\n                }\n                if (e.type === 'pointerup') {\n                    clearInterval(this.upInterval);\n                    setTimeout(() => {\n                        // prevent ff pressing anything underneath\n                        this.upInterval = null;\n                        this.update();\n                    }, 50);\n                }\n            },\n        });\n        const downListener = new BB.PointerListener({\n            target: this.downBtn,\n            onPointer: (e) => {\n                if (e.type === 'pointerdown') {\n                    this.downInterval = setInterval(() => {\n                        this.toolspace.scrollBy(0, 13);\n                        this.update();\n                    }, 20);\n                }\n                if (e.type === 'pointerup') {\n                    clearInterval(this.downInterval);\n                    setTimeout(() => {\n                        // prevent ff pressing anything underneath\n                        this.downInterval = null;\n                        this.update();\n                    }, 50);\n                }\n            },\n        });\n\n        const wheelListener = (e: WheelEvent) => {\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\n            this.update();\n        };\n        this.upBtn.addEventListener('wheel', wheelListener, { passive: false });\n        this.downBtn.addEventListener('wheel', wheelListener, { passive: false });\n\n        this.update();\n\n        const observer = new MutationObserver(() => this.update());\n        observer.observe(this.toolspace, {\n            attributes: true,\n            childList: true,\n            subtree: true,\n        });\n        window.addEventListener('resize', () => this.update());\n\n        // hide if in dialog because that can have its own scrollbar\n        DIALOG_COUNTER.subscribe((v) => {\n            // ignores the 0.5 by tool dropdown\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\n        });\n    }\n\n    updateUiState(uiState: 'left' | 'right'): void {\n        css(this.upBtn, {\n            left: uiState === 'left' ? '0' : '',\n            right: uiState === 'right' ? '0' : '',\n        });\n        css(this.downBtn, {\n            left: uiState === 'left' ? '0' : '',\n            right: uiState === 'right' ? '0' : '',\n        });\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { KlSlider } from '../components/kl-slider';\nimport { LANG } from '../../../language/language';\nimport { Checkbox } from '../components/checkbox';\nimport { Options } from '../components/options';\nimport { TGradientType } from '../../kl-types';\nimport { KlColorSlider } from '../components/kl-color-slider';\nimport { css } from '../../../bb/base/base';\n\ntype TGradientUiSettings = {\n    opacity: number;\n    type: TGradientType;\n    doLockAlpha: boolean;\n    doSnap: boolean;\n    isReversed: boolean;\n    isEraser: boolean;\n};\n\n/**\n * Gradient Tool tab contents\n *\n * @param p\n * @constructor\n */\nexport class GradientUi {\n    private readonly rootEl: HTMLElement;\n    private colorDiv: HTMLElement;\n    private colorSlider: KlColorSlider;\n    private isVisible: boolean;\n    private readonly iconArr: HTMLElement[];\n\n    private settings: TGradientUiSettings = {\n        opacity: 1,\n        type: 'linear',\n        doLockAlpha: false,\n        doSnap: false,\n        isReversed: false,\n        isEraser: false,\n    };\n\n    private updateIcons(): void {\n        const col1 = this.settings.isReversed ? '#0000' : '#000';\n        const col2 = this.settings.isReversed ? '#000' : '#0000';\n        this.iconArr[0].style.background = `linear-gradient(${col1}, ${col2})`;\n        this.iconArr[1].style.background = `linear-gradient(${col2}, ${col1}, ${col2})`;\n        this.iconArr[2].style.background = `radial-gradient(${col1}, ${col2})`;\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: {\n        colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n    }) {\n        this.colorSlider = p.colorSlider;\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.isVisible = true;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        this.iconArr = [];\n        {\n            const size = 33;\n            [0, 1, 2].forEach(() => {\n                const el = BB.el({\n                    className: 'dark-invert',\n                    css: {\n                        width: size + 'px',\n                        height: size + 'px',\n                        borderRadius: '3px',\n                        margin: '1px',\n                    },\n                });\n                this.iconArr.push(el);\n            });\n        }\n        this.updateIcons();\n\n        const typeOptions = new Options<TGradientType>({\n            optionArr: [\n                {\n                    id: 'linear',\n                    label: this.iconArr[0],\n                    title: LANG('gradient-linear'),\n                },\n                {\n                    id: 'linear-mirror',\n                    label: this.iconArr[1],\n                    title: LANG('gradient-linear-mirror'),\n                },\n                {\n                    id: 'radial',\n                    label: this.iconArr[2],\n                    title: LANG('gradient-radial'),\n                },\n            ],\n            initId: 'linear',\n            onChange: (id) => {\n                this.settings.type = id;\n            },\n        });\n        this.rootEl.append(typeOptions.getElement());\n\n        const opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 250,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: this.settings.opacity,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: (val) => {\n                this.settings.opacity = val;\n            },\n        });\n        css(opacitySlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(opacitySlider.getElement());\n\n        const row1 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n            },\n        });\n\n        const reverseToggle = new Checkbox({\n            init: false,\n            label: LANG('reverse'),\n            callback: (b) => {\n                this.settings.isReversed = b;\n                this.updateIcons();\n            },\n            css: {\n                width: '50%',\n            },\n            name: 'reverse-gradient',\n        });\n\n        const doSnapToggle = new Checkbox({\n            init: false,\n            label: LANG('angle-snap'),\n            title: LANG('angle-snap-title'),\n            callback: (b) => {\n                this.settings.doSnap = b;\n            },\n            css: {\n                width: '50%',\n            },\n            name: 'enable-snapping',\n        });\n\n        row1.append(reverseToggle.getElement(), doSnapToggle.getElement());\n\n        const row2 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n            },\n        });\n\n        const eraserToggle = new Checkbox({\n            init: this.settings.isEraser,\n            label: LANG('eraser'),\n            callback: (b) => {\n                this.settings.isEraser = b;\n            },\n            css: {\n                width: '50%',\n            },\n            name: 'enable-eraser',\n        });\n\n        const lockAlphaToggle = new Checkbox({\n            init: false,\n            label: LANG('lock-alpha'),\n            title: LANG('lock-alpha-title'),\n            callback: (b) => {\n                this.settings.doLockAlpha = b;\n            },\n            doHighlight: true,\n            css: {\n                width: '50%',\n            },\n            name: 'enable-alpha-lock',\n        });\n\n        row2.append(eraserToggle.getElement(), lockAlphaToggle.getElement());\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible(isVisible: boolean): void {\n        this.isVisible = isVisible;\n        this.rootEl.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            this.colorDiv.append(\n                this.colorSlider.getElement(),\n                this.colorSlider.getOutputElement(),\n            );\n        }\n    }\n\n    getSettings(): TGradientUiSettings {\n        return BB.copyObj(this.settings);\n    }\n}\n","import { BB } from '../bb/bb';\nimport uiSwapImg from 'url:/src/app/img/ui/ui-swap-lr.svg';\nimport helpImg from 'url:/src/app/img/ui/help.svg';\nimport { LANG } from '../language/language';\nimport { PointerListener } from '../bb/input/pointer-listener';\n\n/**\n * Topmost row of buttons in toolspace. (embed)\n *\n * @param p\n * @constructor\n */\nexport class EmbedToolspaceTopRow {\n    private readonly rootEl: HTMLElement;\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: { onSubmit: () => void; onLeftRight: () => void; onHelp: () => void }) {\n        this.rootEl = BB.el({\n            className: 'kl-toolspace-row',\n            css: {\n                height: '36px',\n                display: 'flex',\n            },\n        });\n\n        function createButton(p: {\n            title: string;\n            content?: HTMLElement;\n            image?: string;\n            onClick: () => void;\n            extraPadding?: number;\n            contain: boolean;\n        }): {\n            el: HTMLElement;\n            pointerListener: PointerListener;\n        } {\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            const el = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.content ? '' : p.contain ? padding + 'px 0' : '',\n                },\n            });\n            if (p.content) {\n                el.append(p.content);\n            } else {\n                const im = BB.el({\n                    className: 'dark-invert',\n                    css: {\n                        backgroundImage: \"url('\" + p.image + \"')\",\n                        backgroundRepeat: 'no-repeat',\n                        backgroundPosition: 'center',\n                        backgroundSize: p.contain ? 'contain' : '',\n                        //filter: 'grayscale(1)',\n                        height: '100%',\n                    },\n                });\n                im.style.pointerEvents = 'none';\n                el.append(im);\n            }\n            const pointerListener = new BB.PointerListener({\n                // because :hover causes problems w touch\n                target: el,\n                onEnterLeave: function (isOver): void {\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\n                },\n            });\n\n            return {\n                el,\n                pointerListener,\n            };\n        }\n\n        const submitButton = createButton({\n            onClick: p.onSubmit,\n            title: LANG('submit-title'),\n            content: BB.el({\n                content: LANG('submit'),\n                className: 'toolspace-row-button__submit',\n                css: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    width: '100%',\n                    height: '100%',\n                },\n            }),\n            contain: true,\n        });\n        submitButton.el.style.width = '45px';\n\n        const helpButton = createButton({\n            onClick: p.onHelp,\n            title: LANG('help'),\n            image: helpImg,\n            contain: true,\n        });\n\n        const leftRightButton = createButton({\n            onClick: p.onLeftRight,\n            title: LANG('switch-ui-left-right'),\n            image: uiSwapImg,\n            contain: true,\n        });\n\n        this.rootEl.append(submitButton.el, leftRightButton.el, helpButton.el);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","import { FILTER_LIB, FILTER_LIB_STATUS } from './filters';\nimport { filterBrightnessContrast } from './filter-brightness-contrast';\nimport { filterCropExtend } from './filter-crop-extend';\nimport { filterCurves } from './filter-curves';\nimport { filterFlip } from './filter-flip';\nimport { filterHueSaturation } from './filter-hue-saturation';\nimport { filterInvert } from './filter-invert';\nimport { filterPerspective } from './filter-perspective';\nimport { filterResize } from './filter-resize';\nimport { filterRotate } from './filter-rotate';\nimport { filterTiltShift } from './filter-tilt-shift';\nimport { filterTransform } from './filter-transform';\nimport { filterBlur } from './filter-blur';\nimport { filterUnsharpMask } from './filter-unsharp-mask';\nimport { filterToAlpha } from './filter-to-alpha';\nimport { filterGrid } from './filter-grid';\nimport { filterNoise } from './filter-noise';\nimport { filterPattern } from './filter-pattern';\nimport { filterDistort } from './filter-distort';\nimport { filterVanishPoint } from './filter-vanish-point';\nimport { TFilter } from '../kl-types';\n\ntype TModuleFilter = Pick<TFilter, 'getDialog' | 'apply'>;\n\nfunction importFilter(libObj: TFilter, moduleObj: TModuleFilter): void {\n    if (moduleObj.getDialog) {\n        libObj.getDialog = moduleObj.getDialog;\n    }\n    libObj.apply = moduleObj.apply;\n}\n\nexport function importFilters(): void {\n    if (FILTER_LIB_STATUS.isLoaded) {\n        return;\n    }\n    importFilter(FILTER_LIB.brightnessContrast, filterBrightnessContrast as TModuleFilter);\n    importFilter(FILTER_LIB.cropExtend, filterCropExtend as TModuleFilter);\n    importFilter(FILTER_LIB.curves, filterCurves as TModuleFilter);\n    importFilter(FILTER_LIB.flip, filterFlip as TModuleFilter);\n    importFilter(FILTER_LIB.hueSaturation, filterHueSaturation as TModuleFilter);\n    importFilter(FILTER_LIB.invert, filterInvert as TModuleFilter);\n    importFilter(FILTER_LIB.perspective, filterPerspective as TModuleFilter);\n    importFilter(FILTER_LIB.resize, filterResize as TModuleFilter);\n    importFilter(FILTER_LIB.rotate, filterRotate as TModuleFilter);\n    importFilter(FILTER_LIB.tiltShift, filterTiltShift as TModuleFilter);\n    importFilter(FILTER_LIB.transform, filterTransform as TModuleFilter);\n    importFilter(FILTER_LIB.blur, filterBlur as TModuleFilter);\n    importFilter(FILTER_LIB.unsharpMask, filterUnsharpMask as TModuleFilter);\n    importFilter(FILTER_LIB.toAlpha, filterToAlpha as TModuleFilter);\n    importFilter(FILTER_LIB.grid, filterGrid as TModuleFilter);\n    importFilter(FILTER_LIB.noise, filterNoise as TModuleFilter);\n    importFilter(FILTER_LIB.pattern, filterPattern as TModuleFilter);\n    importFilter(FILTER_LIB.distort, filterDistort as TModuleFilter);\n    importFilter(FILTER_LIB.vanishPoint, filterVanishPoint as TModuleFilter);\n\n    FILTER_LIB_STATUS.isLoaded = true;\n}\n","import { KlSlider } from '../ui/components/kl-slider';\nimport { EVENT_RES_MS } from './filters-consts';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { FxPreviewRenderer } from '../ui/project-viewport/fx-preview-renderer';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { BB } from '../../bb/bb';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth } from '../ui/utils/preview-size';\nimport { applyFxFilter } from './apply-fx-filter';\nimport { css } from '../../bb/base/base';\n\nexport type TFilterBrightnessContrastInput = {\n    brightness: number;\n    contrast: number;\n};\n\nexport const filterBrightnessContrast = {\n    getDialog(params: TFilterGetDialogParam) {\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterBrightnessContrastInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let brightness = 0,\n            contrast = 0;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas) => {\n                return fxCanvas.brightnessContrast(brightness, contrast);\n            },\n            selection: klCanvas.getSelection(),\n        });\n\n        const brightnessSlider = new KlSlider({\n            label: LANG('filter-bright-contrast-brightness'),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 100,\n            value: (brightness + 1) * 50,\n            eventResMs: EVENT_RES_MS,\n            onChange: function (val) {\n                brightness = val / 50 - 1;\n                preview.render();\n            },\n        });\n        const contrastSlider = new KlSlider({\n            label: LANG('filter-bright-contrast-contrast'),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 100,\n            value: (contrast + 1) * 50,\n            eventResMs: EVENT_RES_MS,\n            onChange: function (val) {\n                contrast = val / 50 - 1;\n                preview.render();\n            },\n        });\n        brightnessSlider.getElement().style.marginBottom = '10px';\n        contrastSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(brightnessSlider.getElement(), contrastSlider.getElement());\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image:\n                        i === selectedLayerIndex\n                            ? fxPreviewRenderer.render\n                            : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            selection: klCanvas.getSelection(),\n        });\n        preview.render();\n        css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n        rootEl.append(preview.getElement());\n\n        result.destroy = () => {\n            brightnessSlider.destroy();\n            contrastSlider.destroy();\n            fxPreviewRenderer.destroy();\n            preview.destroy();\n        };\n        result.getInput = function (): TFilterBrightnessContrastInput {\n            result.destroy!();\n            return {\n                brightness: brightness,\n                contrast: contrast,\n            };\n        };\n\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterBrightnessContrastInput>): boolean {\n        const context = params.layer.context;\n        const brightness = params.input.brightness;\n        const contrast = params.input.contrast;\n        const klHistory = params.klHistory;\n        if (!context) {\n            return false;\n        }\n        return applyFxFilter(\n            context,\n            params.klCanvas.getSelection(),\n            (fxCanvas) => {\n                fxCanvas.brightnessContrast(brightness, contrast);\n            },\n            klHistory,\n        );\n    },\n};\n","export const EVENT_RES_MS = 60;\n","import { TFxCanvas, TWrappedTexture } from '../../../fx-canvas/fx-canvas-types';\nimport { TProjectViewportLayerFunc, TViewportTransformXY } from './project-viewport';\nimport { BB } from '../../../bb/bb';\nimport { getSharedFx } from '../../../fx-canvas/shared-fx';\nimport { throwIfNull } from '../../../bb/base/base';\nimport { TRect } from '../../../bb/bb-types';\nimport { applyToPoint, compose, identity, inverse, scale, translate } from 'transformation-matrix';\nimport { createMatrixFromTransform } from '../../../bb/transform/create-matrix-from-transform';\nimport { matrixToTuple } from '../../../bb/math/matrix-to-tuple';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { drawSelectionMask } from '../../../bb/base/canvas';\nimport { transformMultiPolygon } from '../../../bb/multi-polygon/transform-multi-polygon';\n\ntype TPostMix = {\n    opacity: number;\n    operation: GlobalCompositeOperation;\n};\n\nexport type TFxPreviewRendererParams = {\n    original: Exclude<CanvasImageSource, VideoFrame | HTMLOrSVGImageElement> | HTMLImageElement;\n    onUpdate: (fxCanvas: TFxCanvas, transform: TViewportTransformXY) => TFxCanvas;\n    postMix?: TPostMix; // mix the result with the original\n    selection?: MultiPolygon;\n    isMaskingWithEmptyOriginal?: boolean;\n};\n\nexport class FxPreviewRenderer {\n    private readonly original: TFxPreviewRendererParams['original'];\n    private readonly onUpdate: TFxPreviewRendererParams['onUpdate'];\n    private texture: TWrappedTexture | undefined = undefined;\n    private maskCanvas: HTMLCanvasElement | undefined = undefined; // prevent destroying the mask repeatedly\n    private maskTexture: TWrappedTexture | undefined = undefined;\n    private readonly textureSource: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n    private oldOnUpdateProps = {\n        textureWidth: 0,\n        textureHeight: 0,\n        transform: {\n            scaleX: 0,\n            scaleY: 0,\n            angleDeg: 0,\n            x: 0,\n            y: 0,\n        },\n    };\n    private readonly fxCanvas: TFxCanvas;\n    private postMix: TPostMix | undefined;\n    private readonly selection: MultiPolygon | undefined;\n    private readonly isMaskingWithEmptyOriginal: boolean;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TFxPreviewRendererParams) {\n        this.original = p.original;\n        this.onUpdate = p.onUpdate;\n        this.textureSource = BB.canvas(1, 1);\n        this.ctx = BB.ctx(this.textureSource);\n        this.fxCanvas = throwIfNull(getSharedFx());\n        this.postMix = p.postMix;\n        this.selection = p.selection;\n        this.isMaskingWithEmptyOriginal = !!p.isMaskingWithEmptyOriginal;\n    }\n\n    render: TProjectViewportLayerFunc = (viewportTransform, viewportWidth, viewportHeight) => {\n        const viewportMat = createMatrixFromTransform(viewportTransform);\n        const padding = 0; // render more than visible with padding < 0\n\n        let clippedViewportRect: TRect; // rect in viewport coordinates which contains the canvas\n        let transformMatrix = identity();\n        {\n            const topLeft = applyToPoint(viewportMat, { x: 0, y: 0 });\n            const bottomRight = applyToPoint(viewportMat, {\n                x: this.original.width,\n                y: this.original.height,\n            });\n            bottomRight.x = Math.round(bottomRight.x);\n            bottomRight.y = Math.round(bottomRight.y);\n            const clippedTL = {\n                x: Math.max(padding, topLeft.x),\n                y: Math.max(padding, topLeft.y),\n            };\n            const clippedBR = {\n                x: Math.min(viewportWidth - padding, bottomRight.x),\n                y: Math.min(viewportHeight - padding, bottomRight.y),\n            };\n            clippedViewportRect = {\n                x: clippedTL.x,\n                y: clippedTL.y,\n                width: clippedBR.x - clippedTL.x,\n                height: clippedBR.y - clippedTL.y,\n            };\n\n            if (clippedViewportRect.width <= 0 || clippedViewportRect.height <= 0) {\n                this.textureSource.width = 1;\n                this.textureSource.height = 1;\n                return this.textureSource;\n            }\n        }\n\n        let resultTransform = compose(\n            inverse(viewportMat),\n            translate(padding, padding),\n            translate(clippedViewportRect.x - padding, clippedViewportRect.y - padding),\n        );\n\n        const onUpdateProps = {\n            textureWidth: Math.ceil(clippedViewportRect.width),\n            textureHeight: Math.ceil(clippedViewportRect.height),\n            transform: {\n                scaleX: viewportTransform.scaleX,\n                scaleY: viewportTransform.scaleY,\n                angleDeg: viewportTransform.angleDeg,\n                x: viewportTransform.x - clippedViewportRect.x,\n                y: viewportTransform.y - clippedViewportRect.y,\n            },\n        };\n\n        let tlOffsetX = 0;\n        let tlOffsetY = 0;\n\n        if (viewportTransform.scaleX > 1) {\n            // what pixels of original canvas are actually visible\n            const canvasTopLeft = applyToPoint(resultTransform, { x: 0, y: 0 });\n            tlOffsetX = -canvasTopLeft.x;\n            tlOffsetY = -canvasTopLeft.y;\n            canvasTopLeft.x = Math.max(0, Math.floor(canvasTopLeft.x));\n            canvasTopLeft.y = Math.max(0, Math.floor(canvasTopLeft.y));\n            tlOffsetX += canvasTopLeft.x;\n            tlOffsetY += canvasTopLeft.y;\n\n            const canvasBottomRight = applyToPoint(resultTransform, {\n                x: clippedViewportRect.width,\n                y: clippedViewportRect.height,\n            });\n            canvasBottomRight.x = Math.min(this.original.width, Math.ceil(canvasBottomRight.x));\n            canvasBottomRight.y = Math.min(this.original.height, Math.ceil(canvasBottomRight.y));\n\n            const cw = canvasBottomRight.x - canvasTopLeft.x;\n            const ch = canvasBottomRight.y - canvasTopLeft.y;\n\n            onUpdateProps.textureWidth = cw;\n            onUpdateProps.textureHeight = ch;\n            onUpdateProps.transform = {\n                scaleX: 1,\n                scaleY: 1,\n                angleDeg: 0,\n                x: -canvasTopLeft.x,\n                y: -canvasTopLeft.y,\n            };\n\n            resultTransform = compose(\n                resultTransform,\n                scale(viewportTransform.scaleX, viewportTransform.scaleY),\n                translate(tlOffsetX, tlOffsetY),\n            );\n        }\n\n        if (\n            !this.texture ||\n            JSON.stringify(onUpdateProps) !== JSON.stringify(this.oldOnUpdateProps) ||\n            this.postMix\n        ) {\n            // update texture\n            this.textureSource.width = onUpdateProps.textureWidth;\n            this.textureSource.height = onUpdateProps.textureHeight;\n\n            // draw original canvas into temp\n            this.ctx.save();\n            this.ctx.imageSmoothingEnabled = false;\n            if (viewportTransform.scaleX > 1) {\n                transformMatrix = createMatrixFromTransform(onUpdateProps.transform);\n                this.ctx.setTransform(...matrixToTuple(transformMatrix));\n            } else {\n                transformMatrix = inverse(resultTransform);\n                this.ctx.setTransform(...matrixToTuple(transformMatrix));\n            }\n            this.ctx.drawImage(this.original, 0, 0);\n            this.ctx.restore();\n            // debug\n            /*BB.css(this.canvas, {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                zIndex: '1000',\n                boxShadow: '0 0 0 1px #f00',\n            });\n            document.body.append(this.canvas);*/\n\n            const propsDidChange =\n                JSON.stringify(onUpdateProps) !== JSON.stringify(this.oldOnUpdateProps);\n            if (!this.texture || propsDidChange) {\n                if (this.texture) {\n                    this.texture.loadContentsOf(this.textureSource);\n                } else {\n                    this.texture = this.fxCanvas.texture(this.textureSource);\n                }\n            }\n\n            if (this.selection && (!this.maskTexture || propsDidChange)) {\n                if (!this.maskCanvas) {\n                    this.maskCanvas = BB.canvas(\n                        onUpdateProps.textureWidth,\n                        onUpdateProps.textureHeight,\n                    );\n                } else {\n                    this.maskCanvas.width = onUpdateProps.textureWidth;\n                    this.maskCanvas.height = onUpdateProps.textureHeight;\n                }\n                const ctx = BB.ctx(this.maskCanvas);\n                const transformedSelection = transformMultiPolygon(this.selection, transformMatrix);\n                drawSelectionMask(transformedSelection, ctx);\n                if (this.maskTexture) {\n                    this.maskTexture.loadContentsOf(this.maskCanvas);\n                } else {\n                    this.maskTexture = this.fxCanvas.texture(this.maskCanvas);\n                }\n            }\n\n            if (!this.postMix) {\n                this.textureSource.width = 1;\n                this.textureSource.height = 1;\n            }\n        }\n        this.oldOnUpdateProps = onUpdateProps;\n\n        this.onUpdate(this.fxCanvas.draw(this.texture), onUpdateProps.transform);\n        if (this.maskTexture) {\n            this.fxCanvas\n                .multiplyAlpha()\n                .mask(this.maskTexture, this.isMaskingWithEmptyOriginal ? undefined : this.texture)\n                .unmultiplyAlpha();\n        }\n        this.fxCanvas.update();\n\n        if (this.postMix) {\n            this.ctx.save();\n            this.ctx.globalAlpha = this.postMix.opacity;\n            this.ctx.globalCompositeOperation = this.postMix.operation;\n            this.ctx.drawImage(this.fxCanvas, 0, 0);\n            this.ctx.restore();\n            return {\n                image: this.textureSource,\n                transform: resultTransform,\n            };\n        }\n\n        return {\n            image: this.fxCanvas,\n            transform: resultTransform,\n        };\n    };\n\n    setPostMix(postMix: TPostMix): void {\n        this.postMix = postMix;\n    }\n\n    destroy(): void {\n        BB.freeCanvas(this.textureSource);\n        this.maskCanvas && BB.freeCanvas(this.maskCanvas);\n        if (this.texture) {\n            this.texture = this.fxCanvas.texture(this.textureSource);\n            this.fxCanvas.draw(this.texture).update();\n            this.texture && this.texture.destroy();\n        }\n        // I don't remember why the other texture is destroyed differently.\n        this.maskTexture?.destroy();\n    }\n}\n","import { TFxCanvas, TWrappedTexture } from '../../fx-canvas/fx-canvas-types';\nimport { BB } from '../../bb/bb';\nimport { drawSelectionMask } from '../../bb/base/canvas';\nimport { getPushableLayerChange } from '../history/push-helpers/get-pushable-layer-change';\nimport { canvasToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\nimport { integerBounds } from '../../bb/math/math';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { KlHistory } from '../history/kl-history';\nimport { getSharedFx } from '../../fx-canvas/shared-fx';\n\nexport function applyFxFilter(\n    context: CanvasRenderingContext2D,\n    selection: MultiPolygon | undefined,\n    applyFn: (fxCanvas: TFxCanvas) => void,\n    klHistory: KlHistory,\n): boolean {\n    const fxCanvas = getSharedFx();\n    if (!fxCanvas) {\n        return false; // todo more specific error?\n    }\n\n    let maskTexture: TWrappedTexture | undefined;\n    if (selection) {\n        const maskCanvas = BB.canvas(context.canvas.width, context.canvas.height);\n        const maskContext = BB.ctx(maskCanvas);\n        drawSelectionMask(selection, maskContext);\n        maskTexture = fxCanvas.texture(maskCanvas);\n        BB.freeCanvas(maskCanvas);\n    }\n    const originalTexture = fxCanvas.texture(context.canvas);\n    fxCanvas.draw(originalTexture);\n    applyFn(fxCanvas);\n    if (maskTexture) {\n        fxCanvas.multiplyAlpha().mask(maskTexture, originalTexture).unmultiplyAlpha();\n        maskTexture.destroy();\n    }\n    originalTexture.destroy();\n    fxCanvas.update();\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n    context.drawImage(fxCanvas, 0, 0);\n\n    klHistory.push(\n        getPushableLayerChange(\n            klHistory.getComposed(),\n            canvasToLayerTiles(\n                context.canvas,\n                selection ? integerBounds(getMultiPolyBounds(selection)) : undefined,\n            ),\n        ),\n    );\n    return true;\n}\n","import { BB } from '../../bb/bb';\nimport { input } from '../ui/components/input';\nimport { Checkbox } from '../ui/components/checkbox';\nimport { ColorOptions } from '../ui/components/color-options';\nimport { Cropper } from '../ui/components/cropper';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult, TRgba } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { TRect } from '../../bb/bb-types';\nimport { SMALL_PREVIEW } from '../ui/utils/preview-size';\nimport { integerBounds } from '../../bb/math/math';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\n\nexport type TFilterCropExtendInput = {\n    left: number;\n    right: number;\n    top: number;\n    bottom: number;\n    fillColor?: TRgba;\n};\n\nexport const filterCropExtend = {\n    getDialog(params: TFilterGetDialogParam) {\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) {\n            return false;\n        }\n        const tempCanvas = BB.canvas();\n        {\n            const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\n            const w = parseInt('' + fit.width),\n                h = parseInt('' + fit.height);\n            const previewFactor = w / klCanvas.getWidth();\n            tempCanvas.width = w;\n            tempCanvas.height = h;\n            tempCanvas.style.display = 'block';\n            BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n        }\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterCropExtendInput> = {\n            element: rootEl,\n        };\n        let left = 0,\n            right = 0,\n            top = 0,\n            bottom = 0;\n        let leftChanged = false,\n            rightChanged = false,\n            topChanged = false,\n            bottomChanged = false;\n        const maxWidth = params.maxWidth,\n            maxHeight = params.maxHeight;\n        let scale: number = 1;\n\n        const selection = klCanvas.getSelection();\n        let selectionBounds = selection ? integerBounds(getMultiPolyBounds(selection)) : undefined;\n        if (selectionBounds) {\n            const boundsWidth = selectionBounds.x2 - selectionBounds.x1;\n            const boundsHeight = selectionBounds.y2 - selectionBounds.y1;\n            if (boundsWidth <= maxWidth && boundsHeight <= maxHeight) {\n                top = selectionBounds.y1;\n                right = selectionBounds.x2 - klCanvas.getWidth();\n                bottom = selectionBounds.y2 - klCanvas.getHeight();\n                left = selectionBounds.x1;\n            } else {\n                selectionBounds = undefined;\n            }\n        }\n\n        // --- input elements ---\n        const leftInput = input({\n            init: left,\n            type: 'number',\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: { width: '75px' },\n            callback: function () {\n                leftChanged = true;\n                updateInput();\n            },\n        });\n        const rightInput = input({\n            init: right,\n            type: 'number',\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: { width: '75px' },\n            callback: function () {\n                rightChanged = true;\n                updateInput();\n            },\n        });\n        const topInput = input({\n            init: top,\n            type: 'number',\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: { width: '75px' },\n            callback: function () {\n                topChanged = true;\n                updateInput();\n            },\n        });\n        const bottomInput = input({\n            init: bottom,\n            type: 'number',\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: { width: '75px' },\n            callback: function () {\n                bottomChanged = true;\n                updateInput();\n            },\n        });\n\n        const sharedCss = {\n            display: 'flex',\n            flexDirection: 'column',\n            width: 'calc(50% - 5px)',\n            gap: '3px',\n        };\n        const leftWrapper = BB.el({\n            content: [LANG('filter-crop-left') + ':', leftInput],\n            css: sharedCss,\n        });\n        const rightWrapper = BB.el({\n            content: [LANG('filter-crop-right') + ':', rightInput],\n            css: sharedCss,\n        });\n        const topWrapper = BB.el({\n            content: [LANG('filter-crop-top') + ':', topInput],\n            css: sharedCss,\n        });\n        const bottomWrapper = BB.el({\n            content: [LANG('filter-crop-bottom') + ':', bottomInput],\n            css: sharedCss,\n        });\n        const wrapWrapper = BB.el({\n            css: {\n                display: 'flex',\n                flexWrap: 'wrap',\n                gap: '10px',\n            },\n        });\n        wrapWrapper.append(leftWrapper, rightWrapper, topWrapper, bottomWrapper);\n        rootEl.append(wrapWrapper);\n\n        function updateInput(): void {\n            left = parseInt(leftInput.value);\n            right = parseInt(rightInput.value);\n            top = parseInt(topInput.value);\n            bottom = parseInt(bottomInput.value);\n            let newWidth = klCanvas.getWidth() + left + right;\n            let newHeight = klCanvas.getHeight() + top + bottom;\n\n            if (newWidth <= 0) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + 1;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + 1;\n                    rightInput.value = '' + right;\n                }\n                newWidth = 1;\n            }\n            if (newWidth > maxWidth) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + maxWidth;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + maxWidth;\n                    rightInput.value = '' + right;\n                }\n                newWidth = maxWidth;\n            }\n            if (newHeight <= 0) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + 1;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + 1;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = 1;\n            }\n            if (newHeight > maxHeight) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = maxHeight;\n            }\n            cropper.setTransform({\n                x: -left,\n                y: -top,\n                width: newWidth,\n                height: newHeight,\n            });\n\n            leftChanged = false;\n            rightChanged = false;\n            topChanged = false;\n            bottomChanged = false;\n        }\n\n        let useRuleOfThirds = true;\n        const ruleOThirdsCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-crop-rule-thirds'),\n            allowTab: true,\n            callback: function (b) {\n                useRuleOfThirds = b;\n                cropper.showThirds(useRuleOfThirds);\n            },\n            name: 'rule-of-thirds',\n        });\n        rootEl.append(\n            BB.el({\n                css: {\n                    clear: 'both',\n                },\n            }),\n        );\n\n        let selectedRgbaObj = { r: 0, g: 0, b: 0, a: 0 };\n        const colorOptionsArr = [\n            { r: 0, g: 0, b: 0, a: 0 },\n            { r: 255, g: 255, b: 255, a: 1 },\n            { r: 0, g: 0, b: 0, a: 1 },\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n\n        const colorOptions = new ColorOptions({\n            label: LANG('filter-crop-fill'),\n            colorArr: colorOptionsArr,\n            onChange: function (rgbaObj) {\n                selectedRgbaObj = rgbaObj!;\n                updateBg();\n            },\n        });\n\n        const flexRow = BB.el({\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                marginTop: '10px',\n            },\n        });\n        rootEl.append(flexRow);\n        flexRow.append(ruleOThirdsCheckbox.getElement(), colorOptions.getElement());\n\n        // when input field changed, or dragging in preview finished\n        // adjusts the zoom\n        function update(transform: TRect): void {\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\n            scale = fit.width / transform.width;\n\n            const offset = BB.centerWithin(\n                SMALL_PREVIEW.width,\n                previewHeight,\n                fit.width,\n                fit.height,\n            );\n\n            tempCanvas.style.width = klCanvas.getWidth() * scale + 'px';\n            tempCanvas.style.height = klCanvas.getHeight() * scale + 'px';\n\n            offsetWrapper.style.left = offset.x - transform.x * scale + 'px';\n            offsetWrapper.style.top = offset.y - transform.y * scale + 'px';\n\n            left = parseInt('' + -transform.x);\n            top = parseInt('' + -transform.y);\n            right = parseInt('' + (transform.x + transform.width - klCanvas.getWidth()));\n            bottom = parseInt('' + (transform.y + transform.height - klCanvas.getHeight()));\n            leftInput.value = '' + left;\n            topInput.value = '' + top;\n            rightInput.value = '' + right;\n            bottomInput.value = '' + bottom;\n\n            if (selectedRgbaObj.a !== 0) {\n                tempCanvas.style.background = 'var(--kl-checkerboard-background)';\n                tempCanvas.style.backgroundSize = 100 * scale + 'px';\n            }\n            previewWrapper.style.backgroundPosition = offset.x + 'px ' + offset.y + 'px';\n            previewWrapper.style.backgroundSize = 100 * scale + 'px';\n\n            cropper.setScale(scale);\n        }\n\n        const previewHeight = SMALL_PREVIEW.height - 2; // two less because of border\n        const previewWrapper = BB.el({\n            className: 'kl-edit-crop-preview',\n            css: {\n                width: SMALL_PREVIEW.width + 'px',\n                marginTop: '10px',\n                marginLeft: '-20px',\n                height: previewHeight + 'px',\n                backgroundColor: '#9e9e9e',\n                position: 'relative',\n                borderTop: '1px solid rgb(144,144,144)',\n                borderBottom: '1px solid rgb(144,144,144)',\n                overflow: 'hidden',\n                userSelect: 'none',\n                touchAction: 'none',\n                background: 'var(--kl-checkerboard-background)',\n            },\n        });\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        const bgColorOverlay = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0',\n            },\n        });\n        previewWrapper.append(bgColorOverlay);\n\n        const offsetWrapper = BB.el({\n            parent: previewWrapper,\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n            },\n        });\n\n        BB.el({\n            parent: offsetWrapper,\n            content: tempCanvas,\n            css: {\n                boxShadow: '0 0 0px 1px rgb(130,130,130)',\n                position: 'absolute',\n                left: '0px',\n                top: '0px',\n            },\n        });\n\n        rootEl.append(previewWrapper);\n        const cropper = new Cropper({\n            x: 0,\n            y: 0,\n            width: klCanvas.getWidth(),\n            height: klCanvas.getHeight(),\n            scale: scale,\n            callback: update,\n            maxW: maxWidth,\n            maxH: maxHeight,\n            init: selectionBounds,\n        });\n        update(cropper.getTransform());\n        offsetWrapper.append(cropper.getElement());\n\n        function updateBg(): void {\n            if (selectedRgbaObj.a === 0) {\n                bgColorOverlay.style.background = '';\n                tempCanvas.style.background = '';\n            } else {\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(selectedRgbaObj);\n                tempCanvas.style.background = 'var(--kl-checkerboard-background)';\n                tempCanvas.style.backgroundSize = 100 * scale + 'px';\n            }\n        }\n\n        result.destroy = (): void => {\n            cropper.destroy();\n            ruleOThirdsCheckbox.destroy();\n            colorOptions.destroy();\n        };\n        result.getInput = function (): TFilterCropExtendInput {\n            result.destroy!();\n            return {\n                left: left,\n                right: right,\n                top: top,\n                bottom: bottom,\n                fillColor: selectedRgbaObj.a === 0 ? undefined : selectedRgbaObj,\n            };\n        };\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterCropExtendInput>): boolean {\n        const klCanvas = params.klCanvas;\n        if (\n            !klCanvas ||\n            isNaN(params.input.left) ||\n            isNaN(params.input.right) ||\n            isNaN(params.input.top) ||\n            isNaN(params.input.bottom)\n        ) {\n            return false;\n        }\n        klCanvas.resizeCanvas(params.input);\n\n        return true;\n    },\n};\n","import { BB } from '../../bb/bb';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../kl-types';\nimport { CurvesInput, getDefaultCurvesInput, TCurvesInput } from './filter-curves/curves-input';\nimport { Options } from '../ui/components/options';\nimport { FxPreviewRenderer } from '../ui/project-viewport/fx-preview-renderer';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth } from '../ui/utils/preview-size';\nimport { applyFxFilter } from './apply-fx-filter';\nimport { css } from '../../bb/base/base';\n\nexport type TFilterCurvesInput = {\n    curves: TCurvesInput;\n};\n\nexport const filterCurves = {\n    getDialog(params: TFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterCurvesInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let curves: TCurvesInput = getDefaultCurvesInput();\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas) => {\n                return fxCanvas.curves(curves.r, curves.g, curves.b);\n            },\n            selection: klCanvas.getSelection(),\n        });\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image:\n                        i === selectedLayerIndex\n                            ? fxPreviewRenderer.render\n                            : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            selection: klCanvas.getSelection(),\n        });\n        css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n\n        const input = new CurvesInput({\n            curves,\n            callback: function (val) {\n                curves = val;\n                preview.render();\n            },\n        });\n        const modeButtons: Options<string> = input.getModeButtons();\n\n        rootEl.append(input.getElement(), preview.getElement());\n\n        result.destroy = (): void => {\n            input.destroy();\n            modeButtons.destroy();\n            fxPreviewRenderer.destroy();\n            preview.destroy();\n        };\n        result.getInput = function (): TFilterCurvesInput {\n            result.destroy!();\n            return {\n                curves: curves,\n            };\n        };\n\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterCurvesInput>): boolean {\n        const context = params.layer.context;\n        const curves = params.input.curves;\n        const klHistory = params.klHistory;\n        if (!context) {\n            return false;\n        }\n        return applyFxFilter(\n            context,\n            params.klCanvas.getSelection(),\n            (fxCanvas) => {\n                fxCanvas.curves(curves.r, curves.g, curves.b);\n            },\n            klHistory,\n        );\n    },\n};\n","import { Options } from '../../ui/components/options';\nimport { LANG } from '../../../language/language';\nimport { BB } from '../../../bb/bb';\nimport { TVector2D } from '../../../bb/bb-types';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { css } from '../../../bb/base/base';\n\ntype TCurvePoint = {\n    el: HTMLElement;\n    pointerListener: PointerListener;\n    setPos: (newX: number, newY: number) => void;\n};\n\nexport type TCurvesInput = {\n    r: [number, number][];\n    g: [number, number][];\n    b: [number, number][];\n};\n\nexport function getDefaultCurvesInput(): TCurvesInput {\n    return BB.copyObj({\n        r: [\n            [0, 0],\n            [1 / 3, 1 / 3],\n            [2 / 3, 2 / 3],\n            [1, 1],\n        ],\n        g: [\n            [0, 0],\n            [1 / 3, 1 / 3],\n            [2 / 3, 2 / 3],\n            [1, 1],\n        ],\n        b: [\n            [0, 0],\n            [1 / 3, 1 / 3],\n            [2 / 3, 2 / 3],\n            [1, 1],\n        ],\n    });\n}\n\nexport class CurvesInput {\n    private readonly rootEl: HTMLElement;\n    private readonly p0: TCurvePoint;\n    private readonly p1: TCurvePoint;\n    private readonly p2: TCurvePoint;\n    private readonly p3: TCurvePoint;\n    private readonly modeButtons: Options<string>;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: { curves: TCurvesInput; callback: (val: TCurvesInput) => void }) {\n        this.rootEl = BB.el({\n            css: {\n                position: 'relative',\n                marginBottom: '10px',\n            },\n        });\n        this.rootEl.oncontextmenu = () => false;\n        let mode = 'All';\n        let curves = p.curves;\n        this.modeButtons = new Options({\n            optionArr: [\n                {\n                    id: 'All',\n                    label: LANG('filter-curves-all'),\n                },\n                {\n                    id: 'Red',\n                    label: LANG('red'),\n                },\n                {\n                    id: 'Green',\n                    label: LANG('green'),\n                },\n                {\n                    id: 'Blue',\n                    label: LANG('blue'),\n                },\n            ],\n            initId: 'All',\n            onChange: (id) => {\n                mode = id;\n                if (mode === 'All') {\n                    curves = getDefaultCurvesInput();\n                }\n                let curve = curves.r;\n                if (mode === 'Green') {\n                    curve = curves.g;\n                }\n                if (mode === 'Blue') {\n                    curve = curves.b;\n                }\n                this.p0.setPos(0, areaH - curve[0][1] * areaH);\n                this.p1.setPos(curve[1][0] * areaW, areaH - curve[1][1] * areaH);\n                this.p2.setPos(curve[2][0] * areaW, areaH - curve[2][1] * areaH);\n                this.p3.setPos(areaW, areaH - curve[3][1] * areaH);\n\n                update();\n            },\n        });\n        this.rootEl.append(this.modeButtons.getElement());\n\n        const curveArea = BB.el({\n            parent: this.rootEl,\n            className: 'kl-curves-graph',\n            css: {\n                position: 'relative',\n                marginTop: '10px',\n            },\n        });\n\n        const areaW = 300,\n            areaH = 100;\n        const canvas = BB.canvas(areaW, areaH);\n        let ctx = BB.ctx(canvas);\n        curveArea.append(canvas);\n\n        const fit = (v: number): number => {\n            return Math.max(0, Math.min(1, v));\n        };\n\n        const createPoint = (\n            x: number,\n            y: number,\n            callback: (p: TVector2D) => void,\n            lock?: boolean,\n        ): TCurvePoint => {\n            const gripSize = 14;\n            let internalY = y,\n                internalX = x;\n            const pointEl = BB.el({\n                className: 'kl-curves-graph__grip',\n                css: {\n                    left: x - gripSize / 2 + 'px',\n                    top: y - gripSize / 2 + 'px',\n                    width: gripSize + 'px',\n                    height: gripSize + 'px',\n                    borderRadius: gripSize + 'px',\n                },\n            });\n\n            const update = () => {\n                css(pointEl, {\n                    left: x - gripSize / 2 + 'px',\n                    top: y - gripSize / 2 + 'px',\n                });\n            };\n\n            const pointerListener = new BB.PointerListener({\n                target: pointEl,\n                onPointer: (event) => {\n                    event.eventPreventDefault();\n                    if (event.type === 'pointerdown') {\n                        internalX = x;\n                        internalY = y;\n                    }\n                    if (event.button === 'left' && event.type === 'pointermove') {\n                        if (!lock) {\n                            internalX += event.dX;\n                        }\n                        x = Math.max(0, Math.min(areaW, internalX));\n                        internalY += event.dY;\n                        y = Math.max(0, Math.min(areaH, internalY));\n                        update();\n                        callback({\n                            x: x,\n                            y: y,\n                        });\n                    }\n                },\n            });\n\n            curveArea.append(pointEl);\n\n            const setPos = (newX: number, newY: number): void => {\n                x = newX;\n                y = newY;\n                internalY = y;\n                internalX = x;\n                css(pointEl, {\n                    left: x - gripSize / 2 + 'px',\n                    top: y - gripSize / 2 + 'px',\n                });\n            };\n\n            return {\n                el: pointEl,\n                setPos,\n                pointerListener,\n            };\n        };\n\n        const updateControl = (i: number, x: number, y: number) => {\n            if (mode === 'All') {\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n            if (mode === 'Red') {\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n            if (mode === 'Green') {\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n            if (mode === 'Blue') {\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n        };\n\n        this.p0 = createPoint(\n            0,\n            areaH,\n            (val: TVector2D) => {\n                updateControl(0, val.x, val.y);\n                update();\n            },\n            true,\n        );\n        this.p1 = createPoint(areaW / 3, (areaH / 3) * 2, (val: TVector2D) => {\n            updateControl(1, val.x, val.y);\n            update();\n        });\n        this.p2 = createPoint((areaW / 3) * 2, areaH / 3, (val: TVector2D) => {\n            updateControl(2, val.x, val.y);\n            update();\n        });\n        this.p3 = createPoint(\n            areaW,\n            0,\n            (val: TVector2D) => {\n                updateControl(3, val.x, val.y);\n                update();\n            },\n            true,\n        );\n\n        const update = () => {\n            ctx = BB.ctx(canvas);\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n            const outCurves: TCurvesInput = {\n                r: [],\n                g: [],\n                b: [],\n            };\n            for (let i = 0; i < curves.r.length; i++) {\n                outCurves.r.push(curves.r[i]);\n                outCurves.g.push(curves.g[i]);\n                outCurves.b.push(curves.b[i]);\n            }\n\n            const drawCurve = (curve: [number, number][]) => {\n                ctx.beginPath();\n                const spline = new BB.SplineInterpolator(curve);\n                for (let i = 0; i < 100; i++) {\n                    let y = spline.interpolate(i / 100);\n                    y = Math.max(0, Math.min(1, y));\n\n                    if (i === 0) {\n                        ctx.moveTo((i / 100) * areaW, areaH - y * areaH);\n                    } else {\n                        ctx.lineTo((i / 100) * areaW, areaH - y * areaH);\n                    }\n                }\n                ctx.stroke();\n            };\n\n            ctx.save();\n            if (mode === 'All') {\n                ctx.strokeStyle = 'black';\n                drawCurve(outCurves.r);\n            } else {\n                ctx.globalAlpha = 0.5;\n                ctx.strokeStyle = 'red';\n                drawCurve(outCurves.r);\n                ctx.strokeStyle = 'green';\n                drawCurve(outCurves.g);\n                ctx.strokeStyle = 'blue';\n                drawCurve(outCurves.b);\n            }\n            ctx.restore();\n            p.callback(outCurves);\n        };\n\n        update();\n    }\n\n    // ---- interface ----\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    getModeButtons(): Options<string> {\n        return this.modeButtons;\n    }\n\n    destroy(): void {\n        this.p0.pointerListener.destroy();\n        this.p1.pointerListener.destroy();\n        this.p2.pointerListener.destroy();\n        this.p3.pointerListener.destroy();\n    }\n}\n","import { BB } from '../../bb/bb';\nimport { Checkbox } from '../ui/components/checkbox';\nimport { KlCanvasPreview } from '../ui/project-viewport/kl-canvas-preview';\nimport {\n    TFilterApply,\n    TFilterGetDialogParam,\n    TFilterGetDialogResult,\n    TKlBasicLayer,\n    TMixMode,\n} from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { throwIfNull } from '../../bb/base/base';\nimport { Options } from '../ui/components/options';\nimport { SMALL_PREVIEW } from '../ui/utils/preview-size';\n\nexport type TFilterFlipInput = {\n    horizontal: boolean;\n    vertical: boolean;\n    flipCanvas: boolean;\n};\n\nexport const filterFlip = {\n    getDialog(params: TFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        const w = parseInt('' + fit.width),\n            h = parseInt('' + fit.height);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterFlipInput> = {\n            element: rootEl,\n        };\n        let isHorizontal = true;\n        let isVertical = false;\n        let doFlipCanvas = true;\n\n        const horizontalCheckbox = new Checkbox({\n            init: isHorizontal,\n            label: LANG('filter-flip-horizontal') + ' ',\n            allowTab: true,\n            callback: function (v) {\n                isHorizontal = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px',\n            },\n            name: 'flip-horizontal',\n        });\n        const verticalCheckbox = new Checkbox({\n            init: isVertical,\n            label: LANG('filter-flip-vertical') + ' ',\n            allowTab: true,\n            callback: function (v) {\n                isVertical = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px',\n            },\n            name: 'flip-vertical',\n        });\n        rootEl.append(horizontalCheckbox.getElement());\n        rootEl.append(verticalCheckbox.getElement());\n\n        const targetOptions = new Options<boolean>({\n            optionArr: [\n                {\n                    id: true,\n                    label: LANG('filter-flip-image'),\n                },\n                {\n                    id: false,\n                    label: LANG('filter-flip-layer'),\n                },\n            ],\n            onChange: (val) => {\n                doFlipCanvas = val;\n                updatePreview();\n            },\n        });\n\n        rootEl.append(targetOptions.getElement());\n\n        const previewWrapper = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: SMALL_PREVIEW.width + 'px',\n                height: SMALL_PREVIEW.height + 'px',\n            },\n        });\n\n        const previewLayer: TKlBasicLayer = {\n            image: BB.canvas(Math.round(w), Math.round(h)),\n            isVisible: true,\n            opacity: 1,\n            mixModeStr: 'source-over' as TMixMode,\n        };\n        const klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: [previewLayer],\n        });\n\n        const previewInnerWrapper = BB.el({\n            className: 'kl-preview-wrapper__canvas',\n            css: {\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px',\n            },\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement());\n        previewWrapper.append(previewInnerWrapper);\n\n        function updatePreview(): void {\n            const ctx = BB.ctx(previewLayer.image as HTMLCanvasElement);\n            ctx.save();\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\n\n            if (doFlipCanvas) {\n                if (isHorizontal) {\n                    ctx.translate(previewLayer.image.width, 0);\n                    ctx.scale(-1, 1);\n                }\n                if (isVertical) {\n                    ctx.translate(0, previewLayer.image.height);\n                    ctx.scale(1, -1);\n                }\n            }\n\n            for (let i = 0; i < layers.length; i++) {\n                if (!layers[i].isVisible) {\n                    continue;\n                }\n\n                ctx.save();\n                if (!doFlipCanvas && selectedLayerIndex === i) {\n                    if (isHorizontal) {\n                        ctx.translate(previewLayer.image.width, 0);\n                        ctx.scale(-1, 1);\n                    }\n                    if (isVertical) {\n                        ctx.translate(0, previewLayer.image.height);\n                        ctx.scale(1, -1);\n                    }\n                }\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\n                    ctx.imageSmoothingEnabled = false;\n                }\n                ctx.globalAlpha = layers[i].opacity;\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\n                ctx.drawImage(\n                    layers[i].context.canvas,\n                    0,\n                    0,\n                    previewLayer.image.width,\n                    previewLayer.image.height,\n                );\n                ctx.restore();\n            }\n            klCanvasPreview.render();\n            ctx.restore();\n        }\n        setTimeout(updatePreview, 0);\n\n        rootEl.append(previewWrapper);\n        result.destroy = (): void => {\n            horizontalCheckbox.destroy();\n            verticalCheckbox.destroy();\n            targetOptions.destroy();\n            klCanvasPreview.destroy();\n        };\n        result.getInput = function (): TFilterFlipInput {\n            result.destroy!();\n            return {\n                horizontal: isHorizontal,\n                vertical: isVertical,\n                flipCanvas: doFlipCanvas,\n            };\n        };\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterFlipInput>): boolean {\n        const context = params.layer.context;\n        const klCanvas = params.klCanvas;\n        const horizontal = params.input.horizontal;\n        const vertical = params.input.vertical;\n        const flipCanvas = params.input.flipCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        klCanvas.flip(\n            horizontal,\n            vertical,\n            flipCanvas ? undefined : throwIfNull(klCanvas.getLayerIndex(context.canvas)),\n        );\n        return true;\n    },\n};\n","import { EVENT_RES_MS } from './filters-consts';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { FxPreviewRenderer } from '../ui/project-viewport/fx-preview-renderer';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { BB } from '../../bb/bb';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth } from '../ui/utils/preview-size';\nimport { applyFxFilter } from './apply-fx-filter';\nimport { css } from '../../bb/base/base';\n\nexport type TFilterHueSaturationInput = {\n    hue: number;\n    saturation: number;\n};\n\nexport const filterHueSaturation = {\n    getDialog(params: TFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterHueSaturationInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let hue = 0,\n            saturation = 0;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas) => {\n                return fxCanvas.hueSaturation(hue, saturation);\n            },\n            selection: klCanvas.getSelection(),\n        });\n\n        const hueSlider = new KlSlider({\n            label: LANG('filter-hue-sat-hue'),\n            width: 300,\n            height: 30,\n            min: -100,\n            max: 100,\n            value: hue * 100,\n            eventResMs: EVENT_RES_MS,\n            onChange: function (val) {\n                hue = val / 100;\n                preview.render();\n            },\n        });\n        const saturationSlider = new KlSlider({\n            label: LANG('filter-hue-sat-saturation'),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 100,\n            value: (saturation + 1) * 50,\n            eventResMs: EVENT_RES_MS,\n            onChange: function (val) {\n                saturation = val / 50 - 1;\n                preview.render();\n            },\n        });\n        hueSlider.getElement().style.marginBottom = '10px';\n        saturationSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(hueSlider.getElement(), saturationSlider.getElement());\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image:\n                        i === selectedLayerIndex\n                            ? fxPreviewRenderer.render\n                            : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            selection: klCanvas.getSelection(),\n        });\n        preview.render();\n        css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n        rootEl.append(preview.getElement());\n\n        result.destroy = (): void => {\n            hueSlider.destroy();\n            saturationSlider.destroy();\n            fxPreviewRenderer.destroy();\n            preview.destroy();\n        };\n        result.getInput = function (): TFilterHueSaturationInput {\n            result.destroy!();\n            return {\n                hue: hue,\n                saturation: saturation,\n            };\n        };\n\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterHueSaturationInput>): boolean {\n        const context = params.layer.context;\n        const hue = params.input.hue;\n        const klHistory = params.klHistory;\n        const saturation = params.input.saturation;\n        if (!context || hue === null || saturation === null) {\n            return false;\n        }\n        return applyFxFilter(\n            context,\n            params.klCanvas.getSelection(),\n            (fxCanvas) => {\n                fxCanvas.hueSaturation(hue, saturation);\n            },\n            klHistory,\n        );\n    },\n};\n","import { TFilterApply } from '../kl-types';\nimport { applyFxFilter } from './apply-fx-filter';\n\nexport type TFilterInvertInput = null;\n\nexport const filterInvert = {\n    apply(params: TFilterApply<TFilterInvertInput>): boolean {\n        const context = params.layer.context;\n        const klHistory = params.klHistory;\n        if (!context) {\n            return false;\n        }\n        return applyFxFilter(\n            context,\n            params.klCanvas.getSelection(),\n            (fxCanvas) => {\n                fxCanvas.invert();\n            },\n            klHistory,\n        );\n    },\n};\n","import { BB } from '../../bb/bb';\nimport { getSharedFx } from '../../fx-canvas/shared-fx';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { TwoTabs } from '../ui/components/two-tabs';\nimport { TRectanglePoints } from '../../fx-canvas/filters/perspective';\nimport { applyToPoint, Matrix } from 'transformation-matrix';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { css, throwIfNull, throwIfUndefined } from '../../bb/base/base';\nimport { DraggableInput } from '../ui/components/draggable-input';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth, MEDIUM_PREVIEW } from '../ui/utils/preview-size';\nimport { canvasToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\n\nexport type TFilterPerspectiveInput = {\n    before: TRectanglePoints;\n    after: TRectanglePoints;\n};\n\nexport const filterPerspective = {\n    getDialog(params: TFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const isSmall = testIsSmall();\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterPerspectiveInput> = {\n            element: rootEl,\n        };\n        if (!isSmall) {\n            result.width = MEDIUM_PREVIEW.width;\n        }\n\n        const fxCanvas = throwIfNull(getSharedFx());\n        const texture = throwIfUndefined(fxCanvas?.texture(context.canvas));\n\n        function update(): void {\n            if (isBefore) {\n                fxCanvas.draw(texture).update();\n            } else {\n                fxCanvas\n                    .draw(texture)\n                    .perspective(\n                        getFlatArr(beforeInputs) as TRectanglePoints,\n                        getFlatArr(afterInputs) as TRectanglePoints,\n                    )\n                    .update();\n            }\n            preview.render();\n        }\n\n        const rectPoints = [\n            { x: 0, y: 0 },\n            { x: context.canvas.width, y: 0 },\n            { x: context.canvas.width, y: context.canvas.height },\n            { x: 0, y: context.canvas.height },\n        ];\n        const beforeInputs = rectPoints.map((point) => {\n            return new DraggableInput({\n                value: point,\n                onChange: () => {\n                    update();\n                },\n            });\n        });\n        beforeInputs.forEach((item) => (item.getElement().style.display = 'none'));\n        const afterInputs = rectPoints.map((point) => {\n            return new DraggableInput({\n                value: point,\n                onChange: () => {\n                    update();\n                },\n            });\n        });\n        function getFlatArr(inputs: DraggableInput[], matrix?: Matrix): number[] {\n            return inputs.flatMap((item) => {\n                let value = item.getValue();\n                if (matrix) {\n                    value = applyToPoint(matrix, value);\n                }\n                return [value.x, value.y];\n            });\n        }\n\n        let isBefore = false;\n\n        const beforeAfterTabs = new TwoTabs({\n            left: LANG('compare-before'),\n            right: LANG('compare-after'),\n            init: 1,\n            onChange: (val: number) => {\n                isBefore = val === 0;\n                if (isBefore) {\n                    beforeInputs.forEach((item) => (item.getElement().style.display = 'block'));\n                    afterInputs.forEach((item) => (item.getElement().style.display = 'none'));\n                } else {\n                    beforeInputs.forEach((item, index) => {\n                        afterInputs[index].setValue(item.getValue());\n                    });\n                    beforeInputs.forEach((item) => (item.getElement().style.display = 'none'));\n                    afterInputs.forEach((item) => (item.getElement().style.display = 'block'));\n                }\n                update();\n            },\n        });\n        rootEl.append(beforeAfterTabs.getElement());\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            onTransformChange: (transform) => {\n                beforeInputs.forEach((item) => item.setTransform(transform));\n                afterInputs.forEach((item) => item.setTransform(transform));\n            },\n        });\n        css(preview.getElement(), {\n            overflow: 'hidden',\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n\n        preview\n            .getElement()\n            .append(\n                ...beforeInputs.map((item) => item.getElement()),\n                ...afterInputs.map((item) => item.getElement()),\n            );\n        rootEl.append(preview.getElement());\n\n        update();\n        result.destroy = (): void => {\n            preview.destroy();\n            texture.destroy();\n            beforeInputs.forEach((item) => item.destroy());\n            afterInputs.forEach((item) => item.destroy());\n        };\n        result.getInput = (): TFilterPerspectiveInput => {\n            result.destroy!();\n            return {\n                before: getFlatArr(beforeInputs) as TRectanglePoints,\n                after: getFlatArr(afterInputs) as TRectanglePoints,\n            };\n        };\n\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterPerspectiveInput>): boolean {\n        const context = params.layer.context;\n        const klHistory = params.klHistory;\n        const before = params.input.before;\n        const after = params.input.after;\n        if (!context || !before || !after) {\n            return false;\n        }\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas\n            .draw(texture)\n            .multiplyAlpha()\n            .perspective(before, after)\n            .unmultiplyAlpha()\n            .update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        {\n            const layerMap = Object.fromEntries(\n                params.klCanvas.getLayers().map((layerItem) => {\n                    if (layerItem.id === params.layer.id) {\n                        return [\n                            layerItem.id,\n                            {\n                                tiles: canvasToLayerTiles(params.layer.canvas),\n                            },\n                        ];\n                    }\n\n                    return [layerItem.id, {}];\n                }),\n            );\n            klHistory.push({\n                layerMap,\n            });\n        }\n        return true;\n    },\n};\n","import { BB } from '../../../bb/bb';\n\n/**\n * Two buttons next to each other, each representing a tab. one at a time can be active.\n */\nexport class TwoTabs {\n    private readonly rootEl: HTMLElement;\n    private readonly leftTab: HTMLElement;\n    private readonly rightTab: HTMLElement;\n    private value: number;\n\n    private update(): void {\n        this.leftTab.classList.toggle('kl-2-tabs--active', this.value === 0);\n        this.rightTab.classList.toggle('kl-2-tabs--active', this.value === 1);\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        left: string;\n        right: string;\n        init: number; //0, 1\n        onChange: (val: number) => void;\n    }) {\n        this.value = p.init;\n\n        this.rootEl = BB.el({\n            className: 'kl-2-tabs',\n        });\n\n        this.leftTab = BB.el({\n            parent: this.rootEl,\n            content: p.left,\n            className: 'kl-2-tabs__left',\n        });\n        this.leftTab.onpointerdown = () => false;\n\n        this.rightTab = BB.el({\n            parent: this.rootEl,\n            content: p.right,\n            className: 'kl-2-tabs__right',\n        });\n        this.rightTab.onpointerdown = () => false;\n\n        this.update();\n\n        this.leftTab.onclick = () => {\n            if (this.value === 0) {\n                return;\n            }\n            this.value = 0;\n            this.update();\n            p.onChange(this.value);\n        };\n\n        this.rightTab.onclick = () => {\n            if (this.value === 1) {\n                return;\n            }\n            this.value = 1;\n            this.update();\n            p.onChange(this.value);\n        };\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","import { TViewportTransform } from '../project-viewport/project-viewport';\nimport { BB } from '../../../bb/bb';\nimport { TVector2D } from '../../../bb/bb-types';\nimport { applyToPoint } from 'transformation-matrix';\nimport { createMatrixFromTransform } from '../../../bb/transform/create-matrix-from-transform';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { css } from '../../../bb/base/base';\n\nexport type TDraggableInputParams = {\n    value: TVector2D;\n    onChange: (value: TVector2D) => void;\n};\n\nconst SIZE = 16;\n\nexport class DraggableInput {\n    private readonly rootEl: HTMLElement;\n    private transform: TViewportTransform;\n    private value: TVector2D;\n    private readonly pointerListener: PointerListener;\n\n    private update(): void {\n        const p = applyToPoint(createMatrixFromTransform(this.transform), this.value);\n        css(this.rootEl, {\n            left: p.x - SIZE / 2 + 'px',\n            top: p.y - SIZE / 2 + 'px',\n        });\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TDraggableInputParams) {\n        this.value = { ...p.value };\n        this.transform = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angleDeg: 0,\n        };\n\n        this.rootEl = BB.el({\n            css: {\n                width: SIZE + 'px',\n                height: SIZE + 'px',\n                backgroundColor: '#fff',\n                border: '2px solid #000',\n                borderRadius: SIZE + 'px',\n                position: 'absolute',\n                cursor: 'move',\n                userSelect: 'none',\n                touchAction: 'none',\n            },\n        });\n\n        this.pointerListener = new BB.PointerListener({\n            target: this.rootEl,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.button === 'left' && event.type === 'pointermove') {\n                    this.value.x += event.dX / this.transform.scale;\n                    this.value.y += event.dY / this.transform.scale;\n                    this.update();\n                    p.onChange(this.value);\n                }\n            },\n        });\n    }\n\n    setTransform(transform: TViewportTransform): void {\n        if (JSON.stringify(this.transform) === JSON.stringify(transform)) {\n            return;\n        }\n        this.transform = transform;\n        this.update();\n    }\n\n    getValue(): TVector2D {\n        return this.value;\n    }\n\n    setValue(p: TVector2D): void {\n        this.value = { ...p };\n        this.update();\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy(): void {\n        this.rootEl.remove();\n        this.pointerListener.destroy();\n    }\n}\n","import { BB } from '../../bb/bb';\nimport { Checkbox } from '../ui/components/checkbox';\nimport { Select } from '../ui/components/select';\nimport constrainImg from 'url:/src/app/img/ui/constrain.svg';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { table } from '../ui/components/table';\nimport { SMALL_PREVIEW } from '../ui/utils/preview-size';\nimport { css } from '../../bb/base/base';\n\nexport type TFilterResizeInput = {\n    width: number;\n    height: number;\n    algorithm: 'smooth' | 'pixelated';\n};\n\nexport const filterResize = {\n    getDialog(params: TFilterGetDialogParam) {\n        //BB.centerWithin\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) {\n            return false;\n        }\n\n        const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\n        const w = parseInt('' + fit.width),\n            h = parseInt('' + fit.height);\n\n        let previewFactor = w / klCanvas.getWidth();\n        const tempCanvas = klCanvas.getCompleteCanvas(1);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterResizeInput> = {\n            element: rootEl,\n        };\n        let newWidth = klCanvas.getWidth(),\n            newHeight = klCanvas.getHeight();\n\n        const maxWidth = params.maxWidth,\n            maxHeight = params.maxHeight;\n\n        const widthWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            },\n        });\n        const heightWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            },\n        });\n        const widthInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxWidth,\n                value: '' + klCanvas.getWidth(),\n            },\n        });\n        const heightInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxHeight,\n                value: '' + klCanvas.getHeight(),\n            },\n        });\n        widthInput.onclick = function () {\n            (this as any).focus();\n            widthChanged = true;\n            update();\n        };\n        heightInput.onclick = function () {\n            (this as any).focus();\n            heightChanged = true;\n            update();\n        };\n        widthInput.onchange = function () {\n            widthChanged = true;\n            update();\n        };\n        heightInput.onchange = function () {\n            heightChanged = true;\n            update();\n        };\n        widthWrapper.append(LANG('width') + ': ', widthInput);\n        heightWrapper.append(LANG('height') + ': ', heightInput);\n        const inputWrapper = BB.el({\n            css: {\n                background: 'url(' + constrainImg + ') no-repeat 140px 5px',\n                backgroundSize: '50px 52px',\n            },\n        });\n        inputWrapper.append(widthWrapper, heightWrapper);\n        const constrainIm = new Image();\n        constrainIm.src = constrainImg;\n        constrainIm.height = 40;\n\n        const sizeTable = table(\n            [\n                [LANG('width') + ':&nbsp;', widthInput, constrainIm],\n                [BB.el({ css: { height: '5px' } }), '', ''],\n                [LANG('height') + ':&nbsp;', heightInput],\n            ],\n            {\n                '0.2': { rowspan: 3 },\n            },\n        );\n        css(sizeTable, {\n            marginBottom: '10px',\n        });\n\n        rootEl.append(sizeTable);\n\n        //contrain checkbox\n        let heightChanged = false,\n            widthChanged = false;\n        const ratio = klCanvas.getWidth() / klCanvas.getHeight();\n\n        function updateConstrain(): void {\n            constrainIm.style.display = isConstrained ? '' : 'none';\n            if (isConstrained) {\n                widthInput.value = '' + klCanvas.getWidth();\n                heightInput.value = '' + klCanvas.getHeight();\n                update();\n            }\n        }\n\n        let isConstrained = true;\n        const constrainCheckbox = new Checkbox({\n            init: true,\n            label: LANG('constrain-proportions'),\n            allowTab: true,\n            callback: function (b) {\n                isConstrained = b;\n                updateConstrain();\n            },\n            name: 'constrain-proportions',\n        });\n        rootEl.append(\n            BB.el({\n                css: {\n                    clear: 'both',\n                },\n            }),\n        );\n\n        const algorithmSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                ['smooth', LANG('algorithm-smooth')],\n                ['pixelated', LANG('algorithm-pixelated')],\n            ],\n            title: LANG('scaling-algorithm'),\n            initValue: 'smooth',\n            onChange: (): void => {\n                update();\n            },\n            name: 'interpolation-algorithm',\n        });\n\n        const secondRowElement = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n            },\n        });\n        secondRowElement.append(constrainCheckbox.getElement(), algorithmSelect.getElement());\n\n        const previewCanvas = BB.canvas(w, h);\n        previewCanvas.style.imageRendering = 'pixelated';\n\n        const previewCtx = BB.ctx(previewCanvas);\n\n        function draw(): void {\n            if (algorithmSelect.getValue() === 'smooth') {\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\n\n                previewCanvas.width = klCanvas.getWidth();\n                previewCanvas.height = klCanvas.getHeight();\n\n                previewCtx.save();\n                previewCtx.imageSmoothingQuality = 'high';\n                previewCtx.drawImage(tempCanvas, 0, 0);\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\n                previewCtx.restore();\n            } else {\n                previewCanvas.style.imageRendering = 'pixelated';\n\n                previewCanvas.width = newWidth;\n                previewCanvas.height = newHeight;\n                previewCtx.save();\n                previewCtx.imageSmoothingEnabled = false;\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\n                previewCtx.restore();\n            }\n        }\n\n        function update(): void {\n            if (\n                (widthInput.value.length === 0 && widthChanged) ||\n                (heightInput.value.length === 0 && heightChanged)\n            ) {\n                heightChanged = false;\n                widthChanged = false;\n                return;\n            }\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\n            if (isConstrained) {\n                if (heightChanged) {\n                    widthInput.value = '' + parseInt('' + parseInt(heightInput.value) * ratio);\n                }\n                if (widthChanged) {\n                    heightInput.value = '' + parseInt('' + parseInt(widthInput.value) / ratio);\n                }\n\n                if (\n                    parseInt(widthInput.value) > maxWidth ||\n                    parseInt(heightInput.value) > maxHeight\n                ) {\n                    const fit = BB.fitInto(\n                        parseInt(widthInput.value),\n                        parseInt(heightInput.value),\n                        maxWidth,\n                        maxHeight,\n                        1,\n                    );\n                    widthInput.value = '' + parseInt('' + fit.width);\n                    heightInput.value = '' + parseInt('' + fit.height);\n                }\n            }\n\n            if (parseInt(widthInput.value) > maxWidth) {\n                widthInput.value = '' + maxWidth;\n            }\n            if (parseInt(heightInput.value) > maxHeight) {\n                heightInput.value = '' + maxHeight;\n            }\n\n            heightChanged = false;\n            widthChanged = false;\n\n            newWidth = parseInt(widthInput.value);\n            newHeight = parseInt(heightInput.value);\n\n            const preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\n            const previewW = parseInt('' + preview.width),\n                previewH = parseInt('' + preview.height);\n            previewFactor = previewW / newWidth;\n\n            const offset = BB.centerWithin(\n                SMALL_PREVIEW.width,\n                SMALL_PREVIEW.height,\n                previewW,\n                previewH,\n            );\n\n            draw();\n\n            previewCanvas.style.width = Math.max(1, previewW) + 'px';\n            previewCanvas.style.height = Math.max(1, previewH) + 'px';\n            canvasWrapper.style.left = offset.x + 'px';\n            canvasWrapper.style.top = offset.y + 'px';\n            canvasWrapper.style.width = Math.max(1, previewW) + 'px';\n            canvasWrapper.style.height = Math.max(1, previewH) + 'px';\n        }\n\n        const previewWrapper = BB.el({\n            className: 'kl-transparent-preview',\n            css: {\n                width: SMALL_PREVIEW.width + 'px',\n                height: SMALL_PREVIEW.height + 'px',\n                marginLeft: '-20px',\n                display: 'table',\n                marginTop: '10px',\n                position: 'relative',\n                userSelect: 'none',\n                background: 'var(--kl-checkerboard-background)',\n                backgroundSize: '16px',\n            },\n        });\n\n        const canvasWrapper = BB.el({\n            parent: previewWrapper,\n            content: previewCanvas,\n            className: 'kl-transparent-preview__canvas',\n            css: {\n                width: w + 'px',\n                height: h + 'px',\n                position: 'absolute',\n                overflow: 'hidden',\n            },\n        });\n\n        rootEl.append(previewWrapper);\n        update();\n\n        result.destroy = (): void => {\n            constrainCheckbox.destroy();\n        };\n        result.getInput = function (): TFilterResizeInput {\n            result.destroy!();\n            return {\n                width: newWidth,\n                height: newHeight,\n                algorithm: algorithmSelect.getValue(),\n            };\n        };\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterResizeInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const width = params.input.width;\n        const height = params.input.height;\n        const algorithm = params.input.algorithm;\n        if (!klCanvas) {\n            return false;\n        }\n        klCanvas.resize(width, height, algorithm);\n        return true;\n    },\n};\n","module.exports = parcelRequire.resolve(\"constrain.ee8deb1c.svg\") + \"?\" + Date.now();","import { BB } from '../../bb/bb';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../kl-types';\nimport { SMALL_PREVIEW } from '../ui/utils/preview-size';\n\nexport type TFilterRotateInput = {\n    deg: number;\n};\n\nexport const filterRotate = {\n    getDialog(params: TFilterGetDialogParam) {\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) {\n            return false;\n        }\n\n        const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\n        const w = parseInt('' + fit.width),\n            h = parseInt('' + fit.height);\n\n        const previewFactor = w / klCanvas.getWidth();\n        const tempCanvas = BB.canvas(w, h);\n        tempCanvas.style.display = 'block';\n        BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterRotateInput> = {\n            element: rootEl,\n        };\n        let deg = 0;\n\n        function update(): void {\n            canvasWrapper.style.transform = 'rotate(' + deg + 'deg)';\n            if (Math.abs(deg % 180) === 90) {\n                //height has to fit width because of rotation\n                const fit = BB.fitInto(h, w, 280, 200, 1);\n                const scale = parseInt('' + fit.height) / w;\n                canvasWrapper.style.transform = 'rotate(' + deg + 'deg) scale(' + scale + ')';\n            }\n        }\n\n        const minusBtn = BB.el({\n            tagName: 'button',\n            content: [\n                BB.el({\n                    tagName: 'span',\n                    content: '',\n                    css: {\n                        fontSize: '1.3em',\n                    },\n                }),\n                ' 90',\n            ],\n            onClick: () => {\n                deg -= 90;\n                update();\n            },\n            noRef: true,\n        });\n        const plusBtn = BB.el({\n            tagName: 'button',\n            content: [\n                BB.el({\n                    tagName: 'span',\n                    content: '',\n                    css: {\n                        fontSize: '1.3em',\n                    },\n                }),\n                ' 90',\n            ],\n            onClick: () => {\n                deg += 90;\n                update();\n            },\n            noRef: true,\n            css: {\n                marginLeft: '5px',\n            },\n        });\n\n        rootEl.append(minusBtn, plusBtn);\n\n        const previewWrapper = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: SMALL_PREVIEW.width + 'px',\n                height: SMALL_PREVIEW.height + 'px',\n                display: 'table',\n            },\n        });\n\n        const previewcell = BB.el({\n            parent: previewWrapper,\n            css: {\n                display: 'table-cell',\n                verticalAlign: 'middle',\n            },\n        });\n        const canvasWrapper = BB.el({\n            parent: previewcell,\n            content: tempCanvas,\n            className: 'kl-preview-wrapper__canvas',\n            css: {\n                width: w + 'px',\n                height: h + 'px',\n                marginLeft: 'auto',\n                marginRight: 'auto',\n                overflow: 'hidden',\n                background: 'var(--kl-checkerboard-background)',\n                backgroundSize: '16px',\n            },\n        });\n\n        canvasWrapper.style.transition = 'transform 0.2s ease-out';\n\n        rootEl.append(previewWrapper);\n        update();\n\n        result.destroy = (): void => {};\n        result.getInput = function (): TFilterRotateInput {\n            result.destroy!();\n            return {\n                deg: deg,\n            };\n        };\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterRotateInput>): boolean {\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) {\n            return false;\n        }\n        klCanvas.rotate(params.input.deg);\n        return true;\n    },\n};\n","import { BB } from '../../bb/bb';\nimport { EVENT_RES_MS } from './filters-consts';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { TVector2D } from '../../bb/bb-types';\nimport { FxPreviewRenderer } from '../ui/project-viewport/fx-preview-renderer';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { createMatrixFromTransform } from '../../bb/transform/create-matrix-from-transform';\nimport { applyToPoint } from 'transformation-matrix';\nimport { DraggableInput } from '../ui/components/draggable-input';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth } from '../ui/utils/preview-size';\nimport { applyFxFilter } from './apply-fx-filter';\nimport { css } from '../../bb/base/base';\n\nexport type TFilterTiltShiftInput = {\n    a: TVector2D;\n    b: TVector2D;\n    blur: number;\n    gradient: number;\n};\n\nexport const filterTiltShift = {\n    getDialog(params: TFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterTiltShiftInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let blur = 20,\n            gradient = 200;\n        let fxPreviewRenderer: FxPreviewRenderer = {\n            destroy: () => {},\n        } as FxPreviewRenderer;\n\n        fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                fa.setTransform(preview.getTransform());\n                fb.setTransform(preview.getTransform());\n\n                const m = createMatrixFromTransform(transform);\n                const a = applyToPoint(m, fa.getValue());\n                const b = applyToPoint(m, fb.getValue());\n                return fxCanvas\n                    .multiplyAlpha()\n                    .tiltShift(\n                        a.x,\n                        a.y,\n                        b.x,\n                        b.y,\n                        blur * transform.scaleX,\n                        gradient * transform.scaleX,\n                    )\n                    .unmultiplyAlpha();\n            },\n            selection: klCanvas.getSelection(),\n        });\n\n        function update() {\n            preview.render();\n        }\n\n        // focus line control points\n        const fa = new DraggableInput({\n            value: {\n                x: context.canvas.width / 4,\n                y: context.canvas.height / 2,\n            },\n            onChange: () => {\n                update();\n            },\n        });\n        const fb = new DraggableInput({\n            value: {\n                x: (3 * context.canvas.width) / 4,\n                y: context.canvas.height / 2,\n            },\n            onChange: () => {\n                update();\n            },\n        });\n\n        const gradientSlider = new KlSlider({\n            label: LANG('filter-tilt-shift-gradient'),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 1000,\n            value: gradient,\n            eventResMs: EVENT_RES_MS,\n            onChange: function (val) {\n                gradient = val;\n                update();\n            },\n        });\n        gradientSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(gradientSlider.getElement());\n        const blurSlider = new KlSlider({\n            label: LANG('filter-tilt-shift-blur'),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 200,\n            value: blur,\n            eventResMs: EVENT_RES_MS,\n            onChange: function (val) {\n                blur = val;\n                update();\n            },\n        });\n        blurSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(blurSlider.getElement());\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image:\n                        i === selectedLayerIndex\n                            ? fxPreviewRenderer.render\n                            : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            selection: klCanvas.getSelection(),\n        });\n\n        preview.render();\n        css(preview.getElement(), {\n            overflow: 'hidden',\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n\n        preview.getElement().append(fa.getElement(), fb.getElement());\n        rootEl.append(preview.getElement());\n\n        result.destroy = (): void => {\n            blurSlider.destroy();\n            gradientSlider.destroy();\n            fa.destroy();\n            fb.destroy();\n            fxPreviewRenderer.destroy();\n            preview.destroy();\n        };\n        result.getInput = function (): TFilterTiltShiftInput {\n            result.destroy!();\n            return {\n                a: fa.getValue(),\n                b: fb.getValue(),\n                blur: blur,\n                gradient: gradient,\n            };\n        };\n\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterTiltShiftInput>): boolean {\n        const context = params.layer.context;\n        const klHistory = params.klHistory;\n        const a = params.input.a;\n        const b = params.input.b;\n        const blur = params.input.blur;\n        const gradient = params.input.gradient;\n        if (!context) {\n            return false;\n        }\n        return applyFxFilter(\n            context,\n            params.klCanvas.getSelection(),\n            (fxCanvas) => {\n                fxCanvas\n                    .multiplyAlpha()\n                    .tiltShift(a.x, a.y, b.x, b.y, blur, gradient)\n                    .unmultiplyAlpha();\n            },\n            klHistory,\n        );\n    },\n};\n","import { BB } from '../../bb/bb';\nimport { Checkbox } from '../ui/components/checkbox';\nimport { FreeTransform } from '../ui/components/free-transform';\nimport { TFreeTransform } from '../ui/components/free-transform-utils';\nimport { Select } from '../ui/components/select';\nimport {\n    isLayerFill,\n    TFilterApply,\n    TFilterGetDialogParam,\n    TFilterGetDialogResult,\n} from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { css, throwIfNull } from '../../bb/base/base';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth, MEDIUM_PREVIEW } from '../ui/utils/preview-size';\nimport { canvasToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\nimport { getSelectionBounds } from '../select-tool/get-selection-bounds';\nimport { getSelectionPath2d } from '../../bb/multi-polygon/get-selection-path-2d';\nimport { compose, Matrix, rotate, scale, translate } from 'transformation-matrix';\nimport { matrixToTuple } from '../../bb/math/matrix-to-tuple';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { TRect } from '../../bb/bb-types';\nimport { transformMultiPolygon } from '../../bb/multi-polygon/transform-multi-polygon';\nimport { THistoryEntryLayerComposed } from '../history/history.types';\n\n// preference expressed by user\nlet preferenceIsTransparentBg: undefined | boolean;\n\nfunction getIsTransparentBg(\n    isBgLayer: boolean,\n    layerHasTransparency: boolean,\n    preference: undefined | boolean,\n): boolean {\n    if (!isBgLayer) {\n        return true;\n    }\n    if (preference !== undefined) {\n        return preference;\n    }\n    return layerHasTransparency;\n}\n\nfunction parseCssColor(colorString: string) {\n    if (colorString.startsWith('#')) {\n        let hex = colorString.slice(1);\n        if (hex.length === 3) {\n            hex = hex\n                .split('')\n                .map((c) => c + c)\n                .join('');\n        }\n        if (hex.length === 6) {\n            // assume full alpha\n            hex += 'ff';\n        }\n        const intVal = parseInt(hex, 16);\n        return {\n            r: (intVal >> 24) & 255,\n            g: (intVal >> 16) & 255,\n            b: (intVal >> 8) & 255,\n            a: (intVal & 255) / 255,\n        };\n    }\n\n    const rgbMatch = colorString.match(/rgba?\\(([^)]+)\\)/);\n    if (rgbMatch) {\n        const [r, g, b, a = 1] = rgbMatch[1].split(',').map((v) => parseFloat(v.trim()));\n        return { r, g, b, a };\n    }\n\n    return undefined;\n}\n\nfunction testComposedLayerHasTransparency(layer: THistoryEntryLayerComposed): boolean {\n    for (const tile of layer.tiles) {\n        if (isLayerFill(tile)) {\n            const color = parseCssColor(tile.fill);\n            if (color && color.a < 1) {\n                return true;\n            }\n        } else {\n            const data = tile.data.data;\n            for (let i = 3; i < data.length; i += 4) {\n                if (data[i] < 255) {\n                    return true;\n                }\n            }\n        }\n    }\n    return false;\n}\n\nfunction drawTransform(\n    ctx: CanvasRenderingContext2D,\n    copiedCanvas: HTMLCanvasElement,\n    isPixelated: boolean,\n    transform: TFreeTransform,\n    selection?: MultiPolygon,\n    boundsObj?: TRect,\n    doClone?: boolean,\n    isTransparentBg?: boolean,\n): Matrix | undefined {\n    const width = ctx.canvas.width;\n    const height = ctx.canvas.height;\n    ctx.save();\n    ctx.clearRect(0, 0, width, height);\n\n    ctx.save();\n    if (selection) {\n        // draw original with clipped selection\n        ctx.drawImage(copiedCanvas, 0, 0);\n        if (!doClone) {\n            const selectionPath = getSelectionPath2d(selection);\n            ctx.clip(selectionPath);\n            ctx.globalCompositeOperation = isTransparentBg ? 'destination-out' : 'source-atop';\n            ctx.fillStyle = 'white';\n            ctx.fillRect(0, 0, width, height);\n        }\n    } else {\n        if (isTransparentBg) {\n            if (doClone) {\n                ctx.drawImage(copiedCanvas, 0, 0);\n            }\n        } else {\n            ctx.drawImage(copiedCanvas, 0, 0);\n            if (!doClone) {\n                ctx.fillStyle = 'white';\n                ctx.globalCompositeOperation = 'source-atop';\n                ctx.fillRect(0, 0, width, height);\n            }\n        }\n    }\n    ctx.restore();\n\n    let matrix: Matrix | undefined;\n    if (selection) {\n        const bounds = boundsObj ?? {\n            x: 0,\n            y: 0,\n            width: ctx.canvas.width,\n            height: ctx.canvas.height,\n        };\n        if (\n            isPixelated ||\n            BB.testShouldPixelate(\n                transform,\n                transform.width / bounds.width,\n                transform.height / bounds.height,\n            )\n        ) {\n            ctx.imageSmoothingEnabled = false;\n        } else {\n            ctx.imageSmoothingEnabled = true;\n            ctx.imageSmoothingQuality = 'high';\n        }\n        // derived from drawTransformedImageWithBounds\n        matrix = compose(\n            translate(transform.x, transform.y),\n            rotate((transform.angleDeg / 180) * Math.PI),\n            scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1),\n            translate(-Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2),\n            scale(\n                Math.abs(transform.width / bounds.width),\n                Math.abs(transform.height / bounds.height),\n            ),\n            translate(-bounds.x, -bounds.y),\n        );\n        ctx.setTransform(...matrixToTuple(matrix));\n        const selectionPath = getSelectionPath2d(selection);\n        ctx.clip(selectionPath);\n        ctx.drawImage(copiedCanvas, 0, 0);\n    } else {\n        BB.drawTransformedImageWithBounds(ctx, copiedCanvas, transform, boundsObj, isPixelated);\n    }\n\n    ctx.restore();\n    return matrix;\n}\n\nexport type TFilterTransformInput = {\n    bounds: { x: number; y: number; width: number; height: number };\n    transform: TFreeTransform;\n    isPixelated: boolean;\n    doClone: boolean;\n    isTransparentBg: boolean;\n};\n\nexport const filterTransform = {\n    getDialog(params: TFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const isSmall = testIsSmall();\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n        const isBgLayer = selectedLayerIndex === 0;\n        let hasTransparency = false;\n        if (isBgLayer) {\n            const layer = Object.entries(params.composed.layerMap).find(\n                ([_, layer]) => layer.index === selectedLayerIndex,\n            )![1];\n            hasTransparency = testComposedLayerHasTransparency(layer);\n        }\n        const selection = klCanvas.getSelection();\n\n        // determine bounds and initial transformation\n        const boundsObj = selection\n            ? getSelectionBounds(selection, context)\n            : BB.canvasBounds(context);\n        if (!boundsObj) {\n            return {\n                error: LANG(\n                    selection ? 'filter-transform-empty-selection' : 'filter-transform-empty',\n                ),\n            };\n        }\n        const initTransform = {\n            x: boundsObj.x + boundsObj.width / 2,\n            y: boundsObj.y + boundsObj.height / 2,\n            width: boundsObj.width,\n            height: boundsObj.height,\n            angleDeg: 0,\n        };\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterTransformInput> = {\n            element: rootEl,\n        };\n        if (!isSmall) {\n            result.width = MEDIUM_PREVIEW.width;\n        }\n\n        const keyListener = new BB.KeyListener({\n            onDown: function (keyStr) {\n                if (BB.isInputFocused(true)) {\n                    return;\n                }\n\n                if (keyStr === 'left') {\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'right') {\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'up') {\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'down') {\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\n                    onInputsChanged();\n                }\n            },\n        });\n\n        const leftWrapper = BB.el({\n            css: {\n                width: '100px',\n                height: '30px',\n                display: 'inline-block',\n            },\n        });\n        const rightWrapper = BB.el({\n            css: {\n                width: '100px',\n                height: '30px',\n                display: 'inline-block',\n            },\n        });\n        const rotWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '30px',\n                display: 'inline-block',\n            },\n        });\n        const inputY = BB.el({ tagName: 'input' });\n        const inputX = BB.el({ tagName: 'input' });\n        const inputR = BB.el({ tagName: 'input' });\n        inputY.type = 'number';\n        inputX.type = 'number';\n        inputR.type = 'number';\n        inputX.style.width = 70 + 'px';\n        inputY.style.width = 70 + 'px';\n        inputR.style.width = 70 + 'px';\n        inputY.value = '0';\n        inputX.value = '0';\n        inputR.value = '0';\n        inputY.onclick = function () {\n            inputY.focus();\n            onInputsChanged();\n        };\n        inputX.onclick = function () {\n            inputX.focus();\n            onInputsChanged();\n        };\n        inputR.onclick = function () {\n            inputR.focus();\n            onInputsChanged();\n        };\n        inputY.onchange = function () {\n            onInputsChanged();\n        };\n        inputX.onchange = function () {\n            onInputsChanged();\n        };\n        inputR.onchange = function () {\n            onInputsChanged();\n        };\n        inputY.onkeyup = function () {\n            onInputsChanged();\n        };\n        inputX.onkeyup = function () {\n            onInputsChanged();\n        };\n        inputR.onkeyup = function () {\n            onInputsChanged();\n        };\n        leftWrapper.append('X: ', inputX);\n        rightWrapper.append('Y: ', inputY);\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\n        if (!isSmall) {\n            const inputRow = BB.el({\n                parent: rootEl,\n                css: {\n                    marginTop: '10px',\n                },\n            });\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\n        }\n\n        // buttons\n        const buttonRow = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                flexWrap: 'wrap',\n                alignItems: 'center',\n                gap: '10px',\n                marginTop: '10px',\n            },\n        });\n        const flipXBtn = BB.el({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('filter-transform-flip') + ' X',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setSize(-t.width, t.height);\n            },\n        });\n        const flipYBtn = BB.el({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('filter-transform-flip') + ' Y',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setSize(t.width, -t.height);\n            },\n        });\n        const scaleRotLeftBtn = BB.el({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '-90',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                t.angleDeg -= 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n        });\n        const scaleRotRightBtn = BB.el({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '+90',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                t.angleDeg += 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n        });\n        const scaleDoubleBtn = BB.el({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '2x',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                if (constrainCheckbox.getValue()) {\n                    freeTransform.setSize(\n                        (t.width < 0 ? -1 : 1) * freeTransform.getRatio() * Math.abs(t.height) * 2,\n                        t.height * 2,\n                    );\n                } else {\n                    freeTransform.setSize(t.width * 2, t.height * 2);\n                }\n            },\n        });\n        const scaleHalfBtn = BB.el({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '1/2x',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\n            },\n        });\n        const centerBtn = BB.el({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('center'),\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setPos({\n                    x: context.canvas.width / 2,\n                    y: context.canvas.height / 2,\n                });\n                freeTransform.setAngleDeg(t.angleDeg);\n                updatePreview();\n            },\n        });\n\n        let doClone = false;\n        const cloneCheckbox = new Checkbox({\n            init: doClone,\n            label: LANG('select-transform-clone'),\n            allowTab: true,\n            callback: function (b) {\n                doClone = b;\n                updatePreview(true);\n            },\n            css: {\n                display: 'inline-block',\n            },\n            name: 'clone-before-transforming',\n        });\n        let isTransparentBg = getIsTransparentBg(\n            isBgLayer,\n            hasTransparency,\n            preferenceIsTransparentBg,\n        );\n        let transparentBgCheckboxTouched = false;\n        const transparentBgCheckbox = new Checkbox({\n            init: isTransparentBg,\n            label: LANG('brush-eraser-transparent-bg'),\n            allowTab: true,\n            callback: function (b) {\n                transparentBgCheckboxTouched = true;\n                isTransparentBg = b;\n                updatePreview(true);\n            },\n            css: {\n                display: 'inline-block',\n            },\n            name: 'transparent-background',\n        });\n        buttonRow.append(cloneCheckbox.getElement());\n        if (isBgLayer) {\n            buttonRow.append(transparentBgCheckbox.getElement());\n        }\n\n        let isConstrained = true;\n        const constrainCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-transform-constrain'),\n            title: LANG('constrain-proportions'),\n            allowTab: true,\n            callback: function (b) {\n                isConstrained = b;\n                freeTransform.setIsConstrained(isConstrained);\n            },\n            css: {\n                display: 'inline-block',\n            },\n            name: 'constrain-proportions',\n        });\n        let isSnapping = false;\n        const snappingCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-transform-snap'),\n            title: LANG('filter-transform-snap-title'),\n            allowTab: true,\n            callback: function (b) {\n                isSnapping = b;\n                freeTransform.setSnapping(isSnapping);\n            },\n            css: {\n                display: 'inline-block',\n                marginLeft: '10px',\n            },\n            name: 'enable-snapping',\n        });\n        const checkboxWrapper = BB.el();\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\n\n        rootEl.append(\n            BB.el({\n                css: {\n                    clear: 'both',\n                    height: '10px',\n                },\n            }),\n        );\n\n        const bottomRow = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                marginBottom: '10px',\n            },\n        });\n\n        const algorithmSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                ['smooth', LANG('algorithm-smooth')],\n                ['pixelated', LANG('algorithm-pixelated')],\n            ],\n            initValue: 'smooth',\n            title: LANG('scaling-algorithm'),\n            onChange: (): void => {\n                updatePreview(true);\n            },\n            name: 'interpolation-algorithm',\n        });\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\n\n        const previewCanvas = BB.canvas(context.canvas.width, context.canvas.height);\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image: i === selectedLayerIndex ? previewCanvas : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            hasEditMode: true,\n            onModeChange: (m) => {\n                freeTransform.getElement().style.pointerEvents = m === 'edit' ? '' : 'none';\n                freeTransform.getElement().style.opacity = m === 'edit' ? '' : '0.5';\n            },\n            onTransformChange: (transform) => {\n                freeTransform.setViewportTransform(transform);\n            },\n            padding: 30,\n        });\n        preview.render();\n        css(preview.getElement(), {\n            overflow: 'hidden',\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n        rootEl.append(preview.getElement());\n\n        let lastDrawnTransformStr = '';\n        function updatePreview(doForce: boolean = false) {\n            if (!freeTransform) {\n                return;\n            }\n            const transform = freeTransform.getValue();\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\n                return;\n            }\n            lastDrawnTransformStr = JSON.stringify(transform);\n\n            const ctx = BB.ctx(previewCanvas);\n            drawTransform(\n                ctx,\n                layers[selectedLayerIndex].context.canvas,\n                algorithmSelect.getValue() === 'pixelated',\n                transform,\n                selection,\n                boundsObj,\n                doClone,\n                isTransparentBg || selectedLayerIndex > 0,\n            );\n            preview.render();\n        }\n\n        const freeTransform = new FreeTransform({\n            x: initTransform.x,\n            y: initTransform.y,\n            width: initTransform.width,\n            height: initTransform.height,\n            angleDeg: initTransform.angleDeg,\n            isConstrained: true,\n            snapX: [0, context.canvas.width],\n            snapY: [0, context.canvas.height],\n            callback: function (t) {\n                inputX.value = '' + Math.round(t.x - initTransform.x);\n                inputY.value = '' + Math.round(t.y - initTransform.y);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            viewportTransform: preview.getTransform(),\n        });\n        css(freeTransform.getElement(), {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n        });\n        preview.getElement().append(freeTransform.getElement());\n\n        function onInputsChanged() {\n            freeTransform.setPos({\n                x: parseInt(inputX.value) + initTransform.x,\n                y: parseInt(inputY.value) + initTransform.y,\n            });\n            freeTransform.setAngleDeg(parseInt(inputR.value));\n            updatePreview();\n        }\n\n        updatePreview();\n\n        result.destroy = (): void => {\n            keyListener.destroy();\n            freeTransform.destroy();\n            constrainCheckbox.destroy();\n            snappingCheckbox.destroy();\n            BB.destroyEl(flipXBtn);\n            BB.destroyEl(flipYBtn);\n            BB.destroyEl(scaleRotLeftBtn);\n            BB.destroyEl(scaleRotRightBtn);\n            BB.destroyEl(scaleDoubleBtn);\n            BB.destroyEl(scaleHalfBtn);\n            BB.destroyEl(centerBtn);\n            preview.destroy();\n            BB.freeCanvas(previewCanvas);\n        };\n        result.getInput = function (): TFilterTransformInput {\n            const transform = freeTransform.getValue();\n            if (transparentBgCheckboxTouched) {\n                preferenceIsTransparentBg = isTransparentBg;\n            }\n            const input: TFilterTransformInput = {\n                transform,\n                bounds: boundsObj,\n                isPixelated: algorithmSelect.getValue() === 'pixelated',\n                doClone,\n                isTransparentBg,\n            };\n            result.destroy!();\n            return BB.copyObj(input);\n        };\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterTransformInput>): boolean {\n        const context = params.layer.context;\n        const klHistory = params.klHistory;\n        if (!context) {\n            return false;\n        }\n        klHistory.pause(true);\n        const input = params.input;\n        const selectedLayerIndex = params.klCanvas.getLayerIndex(context.canvas)!;\n\n        const copyCanvas = BB.copyCanvas(context.canvas);\n        let selection = params.klCanvas.getSelection();\n        const matrix = drawTransform(\n            context,\n            copyCanvas,\n            input.isPixelated,\n            input.transform,\n            selection,\n            input.bounds,\n            input.doClone,\n            input.isTransparentBg || selectedLayerIndex > 0,\n        );\n        if (selection && matrix) {\n            selection = transformMultiPolygon(selection, matrix);\n            params.klCanvas.setSelection(selection);\n        }\n        klHistory.pause(false);\n\n        {\n            const layerMap = Object.fromEntries(\n                params.klCanvas.getLayers().map((layerItem) => {\n                    if (layerItem.id === params.layer.id) {\n                        return [\n                            layerItem.id,\n                            {\n                                tiles: canvasToLayerTiles(params.layer.canvas),\n                            },\n                        ];\n                    }\n\n                    return [layerItem.id, {}];\n                }),\n            );\n            klHistory.push({\n                layerMap,\n                ...(selection ? { selection: { value: selection } } : undefined),\n            });\n        }\n        return true;\n    },\n};\n","import { KlSlider } from '../ui/components/kl-slider';\nimport { EVENT_RES_MS } from './filters-consts';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { FxPreviewRenderer } from '../ui/project-viewport/fx-preview-renderer';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { BB } from '../../bb/bb';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth } from '../ui/utils/preview-size';\nimport { applyFxFilter } from './apply-fx-filter';\nimport { css } from '../../bb/base/base';\n\nexport type TFilterBlurInput = {\n    radius: number;\n};\n\nexport const filterBlur = {\n    getDialog(params: TFilterGetDialogParam) {\n        const klCanvas = params.klCanvas;\n        const context = params.context;\n        if (!klCanvas || !context) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterBlurInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let radius = 10;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                return fxCanvas\n                    .multiplyAlpha()\n                    .triangleBlur(radius * transform.scaleX)\n                    .unmultiplyAlpha();\n            },\n            selection: klCanvas.getSelection(),\n        });\n\n        const radiusSlider = new KlSlider({\n            label: LANG('radius'),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 200,\n            value: radius,\n            eventResMs: EVENT_RES_MS,\n            onChange: (val): void => {\n                radius = val;\n                preview.render();\n            },\n        });\n        radiusSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(radiusSlider.getElement());\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image:\n                        i === selectedLayerIndex\n                            ? fxPreviewRenderer.render\n                            : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            selection: klCanvas.getSelection(),\n        });\n        preview.render();\n        css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n        rootEl.append(preview.getElement());\n\n        result.destroy = (): void => {\n            radiusSlider.destroy();\n            fxPreviewRenderer.destroy();\n            preview.destroy();\n        };\n        result.getInput = function (): TFilterBlurInput {\n            result.destroy!();\n            return {\n                radius: radius,\n            };\n        };\n\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterBlurInput>): boolean {\n        const context = params.layer.context;\n        const klHistory = params.klHistory;\n        const radius = params.input.radius;\n        if (!context || !radius) {\n            return false;\n        }\n        return applyFxFilter(\n            context,\n            params.klCanvas.getSelection(),\n            (fxCanvas) => {\n                fxCanvas.multiplyAlpha().triangleBlur(radius).unmultiplyAlpha();\n            },\n            klHistory,\n        );\n    },\n};\n","import { KlSlider } from '../ui/components/kl-slider';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { FxPreviewRenderer } from '../ui/project-viewport/fx-preview-renderer';\nimport { BB } from '../../bb/bb';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth } from '../ui/utils/preview-size';\nimport { applyFxFilter } from './apply-fx-filter';\nimport { css } from '../../bb/base/base';\n\nexport type TFilterUnsharpMaskInput = {\n    radius: number;\n    strength: number;\n};\n\nexport const filterUnsharpMask = {\n    getDialog(params: TFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterUnsharpMaskInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let radius = 2,\n            strength = 5.1 / 10;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                return fxCanvas.unsharpMask(radius * transform.scaleX, strength);\n            },\n            selection: klCanvas.getSelection(),\n        });\n\n        function update() {\n            preview.render();\n        }\n\n        const radiusSlider = new KlSlider({\n            label: LANG('radius'),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 200,\n            value: 2,\n            //eventResMs: eventResMs,\n            onChange: function (val) {\n                radius = val;\n                update();\n            },\n            curve: [\n                [0, 0],\n                [0.1, 2],\n                [0.5, 50],\n                [1, 200],\n            ],\n        });\n        const strengthSlider = new KlSlider({\n            label: LANG('filter-unsharp-mask-strength'),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 50,\n            value: 5.1,\n            //eventResMs: eventResMs,\n            onChange: function (val) {\n                strength = val / 10;\n                update();\n            },\n            curve: [\n                [0, 0],\n                [0.1, 2],\n                [0.5, 10],\n                [1, 50],\n            ],\n        });\n        radiusSlider.getElement().style.marginBottom = '10px';\n        strengthSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(radiusSlider.getElement());\n        rootEl.append(strengthSlider.getElement());\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image:\n                        i === selectedLayerIndex\n                            ? fxPreviewRenderer.render\n                            : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            selection: klCanvas.getSelection(),\n        });\n        update();\n        css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n        rootEl.append(preview.getElement());\n\n        result.destroy = (): void => {\n            radiusSlider.destroy();\n            strengthSlider.destroy();\n            fxPreviewRenderer.destroy();\n            preview.destroy();\n        };\n        result.getInput = function (): TFilterUnsharpMaskInput {\n            result.destroy!();\n            return {\n                radius: radius,\n                strength: strength,\n            };\n        };\n\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterUnsharpMaskInput>): boolean {\n        const context = params.layer.context;\n        const klHistory = params.klHistory;\n        const radius = params.input.radius;\n        const strength = params.input.strength;\n        if (!context || radius === null || strength === null) {\n            return false;\n        }\n        return applyFxFilter(\n            context,\n            params.klCanvas.getSelection(),\n            (fxCanvas) => {\n                fxCanvas.unsharpMask(radius, strength);\n            },\n            klHistory,\n        );\n    },\n};\n","import { Options } from '../ui/components/options';\nimport { ColorOptions } from '../ui/components/color-options';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult, TRgba } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { FxPreviewRenderer } from '../ui/project-viewport/fx-preview-renderer';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { BB } from '../../bb/bb';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth } from '../ui/utils/preview-size';\nimport { applyFxFilter } from './apply-fx-filter';\nimport { css } from '../../bb/base/base';\n\nexport type TFilterToAlphaInput = {\n    sourceId: string;\n    selectedRgbaObj: TRgba | null;\n};\n\nexport const filterToAlpha = {\n    getDialog(params: TFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterToAlphaInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas) => {\n                return fxCanvas.toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj);\n            },\n            selection: klCanvas.getSelection(),\n        });\n\n        // source\n        let sourceId = 'inverted-luminance';\n        const sourceOptions = new Options({\n            optionArr: [\n                {\n                    id: 'inverted-luminance',\n                    label: LANG('filter-to-alpha-inverted-lum'),\n                },\n                {\n                    id: 'luminance',\n                    label: LANG('filter-to-alpha-lum'),\n                },\n            ],\n            initId: sourceId,\n            onChange: function (id) {\n                sourceId = id;\n                preview.render();\n            },\n        });\n        rootEl.append(sourceOptions.getElement());\n\n        // color\n        let selectedRgbaObj: TRgba | null = { r: 0, g: 0, b: 0, a: 1 };\n        const colorOptionsArr = [\n            null,\n            { r: 0, g: 0, b: 0, a: 1 },\n            { r: 255, g: 255, b: 255, a: 1 },\n            {\n                r: params.currentColorRgb.r,\n                g: params.currentColorRgb.g,\n                b: params.currentColorRgb.b,\n                a: 1,\n            },\n            {\n                r: params.secondaryColorRgb.r,\n                g: params.secondaryColorRgb.g,\n                b: params.secondaryColorRgb.b,\n                a: 1,\n            },\n        ];\n\n        const colorOptions = new ColorOptions({\n            label: LANG('filter-to-alpha-replace'),\n            colorArr: colorOptionsArr,\n            initialIndex: 1,\n            onChange: function (rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                preview.render();\n            },\n            css: {\n                margin: '10px 0',\n            },\n        });\n        rootEl.append(colorOptions.getElement());\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image:\n                        i === selectedLayerIndex\n                            ? fxPreviewRenderer.render\n                            : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            selection: klCanvas.getSelection(),\n        });\n        preview.render();\n        css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n        rootEl.append(preview.getElement());\n\n        result.destroy = (): void => {\n            sourceOptions.destroy();\n            colorOptions.destroy();\n            fxPreviewRenderer.destroy();\n            preview.destroy();\n        };\n        result.getInput = function (): TFilterToAlphaInput {\n            result.destroy!();\n            return {\n                sourceId: sourceId,\n                selectedRgbaObj: selectedRgbaObj,\n            };\n        };\n\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterToAlphaInput>): boolean {\n        const context = params.layer.context;\n        const klHistory = params.klHistory;\n        const sourceId = params.input.sourceId;\n        const selectedRgbaObj = params.input.selectedRgbaObj;\n        if (!context || !sourceId) {\n            return false;\n        }\n        return applyFxFilter(\n            context,\n            params.klCanvas.getSelection(),\n            (fxCanvas) => {\n                fxCanvas.toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj);\n            },\n            klHistory,\n        );\n    },\n};\n","import { BB } from '../../bb/bb';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { input } from '../ui/components/input';\nimport { ColorOptions } from '../ui/components/color-options';\nimport { drawGrid } from '../image-operations/draw-grid';\nimport { css, throwIfNull } from '../../bb/base/base';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth } from '../ui/utils/preview-size';\nimport { canvasToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\n\nexport type TFilterGridInput = {\n    x: number;\n    y: number;\n    thickness: number;\n    color: string;\n    opacity: number;\n};\n\nexport const filterGrid = {\n    getDialog(params: TFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterGridInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const settingsObj: TFilterGridInput = {\n            x: 2,\n            y: 2,\n            thickness: 8,\n            color: '#000',\n            opacity: 1,\n        };\n\n        const line1 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n        const line2 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n                marginBottom: '10px',\n            },\n        });\n        const xInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: { width: '75px', marginRight: '20px' },\n            callback: function (v) {\n                settingsObj.x = parseFloat(v);\n                updatePreview();\n            },\n        });\n        const yInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: { width: '75px', marginRight: '20px' },\n            callback: function (v) {\n                settingsObj.y = parseFloat(v);\n                updatePreview();\n            },\n        });\n        const thicknessInput = input({\n            init: settingsObj.thickness,\n            type: 'number',\n            min: 1,\n            css: { width: '75px', marginRight: '20px' },\n            callback: function (v) {\n                settingsObj.thickness = parseFloat(v);\n                updatePreview();\n            },\n        });\n\n        let selectedRgbaObj = { r: 0, g: 0, b: 0, a: 1 };\n        const colorOptionsArr = [\n            { r: 0, g: 0, b: 0, a: 1 },\n            { r: 255, g: 255, b: 255, a: 1 },\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\n\n        const colorOptions = new ColorOptions({\n            label: LANG('shape-stroke'),\n            colorArr: colorOptionsArr,\n            onChange: function (rgbaObj) {\n                selectedRgbaObj = rgbaObj!;\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\n                updatePreview();\n            },\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            marginRight: '5px',\n        };\n        line1.append(\n            BB.el({ content: 'X:', css: labelStyle }),\n            xInput,\n            BB.el({ content: 'Y:', css: labelStyle }),\n            yInput,\n        );\n        line2.append(\n            BB.el({ content: LANG('shape-line-width') + ':', css: labelStyle }),\n            thicknessInput,\n            BB.el({ css: { flexGrow: '1' } }),\n            colorOptions.getElement(),\n        );\n\n        const previewCanvas = BB.canvas(context.canvas.width, context.canvas.height);\n        const previewCtx = BB.ctx(previewCanvas);\n        const previewLayerArr = layers.map((item, i) => {\n            return {\n                image: i === selectedLayerIndex ? previewCanvas : item.context.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                hasClipping: false,\n            };\n        });\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n        });\n        css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n        rootEl.append(preview.getElement());\n\n        function updatePreview(): void {\n            const ctx = previewCtx;\n            ctx.save();\n            ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\n            ctx.drawImage(context.canvas, 0, 0);\n            drawGrid(\n                ctx,\n                settingsObj.x,\n                settingsObj.y,\n                Math.max(settingsObj.thickness, 1),\n                settingsObj.color,\n                settingsObj.opacity,\n            );\n            ctx.restore();\n            preview.render();\n        }\n        updatePreview();\n        preview.render();\n\n        result.destroy = (): void => {\n            preview.destroy();\n            BB.freeCanvas(previewCanvas);\n            colorOptions.destroy();\n        };\n        result.getInput = function (): TFilterGridInput {\n            result.destroy!();\n            return BB.copyObj(settingsObj);\n        };\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterGridInput>): boolean {\n        const context = params.layer.context;\n        const klCanvas = params.klCanvas;\n        const klHistory = params.klHistory;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        drawGrid(\n            context,\n            params.input.x,\n            params.input.y,\n            params.input.thickness,\n            params.input.color,\n            params.input.opacity,\n        );\n        {\n            const layerMap = Object.fromEntries(\n                params.klCanvas.getLayers().map((layerItem) => {\n                    if (layerItem.id === params.layer.id) {\n                        return [\n                            layerItem.id,\n                            {\n                                tiles: canvasToLayerTiles(params.layer.canvas),\n                            },\n                        ];\n                    }\n\n                    return [layerItem.id, {}];\n                }),\n            );\n            klHistory.push({\n                layerMap,\n            });\n        }\n        return true;\n    },\n};\n","// ideas: padding, gutter, other shapes\n\nexport function drawGrid(\n    ctx: CanvasRenderingContext2D,\n    cellsX: number,\n    cellsY: number,\n    thickness: number, // px\n    color: string,\n    opacity: number, // 0 - 1\n): void {\n    ctx.save();\n    const w = ctx.canvas.width;\n    const h = ctx.canvas.height;\n    thickness = Math.round(thickness);\n    const thickIsRound = thickness % 2 === 0;\n\n    ctx.beginPath();\n    ctx.lineWidth = thickness;\n    ctx.strokeStyle = color;\n    ctx.globalAlpha = opacity;\n\n    for (let i = 0; i < cellsX - 1; i++) {\n        const cw = w / cellsX;\n        let pos = cw * (i + 1);\n        if (thickIsRound) {\n            pos = Math.round(pos);\n        } else {\n            pos = Math.round(pos + 0.5) - 0.5;\n        }\n        ctx.moveTo(pos, 0);\n        ctx.lineTo(pos, h);\n    }\n    for (let i = 0; i < cellsY - 1; i++) {\n        const ch = h / cellsY;\n        let pos = ch * (i + 1);\n        if (thickIsRound) {\n            pos = Math.round(pos);\n        } else {\n            pos = Math.round(pos + 0.5) - 0.5;\n        }\n\n        ctx.moveTo(0, pos);\n        ctx.lineTo(w, pos);\n    }\n\n    ctx.stroke();\n    ctx.restore();\n}\n","import { BB } from '../../bb/bb';\nimport {\n    TFilterApply,\n    TFilterGetDialogParam,\n    TFilterGetDialogResult,\n    TMixMode,\n    TRgb,\n} from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport { getSharedFx } from '../../fx-canvas/shared-fx';\nimport { Options } from '../ui/components/options';\nimport { EVENT_RES_MS } from './filters-consts';\nimport { Select } from '../ui/components/select';\nimport { translateBlending } from '../canvas/translate-blending';\nimport { KL } from '../kl';\nimport { ColorConverter } from '../../bb/color/color';\nimport { Checkbox } from '../ui/components/checkbox';\nimport { TWrappedTexture } from '../../fx-canvas/fx-canvas-types';\nimport { css, throwIfNull } from '../../bb/base/base';\nimport { FxPreviewRenderer } from '../ui/project-viewport/fx-preview-renderer';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { getPreviewHeight, getPreviewWidth } from '../ui/utils/preview-size';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { canvasToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\nimport { noise } from '../../fx-canvas/filters/noise';\nimport { drawSelectionMask } from '../../bb/base/canvas';\nimport { getPushableLayerChange } from '../history/push-helpers/get-pushable-layer-change';\nimport { integerBounds } from '../../bb/math/math';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\n\n// see noise(...) in fx-canvas\ntype TNoisePreset = {\n    type: number;\n    scaleX: number;\n    scaleY: number;\n    offsetX: number;\n    offsetY: number;\n    octaves: number;\n    samples: number;\n    peaks: number;\n    brightness: number;\n    contrast: number;\n    isReversed: boolean;\n};\n\ntype TNoiseChannels = 'rgb' | 'alpha';\n\ntype TNoiseSettings = TNoisePreset & {\n    seed?: number;\n    colA?: TRgb;\n    colB?: TRgb;\n    channels?: TNoiseChannels; // default rgb\n};\n\nexport type TFilterNoiseInput = {\n    seed: number;\n    presetIndex: number; // which preset from presetArr\n    scale: number; // applies to both scaleX and scaleX\n    opacity: number; // aka strength\n    isReversed: boolean; // reverse direction of color gradient\n    channels: TNoiseChannels;\n\n    // only for channels = rgb\n    mixModeStr: GlobalCompositeOperation; // how mixed with image\n    colA: TRgb;\n    colB: TRgb;\n};\n\nconst presetArr: TNoisePreset[] = [\n    // each pixel random value\n    {\n        type: 0,\n        scaleX: 1,\n        scaleY: 1,\n        offsetX: 0,\n        offsetY: 0,\n        octaves: 1,\n        samples: 1,\n        peaks: 0,\n        brightness: 0,\n        contrast: 0,\n        isReversed: true,\n    },\n\n    // cloud\n    {\n        type: 1,\n        scaleX: 166,\n        scaleY: 164,\n        offsetX: 105,\n        offsetY: 30,\n        octaves: 6,\n        samples: 1,\n        peaks: 0,\n        brightness: 0.055,\n        contrast: 0.23,\n        isReversed: true,\n    },\n\n    // thin lines\n    {\n        type: 1,\n        scaleX: 235,\n        scaleY: 190,\n        offsetX: 3227,\n        offsetY: 2156,\n        octaves: 4,\n        samples: 16,\n        peaks: 22,\n        brightness: -0.375,\n        contrast: 1,\n        isReversed: false,\n    },\n\n    // soft large simplex, only 1 octave\n    {\n        type: 1,\n        scaleX: 40,\n        scaleY: 40,\n        offsetX: 0,\n        offsetY: 0,\n        octaves: 1,\n        samples: 1,\n        peaks: 0,\n        brightness: 0,\n        contrast: 0,\n        isReversed: false,\n    },\n\n    // two value large pixels\n    {\n        type: 0,\n        scaleX: 26,\n        scaleY: 26,\n        offsetX: 557,\n        offsetY: 365,\n        octaves: 1,\n        samples: 1,\n        peaks: 0,\n        brightness: 0.02,\n        contrast: 1,\n        isReversed: true,\n    },\n\n    // zebra\n    {\n        type: 1,\n        scaleX: 1500,\n        scaleY: 1500,\n        offsetX: 745,\n        offsetY: 2871,\n        octaves: 5,\n        samples: 16,\n        peaks: 156.02,\n        brightness: 0.03,\n        contrast: 1,\n        isReversed: true,\n    },\n\n    // sparse dots / stars\n    {\n        type: 1,\n        scaleX: 11,\n        scaleY: 11,\n        offsetX: 2940,\n        offsetY: 2045,\n        octaves: 1,\n        samples: 16,\n        peaks: 1,\n        brightness: -0.045,\n        contrast: 1,\n        isReversed: true,\n    },\n\n    // pseudo marble\n    {\n        type: 2,\n        scaleX: 74,\n        scaleY: 74,\n        offsetX: 4816,\n        offsetY: 1304,\n        octaves: 3,\n        samples: 1,\n        peaks: 2.78,\n        brightness: 0,\n        contrast: 0,\n        isReversed: false,\n    },\n];\n\nfunction createNoiseSettings(input: TFilterNoiseInput): TNoiseSettings {\n    const result: TNoiseSettings = BB.copyObj(presetArr[input.presetIndex]) as TNoiseSettings;\n    result.seed = input.seed;\n    result.scaleX = (result.scaleX * input.scale) / 50;\n    result.scaleY = (result.scaleY * input.scale) / 50;\n    result.colA = input.colA;\n    result.colB = input.colB;\n    result.isReversed = input.isReversed ? !result.isReversed : result.isReversed;\n    result.channels = input.channels;\n    return result;\n}\n\nfunction createNoiseParameters(settings: TNoiseSettings): Parameters<typeof noise> {\n    return [\n        settings.seed,\n        settings.type,\n        [settings.scaleX, settings.scaleY],\n        [settings.offsetX, settings.offsetY],\n        settings.octaves,\n        settings.samples,\n        settings.peaks,\n        settings.brightness,\n        settings.contrast,\n        settings.isReversed,\n        settings.colA,\n        settings.colB,\n        settings.channels ? settings.channels : 'rgb',\n    ];\n}\n\nexport const filterNoise = {\n    getDialog(params: TFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const thumbImgArr: HTMLImageElement[] = [];\n        const thumbSize = 32;\n        {\n            const fxCanvas = throwIfNull(getSharedFx());\n            const canvas = BB.canvas(thumbSize, thumbSize);\n            const ctx = BB.ctx(canvas);\n            const texture = fxCanvas.texture(canvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            texture.destroy();\n\n            presetArr.forEach((preset) => {\n                const thumbImg = new Image();\n                const settings = BB.copyObj(preset) as TNoiseSettings;\n                settings.scaleX /= 10;\n                settings.scaleY /= 10;\n                fxCanvas.noise(...createNoiseParameters(settings)).update();\n                ctx.drawImage(fxCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL('image/png');\n                thumbImgArr.push(thumbImg);\n            });\n\n            texture.destroy();\n        }\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterNoiseInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const noiseInput: TFilterNoiseInput = {\n            seed: Math.random() * 300,\n            presetIndex: 0,\n            scale: 50,\n            opacity: 0.5,\n            isReversed: false,\n            channels: 'rgb',\n            mixModeStr: 'source-over' as GlobalCompositeOperation,\n            colA: { r: 0, g: 0, b: 0 },\n            colB: { r: 255, g: 255, b: 255 },\n        };\n\n        const presetOptions = new Options({\n            optionArr: thumbImgArr.map((img, index) => {\n                css(img, {\n                    margin: '1px',\n                    borderRadius: '3px',\n                    transition: 'all 0.1s ease-in-out',\n                });\n                return {\n                    id: '' + index,\n                    label: img,\n                };\n            }),\n            initId: '0',\n            onChange: (id) => {\n                noiseInput.presetIndex = Number(id);\n                update();\n            },\n            css: {\n                marginBottom: '10px',\n            },\n        });\n        rootEl.append(presetOptions.getElement());\n\n        const scaleSlider = new KlSlider({\n            label: LANG('filter-noise-scale'),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 1000,\n            value: noiseInput.scale,\n            eventResMs: EVENT_RES_MS,\n            curve: BB.powerSplineInput(1, 1000, 0.1),\n            onChange: (value) => {\n                noiseInput.scale = value;\n                update();\n            },\n        });\n        scaleSlider.getElement().style.marginBottom = '10px';\n\n        const opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 300,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: noiseInput.opacity,\n            eventResMs: EVENT_RES_MS,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: (value) => {\n                noiseInput.opacity = value;\n                update();\n            },\n        });\n        opacitySlider.getElement().style.marginBottom = '10px';\n\n        const row1El = BB.el({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginBottom: '10px',\n            },\n        });\n\n        const row2El = BB.el({\n            css: {\n                display: 'flex',\n                marginBottom: '10px',\n            },\n        });\n\n        const channelsOptions = new Options<TNoiseChannels>({\n            optionArr: [\n                { id: 'rgb', label: 'RGB' },\n                { id: 'alpha', label: LANG('filter-noise-alpha') },\n            ],\n            initId: 'rgb',\n            onChange: (id: TNoiseChannels) => {\n                noiseInput.channels = id;\n                if (id === 'rgb') {\n                    row2El.style.visibility = '';\n                } else {\n                    row2El.style.visibility = 'hidden';\n                }\n                update();\n            },\n        });\n\n        const reverseToggle = new Checkbox({\n            label: LANG('reverse'),\n            callback: (val) => {\n                noiseInput.isReversed = val;\n                update();\n            },\n            allowTab: true,\n            name: 'reverse-gradient',\n        });\n\n        const mixModes: (TMixMode | undefined)[] = [\n            'source-over',\n            undefined,\n            'darken',\n            'multiply',\n            'color-burn',\n            undefined,\n            'lighten',\n            'screen',\n            'color-dodge',\n            undefined,\n            'overlay',\n            'soft-light',\n            'hard-light',\n            undefined,\n            'difference',\n            'exclusion',\n            undefined,\n            'hue',\n            'saturation',\n            'color',\n            'luminosity',\n        ];\n\n        const blendSelect = new Select({\n            isFocusable: true,\n            optionArr: mixModes.map((item) => {\n                return item ? ([item, translateBlending(item)] as [TMixMode, string]) : undefined;\n            }),\n            initValue: noiseInput.mixModeStr,\n            onChange: (val: GlobalCompositeOperation) => {\n                noiseInput.mixModeStr = val;\n                update();\n            },\n            name: 'blend-mode',\n        });\n        blendSelect.getElement().title = LANG('layers-blending');\n\n        const colorWrapper = BB.el({\n            css: {\n                display: 'flex',\n            },\n        });\n\n        const colInputStyle = {\n            width: '34px',\n            height: '34px',\n            marginRight: '5px',\n        };\n        const colAInput = KL.input({\n            type: 'color',\n            init: '#' + ColorConverter.toHexString(noiseInput.colA),\n            callback: (val) => {\n                const newColor = ColorConverter.hexToRGB(val);\n                if (newColor) {\n                    noiseInput.colA = newColor;\n                    update();\n                }\n            },\n            css: colInputStyle,\n        });\n\n        const colBInput = KL.input({\n            type: 'color',\n            init: '#' + ColorConverter.toHexString(noiseInput.colB),\n            callback: (val) => {\n                const newColor = ColorConverter.hexToRGB(val);\n                if (newColor) {\n                    noiseInput.colB = newColor;\n                    update();\n                }\n            },\n            css: colInputStyle,\n        });\n\n        colorWrapper.append(colAInput, colBInput);\n\n        row1El.append(\n            channelsOptions.getElement(),\n            BB.el({ css: { flexGrow: '1' } }),\n            reverseToggle.getElement(),\n        );\n\n        row2El.append(blendSelect.getElement(), BB.el({ css: { flexGrow: '1' } }), colorWrapper);\n\n        rootEl.append(scaleSlider.getElement(), opacitySlider.getElement(), row1El, row2El);\n\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                const settings = createNoiseSettings(noiseInput);\n                settings.scaleX *= transform.scaleX;\n                settings.scaleY *= transform.scaleY;\n                settings.offsetX = (context.canvas.width / 2) * transform.scaleX + transform.x;\n                settings.offsetY = (context.canvas.height / 2) * transform.scaleY + transform.y;\n                return fxCanvas.noise(...createNoiseParameters(settings));\n            },\n            postMix: {\n                opacity: noiseInput.opacity,\n                operation:\n                    noiseInput.channels === 'alpha' ? 'destination-out' : noiseInput.mixModeStr,\n            },\n            selection: klCanvas.getSelection(),\n            isMaskingWithEmptyOriginal: true,\n        });\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image:\n                        i === selectedLayerIndex\n                            ? fxPreviewRenderer.render\n                            : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            selection: klCanvas.getSelection(),\n        });\n        preview.render();\n        css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n        rootEl.append(preview.getElement());\n\n        function update(): void {\n            fxPreviewRenderer.setPostMix({\n                opacity: noiseInput.opacity,\n                operation:\n                    noiseInput.channels === 'alpha' ? 'destination-out' : noiseInput.mixModeStr,\n            });\n            preview.render();\n        }\n\n        result.destroy = (): void => {\n            presetOptions.destroy();\n            scaleSlider.destroy();\n            opacitySlider.destroy();\n            reverseToggle.destroy();\n            channelsOptions.destroy();\n            blendSelect.destroy();\n            preview.destroy();\n            fxPreviewRenderer.destroy();\n        };\n        result.getInput = function (): TFilterNoiseInput {\n            result.destroy!();\n            return BB.copyObj(noiseInput);\n        };\n\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterNoiseInput>): boolean {\n        const context = params.layer.context;\n        const klCanvas = params.klCanvas;\n        const klHistory = params.klHistory;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n\n        const input = params.input;\n        const selection = klCanvas.getSelection();\n        let maskTexture: TWrappedTexture | undefined;\n        if (selection) {\n            const maskCanvas = BB.canvas(context.canvas.width, context.canvas.height);\n            const maskContext = BB.ctx(maskCanvas);\n            drawSelectionMask(selection, maskContext);\n            maskTexture = fxCanvas.texture(maskCanvas);\n            BB.freeCanvas(maskCanvas);\n        }\n        fxCanvas.initialize(context.canvas.width, context.canvas.height);\n        {\n            const settings = createNoiseSettings(input);\n            settings.offsetX = context.canvas.width / 2;\n            settings.offsetY = context.canvas.height / 2;\n            fxCanvas.noise(...createNoiseParameters(settings)).update();\n        }\n        if (maskTexture) {\n            fxCanvas.multiplyAlpha().mask(maskTexture).unmultiplyAlpha();\n            maskTexture.destroy();\n        }\n        fxCanvas.update();\n\n        context.save();\n        context.globalAlpha = input.opacity;\n        if (input.channels === 'alpha') {\n            context.globalCompositeOperation = 'destination-out';\n        } else {\n            context.globalCompositeOperation = input.mixModeStr;\n        }\n        context.drawImage(fxCanvas, 0, 0);\n        context.restore();\n\n        klHistory.push(\n            getPushableLayerChange(\n                klHistory.getComposed(),\n                canvasToLayerTiles(\n                    context.canvas,\n                    selection ? integerBounds(getMultiPolyBounds(selection)) : undefined,\n                ),\n            ),\n        );\n        return true;\n    },\n};\n","import { BB } from '../../bb/bb';\nimport {\n    TFilterApply,\n    TFilterGetDialogParam,\n    TFilterGetDialogResult,\n    TKlBasicLayer,\n} from '../kl-types';\nimport { input } from '../ui/components/input';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport { LANG } from '../../language/language';\nimport { EVENT_RES_MS } from './filters-consts';\nimport { KlCanvasPreview } from '../ui/project-viewport/kl-canvas-preview';\nimport { TwoTabs } from '../ui/components/two-tabs';\nimport { TVector2D } from '../../bb/bb-types';\nimport { css, throwIfNull } from '../../bb/base/base';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth, MEDIUM_PREVIEW } from '../ui/utils/preview-size';\nimport { canvasToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\n\nexport type TFilterPatternInput = {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    blend: number; // [0, 1] - 1 will blend linearly across whole length\n    offsetX: number;\n    offsetY: number;\n};\n\n/**\n * Draws pattern onto context. Pattern generated from context.\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\n *\n * @param context\n * @param settings\n */\nfunction drawPattern(context: CanvasRenderingContext2D, settings: TFilterPatternInput): void {\n    // keep bounds in center via offset\n    // because blending done towards bottom right\n    const blendOffsetX = settings.blend ? Math.round((settings.blend * settings.width) / 2) : 0;\n    const blendOffsetY = settings.blend ? Math.round((settings.blend * settings.height) / 2) : 0;\n\n    const finalPatternCanvas = BB.canvas(settings.width, settings.height);\n\n    if (settings.blend) {\n        // construct pattern via linear blending\n\n        const blendCanvas = BB.canvas(settings.width * 2, settings.height * 2);\n        const blendCtx = BB.ctx(blendCanvas);\n        const colTransparent = '#0000';\n        const colOpaque = '#000';\n\n        // transfer source to blendCanvas\n        blendCtx.drawImage(context.canvas, -settings.x + blendOffsetX, -settings.y + blendOffsetY);\n\n        // --- 1 cross-fade vertical ------------------------\n\n        // erase vertical gradient bottom half\n        blendCtx.save();\n        let blendGradient = blendCtx.createLinearGradient(\n            0,\n            settings.height,\n            0,\n            settings.height * 2,\n        );\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n\n        // erase vertical gradient top half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n\n        // draw bottom half over top half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = 'lighter';\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\n        blendCtx.restore();\n\n        // --- 2 cross-fade horizontal ------------------------\n\n        // erase horizontal gradient right half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n\n        // erase horizontal gradient left half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n\n        // draw right half over left half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = 'lighter';\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\n        blendCtx.restore();\n\n        // transfer to pattern canvas\n        BB.ctx(finalPatternCanvas).drawImage(blendCanvas, 0, 0);\n    } else {\n        BB.ctx(finalPatternCanvas).drawImage(context.canvas, -settings.x, -settings.y);\n    }\n\n    context.save();\n\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\n    context.fillStyle = throwIfNull(context.createPattern(finalPatternCanvas, 'repeat'));\n    context.fillRect(\n        -settings.offsetX + blendOffsetX,\n        -settings.offsetY + blendOffsetY,\n        context.canvas.width,\n        context.canvas.height,\n    );\n\n    context.restore();\n}\n\nexport const filterPattern = {\n    getDialog(params: TFilterGetDialogParam) {\n        const isSmall = testIsSmall();\n        const maxSize = 1024;\n        const rootEl = BB.el();\n        const context = params.context;\n        const width = context.canvas.width;\n        const height = context.canvas.height;\n\n        let settings: TFilterPatternInput = {\n            x: 0,\n            y: 0,\n            width: width <= 250 ? Math.round(width / 4) : 200,\n            height: height <= 250 ? Math.round(height / 4) : 200,\n            blend: 0,\n            offsetX: 0,\n            offsetY: 0,\n        };\n        let lastDrawnSettings: TFilterPatternInput | undefined;\n\n        // determine bounds\n        const bounds = BB.canvasBounds(context);\n        // adjust settings according to bounds\n        if (\n            // use layer bounds if:\n            bounds &&\n            bounds.width <= maxSize &&\n            bounds.height <= maxSize && // don't exceed max size\n            (bounds.width < width * 0.75 || bounds.height < height * 0.75) // aren't too large (heuristic)\n        ) {\n            settings.x = bounds.x;\n            settings.y = bounds.y;\n            settings.width = bounds.width;\n            settings.height = bounds.height;\n        } else {\n            // otherwise use default size in center\n            settings.x = Math.round(width / 2 - settings.width / 2);\n            settings.y = Math.round(height / 2 - settings.height / 2);\n        }\n\n        // ---- controls ----\n\n        const xInput = input({\n            init: settings.x,\n            type: 'number',\n            min: 0,\n            max: width,\n            css: { width: '100%' },\n            callback: function (v) {\n                settings.x = Number(v);\n                updatePreview();\n            },\n        });\n        const yInput = input({\n            init: settings.y,\n            type: 'number',\n            min: 0,\n            max: height,\n            css: { width: '100%' },\n            callback: function (v) {\n                settings.y = Number(v);\n                updatePreview();\n            },\n        });\n        const widthInput = input({\n            init: settings.width,\n            type: 'number',\n            min: 1,\n            max: Math.min(maxSize, width),\n            css: { width: '100%' },\n            callback: function (v) {\n                settings.width = Number(v);\n                updatePreview();\n            },\n        });\n        const heightInput = input({\n            init: settings.height,\n            type: 'number',\n            min: 1,\n            max: Math.min(maxSize, height),\n            css: { width: '100%' },\n            callback: function (v) {\n                settings.height = Number(v);\n                updatePreview();\n            },\n        });\n\n        const inputStyle = {\n            marginLeft: '5px',\n            flex: '1',\n        };\n        rootEl.append(\n            BB.el({\n                content: [\n                    BB.el({\n                        tagName: 'label',\n                        content: ['X:', xInput],\n                        css: inputStyle,\n                    }),\n\n                    BB.el({\n                        tagName: 'label',\n                        content: ['Y:', yInput],\n                        css: inputStyle,\n                    }),\n\n                    BB.el({\n                        tagName: 'label',\n                        content: [LANG('width') + ':', widthInput],\n                        css: inputStyle,\n                    }),\n\n                    BB.el({\n                        tagName: 'label',\n                        content: [LANG('height') + ':', heightInput],\n                        css: inputStyle,\n                    }),\n                ],\n                css: {\n                    display: 'flex',\n                    marginLeft: '-5px',\n                },\n            }),\n        );\n\n        const blendSlider = new KlSlider({\n            label: LANG('brush-blending'),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 1,\n            value: settings.blend,\n            eventResMs: EVENT_RES_MS,\n            onChange: function (val) {\n                settings.blend = val;\n                updatePreview();\n            },\n            formatFunc: (val) => {\n                return BB.round(val, 2);\n            },\n            manualInputRoundDigits: 2,\n        });\n        css(blendSlider.getElement(), {\n            margin: '10px 0',\n        });\n\n        rootEl.append(blendSlider.getElement());\n\n        // ---- preview tabs ----\n        let previewMode = 1; // 0 before, 1 after\n        const beforeAfterTabs = new TwoTabs({\n            left: LANG('compare-before'),\n            right: LANG('compare-after'),\n            init: previewMode,\n            onChange: (val) => {\n                previewMode = val;\n                overlayCanvas.style.display = val === 0 ? 'block' : 'none';\n                updatePreview(true);\n            },\n        });\n        rootEl.append(beforeAfterTabs.getElement());\n\n        // ---- previews ----\n\n        const klCanvas = params.klCanvas;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const fit = BB.fitInto(\n            context.canvas.width,\n            context.canvas.height,\n            isSmall ? 280 : 490,\n            isSmall ? 200 : 240,\n            1,\n        );\n        const w = parseInt('' + fit.width),\n            h = parseInt('' + fit.height);\n        const renderW = Math.min(w, context.canvas.width);\n        const renderH = Math.min(h, context.canvas.height);\n        // const renderFactor = renderW / context.canvas.width;\n        const previewFactor = w / context.canvas.width;\n\n        const previewWrapper = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: getPreviewWidth(isSmall) + 'px',\n                height: getPreviewHeight(isSmall) + 'px',\n                marginTop: '0',\n            },\n        });\n\n        const previewLayer: TKlBasicLayer = {\n            image: BB.canvas(renderW, renderH),\n            isVisible: layers[selectedLayerIndex].isVisible,\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\n        };\n        const previewLayerArr = layers.map((item, i) => {\n            if (i === selectedLayerIndex) {\n                return previewLayer;\n            } else {\n                return {\n                    image: item.context.canvas,\n                    isVisible: item.isVisible,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr,\n                };\n            }\n        });\n        const klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: previewLayerArr,\n        });\n\n        const overlayCanvas = BB.canvas(w, h);\n        css(overlayCanvas, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            mixBlendMode: 'difference',\n            imageRendering: 'pixelated',\n        });\n\n        const previewInnerWrapper = BB.el({\n            className: 'kl-preview-wrapper__canvas',\n            css: {\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px',\n            },\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement(), overlayCanvas);\n        previewWrapper.append(previewInnerWrapper);\n        rootEl.append(previewWrapper);\n\n        // ---- preview input processing ----\n        const inputs = {} as {\n            start: TVector2D;\n            end: TVector2D | null;\n            oldSettings: TFilterPatternInput;\n            state: null | 'move' | 'select';\n        };\n\n        function syncInputs(): void {\n            xInput.value = '' + settings.x;\n            yInput.value = '' + settings.y;\n            widthInput.value = '' + settings.width;\n            heightInput.value = '' + settings.height;\n        }\n\n        const keyListener = new BB.KeyListener({});\n\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        previewInnerWrapper.style.touchAction = 'none';\n        const pointerListener = new BB.PointerListener({\n            target: previewInnerWrapper,\n            onPointer: (event) => {\n                if (previewMode === 0) {\n                    if (event.type === 'pointerdown') {\n                        if (!inputs.state) {\n                            inputs.oldSettings = BB.copyObj(settings);\n\n                            const x = event.relX / previewFactor;\n                            const y = event.relY / previewFactor;\n\n                            if (\n                                BB.isInsideRect(\n                                    { x, y },\n                                    {\n                                        x: settings.x,\n                                        y: settings.y,\n                                        width: settings.width,\n                                        height: settings.height,\n                                    },\n                                )\n                            ) {\n                                inputs.state = 'move';\n                            } else {\n                                inputs.state = 'select';\n                            }\n                            inputs.start = { x, y };\n                        }\n                    } else if (event.type === 'pointermove') {\n                        const x = event.relX / previewFactor;\n                        const y = event.relY / previewFactor;\n\n                        if (inputs.state === 'select') {\n                            inputs.end = { x, y };\n\n                            const x1 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\n                            const y1 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\n                            const x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\n                            const y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\n\n                            settings.x = Math.floor(x1);\n                            settings.y = Math.floor(y1);\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\n\n                            if (keyListener.isPressed('shift')) {\n                                settings.width = Math.min(settings.width, settings.height);\n                                settings.height = Math.min(settings.width, settings.height);\n                            }\n\n                            if (settings.width === 0 || settings.height === 0) {\n                                settings = BB.copyObj(inputs.oldSettings);\n                            }\n\n                            syncInputs();\n                            updatePreview();\n                        } else if (inputs.state === 'move') {\n                            const dX = Math.round(x - inputs.start.x);\n                            const dY = Math.round(y - inputs.start.y);\n\n                            settings.x = BB.clamp(\n                                inputs.oldSettings.x + dX,\n                                0,\n                                width - settings.width,\n                            );\n                            settings.y = BB.clamp(\n                                inputs.oldSettings.y + dY,\n                                0,\n                                height - settings.height,\n                            );\n\n                            syncInputs();\n                            updatePreview();\n                        }\n                    } else if (event.type === 'pointerup') {\n                        if (inputs.state) {\n                            inputs.state = null;\n                        }\n                    }\n                } else {\n                    if (event.type === 'pointerdown') {\n                        if (!inputs.state) {\n                            inputs.state = 'move';\n                            inputs.oldSettings = BB.copyObj(settings);\n                            inputs.start = {\n                                x: event.relX / previewFactor,\n                                y: event.relY / previewFactor,\n                            };\n                            inputs.end = null;\n                        }\n                    } else if (event.type === 'pointermove') {\n                        if (inputs.state) {\n                            inputs.end = {\n                                x: event.relX / previewFactor,\n                                y: event.relY / previewFactor,\n                            };\n\n                            settings.offsetX =\n                                Math.round(inputs.end.x - inputs.start.x) +\n                                inputs.oldSettings.offsetX;\n                            settings.offsetY =\n                                Math.round(inputs.end.y - inputs.start.y) +\n                                inputs.oldSettings.offsetY;\n\n                            updatePreview();\n                        }\n                    } else if (event.type === 'pointerup') {\n                        if (inputs.state) {\n                            if (!inputs.end) {\n                                settings.offsetX = 0;\n                                settings.offsetY = 0;\n                                updatePreview();\n                            }\n                            inputs.state = null;\n                        }\n                    }\n                }\n            },\n        });\n\n        // ---------- rendering ---------------------\n        const fullSizeCanvas = BB.canvas(width, height);\n        const fullSizeCtx = BB.ctx(fullSizeCanvas);\n\n        function sharpStrokeRect(\n            context: CanvasRenderingContext2D,\n            x: number,\n            y: number,\n            width: number,\n            height: number,\n        ): void {\n            const drawX = Math.round(x + 0.5) - 0.5;\n            const drawY = Math.round(y + 0.5) - 0.5;\n            const drawWidth = Math.round(x + width - drawX);\n            const drawHeight = Math.round(y + height - drawY);\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\n        }\n\n        function updatePreview(doForce?: boolean) {\n            if (\n                !doForce &&\n                lastDrawnSettings &&\n                JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)\n            ) {\n                return;\n            }\n\n            if (previewMode === 0) {\n                // before\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\n                const previewCtx = BB.ctx(previewCanvas);\n                previewCtx.save();\n                previewCtx.clearRect(0, 0, renderW, renderH);\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n                previewCtx.restore();\n\n                const pW = settings.width * previewFactor;\n                const pH = settings.height * previewFactor;\n\n                const overlayCtx = BB.ctx(overlayCanvas);\n                overlayCtx.save();\n                overlayCtx.clearRect(0, 0, w, h);\n                overlayCtx.strokeStyle = '#fff';\n                sharpStrokeRect(\n                    overlayCtx,\n                    settings.x * previewFactor,\n                    settings.y * previewFactor,\n                    pW,\n                    pH,\n                );\n                if (settings.blend > 0.05) {\n                    overlayCtx.strokeStyle = '#f0f';\n                    sharpStrokeRect(\n                        overlayCtx,\n                        settings.x * previewFactor - (pW / 2) * settings.blend,\n                        settings.y * previewFactor - (pH / 2) * settings.blend,\n                        pW * (1 + settings.blend),\n                        pH * (1 + settings.blend),\n                    );\n                }\n                overlayCtx.restore();\n            } else {\n                // after\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n                drawPattern(fullSizeCtx, settings);\n\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\n                const previewCtx = BB.ctx(previewCanvas);\n                previewCtx.clearRect(0, 0, renderW, renderH);\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n            }\n\n            klCanvasPreview.render();\n            lastDrawnSettings = BB.copyObj(settings);\n        }\n\n        updatePreview();\n\n        // ----- result -------------------\n        const destroy = () => {\n            blendSlider.destroy();\n            keyListener.destroy();\n            pointerListener.destroy();\n            klCanvasPreview.destroy();\n        };\n        const result: TFilterGetDialogResult<TFilterPatternInput> = {\n            element: rootEl,\n            destroy,\n            getInput: () => {\n                destroy();\n                return BB.copyObj(settings);\n            },\n        };\n        if (!isSmall) {\n            result.width = MEDIUM_PREVIEW.width;\n        }\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterPatternInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const ctx = params.layer.context;\n        const klHistory = params.klHistory;\n        if (!klCanvas) {\n            return false;\n        }\n        drawPattern(ctx, params.input);\n        {\n            const layerMap = Object.fromEntries(\n                params.klCanvas.getLayers().map((layerItem) => {\n                    if (layerItem.id === params.layer.id) {\n                        return [\n                            layerItem.id,\n                            {\n                                tiles: canvasToLayerTiles(params.layer.canvas),\n                            },\n                        ];\n                    }\n\n                    return [layerItem.id, {}];\n                }),\n            );\n            klHistory.push({\n                layerMap,\n            });\n        }\n        return true;\n    },\n};\n","import { BB } from '../../bb/bb';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult } from '../kl-types';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport { LANG } from '../../language/language';\nimport { EVENT_RES_MS } from './filters-consts';\nimport { getSharedFx } from '../../fx-canvas/shared-fx';\nimport { Options } from '../ui/components/options';\nimport { Checkbox } from '../ui/components/checkbox';\nimport { css, throwIfNull } from '../../bb/base/base';\nimport { TFilterDistortSettings } from '../../fx-canvas/filters/distort';\nimport { FxPreviewRenderer } from '../ui/project-viewport/fx-preview-renderer';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth, MEDIUM_PREVIEW } from '../ui/utils/preview-size';\nimport { applyFxFilter } from './apply-fx-filter';\n\n// see fx-canvas distort\nexport type TFilterDistortInput = {\n    stepSize: number; // [0, inf]\n    distortType: 0 | 1 | 2;\n    scale: { x: number; y: number };\n    strength: { x: number; y: number };\n    phase: { x: number; y: number };\n    offset: { x: number; y: number };\n};\n\nexport const filterDistort = {\n    getDialog(params: TFilterGetDialogParam) {\n        const isSmall = testIsSmall();\n        const rootEl = BB.el();\n        const context = params.context;\n\n        let isSynced = true;\n        const settings: TFilterDistortInput = {\n            stepSize: 1,\n            distortType: 0,\n            scale: { x: 100, y: 100 },\n            strength: { x: 20, y: 20 },\n            phase: { x: 0, y: 0 },\n            offset: { x: 0, y: 0 },\n        };\n        // let lastDrawnSettings = null;\n\n        // ---- thumb -------\n        const thumbImgArr: HTMLImageElement[] = [];\n        const thumbSize = 32;\n        {\n            const canvas = BB.canvas(thumbSize, thumbSize);\n            const ctx = BB.ctx(canvas);\n\n            ctx.beginPath();\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\n            ctx.fill();\n\n            let gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\n            gradient.addColorStop(0, '#00f');\n            gradient.addColorStop(0.5, '#f00');\n            gradient.addColorStop(1, '#fff');\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = 'source-atop';\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\n            gradient.addColorStop(0, '#000');\n            gradient.addColorStop(1, '#000');\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = 'destination-atop';\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n\n            const fxCanvas = throwIfNull(getSharedFx());\n            const texture = fxCanvas.texture(canvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n\n            const scaleFactor = 20;\n\n            ([0, 1, 2] as const).forEach((item) => {\n                const thumbImg = new Image();\n                const settingsCopy: TFilterDistortSettings = BB.copyObj(settings);\n                settingsCopy.distortType = item;\n                settingsCopy.scale.x /= scaleFactor;\n                settingsCopy.scale.y /= scaleFactor;\n                settingsCopy.strength.x /= scaleFactor;\n                settingsCopy.strength.y /= scaleFactor;\n                fxCanvas\n                    .draw(texture)\n                    .multiplyAlpha()\n                    .distort(settingsCopy)\n                    .unmultiplyAlpha()\n                    .update();\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\n                ctx.drawImage(fxCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL('image/png');\n                thumbImgArr.push(thumbImg);\n            });\n\n            texture.destroy();\n        }\n\n        // ---- controls ----\n\n        const topRowEl = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n\n        const typeOptions = new Options({\n            optionArr: thumbImgArr.map((img, index) => {\n                css(img, {\n                    margin: '1px',\n                    borderRadius: '3px',\n                    transition: 'all 0.1s ease-in-out',\n                });\n                return {\n                    id: '' + index,\n                    label: img,\n                };\n            }),\n            initId: '0',\n            onChange: (id) => {\n                settings.distortType = Number(id) as TFilterDistortSettings['distortType'];\n                preview.render();\n            },\n        });\n\n        function sync(from: 'x' | 'y') {\n            if (from === 'x') {\n                settings.scale.y = settings.scale.x;\n                settings.strength.y = settings.strength.x;\n                settings.phase.y = settings.phase.x;\n\n                sliderArr[3].setValue(settings.scale.y);\n                sliderArr[4].setValue(settings.strength.y);\n                sliderArr[5].setValue(settings.phase.y);\n            } else {\n                settings.scale.x = settings.scale.y;\n                settings.strength.x = settings.strength.y;\n                settings.phase.x = settings.phase.y;\n\n                sliderArr[0].setValue(settings.scale.x);\n                sliderArr[1].setValue(settings.strength.x);\n                sliderArr[2].setValue(settings.phase.x);\n            }\n            preview.render();\n        }\n\n        const syncToggle = new Checkbox({\n            init: true,\n            label: LANG('filter-distort-sync-xy'),\n            callback: (val) => {\n                isSynced = val;\n                if (isSynced) {\n                    sync('x');\n                }\n            },\n            name: 'sync-xy',\n        });\n\n        topRowEl.append(\n            typeOptions.getElement(),\n            BB.el({ css: { flexGrow: '1' } }),\n            syncToggle.getElement(),\n        );\n\n        const xyRowEl = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                flexWrap: 'wrap',\n            },\n        });\n        const leftCol = BB.el({\n            parent: xyRowEl,\n            css: {\n                marginRight: '10px',\n            },\n        });\n        const rightCol = BB.el({ parent: xyRowEl });\n\n        const sliderWidth = isSmall ? 300 : 245;\n        const sliderArr: KlSlider[] = [];\n\n        (['x', 'y'] as const).forEach((item, index) => {\n            const targetEl = index === 0 ? leftCol : rightCol;\n\n            const scaleSlider = new KlSlider({\n                label: LANG('filter-noise-scale') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 1,\n                max: 1000,\n                curve: 'quadratic',\n                value: settings.scale[item],\n                eventResMs: EVENT_RES_MS,\n                onChange: (val) => {\n                    settings.scale[item] = val;\n                    if (isSynced) {\n                        sync(item);\n                    } else {\n                        preview.render();\n                    }\n                },\n            });\n            scaleSlider.getElement().style.marginTop = '20px';\n            targetEl.append(scaleSlider.getElement());\n\n            const strengthSlider = new KlSlider({\n                label: LANG('filter-unsharp-mask-strength') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 200,\n                curve: 'quadratic',\n                value: settings.strength[item],\n                eventResMs: EVENT_RES_MS,\n                onChange: (val) => {\n                    settings.strength[item] = val;\n                    if (isSynced) {\n                        sync(item);\n                    } else {\n                        preview.render();\n                    }\n                },\n            });\n            strengthSlider.getElement().style.marginTop = '10px';\n            targetEl.append(strengthSlider.getElement());\n\n            const phaseSlider = new KlSlider({\n                label: LANG('filter-distort-phase') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: settings.phase[item],\n                manualInputRoundDigits: 2,\n                eventResMs: EVENT_RES_MS,\n                formatFunc: (val) => BB.round(val, 2),\n                onChange: (val) => {\n                    settings.phase[item] = val;\n                    if (isSynced) {\n                        sync(item);\n                    } else {\n                        preview.render();\n                    }\n                },\n            });\n            phaseSlider.getElement().style.marginTop = '10px';\n            targetEl.append(phaseSlider.getElement());\n\n            sliderArr.push(scaleSlider);\n            sliderArr.push(strengthSlider);\n            sliderArr.push(phaseSlider);\n        });\n\n        const stepSlider = new KlSlider({\n            label: LANG('filter-distort-stepsize'),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 300,\n            curve: 'quadratic',\n            value: settings.stepSize,\n            eventResMs: EVENT_RES_MS,\n            onChange: (val) => {\n                settings.stepSize = Math.round(val);\n                preview.render();\n            },\n        });\n\n        stepSlider.getElement().style.marginTop = '20px';\n        stepSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(stepSlider.getElement());\n\n        // ---- preview ----\n\n        const klCanvas = params.klCanvas;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                const scaledSettings = BB.copyObj(settings);\n                scaledSettings.stepSize *= transform.scaleX;\n                scaledSettings.strength.x *= transform.scaleX;\n                scaledSettings.strength.y *= transform.scaleY;\n                if (scaledSettings.distortType !== 2) {\n                    scaledSettings.scale.x *= transform.scaleX;\n                    scaledSettings.scale.y *= transform.scaleY;\n                }\n                scaledSettings.offset.x = -transform.x;\n                scaledSettings.offset.y = -transform.y;\n\n                return fxCanvas.multiplyAlpha().distort(scaledSettings).unmultiplyAlpha();\n            },\n            selection: klCanvas.getSelection(),\n        });\n\n        const previewLayerArr: TProjectViewportProject['layers'] = layers.map((item, i) => {\n            return {\n                image: i === selectedLayerIndex ? fxPreviewRenderer.render : item.context.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                hasClipping: false,\n            };\n        });\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            selection: klCanvas.getSelection(),\n        });\n        preview.render();\n        css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        });\n        rootEl.append(preview.getElement());\n\n        const destroy = () => {\n            typeOptions.destroy();\n            sliderArr.forEach((item) => item.destroy());\n            stepSlider.destroy();\n            syncToggle.destroy();\n            fxPreviewRenderer.destroy();\n            preview.destroy();\n        };\n\n        // ----- result -------------------\n        const result: TFilterGetDialogResult<TFilterDistortInput> = {\n            element: rootEl,\n            destroy,\n            getInput: () => {\n                destroy();\n                return BB.copyObj(settings);\n            },\n        };\n        if (!isSmall) {\n            result.width = MEDIUM_PREVIEW.width;\n        }\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterDistortInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const context = params.layer.context;\n        const klHistory = params.klHistory;\n        if (!klCanvas) {\n            return false;\n        }\n        return applyFxFilter(\n            context,\n            params.klCanvas.getSelection(),\n            (fxCanvas) => {\n                fxCanvas.multiplyAlpha().distort(params.input).unmultiplyAlpha();\n            },\n            klHistory,\n        );\n    },\n};\n","import { BB } from '../../bb/bb';\nimport { TFilterApply, TFilterGetDialogParam, TFilterGetDialogResult, TRgb } from '../kl-types';\nimport { LANG } from '../../language/language';\nimport { input } from '../ui/components/input';\nimport { ColorOptions } from '../ui/components/color-options';\nimport { drawVanishPoint } from '../image-operations/draw-vanish-point';\nimport { KlSlider } from '../ui/components/kl-slider';\nimport { EVENT_RES_MS } from './filters-consts';\nimport { css, throwIfNull } from '../../bb/base/base';\nimport { Preview } from '../ui/project-viewport/preview';\nimport { TProjectViewportProject } from '../ui/project-viewport/project-viewport';\nimport { DraggableInput } from '../ui/components/draggable-input';\nimport { testIsSmall } from '../ui/utils/test-is-small';\nimport { getPreviewHeight, getPreviewWidth } from '../ui/utils/preview-size';\nimport { canvasToLayerTiles } from '../history/push-helpers/canvas-to-layer-tiles';\n\nexport type TFilterVanishPointInput = {\n    x: number;\n    y: number;\n    lines: number;\n    thickness: number;\n    color: TRgb;\n    opacity: number;\n};\n\nexport const filterVanishPoint = {\n    getDialog(params: TFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const previewCanvas = BB.canvas(context.canvas.width, context.canvas.height);\n        const previewCtx = BB.ctx(previewCanvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterVanishPointInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const settingsObj: TFilterVanishPointInput = {\n            x: context.canvas.width / 2,\n            y: context.canvas.height / 2,\n            lines: 8,\n            thickness: 2,\n            color: { r: 0, g: 0, b: 0 },\n            opacity: 1,\n        };\n\n        const linesSlider = new KlSlider({\n            label: LANG('filter-vanish-point-lines'),\n            width: 300,\n            height: 30,\n            min: 2,\n            max: 20,\n            value: settingsObj.lines,\n            curve: 'quadratic',\n            eventResMs: EVENT_RES_MS,\n            onChange: function (val) {\n                settingsObj.lines = Math.round(val);\n                update();\n            },\n        });\n        linesSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(linesSlider.getElement());\n\n        const line1 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n        const line2 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n                marginBottom: '10px',\n            },\n        });\n        const xInput = input({\n            init: settingsObj.x,\n            type: 'number',\n            css: { width: '75px', marginRight: '20px' },\n            callback: function (v) {\n                settingsObj.x = parseFloat(v);\n                dragInput.setValue({\n                    x: settingsObj.x,\n                    y: settingsObj.y,\n                });\n                update();\n            },\n        });\n        const yInput = input({\n            init: settingsObj.y,\n            type: 'number',\n            css: { width: '75px', marginRight: '20px' },\n            callback: function (v) {\n                settingsObj.y = parseFloat(v);\n                dragInput.setValue({\n                    x: settingsObj.x,\n                    y: settingsObj.y,\n                });\n                update();\n            },\n        });\n        const thicknessInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: { width: '75px', marginRight: '20px' },\n            callback: function (v) {\n                settingsObj.thickness = parseFloat(v);\n                update();\n            },\n        });\n\n        let selectedRgbaObj = { r: 0, g: 0, b: 0, a: 1 };\n        const colorOptionsArr = [\n            { r: 0, g: 0, b: 0, a: 1 },\n            { r: 255, g: 255, b: 255, a: 1 },\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n        settingsObj.color = BB.copyObj(selectedRgbaObj);\n\n        const colorOptions = new ColorOptions({\n            label: LANG('shape-stroke'),\n            colorArr: colorOptionsArr,\n            onChange: function (rgbaObj) {\n                selectedRgbaObj = rgbaObj!;\n                settingsObj.color = BB.copyObj(selectedRgbaObj);\n                update();\n            },\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            marginRight: '5px',\n        };\n        line1.append(\n            BB.el({ content: 'X:', css: labelStyle }),\n            xInput,\n            BB.el({ content: 'Y:', css: labelStyle }),\n            yInput,\n        );\n        line2.append(\n            BB.el({ content: LANG('shape-line-width') + ':', css: labelStyle }),\n            thicknessInput,\n            BB.el({ css: { flexGrow: '1' } }),\n            colorOptions.getElement(),\n        );\n\n        // ---- preview input processing ----\n        function syncInputs(): void {\n            xInput.value = '' + settingsObj.x;\n            yInput.value = '' + settingsObj.y;\n        }\n\n        function update(): void {\n            const ctx = previewCtx;\n            const w = previewCanvas.width;\n            const h = previewCanvas.height;\n\n            ctx.save();\n            ctx.clearRect(0, 0, w, h);\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            drawVanishPoint(\n                ctx,\n                settingsObj.x,\n                settingsObj.y,\n                settingsObj.lines,\n                Math.max(settingsObj.thickness, 1),\n                settingsObj.color,\n                settingsObj.opacity,\n            );\n\n            ctx.restore();\n            preview.render();\n        }\n\n        const onRender = () => {\n            dragInput.setTransform(preview.getTransform());\n            return previewCanvas;\n        };\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image: i === selectedLayerIndex ? onRender : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n        });\n        css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n            overflow: 'hidden',\n        });\n\n        const dragInput = new DraggableInput({\n            value: {\n                x: settingsObj.x,\n                y: settingsObj.y,\n            },\n            onChange: (val) => {\n                settingsObj.x = Math.round(val.x);\n                settingsObj.y = Math.round(val.y);\n                syncInputs();\n                update();\n            },\n        });\n\n        update();\n\n        preview.getElement().append(dragInput.getElement());\n        rootEl.append(preview.getElement());\n\n        result.destroy = () => {\n            linesSlider.destroy();\n            colorOptions.destroy();\n            preview.destroy();\n        };\n        result.getInput = function (): TFilterVanishPointInput {\n            result.destroy!();\n            return BB.copyObj(settingsObj);\n        };\n        return result;\n    },\n\n    apply(params: TFilterApply<TFilterVanishPointInput>): boolean {\n        const context = params.layer.context;\n        const klCanvas = params.klCanvas;\n        const klHistory = params.klHistory;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        drawVanishPoint(\n            context,\n            params.input.x,\n            params.input.y,\n            params.input.lines,\n            params.input.thickness,\n            params.input.color,\n            params.input.opacity,\n        );\n        {\n            const layerMap = Object.fromEntries(\n                params.klCanvas.getLayers().map((layerItem) => {\n                    if (layerItem.id === params.layer.id) {\n                        return [\n                            layerItem.id,\n                            {\n                                tiles: canvasToLayerTiles(params.layer.canvas),\n                            },\n                        ];\n                    }\n\n                    return [layerItem.id, {}];\n                }),\n            );\n            klHistory.push({\n                layerMap,\n            });\n        }\n        return true;\n    },\n};\n","import { drawShape } from './shape-tool';\nimport { BB } from '../../bb/bb';\nimport { TRgb } from '../kl-types';\n\nexport function drawVanishPoint(\n    ctx: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    lines: number, // int, [2, inf]\n    thickness: number, // px\n    color: TRgb,\n    opacity: number, // 0 - 1\n): void {\n    ctx.save();\n\n    const degIncrement = 180 / lines;\n    for (let deg = 0; deg < 180; deg += degIncrement) {\n        const p2 = BB.rotateAround({ x, y }, { x: x + 9999, y }, deg);\n        drawShape(ctx, {\n            type: 'line',\n            x1: x,\n            y1: y,\n            x2: p2.x,\n            y2: p2.y,\n            //angleRad: 0,\n            isOutwards: true,\n            opacity,\n            //isEraser: false,\n            strokeRgb: color,\n            lineWidth: thickness,\n            //doLockAlpha: false,\n        });\n    }\n\n    ctx.restore();\n}\n","import { KL } from '../kl';\nimport { KlCanvas } from '../canvas/kl-canvas';\nimport { Psd } from 'ag-psd/dist/psd';\nimport { loadAgPsd } from './load-ag-psd';\n\nexport async function klCanvasToPsdBlob(klCanvas: KlCanvas): Promise<Blob> {\n    const layerArr = klCanvas.getLayersFast();\n\n    const psdConfig: Psd = {\n        width: klCanvas.getWidth(),\n        height: klCanvas.getHeight(),\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\n        children: layerArr.map((item) => {\n            // todo - can be optimized if layer mostly empty\n            return {\n                name: item.name,\n                hidden: !item.isVisible,\n                opacity: item.opacity,\n                canvas: item.canvas,\n                blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n                left: 0,\n                top: 0,\n            };\n        }),\n    };\n\n    const agPsd = await loadAgPsd();\n    const buffer = agPsd.writePsdBuffer(psdConfig);\n    return new Blob([buffer], { type: 'application/octet-stream' });\n}\n","import { BB } from '../../bb/bb';\nimport { TDrawEvent, TDrawMoveEvent } from '../kl-types';\n\n/**\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\n * for onDraw events from KlCanvasWorkspace.\n *\n * in some draw event\n * out some draw event\n *\n * type: 'line' Events are just passed through.\n */\nexport class LineSmoothing {\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\n    private smoothing: number;\n    private lastMixedInput:\n        | {\n              x: number;\n              y: number;\n              pressure: number;\n          }\n        | undefined;\n    private interval: ReturnType<typeof setInterval> | undefined;\n    private timeout: ReturnType<typeof setTimeout> | undefined;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: {\n        smoothing: number; // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\n    }) {\n        this.smoothing = BB.clamp(p.smoothing, 0, 1);\n    }\n\n    chainIn(event: TDrawEvent): TDrawEvent | null {\n        event = BB.copyObj(event);\n        clearTimeout(this.timeout);\n        clearInterval(this.interval);\n\n        if (event.type === 'down') {\n            this.lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure,\n            };\n        }\n\n        if (event.type === 'move') {\n            const inputX = event.x;\n            const inputY = event.y;\n            const inputPressure = event.pressure;\n\n            event.x = BB.mix(event.x, this.lastMixedInput!.x, this.smoothing);\n            event.y = BB.mix(event.y, this.lastMixedInput!.y, this.smoothing);\n            event.pressure = BB.mix(event.pressure, this.lastMixedInput!.pressure, this.smoothing);\n            this.lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure,\n            };\n\n            if (this.smoothing > 0) {\n                this.timeout = setTimeout(() => {\n                    this.interval = setInterval(() => {\n                        event = JSON.parse(JSON.stringify(event)) as TDrawMoveEvent;\n\n                        event.x = BB.mix(inputX, this.lastMixedInput!.x, this.smoothing);\n                        event.y = BB.mix(inputY, this.lastMixedInput!.y, this.smoothing);\n                        event.pressure = BB.mix(\n                            inputPressure,\n                            this.lastMixedInput!.pressure,\n                            this.smoothing,\n                        );\n                        this.lastMixedInput = {\n                            x: event.x,\n                            y: event.y,\n                            pressure: event.pressure,\n                        };\n\n                        this.chainOut?.(event);\n                    }, 35);\n                }, 80);\n            }\n        }\n\n        return event;\n    }\n\n    setChainOut(func: (drawEvent: TDrawEvent) => void): void {\n        this.chainOut = func;\n    }\n\n    setSmoothing(s: number): void {\n        this.smoothing = BB.clamp(s, 0, 1);\n    }\n}\n","import { TDrawEvent } from '../kl-types';\n\n/**\n * cleans up DrawEvents. More trustworthy events. EventChain element\n *\n * in some draw event?\n * out some draw event?\n *\n * that events can only go line this: down -> n x move -> up\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\n */\nexport class LineSanitizer {\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\n    private isDrawing: boolean = false;\n\n    // ----------------------------------- public -----------------------------------\n\n    chainIn(event: TDrawEvent): TDrawEvent | null {\n        if (event.type === 'down') {\n            if (this.isDrawing) {\n                //console.log('line sanitizer - down, but already drawing');\n                this.chainOut &&\n                    this.chainOut({\n                        type: 'up',\n                        scale: event.scale,\n                        shiftIsPressed: event.shiftIsPressed,\n                        isCoalesced: false,\n                    });\n            } else {\n                this.isDrawing = true;\n            }\n        }\n        if (!this.isDrawing && (event.type === 'move' || event.type === 'up')) {\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\n            return null;\n        }\n\n        if (event.type === 'up' && this.isDrawing) {\n            this.isDrawing = false;\n        }\n\n        return event;\n    }\n\n    setChainOut(func: (drawEvent: TDrawEvent) => void): void {\n        this.chainOut = func;\n    }\n\n    getIsDrawing(): boolean {\n        return this.isDrawing;\n    }\n}\n","/**\n * from stabilizer dropdown value to line-smoothing value\n * @param s\n */\nexport function translateSmoothing(s: number): number {\n    if (s == 1) {\n        return 1 - 0.5;\n    }\n    if (s == 2) {\n        return 1 - 0.16;\n    }\n    if (s == 3) {\n        return 1 - 0.035;\n    }\n    if (s == 4) {\n        return 1 - 0.0175;\n    }\n    if (s == 5) {\n        return 1 - 0.00875;\n    }\n    return s;\n}\n","import { TDropOption, TKlPsd, TRgb } from '../klecks/kl-types';\nimport { KL } from '../klecks/kl';\nimport { LANG } from '../language/language';\nimport { BB } from '../bb/bb';\nimport { KlCanvas, TKlCanvasLayer } from '../klecks/canvas/kl-canvas';\nimport { LayersUi } from '../klecks/ui/tool-tabs/layers-ui/layers-ui';\nimport { TRect, TSize2D } from '../bb/bb-types';\nimport { throwIfNull, throwIfUndefined } from '../bb/base/base';\nimport { getNextLayerId } from '../klecks/history/get-next-layer-id';\nimport { detectFiletype } from '../klecks/storage/file-header-detection';\n\n// todo later:\n// onImage: (project: IKlProject) => void\n// onLayer: (index: number, canvas: HMTLCanvasElement,layerName: string) => void\n\nexport class KlAppImportHandler {\n    private readonly klRootEl: HTMLElement;\n    private readonly klMaxCanvasSize: number;\n    private readonly layersUi: LayersUi;\n    private readonly setCurrentLayer: (layer: TKlCanvasLayer) => void;\n    private readonly klCanvas: KlCanvas;\n    private readonly onImportConfirm: () => void;\n    private readonly applyUncommitted: () => void;\n\n    private readonly onColor: (rgb: TRgb) => void;\n\n    private importFinishedLoading(\n        importedImage: // convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\n        | TKlPsd\n            | {\n                  type: 'image';\n                  width: number;\n                  height: number;\n                  canvas: HTMLCanvasElement | HTMLImageElement;\n              },\n        filename: string | undefined, // string e.g. 'drawing.psd'\n        optionStr: 'default' | 'layer' | 'image',\n    ): void {\n        if (\n            !importedImage ||\n            isNaN(importedImage.width) ||\n            isNaN(importedImage.height) ||\n            importedImage.width <= 0 ||\n            importedImage.height <= 0\n        ) {\n            KL.popup({\n                target: this.klRootEl,\n                type: 'error',\n                message: LANG('import-broken-file'),\n                buttons: ['Ok'],\n            });\n            return;\n        }\n\n        const getResizedDimensions = (width: number, height: number): TSize2D => {\n            let w = parseInt('' + width);\n            let h = parseInt('' + height);\n            if (w > this.klMaxCanvasSize) {\n                h = (this.klMaxCanvasSize / w) * h;\n                w = this.klMaxCanvasSize;\n            }\n            if (h > this.klMaxCanvasSize) {\n                w = (this.klMaxCanvasSize / h) * w;\n                h = this.klMaxCanvasSize;\n            }\n            w = parseInt('' + w);\n            h = parseInt('' + h);\n            return {\n                width: w,\n                height: h,\n            };\n        };\n\n        const importAsImage = (canvas: HTMLCanvasElement | HTMLImageElement) => {\n            this.applyUncommitted();\n            const resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\n\n            //resize first\n            const tempCanvas = BB.canvas(canvas.width, canvas.height);\n            const tempCanvasCtx = BB.ctx(tempCanvas);\n            tempCanvasCtx.drawImage(canvas, 0, 0);\n\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\n\n            this.klCanvas.reset({\n                width: resizedDimensions.width,\n                height: resizedDimensions.height,\n                image: tempCanvas,\n                layerName: filename,\n            });\n\n            this.layersUi.update(0);\n            this.setCurrentLayer(this.klCanvas.getLayer(0));\n            this.onImportConfirm();\n        };\n\n        /**\n         * convertedPsdObj has no layers if flattened\n         */\n        const importAsImagePsd = (convertedPsdObj: TKlPsd, cropObj?: TRect) => {\n            this.applyUncommitted();\n            // crop\n            const crop = (\n                targetCanvas: HTMLCanvasElement,\n                cropCanvas: HTMLCanvasElement,\n                cropObj: TRect,\n            ): void => {\n                // eslint-disable-next-line no-self-assign\n                cropCanvas.width = cropCanvas.width;\n                BB.ctx(cropCanvas).drawImage(targetCanvas, -cropObj.x, -cropObj.y);\n                targetCanvas.width = cropObj.width;\n                targetCanvas.height = cropObj.height;\n                BB.ctx(targetCanvas).drawImage(cropCanvas, 0, 0);\n            };\n            if (\n                cropObj &&\n                (cropObj.width !== convertedPsdObj.width ||\n                    cropObj.height !== convertedPsdObj.height)\n            ) {\n                const cropCanvas = BB.canvas(cropObj.width, cropObj.height);\n                convertedPsdObj.width = cropObj.width;\n                convertedPsdObj.height = cropObj.height;\n\n                if (!convertedPsdObj.layers) {\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\n                }\n                if (convertedPsdObj.layers) {\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\n                        const item = convertedPsdObj.layers[i];\n                        crop(item.image, cropCanvas, cropObj);\n                    }\n                }\n            }\n\n            // resize\n            const resizedDimensions = getResizedDimensions(\n                convertedPsdObj.width,\n                convertedPsdObj.height,\n            );\n            convertedPsdObj.width = resizedDimensions.width;\n            convertedPsdObj.height = resizedDimensions.height;\n            if (!convertedPsdObj.layers) {\n                BB.resizeCanvas(\n                    convertedPsdObj.canvas,\n                    convertedPsdObj.width,\n                    convertedPsdObj.height,\n                );\n            }\n            if (convertedPsdObj.layers) {\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\n                    const item = convertedPsdObj.layers[i];\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\n                }\n            }\n\n            let layerIndex;\n            if (convertedPsdObj.layers) {\n                layerIndex = this.klCanvas.reset({\n                    width: convertedPsdObj.width,\n                    height: convertedPsdObj.height,\n                    layers: convertedPsdObj.layers.map((layer) => {\n                        return {\n                            id: getNextLayerId(),\n                            name: layer.name,\n                            isVisible: layer.isVisible,\n                            opacity: layer.opacity,\n                            mixModeStr: layer.mixModeStr,\n                            image: layer.image,\n                        };\n                    }),\n                });\n            } else {\n                layerIndex = this.klCanvas.reset({\n                    width: convertedPsdObj.width,\n                    height: convertedPsdObj.height,\n                    image: convertedPsdObj.canvas,\n                });\n            }\n            this.layersUi.update(layerIndex);\n            this.setCurrentLayer(this.klCanvas.getLayer(layerIndex));\n            this.onImportConfirm();\n        };\n\n        const importAsLayer = (canvas: HTMLCanvasElement | HTMLImageElement) => {\n            this.applyUncommitted();\n            KL.showImportAsLayerDialog({\n                target: this.klRootEl,\n                klCanvas: this.klCanvas,\n                importImage: canvas,\n                callback: (transformObj, isPixelated?: boolean) => {\n                    if (!transformObj) {\n                        return;\n                    }\n                    const operation = (ctx: CanvasRenderingContext2D) => {\n                        BB.drawTransformedImageWithBounds(\n                            ctx,\n                            canvas,\n                            transformObj,\n                            undefined,\n                            isPixelated,\n                        );\n                    };\n                    if (\n                        !this.klCanvas.addLayer(undefined, {\n                            name: filename,\n                            isVisible: true,\n                            opacity: 1,\n                            image: operation,\n                        })\n                    ) {\n                        this.klCanvas.drawOperation(\n                            this.klCanvas.getLayers().length - 1,\n                            operation,\n                        );\n                    }\n                    const layers = this.klCanvas.getLayers();\n                    const activeLayerIndex = layers.length - 1;\n                    this.setCurrentLayer(this.klCanvas.getLayer(activeLayerIndex));\n                    this.layersUi.update(activeLayerIndex);\n                },\n            });\n        };\n\n        if (optionStr === 'default' || !optionStr) {\n            KL.showImportImageDialog({\n                image: importedImage,\n                target: this.klRootEl,\n                maxSize: this.klMaxCanvasSize,\n                callback: (res) => {\n                    if (res.type === 'as-image') {\n                        importAsImage(res.image);\n                    } else if (res.type === 'as-image-psd') {\n                        importAsImagePsd(res.image, res.cropObj);\n                    } else if (res.type === 'as-layer') {\n                        importAsLayer(res.image);\n                    } else if (res.type === 'cancel') {\n                        // nothing to do\n                    }\n                },\n            });\n        }\n\n        if (optionStr === 'layer') {\n            importAsLayer(importedImage.canvas);\n        }\n        if (optionStr === 'image') {\n            if (importedImage.type === 'psd') {\n                importAsImagePsd(importedImage);\n            } else {\n                importAsImage(importedImage.canvas);\n            }\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(\n        input: {\n            klRootEl: HTMLElement;\n            maxCanvasSize: number;\n            layersUi: LayersUi;\n            setCurrentLayer: (layer: TKlCanvasLayer) => void;\n            klCanvas: KlCanvas;\n            onImportConfirm: () => void;\n            applyUncommitted: () => void;\n        },\n        callback: {\n            onColor: (rgb: TRgb) => void;\n        },\n    ) {\n        this.klRootEl = input.klRootEl;\n        this.klMaxCanvasSize = input.maxCanvasSize;\n        this.layersUi = input.layersUi;\n        this.setCurrentLayer = input.setCurrentLayer;\n        this.klCanvas = input.klCanvas;\n        this.onImportConfirm = input.onImportConfirm;\n        this.applyUncommitted = input.applyUncommitted;\n\n        this.onColor = callback.onColor;\n    }\n\n    // ---- interface ----\n\n    async readClipboard(): Promise<void> {\n        try {\n            /*if (Math.random() > 0.001) {\n                throw new Error('haha');\n            }*/\n            // May freeze the app until it read the clipboard\n            // But if you show a loading indicator on this line, it will show up too early.\n            const clipboardItems = await navigator.clipboard.read();\n            // On this line it's already done freezing.\n\n            let hasImage = false;\n            for (const item of clipboardItems) {\n                for (const type of item.types) {\n                    if (type.startsWith('image')) {\n                        hasImage = true;\n                        const blob = await item.getType(type);\n                        const img = new Image();\n                        img.onload = () => {\n                            URL.revokeObjectURL(img.src);\n                            this.importFinishedLoading(\n                                {\n                                    type: 'image',\n                                    width: img.width,\n                                    height: img.height,\n                                    canvas: img,\n                                },\n                                undefined,\n                                'default',\n                            );\n                        };\n                        img.src = URL.createObjectURL(blob);\n                        return;\n                    }\n                }\n            }\n            if (!hasImage) {\n                KL.popup({\n                    target: this.klRootEl,\n                    type: 'error',\n                    message: LANG('clipboard-no-image'),\n                    buttons: ['Ok'],\n                });\n            }\n        } catch (error) {\n            KL.popup({\n                target: this.klRootEl,\n                type: 'error',\n                message: LANG('clipboard-read-fail'),\n                buttons: ['Ok'],\n            });\n        }\n    }\n\n    onPaste(e: ClipboardEvent): void {\n        if (KL.DIALOG_COUNTER.get() > 0) {\n            return;\n        }\n\n        const retrieveImageFromClipboardAsBlob = (\n            items: DataTransferItemList,\n            callback: (file: File) => void,\n        ) => {\n            if (!items) {\n                return;\n            }\n            for (let i = 0; i < items.length; i++) {\n                if (items[i].type.indexOf('image') == -1) {\n                    continue;\n                }\n                const file = items[i].getAsFile();\n                file && callback(file);\n            }\n        };\n\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (!e.clipboardData) {\n            return;\n        }\n\n        if (e.clipboardData.files[0]) {\n            retrieveImageFromClipboardAsBlob(e.clipboardData.items, (imageBlob) => {\n                // If there's an image, display it in the canvas\n                const img = new Image();\n                img.onload = () => {\n                    URL.revokeObjectURL(img.src);\n                    this.importFinishedLoading(\n                        {\n                            type: 'image',\n                            width: img.width,\n                            height: img.height,\n                            canvas: img,\n                        },\n                        undefined,\n                        'default',\n                    );\n                };\n                const URLObj = window.URL || window.webkitURL;\n                img.src = URLObj.createObjectURL(imageBlob);\n            });\n        } else if (e.clipboardData.items[0]) {\n            e.clipboardData.items[0].getAsString((pasteStr) => {\n                pasteStr = pasteStr.trim();\n                if (pasteStr.match(/^https?/)) {\n                    // url\n                    const img = new Image();\n                    img.onload = () => {\n                        this.importFinishedLoading(\n                            {\n                                type: 'image',\n                                width: img.width,\n                                height: img.height,\n                                canvas: img,\n                            },\n                            undefined,\n                            'default',\n                        );\n                    };\n                    img.onerror = (e) => {\n                        console.log('error loading', e);\n                    };\n                    img.crossOrigin = 'Anonymous';\n                    img.src = pasteStr;\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\n                    // url\n                    const rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\n                    rgbObj && this.onColor(rgbObj);\n                }\n            });\n        }\n    }\n\n    async handleFileSelect(files: FileList, optionStr: TDropOption): Promise<void> {\n        const showWarningPsdFlattened = () => {\n            KL.popup({\n                target: this.klRootEl,\n                type: 'warning',\n                message: LANG('import-psd-unsupported') + '<br /><br />',\n                buttons: ['Ok'],\n            });\n        };\n\n        let hasUnsupportedFile = false;\n        // files need to be copied, because the input is reset\n        const fileArr = [...files];\n\n        for (let i = 0; i < fileArr.length; i++) {\n            const file = fileArr[i];\n            const fileType = await detectFiletype(file);\n            if (fileType === 'image') {\n                ((f) => {\n                    window.URL = window.URL || window.webkitURL;\n                    const url = window.URL.createObjectURL(f);\n                    const im = new Image();\n                    im.src = url;\n                    BB.loadImage(im, () => {\n                        URL.revokeObjectURL(url);\n                        this.importFinishedLoading(\n                            {\n                                type: 'image',\n                                width: im.width,\n                                height: im.height,\n                                canvas: im,\n                            },\n                            f.name,\n                            optionStr,\n                        );\n                    });\n                })(file);\n            } else if (fileType === 'psd') {\n                ((f) => {\n                    const loaderSizeBytes = 1024 * 1024 * 25; // 25mb\n                    const maxSizeBytes = 1024 * 1024 * 1024; // 1gb\n                    const maxResolution = 4096;\n\n                    if (f.size >= maxSizeBytes) {\n                        // pretty likely to break stuff\n                        KL.popup({\n                            target: this.klRootEl,\n                            type: 'error',\n                            message: 'File too big. Unable to import.<br /><br />',\n                            buttons: ['Ok'],\n                        });\n                        return;\n                    }\n\n                    const doShowLoader = fileArr.length === 1 && f.size >= loaderSizeBytes;\n                    let loaderIsOpen = true;\n                    let closeLoader: (() => void) | null;\n\n                    if (doShowLoader) {\n                        KL.popup({\n                            target: this.klRootEl,\n                            message: LANG('import-opening'),\n                            callback: (result) => {\n                                loaderIsOpen = false;\n                                closeLoader = null;\n                            },\n                            closeFunc: (f) => {\n                                closeLoader = f;\n                            },\n                        });\n                    }\n\n                    const reader = new FileReader();\n                    reader.onload = (readerResult) => {\n                        const target = throwIfNull(readerResult.target);\n\n                        KL.loadAgPsd()\n                            .then((agPsdLazy) => {\n                                if (doShowLoader && !loaderIsOpen) {\n                                    return;\n                                }\n\n                                try {\n                                    let psd;\n\n                                    // first pass, only read metadata\n                                    psd = agPsdLazy.readPsd(target.result as any, {\n                                        skipLayerImageData: true,\n                                        skipThumbnail: true,\n                                        skipCompositeImageData: true,\n                                    });\n                                    if (psd.width > maxResolution || psd.height > maxResolution) {\n                                        if (closeLoader) {\n                                            closeLoader();\n                                        }\n                                        KL.popup({\n                                            target: this.klRootEl,\n                                            type: 'error',\n                                            message:\n                                                LANG('import-psd-too-large').replace(\n                                                    /{x}/g,\n                                                    '' + maxResolution,\n                                                ) +\n                                                '<br /><br />' +\n                                                LANG('import-psd-size') +\n                                                ': ' +\n                                                psd.width +\n                                                ' x ' +\n                                                psd.height +\n                                                ' pixels' +\n                                                '<br /><br />',\n                                            buttons: ['Ok'],\n                                        });\n                                        return;\n                                    }\n\n                                    // second pass, now load actual data.\n                                    psd = null;\n\n                                    try {\n                                        psd = agPsdLazy.readPsd(target.result as any);\n                                    } catch (e) {\n                                        //console.log('failed regular psd import', e);\n                                    }\n                                    if (psd) {\n                                        //console.log('psd', psd);\n                                        const convertedPsd = KL.PSD.readPsd(psd);\n                                        //console.log('converted', convertedPsd);\n                                        if (optionStr === 'image' && convertedPsd.error) {\n                                            showWarningPsdFlattened();\n                                        }\n\n                                        if (closeLoader) {\n                                            closeLoader();\n                                        }\n                                        this.importFinishedLoading(convertedPsd, f.name, optionStr);\n                                    } else {\n                                        psd = agPsdLazy.readPsd(target.result as any, {\n                                            skipLayerImageData: true,\n                                            skipThumbnail: true,\n                                        });\n\n                                        if (optionStr === 'image') {\n                                            showWarningPsdFlattened();\n                                        }\n\n                                        if (closeLoader) {\n                                            closeLoader();\n                                        }\n                                        this.importFinishedLoading(\n                                            {\n                                                type: 'psd',\n                                                width: psd.width,\n                                                height: psd.height,\n                                                canvas: throwIfUndefined(psd.canvas),\n                                                error: true,\n                                            },\n                                            f.name,\n                                            optionStr,\n                                        );\n                                    }\n                                } catch (e) {\n                                    closeLoader?.();\n                                    KL.popup({\n                                        target: this.klRootEl,\n                                        type: 'error',\n                                        message: 'Failed to load PSD.<br /><br />',\n                                        buttons: ['Ok'],\n                                    });\n                                    console.log(e);\n                                    setTimeout(() => {\n                                        throw new Error('psd load error');\n                                    });\n                                }\n                            })\n                            .catch((e) => {\n                                closeLoader?.();\n                                alert('Error: failed to load PSD library');\n                            });\n                    };\n                    reader.readAsArrayBuffer(f);\n                })(file);\n            } else {\n                hasUnsupportedFile = true;\n            }\n        }\n        if (hasUnsupportedFile) {\n            KL.popup({\n                target: this.klRootEl,\n                message: LANG('import-unsupported-file'),\n                type: 'error',\n                buttons: ['OK'],\n            });\n        }\n    }\n}\n","// image - png, jpg, webp, whatever the browser natively supports\nexport type TSupportedFileType = 'image' | 'psd';\n\nfunction isBufferMatch(buffer: Uint8Array, bytes: (number | undefined)[]) {\n    return bytes.every((byte, index) => {\n        if (byte === undefined) {\n            return true;\n        }\n        return buffer[index] === byte;\n    });\n}\n\n// undefined if unknown\nexport async function detectFiletype(file: File): Promise<TSupportedFileType | undefined> {\n    // photoshop is sub type of image.* - so check first\n    const nameSplit = file.name.split('.');\n    const extension = nameSplit[nameSplit.length - 1].toLowerCase();\n    if (file.type.match('image/vnd.adobe.photoshop') || extension === 'psd') {\n        return 'psd';\n    }\n\n    if (file.type.match('image.*')) {\n        return 'image';\n    }\n    // check for headers\n\n    try {\n        const arr = await new Promise<Uint8Array>((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = () => {\n                if (reader.result === null) {\n                    reject();\n                    return;\n                }\n                // we did read as array buffer\n                resolve(new Uint8Array(reader.result as ArrayBuffer));\n            };\n            reader.onerror = reject;\n            reader.readAsArrayBuffer(file.slice(0, 12));\n        });\n\n        // PSD: '8BPS'\n        if (isBufferMatch(arr, [56, 66, 80, 83])) {\n            return 'psd';\n        }\n        // PNG: 89 50 4E 47 0D 0A 1A 0A\n        if (isBufferMatch(arr, [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a])) {\n            return 'image';\n        }\n        // JPEG: 0xFF 0xD8\n        if (isBufferMatch(arr, [0xff, 0xd8])) {\n            return 'image';\n        }\n        // WebP: 'RIFF....WEBP'\n        if (\n            isBufferMatch(arr, [\n                0x52,\n                0x49,\n                0x46,\n                0x46,\n                undefined,\n                undefined,\n                undefined,\n                undefined,\n                0x57,\n                0x45,\n                0x42,\n                0x50,\n            ])\n        ) {\n            return 'image';\n        }\n    } catch (e) {\n        // ...\n    }\n    return undefined;\n}\n","module.exports = parcelRequire.resolve(\"tab-settings.cf9aa953.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"tab-layers.e8ab823a.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"tab-edit.d5bcf521.svg\") + \"?\" + Date.now();","import { TVector2D } from '../bb/bb-types';\n\nexport type TConsoleApi = {\n    readonly draw: (path: TVector2D[]) => void;\n    readonly help: () => void;\n};\n\nexport function createConsoleApi(p: { onDraw: (path: TVector2D[]) => void }): TConsoleApi {\n    const output = [\n        'Draw via the console! Learn more: %cKL.help()',\n        'background: #000; color: #0f0;',\n    ];\n    'info' in (console as any) ? console.info(...output) : console.log(...output);\n\n    return Object.freeze({\n        draw: (path: TVector2D[]): void => {\n            p.onDraw(path);\n        },\n        help: (): void => {\n            console.log(`KL.draw({x: number; y: number}[]) // draw a line\nKL.help() // print help\n`);\n        },\n    });\n}\n","import { c } from '../../../bb/base/c';\nimport { ProjectViewport, TViewportTransform } from '../project-viewport/project-viewport';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { BB } from '../../../bb/bb';\nimport { toMetaTransform } from '../../../bb/transform/to-meta-transform';\nimport { createTransform } from '../../../bb/transform/create-transform';\nimport { createMatrixFromTransform } from '../../../bb/transform/create-matrix-from-transform';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { EaselPointerPreprocessor } from './easel-pointer-preprocessor';\nimport { KeyListener } from '../../../bb/input/key-listener';\nimport {\n    TArrowKey,\n    TEaselInterface,\n    TEaselProject,\n    TEaselTool,\n    TEaselToolTrigger,\n} from './easel.types';\nimport { TBounds, TVector2D } from '../../../bb/bb-types';\nimport { zoomByStep } from '../project-viewport/utils/zoom-by-step';\nimport { SelectionRenderer } from './selection-renderer';\nimport { TVec4 } from '../../../bb/math/matrix';\nimport { KL_CONFIG } from '../../kl-config';\nimport { minimizeAngleDeg, snapAngleDeg } from '../../../bb/math/math';\nimport {\n    DEFAULT_DOUBLE_TAP_POINTER_TYPES,\n    EASEL_MAX_SCALE,\n    EASEL_MIN_SCALE,\n    TEMP_TRIGGERS,\n    TEMP_TRIGGERS_KEYS,\n} from './easel.config';\nimport { isTransformEqual } from '../project-viewport/utils/is-transform-equal';\nimport { blendTransform } from '../project-viewport/utils/blend-transform';\nimport { css } from '../../../bb/base/base';\n\nfunction getToolEntries<GToolId extends string>(\n    tools: Record<GToolId, TEaselTool>,\n): [GToolId, TEaselTool][] {\n    return Object.entries(tools) as [GToolId, TEaselTool][];\n}\n\nexport type TEaselParams<GToolId extends string> = {\n    width: number; // size of DOM element\n    height: number; // size of DOM element\n    project: TEaselProject;\n    tools: Record<GToolId, TEaselTool>;\n    tool: NoInfer<GToolId>;\n    onChangeTool: (toolId: NoInfer<GToolId>) => void;\n    onTransformChange: (transform: TViewportTransform, scaleOrAngleChanged: boolean) => void; // whenever Viewport changes\n    onUndo?: () => void; // gesture triggers undo\n    onRedo?: () => void; // gesture triggers redo\n};\n\n/**\n * An interactive project viewport, that also renders the selection. You interact with it through modes (aka tools).\n * One tool is active at a time. temp trigger can overwrite it temporarily.\n */\nexport class Easel<GToolId extends string> {\n    private readonly rootEl: HTMLElement;\n    private readonly svgEl: SVGElement; // each tool gets an element in this SVG tag, for an SVG overlay\n    private readonly viewport: ProjectViewport;\n    private readonly pointerPreprocessor: EaselPointerPreprocessor;\n    private readonly pointerListener: PointerListener;\n    private readonly windowPointerListener: (e: PointerEvent) => void;\n    private readonly keyListener: KeyListener;\n    private readonly selectionRenderer: SelectionRenderer;\n\n    // from params\n    private readonly toolsMap: TEaselParams<GToolId>['tools'];\n    // temp tool is tool that is active during holding a key or mouse button (e.g. hold space -> hand tool)\n    private readonly tempTools: Record<TEaselToolTrigger, GToolId | undefined>;\n    private readonly onChangeTool: TEaselParams<GToolId>['onChangeTool'];\n    private readonly onTransformChange: (\n        transform: TViewportTransform,\n        scaleOrAngleChanged: boolean,\n    ) => void;\n    private readonly onUndo: (() => void) | undefined;\n    private readonly onRedo: (() => void) | undefined;\n\n    // state\n    private project: TEaselProject;\n    private width: number;\n    private height: number;\n    private tool: GToolId;\n    private tempTool: GToolId | undefined;\n    private animationFrameId: ReturnType<typeof requestAnimationFrame> | undefined;\n    private doRender = false; // true -> will render on next renderLoop\n    private cursorPos: TVector2D | undefined; // so brush cursor not top left corner after reload\n    private isFrozen: boolean = false; // disable interaction with the easel whatsoever\n    private lastRenderedTransform: TViewportTransform = {} as TViewportTransform; // previously rendered viewport transformation\n    private pinchInitialTransform: TViewportTransform | undefined; // when starting a pinch-to-zoom gesture\n    private targetTransform: TViewportTransform = {} as TViewportTransform;\n\n    // custom interface passed to tools\n    private readonly easelInterface: TEaselInterface = {\n        setCursor: (cursor) => (this.rootEl.style.cursor = cursor),\n        getTransform: () => this.viewport.getTransform(),\n        getTargetTransform: () => this.targetTransform,\n        getSize: () => ({ width: this.width, height: this.height }),\n        getProjectSize: () => ({ width: this.project.width, height: this.project.height }),\n        setTransform: (transform, isImmediate) => this.setTargetTransform(transform, isImmediate),\n        requestRender: () => this.requestRender(),\n        isKeyPressed: (keyStr) => this.keyListener.isPressed(keyStr),\n        minScale: EASEL_MIN_SCALE,\n        maxScale: EASEL_MAX_SCALE,\n        setAngleDeg: (...args) => this.setAngleDeg(...args),\n        keyListener: {} as KeyListener, // this.keyListener\n        updateDoubleTapPointerTypes: () => this.updateDoubleTapPointerTypes(),\n        setRenderedSelection: (selection) => this.selectionRenderer.setRenderedSelection(selection),\n        clearRenderedSelection: (isImmediate) =>\n            this.selectionRenderer.clearRenderedSelection(isImmediate),\n    };\n\n    private setTargetTransform(transform: TViewportTransform, isImmediate?: boolean): void {\n        if (isImmediate) {\n            this.viewport.setTransform(transform);\n        }\n        this.targetTransform = transform;\n        this.doRender = true;\n    }\n\n    private updateToolSvgs(): void {\n        const tool = this.tempTool ?? this.tool;\n        Object.keys(this.toolsMap).forEach((toolId) => {\n            this.toolsMap[toolId as GToolId].getSvgElement().style.display =\n                toolId === tool ? '' : 'none';\n        });\n    }\n\n    // different tools allow different pointer types to trigger the gesture\n    private updateDoubleTapPointerTypes(): void {\n        const pointerTypes =\n            this.toolsMap[this.tempTool ?? this.tool].doubleTapPointerTypes ??\n            DEFAULT_DOUBLE_TAP_POINTER_TYPES;\n        this.pointerPreprocessor.setDoubleTapPointerTypes(pointerTypes);\n    }\n\n    private lastFrameTimestamp: number = 0;\n    /**\n     * Only call once from outside. Will perpetuate itself and render when doRender = true\n     */\n    private renderLoop(): void {\n        const now = performance.now();\n        const deltaMs = now - this.lastFrameTimestamp;\n        this.lastFrameTimestamp = now;\n        this.animationFrameId = requestAnimationFrame(() => this.renderLoop());\n        if (!this.doRender) {\n            return;\n        }\n        const tool = this.getActiveTool();\n        const oldTransform = this.viewport.getTransform();\n        let newTransform = oldTransform;\n        if (isTransformEqual(oldTransform, this.targetTransform)) {\n            this.doRender = false;\n        } else {\n            const defaultDeltaMs = 1000 / 60;\n            const timeFactor = deltaMs / defaultDeltaMs;\n            const easeFactor = 1 - 0.7 ** timeFactor;\n\n            newTransform = blendTransform(\n                oldTransform,\n                this.targetTransform,\n                {\n                    width: this.project.width,\n                    height: this.project.height,\n                },\n                {\n                    x: this.width / 2,\n                    y: this.height / 2,\n                },\n                easeFactor,\n            );\n            this.viewport.setTransform(newTransform);\n        }\n\n        // todo: is last renderedTransform needed?\n\n        const isPositionChanged =\n            newTransform.x !== this.lastRenderedTransform.x ||\n            newTransform.y !== this.lastRenderedTransform.y;\n        const isScaleOrAngleChanged =\n            newTransform.scale !== this.lastRenderedTransform.scale ||\n            newTransform.angleDeg !== this.lastRenderedTransform.angleDeg;\n\n        this.viewport.render(!isTransformEqual(oldTransform, newTransform));\n        if (isPositionChanged || isScaleOrAngleChanged) {\n            tool.onUpdateTransform?.(newTransform);\n            this.selectionRenderer.setTransform(newTransform);\n            this.onTransformChange(this.targetTransform, isScaleOrAngleChanged);\n            this.lastRenderedTransform = newTransform;\n        }\n    }\n\n    /**\n     * activate temporary tool. Can only push one.\n     */\n    private pushTempTool(toolId: GToolId | undefined): void {\n        if (this.tempTool !== undefined || toolId === undefined) {\n            return;\n        }\n        const tool = this.toolsMap[this.tool];\n        if (tool.getIsLocked?.()) {\n            return;\n        }\n\n        this.tempTool = toolId;\n        this.getActiveTool().activate?.(this.cursorPos);\n        this.updateToolSvgs();\n        this.updateDoubleTapPointerTypes();\n    }\n\n    /**\n     * Turn off temporary tool\n     */\n    private popTempTool(toolId: GToolId | undefined): void {\n        if (this.tempTool !== toolId || toolId === undefined) {\n            return;\n        }\n        this.tempTool = undefined;\n        this.getActiveTool().activate?.(this.cursorPos, true);\n        this.updateToolSvgs();\n        this.updateDoubleTapPointerTypes();\n    }\n\n    private getActiveTool(): TEaselTool {\n        return this.toolsMap[this.tempTool ?? this.tool];\n    }\n\n    private getResetTransform(): TViewportTransform {\n        return createTransform(\n            {\n                x: this.width / 2,\n                y: this.height / 2,\n            },\n            { x: this.project.width / 2, y: this.project.height / 2 },\n            1,\n            0,\n        );\n    }\n\n    private getFitTransform(): TViewportTransform {\n        const oldTransform = this.viewport.getTransform();\n        // rotate\n        let newAngleDeg = oldTransform.angleDeg;\n        if (newAngleDeg === 45) {\n            // would otherwise get rounded to 90\n            newAngleDeg = 0;\n        }\n        newAngleDeg = snapAngleDeg(newAngleDeg, 90, 90);\n\n        //calc width and height of bounds\n        const projectWidth = this.project.width;\n        const projectHeight = this.project.height;\n        const canvasPointsArr = [\n            [0, 0], // top left\n            [projectWidth, 0], // top right\n            [projectWidth, projectHeight], // bottom right\n            [0, projectHeight], // bottom left\n            [projectWidth / 2, projectHeight / 2], // center\n        ];\n\n        //setup transformation matrix\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(\n            matrix,\n            BB.Matrix.createRotationMatrix((newAngleDeg / 180) * Math.PI),\n        );\n\n        //rotate points\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            let coords: TVec4 = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n            canvasPointsArr[i][0] = coords[0];\n            canvasPointsArr[i][1] = coords[1];\n        }\n\n        const boundsObj: Partial<TBounds> = {};\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            if (boundsObj.x1 === undefined || canvasPointsArr[i][0] < boundsObj.x1) {\n                boundsObj.x1 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y1 === undefined || canvasPointsArr[i][1] < boundsObj.y1) {\n                boundsObj.y1 = canvasPointsArr[i][1];\n            }\n            if (boundsObj.x2 === undefined || canvasPointsArr[i][0] > boundsObj.x2) {\n                boundsObj.x2 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y2 === undefined || canvasPointsArr[i][1] > boundsObj.y2) {\n                boundsObj.y2 = canvasPointsArr[i][1];\n            }\n        }\n        const boundsWidth = boundsObj.x2! - boundsObj.x1!;\n        const boundsHeight = boundsObj.y2! - boundsObj.y1!;\n\n        //fit bounds\n        const padding = 0;\n        const { width: fitWidth } = BB.fitInto(\n            boundsWidth,\n            boundsHeight,\n            this.width - padding,\n            this.height - padding,\n            1,\n        );\n\n        //determine scale\n        const factor = Math.min(EASEL_MAX_SCALE, fitWidth / boundsWidth);\n\n        const viewportRect = { width: this.width, height: this.height };\n        const viewportCenterP = {\n            x: viewportRect.width / 2,\n            y: viewportRect.height / 2,\n        };\n        return createTransform(\n            viewportCenterP,\n            { x: projectWidth / 2, y: projectHeight / 2 },\n            factor,\n            newAngleDeg,\n        );\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TEaselParams<GToolId>) {\n        this.project = p.project;\n        this.width = p.width;\n        this.height = p.height;\n        this.tool = p.tool;\n        this.toolsMap = { ...p.tools };\n        this.onChangeTool = p.onChangeTool;\n        this.onTransformChange = p.onTransformChange;\n        this.onUndo = p.onUndo;\n        this.onRedo = p.onRedo;\n\n        this.tempTools = Object.fromEntries(\n            TEMP_TRIGGERS.map((trigger) => {\n                return [\n                    trigger,\n                    getToolEntries(this.toolsMap)\n                        .filter(([toolName, tool]) => {\n                            return tool.tempTriggers && tool.tempTriggers.includes(trigger);\n                        })\n                        .map((i) => i[0])[0],\n                ];\n            }),\n        ) as Record<TEaselToolTrigger, GToolId | undefined>;\n\n        this.viewport = new ProjectViewport({\n            width: this.width,\n            height: this.height,\n            project: {\n                width: this.project.width,\n                height: this.project.height,\n                layers: this.project.layers,\n            },\n            transform: this.getResetTransform(),\n            renderAfter: (ctx, renderedTransform) => {\n                const tool = this.getActiveTool();\n                tool.renderAfterViewport?.(ctx, renderedTransform);\n            },\n        });\n\n        Object.values<TEaselTool>(this.toolsMap).forEach((tool) => {\n            tool.setEaselInterface?.(this.easelInterface);\n            tool.onResize?.(this.width, this.height);\n        });\n\n        let mouseMiddleIsDown = false;\n        let mouseRightIsDown = false;\n\n        let angleIsExtraSticky = false;\n        this.pointerPreprocessor = new EaselPointerPreprocessor({\n            onUndo: this.onUndo,\n            onRedo: this.onRedo,\n            onPinch: (event) => {\n                if (event.type === 'move') {\n                    const transform = this.viewport.getTransform();\n                    if (!this.pinchInitialTransform) {\n                        this.pinchInitialTransform = BB.copyObj(transform);\n                        angleIsExtraSticky = this.pinchInitialTransform.angleDeg % 180 === 0;\n                    }\n\n                    let newAngleDeg =\n                        this.pinchInitialTransform.angleDeg + (event.angleRad / Math.PI) * 180;\n                    newAngleDeg = minimizeAngleDeg(\n                        snapAngleDeg(newAngleDeg, 90, angleIsExtraSticky ? 12 : 4),\n                    );\n                    if (newAngleDeg % 90 !== 0) {\n                        angleIsExtraSticky = false;\n                    }\n\n                    const metaTransform = toMetaTransform(this.pinchInitialTransform, {\n                        x: event.downRelX,\n                        y: event.downRelY,\n                    });\n                    metaTransform.scale = BB.clamp(\n                        this.pinchInitialTransform.scale * event.scale,\n                        EASEL_MIN_SCALE,\n                        EASEL_MAX_SCALE,\n                    );\n                    metaTransform.viewportP.x += event.relX - event.downRelX;\n                    metaTransform.viewportP.y += event.relY - event.downRelY;\n                    metaTransform.angleDeg = newAngleDeg;\n\n                    this.setTargetTransform(\n                        createTransform(\n                            metaTransform.viewportP,\n                            metaTransform.canvasP,\n                            metaTransform.scale,\n                            metaTransform.angleDeg,\n                        ),\n                        true,\n                    );\n                    this.requestRender();\n                } else if (event.type === 'end') {\n                    this.pinchInitialTransform = undefined;\n                }\n            },\n            onDoubleTap: (e) => {\n                if (this.fitTransform()) {\n                    this.requestRender();\n                } else {\n                    this.scale(2, e.relX, e.relY);\n                }\n            },\n            onChainOut: (e) => {\n                this.cursorPos = {\n                    x: e.relX,\n                    y: e.relY,\n                };\n                if (e.type === 'pointerdown') {\n                    if (e.button === 'middle') {\n                        mouseMiddleIsDown = true;\n                        this.pushTempTool(this.tempTools['mouse-middle']);\n                    }\n                    if (e.button === 'right') {\n                        mouseRightIsDown = true;\n                        this.pushTempTool(this.tempTools['mouse-right']);\n                    }\n                } else if (e.type === 'pointermove') {\n                    // noop?\n                } else if (e.type === 'pointerup') {\n                    if (mouseMiddleIsDown) {\n                        mouseMiddleIsDown = false;\n                        this.getActiveTool().onPointer(e);\n                        this.popTempTool(this.tempTools['mouse-middle']);\n                        return;\n                    }\n                    if (mouseRightIsDown) {\n                        mouseRightIsDown = false;\n                        this.getActiveTool().onPointer(e);\n                        this.popTempTool(this.tempTools['mouse-right']);\n                        return;\n                    }\n                }\n                this.getActiveTool().onPointer(e);\n            },\n        });\n        /*\n        // My trackpad pinching (via PointerListener) doesn't currently work with Safari on macOS.\n        // So I tried GestureListener, which works, but doesn't mesh well with the other event listeners.\n        let lastScale = 0;\n        this.gestureListener = new GestureListener({\n            target: this.viewport.getElement(),\n            onStart: (e) => {\n                lastScale = e.scale;\n            },\n            onChange: (e) => {\n                const deltaScale = e.scale / lastScale;\n                lastScale = e.scale;\n\n                // zoom\n                const transform = this.viewport.getTransform();\n                const viewportPoint = {\n                    x: e.layerX,\n                    y: e.layerY,\n                };\n                const mat = createMatrixFromTransform(transform);\n                const canvasPoint = applyToPoint(inverse(mat), viewportPoint);\n                const newScale = BB.clamp(\n                    transform.scale * deltaScale,\n                    EASEL_MIN_SCALE,\n                    EASEL_MAX_SCALE,\n                );\n                this.setTransform(\n                    createTransform(viewportPoint, canvasPoint, newScale, transform.angleDeg),\n                );\n                this.requestRender();\n            },\n        });*/\n\n        this.pointerListener = new PointerListener({\n            target: this.viewport.getElement(),\n            onPointer: (e) => {\n                this.pointerPreprocessor.chainIn(e);\n            },\n            onWheel: (e) => {\n                e.event?.preventDefault();\n                let isImmediate = false;\n                if (Math.abs(e.deltaY) < 0.8) {\n                    isImmediate = true;\n                }\n                if (e.event && e.event.ctrlKey && !this.keyListener.isPressed('ctrl')) {\n                    isImmediate = true;\n                    let factor = 1;\n                    if (e.event.deltaMode === 0) {\n                        factor = 6;\n                    }\n                    e.deltaY *= factor;\n                }\n                if (this.keyListener.isPressed('shift')) {\n                    e.deltaY /= 4;\n                }\n\n                // zoom\n                const transform = this.targetTransform;\n                const viewportPoint = {\n                    x: e.relX,\n                    y: e.relY,\n                };\n                const mat = createMatrixFromTransform(transform);\n                const canvasPoint = applyToPoint(inverse(mat), viewportPoint);\n                const newScale = BB.clamp(\n                    transform.scale * Math.pow(1 + 4 / 10, -e.deltaY),\n                    EASEL_MIN_SCALE,\n                    EASEL_MAX_SCALE,\n                );\n                this.setTargetTransform(\n                    createTransform(viewportPoint, canvasPoint, newScale, transform.angleDeg),\n                    isImmediate,\n                );\n            },\n            onEnterLeave: (isOver) => {\n                const tool = this.getActiveTool();\n                if (!isOver) {\n                    this.cursorPos = undefined;\n                    tool.onPointerLeave?.();\n                }\n            },\n            useDirtyWheel: true,\n            isWheelPassive: false,\n            maxPointers: 3, // 3 fingers needed for redo gesture\n        });\n\n        this.windowPointerListener = (e: PointerEvent) => {\n            if (this.isFrozen) {\n                return;\n            }\n            if (!this.rootEl.contains(e.target as Node)) {\n                this.getActiveTool().onClickOutside?.();\n            }\n        };\n        window.addEventListener('pointerdown', this.windowPointerListener);\n\n        this.keyListener = new KeyListener({\n            onDown: (keyStr, e, comboStr, isRepeat) => {\n                if (this.isFrozen) {\n                    return;\n                }\n\n                if (comboStr === 'plus') {\n                    const oldScale = this.getTransform().scale;\n                    const newScale = zoomByStep(\n                        oldScale,\n                        this.keyListener.isPressed('shift') ? 1 / 8 : 1 / 2,\n                    );\n                    this.scale(newScale / oldScale);\n                }\n                if (comboStr === 'minus') {\n                    const oldScale = this.getTransform().scale;\n                    const newScale = zoomByStep(\n                        oldScale,\n                        this.keyListener.isPressed('shift') ? -1 / 8 : -1 / 2,\n                    );\n                    this.scale(newScale / oldScale);\n                }\n                if (this.keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\n                    const activeTool = this.getActiveTool();\n                    if (!activeTool.onArrowKeys?.(keyStr as TArrowKey)) {\n                        const stepSize = 40;\n                        if (keyStr === 'left') {\n                            this.translate(stepSize, 0);\n                        }\n                        if (keyStr === 'right') {\n                            this.translate(-stepSize, 0);\n                        }\n                        if (keyStr === 'up') {\n                            this.translate(0, stepSize);\n                        }\n                        if (keyStr === 'down') {\n                            this.translate(0, -stepSize);\n                        }\n                    }\n                }\n\n                // activate temporary tool\n                TEMP_TRIGGERS_KEYS.forEach((keyTrigger) => {\n                    if (\n                        comboStr === keyTrigger &&\n                        this.toolsMap[this.tool].blockTrigger !== keyTrigger\n                    ) {\n                        this.pushTempTool(this.tempTools[keyTrigger]);\n                    }\n                });\n                const tool = this.toolsMap[this.tempTool ?? this.tool];\n                tool.onKeyDown?.(keyStr, e, comboStr, isRepeat);\n            },\n            onUp: (keyStr, e, oldComboStr) => {\n                if (this.isFrozen) {\n                    return;\n                }\n\n                // turn off temporary tool again\n                TEMP_TRIGGERS_KEYS.forEach((keyTrigger) => {\n                    if (\n                        keyStr === keyTrigger &&\n                        this.toolsMap[this.tool].blockTrigger !== keyTrigger\n                    ) {\n                        this.popTempTool(this.tempTools[keyTrigger]);\n                    }\n                });\n                const tool = this.toolsMap[this.tempTool ?? this.tool];\n                tool.onKeyUp?.(keyStr, e, oldComboStr);\n            },\n            onBlur: () => {\n                const tool = this.toolsMap[this.tempTool ?? this.tool];\n                tool.onBlur?.();\n            },\n        });\n        this.easelInterface.keyListener = this.keyListener;\n\n        this.selectionRenderer = new SelectionRenderer({\n            transform: this.viewport.getTransform(),\n            selection: this.project.selection,\n            width: this.width,\n            height: this.height,\n        });\n\n        this.svgEl = BB.createSvg({\n            elementType: 'svg',\n            width: '' + this.width,\n            height: '' + this.height,\n        });\n        css(this.svgEl, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            pointerEvents: 'none',\n        });\n        this.svgEl.append(\n            this.selectionRenderer.getElement(),\n            ...Object.values<TEaselTool>(this.toolsMap).map((item) => item.getSvgElement()),\n        );\n        this.updateToolSvgs();\n\n        this.rootEl = c(\n            {\n                css: {\n                    userSelect: 'none',\n                    touchAction: 'none',\n                    overscrollBehaviorX: 'none',\n                },\n            },\n            [this.viewport.getElement(), this.svgEl],\n        );\n\n        // prevent contextmenu\n        this.rootEl.addEventListener(\n            'contextmenu',\n            (e) => {\n                e.preventDefault();\n                return false;\n            },\n            { passive: false },\n        );\n\n        // Carried over from old KlCanvasWorkspace. Prevent some default browser behavior. Todo what breaks if removed?\n        this.rootEl.addEventListener('touchend', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        // Carried over from old KlCanvasWorkspace. Prevent some default browser behavior. Todo what breaks if removed?\n        this.rootEl.addEventListener('dragstart', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        this.toolsMap[this.tool].activate?.(this.cursorPos);\n        this.renderLoop();\n    }\n\n    /** update and render */\n    setProject(project: TEaselProject): void {\n        this.project = project;\n        this.viewport.setProject({\n            width: this.project.width,\n            height: this.project.height,\n            layers: this.project.layers,\n        });\n        this.selectionRenderer.setSelection(this.project.selection);\n        this.getActiveTool().onUpdateSelection?.(this.project.selection);\n        this.requestRender();\n    }\n\n    /** update and render */\n    setSize(width: number, height: number): void {\n        const m = createMatrixFromTransform(this.viewport.getTransform());\n        const canvasCenterPoint = applyToPoint(inverse(m), {\n            x: this.width / 2,\n            y: this.height / 2,\n        });\n\n        this.width = width;\n        this.height = height;\n        BB.setAttributes(this.svgEl, {\n            width: '' + this.width,\n            height: '' + this.height,\n        });\n        this.selectionRenderer.setSize(width, height);\n        this.getActiveTool().onResize?.(width, height);\n        this.viewport.setSize(width, height);\n        const transform = this.viewport.getTransform();\n        this.setTargetTransform(\n            createTransform(\n                {\n                    x: this.width / 2,\n                    y: this.height / 2,\n                },\n                canvasCenterPoint,\n                transform.scale,\n                transform.angleDeg,\n            ),\n            true,\n        );\n\n        this.requestRender();\n    }\n\n    requestRender(): void {\n        this.doRender = true;\n    }\n\n    getTransform(): TViewportTransform {\n        return this.viewport.getTransform();\n    }\n\n    setTransform(transform: TViewportTransform): void {\n        this.setTargetTransform(transform, true);\n    }\n\n    setTool(toolId: GToolId): void {\n        if (toolId === this.tool) {\n            return;\n        }\n        this.tool = toolId;\n        this.toolsMap[this.tool].activate?.(this.cursorPos);\n        this.onChangeTool(toolId);\n        this.updateToolSvgs();\n        this.updateDoubleTapPointerTypes();\n        this.requestRender();\n    }\n\n    getTool(): GToolId {\n        return this.tool;\n    }\n\n    translate(dX: number, dY: number): void {\n        const transform = this.targetTransform;\n        this.setTargetTransform({\n            ...transform,\n            x: transform.x + dX,\n            y: transform.y + dY,\n        });\n    }\n\n    scale(factor: number, viewportX?: number, viewportY?: number): void {\n        const before = this.targetTransform;\n        const viewportRect = { width: this.width, height: this.height };\n        viewportX = viewportX ?? viewportRect.width / 2;\n        viewportY = viewportY ?? viewportRect.height / 2;\n\n        const metaTransform = toMetaTransform(before, { x: viewportX, y: viewportY });\n        metaTransform.scale = BB.clamp(\n            metaTransform.scale * factor,\n            EASEL_MIN_SCALE,\n            EASEL_MAX_SCALE,\n        );\n\n        this.setTargetTransform(\n            createTransform(\n                metaTransform.viewportP,\n                metaTransform.canvasP,\n                metaTransform.scale,\n                metaTransform.angleDeg,\n            ),\n        );\n    }\n\n    resetTransform(isImmediate?: boolean): void {\n        const transform = this.getResetTransform();\n        this.setTargetTransform(transform, isImmediate);\n        this.requestRender();\n    }\n\n    fitTransform(isImmediate?: boolean): boolean {\n        const oldTransform = this.viewport.getTransform();\n        const transform = this.getFitTransform();\n\n        const isPositionChanged = transform.x !== oldTransform.x || transform.y !== oldTransform.y;\n        const isScaleOrAngleChanged =\n            transform.scale !== oldTransform.scale || transform.angleDeg !== oldTransform.angleDeg;\n\n        if (!isPositionChanged && !isScaleOrAngleChanged) {\n            return false;\n        }\n\n        this.setTargetTransform(transform, isImmediate);\n        return true;\n    }\n\n    /**\n     * Automatically decide what is best. E.g. if it's pixel art, Fit might be better.\n     */\n    resetOrFitTransform(isImmediate?: boolean): void {\n        const threshold = 4; // >= 400% zoom. pixelated, not blurry\n        if (\n            !KL_CONFIG.disableAutoFit &&\n            this.project.width <= this.width / threshold &&\n            this.project.height <= this.height / threshold\n        ) {\n            this.fitTransform(isImmediate);\n        } else {\n            this.resetTransform(isImmediate);\n        }\n    }\n\n    setAngleDeg(angleDeg: number, isRelative: undefined | boolean) {\n        const viewportTransform = this.targetTransform;\n        const viewportMat = createMatrixFromTransform(viewportTransform);\n        const viewportRect = { width: this.width, height: this.height };\n        const viewportCenterP = {\n            x: viewportRect.width / 2,\n            y: viewportRect.height / 2,\n        };\n        const newAngleDeg = minimizeAngleDeg(\n            isRelative ? viewportTransform.angleDeg + angleDeg : angleDeg,\n        );\n\n        const newViewportTransform = createTransform(\n            viewportCenterP,\n            applyToPoint(inverse(viewportMat), viewportCenterP),\n            viewportTransform.scale,\n            newAngleDeg,\n        );\n        this.setTargetTransform(newViewportTransform);\n    }\n\n    getIsLocked(): boolean {\n        return this.getActiveTool().getIsLocked?.() ?? false;\n    }\n\n    setIsFrozen(b: boolean): void {\n        this.isFrozen = b;\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy(): void {\n        this.viewport.destroy();\n        this.pointerListener.destroy();\n        this.keyListener.destroy();\n        this.animationFrameId !== undefined && cancelAnimationFrame(this.animationFrameId);\n        this.selectionRenderer.destroy();\n        window.removeEventListener('pointerdown', this.windowPointerListener);\n    }\n}\n","import { NFingerTapper } from '../../../bb/input/event-chain/n-finger-tapper';\nimport { DoubleTapper, TDoubleTapperEvent } from '../../../bb/input/event-chain/double-tapper';\nimport { PinchZoomer, TPinchZoomerEvent } from '../../../bb/input/event-chain/pinch-zoomer';\nimport { BB } from '../../../bb/bb';\nimport { EventChain } from '../../../bb/input/event-chain/event-chain';\nimport { TChainElement } from '../../../bb/input/event-chain/event-chain.types';\nimport { TPointerEvent, TPointerType } from '../../../bb/input/event.types';\n\nexport type TEaselPointerPreprocessor = {\n    onChainOut: (e: TPointerEvent) => void;\n    onDoubleTap: (e: TDoubleTapperEvent) => void;\n    onUndo?: () => void;\n    onRedo?: () => void;\n    onPinch: (e: TPinchZoomerEvent) => void;\n};\n\n/**\n * lets pointer events go through an event chain,\n * which checks for double tapping and other gestures,\n * then filters to a single pointer\n */\nexport class EaselPointerPreprocessor {\n    private readonly pointerEventChain: EventChain;\n    private readonly twoFingerTap: NFingerTapper | undefined;\n    private readonly threeFingerTap: NFingerTapper | undefined;\n    private readonly mainDoubleTapper: DoubleTapper;\n    private readonly middleDoubleTapper: DoubleTapper;\n    private readonly pinchZoomer: PinchZoomer;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TEaselPointerPreprocessor) {\n        const nFingerSubChain: TChainElement[] = [];\n        if (p.onUndo) {\n            this.twoFingerTap = new BB.NFingerTapper({\n                fingers: 2,\n                onTap: p.onUndo,\n            });\n            nFingerSubChain.push(this.twoFingerTap as TChainElement);\n        }\n        if (p.onRedo) {\n            this.threeFingerTap = new BB.NFingerTapper({\n                fingers: 3,\n                onTap: p.onRedo,\n            });\n            nFingerSubChain.push(this.threeFingerTap as TChainElement);\n        }\n        this.mainDoubleTapper = new BB.DoubleTapper({ onDoubleTap: p.onDoubleTap });\n        this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        this.middleDoubleTapper = new BB.DoubleTapper({ onDoubleTap: p.onDoubleTap });\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\n        this.pinchZoomer = new BB.PinchZoomer({\n            onPinch: p.onPinch,\n        });\n\n        this.pointerEventChain = new EventChain({\n            chainArr: [\n                ...nFingerSubChain,\n                this.mainDoubleTapper as TChainElement,\n                this.middleDoubleTapper as TChainElement,\n                this.pinchZoomer as TChainElement,\n                new BB.OnePointerLimiter() as TChainElement,\n            ],\n        });\n        this.pointerEventChain.setChainOut(p.onChainOut);\n    }\n\n    chainIn(e: TPointerEvent): void {\n        this.pointerEventChain.chainIn(e);\n    }\n\n    setDoubleTapPointerTypes(p: TPointerType[]): void {\n        this.mainDoubleTapper.setAllowedPointerTypeArr(p);\n    }\n\n    destroy() {\n        // todo\n    }\n}\n","import { TPointerType } from '../../../bb/input/event.types';\n\nexport const DEFAULT_DOUBLE_TAP_POINTER_TYPES: TPointerType[] = ['touch'];\n\n// triggers for switching into temp tool\nexport const TEMP_TRIGGERS_KEYS = ['space', 'alt', 'r', 'z'] as const;\nexport const TEMP_TRIGGERS = ['mouse-middle', 'mouse-right', ...TEMP_TRIGGERS_KEYS] as const;\n\nexport const EASEL_MIN_SCALE = 1 / 16;\nexport const EASEL_MAX_SCALE = Math.pow(2, 7);\n","import { TViewportTransform } from '../project-viewport';\n\nexport function isTransformEqual(a: TViewportTransform, b: TViewportTransform): boolean {\n    const isPositionChanged = a.x !== b.x || a.y !== b.y;\n    const isScaleOrAngleChanged = a.scale !== b.scale || a.angleDeg !== b.angleDeg;\n    return !isPositionChanged && !isScaleOrAngleChanged;\n}\n","import { TViewportTransform } from '../project-viewport';\nimport { TSize2D, TVector2D } from '../../../../bb/bb-types';\nimport { isTransformEqual } from './is-transform-equal';\nimport { BB } from '../../../../bb/bb';\nimport { TMetaTransform, toMetaTransform } from '../../../../bb/transform/to-meta-transform';\nimport { createTransform } from '../../../../bb/transform/create-transform';\nimport { createMatrixFromTransform } from '../../../../bb/transform/create-matrix-from-transform';\nimport { applyToPoint } from 'transformation-matrix';\n\nexport function blendTransform(\n    currentTransform: TViewportTransform,\n    targetTransform: TViewportTransform,\n    projectSize: TSize2D,\n    viewportCenter: TVector2D,\n    easeFactor: number,\n): TViewportTransform {\n    // equal\n    if (isTransformEqual(currentTransform, targetTransform)) {\n        return { ...targetTransform };\n    }\n\n    // approximately equal\n    if (\n        (currentTransform.x === targetTransform.x ||\n            Math.abs(currentTransform.x - targetTransform.x) < 2) &&\n        (currentTransform.y === targetTransform.y ||\n            Math.abs(currentTransform.y - targetTransform.y) < 2) &&\n        (currentTransform.scale === targetTransform.scale ||\n            Math.abs(currentTransform.scale - targetTransform.scale) < 0.08 * targetTransform.scale)\n    ) {\n        return {\n            ...targetTransform,\n        };\n    }\n\n    // same angle, just translate and scale\n    if (currentTransform.angleDeg === targetTransform.angleDeg) {\n        return {\n            x: BB.mix(currentTransform.x, targetTransform.x, easeFactor),\n            y: BB.mix(currentTransform.y, targetTransform.y, easeFactor),\n            angleDeg: targetTransform.angleDeg,\n            scale: BB.mix(currentTransform.scale, targetTransform.scale, easeFactor),\n        };\n    }\n\n    // rotating around a point\n    const currentMeta = toMetaTransform(currentTransform, viewportCenter);\n    const targetMeta = toMetaTransform(targetTransform, viewportCenter);\n    if (BB.Vec2.dist(currentMeta.canvasP, targetMeta.canvasP) < 1) {\n        // move angles closer to each other. assumes [-180, 180] angle range.\n        let closerCurrentAngleDeg = currentMeta.angleDeg;\n        // -180 180 -> 180 + 180 = 360\n        // 180 -180 -> -180 - 180 = -360\n        const angleDelta = targetMeta.angleDeg - currentMeta.angleDeg;\n        if (angleDelta > 180) {\n            closerCurrentAngleDeg += 360;\n        }\n        if (angleDelta < -180) {\n            closerCurrentAngleDeg -= 360;\n        }\n\n        const mixedMeta: TMetaTransform = {\n            viewportP: viewportCenter,\n            canvasP: targetMeta.canvasP,\n            scale: BB.mix(currentTransform.scale, targetTransform.scale, easeFactor),\n            angleDeg: BB.mix(closerCurrentAngleDeg, targetTransform.angleDeg, easeFactor),\n        };\n\n        return createTransform(\n            mixedMeta.viewportP,\n            mixedMeta.canvasP,\n            mixedMeta.scale,\n            mixedMeta.angleDeg,\n        );\n    }\n\n    // rotate around center of canvas\n    const canvasCenter = {\n        x: projectSize.width / 2,\n        y: projectSize.height / 2,\n    };\n    const currentMatrix = createMatrixFromTransform(currentTransform);\n    const targetMatrix = createMatrixFromTransform(targetTransform);\n    const currentCenter = applyToPoint(currentMatrix, canvasCenter);\n    const targetCenter = applyToPoint(targetMatrix, canvasCenter);\n\n    const mixedCenter = {\n        x: BB.mix(currentCenter.x, targetCenter.x, easeFactor),\n        y: BB.mix(currentCenter.y, targetCenter.y, easeFactor),\n    };\n    const mixedScale = BB.mix(currentTransform.scale, targetTransform.scale, easeFactor);\n    const mixedAngleDeg = BB.mix(currentTransform.angleDeg, targetTransform.angleDeg, easeFactor);\n\n    const mixedAngleRad = mixedAngleDeg * (Math.PI / 180);\n\n    // calculate the offset from the center to the top-left corner (origin)\n    const offsetX = -canvasCenter.x * mixedScale;\n    const offsetY = -canvasCenter.y * mixedScale;\n\n    const rotatedOffsetX = offsetX * Math.cos(mixedAngleRad) - offsetY * Math.sin(mixedAngleRad);\n    const rotatedOffsetY = offsetX * Math.sin(mixedAngleRad) + offsetY * Math.cos(mixedAngleRad);\n\n    const origin = {\n        x: mixedCenter.x + rotatedOffsetX,\n        y: mixedCenter.y + rotatedOffsetY,\n    };\n\n    return {\n        x: origin.x,\n        y: origin.y,\n        scale: mixedScale,\n        angleDeg: mixedAngleDeg,\n    };\n}\n","import { BB } from '../../../../bb/bb';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { TPointerEvent, TPointerType } from '../../../../bb/input/event.types';\nimport { TEaselInterface, TEaselTool, TEaselToolTrigger } from '../easel.types';\nimport { InertiaScrolling } from '../inertia-scrolling';\n\nexport type TEaselHandParams = object;\n\nexport class EaselHand implements TEaselTool {\n    private readonly svgEl: SVGElement;\n    private easel: TEaselInterface = {} as TEaselInterface;\n    private inertiaScrolling: InertiaScrolling;\n\n    // ----------------------------------- public -----------------------------------\n    doubleTapPointerTypes: TPointerType[] = ['touch', 'mouse', 'pen'];\n    tempTriggers: TEaselToolTrigger[] = ['space', 'mouse-middle'];\n\n    constructor(p: TEaselHandParams) {\n        this.svgEl = BB.createSvg({\n            elementType: 'g',\n        });\n        this.inertiaScrolling = new InertiaScrolling({\n            getTransform: () => this.easel.getTransform(),\n            setTransform: (transform) => this.easel.setTransform(transform, true),\n        });\n    }\n\n    getSvgElement(): SVGElement {\n        return this.svgEl;\n    }\n\n    onPointer(e: TPointerEvent): void {\n        this.easel.setCursor('grab');\n\n        if (e.type === 'pointerdown' && ['left', 'middle'].includes(e.button!)) {\n            this.inertiaScrolling.dragStart();\n            this.easel.setCursor('grabbing');\n        }\n        if (e.type === 'pointermove' && ['left', 'middle'].includes(e.button!)) {\n            const vTransform = { ...this.easel.getTransform() };\n            vTransform.x += e.dX;\n            vTransform.y += e.dY;\n            this.easel.setTransform(vTransform, true);\n            this.easel.requestRender();\n            this.easel.setCursor('grabbing');\n            this.inertiaScrolling.dragMove(e.dX, e.dY);\n        }\n        if (e.type === 'pointerup' && e.button === undefined) {\n            this.inertiaScrolling.dragEnd();\n        }\n    }\n\n    setEaselInterface(easelInterface: TEaselInterface): void {\n        this.easel = easelInterface;\n    }\n\n    activate(cursorPos?: TVector2D): void {\n        this.easel.setCursor('grab');\n    }\n\n    setUseInertiaScrolling(b: boolean): void {\n        this.inertiaScrolling.setIsEnabled(b);\n    }\n}\n","import { TVector2D } from '../../../bb/bb-types';\nimport { TViewportTransform } from '../project-viewport/project-viewport';\nimport { BB } from '../../../bb/bb';\n\nexport type TInertiaScrollingParams = {\n    getTransform: () => TViewportTransform;\n    setTransform: (transform: TViewportTransform) => void;\n};\n\n/**\n * flings the viewport into the direction the pointer was dragging\n */\nexport class InertiaScrolling {\n    // from params\n    private readonly getTransform: () => TViewportTransform;\n    private readonly setTransform: (transform: TViewportTransform) => void;\n\n    private readonly defaultDeltaMs = 1000 / 60; // time factor is 1 for 60fps, 2 for 120fps\n    private momentum: TVector2D = { x: 0, y: 0 };\n    private isDragging: boolean = false;\n    private lastDragTimestamp: number = 0;\n    private lastTransform: TViewportTransform | undefined;\n    private animationFrameHandle: ReturnType<typeof requestAnimationFrame> | undefined;\n    private lastTimestamp: number = 0;\n    private isEnabled: boolean = false;\n\n    private stop(): void {\n        if (this.animationFrameHandle === undefined) {\n            return;\n        }\n        cancelAnimationFrame(this.animationFrameHandle);\n        this.animationFrameHandle = undefined;\n    }\n\n    private dampen(timeFactor: number): void {\n        const vecLen = BB.Vec2.len(this.momentum);\n\n        if (vecLen < 0.3) {\n            this.momentum.x = 0;\n            this.momentum.y = 0;\n            this.stop();\n        } else if (vecLen < 5) {\n            this.momentum.x *= 0.85 ** timeFactor;\n            this.momentum.y *= 0.85 ** timeFactor;\n        } else {\n            this.momentum.x *= 0.95 ** timeFactor;\n            this.momentum.y *= 0.95 ** timeFactor;\n        }\n    }\n\n    // only call through requestAnimationFrame when animationFrameHandle undefined\n    private physicsLoop(): void {\n        this.animationFrameHandle = requestAnimationFrame(() => this.physicsLoop());\n        const nowMs = performance.now();\n        const deltaMs = nowMs - this.lastTimestamp;\n        const timeFactor = deltaMs / this.defaultDeltaMs;\n        this.lastTimestamp = nowMs;\n        if ((this.momentum.x === 0 && this.momentum.y === 0) || this.isDragging) {\n            if (this.isDragging) {\n                this.dampen(timeFactor);\n            } else {\n                this.stop();\n            }\n            return;\n        }\n        const transform = this.getTransform();\n        if (\n            this.lastTransform &&\n            (this.lastTransform.x !== transform.x ||\n                this.lastTransform.y !== transform.y ||\n                this.lastTransform.x !== transform.x ||\n                this.lastTransform.x !== transform.x)\n        ) {\n            this.momentum.x = 0;\n            this.momentum.y = 0;\n            this.lastTransform = undefined;\n            this.stop();\n            return;\n        }\n\n        transform.x += this.momentum.x;\n        transform.y += this.momentum.y;\n        this.lastTransform = transform;\n\n        this.dampen(timeFactor);\n        this.setTransform(transform);\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: TInertiaScrollingParams) {\n        this.getTransform = p.getTransform;\n        this.setTransform = p.setTransform;\n    }\n\n    dragStart(): void {\n        if (!this.isEnabled) {\n            return;\n        }\n        this.isDragging = true;\n        this.momentum.x = 0;\n        this.momentum.y = 0;\n        this.stop();\n    }\n\n    dragMove(dX: number, dY: number): void {\n        if (!this.isEnabled) {\n            return;\n        }\n        this.momentum = {\n            x: BB.mix(this.momentum.x, dX, 0.6),\n            y: BB.mix(this.momentum.y, dY, 0.6),\n        };\n        this.lastDragTimestamp = new Date().getTime();\n    }\n\n    dragEnd(): void {\n        if (!this.isEnabled) {\n            return;\n        }\n        if (new Date().getTime() - this.lastDragTimestamp > 80) {\n            this.momentum.x = 0;\n            this.momentum.y = 0;\n        } else {\n            this.lastTimestamp = performance.now();\n            this.animationFrameHandle = requestAnimationFrame(() => this.physicsLoop());\n        }\n        this.lastTransform = undefined;\n        this.lastDragTimestamp = 0;\n        this.isDragging = false;\n    }\n\n    setIsEnabled(b: boolean): void {\n        this.isEnabled = b;\n    }\n}\n","import { BB } from '../../../../bb/bb';\nimport { TPointerEvent } from '../../../../bb/input/event.types';\nimport { createMatrixFromTransform } from '../../../../bb/transform/create-matrix-from-transform';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport {\n    CoalescedExploder,\n    TCoalescedPointerEvent,\n} from '../../../../bb/input/event-chain/coalesced-exploder';\nimport { EventChain } from '../../../../bb/input/event-chain/event-chain';\nimport { TChainElement } from '../../../../bb/input/event-chain/event-chain.types';\nimport { TViewportTransform } from '../../project-viewport/project-viewport';\nimport { TEaselInterface, TEaselTool } from '../easel.types';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { BrushCursorPixelSquare } from './brush-cursor-pixel-square';\nimport { BrushCursorRound } from './brush-cursor-round';\n\nexport type TEaselBrushEvent = {\n    x: number;\n    y: number;\n    isCoalesced: boolean;\n    pressure: number;\n};\n\nexport type TEaselBrushParams = {\n    radius: number;\n\n    onLineStart: (e: TEaselBrushEvent) => void;\n    onLineGo: (e: TEaselBrushEvent) => void;\n    onLineEnd: () => void;\n    onLine: (p1: TVector2D, p2: TVector2D) => void;\n};\n\ntype TLineToolDirection = 'x' | 'y';\n\nexport class EaselBrush implements TEaselTool {\n    private readonly svgEl: SVGElement;\n    private radius: number;\n    private readonly onLineStart: TEaselBrushParams['onLineStart'];\n    private readonly onLineGo: TEaselBrushParams['onLineGo'];\n    private readonly onLineEnd: TEaselBrushParams['onLineEnd'];\n    private readonly onLine: TEaselBrushParams['onLine'];\n    private easel: TEaselInterface = {} as TEaselInterface;\n    private oldScale: number = 1;\n    private isDragging: boolean = false;\n    private eventChain: EventChain; // to explode events\n    private readonly brushCursorRound: BrushCursorRound;\n    private readonly brushCursorPixelSquare: BrushCursorPixelSquare;\n    private currentCursor: BrushCursorRound | BrushCursorPixelSquare;\n    private lastPos: TVector2D = { x: 0, y: 0 };\n    private lastLineEnd: TVector2D | undefined; // in canvas coords\n    private lineToolDirection: TLineToolDirection | undefined;\n    private firstShiftPos: TVector2D | undefined;\n    private hideCursorTimeout: ReturnType<typeof setTimeout> | undefined;\n    private isOver: boolean = false;\n\n    private onExplodedPointer(e: TCoalescedPointerEvent): void {\n        const vTransform = this.easel.getTransform();\n        const m = createMatrixFromTransform(vTransform);\n        // canvas coordinates\n        const p = applyToPoint(inverse(m), { x: e.relX, y: e.relY });\n        const x = p.x;\n        const y = p.y;\n\n        if (vTransform.scale !== this.oldScale) {\n            this.oldScale = vTransform.scale;\n        }\n\n        if (!e.isCoalesced) {\n            this.lastPos.x = e.relX;\n            this.lastPos.y = e.relY;\n            this.currentCursor.update(\n                this.easel.getTransform(),\n                { x: e.relX, y: e.relY },\n                this.radius,\n            );\n            if (!this.isOver && e.type !== 'pointerup') {\n                this._onPointerEnter();\n            }\n        }\n\n        const pressure = e.pressure ?? 1;\n        const isCoalesced = e.isCoalesced;\n        const shiftIsPressed = this.easel.keyListener.isPressed('shift');\n\n        if (shiftIsPressed && !this.firstShiftPos) {\n            this.firstShiftPos = { x: e.relX, y: e.relY };\n        }\n        if (!shiftIsPressed) {\n            this.firstShiftPos = undefined;\n            this.lineToolDirection = undefined;\n        }\n\n        if (e.type === 'pointerdown' && e.button === 'left') {\n            if (shiftIsPressed) {\n                if (this.lastLineEnd) {\n                    this.onLine(this.lastLineEnd, { x, y });\n                }\n                return;\n            }\n\n            this.onLineStart({ x, y, pressure, isCoalesced });\n            this.isDragging = true;\n        }\n        if (e.type === 'pointermove' && e.button === 'left') {\n            if (shiftIsPressed) {\n                if (!this.lineToolDirection) {\n                    const dX = Math.abs(e.relX - this.firstShiftPos!.x);\n                    const dY = Math.abs(e.relY - this.firstShiftPos!.y);\n                    if (dX > 5 || dY > 5) {\n                        this.lineToolDirection = dX > dY ? 'x' : 'y';\n                    }\n                }\n                if (this.lineToolDirection) {\n                    const viewportP = {\n                        x: this.lineToolDirection === 'x' ? e.relX : this.firstShiftPos!.x,\n                        y: this.lineToolDirection === 'y' ? e.relY : this.firstShiftPos!.y,\n                    };\n                    const canvasP = applyToPoint(inverse(m), viewportP);\n                    this.onLineGo({ ...canvasP, pressure, isCoalesced });\n                }\n            } else {\n                this.onLineGo({ x, y, pressure, isCoalesced });\n            }\n        }\n        if (e.type === 'pointerup' && e.button === undefined && this.isDragging) {\n            this.onLineEnd();\n            this.isDragging = false;\n            if (e.pointerType === 'touch') {\n                // due to delay of double-tap listener, pointerleave fires to early\n                this.onPointerLeave();\n            }\n        }\n    }\n\n    private _onPointerEnter(): void {\n        clearTimeout(this.hideCursorTimeout);\n        this.svgEl.setAttribute('opacity', '1');\n        this.isOver = true;\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TEaselBrushParams) {\n        this.radius = p.radius;\n        this.onLineStart = p.onLineStart;\n        this.onLineGo = p.onLineGo;\n        this.onLineEnd = p.onLineEnd;\n        this.onLine = p.onLine;\n        this.svgEl = BB.createSvg({\n            elementType: 'g',\n        });\n        this.brushCursorRound = new BrushCursorRound();\n        this.brushCursorPixelSquare = new BrushCursorPixelSquare();\n        this.currentCursor = this.brushCursorRound;\n        this.svgEl.append(this.currentCursor.getElement());\n\n        this.eventChain = new EventChain({\n            chainArr: [new CoalescedExploder() as TChainElement],\n        });\n        this.eventChain.setChainOut((e) => {\n            this.onExplodedPointer(e as TCoalescedPointerEvent);\n        });\n    }\n\n    getSvgElement(): SVGElement {\n        return this.svgEl;\n    }\n\n    onPointer(e: TPointerEvent): void {\n        this.eventChain.chainIn(e);\n    }\n\n    onPointerLeave(): void {\n        clearTimeout(this.hideCursorTimeout);\n        this.svgEl.setAttribute('opacity', '0');\n        this.isOver = false;\n    }\n\n    setEaselInterface(easelInterface: TEaselInterface): void {\n        this.easel = easelInterface;\n    }\n\n    onUpdateTransform(transform: TViewportTransform): void {\n        this.currentCursor.update(transform, { x: this.lastPos.x, y: this.lastPos.y }, this.radius);\n    }\n\n    getIsLocked(): boolean {\n        return this.isDragging;\n    }\n\n    setBrush(p: { radius?: number; type?: 'round' | 'pixel-square' }): void {\n        if (p.radius !== undefined) {\n            this.radius = p.radius;\n            if (!this.isOver) {\n                this.svgEl.setAttribute('opacity', '1');\n                clearTimeout(this.hideCursorTimeout);\n                this.hideCursorTimeout = setTimeout(() => {\n                    this.svgEl.setAttribute('opacity', '0');\n                }, 500);\n            }\n            const { width, height } = this.easel.getSize();\n            this.currentCursor.update(\n                this.easel.getTransform(),\n                this.isOver ? this.lastPos : { x: width / 2, y: height / 2 },\n                this.radius,\n            );\n        }\n        if (p.type !== undefined) {\n            const newBrushCursor =\n                p.type === 'round' ? this.brushCursorRound : this.brushCursorPixelSquare;\n            if (newBrushCursor !== this.currentCursor) {\n                this.currentCursor.getElement().remove();\n                this.currentCursor = newBrushCursor;\n                this.getSvgElement().append(this.currentCursor.getElement());\n            }\n        }\n    }\n\n    setLastDrawEvent(p?: TVector2D): void {\n        this.lastLineEnd = p ? { ...p } : undefined;\n    }\n\n    activate(cursorPos?: TVector2D): void {\n        this.easel.setCursor('crosshair');\n        this.isDragging = false;\n        if (cursorPos) {\n            this.lastPos.x = cursorPos.x;\n            this.lastPos.y = cursorPos.y;\n            this.currentCursor.update(\n                this.easel.getTransform(),\n                { x: cursorPos.x, y: cursorPos.y },\n                this.radius,\n            );\n        } else {\n            this.onPointerLeave();\n        }\n    }\n}\n","import { BB } from '../../../../bb/bb';\nimport { TViewportTransform } from '../../project-viewport/project-viewport';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { setAttributes } from '../../../../bb/base/base';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { createMatrixFromTransform } from '../../../../bb/transform/create-matrix-from-transform';\n\nexport class BrushCursorPixelSquare {\n    private readonly rootEl: SVGElement;\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {\n        this.rootEl = BB.createSvg({\n            elementType: 'g',\n            childrenArr: [\n                {\n                    elementType: 'path',\n                    fill: 'none',\n                    stroke: 'rgba(255,255,255,0.7)',\n                    'stroke-width': '1',\n                },\n                {\n                    elementType: 'path',\n                    fill: 'none',\n                    stroke: 'rgba(0,0,0,0.7)',\n                    'stroke-width': '1',\n                },\n            ],\n        });\n    }\n\n    update(transform: TViewportTransform, position: TVector2D, size: number): void {\n        const mat = createMatrixFromTransform(transform);\n        size = Math.round(size * 2) / 2;\n        const width = Math.round(size * 2);\n        const canvasCenter = applyToPoint(inverse(mat), position);\n        canvasCenter.x =\n            width % 2 === 0 ? Math.round(canvasCenter.x) : Math.floor(canvasCenter.x) + 0.5;\n        canvasCenter.y =\n            width % 2 === 0 ? Math.round(canvasCenter.y) : Math.floor(canvasCenter.y) + 0.5;\n\n        {\n            const canvasPoints: [number, number][] = [\n                [canvasCenter.x - size, canvasCenter.y - size],\n                [canvasCenter.x + size, canvasCenter.y - size],\n                [canvasCenter.x + size, canvasCenter.y + size],\n                [canvasCenter.x - size, canvasCenter.y + size],\n                [canvasCenter.x - size, canvasCenter.y - size],\n            ];\n            const viewportPoints = canvasPoints.map((point) => {\n                return applyToPoint(mat, point);\n            });\n\n            let path = 'M ';\n            viewportPoints.forEach((point) => {\n                path += point.join(',') + ' ';\n            });\n            setAttributes(this.rootEl.children[1] as Element, {\n                d: path,\n            });\n        }\n        {\n            const viewport1px = 1 / transform.scale;\n            const canvasPoints: [number, number][] = [\n                [canvasCenter.x - size + viewport1px, canvasCenter.y - size + viewport1px],\n                [canvasCenter.x + size - viewport1px, canvasCenter.y - size + viewport1px],\n                [canvasCenter.x + size - viewport1px, canvasCenter.y + size - viewport1px],\n                [canvasCenter.x - size + viewport1px, canvasCenter.y + size - viewport1px],\n                [canvasCenter.x - size + viewport1px, canvasCenter.y - size + viewport1px],\n            ];\n            const viewportPoints = canvasPoints.map((point) => {\n                return applyToPoint(mat, point);\n            });\n\n            let path = 'M ';\n            viewportPoints.forEach((point) => {\n                path += point.join(',') + ' ';\n            });\n            setAttributes(this.rootEl.firstChild as Element, {\n                d: path,\n            });\n        }\n    }\n\n    getElement(): SVGElement {\n        return this.rootEl;\n    }\n}\n","import { BB } from '../../../../bb/bb';\nimport { TViewportTransform } from '../../project-viewport/project-viewport';\nimport { TVector2D } from '../../../../bb/bb-types';\n\nexport class BrushCursorRound {\n    private readonly rootEl: SVGElement;\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {\n        this.rootEl = BB.createSvg({\n            elementType: 'g',\n            childrenArr: [\n                {\n                    elementType: 'circle',\n                    cx: '0',\n                    cy: '0',\n                    fill: 'none',\n                    stroke: 'rgba(255,255,255,0.7)',\n                    'stroke-width': '1',\n                },\n                {\n                    elementType: 'circle',\n                    cx: '0',\n                    cy: '0',\n                    fill: 'none',\n                    stroke: 'rgba(0,0,0,0.7)',\n                    'stroke-width': '1',\n                },\n            ],\n        });\n    }\n\n    update(transform: TViewportTransform, position: TVector2D, size: number): void {\n        BB.setAttributes(this.rootEl.children[0], {\n            r: '' + Math.max(0, size * transform.scale - 1),\n        });\n        BB.setAttributes(this.rootEl.children[1], {\n            r: '' + size * transform.scale,\n        });\n        BB.setAttributes(this.rootEl, {\n            transform: `translate(${position.x} ${position.y})`,\n        });\n    }\n\n    getElement(): SVGElement {\n        return this.rootEl;\n    }\n}\n","import { KlCanvas } from '../../canvas/kl-canvas';\nimport { Easel } from './easel';\nimport { BB } from '../../../bb/bb';\nimport { throwIfNull } from '../../../bb/base/base';\n\nexport type TEaselProjectUpdaterParams<T extends string> = {\n    klCanvas: KlCanvas;\n    easel: Easel<T>;\n};\n\n/**\n * Allows KlCanvas to be rendered by Easel.\n * Call update when KlCanvas changed (added layer, moved layer, removed layer, changed selection, redo/undo)\n */\nexport class EaselProjectUpdater<T extends string> {\n    private readonly klCanvas: KlCanvas;\n    private readonly easel: Easel<T>;\n    private readonly compositeCanvas = BB.canvas(1, 1);\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TEaselProjectUpdaterParams<T>) {\n        this.klCanvas = p.klCanvas;\n        this.easel = p.easel;\n        this.update();\n    }\n\n    update(): void {\n        const width = this.klCanvas.getWidth();\n        const height = this.klCanvas.getHeight();\n        this.easel.setProject({\n            width,\n            height,\n            layers: this.klCanvas.getLayersFast().map((layer) => {\n                return {\n                    image: layer.compositeObj\n                        ? () => {\n                              if (\n                                  this.compositeCanvas.width != width ||\n                                  this.compositeCanvas.height != height\n                              ) {\n                                  this.compositeCanvas.width = width;\n                                  this.compositeCanvas.height = height;\n                              }\n                              const ctx = this.compositeCanvas.getContext('2d')!;\n                              ctx.clearRect(0, 0, width, height);\n                              ctx.drawImage(layer.canvas, 0, 0);\n                              layer.compositeObj?.draw(\n                                  throwIfNull(this.compositeCanvas.getContext('2d')),\n                              );\n                              return this.compositeCanvas;\n                          }\n                        : layer.canvas,\n                    isVisible: layer.isVisible,\n                    opacity: layer.opacity,\n                    mixModeStr: layer.mixModeStr,\n                    hasClipping: false,\n                };\n            }),\n            selection: this.klCanvas.getSelection(),\n        });\n    }\n\n    // if you're not rendering easel for a while\n    freeCompositeCanvas(): void {\n        this.compositeCanvas.width = 1;\n        this.compositeCanvas.height = 1;\n    }\n}\n","import { BB } from '../../../../bb/bb';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { TPointerEvent } from '../../../../bb/input/event.types';\nimport pickerImg from 'url:/src/app/img/ui/cursor-picker.png';\nimport { createMatrixFromTransform } from '../../../../bb/transform/create-matrix-from-transform';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { TEaselInterface, TEaselTool, TEaselToolTrigger } from '../easel.types';\nimport { TRgb } from '../../../kl-types';\n\nexport type TEaselEyedropperParams = {\n    onPick: (p: TVector2D) => TRgb;\n    onPickEnd: () => void;\n};\n\nexport class EaselEyedropper implements TEaselTool {\n    private readonly svgEl: SVGElement;\n    private readonly onPick: TEaselEyedropperParams['onPick'];\n    private readonly onPickEnd: TEaselEyedropperParams['onPickEnd'];\n    private easel: TEaselInterface = {} as TEaselInterface;\n    private isDragging: boolean = false;\n    private readonly previewBorder: SVGElement;\n    private readonly previewColor: SVGElement;\n\n    // ----------------------------------- public -----------------------------------\n    tempTriggers: TEaselToolTrigger[] = ['mouse-right', 'alt'];\n\n    constructor(p: TEaselEyedropperParams) {\n        this.svgEl = BB.createSvg({\n            elementType: 'g',\n        });\n        this.onPick = p.onPick;\n        this.onPickEnd = p.onPickEnd;\n\n        //color picker preview circle\n        this.previewBorder = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '22',\n            fill: 'none',\n        });\n        this.previewColor = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '20',\n            fill: 'none',\n        });\n        this.svgEl.append(this.previewBorder, this.previewColor);\n    }\n\n    getSvgElement(): SVGElement {\n        return this.svgEl;\n    }\n\n    onPointer(e: TPointerEvent): void {\n        this.easel.setCursor(\"url('\" + pickerImg + \"') 0 15, crosshair\");\n        const transform = this.easel.getTransform();\n        const m = createMatrixFromTransform(transform);\n        const p = applyToPoint(inverse(m), { x: e.relX, y: e.relY });\n\n        let color: TRgb | undefined = undefined;\n        let isDown = ['left', 'right'].includes(e.button!);\n        if (isDown) {\n            this.svgEl.setAttribute('transform', `translate(${e.relX},${e.relY})`);\n            this.svgEl.style.opacity = '1';\n        } else {\n            this.svgEl.style.opacity = '0';\n        }\n\n        if (e.type === 'pointerdown' && isDown) {\n            color = this.onPick(p);\n            this.isDragging = true;\n            isDown = true;\n        }\n        if (e.type === 'pointermove' && isDown) {\n            color = this.onPick(p);\n            isDown = true;\n        }\n        if (e.type === 'pointerup' && e.button === undefined && this.isDragging) {\n            this.onPickEnd();\n            this.isDragging = false;\n        }\n        if (color && isDown) {\n            this.previewColor.setAttribute('stroke', BB.ColorConverter.toRgbStr(color));\n            const borderColor = BB.testIsWhiteBestContrast(color)\n                ? 'rgba(255,255,255,0.5)'\n                : 'rgba(0,0,0,0.5)';\n            this.previewBorder.setAttribute('stroke', borderColor);\n        }\n    }\n\n    setEaselInterface(easelInterface: TEaselInterface): void {\n        this.easel = easelInterface;\n    }\n\n    activate(cursorPos?: TVector2D): void {\n        this.easel.setCursor(\"url('\" + pickerImg + \"') 0 15, crosshair\");\n        this.isDragging = false;\n        this.svgEl.style.opacity = '0';\n    }\n\n    onPointerLeave(): void {\n        if (this.isDragging) {\n            return;\n        }\n        this.svgEl.style.opacity = '0';\n    }\n}\n","module.exports = parcelRequire.resolve(\"cursor-picker.1ee2dcb5.png\") + \"?\" + Date.now();","import { BB } from '../../../../bb/bb';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { TPointerEvent } from '../../../../bb/input/event.types';\nimport fillImg from 'url:/src/app/img/ui/cursor-fill.png';\nimport { createMatrixFromTransform } from '../../../../bb/transform/create-matrix-from-transform';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { TEaselInterface, TEaselTool } from '../easel.types';\n\nexport type TEaselPaintBucketParams = {\n    onFill: (p: TVector2D) => void; // int position\n};\n\nexport class EaselPaintBucket implements TEaselTool {\n    private readonly svgEl: SVGElement;\n    private readonly onFill: TEaselPaintBucketParams['onFill'];\n    private easel: TEaselInterface = {} as TEaselInterface;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TEaselPaintBucketParams) {\n        this.svgEl = BB.createSvg({\n            elementType: 'g',\n        });\n        this.onFill = p.onFill;\n    }\n\n    getSvgElement(): SVGElement {\n        return this.svgEl;\n    }\n\n    onPointer(e: TPointerEvent): void {\n        this.easel.setCursor(\"url('\" + fillImg + \"') 1 12, crosshair\");\n        const vTransform = this.easel.getTransform();\n        const m = createMatrixFromTransform(vTransform);\n        const p = applyToPoint(inverse(m), { x: e.relX, y: e.relY });\n\n        if (e.type === 'pointerdown' && e.button === 'left') {\n            this.onFill({\n                x: Math.floor(p.x),\n                y: Math.floor(p.y),\n            });\n        }\n    }\n\n    setEaselInterface(easelInterface: TEaselInterface): void {\n        this.easel = easelInterface;\n    }\n\n    activate(cursorPos?: TVector2D): void {\n        this.easel.setCursor(\"url('\" + fillImg + \"') 1 12, crosshair\");\n    }\n}\n","module.exports = parcelRequire.resolve(\"cursor-fill.419e9951.png\") + \"?\" + Date.now();","import { BB } from '../../../../bb/bb';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { TPointerEvent } from '../../../../bb/input/event.types';\nimport { createMatrixFromTransform } from '../../../../bb/transform/create-matrix-from-transform';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { TEaselInterface, TEaselTool } from '../easel.types';\n\nexport type TEaselGradientParams = {\n    onDown: (p: TVector2D, angleRad: number) => void;\n    onMove: (p: TVector2D) => void;\n    onUp: (p: TVector2D) => void;\n};\n\nexport class EaselGradient implements TEaselTool {\n    private readonly svgEl: SVGElement;\n    private readonly onDown: TEaselGradientParams['onDown'];\n    private readonly onMove: TEaselGradientParams['onMove'];\n    private readonly onUp: TEaselGradientParams['onUp'];\n    private easel: TEaselInterface = {} as TEaselInterface;\n    private isDragging: boolean = false;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TEaselGradientParams) {\n        this.svgEl = BB.createSvg({\n            elementType: 'g',\n        });\n        this.onDown = p.onDown;\n        this.onMove = p.onMove;\n        this.onUp = p.onUp;\n    }\n\n    getSvgElement(): SVGElement {\n        return this.svgEl;\n    }\n\n    onPointer(e: TPointerEvent): void {\n        this.easel.setCursor('crosshair');\n        const vTransform = this.easel.getTransform();\n        const m = createMatrixFromTransform(vTransform);\n        const p = applyToPoint(inverse(m), { x: e.relX, y: e.relY });\n\n        if (e.type === 'pointerdown' && e.button === 'left') {\n            this.onDown(p, (vTransform.angleDeg / 180) * Math.PI);\n            this.isDragging = true;\n        }\n        if (e.type === 'pointermove' && e.button === 'left') {\n            this.onMove(p);\n        }\n        if (e.type === 'pointerup' && e.button === undefined && this.isDragging) {\n            this.onUp(p);\n            this.isDragging = false;\n        }\n    }\n\n    setEaselInterface(easelInterface: TEaselInterface): void {\n        this.easel = easelInterface;\n    }\n\n    getIsLocked(): boolean {\n        return this.isDragging;\n    }\n\n    activate(cursorPos?: TVector2D): void {\n        this.easel.setCursor('crosshair');\n        this.isDragging = false;\n    }\n}\n","import { BB } from '../../../../bb/bb';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { TPointerEvent } from '../../../../bb/input/event.types';\nimport textImg from 'url:/src/app/img/ui/cursor-text.png';\nimport { createMatrixFromTransform } from '../../../../bb/transform/create-matrix-from-transform';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { TEaselInterface, TEaselTool } from '../easel.types';\n\nexport type TEaselTextParams = {\n    onDown: (p: TVector2D, angleRad: number) => void;\n};\n\nexport class EaselText implements TEaselTool {\n    private readonly svgEl: SVGElement;\n    private readonly onDown: TEaselTextParams['onDown'];\n    private easel: TEaselInterface = {} as TEaselInterface;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TEaselTextParams) {\n        this.svgEl = BB.createSvg({\n            elementType: 'g',\n        });\n        this.onDown = p.onDown;\n    }\n\n    getSvgElement(): SVGElement {\n        return this.svgEl;\n    }\n\n    onPointer(e: TPointerEvent): void {\n        this.easel.setCursor(\"url('\" + textImg + \"') 1 12, crosshair\");\n        const vTransform = this.easel.getTransform();\n        const m = createMatrixFromTransform(vTransform);\n        const p = applyToPoint(inverse(m), { x: e.relX, y: e.relY });\n\n        if (e.type === 'pointerdown' && e.button === 'left') {\n            this.onDown(p, (vTransform.angleDeg / 180) * Math.PI);\n        }\n    }\n\n    setEaselInterface(easelInterface: TEaselInterface): void {\n        this.easel = easelInterface;\n    }\n\n    activate(cursorPos?: TVector2D): void {\n        this.easel.setCursor(\"url('\" + textImg + \"') 1 12, crosshair\");\n    }\n}\n","module.exports = parcelRequire.resolve(\"cursor-text.84fce96d.png\") + \"?\" + Date.now();","import { BB } from '../../../../bb/bb';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { TPointerEvent } from '../../../../bb/input/event.types';\nimport { createMatrixFromTransform } from '../../../../bb/transform/create-matrix-from-transform';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { TEaselInterface, TEaselTool } from '../easel.types';\nimport { CornerPanning } from '../corner-panning';\n\nexport type tEaselShapeParams = {\n    onDown: (p: TVector2D, angleRad: number) => void;\n    onMove: (p: TVector2D) => void;\n    onUp: (p: TVector2D) => void;\n};\n\nexport class EaselShape implements TEaselTool {\n    private readonly svgEl: SVGElement;\n    private readonly onDown: tEaselShapeParams['onDown'];\n    private readonly onMove: tEaselShapeParams['onMove'];\n    private readonly onUp: tEaselShapeParams['onUp'];\n    private easel: TEaselInterface = {} as TEaselInterface;\n    private isDragging: boolean = false;\n    private doPan: boolean = false;\n    private cornerPanning: CornerPanning;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: tEaselShapeParams) {\n        this.svgEl = BB.createSvg({\n            elementType: 'g',\n        });\n        this.onDown = p.onDown;\n        this.onMove = p.onMove;\n        this.onUp = p.onUp;\n\n        this.cornerPanning = new CornerPanning({\n            getEaselSize: () => this.easel.getSize(),\n            getTransform: () => this.easel.getTargetTransform(),\n            setTransform: (transform) => this.easel.setTransform(transform, true),\n            testCanPan: (buttonIsPressed) => {\n                return buttonIsPressed;\n            },\n            onRepeatEvent: (e) => {\n                this.onPointer(e, true);\n            },\n        });\n    }\n\n    getSvgElement(): SVGElement {\n        return this.svgEl;\n    }\n\n    onPointer(e: TPointerEvent, isRepeat?: boolean): void {\n        if (this.doPan && !isRepeat) {\n            this.cornerPanning.onPointer(e);\n        }\n\n        this.easel.setCursor('crosshair');\n        const vTransform = this.easel.getTransform();\n        const m = createMatrixFromTransform(vTransform);\n        const p = applyToPoint(inverse(m), { x: e.relX, y: e.relY });\n\n        if (e.type === 'pointerdown' && e.button === 'left') {\n            this.onDown(p, (vTransform.angleDeg / 180) * Math.PI);\n            this.isDragging = true;\n        }\n        if (e.type === 'pointermove' && e.button === 'left') {\n            this.onMove(p);\n        }\n        if (e.type === 'pointerup' && e.button === undefined && this.isDragging) {\n            this.onUp(p);\n            this.isDragging = false;\n        }\n    }\n\n    setEaselInterface(easelInterface: TEaselInterface): void {\n        this.easel = easelInterface;\n    }\n\n    getIsLocked(): boolean {\n        return this.isDragging;\n    }\n    activate(cursorPos?: TVector2D): void {\n        this.easel.setCursor('crosshair');\n        this.isDragging = false;\n    }\n\n    setPanning(doPan: boolean) {\n        this.doPan = doPan;\n    }\n}\n","import { TSize2D, TVector2D } from '../../../bb/bb-types';\nimport { TPointerEvent } from '../../../bb/input/event.types';\nimport { TViewportTransform } from '../project-viewport/project-viewport';\n\nexport type TCornerPanningParams = {\n    getEaselSize: () => TSize2D;\n    getTransform: () => TViewportTransform;\n    setTransform: (transform: TViewportTransform) => void;\n    testCanPan: (buttonIsPressed: boolean) => boolean;\n    onRepeatEvent: (e: TPointerEvent) => void;\n};\n\nexport class CornerPanning {\n    // from params\n    private getEaselSize: () => TSize2D;\n    private readonly getTransform: () => TViewportTransform;\n    private readonly setTransform: (transform: TViewportTransform) => void;\n    private readonly testCanPan: (buttonIsPressed: boolean) => boolean;\n    private readonly onRepeatEvent: (e: TPointerEvent) => void;\n\n    private readonly thresholdPx = 25;\n\n    // state\n    private animationFrameHandle: ReturnType<typeof requestAnimationFrame> | undefined;\n    private lastFrameTimestamp = 0;\n    private cornerDirection: TVector2D | undefined;\n    private repeatEvent: TPointerEvent = {} as TPointerEvent;\n\n    // only call through requestAnimationFrame when animationFrameHandle undefined\n    private movementLoop(): void {\n        if (!this.cornerDirection) {\n            if (this.animationFrameHandle) {\n                cancelAnimationFrame(this.animationFrameHandle);\n            }\n            this.animationFrameHandle = undefined;\n            this.lastFrameTimestamp = 0;\n            return;\n        }\n        this.animationFrameHandle = requestAnimationFrame(() => this.movementLoop());\n\n        const now = performance.now();\n        const deltaMs = now - this.lastFrameTimestamp;\n        const defaultDeltaMs = 1000 / 60;\n        const timeFactor = Math.min(deltaMs / defaultDeltaMs, 10);\n        this.lastFrameTimestamp = now;\n\n        const transform = this.getTransform();\n        transform.x += this.cornerDirection.x * timeFactor;\n        transform.y += this.cornerDirection.y * timeFactor;\n        this.setTransform(transform);\n        this.onRepeatEvent(this.repeatEvent);\n    }\n\n    getSpeed(thresholdDelta: number): number {\n        return Math.min(thresholdDelta, this.thresholdPx) * (2 / 5);\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: TCornerPanningParams) {\n        this.getEaselSize = p.getEaselSize;\n        this.getTransform = p.getTransform;\n        this.setTransform = p.setTransform;\n        this.testCanPan = p.testCanPan;\n        this.onRepeatEvent = p.onRepeatEvent;\n    }\n\n    onPointer(event: TPointerEvent): void {\n        let isMoving = false;\n        this.cornerDirection = { x: 0, y: 0 };\n\n        if (this.testCanPan(event.button !== undefined) && event.type === 'pointermove') {\n            if (event.relX > this.getEaselSize().width - this.thresholdPx) {\n                this.cornerDirection.x -= this.getSpeed(\n                    event.relX - (this.getEaselSize().width - this.thresholdPx),\n                );\n                isMoving = true;\n            }\n            if (event.relX < this.thresholdPx) {\n                this.cornerDirection.x += this.getSpeed(this.thresholdPx - event.relX);\n                isMoving = true;\n            }\n            if (event.relY > this.getEaselSize().height - this.thresholdPx) {\n                this.cornerDirection.y -= this.getSpeed(\n                    event.relY - (this.getEaselSize().height - this.thresholdPx),\n                );\n                isMoving = true;\n            }\n            if (event.relY < this.thresholdPx) {\n                this.cornerDirection.y += this.getSpeed(this.thresholdPx - event.relY);\n                isMoving = true;\n            }\n        }\n\n        if (isMoving) {\n            if (this.lastFrameTimestamp === 0) {\n                this.lastFrameTimestamp = performance.now();\n            }\n            this.repeatEvent = event;\n            this.animationFrameHandle = requestAnimationFrame(() => this.movementLoop());\n        } else {\n            this.cornerDirection = undefined;\n        }\n    }\n}\n","import { BB } from '../../../../bb/bb';\nimport { TPointerEvent } from '../../../../bb/input/event.types';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { TViewportTransform } from '../../project-viewport/project-viewport';\nimport { createMatrixFromTransform } from '../../../../bb/transform/create-matrix-from-transform';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { createTransform } from '../../../../bb/transform/create-transform';\nimport { TEaselInterface, TEaselTool, TEaselToolTrigger } from '../easel.types';\nimport { minimizeAngleDeg } from '../../../../bb/math/math';\nimport { css } from '../../../../bb/base/base';\n\nexport type TEaselRotateParams = object;\n\nexport class EaselRotate implements TEaselTool {\n    private readonly svgEl: SVGElement;\n    private easel: TEaselInterface = {} as TEaselInterface;\n    private downPos: TVector2D | undefined = undefined;\n    private downTransform: TViewportTransform | undefined;\n\n    private readonly compassSize: number;\n    private readonly compass: SVGElement;\n    private readonly compassInner: SVGElement;\n    private readonly compassBaseCircle: SVGElement;\n    private readonly compassLineCircle: SVGElement;\n    private readonly compassUpperTriangle: SVGElement;\n    private readonly compassLowerTriangle: SVGElement;\n    private readonly needleWrapper: SVGElement;\n\n    // ----------------------------------- public -----------------------------------\n    tempTriggers: TEaselToolTrigger[] = ['r'];\n\n    constructor(p: TEaselRotateParams) {\n        this.svgEl = BB.createSvg({\n            elementType: 'g',\n        });\n\n        //rotation compass\n        this.compassSize = 30;\n        this.compass = BB.createSvg({\n            elementType: 'g',\n        });\n        css(this.compass, {\n            transition: 'opacity 0.25s ease-in-out',\n        });\n        this.compassInner = BB.createSvg({\n            elementType: 'g',\n        });\n        this.compassBaseCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'rgba(0,0,0,0.9)',\n            stroke: 'none',\n            cx: '0',\n            cy: '0',\n            r: '' + this.compassSize,\n        });\n        this.compassLineCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'none',\n            stroke: 'rgba(255,255,255,0.75)',\n            'stroke-width': '1',\n            cx: '0',\n            cy: '0',\n            r: '' + this.compassSize * 0.9,\n        });\n        css(this.compassLineCircle, {\n            transition: 'opacity 0.1s ease-in-out',\n        });\n        this.needleWrapper = BB.createSvg({\n            elementType: 'g',\n            'transform-origin': '0 0',\n        });\n        this.compassUpperTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#f00',\n            stroke: 'none',\n            d:\n                'M -' +\n                this.compassSize * 0.25 +\n                ',0 ' +\n                this.compassSize * 0.25 +\n                ',0 0,-' +\n                this.compassSize * 0.9 +\n                ' z',\n        });\n        this.compassLowerTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#fff',\n            stroke: 'none',\n            d:\n                'M -' +\n                this.compassSize * 0.25 +\n                ',0 ' +\n                this.compassSize * 0.25 +\n                ',0 0,' +\n                this.compassSize * 0.9 +\n                ' z',\n        });\n        this.needleWrapper.append(this.compassUpperTriangle, this.compassLowerTriangle);\n\n        this.compassInner.append(\n            this.compassBaseCircle,\n            this.compassLineCircle,\n            this.needleWrapper,\n        );\n        this.compass.append(this.compassInner);\n        this.svgEl.append(this.compass);\n    }\n\n    getSvgElement(): SVGElement {\n        return this.svgEl;\n    }\n\n    onPointer(e: TPointerEvent): void {\n        this.easel.setCursor(e.button === 'left' ? 'grabbing' : 'grab');\n\n        if (e.type === 'pointerdown' && e.button === 'left') {\n            this.downPos = {\n                x: e.relX,\n                y: e.relY,\n            };\n            this.downTransform = BB.copyObj(this.easel.getTargetTransform());\n        } else if (e.button === 'left' && this.downPos && this.downTransform) {\n            const { width, height } = this.easel.getSize();\n\n            const centerObj = {\n                x: width / 2,\n                y: height / 2,\n            };\n\n            const startAngleRad = BB.Vec2.angle(centerObj, this.downPos);\n            const newAngleRad = BB.Vec2.angle(centerObj, {\n                x: e.relX,\n                y: e.relY,\n            });\n            const dAngleDeg = ((newAngleRad - startAngleRad) / Math.PI) * 180;\n            let newAngleDeg = this.downTransform.angleDeg + dAngleDeg;\n            if (this.easel.isKeyPressed('shift')) {\n                newAngleDeg = Math.round(newAngleDeg / 45) * 45;\n            }\n            newAngleDeg = minimizeAngleDeg(newAngleDeg);\n\n            //rotate transform\n            const mat = createMatrixFromTransform(this.downTransform);\n            const canvasPoint = applyToPoint(inverse(mat), centerObj);\n            this.easel.setTransform(\n                createTransform(centerObj, canvasPoint, this.downTransform.scale, newAngleDeg),\n                !this.easel.isKeyPressed('shift'),\n            );\n            this.easel.requestRender();\n        } else if (e.type === 'pointerup' && this.downPos) {\n            this.downPos = undefined;\n            this.downTransform = undefined;\n        }\n    }\n\n    onUpdateTransform(transform: TViewportTransform): void {\n        const targetTransform = this.easel.getTargetTransform();\n        this.needleWrapper.setAttribute('transform', 'rotate(' + transform.angleDeg + ')');\n        this.compassLineCircle.style.opacity = targetTransform.angleDeg % 90 === 0 ? '1' : '0';\n    }\n\n    setEaselInterface(easelInterface: TEaselInterface): void {\n        this.easel = easelInterface;\n    }\n\n    activate(cursorPos?: TVector2D): void {\n        this.easel.setCursor('grab');\n        const { width, height } = this.easel.getSize();\n        this.compass.setAttribute('transform', 'translate(' + width / 2 + ', ' + height / 2 + ')');\n        this.onUpdateTransform(this.easel.getTransform());\n    }\n\n    onKeyDown(keyStr: string, event: KeyboardEvent, comboStr: string) {\n        if (['r+left', 'r+right'].includes(comboStr)) {\n            if (keyStr === 'left') {\n                this.easel.setAngleDeg(-15, true);\n            }\n            if (keyStr === 'right') {\n                this.easel.setAngleDeg(15, true);\n            }\n        }\n        if (['r+up'].includes(comboStr)) {\n            this.easel.setAngleDeg(0, false);\n        }\n    }\n\n    onResize(width: number, height: number): void {\n        this.compass.setAttribute('transform', 'translate(' + width / 2 + ', ' + height / 2 + ')');\n    }\n}\n","import { BB } from '../../../../bb/bb';\nimport { TPointerEvent } from '../../../../bb/input/event.types';\nimport zoomEwImg from 'url:/src/app/img/ui/cursor-zoom-ew.png';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { TViewportTransform } from '../../project-viewport/project-viewport';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { createMatrixFromTransform } from '../../../../bb/transform/create-matrix-from-transform';\nimport { createTransform } from '../../../../bb/transform/create-transform';\nimport { TEaselInterface, TEaselTool, TEaselToolTrigger } from '../easel.types';\n\nexport type TEaselZoomParams = Record<string, never>;\n\nexport class EaselZoom implements TEaselTool {\n    private readonly svgEl: SVGElement;\n    private easel: TEaselInterface = {} as TEaselInterface;\n    private downPos: TVector2D | undefined = undefined;\n    private downTransform: TViewportTransform | undefined;\n\n    // ----------------------------------- public -----------------------------------\n    tempTriggers: TEaselToolTrigger[] = ['z'];\n\n    constructor(p: TEaselZoomParams) {\n        this.svgEl = BB.createSvg({\n            elementType: 'g',\n        });\n    }\n\n    getSvgElement(): SVGElement {\n        return this.svgEl;\n    }\n\n    onPointer(e: TPointerEvent): void {\n        this.easel.setCursor(\"url('\" + zoomEwImg + \"') 7 7, zoom-in\");\n\n        if (e.type === 'pointerdown' && ['left'].includes(e.button!)) {\n            this.downPos = {\n                x: e.relX,\n                y: e.relY,\n            };\n            this.downTransform = BB.copyObj(this.easel.getTransform());\n        }\n        if (\n            e.type === 'pointermove' &&\n            ['left'].includes(e.button!) &&\n            this.downPos &&\n            this.downTransform\n        ) {\n            const viewportPoint = this.downPos;\n            const mat = createMatrixFromTransform(this.downTransform);\n            const canvasPoint = applyToPoint(inverse(mat), viewportPoint);\n            const dX = e.relX - this.downPos.x;\n            const newScale = BB.clamp(\n                this.downTransform.scale * Math.pow(1 + 1 / 400, dX),\n                this.easel.minScale,\n                this.easel.maxScale,\n            );\n            this.easel.setTransform(\n                createTransform(viewportPoint, canvasPoint, newScale, this.downTransform.angleDeg),\n                true,\n            );\n            this.easel.requestRender();\n        }\n        if (e.type === 'pointerup' && e.button === undefined) {\n            this.downPos = undefined;\n            this.downTransform = undefined;\n        }\n    }\n\n    setEaselInterface(easelInterface: TEaselInterface): void {\n        this.easel = easelInterface;\n    }\n\n    activate(cursorPos?: TVector2D): void {\n        this.easel.setCursor(\"url('\" + zoomEwImg + \"') 7 7, zoom-in\");\n    }\n}\n","module.exports = parcelRequire.resolve(\"cursor-zoom-ew.fa152f6d.png\") + \"?\" + Date.now();","import { SelectUi, TSelectToolMode } from '../klecks/ui/tool-tabs/select-ui';\nimport { EaselSelect } from '../klecks/ui/easel/tools/easel-select';\nimport { KlCanvas } from '../klecks/canvas/kl-canvas';\nimport { throwIfNull } from '../bb/base/base';\nimport { SelectTool } from '../klecks/select-tool/select-tool';\nimport { SelectTransformTool } from '../klecks/select-tool/select-transform-tool';\nimport { KlTempHistory, TTempHistoryEntry } from '../klecks/history/kl-temp-history';\nimport { identity, Matrix } from 'transformation-matrix';\nimport { StatusOverlay } from '../klecks/ui/components/status-overlay';\nimport { showModal } from '../klecks/ui/modals/base/showModal';\nimport { LANG } from '../language/language';\nimport { KlHistory } from '../klecks/history/kl-history';\n\nexport type TSelectTransformTempEntry = {\n    type: 'select-transform';\n    data: {\n        transform: Matrix;\n        doClone: boolean;\n        targetLayerIndex: number;\n        backgroundIsTransparent: boolean;\n    };\n};\n\nfunction isSelectTransformTempEntry(entry: TTempHistoryEntry): entry is TSelectTransformTempEntry {\n    return entry.type === 'select-transform' && !!entry.data;\n}\n\nexport type TKlAppSelectParams = {\n    klCanvas: KlCanvas;\n    getCurrentLayerCtx: () => CanvasRenderingContext2D;\n    klHistory: KlHistory;\n    tempHistory: KlTempHistory;\n    statusOverlay: StatusOverlay;\n\n    onUpdateProject: () => void; // update easelProjectUpdater\n    onFill: () => void;\n    onErase: () => void;\n};\n\n/**\n * Coordinates everything related to selection.\n */\nexport class KlAppSelect {\n    // from params\n    private readonly klCanvas: KlCanvas;\n    private readonly getCurrentLayerCtx: () => CanvasRenderingContext2D;\n    private readonly klHistory: KlHistory;\n    private readonly tempHistory: KlTempHistory;\n    private readonly statusOverlay: StatusOverlay;\n    private readonly onUpdateProject: () => void;\n    private readonly onFill: () => void;\n    private readonly onErase: () => void;\n\n    private readonly selectUi: SelectUi;\n    private readonly easelSelect: EaselSelect; // easel tool\n    private readonly selectTool: SelectTool;\n    private readonly transformTool: SelectTransformTool;\n\n    // state\n    private selectMode: TSelectToolMode = 'select';\n\n    // transform state\n    private targetLayerIndex: number = 0;\n    private initialTransform: TSelectTransformTempEntry['data'] = {\n        // When you begin transforming (for undo, and comparing change).\n        transform: identity(),\n        doClone: false,\n        targetLayerIndex: 0,\n        // Needs to be kept up to date.\n        backgroundIsTransparent: false,\n    };\n    private backgroundIsTransparent: boolean = false;\n\n    private isSourceLayerBackgroundTransparent(): boolean {\n        const srcLayerCtx = this.getCurrentLayerCtx();\n        const srcLayerIndex = throwIfNull(this.klCanvas.getLayerIndex(srcLayerCtx.canvas));\n        if (srcLayerIndex > 0) {\n            // not background layer\n            return true;\n        }\n        return this.backgroundIsTransparent;\n    }\n\n    /** reset KlCanvas layer composites **/\n    private resetComposites(): void {\n        const srcLayerCtx = this.getCurrentLayerCtx();\n        const srcLayerIndex = throwIfNull(this.klCanvas.getLayerIndex(srcLayerCtx.canvas));\n        this.klCanvas.setComposite(srcLayerIndex, undefined);\n        if (this.targetLayerIndex !== srcLayerIndex) {\n            this.klCanvas.setComposite(this.targetLayerIndex, undefined);\n        }\n    }\n\n    private updateComposites(): void {\n        const srcLayerCanvas = this.getCurrentLayerCtx().canvas;\n        const srcLayerIndex = throwIfNull(this.klCanvas.getLayerIndex(srcLayerCanvas));\n\n        if (srcLayerIndex === this.targetLayerIndex) {\n            this.klCanvas.setComposite(\n                srcLayerIndex,\n                this.transformTool.createComposite(srcLayerCanvas),\n            );\n        } else {\n            this.klCanvas.setComposite(\n                srcLayerIndex,\n                this.transformTool.createSourceComposite(srcLayerCanvas),\n            );\n            this.klCanvas.setComposite(\n                this.targetLayerIndex,\n                this.transformTool.createTargetComposite(srcLayerCanvas),\n            );\n        }\n    }\n\n    private updateUiLayerList(): void {\n        this.selectUi.setLayers(\n            this.klCanvas.getLayers().map((layer) => {\n                return layer.name;\n            }),\n        );\n    }\n\n    private resetSelection(): void {\n        this.selectTool.reset();\n        const selection = this.selectTool.getSelection();\n        this.klCanvas.setSelection(selection);\n        this.selectUi.setHasSelection(!!selection);\n    }\n\n    private tempHistoryReplaceTop(): void {\n        this.tempHistory.replaceTop({\n            type: 'select-transform',\n            data: {\n                transform: this.transformTool.getTransform(),\n                doClone: this.transformTool.getDoClone(),\n                targetLayerIndex: this.targetLayerIndex,\n                backgroundIsTransparent: this.backgroundIsTransparent,\n            },\n        } satisfies TSelectTransformTempEntry);\n    }\n\n    // propagate from transformTool to everything else\n    private propagateTransformationChange(): void {\n        const selection = this.transformTool.getTransformedSelection();\n        this.easelSelect.setRenderedSelection(selection);\n        this.updateComposites();\n        this.onUpdateProject();\n\n        this.tempHistoryReplaceTop();\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TKlAppSelectParams) {\n        this.klCanvas = p.klCanvas;\n        this.onUpdateProject = p.onUpdateProject;\n        this.getCurrentLayerCtx = p.getCurrentLayerCtx;\n        this.klHistory = p.klHistory;\n        this.tempHistory = p.tempHistory;\n        this.statusOverlay = p.statusOverlay;\n        this.onFill = p.onFill;\n        this.onErase = p.onErase;\n\n        // keep layer list up-to-date\n        this.klHistory.addListener(() => {\n            this.selectUi.setHasSelection(!!this.klCanvas.getSelection());\n            if (this.selectMode === 'transform') {\n                this.updateUiLayerList();\n            }\n        });\n\n        this.selectTool = new SelectTool({\n            klCanvas: this.klCanvas,\n        });\n        this.transformTool = new SelectTransformTool();\n\n        this.easelSelect = new EaselSelect({\n            selectMode: this.selectMode,\n            onStartSelect: (p, operation) => this.selectTool.startSelect(p, operation),\n            onGoSelect: (p) => {\n                this.selectTool.goSelect(p);\n                this.easelSelect.setRenderedSelection(this.selectTool.getSelection());\n            },\n            onEndSelect: () => {\n                this.selectTool.endSelect();\n                const selection = this.selectTool.getSelection();\n                this.easelSelect.clearRenderedSelection();\n                this.klCanvas.setSelection(selection);\n                this.selectUi.setHasSelection(!!selection);\n            },\n            onStartMoveSelect: (p) => {\n                this.selectTool.startMoveSelect(p);\n            },\n            onGoMoveSelect: (p) => {\n                this.selectTool.goMoveSelect(p);\n                this.easelSelect.setRenderedSelection(this.selectTool.getSelection());\n            },\n            onEndMoveSelect: () => {\n                this.selectTool.endMoveSelect();\n                if (!this.selectTool.getDidMove()) {\n                    return;\n                }\n                const selection = this.selectTool.getSelection();\n                this.easelSelect.clearRenderedSelection();\n                this.klCanvas.setSelection(selection);\n                this.selectUi.setHasSelection(!!selection);\n            },\n            onSelectAddPoly: (p, operation) => {\n                this.selectTool.addPoly(p, operation);\n                const selection = this.selectTool.getSelection();\n                this.klCanvas.setSelection(selection);\n                this.selectUi.setHasSelection(!!selection);\n            },\n            onTranslateTransform: (d) => {\n                this.transformTool.translate(d);\n                this.propagateTransformationChange();\n            },\n            onResetSelection: () => this.resetSelection(),\n        });\n\n        this.selectUi = new SelectUi({\n            onChangeMode: (mode) => {\n                this.selectMode = mode;\n                if (this.selectMode === 'select') {\n                    this.tempHistory.clear();\n                    this.tempHistory.setIsActive(false);\n                    const layerIndex = throwIfNull(\n                        this.klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas),\n                    );\n                    if (\n                        this.transformTool.isTransformationChanged() ||\n                        this.transformTool.getDoClone() ||\n                        layerIndex !== this.targetLayerIndex\n                    ) {\n                        // something changed -> apply\n                        if (this.transformTool.getDoClone()) {\n                            this.klCanvas.transformCloneViaSelection({\n                                sourceLayer: layerIndex,\n                                targetLayer: this.targetLayerIndex,\n                                transformation: this.transformTool.getTransform(),\n                            });\n                        } else {\n                            this.klCanvas.transformViaSelection({\n                                sourceLayer: layerIndex,\n                                targetLayer: this.targetLayerIndex,\n                                transformation: this.transformTool.getTransform(),\n                                backgroundIsTransparent: this.backgroundIsTransparent,\n                            });\n                        }\n                        p.statusOverlay.out(LANG('select-transform-applied'), true);\n                    }\n                    this.klCanvas.clearSelectionSample();\n                    this.klCanvas.setComposite(layerIndex, undefined);\n                    this.klCanvas.setComposite(this.targetLayerIndex, undefined);\n                    this.easelSelect.clearRenderedSelection(true);\n                    const selection = this.klCanvas.getSelection();\n                    this.selectTool.setSelection(selection);\n                    this.selectUi.setHasSelection(!!selection);\n                    this.onUpdateProject();\n                } else {\n                    // -> transform\n                    this.tempHistory.setIsActive(true);\n                    let selection = this.selectTool.getSelection() || [];\n                    if (selection.length === 0) {\n                        const width = this.klCanvas.getWidth();\n                        const height = this.klCanvas.getHeight();\n                        selection = [\n                            [\n                                [\n                                    [0, 0],\n                                    [width, 0],\n                                    [width, height],\n                                    [0, height],\n                                    [0, 0],\n                                ],\n                            ],\n                        ];\n                    }\n\n                    this.transformTool.setSelection(selection);\n                    this.transformTool.setDoClone(false);\n                    this.transformTool.setSelectionSample(this.klCanvas.getSelectionSample());\n                    const currentLayerCanvas = this.getCurrentLayerCtx().canvas;\n                    const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCanvas));\n                    this.initialTransform.targetLayerIndex = layerIndex;\n                    this.initialTransform.backgroundIsTransparent = this.backgroundIsTransparent;\n                    this.targetLayerIndex = layerIndex;\n                    this.transformTool.setBackgroundIsTransparent(\n                        this.isSourceLayerBackgroundTransparent(),\n                    );\n                    this.updateComposites();\n                    const transformedSelection = this.transformTool.getTransformedSelection();\n                    this.easelSelect.setRenderedSelection(transformedSelection);\n                    this.selectUi.setHasSelection(!!selection);\n                    this.updateUiLayerList();\n                    this.selectUi.setMoveToLayer(undefined);\n                    this.onUpdateProject();\n                }\n                this.easelSelect.setMode(this.selectMode);\n            },\n            onChangeBooleanOperation: (operation) => {\n                this.easelSelect.setBooleanOperation(operation);\n            },\n            canTransform: () => {\n                const layerIndex = throwIfNull(\n                    this.klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas),\n                );\n                const result = !!this.klCanvas.getSelectionArea(layerIndex);\n                if (!result) {\n                    setTimeout(() => {\n                        showModal({\n                            target: document.body,\n                            message: LANG('select-transform-empty'),\n                            type: 'error',\n                        });\n                    });\n                }\n                return result;\n            },\n            select: {\n                shape: this.selectTool.getShape(),\n                onChangeShape: (shape) => {\n                    this.selectTool.setShape(shape);\n                    this.easelSelect.setSelectShape(shape);\n                },\n                onReset: () => this.resetSelection(),\n                onAll: () => {\n                    this.selectTool.selectAll();\n                    const selection = this.selectTool.getSelection();\n                    this.klCanvas.setSelection(selection);\n                    this.selectUi.setHasSelection(!!selection);\n                },\n                onInvert: () => {\n                    this.selectTool.invertSelection();\n                    const selection = this.selectTool.getSelection();\n                    this.klCanvas.setSelection(selection);\n                    this.selectUi.setHasSelection(!!selection);\n                },\n            },\n            transform: {\n                onFlipY: () => {\n                    this.transformTool.flip('y');\n                    this.propagateTransformationChange();\n                },\n                onFlipX: () => {\n                    this.transformTool.flip('x');\n                    this.propagateTransformationChange();\n                },\n                onRotateDeg: (deg) => {\n                    this.transformTool.rotateDeg(deg);\n                    this.propagateTransformationChange();\n                },\n                onClone: () => {\n                    // commit\n                    this.tempHistory.clear();\n                    const layerIndex = throwIfNull(\n                        this.klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas),\n                    );\n                    // apply\n                    // should always apply. user might want to make something more opaque.\n                    if (this.transformTool.getDoClone()) {\n                        this.klCanvas.transformCloneViaSelection({\n                            sourceLayer: layerIndex,\n                            targetLayer: this.targetLayerIndex,\n                            transformation: this.transformTool.getTransform(),\n                        });\n                    } else if (this.transformTool.isTransformationChanged()) {\n                        this.klCanvas.transformViaSelection({\n                            sourceLayer: layerIndex,\n                            targetLayer: this.targetLayerIndex,\n                            transformation: this.transformTool.getTransform(),\n                            backgroundIsTransparent: this.backgroundIsTransparent,\n                        });\n                    }\n                    const oldSelection = this.transformTool.getTransformedSelection();\n\n                    // start another transform\n                    const selection = this.klCanvas.getSelection() || oldSelection;\n                    this.initialTransform.backgroundIsTransparent = this.backgroundIsTransparent;\n                    this.transformTool.setSelection(selection);\n                    this.transformTool.setDoClone(true);\n                    this.transformTool.setSelectionSample(this.klCanvas.getSelectionSample());\n                    this.updateComposites();\n                    this.easelSelect.setRenderedSelection(\n                        this.transformTool.getTransformedSelection(),\n                    );\n                    this.selectUi.setHasSelection(!!selection);\n                    this.onUpdateProject();\n\n                    this.statusOverlay.out(LANG('select-transform-clone-applied'), true);\n                },\n                onMoveToLayer: (index) => {\n                    this.resetComposites();\n\n                    this.targetLayerIndex = index;\n                    this.updateComposites();\n                    this.onUpdateProject();\n\n                    this.tempHistoryReplaceTop();\n                },\n                onChangeTransparentBackground: (isTransparent) => {\n                    this.backgroundIsTransparent = isTransparent;\n                    this.transformTool.setBackgroundIsTransparent(\n                        this.isSourceLayerBackgroundTransparent(),\n                    );\n                    this.updateComposites();\n                    this.onUpdateProject();\n\n                    this.tempHistoryReplaceTop();\n                },\n            },\n            onErase: () => {\n                this.onErase();\n            },\n            onFill: () => {\n                this.onFill();\n            },\n        });\n\n        this.klHistory.addListener(() => {\n            const selection = this.klCanvas.getSelection();\n            if (this.selectMode === 'select') {\n                this.selectTool.setSelection(selection);\n            }\n        });\n    }\n\n    getSelectUi(): SelectUi {\n        return this.selectUi;\n    }\n\n    getEaselSelect(): EaselSelect {\n        return this.easelSelect;\n    }\n\n    /**\n     * If transform changed something, changes are applied. -> return true\n     * If no changes applied -> return false\n     */\n    commitTransform(): boolean {\n        let result = false;\n        if (this.selectMode === 'transform') {\n            this.selectUi.setMode('select'); // this triggers selectUi.onMode\n            result = true;\n        }\n        return result;\n    }\n\n    /** if transforming, changes are discarded */\n    discardTransform(): boolean {\n        if (this.selectMode === 'transform') {\n            this.transformTool.reset();\n            this.transformTool.setDoClone(false);\n            const currentCanvas = this.getCurrentLayerCtx().canvas;\n            this.targetLayerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentCanvas));\n            this.selectUi.setMode('select'); // this triggers selectUi.onMode\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * feed type from KlHistoryExecutor.onExecuted.\n     *\n     * If regular undo step -> jump back to select tab\n     * If temp undo/redo step -> update transformation state\n     */\n    onHistory(type: 'undo' | 'redo' | 'tempUndo' | 'tempRedo'): void {\n        if (type === 'undo') {\n            // commit\n            this.selectUi.setMode('select'); // this triggers selectUi.onMode\n        } else if (type === 'tempUndo' || type === 'tempRedo') {\n            this.resetComposites();\n\n            // recreate\n            const entries = this.tempHistory.getEntries();\n            const top = entries.at(-1);\n\n            let state = {\n                ...this.initialTransform,\n                doClone: this.transformTool.getDoClone(),\n            };\n            if (top && isSelectTransformTempEntry(top)) {\n                state = top.data;\n            }\n            this.transformTool.setTransform(state.transform);\n            this.transformTool.setDoClone(state.doClone);\n            this.targetLayerIndex = state.targetLayerIndex;\n            this.backgroundIsTransparent = state.backgroundIsTransparent;\n            this.selectUi.setBackgroundIsTransparent(state.backgroundIsTransparent);\n            this.transformTool.setBackgroundIsTransparent(\n                this.isSourceLayerBackgroundTransparent(),\n            );\n\n            const selection = this.transformTool.getTransformedSelection();\n            this.easelSelect.setRenderedSelection(selection);\n            this.selectUi.setMoveToLayer(\n                this.klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas) ===\n                    state.targetLayerIndex\n                    ? undefined\n                    : state.targetLayerIndex,\n            );\n            this.updateComposites();\n            this.onUpdateProject();\n        }\n    }\n\n    destroy(): void {\n        // ...\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { Options } from '../components/options';\nimport modeSelectImg from 'url:/src/app/img/ui/select-mode-select.svg';\nimport modeMoveImg from 'url:/src/app/img/ui/select-mode-move.svg';\nimport { c } from '../../../bb/base/c';\nimport { TBooleanOperation, TSelectShape } from '../../select-tool/select-tool';\nimport defaultImSvg from 'url:/src/app/img/ui/select-default.svg';\nimport unionImSvg from 'url:/src/app/img/ui/select-union.svg';\nimport subtractImSvg from 'url:/src/app/img/ui/select-subtract.svg';\nimport rectSvg from 'url:/src/app/img/ui/select-shape-rect.svg';\nimport ellipseSvg from 'url:/src/app/img/ui/select-shape-ellipse.svg';\nimport lassoSvg from 'url:/src/app/img/ui/select-shape-lasso.svg';\nimport polySvg from 'url:/src/app/img/ui/select-shape-poly.svg';\nimport removeLayerImg from 'url:/src/app/img/ui/remove-layer.svg';\nimport { Select } from '../components/select';\nimport { LANG } from '../../../language/language';\nimport { Checkbox } from '../components/checkbox';\nimport { createImage } from '../../../bb/base/ui';\nimport { css } from '../../../bb/base/base';\n\nexport type TSelectUiParams = {\n    onChangeMode: (mode: TSelectToolMode) => void;\n    onChangeBooleanOperation: (operation: TBooleanOperation) => void;\n    canTransform: () => boolean; // return: can the current selected area be transformed\n    select: {\n        shape: TSelectShape; // initial value\n        onChangeShape: (shape: TSelectShape) => void;\n        onReset: () => void;\n        onAll: () => void;\n        onInvert: () => void;\n    };\n    transform: {\n        onFlipX: () => void;\n        onFlipY: () => void;\n        onRotateDeg: (deg: number) => void;\n        onClone: () => void;\n        onMoveToLayer: (index: number) => void;\n        onChangeTransparentBackground: (b: boolean) => void;\n    };\n    onErase: () => void;\n    onFill: () => void;\n};\n\nexport type TSelectToolMode = 'select' | 'transform';\n\n/**\n * Select tool - tool tab\n */\nexport class SelectUi {\n    private readonly onChangeMode: TSelectUiParams['onChangeMode'];\n    private readonly rootEl: HTMLElement;\n    private isVisible: boolean = true;\n    private readonly modeOptions: Options<TSelectToolMode>;\n    private hasSelection: boolean = false;\n    private selectResetBtn: HTMLButtonElement;\n    private transformDuplicateBtn: HTMLButtonElement;\n    private moveToLayerSelect: Select<string>;\n    private transparentBackgroundToggle: Checkbox;\n    private operationOptions: Options<TBooleanOperation>;\n\n    private update(): void {\n        this.selectResetBtn.style.display = this.hasSelection ? 'block' : 'none';\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor(p: TSelectUiParams) {\n        this.onChangeMode = p.onChangeMode;\n        this.modeOptions = new Options<TSelectToolMode>({\n            optionArr: [\n                {\n                    id: 'select',\n                    label: c('', [\n                        c({\n                            content:\n                                \"<img class='dark-invert' src='\" +\n                                modeSelectImg +\n                                \"' height='20'/>\" +\n                                '<span>' +\n                                LANG('select-select') +\n                                '</span>',\n                            css: {\n                                display: 'flex',\n                                gap: '5px',\n                                alignItems: 'center',\n                                height: '100%',\n                                margin: '10px 4px',\n                                justifyContent: 'center',\n                            },\n                        }),\n                    ]),\n                },\n                {\n                    id: 'transform',\n                    label: c('', [\n                        c({\n                            content:\n                                \"<img class='dark-invert' src='\" +\n                                modeMoveImg +\n                                \"' height='20'/>\" +\n                                '<span>' +\n                                LANG('select-transform') +\n                                '</span>',\n                            css: {\n                                display: 'flex',\n                                gap: '5px',\n                                alignItems: 'center',\n                                height: '100%',\n                                margin: '10px 4px',\n                                justifyContent: 'center',\n                            },\n                        }),\n                    ]),\n                },\n            ],\n            initId: 'select',\n            onChange: (val) => {\n                if (val === 'select') {\n                    this.operationOptions.setValue('new');\n                }\n                this.onChangeMode(val);\n                updateMode();\n            },\n            onBeforeChange: (val: TSelectToolMode) => {\n                if (val === 'transform') {\n                    return p.canTransform();\n                }\n                return true;\n            },\n            optionCss: {\n                flexGrow: '1',\n                flexBasis: '0',\n            },\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        // --- select ---\n        const selectModeEl = BB.el();\n\n        const defaultIm = new Image();\n        defaultIm.src = defaultImSvg;\n        defaultIm.classList.add('dark-invert');\n        const unionIm = new Image();\n        unionIm.src = unionImSvg;\n        unionIm.classList.add('dark-invert');\n        const subtractIm = new Image();\n        subtractIm.src = subtractImSvg;\n        subtractIm.classList.add('dark-invert');\n\n        this.operationOptions = new Options<TBooleanOperation>({\n            optionArr: [\n                {\n                    id: 'new',\n                    label: defaultIm,\n                    title: LANG('select-boolean-replace'),\n                },\n                {\n                    id: 'union',\n                    label: unionIm,\n                    title: LANG('select-boolean-add'),\n                },\n                {\n                    id: 'difference',\n                    label: subtractIm,\n                    title: LANG('select-boolean-subtract'),\n                },\n            ],\n            initId: 'new',\n            onChange: (v) => {\n                p.onChangeBooleanOperation(v);\n            },\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        const imStyle = {\n            width: '32px',\n            height: '32px',\n        };\n        const rectIm = new Image();\n        rectIm.src = rectSvg;\n        rectIm.classList.add('dark-invert');\n        css(rectIm, imStyle);\n        const ellipseIm = new Image();\n        ellipseIm.src = ellipseSvg;\n        ellipseIm.classList.add('dark-invert');\n        css(ellipseIm, imStyle);\n        const lassoIm = new Image();\n        lassoIm.src = lassoSvg;\n        lassoIm.classList.add('dark-invert');\n        css(lassoIm, imStyle);\n        const polyIm = new Image();\n        polyIm.src = polySvg;\n        polyIm.classList.add('dark-invert');\n        css(polyIm, imStyle);\n\n        const shapeOptions = new Options<TSelectShape>({\n            optionArr: [\n                {\n                    id: 'rect',\n                    label: rectIm,\n                    title: LANG('shape-rect'),\n                },\n                {\n                    id: 'ellipse',\n                    label: ellipseIm,\n                    title: LANG('shape-ellipse'),\n                },\n                {\n                    id: 'lasso',\n                    label: lassoIm,\n                    title: LANG('select-lasso'),\n                },\n                {\n                    id: 'poly',\n                    label: polyIm,\n                    title: LANG('select-polygon'),\n                },\n            ],\n            initId: p.select.shape,\n            onChange: (val) => {\n                p.select.onChangeShape(val);\n            },\n            css: {\n                marginBottom: '10px',\n            },\n        });\n        selectModeEl.append(shapeOptions.getElement(), this.operationOptions.getElement());\n\n        const actionRow = BB.el({\n            parent: selectModeEl,\n            css: {\n                display: 'flex',\n                gap: '5px',\n                flexWrap: 'wrap',\n            },\n        });\n\n        const selectAllBtn = BB.el({\n            parent: actionRow,\n            tagName: 'button',\n            content: LANG('select-all'),\n            onClick: () => {\n                p.select.onAll();\n            },\n            custom: {\n                tabindex: '-1',\n            },\n            css: {\n                minHeight: '30px',\n            },\n        });\n        const selectInvertBtn = BB.el({\n            parent: actionRow,\n            tagName: 'button',\n            content: LANG('select-invert'),\n            onClick: () => {\n                p.select.onInvert();\n            },\n            custom: {\n                tabindex: '-1',\n            },\n            css: {\n                minHeight: '30px',\n            },\n        });\n        this.selectResetBtn = BB.el({\n            parent: actionRow,\n            tagName: 'button',\n            content: [\n                createImage({\n                    src: removeLayerImg,\n                    alt: 'icon',\n                    height: 20,\n                    css: {\n                        marginRight: '3px',\n                        filter: 'invert(1)',\n                    },\n                }),\n                LANG('select-reset'),\n            ],\n            className: 'kl-button kl-button-primary',\n            css: {\n                paddingRight: '8px',\n                display: 'none',\n            },\n            onClick: () => {\n                p.select.onReset();\n            },\n            custom: {\n                tabindex: '-1',\n            },\n        });\n\n        BB.el({\n            className: 'grid-hr',\n            parent: selectModeEl,\n            css: { margin: '10px 0' },\n        });\n\n        const actionsWrapper = BB.el({\n            parent: selectModeEl,\n            css: {\n                display: 'flex',\n                gap: '5px',\n            },\n        });\n        const eraseBtn = BB.el({\n            parent: actionsWrapper,\n            tagName: 'button',\n            content: LANG('select-erase'),\n            onClick: () => {\n                p.onErase();\n            },\n            custom: {\n                tabindex: '-1',\n            },\n        });\n\n        const fillBtn = BB.el({\n            parent: actionsWrapper,\n            tagName: 'button',\n            content: LANG('select-fill'),\n            onClick: () => {\n                p.onFill();\n            },\n            custom: {\n                tabindex: '-1',\n            },\n        });\n\n        // --- transform ---\n        const transformModeEl = BB.el();\n        const transformFlipXBtn = BB.el({\n            tagName: 'button',\n            content: LANG('filter-transform-flip') + ' X',\n            className: 'kl-button',\n            onClick: () => {\n                p.transform.onFlipX();\n            },\n            custom: {\n                tabindex: '-1',\n            },\n        });\n        const transformFlipYBtn = BB.el({\n            tagName: 'button',\n            content: LANG('filter-transform-flip') + ' Y',\n            onClick: () => {\n                p.transform.onFlipY();\n            },\n            custom: {\n                tabindex: '-1',\n            },\n        });\n        const rotateNegativeBtn = BB.el({\n            tagName: 'button',\n            content: '-90',\n            onClick: () => {\n                p.transform.onRotateDeg(-90);\n            },\n            custom: {\n                tabindex: '-1',\n            },\n        });\n        const rotatePositiveBtn = BB.el({\n            tagName: 'button',\n            content: '+90',\n            onClick: () => {\n                p.transform.onRotateDeg(90);\n            },\n            custom: {\n                tabindex: '-1',\n            },\n        });\n\n        this.transformDuplicateBtn = BB.el({\n            tagName: 'button',\n            content: LANG('select-transform-clone'),\n            onClick: () => {\n                p.transform.onClone();\n            },\n            custom: {\n                tabindex: '-1',\n            },\n        });\n\n        const actionsRow = BB.el({\n            parent: transformModeEl,\n            content: [\n                transformFlipXBtn,\n                transformFlipYBtn,\n                rotateNegativeBtn,\n                rotatePositiveBtn,\n                this.transformDuplicateBtn,\n            ],\n            css: {\n                display: 'flex',\n                flexWrap: 'wrap',\n                gap: '5px',\n            },\n        });\n\n        this.moveToLayerSelect = new Select({\n            optionArr: [\n                ['1', 'Layer 2'],\n                ['0', 'Layer 1'],\n            ],\n            onChange: (val) => {\n                p.transform.onMoveToLayer(+val);\n            },\n            name: 'move-to-layer',\n            css: {\n                width: '100%',\n            },\n        });\n\n        transformModeEl.append(\n            c(',flex,items-center,gap-5,mt-10,flexWrap', [\n                LANG('select-transform-move-to-layer'),\n                this.moveToLayerSelect.getElement(),\n            ]),\n        );\n\n        this.transparentBackgroundToggle = new Checkbox({\n            label: LANG('brush-eraser-transparent-bg'),\n            callback: (b) => {\n                p.transform.onChangeTransparentBackground(b);\n            },\n            name: 'enable-transparent-background',\n        });\n        css(this.transparentBackgroundToggle.getElement(), {\n            marginTop: '10px',\n            display: 'inline-block',\n        });\n\n        transformModeEl.append(this.transparentBackgroundToggle.getElement());\n\n        const updateMode = () => {\n            if (this.modeOptions.getValue() === 'select') {\n                this.rootEl.append(selectModeEl);\n                transformModeEl.remove();\n            } else {\n                selectModeEl.remove();\n                this.rootEl.append(transformModeEl);\n            }\n        };\n\n        this.rootEl = BB.el({\n            content: [this.modeOptions.getElement()],\n            css: {\n                margin: '10px',\n            },\n        });\n        updateMode();\n    }\n\n    setIsVisible(isVisible: boolean): void {\n        this.isVisible = isVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.operationOptions.setValue('new');\n        }\n    }\n\n    setMode(mode: TSelectToolMode): void {\n        this.modeOptions.setValue(mode);\n    }\n\n    setLayers(layers: string[]): void {\n        this.moveToLayerSelect.setOptionArr(\n            layers\n                .map((layer, index) => {\n                    return ['' + index, layer] as [string, string];\n                })\n                .reverse(),\n        );\n    }\n\n    setMoveToLayer(targetIndex: number | undefined): void {\n        this.moveToLayerSelect.setValue(targetIndex === undefined ? undefined : '' + targetIndex);\n    }\n\n    setHasSelection(b: boolean): void {\n        this.hasSelection = b;\n        this.update();\n    }\n\n    setBackgroundIsTransparent(b: boolean): void {\n        this.transparentBackgroundToggle.setValue(b);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy(): void {\n        // ...\n    }\n}\n","module.exports = parcelRequire.resolve(\"select-mode-select.b07e2160.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"select-mode-move.240e706d.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"select-default.5511e197.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"select-union.9af88fc2.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"select-subtract.1b053c9e.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"select-shape-rect.69fe8734.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"select-shape-ellipse.f0d30be1.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"select-shape-lasso.a10ce7c2.svg\") + \"?\" + Date.now();","module.exports = parcelRequire.resolve(\"select-shape-poly.cc6d5150.svg\") + \"?\" + Date.now();","import { BB } from '../../../../bb/bb';\nimport { TPointerEvent, TPointerType } from '../../../../bb/input/event.types';\nimport { TVector2D } from '../../../../bb/bb-types';\nimport { TSelectToolMode } from '../../tool-tabs/select-ui';\nimport { createMatrixFromTransform } from '../../../../bb/transform/create-matrix-from-transform';\nimport { applyToPoint, inverse } from 'transformation-matrix';\nimport { TArrowKey, TEaselInterface, TEaselTool, TEaselToolTrigger } from '../easel.types';\nimport { TViewportTransform, TViewportTransformXY } from '../../project-viewport/project-viewport';\nimport { rotate, snapAngleDeg } from '../../../../bb/math/math';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { TBooleanOperation, TSelectShape } from '../../../select-tool/select-tool';\nimport { getSelectionPath2d } from '../../../../bb/multi-polygon/get-selection-path-2d';\nimport { EventChain } from '../../../../bb/input/event-chain/event-chain';\nimport { DoubleTapper } from '../../../../bb/input/event-chain/double-tapper';\nimport { TChainElement } from '../../../../bb/input/event-chain/event-chain.types';\nimport { CornerPanning } from '../corner-panning';\n\nconst modeToCursor: Record<TSelectToolMode, string> = {\n    select: 'default',\n    transform: 'move',\n};\n\nconst operationToCursor: Record<TBooleanOperation, string> = {\n    new: 'default',\n    union: 'copy',\n    difference: 'alias',\n};\n\nexport type TEaselSelectParams = {\n    selectMode: TSelectToolMode;\n    onStartSelect: (p: TVector2D, operation: TBooleanOperation) => void;\n    onGoSelect: (p: TVector2D) => void;\n    onEndSelect: () => void;\n    onStartMoveSelect: (p: TVector2D) => void;\n    onGoMoveSelect: (p: TVector2D) => void;\n    onEndMoveSelect: () => void;\n    onSelectAddPoly: (path: TVector2D[], operation: TBooleanOperation) => void;\n    onTranslateTransform: (d: TVector2D) => void;\n    onResetSelection: () => void;\n};\n\n/**\n * for select tool and transform tool\n */\nexport class EaselSelect implements TEaselTool {\n    // from params\n    private readonly onStartSelect: (p: TVector2D, operation: TBooleanOperation) => void;\n    private readonly onGoSelect: (p: TVector2D) => void;\n    private readonly onEndSelect: () => void;\n    private readonly onStartMoveSelect: (p: TVector2D) => void;\n    private readonly onGoMoveSelect: (p: TVector2D) => void;\n    private readonly onEndMoveSelect: () => void;\n    private readonly onSelectAddPoly: (path: TVector2D[], operation: TBooleanOperation) => void;\n    private readonly onTranslateTransform: TEaselSelectParams['onTranslateTransform'];\n    private readonly onResetSelection: () => void;\n\n    private readonly svgEl: SVGElement;\n    private easel: TEaselInterface = {} as TEaselInterface;\n    private viewportTransform: TViewportTransform = {} as TViewportTransform;\n    private tempCtx: CanvasRenderingContext2D = BB.ctx(BB.canvas(1, 1)); // used for isPointInPath()\n    private pointerChain: EventChain;\n    private cornerPanning: CornerPanning;\n\n    // state\n    private canvasSelection: MultiPolygon = [];\n    private selectionPath: Path2D = getSelectionPath2d([]);\n    private mode: TSelectToolMode = 'select';\n    private isDragging: boolean = false;\n\n    // select-mode state\n    private selectSelectMode: 'select' | 'move' = 'select';\n    private didSelectionMove: boolean = false;\n    private defaultBooleanOperation: TBooleanOperation = 'new'; // set by the UI\n    private appliedBooleanOperation: TBooleanOperation | undefined; // once dragging, the locked in boolean operation\n    private selectShape: TSelectShape = 'rect';\n    private polyShape: (TVector2D & { temp?: true })[] = [];\n\n    // transform-mode state\n    private transformPointerStart: TVector2D = { x: 0, y: 0 }; // initial position, canvas coordinate\n    private transformPreviousPointer: TVector2D = { x: 0, y: 0 };\n\n    private viewportToCanvas(p: TVector2D): TVector2D {\n        const matrix = inverse(createMatrixFromTransform(this.easel.getTransform()));\n        return applyToPoint(matrix, p);\n    }\n\n    private updateSelectionPath(): void {\n        this.selectionPath = getSelectionPath2d(this.canvasSelection);\n    }\n\n    private resetPolyShape(): boolean {\n        if (this.polyShape.length === 0) {\n            return false;\n        }\n        this.polyShape = [];\n        this.doubleTapPointerTypes = ['touch'];\n        this.easel.updateDoubleTapPointerTypes();\n        this.easel.requestRender(); // because polyShape might have changed\n        return true;\n    }\n\n    /** boolean operation if you also consider keys */\n    private getEffectiveBooleanOperation(): TBooleanOperation {\n        const isSubtract =\n            this.defaultBooleanOperation === 'new'\n                ? this.easel.keyListener.isPressed('alt')\n                : this.defaultBooleanOperation === 'difference';\n        const isAdd =\n            this.defaultBooleanOperation === 'new'\n                ? this.easel.keyListener.isPressed('shift')\n                : this.defaultBooleanOperation === 'union';\n\n        if (isSubtract) {\n            return 'difference';\n        }\n        if (isAdd) {\n            return 'union';\n        }\n        return 'new';\n    }\n\n    private getDoMoveSelection(\n        effectiveOperation: TBooleanOperation,\n        cursorCanvasPos: TVector2D,\n    ): boolean {\n        const isOverSelection =\n            this.polyShape.length < 2 &&\n            this.selectionPath &&\n            this.tempCtx.isPointInPath(this.selectionPath, cursorCanvasPos.x, cursorCanvasPos.y);\n        return effectiveOperation === 'new' && isOverSelection;\n    }\n\n    // can be repeatedly called with the same event\n    private selectOnPointer(event: TPointerEvent): void {\n        const effectiveOperation = this.getEffectiveBooleanOperation();\n        const wasDragging = this.isDragging;\n        const cursorCanvasPos = this.viewportToCanvas({ x: event.relX, y: event.relY });\n        const doMove = this.getDoMoveSelection(effectiveOperation, cursorCanvasPos);\n\n        if (event.type === 'pointerdown') {\n            this.isDragging = true;\n            if (doMove) {\n                this.selectSelectMode = 'move';\n            } else {\n                this.selectSelectMode = 'select';\n            }\n        }\n        if (event.type === 'pointerup') {\n            this.isDragging = false;\n        }\n\n        if (this.selectSelectMode === 'move') {\n            if (event.type === 'pointerdown' && event.button === 'left') {\n                this.didSelectionMove = false;\n                this.onStartMoveSelect(cursorCanvasPos);\n            }\n            if (event.type === 'pointermove' && event.button === 'left') {\n                this.didSelectionMove = true;\n                this.onGoMoveSelect(cursorCanvasPos);\n            }\n            if (event.type === 'pointerup') {\n                this.onEndMoveSelect();\n                if (!this.didSelectionMove) {\n                    this.onResetSelection();\n                }\n            }\n        } else {\n            // select\n\n            if (this.selectShape === 'poly') {\n                if (event.type === 'pointermove') {\n                    if (this.polyShape[this.polyShape.length - 1]?.temp) {\n                        this.polyShape.pop();\n                    }\n                    this.polyShape.push({\n                        ...cursorCanvasPos,\n                        temp: true,\n                    });\n                    this.easel.requestRender();\n                }\n                if (event.type === 'pointerup' && wasDragging) {\n                    if (this.polyShape.length < 2) {\n                        this.appliedBooleanOperation = effectiveOperation;\n                    }\n\n                    this.doubleTapPointerTypes = [];\n                    this.easel.updateDoubleTapPointerTypes();\n\n                    if (this.polyShape[this.polyShape.length - 1]?.temp) {\n                        this.polyShape.pop();\n                    }\n\n                    this.polyShape.push(cursorCanvasPos);\n\n                    const first = this.polyShape[0];\n                    const last = this.polyShape[this.polyShape.length - 1];\n                    if (\n                        this.polyShape.length > 2 &&\n                        BB.dist(first.x, first.y, last.x, last.y) * this.viewportTransform.scale < 4\n                    ) {\n                        this.polyShape.pop();\n                        this.polyShape.push({ ...this.polyShape[0] });\n                        const shape = this.polyShape;\n                        this.polyShape = [];\n                        this.onSelectAddPoly(shape, this.appliedBooleanOperation!);\n                        this.appliedBooleanOperation = undefined;\n                    }\n                }\n            } else {\n                if (event.type === 'pointerdown' && event.button === 'left') {\n                    this.appliedBooleanOperation = effectiveOperation;\n                    this.onStartSelect(cursorCanvasPos, this.appliedBooleanOperation!);\n                }\n                if (event.type === 'pointermove' && event.button === 'left' && this.isDragging) {\n                    this.onGoSelect(cursorCanvasPos);\n                }\n                if (event.type === 'pointerup' && wasDragging) {\n                    this.onEndSelect();\n                    this.appliedBooleanOperation = undefined;\n                }\n            }\n        }\n\n        if (!event.button) {\n            if (doMove) {\n                this.selectSelectMode = 'move';\n            } else {\n                this.selectSelectMode = 'select';\n            }\n        }\n\n        if (this.selectSelectMode === 'move') {\n            this.easel.setCursor('move');\n        } else {\n            this.easel.setCursor(\n                operationToCursor[this.appliedBooleanOperation ?? effectiveOperation],\n            );\n        }\n    }\n\n    // can be repeatedly called with the same event\n    private transformOnPointer(event: TPointerEvent): void {\n        this.easel.setCursor('move');\n        const transform = this.easel.getTransform();\n        const matrix = inverse(createMatrixFromTransform(transform));\n\n        if (event.type === 'pointerdown' && event.button === 'left') {\n            this.transformPointerStart = applyToPoint(matrix, { x: event.relX, y: event.relY });\n            this.transformPreviousPointer = { ...this.transformPointerStart };\n            this.updateSelectionPath();\n            this.isDragging = true;\n        }\n        if (event.type === 'pointermove' && event.button === 'left') {\n            const canvasPointer = applyToPoint(matrix, { x: event.relX, y: event.relY });\n            this.updateSelectionPath();\n\n            const delta = {\n                x: Math.round(canvasPointer.x - this.transformPreviousPointer.x),\n                y: Math.round(canvasPointer.y - this.transformPreviousPointer.y),\n            };\n            if (delta.x === 0 && delta.y === 0) {\n                return;\n            }\n            this.onTranslateTransform(delta);\n            this.transformPreviousPointer = BB.Vec2.add(this.transformPreviousPointer, delta);\n        }\n        if (event.type === 'pointerup' && event.button === undefined && this.isDragging) {\n            this.updateSelectionPath();\n            this.isDragging = false;\n        }\n    }\n\n    private onPointerChainOut(event: TPointerEvent): void {\n        this.cornerPanning.onPointer(event);\n\n        if (this.mode === 'select') {\n            this.selectOnPointer(event);\n        } else {\n            this.transformOnPointer(event);\n        }\n    }\n\n    // ----------------------------------- public -----------------------------------\n    doubleTapPointerTypes: TPointerType[] = ['touch'];\n    blockTrigger: TEaselToolTrigger = 'alt';\n\n    constructor(p: TEaselSelectParams) {\n        this.onTranslateTransform = p.onTranslateTransform;\n        this.mode = p.selectMode;\n        this.onStartSelect = p.onStartSelect;\n        this.onGoSelect = p.onGoSelect;\n        this.onEndSelect = p.onEndSelect;\n        this.onStartMoveSelect = p.onStartMoveSelect;\n        this.onGoMoveSelect = p.onGoMoveSelect;\n        this.onEndMoveSelect = p.onEndMoveSelect;\n        this.onSelectAddPoly = p.onSelectAddPoly;\n        this.onResetSelection = p.onResetSelection;\n\n        this.cornerPanning = new CornerPanning({\n            getEaselSize: () => this.easel.getSize(),\n            getTransform: () => this.easel.getTargetTransform(),\n            setTransform: (transform) => this.easel.setTransform(transform, true),\n            testCanPan: (buttonIsPressed) => {\n                return (\n                    (buttonIsPressed || this.polyShape.length > 1) &&\n                    !(this.selectShape === 'lasso' && this.selectSelectMode === 'select')\n                );\n            },\n            onRepeatEvent: (e) => {\n                if (this.mode === 'select') {\n                    this.selectOnPointer(e);\n                } else {\n                    this.transformOnPointer(e);\n                }\n            },\n        });\n\n        this.pointerChain = new EventChain({\n            chainArr: [\n                new DoubleTapper({\n                    onDoubleTap: (e) => {\n                        if (this.polyShape.length < 3) {\n                            return;\n                        }\n                        const shape = this.polyShape.map((item) => ({ x: item.x, y: item.y }));\n                        this.resetPolyShape();\n                        if (shape.length > 1) {\n                            shape.push({ ...shape[0] });\n                            p.onSelectAddPoly(shape, this.appliedBooleanOperation!);\n                        }\n                    },\n                    isInstant: true,\n                }) as TChainElement,\n            ],\n        });\n\n        this.svgEl = BB.createSvg({\n            elementType: 'g',\n        });\n    }\n\n    getSvgElement(): SVGElement {\n        return this.svgEl;\n    }\n\n    onPointer(event: TPointerEvent): void {\n        this.onPointerChainOut(event);\n        this.pointerChain.chainIn(event);\n    }\n\n    setEaselInterface(easelInterface: TEaselInterface): void {\n        this.easel = easelInterface;\n        this.viewportTransform = this.easel.getTransform();\n    }\n\n    setMode(mode: TSelectToolMode): void {\n        this.mode = mode;\n        this.resetPolyShape();\n    }\n\n    activate(cursorPos?: TVector2D, poppedTemp?: boolean): void {\n        this.easel.setCursor(modeToCursor[this.mode]);\n        this.isDragging = false;\n        this.onUpdateTransform(this.easel.getTransform());\n        if (!poppedTemp) {\n            this.resetPolyShape();\n        }\n    }\n\n    onUpdateTransform(transform: TViewportTransform): void {\n        this.viewportTransform = transform;\n        this.updateSelectionPath();\n    }\n\n    onUpdateSelection(selection: MultiPolygon | undefined): void {\n        this.canvasSelection = selection || [];\n        this.updateSelectionPath();\n    }\n\n    setRenderedSelection(selection: MultiPolygon | undefined): void {\n        this.easel.setRenderedSelection(selection);\n    }\n\n    clearRenderedSelection(isImmediate?: boolean): void {\n        this.easel.clearRenderedSelection(isImmediate);\n    }\n\n    setBooleanOperation(operation: TBooleanOperation): void {\n        this.defaultBooleanOperation = operation;\n    }\n\n    setSelectShape(shape: TSelectShape): void {\n        this.resetPolyShape();\n        this.selectShape = shape;\n    }\n\n    getIsLocked(): boolean {\n        return this.isDragging;\n    }\n\n    renderAfterViewport(ctx: CanvasRenderingContext2D, transform: TViewportTransformXY): void {\n        if (this.polyShape.length < 2) {\n            return;\n        }\n\n        ctx.save();\n        ctx.globalCompositeOperation = 'difference';\n        ctx.beginPath();\n        const shape = this.polyShape;\n        ctx.moveTo(shape[0].x, shape[0].y);\n        for (let i = 1; i < shape.length; i++) {\n            ctx.lineTo(shape[i].x, shape[i].y);\n        }\n        ctx.lineWidth = 1 / transform.scaleX;\n        ctx.strokeStyle = 'white';\n        ctx.lineCap = 'round';\n        ctx.lineJoin = 'round';\n        ctx.stroke();\n        ctx.restore();\n    }\n\n    onKeyDown(keyStr: string, e: KeyboardEvent): void {\n        if (keyStr === 'esc') {\n            if (this.resetPolyShape()) {\n                e.preventDefault();\n            }\n        }\n    }\n\n    onClickOutside(): void {\n        this.resetPolyShape();\n    }\n\n    onBlur(): void {\n        this.resetPolyShape();\n    }\n\n    onArrowKeys(direction: TArrowKey): boolean {\n        if (this.mode === 'select') {\n            return false;\n        }\n        let movement = { x: 0, y: 0 };\n        if (direction === 'left') {\n            movement = {\n                x: -1,\n                y: 0,\n            };\n        }\n        if (direction === 'right') {\n            movement = {\n                x: 1,\n                y: 0,\n            };\n        }\n        if (direction === 'up') {\n            movement = {\n                x: 0,\n                y: -1,\n            };\n        }\n        if (direction === 'down') {\n            movement = {\n                x: 0,\n                y: 1,\n            };\n        }\n\n        // accommodate easel rotation\n        const rotatedDirection = rotate(\n            movement.x,\n            movement.y,\n            -snapAngleDeg(this.easel.getTransform().angleDeg, 90, 90),\n        );\n\n        this.onTranslateTransform(rotatedDirection);\n        return true;\n    }\n}\n","import { TVector2D } from '../../bb/bb-types';\nimport { MultiPolygon, Polygon } from 'polygon-clipping';\nimport { translateMultiPolygon } from '../../bb/multi-polygon/translate-multi-polygon';\nimport { getEllipsePath } from '../../bb/multi-polygon/get-ellipse-path';\nimport { KlCanvas } from '../canvas/kl-canvas';\nimport { BB } from '../../bb/bb';\nimport { applyPolygonClipping } from '../../bb/multi-polygon/apply-polygon-clipping';\n\nexport type TBooleanOperation = 'union' | 'difference' | 'new';\nexport type TSelectShape = 'rect' | 'ellipse' | 'lasso' | 'poly';\n\nexport const POLYGON_PRECISION = 2;\nexport function limitPrecision(num: number): number {\n    return parseFloat(num.toFixed(POLYGON_PRECISION));\n}\nexport function limitPolygonPrecision(poly: Polygon): Polygon {\n    return poly.map((ring) => ring.map(([x, y]) => [limitPrecision(x), limitPrecision(y)]));\n}\n\nexport type TSelectToolParams = {\n    klCanvas: KlCanvas;\n};\n\nexport class SelectTool {\n    // from params\n    private readonly klCanvas: KlCanvas;\n\n    private shape: TSelectShape = 'rect';\n    private selection: MultiPolygon | undefined;\n    private selectOperation: TBooleanOperation = 'new';\n    private selectDragInputs: TVector2D[] = [];\n    private moveLastPos: TVector2D | undefined;\n    private didMove: boolean = false; // was selection moved\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TSelectToolParams) {\n        this.klCanvas = p.klCanvas;\n    }\n\n    reset(): void {\n        this.selection = undefined;\n    }\n\n    combineSelection(polygon: Polygon): MultiPolygon {\n        let result: MultiPolygon = this.selection ?? [];\n        if (this.selectOperation === 'new') {\n            result = [polygon];\n        } else {\n            if (this.selection && this.selection.length > 0) {\n                const operation = this.selectOperation === 'difference' ? 'difference' : 'union';\n                result = applyPolygonClipping(operation, this.selection, polygon);\n            } else {\n                if (this.selectOperation === 'union') {\n                    result = [polygon];\n                }\n                // noop if difference on empty selection\n            }\n        }\n        return result;\n    }\n\n    /** current state of selection */\n    getSelection(): MultiPolygon | undefined {\n        // combine selections\n        let selection: MultiPolygon = this.selection || [];\n\n        if (this.selectDragInputs.length > 1) {\n            // currently inputting\n\n            const operation = this.selectOperation === 'difference' ? 'difference' : 'union';\n\n            if (this.shape === 'rect') {\n                const first = this.selectDragInputs[0];\n                const last = this.selectDragInputs[this.selectDragInputs.length - 1];\n                // floor and ceil already limit precision\n                const minX = Math.floor(Math.min(first.x, last.x));\n                const minY = Math.floor(Math.min(first.y, last.y));\n                const maxX = Math.ceil(Math.max(first.x, last.x));\n                const maxY = Math.ceil(Math.max(first.y, last.y));\n\n                selection = this.combineSelection([\n                    [\n                        [minX, minY],\n                        [maxX, minY],\n                        [maxX, maxY],\n                        [minX, maxY],\n                    ],\n                ]);\n            } else if (this.shape === 'ellipse') {\n                const first = this.selectDragInputs[0];\n                const last = this.selectDragInputs[this.selectDragInputs.length - 1];\n\n                const cx = (first.x + last.x) / 2;\n                const cy = (first.y + last.y) / 2;\n                const rx = Math.abs(last.x - first.x) / 2;\n                const ry = Math.abs(last.y - first.y) / 2;\n\n                selection = this.combineSelection(\n                    limitPolygonPrecision(getEllipsePath(cx, cy, rx, ry, 50)),\n                );\n            } else if (this.shape === 'lasso') {\n                selection = this.combineSelection([\n                    this.selectDragInputs.map((p) => [limitPrecision(p.x), limitPrecision(p.y)]),\n                ] as Polygon);\n            }\n        }\n\n        return selection.length === 0 ? undefined : selection;\n    }\n\n    // --- selecting ---\n    startSelect(pos: TVector2D, operation: TBooleanOperation): void {\n        this.selectOperation = operation;\n        if (this.selectOperation === 'new') {\n            this.reset();\n        }\n        this.selectDragInputs = [pos];\n    }\n\n    goSelect(pos: TVector2D): void {\n        this.selectDragInputs.push({\n            x: pos.x,\n            y: pos.y,\n        });\n    }\n\n    endSelect(): void {\n        if (this.selectDragInputs.length > 1) {\n            // commit\n            this.selection = this.getSelection();\n        } else {\n            this.reset();\n        }\n        this.selectDragInputs = [];\n    }\n\n    addPoly(polygon: TVector2D[], operation: TBooleanOperation): void {\n        this.selectOperation = operation;\n        this.selection = this.combineSelection([\n            polygon.map((p) => [limitPrecision(p.x), limitPrecision(p.y)]),\n        ]);\n    }\n\n    // --- moving selection ---\n    startMoveSelect(pos: TVector2D): void {\n        this.moveLastPos = pos;\n        this.didMove = false;\n    }\n\n    goMoveSelect(pos: TVector2D): void {\n        if (!this.moveLastPos) {\n            return;\n        }\n        this.didMove = true;\n        const dx = Math.round(pos.x - this.moveLastPos.x);\n        const dy = Math.round(pos.y - this.moveLastPos.y);\n        if (this.selection) {\n            this.selection = translateMultiPolygon(this.selection, dx, dy);\n        }\n        this.moveLastPos = {\n            x: this.moveLastPos.x + dx,\n            y: this.moveLastPos.y + dy,\n        };\n    }\n\n    endMoveSelect(): void {\n        this.moveLastPos = undefined;\n    }\n\n    getDidMove(): boolean {\n        return this.didMove;\n    }\n\n    selectAll(): void {\n        this.reset();\n        const width = this.klCanvas.getWidth();\n        const height = this.klCanvas.getHeight();\n        this.selection = [\n            [\n                [\n                    [0, 0],\n                    [width, 0],\n                    [width, height],\n                    [0, height],\n                    [0, 0],\n                ],\n            ],\n        ];\n    }\n\n    invertSelection(): void {\n        const selection = this.selection ?? [];\n        const width = this.klCanvas.getWidth();\n        const height = this.klCanvas.getHeight();\n        this.selection = applyPolygonClipping(\n            'difference',\n            [\n                [\n                    [0, 0],\n                    [width, 0],\n                    [width, height],\n                    [0, height],\n                ],\n            ],\n            selection,\n        );\n    }\n\n    setShape(shape: TSelectShape): void {\n        this.shape = shape;\n    }\n\n    getShape(): TSelectShape {\n        return this.shape;\n    }\n\n    setSelection(selection: MultiPolygon | undefined): void {\n        this.selection = selection ? BB.copyObj(selection).map(limitPolygonPrecision) : undefined;\n    }\n}\n","import { Polygon, Ring } from 'polygon-clipping';\n\nexport function getEllipsePath(\n    cx: number,\n    cy: number,\n    rx: number,\n    ry: number,\n    steps: number,\n): Polygon {\n    const result: Ring = [];\n    const d = (2 * Math.PI) / steps;\n\n    for (let i = 0; i < 2 * Math.PI; i += d) {\n        result.push([Math.cos(i) * rx + cx, Math.sin(i) * ry + cy]);\n    }\n\n    return [result];\n}\n","import { TBounds, TVector2D } from '../../bb/bb-types';\nimport { MultiPolygon } from 'polygon-clipping';\nimport { getSelectionPath2d } from '../../bb/multi-polygon/get-selection-path-2d';\nimport {\n    applyToPoint,\n    compose,\n    decomposeTSR,\n    identity,\n    Matrix,\n    rotate,\n    scale,\n    translate,\n} from 'transformation-matrix';\nimport { transformMultiPolygon } from '../../bb/multi-polygon/transform-multi-polygon';\nimport { getMultiPolyBounds } from '../../bb/multi-polygon/get-multi-polygon-bounds';\nimport { TLayerComposite, TSelectionSample } from '../canvas/kl-canvas';\nimport { BB } from '../../bb/bb';\nimport { snapToPixel, TFreeTransform } from '../ui/components/free-transform-utils';\nimport { integerBounds } from '../../bb/math/math';\nimport { matrixToTuple } from '../../bb/math/matrix-to-tuple';\n\nfunction matrixToFreeTransform(transform: Matrix, bounds: TBounds): TFreeTransform {\n    const centerBefore = {\n        x: bounds.x1 + (bounds.x2 - bounds.x1) / 2,\n        y: bounds.y1 + (bounds.y2 - bounds.y1) / 2,\n    };\n    const centerAfter = applyToPoint(transform, centerBefore);\n    const decomposed = decomposeTSR(transform);\n    const angleDeg = BB.round((decomposed.rotation.angle / Math.PI) * 180, 7);\n\n    const tlBefore = {\n        x: bounds.x1,\n        y: bounds.y1,\n    };\n    const trBefore = {\n        x: bounds.x2,\n        y: bounds.y1,\n    };\n    const blBefore = {\n        x: bounds.x1,\n        y: bounds.y2,\n    };\n\n    const [tlAfter, trAfter, blAfter] = [tlBefore, trBefore, blBefore].map((p) => {\n        return applyToPoint(transform, p);\n    });\n    let width = BB.Vec2.dist(trAfter, tlAfter);\n    let height = BB.Vec2.dist(blAfter, tlAfter);\n\n    if (decomposed.scale.sx < 0) {\n        width = -width;\n    }\n    if (decomposed.scale.sy < 0) {\n        height = -height;\n    }\n\n    return {\n        ...centerAfter,\n        width,\n        height,\n        angleDeg,\n    };\n}\n\nfunction freeTransformToMatrix(transform: TFreeTransform, bounds: TBounds): Matrix {\n    const centerBefore = {\n        x: bounds.x1 + (bounds.x2 - bounds.x1) / 2,\n        y: bounds.y1 + (bounds.y2 - bounds.y1) / 2,\n    };\n\n    const widthBefore = bounds.x2 - bounds.x1;\n    const heightBefore = bounds.y2 - bounds.y1;\n\n    const scaleX = transform.width / widthBefore;\n    const scaleY = transform.height / heightBefore;\n\n    const angleRad = (transform.angleDeg / 180) * Math.PI;\n\n    return compose(\n        translate(transform.x, transform.y),\n        rotate(angleRad),\n        scale(scaleX, scaleY),\n        translate(-centerBefore.x, -centerBefore.y),\n    );\n}\n\n/**\n * to facilitate KlCanvas.transformViaSelection and provide a preview (composite)\n */\nexport class SelectTransformTool {\n    private selection: MultiPolygon = [];\n    private selectionBounds: TBounds = {} as TBounds;\n    private transform: Matrix = {} as Matrix;\n    private doClone: boolean = false; // true -> draw selected area twice (original position, and transformed position)\n    private selectionSample: TSelectionSample | undefined;\n    private backgroundIsTransparent: boolean = false;\n\n    // ----------------------------------- public -----------------------------------\n    constructor() {}\n\n    setBackgroundIsTransparent(isTransparent: boolean): void {\n        this.backgroundIsTransparent = isTransparent;\n    }\n\n    setSelection(selection: MultiPolygon): void {\n        this.selection = selection;\n        this.selectionBounds = integerBounds(getMultiPolyBounds(this.selection)); // floor & ceil to prevent blurriness\n        this.transform = identity();\n    }\n\n    isTransformationChanged(): boolean {\n        const identityMatrix = identity();\n        const keys = Object.keys(identityMatrix) as (keyof Matrix)[];\n        for (let i = 0; i < keys.length; i++) {\n            const key = keys[i];\n            if (identityMatrix[key] !== this.transform[key]) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    reset(): void {\n        this.transform = identity();\n        this.selection = [];\n        this.selectionBounds = {\n            x1: 0,\n            y1: 0,\n            x2: 0,\n            y2: 0,\n        };\n    }\n\n    // ---- transform ----\n\n    translate(d: TVector2D): void {\n        this.transform = compose(translate(d.x, d.y), this.transform);\n    }\n\n    flip(axis: 'x' | 'y'): void {\n        const center = {\n            x: (this.selectionBounds.x1 + this.selectionBounds.x2) / 2,\n            y: (this.selectionBounds.y1 + this.selectionBounds.y2) / 2,\n        };\n        const transformedCenter = applyToPoint(this.transform, center);\n        this.transform = compose(\n            translate(transformedCenter.x, transformedCenter.y),\n            scale(axis === 'x' ? -1 : 1, axis === 'y' ? -1 : 1),\n            translate(-transformedCenter.x, -transformedCenter.y),\n            this.transform,\n        );\n    }\n\n    rotateDeg(deg: number): void {\n        const center = {\n            x: (this.selectionBounds.x1 + this.selectionBounds.x2) / 2,\n            y: (this.selectionBounds.y1 + this.selectionBounds.y2) / 2,\n        };\n        const transformedCenter = applyToPoint(this.transform, center);\n        this.transform = compose(\n            translate(transformedCenter.x, transformedCenter.y),\n            rotate((deg / 180) * Math.PI),\n            translate(-transformedCenter.x, -transformedCenter.y),\n            this.transform,\n        );\n    }\n\n    // --------\n\n    setDoClone(b: boolean): void {\n        this.doClone = b;\n    }\n\n    getDoClone(): boolean {\n        return this.doClone;\n    }\n\n    getTransform(): Matrix {\n        const freeTransform = matrixToFreeTransform(this.transform, this.selectionBounds);\n        snapToPixel(freeTransform);\n        return freeTransformToMatrix(freeTransform, this.selectionBounds);\n    }\n\n    setTransform(transform: Matrix): void {\n        this.transform = transform;\n    }\n\n    getTransformedSelection(): MultiPolygon {\n        return transformMultiPolygon(this.selection, this.getTransform());\n    }\n\n    setSelectionSample(selectionSample: TSelectionSample | undefined): void {\n        this.selectionSample = selectionSample;\n    }\n\n    /**\n     * creates composite for KlCanvas layer\n     * if source === target\n     */\n    createComposite(originalSrcCanvas: HTMLCanvasElement): TLayerComposite {\n        const selectionPath = getSelectionPath2d(this.selection);\n        const transform = this.getTransform();\n\n        return {\n            draw: (ctx: CanvasRenderingContext2D) => {\n                ctx.save();\n\n                if (this.selectionSample && this.doClone) {\n                    if (this.selectionSample.image) {\n                        ctx.setTransform(...matrixToTuple(transform));\n                        ctx.clip(selectionPath);\n                        const canvasTransform = compose(\n                            transform,\n                            this.selectionSample.transformation,\n                        );\n                        ctx.setTransform(...matrixToTuple(canvasTransform));\n                        ctx.drawImage(this.selectionSample.image, 0, 0);\n                    }\n                } else {\n                    //draw original with inverted selection before transformation\n                    if (!this.doClone) {\n                        ctx.save();\n                        ctx.clip(selectionPath);\n                        if (this.backgroundIsTransparent) {\n                            ctx.clearRect(0, 0, originalSrcCanvas.width, originalSrcCanvas.height);\n                        } else {\n                            ctx.globalCompositeOperation = 'source-in';\n                            ctx.fillStyle = '#fff';\n                            ctx.fillRect(0, 0, originalSrcCanvas.width, originalSrcCanvas.height);\n                        }\n                        ctx.restore();\n                    }\n\n                    ctx.setTransform(...matrixToTuple(transform));\n                    ctx.clip(selectionPath);\n                    ctx.drawImage(originalSrcCanvas, 0, 0);\n                }\n\n                ctx.restore();\n            },\n        } as any;\n    }\n\n    /**\n     * creates composite for source KlCanvas layer\n     * if source != target\n     */\n    createSourceComposite(originalSrcCanvas: HTMLCanvasElement): TLayerComposite | undefined {\n        const selectionPath = getSelectionPath2d(this.selection);\n\n        if (this.doClone) {\n            return undefined;\n        }\n\n        return {\n            draw: (ctx: CanvasRenderingContext2D) => {\n                //draw original with inverted selection before transformation\n                ctx.save();\n                ctx.clip(selectionPath);\n                if (this.backgroundIsTransparent) {\n                    ctx.clearRect(0, 0, originalSrcCanvas.width, originalSrcCanvas.height);\n                } else {\n                    ctx.globalCompositeOperation = 'source-in';\n                    ctx.fillStyle = '#fff';\n                    ctx.fillRect(0, 0, originalSrcCanvas.width, originalSrcCanvas.height);\n                }\n                ctx.restore();\n            },\n        } as any;\n    }\n\n    /**\n     * creates composite for target KlCanvas layer\n     * if source != target\n     */\n    createTargetComposite(originalSrcCanvas: HTMLCanvasElement): TLayerComposite {\n        const selectionPath = getSelectionPath2d(this.selection);\n        const transform = this.getTransform();\n\n        return {\n            draw: (ctx: CanvasRenderingContext2D) => {\n                ctx.save();\n\n                if (this.selectionSample && this.doClone) {\n                    if (this.selectionSample.image) {\n                        ctx.setTransform(...matrixToTuple(transform));\n                        ctx.clip(selectionPath);\n                        const canvasTransform = compose(\n                            transform,\n                            this.selectionSample.transformation,\n                        );\n                        ctx.setTransform(...matrixToTuple(canvasTransform));\n                        ctx.drawImage(this.selectionSample.image, 0, 0);\n                    }\n                } else {\n                    ctx.setTransform(...matrixToTuple(transform));\n                    ctx.clip(selectionPath);\n                    ctx.drawImage(originalSrcCanvas, 0, 0);\n                }\n\n                ctx.restore();\n            },\n        } as any;\n    }\n}\n","export type TTempHistoryEntry = {\n    type: string;\n    data: unknown;\n};\n\nexport type TTempHistoryEventType = 'push' | 'decrease' | 'increase' | 'clear' | 'active';\nexport type TTempHistoryListener = (type: TTempHistoryEventType) => void;\n\n/**\n * History of temporary actions that will either be committed (to KlHistory) or discarded.\n * E.g. transform via selection\n */\nexport class KlTempHistory {\n    private entries: TTempHistoryEntry[] = [];\n    private currentIndex: number = -1;\n    private listeners: TTempHistoryListener[] = [];\n    private isActive: boolean = false;\n\n    private emit(type: TTempHistoryEventType) {\n        this.listeners.forEach((item) => item(type));\n    }\n\n    // ----------------------------------- public -----------------------------------\n\n    constructor() {}\n\n    push(entry: TTempHistoryEntry): void {\n        if (this.currentIndex < this.entries.length - 1) {\n            this.entries.splice(this.currentIndex + 1);\n        }\n        this.entries.push(entry);\n        this.currentIndex = this.entries.length - 1;\n        setTimeout(() => this.emit('push'));\n    }\n\n    replaceTop(newEntry: TTempHistoryEntry): void {\n        this.entries.splice(this.currentIndex);\n        this.entries.push(newEntry);\n        this.currentIndex = this.entries.length - 1;\n        setTimeout(() => this.emit('push'));\n    }\n\n    canDecreaseIndex(): boolean {\n        return this.currentIndex > -1;\n    }\n\n    canIncreaseIndex(): boolean {\n        return this.currentIndex < this.entries.length - 1;\n    }\n\n    /** aka undo */\n    decreaseIndex(): void {\n        if (!this.canDecreaseIndex()) {\n            return;\n        }\n        this.currentIndex--;\n        setTimeout(() => this.emit('decrease'));\n    }\n\n    /** aka redo */\n    increaseIndex(): void {\n        if (!this.canIncreaseIndex()) {\n            return;\n        }\n        this.currentIndex++;\n        setTimeout(() => this.emit('increase'));\n    }\n\n    /**\n     * all entries up to currentIndex\n     */\n    getEntries(): TTempHistoryEntry[] {\n        return this.entries.slice(0, this.currentIndex + 1);\n    }\n\n    clear(): void {\n        this.entries = [];\n        this.currentIndex = -1;\n        setTimeout(() => this.emit('clear'));\n    }\n\n    /**\n     * emits on push, decrease, increase, clear, or toggle active\n     */\n    addListener(listener: TTempHistoryListener): void {\n        if (this.listeners.includes(listener)) {\n            return;\n        }\n        this.listeners.push(listener);\n    }\n\n    removeListener(listener: TTempHistoryListener): void {\n        this.listeners.map((item, index) => {\n            if (item === listener) {\n                this.listeners.splice(index, 1);\n            }\n        });\n    }\n\n    setIsActive(isActive: boolean): void {\n        if (this.isActive === isActive) {\n            return;\n        }\n        this.isActive = isActive;\n        this.emit('active');\n    }\n\n    getIsActive(): boolean {\n        return this.isActive;\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { LANG } from '../../../language/language';\nimport { css } from '../../../bb/base/base';\n\n/**\n * Users can get stuck when pinch-zooming in (via double tapping or pinching).\n * This overlay helps users zoom out again. It automatically shows up and hides\n * itself.\n */\nexport class PinchZoomWatcher {\n    // -------------------- public ----------------------\n    constructor() {\n        if (!('visualViewport' in window) || visualViewport === null) {\n            return;\n        }\n        const viewport = visualViewport;\n\n        let isDismissed = false;\n        const rootEl = BB.el({\n            content: LANG('browser-zoom-help'),\n            className: 'kl-pinch-overlay',\n            css: {\n                position: 'fixed',\n                pointerEvents: 'none',\n                display: 'flex',\n                justifyContent: 'center',\n                alignItems: 'center',\n                zIndex: '100',\n                flexDirection: 'column',\n                gap: '10px',\n                padding: '10px',\n                backdropFilter: 'blur(3px)',\n            },\n        });\n        BB.el({\n            parent: rootEl,\n            tagName: 'button',\n            content: LANG('dismiss'),\n            onClick: () => {\n                isDismissed = true;\n                iframe.remove();\n                rootEl.remove();\n            },\n            css: {\n                pointerEvents: 'initial',\n            },\n        });\n\n        // iframe allows pinch-zooming the page even if viewport meta tag set to user-scalable=no\n        const iframe = BB.el({\n            tagName: 'iframe',\n            css: {\n                position: 'fixed',\n                width: '100vw',\n                height: '100vh',\n                zIndex: '99',\n                opacity: '0', // can't change iframe background color in some browsers\n            },\n        });\n\n        let isInDom = false;\n        function check() {\n            if (isDismissed) {\n                return;\n            }\n            const testEl = BB.el({\n                parent: document.body,\n                css: {\n                    position: 'fixed',\n                    inset: '0',\n                    zIndex: '-1',\n                },\n            });\n\n            const rect = testEl.getBoundingClientRect();\n            testEl.remove();\n\n            const isZoomed =\n                (viewport.width !== Math.round(rect.width) ||\n                    viewport.height !== Math.round(rect.height)) &&\n                viewport.scale > 1;\n\n            if (isZoomed) {\n                css(rootEl, {\n                    left: viewport.offsetLeft + 'px',\n                    top: viewport.offsetTop + 'px',\n                    width: viewport.width + 'px',\n                    height: viewport.height + 'px',\n                });\n                if (!isInDom) {\n                    document.body.append(iframe);\n                    document.body.append(rootEl);\n                }\n            } else {\n                if (isInDom) {\n                    iframe.remove();\n                    rootEl.remove();\n                }\n            }\n            isInDom = isZoomed;\n        }\n        viewport.addEventListener('resize', check);\n        viewport.addEventListener('scroll', check);\n        setTimeout(check);\n    }\n}\n","import { KlHistory } from './kl-history';\nimport { KlTempHistory } from './kl-temp-history';\n\nexport type THistoryExecutionType = 'undo' | 'redo' | 'tempUndo' | 'tempRedo';\n\nexport type TKlHistoryExecutionResult = {\n    type: THistoryExecutionType;\n};\n\nexport type TKlHistoryExecutorParams = {\n    klHistory: KlHistory;\n    tempHistory: KlTempHistory;\n    onCanUndoRedoChange: (canUndo: boolean, canRedo: boolean) => void;\n};\n\n/**\n * performs undo/redo in klHistory and tempHistory\n */\nexport class KlHistoryExecutor {\n    // from params\n    private readonly klHistory: KlHistory;\n    private readonly tempHistory: KlTempHistory;\n    private readonly onCanUndoRedoChange: (canUndo: boolean, canRedo: boolean) => void;\n\n    private doIgnore = false;\n    private lastCanUndo = false;\n    private lastCanRedo = false;\n\n    /**\n     * If UI is frozen while pressing undo/redo, the user might click multiple times\n     * because they think the click wasn't registered.\n     * This test prevents multiple undo/redo at once.\n     * true = skip\n     */\n    private testShouldSkip(): boolean {\n        if (this.doIgnore) {\n            return true;\n        }\n        this.doIgnore = true;\n        setTimeout(() => {\n            this.doIgnore = false;\n        }, 0);\n        return false;\n    }\n\n    private canUndo(): boolean {\n        return (\n            (this.tempHistory.getIsActive() && this.tempHistory.canDecreaseIndex()) ||\n            this.klHistory.canUndo()\n        );\n    }\n\n    private canRedo(): boolean {\n        if (this.tempHistory.getIsActive()) {\n            return this.tempHistory.canIncreaseIndex();\n        }\n        return this.klHistory.canRedo();\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TKlHistoryExecutorParams) {\n        this.klHistory = p.klHistory;\n        this.tempHistory = p.tempHistory;\n        this.onCanUndoRedoChange = p.onCanUndoRedoChange;\n\n        const emitCanUndoRedo = () => {\n            const canUndo = this.canUndo();\n            const canRedo = this.canRedo();\n            if (this.lastCanUndo === canUndo && this.lastCanRedo === canRedo) {\n                return;\n            }\n            this.lastCanUndo = canUndo;\n            this.lastCanRedo = canRedo;\n            this.onCanUndoRedoChange(canUndo, canRedo);\n        };\n\n        this.klHistory.addListener(emitCanUndoRedo);\n        this.tempHistory.addListener(emitCanUndoRedo);\n    }\n\n    // returns undefined if it can't undo\n    undo(): undefined | TKlHistoryExecutionResult {\n        if (this.testShouldSkip()) {\n            return undefined;\n        }\n        if (this.tempHistory.getIsActive() && this.tempHistory.canDecreaseIndex()) {\n            this.tempHistory.decreaseIndex();\n            return {\n                type: 'tempUndo',\n            };\n        }\n        if (!this.klHistory.canUndo()) {\n            return undefined;\n        }\n        this.klHistory.decreaseIndex();\n\n        return {\n            type: 'undo',\n        };\n    }\n\n    // returns undefined if it can't redo\n    redo(): undefined | TKlHistoryExecutionResult {\n        if (this.testShouldSkip()) {\n            return undefined;\n        }\n        if (this.tempHistory.getIsActive() && this.tempHistory.canIncreaseIndex()) {\n            this.tempHistory.increaseIndex();\n            return {\n                type: 'tempRedo',\n            };\n        }\n        if (!this.klHistory.canRedo()) {\n            return undefined;\n        }\n        this.klHistory.increaseIndex();\n\n        return {\n            type: 'redo',\n        };\n    }\n}\n","import { THistoryEntryData } from '../history.types';\n\n// does it exclusively change activeLayerId\nexport function isHistoryEntryActiveLayerChange(entry: THistoryEntryData): boolean {\n    const keys = Object.keys(entry);\n    return keys.length === 1 && keys[0] === 'activeLayerId';\n}\n","import { BB } from '../../../bb/bb';\nimport { ToolspaceCollapser } from './toolspace-collapser';\nimport { KL } from '../../kl';\nimport { TUiLayout } from '../../kl-types';\nimport { LocalStorage } from '../../../bb/base/local-storage';\nimport { css } from '../../../bb/base/base';\n\nexport type TMobileUiParams = {\n    onShowToolspace: (b: boolean) => void;\n    toolUis: HTMLElement[];\n};\n\nexport class MobileUi {\n    private readonly rootEl: HTMLElement;\n    private toolspaceIsOpen: boolean = true;\n    private orientation: TUiLayout = 'right';\n    private isVisible: boolean = false;\n    private readonly toolspaceCollapser: ToolspaceCollapser;\n    private readonly mobileWrapperEl: HTMLElement;\n    private readonly onShowToolspace: TMobileUiParams['onShowToolspace'];\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TMobileUiParams) {\n        this.onShowToolspace = p.onShowToolspace;\n        this.toolspaceCollapser = new KL.ToolspaceCollapser({\n            onChange: () => {\n                this.toolspaceIsOpen = this.toolspaceCollapser.isOpen();\n                this.onShowToolspace(this.toolspaceIsOpen);\n                if (this.toolspaceIsOpen) {\n                    LocalStorage.removeItem('uiShowMobile');\n                } else {\n                    LocalStorage.setItem('uiShowMobile', 'true');\n                }\n            },\n        });\n\n        this.mobileWrapperEl = BB.el({\n            css: {\n                marginTop: '4px',\n                display: 'flex',\n                flexDirection: 'column',\n                gap: '4px',\n            },\n        });\n        this.mobileWrapperEl.append(...p.toolUis);\n\n        this.rootEl = BB.el({\n            css: {\n                position: 'absolute',\n                top: '0',\n                userSelect: 'none',\n            },\n        });\n        this.rootEl.append(this.toolspaceCollapser.getElement(), this.mobileWrapperEl);\n        this.update();\n    }\n\n    update(): void {\n        if (this.isVisible) {\n            if (this.toolspaceIsOpen) {\n                this.mobileWrapperEl.style.display = 'none';\n                if (this.orientation === 'left') {\n                    css(this.rootEl, {\n                        left: '271px',\n                        right: '',\n                    });\n                } else {\n                    css(this.rootEl, {\n                        left: '',\n                        right: '271px',\n                    });\n                }\n            } else {\n                this.mobileWrapperEl.style.display = 'flex';\n                if (this.orientation === 'left') {\n                    css(this.rootEl, {\n                        left: '0',\n                        right: '',\n                    });\n                } else {\n                    css(this.rootEl, {\n                        left: '',\n                        right: '0',\n                    });\n                }\n            }\n            this.rootEl.style.display = 'block';\n        } else {\n            this.rootEl.style.display = 'none';\n        }\n    }\n\n    setOrientation(orientation: TUiLayout): void {\n        this.orientation = orientation;\n        this.toolspaceCollapser.setOrientation(orientation);\n    }\n\n    setIsVisible(b: boolean): void {\n        this.isVisible = b;\n    }\n\n    getToolspaceIsOpen(): boolean {\n        return this.toolspaceIsOpen;\n    }\n\n    setToolspaceIsOpen(b: boolean): void {\n        this.toolspaceIsOpen = b;\n        this.toolspaceCollapser.setIsOpen(b);\n        this.onShowToolspace(b);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { Options } from '../components/options';\nimport { LANG } from '../../../language/language';\nimport brushIconImg from 'url:/src/app/img/ui/tool-paint.svg';\nimport eraserIconImg from 'url:/src/app/img/ui/brush-eraser.svg';\nimport { Icon } from '../components/icon';\n\nexport type TMobileBrushUiParams = {\n    onEraser: () => void;\n    onBrush: () => void;\n};\n\ntype TBrushType = 'brush' | 'eraser';\n\nexport class MobileBrushUi {\n    private readonly rootEl: HTMLElement;\n    private readonly brushOptions: Options<TBrushType>;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TMobileBrushUiParams) {\n        const brushIcon = new Icon({\n            imageUrl: brushIconImg,\n            width: 28,\n            height: 28,\n            darkInvert: true,\n            css: {\n                margin: '4px',\n            },\n        });\n\n        const eraserIcon = new Icon({\n            imageUrl: eraserIconImg,\n            width: 28,\n            height: 28,\n            darkInvert: true,\n            css: {\n                margin: '4px',\n            },\n        });\n\n        this.brushOptions = new Options<TBrushType>({\n            optionArr: [\n                {\n                    id: 'brush',\n                    label: brushIcon.getElement(),\n                    title: LANG('tool-brush'),\n                },\n                {\n                    id: 'eraser',\n                    label: eraserIcon.getElement(),\n                    title: LANG('eraser'),\n                },\n            ],\n            initId: 'brush',\n            onChange: (id: string): void => {\n                if (id === 'brush') {\n                    p.onBrush();\n                } else {\n                    p.onEraser();\n                }\n            },\n            isColumn: true,\n        });\n\n        this.rootEl = BB.el({\n            css: {},\n        });\n        this.rootEl.append(this.brushOptions.getElement());\n    }\n\n    setIsVisible(b: boolean): void {\n        this.rootEl.style.display = b ? 'block' : 'none';\n    }\n\n    setType(type: TBrushType): void {\n        this.brushOptions.setValue(type, true);\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","import { BB } from '../../../bb/bb';\n\nexport type TIconParams = {\n    imageUrl: string;\n    width: number;\n    height: number;\n    darkInvert?: boolean;\n    css?: Partial<CSSStyleDeclaration>;\n};\n\nexport class Icon {\n    private readonly rootEl: HTMLElement;\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TIconParams) {\n        this.rootEl = BB.el({\n            className: p.darkInvert ? 'dark-invert' : '',\n            css: {\n                backgroundImage: `url(\"${p.imageUrl}\")`,\n                backgroundSize: 'contain',\n                backgroundPosition: 'center',\n                backgroundRepeat: 'no-repeat',\n                width: p.width + 'px',\n                height: p.height + 'px',\n                ...p.css,\n            },\n        });\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","import { isLayerFill, TKlProject } from '../../kl-types';\nimport { THistoryEntryDataComposed, THistoryEntryLayerTile } from '../history.types';\nimport { canvasToLayerTiles } from './canvas-to-layer-tiles';\nimport { getNextLayerId } from '../get-next-layer-id';\nimport { BB } from '../../../bb/bb';\n\nexport function projectToComposed(project: TKlProject): THistoryEntryDataComposed {\n    let lastId: string = '';\n    const layerMap = Object.fromEntries(\n        project.layers.map((layer, index) => {\n            lastId = getNextLayerId();\n            let tiles: THistoryEntryLayerTile[] = [];\n\n            if (layer.image instanceof Array) {\n                tiles = [...layer.image];\n            } else {\n                const canvas = (() => {\n                    if (layer.image instanceof HTMLCanvasElement) {\n                        return layer.image;\n                    }\n                    const canvas = BB.canvas(project.width, project.height);\n                    const ctx = BB.ctx(canvas);\n                    if (isLayerFill(layer.image)) {\n                        ctx.fillStyle = layer.image.fill;\n                        ctx.fillRect(0, 0, project.width, project.height);\n                    } else {\n                        ctx.drawImage(layer.image, 0, 0);\n                    }\n                    return canvas;\n                })();\n                tiles = canvasToLayerTiles(canvas);\n            }\n\n            return [\n                lastId,\n                {\n                    name: layer.name,\n                    opacity: layer.opacity,\n                    isVisible: layer.isVisible,\n                    mixModeStr: layer.mixModeStr ?? 'source-over',\n                    index,\n                    tiles,\n                },\n            ];\n        }),\n    );\n    return {\n        projectId: {\n            value: project.projectId,\n        },\n        size: {\n            width: project.width,\n            height: project.height,\n        },\n        selection: {},\n        activeLayerId: lastId,\n        layerMap,\n    };\n}\n","import { KlHistory } from '../../history/kl-history';\n\nexport type TUnloadWarningTriggerParams = {\n    klHistory: KlHistory;\n    getLastSavedHistoryIndex: () => number;\n};\n\nexport class UnloadWarningTrigger {\n    private readonly klHistory: KlHistory;\n    private readonly getLastSavedHistoryIndex: () => number;\n    private readonly onBeforeUnload = (e: BeforeUnloadEvent) => {\n        e.preventDefault();\n        e.returnValue = '';\n    };\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TUnloadWarningTriggerParams) {\n        this.klHistory = p.klHistory;\n        this.getLastSavedHistoryIndex = p.getLastSavedHistoryIndex;\n        p.klHistory.addListener(() => this.update());\n    }\n\n    update(): void {\n        const historyIndex = this.klHistory.getTotalIndex();\n        if (this.getLastSavedHistoryIndex() !== historyIndex) {\n            window.addEventListener('beforeunload', this.onBeforeUnload);\n        } else {\n            window.removeEventListener('beforeunload', this.onBeforeUnload);\n        }\n    }\n\n    destroy(): void {\n        //...\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport * as classes from './browser-storage-banner.module.scss';\nimport { LANG } from '../../../language/language';\nimport { ProjectStore } from '../../storage/project-store';\nimport { KlRecoveryManager } from '../../storage/kl-recovery-manager';\nimport { css, fitInto, sleep } from '../../../bb/base/base';\nimport { CrossTabChannel } from '../../../bb/base/cross-tab-channel';\nimport { KlHistory } from '../../history/kl-history';\nimport cancelImg from 'url:/src/app/img/ui/cancel.svg';\n\nexport type TBrowserStorageBannerParams = {\n    projectStore?: ProjectStore;\n    klRecoveryManager?: KlRecoveryManager;\n    klHistory: KlHistory;\n    onOpenBrowserStorage: () => void;\n};\n\nexport async function runBrowserStorageBanner(p: TBrowserStorageBannerParams): Promise<void> {\n    /*\n    only show banner if all:\n    - nothing was recovered\n    - project store is not empty\n    - no other tab has this project already open (prevent confusion)\n     */\n\n    if (!p.projectStore) {\n        // no store -> noop\n        return;\n    }\n\n    const openedProjectIds: string[] = [];\n    const crossTabChannel = new CrossTabChannel('kl-tab-communication');\n    {\n        // subscription stays up during run of application\n        crossTabChannel.subscribe((message) => {\n            if (message.type === 'request-project-ids') {\n                crossTabChannel.postMessage({\n                    type: 'response-project-id',\n                    id: p.klHistory.getComposed().projectId.value,\n                });\n            }\n        });\n        const otherIdListener = (message: any) => {\n            if (message.type === 'response-project-id') {\n                openedProjectIds.push(message.id);\n            }\n        };\n        crossTabChannel.subscribe(otherIdListener);\n        crossTabChannel.postMessage({ type: 'request-project-ids' });\n        await sleep(100);\n        crossTabChannel.unsubscribe(otherIdListener);\n    }\n\n    if (p.klRecoveryManager?.getTabId() !== undefined) {\n        // something already recovered -> noop\n        return;\n    }\n    const meta = await p.projectStore.readMeta();\n    if (!meta) {\n        // nothing stored -> noop\n        return;\n    }\n\n    if (openedProjectIds.includes(meta.projectId)) {\n        // already open in other tab -> noop\n        return;\n    }\n\n    const fit = fitInto(meta.thumbnail.width, meta.thumbnail.height, 100, 100);\n    css(meta.thumbnail, {\n        width: fit.width + 'px',\n        height: fit.height + 'px',\n    });\n\n    const closeButton = BB.el({\n        tagName: 'button',\n        className: classes.closeButton + ' popup-x',\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\n        title: LANG('modal-close'),\n        custom: {\n            tabindex: '0',\n        },\n    });\n    closeButton.onclick = close;\n\n    const preview = BB.el({\n        className: classes.preview,\n        content: meta.thumbnail,\n        title: LANG('file-storage-open'),\n    });\n    preview.onclick = () => {\n        close();\n        p.onOpenBrowserStorage();\n    };\n    const title = BB.el({\n        content: LANG('file-storage'),\n    });\n    const buttonClass = classes.btn;\n    const openBtn = BB.el({\n        tagName: 'button',\n        className: ['kl-button-primary', buttonClass].join(' '),\n        content: LANG('file-storage-open'),\n        custom: {\n            tabIndex: '-1',\n        },\n    });\n    openBtn.onclick = () => {\n        close();\n        p.onOpenBrowserStorage();\n    };\n    const rightCol = BB.el({\n        className: classes.rightCol,\n        content: [title, openBtn],\n    });\n    const mainContent = BB.el({\n        className: classes.mainContent,\n        content: [preview, rightCol],\n    });\n    const closeArea = BB.el({\n        className: classes.closeArea,\n    });\n    closeArea.onclick = close;\n    const banner = BB.el({\n        className: classes.banner,\n        content: [closeArea, mainContent, closeButton],\n    });\n    banner.onclick = BB.handleClick;\n    const rootEl = BB.el({\n        content: [banner],\n        className: classes.root,\n    });\n    document.body.append(rootEl);\n\n    function close() {\n        clearTimeout(timeout);\n        document.removeEventListener('pointerdown', onPointerDown);\n        css(rootEl, {\n            opacity: '0',\n        });\n        css(banner, {\n            pointerEvents: 'none',\n        });\n        setTimeout(() => {\n            rootEl.remove();\n        }, 200);\n    }\n\n    const timeout = setTimeout(close, 4500);\n\n    const onPointerDown = (e: PointerEvent) => {\n        const target = e.target as HTMLElement | null;\n        if (banner.contains(target) || banner.contains(target)) {\n            return;\n        }\n        close();\n    };\n    document.addEventListener('pointerdown', onPointerDown, { passive: false });\n}\n",null,"import { BB } from '../../../bb/bb';\nimport { LANG } from '../../../language/language';\nimport eyedropperImg from 'url:/src/app/img/ui/tool-picker.svg';\nimport { BoxToggle } from '../components/box-toggle';\nimport { Icon } from '../components/icon';\nimport { TRgb } from '../../kl-types';\nimport { MobileFloatingWindow } from './mobile-floating-window';\nimport { KlColorSliderSmall } from '../components/kl-color-slider-small';\nimport { TVector2D } from '../../../bb/bb-types';\n\nexport type TMobileColorUiParams = {\n    onEyedropper: (isActive: boolean) => void;\n    color: TRgb;\n    onColorChange: (c: TRgb) => void;\n};\n\nexport class MobileColorUi {\n    private readonly rootEl: HTMLElement;\n    private readonly eyedropperToggle: BoxToggle;\n    private readonly colorCircle: HTMLDivElement;\n    private colorPicker: KlColorSliderSmall | undefined;\n    private colorWindow: MobileFloatingWindow | undefined;\n    private colorPickerPosition: TVector2D = { x: 100, y: 100 };\n    private color: TRgb = { r: 0, g: 0, b: 0 };\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TMobileColorUiParams) {\n        this.color = { ...p.color };\n        this.colorCircle = BB.el({\n            css: {\n                width: '30px',\n                height: '30px',\n                background: BB.ColorConverter.toRgbStr(p.color),\n                borderRadius: '100%',\n                boxShadow: '0 0 0 1px rgba(0,0,0,0.5), inset 0 0 0 1px rgba(255,255,255,0.5)',\n                alignSelf: 'center',\n                cursor: 'pointer',\n            },\n            noRef: true,\n            onClick: () => {\n                if (this.colorPicker) {\n                    this.closeColorPicker();\n                    return;\n                }\n                this.colorPicker = new KlColorSliderSmall({\n                    width: 200,\n                    heightSV: 200,\n                    heightH: 30,\n                    color: this.color,\n                    callback: p.onColorChange,\n                });\n                this.colorWindow = new MobileFloatingWindow({\n                    content: BB.el({ content: this.colorPicker.getElement() }),\n                    onClose: () => {\n                        this.closeColorPicker();\n                    },\n                    position: this.colorPickerPosition,\n                });\n                document.body.append(this.colorWindow.getElement());\n            },\n        });\n\n        const icon = new Icon({\n            imageUrl: eyedropperImg,\n            width: 1,\n            height: 1,\n            css: {\n                width: '100%',\n                height: '100%',\n            },\n            darkInvert: true,\n        });\n        this.eyedropperToggle = new BoxToggle({\n            init: false,\n            title: LANG('eyedropper'),\n            onChange: (b) => {\n                p.onEyedropper(b);\n            },\n            label: BB.el({\n                content: icon.getElement(),\n                css: {\n                    padding: '6px',\n                    height: '36px',\n                },\n            }),\n        });\n\n        this.rootEl = BB.el({\n            css: {\n                display: 'flex',\n                flexDirection: 'column',\n                gap: '4px',\n            },\n        });\n        this.rootEl.append(this.colorCircle, this.eyedropperToggle.getElement());\n    }\n\n    getIsEyedropping(): boolean {\n        return this.eyedropperToggle.getValue();\n    }\n\n    setIsEyedropping(b: boolean): void {\n        this.eyedropperToggle.setValue(b);\n    }\n\n    setColor(color: TRgb): void {\n        this.color = { ...color };\n        this.colorCircle.style.backgroundColor = BB.ColorConverter.toRgbStr(color);\n        this.colorPicker?.setColor(color);\n    }\n\n    closeColorPicker(): void {\n        if (this.colorWindow) {\n            this.colorPickerPosition = this.colorWindow.getPosition();\n            this.colorWindow?.destroy();\n            this.colorWindow?.getElement().remove();\n            this.colorWindow = undefined;\n        }\n        this.colorPicker?.destroy();\n        this.colorPicker = undefined;\n    }\n\n    setIsVisible(b: boolean): void {\n        this.rootEl.style.display = b ? 'flex' : 'none';\n        if (!b) {\n            this.closeColorPicker();\n        }\n    }\n\n    getElement(): HTMLElement {\n        return this.rootEl;\n    }\n}\n","import { BB } from '../../../bb/bb';\nimport { TVector2D } from '../../../bb/bb-types';\nimport { clamp } from '../../../bb/math/math';\nimport { LANG } from '../../../language/language';\nimport cancelImg from 'url:/src/app/img/ui/cancel.svg';\nimport { PointerListener } from '../../../bb/input/pointer-listener';\nimport { css } from '../../../bb/base/base';\n\nexport type TMobileFloatingWindowParams = {\n    content: HTMLElement;\n    // called after window gets closed\n    onClose: () => void;\n    position: TVector2D;\n};\n\nexport class MobileFloatingWindow {\n    private readonly rootEl: HTMLDivElement;\n    private readonly xButton: HTMLElement;\n    private readonly position: TVector2D;\n    private readonly pointerListener: PointerListener;\n\n    private applyPosition(): void {\n        const rect = this.rootEl.getBoundingClientRect();\n        this.position.x = clamp(this.position.x, 0, window.innerWidth - rect.width);\n        this.position.y = clamp(this.position.y, 0, window.innerHeight - rect.height);\n        css(this.rootEl, {\n            left: this.position.x + 'px',\n            top: this.position.y + 'px',\n        });\n    }\n\n    // ----------------------------------- public -----------------------------------\n    constructor(p: TMobileFloatingWindowParams) {\n        this.position = { ...p.position };\n        this.xButton = BB.el({\n            tagName: 'button',\n            className: 'popup-x',\n            content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\n            title: LANG('modal-close'),\n            noRef: true,\n            onClick: () => {\n                p.onClose();\n            },\n            css: {\n                width: '32px',\n                height: '32px',\n                lineHeight: '32px',\n                background: 'none',\n                boxShadow: 'none',\n            },\n            custom: {\n                tabindex: '0',\n            },\n        });\n\n        const header = BB.el({\n            className: 'kl-floating-window-header',\n        });\n        header.append(this.xButton);\n\n        const body = BB.el({\n            content: p.content,\n        });\n\n        let downPosition: TVector2D = {\n            x: 0,\n            y: 0,\n        };\n        this.pointerListener = new BB.PointerListener({\n            target: header,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.button === 'left' && event.type === 'pointerdown') {\n                    downPosition = { ...this.position };\n                }\n                if (event.button === 'left' && event.type === 'pointermove') {\n                    this.position.x = downPosition.x + event.pageX - event.downPageX!;\n                    this.position.y = downPosition.y + event.pageY - event.downPageY!;\n                    this.applyPosition();\n                }\n            },\n        });\n\n        this.rootEl = BB.el({\n            css: {\n                position: 'fixed',\n                display: 'flex',\n                flexDirection: 'column',\n                left: this.position.x + 'px',\n                top: this.position.y + 'px',\n            },\n        });\n        this.rootEl.append(header, body);\n        setTimeout(() => this.applyPosition());\n    }\n\n    getElement(): HTMLDivElement {\n        return this.rootEl;\n    }\n\n    getPosition(): TVector2D {\n        return { ...this.position };\n    }\n\n    destroy(): void {\n        this.pointerListener.destroy();\n    }\n}\n"],"names":[],"version":3,"file":"klecks-main.145099c5.js.map","sourceRoot":"/__parcel_source_root/"}